<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation</title>
<!--Generated on Tue Apr 30 19:04:43 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2404.12457v2/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S1" title="In RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S2" title="In RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Background</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3" title="In RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>RAG System Characterization</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.SS1" title="In 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Performance Bottleneck</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.SS2" title="In 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Optimizations Opportunities</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S4" title="In RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>RAGCache Overview</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5" title="In RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>RAGCache Design</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.SS1" title="In 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>Cache Structure and Replacement Policy</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.SS2" title="In 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Cache-aware Reordering</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.SS3" title="In 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3 </span>Dynamic Speculative Pipelining</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S6" title="In RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Implementation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7" title="In RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7 </span>Evaluation</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.SS1" title="In 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7.1 </span>Overall Performance</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.SS2" title="In 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7.2 </span>Case Study</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.SS3" title="In 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7.3 </span>Ablation Study</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.SS4" title="In 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7.4 </span>Scheduling Time</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S8" title="In RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">8 </span>Discussion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S9" title="In RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">9 </span>Related Work</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S10" title="In RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10 </span>Conclusion</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line ltx_leqno">
<h1 class="ltx_title ltx_title_document">RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Chao Jin<sup class="ltx_sup" id="id12.10.id1">1</sup>  Zili Zhang<sup class="ltx_sup" id="id13.11.id2">1</sup>  Xuanlin Jiang<sup class="ltx_sup" id="id14.12.id3">1</sup>  Fangyue Liu<sup class="ltx_sup" id="id15.13.id4">1</sup>
<br class="ltx_break"/>Xin Liu<sup class="ltx_sup" id="id16.14.id5">2</sup>   Xuanzhe Liu<sup class="ltx_sup" id="id17.15.id6">1</sup>  Xin Jin<sup class="ltx_sup" id="id18.16.id7">1</sup>
<br class="ltx_break"/><sup class="ltx_sup" id="id19.17.id8">1</sup><span class="ltx_text ltx_font_italic" id="id20.18.id9">Peking University</span>   <sup class="ltx_sup" id="id21.19.id10">2</sup><span class="ltx_text ltx_font_italic" id="id22.20.id11">ByteDance Inc.</span>
</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract.</h6>
<p class="ltx_p" id="id11.2">Retrieval-Augmented Generation (RAG) has shown significant improvements
in various natural language processing tasks by integrating the strengths of
large language models (LLMs) and external knowledge databases.
However, RAG introduces long sequence generation and leads to high computation and
memory costs.
We propose RAGCache, a novel multilevel dynamic caching system tailored for
RAG. Our analysis benchmarks current RAG systems,
pinpointing the performance bottleneck (i.e., long sequence due to knowledge
injection) and optimization opportunities (i.e., caching knowledge’s intermediate states).
Based on these insights, we design RAGCache, which organizes the intermediate states
of retrieved knowledge in a knowledge tree and caches them in the GPU and host memory hierarchy.
RAGCache proposes a replacement policy that is aware of LLM inference characteristics and
RAG retrieval patterns. It also dynamically overlaps the retrieval and inference steps to minimize the
end-to-end latency. We implement RAGCache and evaluate it on
vLLM, a state-of-the-art LLM inference system and Faiss, a state-of-the-art vector database.
The experimental results show that RAGCache reduces the time to first token (TTFT) by up to 4<math alttext="\times" class="ltx_Math" display="inline" id="id10.1.m1.1"><semantics id="id10.1.m1.1a"><mo id="id10.1.m1.1.1" xref="id10.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="id10.1.m1.1b"><times id="id10.1.m1.1.1.cmml" xref="id10.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="id10.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="id10.1.m1.1d">×</annotation></semantics></math> and
improves the throughput by up to 2.1<math alttext="\times" class="ltx_Math" display="inline" id="id11.2.m2.1"><semantics id="id11.2.m2.1a"><mo id="id11.2.m2.1.1" xref="id11.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="id11.2.m2.1b"><times id="id11.2.m2.1.1.cmml" xref="id11.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="id11.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="id11.2.m2.1d">×</annotation></semantics></math> compared to vLLM integrated with Faiss.</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1. </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Recent advancements in large language models (LLMs) like GPT-4 <cite class="ltx_cite ltx_citemacro_citep">(OpenAI, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib36" title="">2023</a>)</cite>, LLaMA2 <cite class="ltx_cite ltx_citemacro_citep">(Touvron
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib42" title="">2023</a>)</cite>,
and PalM <cite class="ltx_cite ltx_citemacro_citep">(Chowdhery
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib14" title="">2022</a>)</cite> have significantly enhanced performance across various natural language processing (NLP) tasks,
including question answering, summarization, and translation <cite class="ltx_cite ltx_citemacro_citep">(Siriwardhana et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib40" title="">2023</a>; Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib53" title="">2024a</a>; Zhang
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib52" title="">2023a</a>)</cite>.
Retrieval-augmented generation (RAG) <cite class="ltx_cite ltx_citemacro_citep">(Lewis
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib28" title="">2020</a>; lan, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib2" title="">2024</a>)</cite> further enhances LLMs by incorporating
contextually relevant knowledge from external databases, such as Wikipedia <cite class="ltx_cite ltx_citemacro_citep">(wik, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib6" title="">2024</a>)</cite>, to
improve the generation quality. With informative external knowledge, RAG have achieved comparable or even
better performance than LLMs fine-tuned for specific downstream tasks <cite class="ltx_cite ltx_citemacro_citep">(Chen
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib11" title="">2024</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">For an RAG request, the RAG system first retrieves relevant documents
from the knowledge database. The documents
are typically represented as feature vectors in a vector database through embedding models,
and the retrieval step is implemented by vector similarity search.
Then, RAG injects the retrieved documents (i.e., external knowledge)
into the original request and feeds the augmented request to the LLM for generation.
With the help of the retrieved documents, RAG expands LLMs’ knowledge base and
contextual understanding, thereby improving the generation quality <cite class="ltx_cite ltx_citemacro_citep">(Chen
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib11" title="">2024</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.2">With knowledge injection, RAG introduces long sequence generation for the augmented
request, which leads to high computation and memory costs. For instance, the initial
request contains 100 tokens, and the retrieved documents may contain 1000 tokens in total.
Consequently, the extra computation and memory costs for the augmented request are <math alttext="&gt;" class="ltx_Math" display="inline" id="S1.p3.1.m1.1"><semantics id="S1.p3.1.m1.1a"><mo id="S1.p3.1.m1.1.1" xref="S1.p3.1.m1.1.1.cmml">&gt;</mo><annotation-xml encoding="MathML-Content" id="S1.p3.1.m1.1b"><gt id="S1.p3.1.m1.1.1.cmml" xref="S1.p3.1.m1.1.1"></gt></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.1.m1.1c">&gt;</annotation><annotation encoding="application/x-llamapun" id="S1.p3.1.m1.1d">&gt;</annotation></semantics></math>10<math alttext="\times" class="ltx_Math" display="inline" id="S1.p3.2.m2.1"><semantics id="S1.p3.2.m2.1a"><mo id="S1.p3.2.m2.1.1" xref="S1.p3.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p3.2.m2.1b"><times id="S1.p3.2.m2.1.1.cmml" xref="S1.p3.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p3.2.m2.1d">×</annotation></semantics></math>
higher than the original request.
This escalation in resource requirements poses a substantial challenge
in scaling systems for efficient processing of RAG requests.</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">Recent work <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib58" title="">2023</a>; Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>)</cite>, focusing on system optimizations of LLM inference, has made significant progress
in sharing the intermediate states of LLM inference to reduce recomputation costs.
vLLM <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>)</cite> manages the intermediate states in non-contiguous memory blocks
to allow fine-grained memory allocation and state sharing for a single request’s multiple generation iterations.
SGLang <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib58" title="">2023</a>)</cite> identifies the reusable intermediate states across different requests for
LLM applications like multi-turn conversations and tree-of-thought <cite class="ltx_cite ltx_citemacro_citep">(Yao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib49" title="">2024</a>)</cite>.
However, these efforts only optimize for LLM inference without considering the characteristics of RAG.
They cache the intermediate states in GPU memory, which has limited capacity considering the long sequences
in augmented requests, leading to suboptimal performance.</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">We conduct a system characterization of RAG, which measures the performance of current RAG systems under
various datasets and retrieval settings with representative LLMs.
Our analysis highlights a significant performance limitation rooted in the processing of augmented sequences
due to document injection.
In addition, we uncover two potential <em class="ltx_emph ltx_font_italic" id="S1.p5.1.1">opportunities</em> for system optimizations to mitigate this constraint.
First, the recurrence of identical documents across multiple requests enables the sharing of LLM inference’s
intermediate states for such documents.
Second, a small fraction of documents accounts for the majority of retrieval requests.
This allows us to cache the intermediate states of these frequently accessed documents to reduce the
computational burden.</p>
</div>
<div class="ltx_para" id="S1.p6">
<p class="ltx_p" id="S1.p6.1">To this end, we propose RAGCache, a novel multilevel dynamic caching system tailored for
RAG. RAGCache is the first system to cache the intermediate states of
retrieved documents (i.e., external knowledge) and share them across multiple requests.
The core of RAGCache is a knowledge tree that adapts the intermediate states of the retrieved documents to the
GPU and host memory hierarchy. Documents with more frequent accesses are cached in the fast GPU memory and those with
fewer accesses are cached in the slow host memory. There are mainly two challenges in designing the caching system for RAG.</p>
</div>
<div class="ltx_para" id="S1.p7">
<p class="ltx_p" id="S1.p7.15">First, RAG systems are sensitive to the referred order of the retrieved documents.
For instance, there are two documents <math alttext="D_{1}" class="ltx_Math" display="inline" id="S1.p7.1.m1.1"><semantics id="S1.p7.1.m1.1a"><msub id="S1.p7.1.m1.1.1" xref="S1.p7.1.m1.1.1.cmml"><mi id="S1.p7.1.m1.1.1.2" xref="S1.p7.1.m1.1.1.2.cmml">D</mi><mn id="S1.p7.1.m1.1.1.3" xref="S1.p7.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S1.p7.1.m1.1b"><apply id="S1.p7.1.m1.1.1.cmml" xref="S1.p7.1.m1.1.1"><csymbol cd="ambiguous" id="S1.p7.1.m1.1.1.1.cmml" xref="S1.p7.1.m1.1.1">subscript</csymbol><ci id="S1.p7.1.m1.1.1.2.cmml" xref="S1.p7.1.m1.1.1.2">𝐷</ci><cn id="S1.p7.1.m1.1.1.3.cmml" type="integer" xref="S1.p7.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.1.m1.1c">D_{1}</annotation><annotation encoding="application/x-llamapun" id="S1.p7.1.m1.1d">italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="D_{2}" class="ltx_Math" display="inline" id="S1.p7.2.m2.1"><semantics id="S1.p7.2.m2.1a"><msub id="S1.p7.2.m2.1.1" xref="S1.p7.2.m2.1.1.cmml"><mi id="S1.p7.2.m2.1.1.2" xref="S1.p7.2.m2.1.1.2.cmml">D</mi><mn id="S1.p7.2.m2.1.1.3" xref="S1.p7.2.m2.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S1.p7.2.m2.1b"><apply id="S1.p7.2.m2.1.1.cmml" xref="S1.p7.2.m2.1.1"><csymbol cd="ambiguous" id="S1.p7.2.m2.1.1.1.cmml" xref="S1.p7.2.m2.1.1">subscript</csymbol><ci id="S1.p7.2.m2.1.1.2.cmml" xref="S1.p7.2.m2.1.1.2">𝐷</ci><cn id="S1.p7.2.m2.1.1.3.cmml" type="integer" xref="S1.p7.2.m2.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.2.m2.1c">D_{2}</annotation><annotation encoding="application/x-llamapun" id="S1.p7.2.m2.1d">italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math> and two requests <math alttext="Q_{1}" class="ltx_Math" display="inline" id="S1.p7.3.m3.1"><semantics id="S1.p7.3.m3.1a"><msub id="S1.p7.3.m3.1.1" xref="S1.p7.3.m3.1.1.cmml"><mi id="S1.p7.3.m3.1.1.2" xref="S1.p7.3.m3.1.1.2.cmml">Q</mi><mn id="S1.p7.3.m3.1.1.3" xref="S1.p7.3.m3.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S1.p7.3.m3.1b"><apply id="S1.p7.3.m3.1.1.cmml" xref="S1.p7.3.m3.1.1"><csymbol cd="ambiguous" id="S1.p7.3.m3.1.1.1.cmml" xref="S1.p7.3.m3.1.1">subscript</csymbol><ci id="S1.p7.3.m3.1.1.2.cmml" xref="S1.p7.3.m3.1.1.2">𝑄</ci><cn id="S1.p7.3.m3.1.1.3.cmml" type="integer" xref="S1.p7.3.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.3.m3.1c">Q_{1}</annotation><annotation encoding="application/x-llamapun" id="S1.p7.3.m3.1d">italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S1.p7.4.m4.1"><semantics id="S1.p7.4.m4.1a"><msub id="S1.p7.4.m4.1.1" xref="S1.p7.4.m4.1.1.cmml"><mi id="S1.p7.4.m4.1.1.2" xref="S1.p7.4.m4.1.1.2.cmml">Q</mi><mn id="S1.p7.4.m4.1.1.3" xref="S1.p7.4.m4.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S1.p7.4.m4.1b"><apply id="S1.p7.4.m4.1.1.cmml" xref="S1.p7.4.m4.1.1"><csymbol cd="ambiguous" id="S1.p7.4.m4.1.1.1.cmml" xref="S1.p7.4.m4.1.1">subscript</csymbol><ci id="S1.p7.4.m4.1.1.2.cmml" xref="S1.p7.4.m4.1.1.2">𝑄</ci><cn id="S1.p7.4.m4.1.1.3.cmml" type="integer" xref="S1.p7.4.m4.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.4.m4.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S1.p7.4.m4.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>.
Let <math alttext="Q_{1}" class="ltx_Math" display="inline" id="S1.p7.5.m5.1"><semantics id="S1.p7.5.m5.1a"><msub id="S1.p7.5.m5.1.1" xref="S1.p7.5.m5.1.1.cmml"><mi id="S1.p7.5.m5.1.1.2" xref="S1.p7.5.m5.1.1.2.cmml">Q</mi><mn id="S1.p7.5.m5.1.1.3" xref="S1.p7.5.m5.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S1.p7.5.m5.1b"><apply id="S1.p7.5.m5.1.1.cmml" xref="S1.p7.5.m5.1.1"><csymbol cd="ambiguous" id="S1.p7.5.m5.1.1.1.cmml" xref="S1.p7.5.m5.1.1">subscript</csymbol><ci id="S1.p7.5.m5.1.1.2.cmml" xref="S1.p7.5.m5.1.1.2">𝑄</ci><cn id="S1.p7.5.m5.1.1.3.cmml" type="integer" xref="S1.p7.5.m5.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.5.m5.1c">Q_{1}</annotation><annotation encoding="application/x-llamapun" id="S1.p7.5.m5.1d">italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>’s and <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S1.p7.6.m6.1"><semantics id="S1.p7.6.m6.1a"><msub id="S1.p7.6.m6.1.1" xref="S1.p7.6.m6.1.1.cmml"><mi id="S1.p7.6.m6.1.1.2" xref="S1.p7.6.m6.1.1.2.cmml">Q</mi><mn id="S1.p7.6.m6.1.1.3" xref="S1.p7.6.m6.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S1.p7.6.m6.1b"><apply id="S1.p7.6.m6.1.1.cmml" xref="S1.p7.6.m6.1.1"><csymbol cd="ambiguous" id="S1.p7.6.m6.1.1.1.cmml" xref="S1.p7.6.m6.1.1">subscript</csymbol><ci id="S1.p7.6.m6.1.1.2.cmml" xref="S1.p7.6.m6.1.1.2">𝑄</ci><cn id="S1.p7.6.m6.1.1.3.cmml" type="integer" xref="S1.p7.6.m6.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.6.m6.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S1.p7.6.m6.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>’s relevant documents be <math alttext="[D_{1},D_{2}]" class="ltx_Math" display="inline" id="S1.p7.7.m7.2"><semantics id="S1.p7.7.m7.2a"><mrow id="S1.p7.7.m7.2.2.2" xref="S1.p7.7.m7.2.2.3.cmml"><mo id="S1.p7.7.m7.2.2.2.3" stretchy="false" xref="S1.p7.7.m7.2.2.3.cmml">[</mo><msub id="S1.p7.7.m7.1.1.1.1" xref="S1.p7.7.m7.1.1.1.1.cmml"><mi id="S1.p7.7.m7.1.1.1.1.2" xref="S1.p7.7.m7.1.1.1.1.2.cmml">D</mi><mn id="S1.p7.7.m7.1.1.1.1.3" xref="S1.p7.7.m7.1.1.1.1.3.cmml">1</mn></msub><mo id="S1.p7.7.m7.2.2.2.4" xref="S1.p7.7.m7.2.2.3.cmml">,</mo><msub id="S1.p7.7.m7.2.2.2.2" xref="S1.p7.7.m7.2.2.2.2.cmml"><mi id="S1.p7.7.m7.2.2.2.2.2" xref="S1.p7.7.m7.2.2.2.2.2.cmml">D</mi><mn id="S1.p7.7.m7.2.2.2.2.3" xref="S1.p7.7.m7.2.2.2.2.3.cmml">2</mn></msub><mo id="S1.p7.7.m7.2.2.2.5" stretchy="false" xref="S1.p7.7.m7.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S1.p7.7.m7.2b"><interval closure="closed" id="S1.p7.7.m7.2.2.3.cmml" xref="S1.p7.7.m7.2.2.2"><apply id="S1.p7.7.m7.1.1.1.1.cmml" xref="S1.p7.7.m7.1.1.1.1"><csymbol cd="ambiguous" id="S1.p7.7.m7.1.1.1.1.1.cmml" xref="S1.p7.7.m7.1.1.1.1">subscript</csymbol><ci id="S1.p7.7.m7.1.1.1.1.2.cmml" xref="S1.p7.7.m7.1.1.1.1.2">𝐷</ci><cn id="S1.p7.7.m7.1.1.1.1.3.cmml" type="integer" xref="S1.p7.7.m7.1.1.1.1.3">1</cn></apply><apply id="S1.p7.7.m7.2.2.2.2.cmml" xref="S1.p7.7.m7.2.2.2.2"><csymbol cd="ambiguous" id="S1.p7.7.m7.2.2.2.2.1.cmml" xref="S1.p7.7.m7.2.2.2.2">subscript</csymbol><ci id="S1.p7.7.m7.2.2.2.2.2.cmml" xref="S1.p7.7.m7.2.2.2.2.2">𝐷</ci><cn id="S1.p7.7.m7.2.2.2.2.3.cmml" type="integer" xref="S1.p7.7.m7.2.2.2.2.3">2</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.7.m7.2c">[D_{1},D_{2}]</annotation><annotation encoding="application/x-llamapun" id="S1.p7.7.m7.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ]</annotation></semantics></math> and <math alttext="[D_{2},D_{1}]" class="ltx_Math" display="inline" id="S1.p7.8.m8.2"><semantics id="S1.p7.8.m8.2a"><mrow id="S1.p7.8.m8.2.2.2" xref="S1.p7.8.m8.2.2.3.cmml"><mo id="S1.p7.8.m8.2.2.2.3" stretchy="false" xref="S1.p7.8.m8.2.2.3.cmml">[</mo><msub id="S1.p7.8.m8.1.1.1.1" xref="S1.p7.8.m8.1.1.1.1.cmml"><mi id="S1.p7.8.m8.1.1.1.1.2" xref="S1.p7.8.m8.1.1.1.1.2.cmml">D</mi><mn id="S1.p7.8.m8.1.1.1.1.3" xref="S1.p7.8.m8.1.1.1.1.3.cmml">2</mn></msub><mo id="S1.p7.8.m8.2.2.2.4" xref="S1.p7.8.m8.2.2.3.cmml">,</mo><msub id="S1.p7.8.m8.2.2.2.2" xref="S1.p7.8.m8.2.2.2.2.cmml"><mi id="S1.p7.8.m8.2.2.2.2.2" xref="S1.p7.8.m8.2.2.2.2.2.cmml">D</mi><mn id="S1.p7.8.m8.2.2.2.2.3" xref="S1.p7.8.m8.2.2.2.2.3.cmml">1</mn></msub><mo id="S1.p7.8.m8.2.2.2.5" stretchy="false" xref="S1.p7.8.m8.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S1.p7.8.m8.2b"><interval closure="closed" id="S1.p7.8.m8.2.2.3.cmml" xref="S1.p7.8.m8.2.2.2"><apply id="S1.p7.8.m8.1.1.1.1.cmml" xref="S1.p7.8.m8.1.1.1.1"><csymbol cd="ambiguous" id="S1.p7.8.m8.1.1.1.1.1.cmml" xref="S1.p7.8.m8.1.1.1.1">subscript</csymbol><ci id="S1.p7.8.m8.1.1.1.1.2.cmml" xref="S1.p7.8.m8.1.1.1.1.2">𝐷</ci><cn id="S1.p7.8.m8.1.1.1.1.3.cmml" type="integer" xref="S1.p7.8.m8.1.1.1.1.3">2</cn></apply><apply id="S1.p7.8.m8.2.2.2.2.cmml" xref="S1.p7.8.m8.2.2.2.2"><csymbol cd="ambiguous" id="S1.p7.8.m8.2.2.2.2.1.cmml" xref="S1.p7.8.m8.2.2.2.2">subscript</csymbol><ci id="S1.p7.8.m8.2.2.2.2.2.cmml" xref="S1.p7.8.m8.2.2.2.2.2">𝐷</ci><cn id="S1.p7.8.m8.2.2.2.2.3.cmml" type="integer" xref="S1.p7.8.m8.2.2.2.2.3">1</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.8.m8.2c">[D_{2},D_{1}]</annotation><annotation encoding="application/x-llamapun" id="S1.p7.8.m8.2d">[ italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ]</annotation></semantics></math>, respectively,
where <math alttext="[D_{1},D_{2}]" class="ltx_Math" display="inline" id="S1.p7.9.m9.2"><semantics id="S1.p7.9.m9.2a"><mrow id="S1.p7.9.m9.2.2.2" xref="S1.p7.9.m9.2.2.3.cmml"><mo id="S1.p7.9.m9.2.2.2.3" stretchy="false" xref="S1.p7.9.m9.2.2.3.cmml">[</mo><msub id="S1.p7.9.m9.1.1.1.1" xref="S1.p7.9.m9.1.1.1.1.cmml"><mi id="S1.p7.9.m9.1.1.1.1.2" xref="S1.p7.9.m9.1.1.1.1.2.cmml">D</mi><mn id="S1.p7.9.m9.1.1.1.1.3" xref="S1.p7.9.m9.1.1.1.1.3.cmml">1</mn></msub><mo id="S1.p7.9.m9.2.2.2.4" xref="S1.p7.9.m9.2.2.3.cmml">,</mo><msub id="S1.p7.9.m9.2.2.2.2" xref="S1.p7.9.m9.2.2.2.2.cmml"><mi id="S1.p7.9.m9.2.2.2.2.2" xref="S1.p7.9.m9.2.2.2.2.2.cmml">D</mi><mn id="S1.p7.9.m9.2.2.2.2.3" xref="S1.p7.9.m9.2.2.2.2.3.cmml">2</mn></msub><mo id="S1.p7.9.m9.2.2.2.5" stretchy="false" xref="S1.p7.9.m9.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S1.p7.9.m9.2b"><interval closure="closed" id="S1.p7.9.m9.2.2.3.cmml" xref="S1.p7.9.m9.2.2.2"><apply id="S1.p7.9.m9.1.1.1.1.cmml" xref="S1.p7.9.m9.1.1.1.1"><csymbol cd="ambiguous" id="S1.p7.9.m9.1.1.1.1.1.cmml" xref="S1.p7.9.m9.1.1.1.1">subscript</csymbol><ci id="S1.p7.9.m9.1.1.1.1.2.cmml" xref="S1.p7.9.m9.1.1.1.1.2">𝐷</ci><cn id="S1.p7.9.m9.1.1.1.1.3.cmml" type="integer" xref="S1.p7.9.m9.1.1.1.1.3">1</cn></apply><apply id="S1.p7.9.m9.2.2.2.2.cmml" xref="S1.p7.9.m9.2.2.2.2"><csymbol cd="ambiguous" id="S1.p7.9.m9.2.2.2.2.1.cmml" xref="S1.p7.9.m9.2.2.2.2">subscript</csymbol><ci id="S1.p7.9.m9.2.2.2.2.2.cmml" xref="S1.p7.9.m9.2.2.2.2.2">𝐷</ci><cn id="S1.p7.9.m9.2.2.2.2.3.cmml" type="integer" xref="S1.p7.9.m9.2.2.2.2.3">2</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.9.m9.2c">[D_{1},D_{2}]</annotation><annotation encoding="application/x-llamapun" id="S1.p7.9.m9.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ]</annotation></semantics></math> means <math alttext="D_{1}" class="ltx_Math" display="inline" id="S1.p7.10.m10.1"><semantics id="S1.p7.10.m10.1a"><msub id="S1.p7.10.m10.1.1" xref="S1.p7.10.m10.1.1.cmml"><mi id="S1.p7.10.m10.1.1.2" xref="S1.p7.10.m10.1.1.2.cmml">D</mi><mn id="S1.p7.10.m10.1.1.3" xref="S1.p7.10.m10.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S1.p7.10.m10.1b"><apply id="S1.p7.10.m10.1.1.cmml" xref="S1.p7.10.m10.1.1"><csymbol cd="ambiguous" id="S1.p7.10.m10.1.1.1.cmml" xref="S1.p7.10.m10.1.1">subscript</csymbol><ci id="S1.p7.10.m10.1.1.2.cmml" xref="S1.p7.10.m10.1.1.2">𝐷</ci><cn id="S1.p7.10.m10.1.1.3.cmml" type="integer" xref="S1.p7.10.m10.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.10.m10.1c">D_{1}</annotation><annotation encoding="application/x-llamapun" id="S1.p7.10.m10.1d">italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> is more relevant than <math alttext="D_{2}" class="ltx_Math" display="inline" id="S1.p7.11.m11.1"><semantics id="S1.p7.11.m11.1a"><msub id="S1.p7.11.m11.1.1" xref="S1.p7.11.m11.1.1.cmml"><mi id="S1.p7.11.m11.1.1.2" xref="S1.p7.11.m11.1.1.2.cmml">D</mi><mn id="S1.p7.11.m11.1.1.3" xref="S1.p7.11.m11.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S1.p7.11.m11.1b"><apply id="S1.p7.11.m11.1.1.cmml" xref="S1.p7.11.m11.1.1"><csymbol cd="ambiguous" id="S1.p7.11.m11.1.1.1.cmml" xref="S1.p7.11.m11.1.1">subscript</csymbol><ci id="S1.p7.11.m11.1.1.2.cmml" xref="S1.p7.11.m11.1.1.2">𝐷</ci><cn id="S1.p7.11.m11.1.1.3.cmml" type="integer" xref="S1.p7.11.m11.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.11.m11.1c">D_{2}</annotation><annotation encoding="application/x-llamapun" id="S1.p7.11.m11.1d">italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>.
The intermediate states (i.e., the key value tensors) of <math alttext="[D_{1},D_{2}]" class="ltx_Math" display="inline" id="S1.p7.12.m12.2"><semantics id="S1.p7.12.m12.2a"><mrow id="S1.p7.12.m12.2.2.2" xref="S1.p7.12.m12.2.2.3.cmml"><mo id="S1.p7.12.m12.2.2.2.3" stretchy="false" xref="S1.p7.12.m12.2.2.3.cmml">[</mo><msub id="S1.p7.12.m12.1.1.1.1" xref="S1.p7.12.m12.1.1.1.1.cmml"><mi id="S1.p7.12.m12.1.1.1.1.2" xref="S1.p7.12.m12.1.1.1.1.2.cmml">D</mi><mn id="S1.p7.12.m12.1.1.1.1.3" xref="S1.p7.12.m12.1.1.1.1.3.cmml">1</mn></msub><mo id="S1.p7.12.m12.2.2.2.4" xref="S1.p7.12.m12.2.2.3.cmml">,</mo><msub id="S1.p7.12.m12.2.2.2.2" xref="S1.p7.12.m12.2.2.2.2.cmml"><mi id="S1.p7.12.m12.2.2.2.2.2" xref="S1.p7.12.m12.2.2.2.2.2.cmml">D</mi><mn id="S1.p7.12.m12.2.2.2.2.3" xref="S1.p7.12.m12.2.2.2.2.3.cmml">2</mn></msub><mo id="S1.p7.12.m12.2.2.2.5" stretchy="false" xref="S1.p7.12.m12.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S1.p7.12.m12.2b"><interval closure="closed" id="S1.p7.12.m12.2.2.3.cmml" xref="S1.p7.12.m12.2.2.2"><apply id="S1.p7.12.m12.1.1.1.1.cmml" xref="S1.p7.12.m12.1.1.1.1"><csymbol cd="ambiguous" id="S1.p7.12.m12.1.1.1.1.1.cmml" xref="S1.p7.12.m12.1.1.1.1">subscript</csymbol><ci id="S1.p7.12.m12.1.1.1.1.2.cmml" xref="S1.p7.12.m12.1.1.1.1.2">𝐷</ci><cn id="S1.p7.12.m12.1.1.1.1.3.cmml" type="integer" xref="S1.p7.12.m12.1.1.1.1.3">1</cn></apply><apply id="S1.p7.12.m12.2.2.2.2.cmml" xref="S1.p7.12.m12.2.2.2.2"><csymbol cd="ambiguous" id="S1.p7.12.m12.2.2.2.2.1.cmml" xref="S1.p7.12.m12.2.2.2.2">subscript</csymbol><ci id="S1.p7.12.m12.2.2.2.2.2.cmml" xref="S1.p7.12.m12.2.2.2.2.2">𝐷</ci><cn id="S1.p7.12.m12.2.2.2.2.3.cmml" type="integer" xref="S1.p7.12.m12.2.2.2.2.3">2</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.12.m12.2c">[D_{1},D_{2}]</annotation><annotation encoding="application/x-llamapun" id="S1.p7.12.m12.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ]</annotation></semantics></math> are different from that of <math alttext="[D_{2},D_{1}]" class="ltx_Math" display="inline" id="S1.p7.13.m13.2"><semantics id="S1.p7.13.m13.2a"><mrow id="S1.p7.13.m13.2.2.2" xref="S1.p7.13.m13.2.2.3.cmml"><mo id="S1.p7.13.m13.2.2.2.3" stretchy="false" xref="S1.p7.13.m13.2.2.3.cmml">[</mo><msub id="S1.p7.13.m13.1.1.1.1" xref="S1.p7.13.m13.1.1.1.1.cmml"><mi id="S1.p7.13.m13.1.1.1.1.2" xref="S1.p7.13.m13.1.1.1.1.2.cmml">D</mi><mn id="S1.p7.13.m13.1.1.1.1.3" xref="S1.p7.13.m13.1.1.1.1.3.cmml">2</mn></msub><mo id="S1.p7.13.m13.2.2.2.4" xref="S1.p7.13.m13.2.2.3.cmml">,</mo><msub id="S1.p7.13.m13.2.2.2.2" xref="S1.p7.13.m13.2.2.2.2.cmml"><mi id="S1.p7.13.m13.2.2.2.2.2" xref="S1.p7.13.m13.2.2.2.2.2.cmml">D</mi><mn id="S1.p7.13.m13.2.2.2.2.3" xref="S1.p7.13.m13.2.2.2.2.3.cmml">1</mn></msub><mo id="S1.p7.13.m13.2.2.2.5" stretchy="false" xref="S1.p7.13.m13.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S1.p7.13.m13.2b"><interval closure="closed" id="S1.p7.13.m13.2.2.3.cmml" xref="S1.p7.13.m13.2.2.2"><apply id="S1.p7.13.m13.1.1.1.1.cmml" xref="S1.p7.13.m13.1.1.1.1"><csymbol cd="ambiguous" id="S1.p7.13.m13.1.1.1.1.1.cmml" xref="S1.p7.13.m13.1.1.1.1">subscript</csymbol><ci id="S1.p7.13.m13.1.1.1.1.2.cmml" xref="S1.p7.13.m13.1.1.1.1.2">𝐷</ci><cn id="S1.p7.13.m13.1.1.1.1.3.cmml" type="integer" xref="S1.p7.13.m13.1.1.1.1.3">2</cn></apply><apply id="S1.p7.13.m13.2.2.2.2.cmml" xref="S1.p7.13.m13.2.2.2.2"><csymbol cd="ambiguous" id="S1.p7.13.m13.2.2.2.2.1.cmml" xref="S1.p7.13.m13.2.2.2.2">subscript</csymbol><ci id="S1.p7.13.m13.2.2.2.2.2.cmml" xref="S1.p7.13.m13.2.2.2.2.2">𝐷</ci><cn id="S1.p7.13.m13.2.2.2.2.3.cmml" type="integer" xref="S1.p7.13.m13.2.2.2.2.3">1</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.13.m13.2c">[D_{2},D_{1}]</annotation><annotation encoding="application/x-llamapun" id="S1.p7.13.m13.2d">[ italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ]</annotation></semantics></math>
because the key-value tensor of the new token is calculated based on the preceding tokens in the
attention mechanism of LLMs <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib45" title="">2017</a>)</cite>.
Unfortunately, we also cannot swap the order of <math alttext="D_{1}" class="ltx_Math" display="inline" id="S1.p7.14.m14.1"><semantics id="S1.p7.14.m14.1a"><msub id="S1.p7.14.m14.1.1" xref="S1.p7.14.m14.1.1.cmml"><mi id="S1.p7.14.m14.1.1.2" xref="S1.p7.14.m14.1.1.2.cmml">D</mi><mn id="S1.p7.14.m14.1.1.3" xref="S1.p7.14.m14.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S1.p7.14.m14.1b"><apply id="S1.p7.14.m14.1.1.cmml" xref="S1.p7.14.m14.1.1"><csymbol cd="ambiguous" id="S1.p7.14.m14.1.1.1.cmml" xref="S1.p7.14.m14.1.1">subscript</csymbol><ci id="S1.p7.14.m14.1.1.2.cmml" xref="S1.p7.14.m14.1.1.2">𝐷</ci><cn id="S1.p7.14.m14.1.1.3.cmml" type="integer" xref="S1.p7.14.m14.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.14.m14.1c">D_{1}</annotation><annotation encoding="application/x-llamapun" id="S1.p7.14.m14.1d">italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="D_{2}" class="ltx_Math" display="inline" id="S1.p7.15.m15.1"><semantics id="S1.p7.15.m15.1a"><msub id="S1.p7.15.m15.1.1" xref="S1.p7.15.m15.1.1.cmml"><mi id="S1.p7.15.m15.1.1.2" xref="S1.p7.15.m15.1.1.2.cmml">D</mi><mn id="S1.p7.15.m15.1.1.3" xref="S1.p7.15.m15.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S1.p7.15.m15.1b"><apply id="S1.p7.15.m15.1.1.cmml" xref="S1.p7.15.m15.1.1"><csymbol cd="ambiguous" id="S1.p7.15.m15.1.1.1.cmml" xref="S1.p7.15.m15.1.1">subscript</csymbol><ci id="S1.p7.15.m15.1.1.2.cmml" xref="S1.p7.15.m15.1.1.2">𝐷</ci><cn id="S1.p7.15.m15.1.1.3.cmml" type="integer" xref="S1.p7.15.m15.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.15.m15.1c">D_{2}</annotation><annotation encoding="application/x-llamapun" id="S1.p7.15.m15.1d">italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>.
As recent efforts have shown, the generation quality of the LLMs will be affected by the referred
order <cite class="ltx_cite ltx_citemacro_citep">(Chen
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib10" title="">2023</a>; Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib31" title="">2024</a>)</cite>. We use knowledge tree to organize the intermediate states
of the retrieved documents in the GPU and host memory hierarchy and design a prefix-aware
Greedy-Dual-Size-Frequency (PGDSF) replacement policy that
comprehensively considers the document order, size, frequency, and recency to minimize the miss rate.
We also propose a cache-aware request scheduling approach to further improve the hit rate when the request
rate is high.</p>
</div>
<div class="ltx_para" id="S1.p8">
<p class="ltx_p" id="S1.p8.1">Second, vector retrieval (processed on CPU) and LLM inference (processed on GPU) are two independent steps in RAG.
The two steps are executed sequentially in the current RAG systems,
leading to idle GPU resources during retrieval and long end-to-end latency.
We propose a dynamic speculative pipelining strategy to dynamically
overlap the computation of the two steps and minimize the end-to-end latency while keeping the system load
under control.</p>
</div>
<div class="ltx_para" id="S1.p9">
<p class="ltx_p" id="S1.p9.4">We implement a RAGCache prototype and evaluate it on various datasets and representative LLMs.
The experimental results show that RAGCache outperforms the state-of-the-art solution, vLLM <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>)</cite>
integrated with Faiss <cite class="ltx_cite ltx_citemacro_citep">(pin, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib5" title="">2024</a>)</cite>, by up to 4<math alttext="\times" class="ltx_Math" display="inline" id="S1.p9.1.m1.1"><semantics id="S1.p9.1.m1.1a"><mo id="S1.p9.1.m1.1.1" xref="S1.p9.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p9.1.m1.1b"><times id="S1.p9.1.m1.1.1.cmml" xref="S1.p9.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p9.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p9.1.m1.1d">×</annotation></semantics></math> on time to first token (TTFT) and improves the throughput
by up to 2.1<math alttext="\times" class="ltx_Math" display="inline" id="S1.p9.2.m2.1"><semantics id="S1.p9.2.m2.1a"><mo id="S1.p9.2.m2.1.1" xref="S1.p9.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p9.2.m2.1b"><times id="S1.p9.2.m2.1.1.cmml" xref="S1.p9.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p9.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p9.2.m2.1d">×</annotation></semantics></math>.
Compared to SGLang <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib58" title="">2023</a>)</cite>, which reuse the intermediate states in GPU memory,
RAGCache reduces the TTFT by up to 3.5<math alttext="\times" class="ltx_Math" display="inline" id="S1.p9.3.m3.1"><semantics id="S1.p9.3.m3.1a"><mo id="S1.p9.3.m3.1.1" xref="S1.p9.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p9.3.m3.1b"><times id="S1.p9.3.m3.1.1.cmml" xref="S1.p9.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p9.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p9.3.m3.1d">×</annotation></semantics></math> and improves the throughput by up to 1.8<math alttext="\times" class="ltx_Math" display="inline" id="S1.p9.4.m4.1"><semantics id="S1.p9.4.m4.1a"><mo id="S1.p9.4.m4.1.1" xref="S1.p9.4.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.p9.4.m4.1b"><times id="S1.p9.4.m4.1.1.cmml" xref="S1.p9.4.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.p9.4.m4.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.p9.4.m4.1d">×</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S1.p10">
<p class="ltx_p" id="S1.p10.1">In summary, we make the following contributions.</p>
<ul class="ltx_itemize" id="S1.I1">
<li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i1.p1">
<p class="ltx_p" id="S1.I1.i1.p1.1">We conduct a detailed system characterization of RAG, which reveals the performance
bottleneck and optimization opportunities.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i2.p1">
<p class="ltx_p" id="S1.I1.i2.p1.1">We propose RAGCache, to the best of our knowledge, the first RAG system
that caches the intermediate states of external knowledge and shares them across
multiple queries to reduce the redundant computation.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i3.p1">
<p class="ltx_p" id="S1.I1.i3.p1.1">We design a prefix-aware GDSF replacement policy that leverages the characteristics of RAG to minimize
the miss rate and a dynamic speculative pipelining approach to minimize the end-to-end latency.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i4.p1">
<p class="ltx_p" id="S1.I1.i4.p1.4">We implement a RAGCache prototype. The evaluation shows that RAGCache outperforms vLLM integrated with Faiss by up to 4<math alttext="\times" class="ltx_Math" display="inline" id="S1.I1.i4.p1.1.m1.1"><semantics id="S1.I1.i4.p1.1.m1.1a"><mo id="S1.I1.i4.p1.1.m1.1.1" xref="S1.I1.i4.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.I1.i4.p1.1.m1.1b"><times id="S1.I1.i4.p1.1.m1.1.1.cmml" xref="S1.I1.i4.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.I1.i4.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.I1.i4.p1.1.m1.1d">×</annotation></semantics></math> on TTFT and 2.1<math alttext="\times" class="ltx_Math" display="inline" id="S1.I1.i4.p1.2.m2.1"><semantics id="S1.I1.i4.p1.2.m2.1a"><mo id="S1.I1.i4.p1.2.m2.1.1" xref="S1.I1.i4.p1.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.I1.i4.p1.2.m2.1b"><times id="S1.I1.i4.p1.2.m2.1.1.cmml" xref="S1.I1.i4.p1.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.I1.i4.p1.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.I1.i4.p1.2.m2.1d">×</annotation></semantics></math> on throughput.
Compared to the state-of-the-art caching system for LLM applications, SGLang,
RAGCache achieves up to 3.5<math alttext="\times" class="ltx_Math" display="inline" id="S1.I1.i4.p1.3.m3.1"><semantics id="S1.I1.i4.p1.3.m3.1a"><mo id="S1.I1.i4.p1.3.m3.1.1" xref="S1.I1.i4.p1.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.I1.i4.p1.3.m3.1b"><times id="S1.I1.i4.p1.3.m3.1.1.cmml" xref="S1.I1.i4.p1.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.I1.i4.p1.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.I1.i4.p1.3.m3.1d">×</annotation></semantics></math> lower TTFT and up to 1.8<math alttext="\times" class="ltx_Math" display="inline" id="S1.I1.i4.p1.4.m4.1"><semantics id="S1.I1.i4.p1.4.m4.1a"><mo id="S1.I1.i4.p1.4.m4.1.1" xref="S1.I1.i4.p1.4.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S1.I1.i4.p1.4.m4.1b"><times id="S1.I1.i4.p1.4.m4.1.1.cmml" xref="S1.I1.i4.p1.4.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S1.I1.i4.p1.4.m4.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S1.I1.i4.p1.4.m4.1d">×</annotation></semantics></math> higher throughput.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2. </span>Background</h2>
<div class="ltx_para" id="S2.p1">
<p class="ltx_p" id="S2.p1.1">Retrieval-Augmented Generation (RAG) represents a significant advancement
in the field of natural language processing (NLP) and machine learning,
combining LLMs with the vast information accessible in external knowledge databases.
Specifically, RAG is employed to enhance the generative models’ ability to produce more accurate, relevant, and
contextually rich responses by dynamically retrieving information from a corpus
during the generation process. This hybrid approach combines the strengths of two
major strands: the deep contextual understanding of LLMs
and the precision of knowledge database retrieval.
Recent work <cite class="ltx_cite ltx_citemacro_citep">(Lewis
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib28" title="">2020</a>; Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib23" title="">2024b</a>; Borgeaud
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib9" title="">2022</a>; Ram et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib38" title="">2023</a>; Trivedi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib43" title="">2022</a>; lan, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib2" title="">2024</a>)</cite>
has demonstrated that RAG can significantly improve the generation quality
across various benchmarks compared to solely generative models.
The RAG framework has since been applied across various tasks,
including question answering <cite class="ltx_cite ltx_citemacro_citep">(Siriwardhana et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib40" title="">2023</a>)</cite>,
content creation <cite class="ltx_cite ltx_citemacro_citep">(Khattab et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib25" title="">2022</a>)</cite>, and even code generation <cite class="ltx_cite ltx_citemacro_citep">(Lu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib34" title="">2022</a>; Vaithilingam et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib44" title="">2022</a>)</cite>,
showcasing its versatility and promise.</p>
</div>
<figure class="ltx_figure" id="S2.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_missing ltx_missing_image" id="S2.F1.g1" src=""/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S2.F1.2.1.1" style="font-size:90%;">Figure 1</span>. </span><span class="ltx_text" id="S2.F1.3.2" style="font-size:90%;">RAG workflow.</span></figcaption>
</figure>
<div class="ltx_para" id="S2.p2">
<p class="ltx_p" id="S2.p2.1">As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S2.F1" title="Figure 1 ‣ 2. Background ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">1</span></a>, RAG operates on a two-step workflow: <em class="ltx_emph ltx_font_italic" id="S2.p2.1.1">retrieval</em>
and <em class="ltx_emph ltx_font_italic" id="S2.p2.1.2">generation</em>, integrating offline preparation with real-time processing for enhanced performance.
Initially, in its offline phase, RAG transforms the external knowledge sources, such as documents,
into high-dimensional vectors using advanced embedding models. RAG then
indexes these vectors into a specialized vector database designed for efficient retrieval.
Upon receiving a user request, RAG first accesses this vector database to conduct a vector similarity search,
retrieving the documents that best match the request based on their semantic content.
Following this, RAG combines the content of these retrieved documents with the original user request,
creating an augmented request. This augmented request is then provided to an LLM,
which leverages the combined information to generate a response that is more informed and contextually rich.</p>
</div>
<div class="ltx_para" id="S2.p3">
<p class="ltx_p" id="S2.p3.1">In an RAG workflow, the retrieval step is mainly performed on CPUs, while the generation step is executed on GPUs.
From a system perspective, the end-to-end performance of RAG is affected by both the retrieval or generation steps.
The retrieval time is mainly determined by the vector database’s scale,
and the generation time is decided by the model size and the sequence length.
Our subsequent characterization will identify RAG’s performance bottleneck and highlight potential areas for optimization.</p>
</div>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3. </span>RAG System Characterization</h2>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">In this section, we conduct a comprehensive system characterization. First, we
identify the performance bottlenecks for RAG, i.e., the LLM generation step.
Next, we evaluate the performance improvement of caching the intermediate states of the retrieved knowledge.
Finally, we analyze the question patterns and the potential for caching optimization.</p>
</div>
<figure class="ltx_figure" id="S3.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_missing ltx_missing_image" id="S3.F2.g1" src=""/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F2.2.1.1" style="font-size:90%;">Figure 2</span>. </span><span class="ltx_text" id="S3.F2.3.2" style="font-size:90%;">Inference time with different input lengths.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S3.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_missing ltx_missing_image" id="S3.F3.g1" src=""/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F3.2.1.1" style="font-size:90%;">Figure 3</span>. </span><span class="ltx_text" id="S3.F3.3.2" style="font-size:90%;">The distribution of token number.</span></figcaption>
</figure>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1. </span>Performance Bottleneck</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.1">LLM inference can be divided into two distinct phases: prefill and decoding.
The prefill phase involves computing the key-value tensors of the input tokens,
while the decoding phase generates the output token in an auto-regressive manner based on the previously generated key-value tensors.
The prefill phase is particularly time-consuming, as it requires to compute the entire input sequence’s key-value tensors.</p>
</div>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.1">As discussed in § <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S2" title="2. Background ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">2</span></a>, RAG comprises two steps: retrieval and generation.
Recent work <cite class="ltx_cite ltx_citemacro_citep">(Zhang
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib54" title="">2023b</a>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib55" title="">2024b</a>)</cite> shows that
the retrieval step executes in milliseconds per request with a high accuracy for billion-scale vector databases.
Meanwhile, the generation step, conducted on GPUs, is heavily affected by sequence length and model size.
To identify the performance bottleneck, we evaluate the inference time with fixed output length and different input lengths
on LLaMA2-7B, the smallest model in the LLaMA2 series <cite class="ltx_cite ltx_citemacro_citep">(Touvron
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib42" title="">2023</a>)</cite>.
Larger models will have longer inference time.
The backend system is vLLM <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>)</cite> equipped with one NVIDIA A10G GPU.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.F2" title="Figure 2 ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">2</span></a> shows that
the inference time, mainly dominated by the prefill phase,
increases rapidly with sequence length and reaches one second when the sequence length is larger than 4000 tokens.</p>
</div>
<div class="ltx_para" id="S3.SS1.p3">
<p class="ltx_p" id="S3.SS1.p3.1">The sequence length in the LLM generation step is the token number of the original request plus the retrieved document.
We generate a document dataset based on the Wikipedia corpus <cite class="ltx_cite ltx_citemacro_citep">(wik, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib6" title="">2024</a>)</cite> with <math alttext="\sim" class="ltx_Math" display="inline" id="S3.SS1.p3.1.m1.1"><semantics id="S3.SS1.p3.1.m1.1a"><mo id="S3.SS1.p3.1.m1.1.1" xref="S3.SS1.p3.1.m1.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.1.m1.1b"><csymbol cd="latexml" id="S3.SS1.p3.1.m1.1.1.cmml" xref="S3.SS1.p3.1.m1.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.1.m1.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.1.m1.1d">∼</annotation></semantics></math>0.3 million
documents from most popular Wikipedia pages. Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.F3" title="Figure 3 ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">3</span></a> demonstrates
the distribution of the document length and the request length.
The document length is significantly longer than the request length of the MMLU dataset <cite class="ltx_cite ltx_citemacro_citep">(Hendrycks et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib19" title="">2020</a>)</cite>.
With an average document length of 3718 tokens, the corresponding inference time is
markedly higher than the retrieval step in most cases.
Notably, the retrieval step may take comparable time to the generation step when users require relevant knowledge
with extremely high accuracy <cite class="ltx_cite ltx_citemacro_citep">(Zhang
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib55" title="">2024b</a>)</cite>, which necessitates extensive searching in the vector database
and further complicates the performance bottleneck.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2. </span>Optimizations Opportunities</h3>
<div class="ltx_para ltx_noindent" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.7"><span class="ltx_text ltx_font_bold" id="S3.SS2.p1.7.1">Caching knowledge.</span>
The generation step’s performance bottleneck primarily arises from processing the
long sequence’s key-value tensors in attention blocks.
A simple yet effective optimization for RAG involves caching these key-value tensors of previously retrieved
documents. For example, let requests, <math alttext="Q_{1}" class="ltx_Math" display="inline" id="S3.SS2.p1.1.m1.1"><semantics id="S3.SS2.p1.1.m1.1a"><msub id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml"><mi id="S3.SS2.p1.1.m1.1.1.2" xref="S3.SS2.p1.1.m1.1.1.2.cmml">Q</mi><mn id="S3.SS2.p1.1.m1.1.1.3" xref="S3.SS2.p1.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b"><apply id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.1.m1.1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p1.1.m1.1.1.2.cmml" xref="S3.SS2.p1.1.m1.1.1.2">𝑄</ci><cn id="S3.SS2.p1.1.m1.1.1.3.cmml" type="integer" xref="S3.SS2.p1.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">Q_{1}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.1.m1.1d">italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S3.SS2.p1.2.m2.1"><semantics id="S3.SS2.p1.2.m2.1a"><msub id="S3.SS2.p1.2.m2.1.1" xref="S3.SS2.p1.2.m2.1.1.cmml"><mi id="S3.SS2.p1.2.m2.1.1.2" xref="S3.SS2.p1.2.m2.1.1.2.cmml">Q</mi><mn id="S3.SS2.p1.2.m2.1.1.3" xref="S3.SS2.p1.2.m2.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.2.m2.1b"><apply id="S3.SS2.p1.2.m2.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.2.m2.1.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p1.2.m2.1.1.2.cmml" xref="S3.SS2.p1.2.m2.1.1.2">𝑄</ci><cn id="S3.SS2.p1.2.m2.1.1.3.cmml" type="integer" xref="S3.SS2.p1.2.m2.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.2.m2.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.2.m2.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>, both refer to the same document, <math alttext="D_{1}" class="ltx_Math" display="inline" id="S3.SS2.p1.3.m3.1"><semantics id="S3.SS2.p1.3.m3.1a"><msub id="S3.SS2.p1.3.m3.1.1" xref="S3.SS2.p1.3.m3.1.1.cmml"><mi id="S3.SS2.p1.3.m3.1.1.2" xref="S3.SS2.p1.3.m3.1.1.2.cmml">D</mi><mn id="S3.SS2.p1.3.m3.1.1.3" xref="S3.SS2.p1.3.m3.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.3.m3.1b"><apply id="S3.SS2.p1.3.m3.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.3.m3.1.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1">subscript</csymbol><ci id="S3.SS2.p1.3.m3.1.1.2.cmml" xref="S3.SS2.p1.3.m3.1.1.2">𝐷</ci><cn id="S3.SS2.p1.3.m3.1.1.3.cmml" type="integer" xref="S3.SS2.p1.3.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.3.m3.1c">D_{1}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.3.m3.1d">italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>.
If <math alttext="Q_{1}" class="ltx_Math" display="inline" id="S3.SS2.p1.4.m4.1"><semantics id="S3.SS2.p1.4.m4.1a"><msub id="S3.SS2.p1.4.m4.1.1" xref="S3.SS2.p1.4.m4.1.1.cmml"><mi id="S3.SS2.p1.4.m4.1.1.2" xref="S3.SS2.p1.4.m4.1.1.2.cmml">Q</mi><mn id="S3.SS2.p1.4.m4.1.1.3" xref="S3.SS2.p1.4.m4.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.4.m4.1b"><apply id="S3.SS2.p1.4.m4.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.4.m4.1.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1">subscript</csymbol><ci id="S3.SS2.p1.4.m4.1.1.2.cmml" xref="S3.SS2.p1.4.m4.1.1.2">𝑄</ci><cn id="S3.SS2.p1.4.m4.1.1.3.cmml" type="integer" xref="S3.SS2.p1.4.m4.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.4.m4.1c">Q_{1}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.4.m4.1d">italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> arrives first, the key-value tensors of <math alttext="D_{1}" class="ltx_Math" display="inline" id="S3.SS2.p1.5.m5.1"><semantics id="S3.SS2.p1.5.m5.1a"><msub id="S3.SS2.p1.5.m5.1.1" xref="S3.SS2.p1.5.m5.1.1.cmml"><mi id="S3.SS2.p1.5.m5.1.1.2" xref="S3.SS2.p1.5.m5.1.1.2.cmml">D</mi><mn id="S3.SS2.p1.5.m5.1.1.3" xref="S3.SS2.p1.5.m5.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.5.m5.1b"><apply id="S3.SS2.p1.5.m5.1.1.cmml" xref="S3.SS2.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.5.m5.1.1.1.cmml" xref="S3.SS2.p1.5.m5.1.1">subscript</csymbol><ci id="S3.SS2.p1.5.m5.1.1.2.cmml" xref="S3.SS2.p1.5.m5.1.1.2">𝐷</ci><cn id="S3.SS2.p1.5.m5.1.1.3.cmml" type="integer" xref="S3.SS2.p1.5.m5.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.5.m5.1c">D_{1}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.5.m5.1d">italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> are computed, and we can cache
the key-value tensors. When <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S3.SS2.p1.6.m6.1"><semantics id="S3.SS2.p1.6.m6.1a"><msub id="S3.SS2.p1.6.m6.1.1" xref="S3.SS2.p1.6.m6.1.1.cmml"><mi id="S3.SS2.p1.6.m6.1.1.2" xref="S3.SS2.p1.6.m6.1.1.2.cmml">Q</mi><mn id="S3.SS2.p1.6.m6.1.1.3" xref="S3.SS2.p1.6.m6.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.6.m6.1b"><apply id="S3.SS2.p1.6.m6.1.1.cmml" xref="S3.SS2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.6.m6.1.1.1.cmml" xref="S3.SS2.p1.6.m6.1.1">subscript</csymbol><ci id="S3.SS2.p1.6.m6.1.1.2.cmml" xref="S3.SS2.p1.6.m6.1.1.2">𝑄</ci><cn id="S3.SS2.p1.6.m6.1.1.3.cmml" type="integer" xref="S3.SS2.p1.6.m6.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.6.m6.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.6.m6.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math> arrives, we can reuse the cached key-value tensors
to reduce the prefill latency of <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S3.SS2.p1.7.m7.1"><semantics id="S3.SS2.p1.7.m7.1a"><msub id="S3.SS2.p1.7.m7.1.1" xref="S3.SS2.p1.7.m7.1.1.cmml"><mi id="S3.SS2.p1.7.m7.1.1.2" xref="S3.SS2.p1.7.m7.1.1.2.cmml">Q</mi><mn id="S3.SS2.p1.7.m7.1.1.3" xref="S3.SS2.p1.7.m7.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.7.m7.1b"><apply id="S3.SS2.p1.7.m7.1.1.cmml" xref="S3.SS2.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.7.m7.1.1.1.cmml" xref="S3.SS2.p1.7.m7.1.1">subscript</csymbol><ci id="S3.SS2.p1.7.m7.1.1.2.cmml" xref="S3.SS2.p1.7.m7.1.1.2">𝑄</ci><cn id="S3.SS2.p1.7.m7.1.1.3.cmml" type="integer" xref="S3.SS2.p1.7.m7.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.7.m7.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.7.m7.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>.
The average prefill latency with caching is calculated as follows:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S10.EGx1">
<tbody id="S3.Ex1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\mathit{Prefill\ Latency}=\mathit{Miss\ Rate}\times\mathit{Full\ %
Prefill\ Latency}" class="ltx_Math" display="inline" id="S3.Ex1.m1.1"><semantics id="S3.Ex1.m1.1a"><mrow id="S3.Ex1.m1.1.1" xref="S3.Ex1.m1.1.1.cmml"><mrow id="S3.Ex1.m1.1.1.2" xref="S3.Ex1.m1.1.1.2.cmml"><mi id="S3.Ex1.m1.1.1.2.2" xref="S3.Ex1.m1.1.1.2.2.cmml">𝑃𝑟𝑒𝑓𝑖𝑙𝑙</mi><mo id="S3.Ex1.m1.1.1.2.1" lspace="0.500em" xref="S3.Ex1.m1.1.1.2.1.cmml">⁢</mo><mi id="S3.Ex1.m1.1.1.2.3" xref="S3.Ex1.m1.1.1.2.3.cmml">𝐿𝑎𝑡𝑒𝑛𝑐𝑦</mi></mrow><mo id="S3.Ex1.m1.1.1.1" xref="S3.Ex1.m1.1.1.1.cmml">=</mo><mrow id="S3.Ex1.m1.1.1.3" xref="S3.Ex1.m1.1.1.3.cmml"><mrow id="S3.Ex1.m1.1.1.3.2" xref="S3.Ex1.m1.1.1.3.2.cmml"><mrow id="S3.Ex1.m1.1.1.3.2.2" xref="S3.Ex1.m1.1.1.3.2.2.cmml"><mi id="S3.Ex1.m1.1.1.3.2.2.2" xref="S3.Ex1.m1.1.1.3.2.2.2.cmml">𝑀𝑖𝑠𝑠</mi><mo id="S3.Ex1.m1.1.1.3.2.2.1" lspace="0.500em" xref="S3.Ex1.m1.1.1.3.2.2.1.cmml">⁢</mo><mi id="S3.Ex1.m1.1.1.3.2.2.3" xref="S3.Ex1.m1.1.1.3.2.2.3.cmml">𝑅𝑎𝑡𝑒</mi></mrow><mo id="S3.Ex1.m1.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.Ex1.m1.1.1.3.2.1.cmml">×</mo><mi id="S3.Ex1.m1.1.1.3.2.3" xref="S3.Ex1.m1.1.1.3.2.3.cmml">𝐹𝑢𝑙𝑙</mi></mrow><mo id="S3.Ex1.m1.1.1.3.1" lspace="0.500em" xref="S3.Ex1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex1.m1.1.1.3.3" xref="S3.Ex1.m1.1.1.3.3.cmml">𝑃𝑟𝑒𝑓𝑖𝑙𝑙</mi><mo id="S3.Ex1.m1.1.1.3.1a" lspace="0.500em" xref="S3.Ex1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex1.m1.1.1.3.4" xref="S3.Ex1.m1.1.1.3.4.cmml">𝐿𝑎𝑡𝑒𝑛𝑐𝑦</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex1.m1.1b"><apply id="S3.Ex1.m1.1.1.cmml" xref="S3.Ex1.m1.1.1"><eq id="S3.Ex1.m1.1.1.1.cmml" xref="S3.Ex1.m1.1.1.1"></eq><apply id="S3.Ex1.m1.1.1.2.cmml" xref="S3.Ex1.m1.1.1.2"><times id="S3.Ex1.m1.1.1.2.1.cmml" xref="S3.Ex1.m1.1.1.2.1"></times><ci id="S3.Ex1.m1.1.1.2.2.cmml" xref="S3.Ex1.m1.1.1.2.2">𝑃𝑟𝑒𝑓𝑖𝑙𝑙</ci><ci id="S3.Ex1.m1.1.1.2.3.cmml" xref="S3.Ex1.m1.1.1.2.3">𝐿𝑎𝑡𝑒𝑛𝑐𝑦</ci></apply><apply id="S3.Ex1.m1.1.1.3.cmml" xref="S3.Ex1.m1.1.1.3"><times id="S3.Ex1.m1.1.1.3.1.cmml" xref="S3.Ex1.m1.1.1.3.1"></times><apply id="S3.Ex1.m1.1.1.3.2.cmml" xref="S3.Ex1.m1.1.1.3.2"><times id="S3.Ex1.m1.1.1.3.2.1.cmml" xref="S3.Ex1.m1.1.1.3.2.1"></times><apply id="S3.Ex1.m1.1.1.3.2.2.cmml" xref="S3.Ex1.m1.1.1.3.2.2"><times id="S3.Ex1.m1.1.1.3.2.2.1.cmml" xref="S3.Ex1.m1.1.1.3.2.2.1"></times><ci id="S3.Ex1.m1.1.1.3.2.2.2.cmml" xref="S3.Ex1.m1.1.1.3.2.2.2">𝑀𝑖𝑠𝑠</ci><ci id="S3.Ex1.m1.1.1.3.2.2.3.cmml" xref="S3.Ex1.m1.1.1.3.2.2.3">𝑅𝑎𝑡𝑒</ci></apply><ci id="S3.Ex1.m1.1.1.3.2.3.cmml" xref="S3.Ex1.m1.1.1.3.2.3">𝐹𝑢𝑙𝑙</ci></apply><ci id="S3.Ex1.m1.1.1.3.3.cmml" xref="S3.Ex1.m1.1.1.3.3">𝑃𝑟𝑒𝑓𝑖𝑙𝑙</ci><ci id="S3.Ex1.m1.1.1.3.4.cmml" xref="S3.Ex1.m1.1.1.3.4">𝐿𝑎𝑡𝑒𝑛𝑐𝑦</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex1.m1.1c">\displaystyle\mathit{Prefill\ Latency}=\mathit{Miss\ Rate}\times\mathit{Full\ %
Prefill\ Latency}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex1.m1.1d">italic_Prefill italic_Latency = italic_Miss italic_Rate × italic_Full italic_Prefill italic_Latency</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S3.Ex2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle+\mathit{(1-Miss\ Rate)}\times\mathit{Cache\ Hit\ Latency}" class="ltx_Math" display="inline" id="S3.Ex2.m1.1"><semantics id="S3.Ex2.m1.1a"><mrow id="S3.Ex2.m1.1.1" xref="S3.Ex2.m1.1.1.cmml"><mo id="S3.Ex2.m1.1.1a" xref="S3.Ex2.m1.1.1.cmml">+</mo><mrow id="S3.Ex2.m1.1.1.1" xref="S3.Ex2.m1.1.1.1.cmml"><mrow id="S3.Ex2.m1.1.1.1.1" xref="S3.Ex2.m1.1.1.1.1.cmml"><mrow id="S3.Ex2.m1.1.1.1.1.1.1" xref="S3.Ex2.m1.1.1.1.1.1.1.1.cmml"><mo id="S3.Ex2.m1.1.1.1.1.1.1.2" stretchy="false" xref="S3.Ex2.m1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.Ex2.m1.1.1.1.1.1.1.1" xref="S3.Ex2.m1.1.1.1.1.1.1.1.cmml"><mn class="ltx_mathvariant_italic" id="S3.Ex2.m1.1.1.1.1.1.1.1.2" mathvariant="italic" xref="S3.Ex2.m1.1.1.1.1.1.1.1.2.cmml">1</mn><mo id="S3.Ex2.m1.1.1.1.1.1.1.1.1" xref="S3.Ex2.m1.1.1.1.1.1.1.1.1.cmml">−</mo><mrow id="S3.Ex2.m1.1.1.1.1.1.1.1.3" xref="S3.Ex2.m1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.Ex2.m1.1.1.1.1.1.1.1.3.2" xref="S3.Ex2.m1.1.1.1.1.1.1.1.3.2.cmml">𝑀𝑖𝑠𝑠</mi><mo id="S3.Ex2.m1.1.1.1.1.1.1.1.3.1" lspace="0.500em" xref="S3.Ex2.m1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex2.m1.1.1.1.1.1.1.1.3.3" xref="S3.Ex2.m1.1.1.1.1.1.1.1.3.3.cmml">𝑅𝑎𝑡𝑒</mi></mrow></mrow><mo id="S3.Ex2.m1.1.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S3.Ex2.m1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.Ex2.m1.1.1.1.1.2" rspace="0.222em" xref="S3.Ex2.m1.1.1.1.1.2.cmml">×</mo><mi id="S3.Ex2.m1.1.1.1.1.3" xref="S3.Ex2.m1.1.1.1.1.3.cmml">𝐶𝑎𝑐ℎ𝑒</mi></mrow><mo id="S3.Ex2.m1.1.1.1.2" lspace="0.500em" xref="S3.Ex2.m1.1.1.1.2.cmml">⁢</mo><mi id="S3.Ex2.m1.1.1.1.3" xref="S3.Ex2.m1.1.1.1.3.cmml">𝐻𝑖𝑡</mi><mo id="S3.Ex2.m1.1.1.1.2a" lspace="0.500em" xref="S3.Ex2.m1.1.1.1.2.cmml">⁢</mo><mi id="S3.Ex2.m1.1.1.1.4" xref="S3.Ex2.m1.1.1.1.4.cmml">𝐿𝑎𝑡𝑒𝑛𝑐𝑦</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex2.m1.1b"><apply id="S3.Ex2.m1.1.1.cmml" xref="S3.Ex2.m1.1.1"><plus id="S3.Ex2.m1.1.1.2.cmml" xref="S3.Ex2.m1.1.1"></plus><apply id="S3.Ex2.m1.1.1.1.cmml" xref="S3.Ex2.m1.1.1.1"><times id="S3.Ex2.m1.1.1.1.2.cmml" xref="S3.Ex2.m1.1.1.1.2"></times><apply id="S3.Ex2.m1.1.1.1.1.cmml" xref="S3.Ex2.m1.1.1.1.1"><times id="S3.Ex2.m1.1.1.1.1.2.cmml" xref="S3.Ex2.m1.1.1.1.1.2"></times><apply id="S3.Ex2.m1.1.1.1.1.1.1.1.cmml" xref="S3.Ex2.m1.1.1.1.1.1.1"><minus id="S3.Ex2.m1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex2.m1.1.1.1.1.1.1.1.1"></minus><cn id="S3.Ex2.m1.1.1.1.1.1.1.1.2.cmml" type="integer" xref="S3.Ex2.m1.1.1.1.1.1.1.1.2">1</cn><apply id="S3.Ex2.m1.1.1.1.1.1.1.1.3.cmml" xref="S3.Ex2.m1.1.1.1.1.1.1.1.3"><times id="S3.Ex2.m1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.Ex2.m1.1.1.1.1.1.1.1.3.1"></times><ci id="S3.Ex2.m1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.Ex2.m1.1.1.1.1.1.1.1.3.2">𝑀𝑖𝑠𝑠</ci><ci id="S3.Ex2.m1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.Ex2.m1.1.1.1.1.1.1.1.3.3">𝑅𝑎𝑡𝑒</ci></apply></apply><ci id="S3.Ex2.m1.1.1.1.1.3.cmml" xref="S3.Ex2.m1.1.1.1.1.3">𝐶𝑎𝑐ℎ𝑒</ci></apply><ci id="S3.Ex2.m1.1.1.1.3.cmml" xref="S3.Ex2.m1.1.1.1.3">𝐻𝑖𝑡</ci><ci id="S3.Ex2.m1.1.1.1.4.cmml" xref="S3.Ex2.m1.1.1.1.4">𝐿𝑎𝑡𝑒𝑛𝑐𝑦</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex2.m1.1c">\displaystyle+\mathit{(1-Miss\ Rate)}\times\mathit{Cache\ Hit\ Latency}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex2.m1.1d">+ ( italic_1 - italic_Miss italic_Rate ) × italic_Cache italic_Hit italic_Latency</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p1.8">To explore caching’s optimization opportunity, we consider three crucial factors:
full prefill computation, cache hit, and miss rate.</p>
</div>
<figure class="ltx_figure" id="S3.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_missing ltx_missing_image" id="S3.F4.g1" src=""/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F4.2.1.1" style="font-size:90%;">Figure 4</span>. </span><span class="ltx_text" id="S3.F4.3.2" style="font-size:90%;">Prefill latency characterization.</span></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.1"><span class="ltx_text ltx_font_bold" id="S3.SS2.p2.1.1">Full prefill computation.</span>
To quantify the full computation, we compare the LLM prefill phase’s latency with and without
caching these partial intermediate states (i.e., the key-value cache of prefixes).
We set the original request length to 32 tokens and vary the prefix length from 128 to 4096 tokens.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.F4" title="Figure 4 ‣ 3.2. Optimizations Opportunities ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">4</span></a>
illustrates that the prefill latency is significantly
reduced when caching is employed.
In the scenario of cached prefix, only the request tokens’ key-value tensors are computed.
Conversely, in the scenario of full prefill computation, the key-value tensors of the entire sequence need to
be calculated.
The full prefill latency is up to 11.5<math alttext="\times" class="ltx_Math" display="inline" id="S3.SS2.p2.1.m1.1"><semantics id="S3.SS2.p2.1.m1.1a"><mo id="S3.SS2.p2.1.m1.1.1" xref="S3.SS2.p2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b"><times id="S3.SS2.p2.1.m1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.1.m1.1d">×</annotation></semantics></math> lower than that in the cached prefix scenario.
These results underscore the substantial performance
improvement achieved by caching intermediate states of accessed documents.</p>
</div>
<figure class="ltx_figure" id="S3.F5">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_missing ltx_missing_image" id="S3.F5.g1" src=""/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S3.F5.sf1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F5.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S3.F5.sf1.3.2" style="font-size:90%;">MMLU.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S3.F5.sf2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F5.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S3.F5.sf2.3.2" style="font-size:90%;">Google Natural Questions.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S3.F5.sf3">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F5.sf3.2.1.1" style="font-size:90%;">(c)</span> </span><span class="ltx_text" id="S3.F5.sf3.3.2" style="font-size:90%;">HotpotQA.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S3.F5.sf4">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F5.sf4.2.1.1" style="font-size:90%;">(d)</span> </span><span class="ltx_text" id="S3.F5.sf4.3.2" style="font-size:90%;">TriviaQA.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F5.2.1.1" style="font-size:90%;">Figure 5</span>. </span><span class="ltx_text" id="S3.F5.3.2" style="font-size:90%;">Retrieval pattern on different datasets.</span></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S3.SS2.p3">
<p class="ltx_p" id="S3.SS2.p3.1"><span class="ltx_text ltx_font_bold" id="S3.SS2.p3.1.1">Cache hit.</span>
The cache hit comprises two components: prefill computation of the request tokens and
loading the key-value cache of the retrieved documents.
The former is negligible compared to miss penalty.
As for the latter one, the limited GPU memory contrasts sharply with the substantial size
of the key-value cache from retrieved documents.
This discrepancy necessitates leveraging the host memory to extend
the caching system, accommodating a greater volume of documents.
However, this introduces a potential overhead: the transmission
of key-value cache between the GPU and host memory.
To assess this, we conduct an evaluation of the transmission
overhead. Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.F4" title="Figure 4 ‣ 3.2. Optimizations Opportunities ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">4</span></a> adds the KV cache transmission time with the
given prefix length to the prefill time with cached prefix, representing the cache hit latency.
Even with the transmission overhead, the cache hit latency
is significantly better (up to 3.9<math alttext="\times" class="ltx_Math" display="inline" id="S3.SS2.p3.1.m1.1"><semantics id="S3.SS2.p3.1.m1.1a"><mo id="S3.SS2.p3.1.m1.1.1" xref="S3.SS2.p3.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.1.m1.1b"><times id="S3.SS2.p3.1.m1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.1.m1.1d">×</annotation></semantics></math> lower) than the full prefill latency, highlighting the advantages of caching
intermediate states of retrieved documents.</p>
</div>
<figure class="ltx_figure" id="S3.F6">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S3.F6.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_missing ltx_missing_image" id="S3.F6.sf1.g1" src=""/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F6.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S3.F6.sf1.3.2" style="font-size:90%;">Different embedding models.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S3.F6.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_missing ltx_missing_image" id="S3.F6.sf2.g1" src=""/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F6.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S3.F6.sf2.3.2" style="font-size:90%;">Different ANN indexes.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S3.F6.2.1.1" style="font-size:90%;">Figure 6</span>. </span><span class="ltx_text" id="S3.F6.3.2" style="font-size:90%;">Retrieval pattern under different settings.</span></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S3.SS2.p4">
<p class="ltx_p" id="S3.SS2.p4.2"><span class="ltx_text ltx_font_bold" id="S3.SS2.p4.2.1">Miss rate.</span>
The final consideration lies in the retrieval pattern of RAG systems. The cache performance
is dominated by the miss rate, which is directly influenced by the retrieval pattern.
For example, a 100% cache miss rate occurs when each request retrieves a unique document.
In such a scenario, caching intermediate states of retrieved documents is meaningless.
We analyze the document retrieval pattern in four representative question-answering
datasets for RAG: MMLU <cite class="ltx_cite ltx_citemacro_citep">(Hendrycks et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib19" title="">2020</a>)</cite>, Google Natural Questions <cite class="ltx_cite ltx_citemacro_citep">(Kwiatkowski
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib26" title="">2019</a>)</cite>,
HotpotQA <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib48" title="">2018</a>)</cite>, and TriviaQA <cite class="ltx_cite ltx_citemacro_citep">(Joshi
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib24" title="">2017</a>)</cite>.
We convert the documents on Wikipedia to vectors through <span class="ltx_text ltx_font_typewriter" id="S3.SS2.p4.2.2">text-embedding-3-small</span> model <cite class="ltx_cite ltx_citemacro_citep">(tex, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib4" title="">2024</a>)</cite>
from OpenAI <cite class="ltx_cite ltx_citemacro_citep">(ope, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib3" title="">2024</a>)</cite> for retrieval.
The number of documents referred by one request is top-<math alttext="1" class="ltx_Math" display="inline" id="S3.SS2.p4.1.m1.1"><semantics id="S3.SS2.p4.1.m1.1a"><mn id="S3.SS2.p4.1.m1.1.1" xref="S3.SS2.p4.1.m1.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.1.m1.1b"><cn id="S3.SS2.p4.1.m1.1.1.cmml" type="integer" xref="S3.SS2.p4.1.m1.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.1.m1.1c">1</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p4.1.m1.1d">1</annotation></semantics></math>. The ANN index is FlatL2, i.e.,
exact search on the entire dataset with Euclidean distance.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.F5" title="Figure 5 ‣ 3.2. Optimizations Opportunities ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">5</span></a> shows the CDF of the accessed documents.
We observe that the retrieval pattern is skewed, with a small fraction of documents
accounting for the majority of retrieval requests. For example, the top 3% documents
are referred to by 60% requests in the MMLU dataset,
which is 20<math alttext="\times" class="ltx_Math" display="inline" id="S3.SS2.p4.2.m2.1"><semantics id="S3.SS2.p4.2.m2.1a"><mo id="S3.SS2.p4.2.m2.1.1" xref="S3.SS2.p4.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.2.m2.1b"><times id="S3.SS2.p4.2.m2.1.1.cmml" xref="S3.SS2.p4.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p4.2.m2.1d">×</annotation></semantics></math> less than the uniform distribution.
This observation reveals a low miss rate to cache the frequently accessed documents.</p>
</div>
<div class="ltx_para" id="S3.SS2.p5">
<p class="ltx_p" id="S3.SS2.p5.1">Further analysis on additional embedding models and ANN indexes for vector search is shown in
Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.F6" title="Figure 6 ‣ 3.2. Optimizations Opportunities ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">6</span></a>.
All of the results exhibit a similar retrieval pattern no matter which embedding model or ANN index is used.
The results are consistent with FlatL2 index, which indicates the potential for caching optimization under different settings.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4. </span>RAGCache Overview</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">We present RAGCache, a novel multilevel dynamic caching system tailored for
RAG. RAGCache caches the key-value tensors of retrieved documents across multiple
requests to minimize redundant computation.
The core of RAGCache is a knowledge tree with a prefix-aware
Greedy Dual-Size Frequency (PGDSF) replacement policy that ensures caching the most critical key-value tensors.
RAGCache also implements a global RAG controller that orchestrates interactions between the external knowledge database and LLM inference engine.
The controller is enhanced by system optimizations including cache-aware reordering and dynamic speculative pipelining.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.p2">
<p class="ltx_p" id="S4.p2.1"><span class="ltx_text ltx_font_bold" id="S4.p2.1.1">Architecture overview.</span>
We provide a brief overview of RAGCache in Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S4.F7" title="Figure 7 ‣ 4. RAGCache Overview ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">7</span></a>.
When a request arrives, the RAG controller first retrieves the relevant documents from the external knowledge database.
These documents are then forwarded to the cache retriever to locate matching key-value tensors.
If the key-value tensors are absent from the cache, RAGCache directs the LLM inference engine to produce new tokens.
Conversely, if the tensors are available, the request with the key-value tensors are forwarded
to the LLM inference engine, which then employs a prefix caching kernel for token generation.
After generating the first token, the key-value tensors are relayed back to the RAG controller,
which caches the tensors from the accessed documents and refreshes the cache’s status.
Finally, the generated answer is delivered to the user as the response.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.p3">
<p class="ltx_p" id="S4.p3.1"><span class="ltx_text ltx_font_bold" id="S4.p3.1.1">Cache retriever.</span>
The cache retriever efficiently locates the key-value tensors for documents
stored in the in-memory cache, utilizing a knowledge tree to organize these tensors.
This tree, structured as a prefix tree based on document IDs, aligns with the LLM’s
position sensitivity to the document order. Each path within this tree represents one
specific sequence of documents referenced by a request, with each node holding the key-value tensor
of a referred document.
Different paths may share the same nodes, which indicates the shared documents across different requests.
This structure enables the retriever to swiftly access the key-value tensors of documents in their specified order.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.p4">
<p class="ltx_p" id="S4.p4.1"><span class="ltx_text ltx_font_bold" id="S4.p4.1.1">RAG controller.</span>
The RAG controller orchestrates the interactions with some system optimizations tailored for RAG.
Prefix-aware Greedy Dual-Size Frequency (PGDSF) policy is employed to minimize the cache miss rate.
PGDSF calculates a priority based on the frequency, size of key-value tensors, last access time, and
prefix-aware recomputation cost.
The cache eviction is determined by the priority, which ensures the most valuable tensors are retained.
Cache-aware reordering schedules the requests to improve cache hit rate and prevent thrashing,
while also ensuring request fairness to mitigate starvation issues.
Dynamic speculative pipelining is designed to overlap the knowledge retrieval and LLM inference to minimize
the latency. This optimization leverages the mid-process generation of retrieval results to initiate LLM inference
early.</p>
</div>
<figure class="ltx_figure" id="S4.F7"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_missing ltx_missing_image" id="S4.F7.g1" src=""/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F7.2.1.1" style="font-size:90%;">Figure 7</span>. </span><span class="ltx_text" id="S4.F7.3.2" style="font-size:90%;">RAGCache overview.</span></figcaption>
</figure>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5. </span>RAGCache Design</h2>
<div class="ltx_para" id="S5.p1">
<p class="ltx_p" id="S5.p1.1">In this section, we present the design of RAGCache. We first introduce the cache structure and the
prefix-aware replacement policy (§<a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.SS1" title="5.1. Cache Structure and Replacement Policy ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">5.1</span></a>). Then, we describe the
cache-aware reordering strategy to improve the cache hit rate (§<a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.SS2" title="5.2. Cache-aware Reordering ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">5.2</span></a>).
Finally, we present the dynamic speculative pipelining approach to overlap
knowledge retrieval and LLM inference (§<a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.SS3" title="5.3. Dynamic Speculative Pipelining ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">5.3</span></a>).</p>
</div>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1. </span>Cache Structure and Replacement Policy</h3>
<div class="ltx_para" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.7">Different from traditional cache systems that cache individual objects, RAGCache caches
the key-value tensors of the retrieved documents that are sensitive to the referred order.
For example, consider two document sequences: <math alttext="[D_{1},D_{3}]" class="ltx_Math" display="inline" id="S5.SS1.p1.1.m1.2"><semantics id="S5.SS1.p1.1.m1.2a"><mrow id="S5.SS1.p1.1.m1.2.2.2" xref="S5.SS1.p1.1.m1.2.2.3.cmml"><mo id="S5.SS1.p1.1.m1.2.2.2.3" stretchy="false" xref="S5.SS1.p1.1.m1.2.2.3.cmml">[</mo><msub id="S5.SS1.p1.1.m1.1.1.1.1" xref="S5.SS1.p1.1.m1.1.1.1.1.cmml"><mi id="S5.SS1.p1.1.m1.1.1.1.1.2" xref="S5.SS1.p1.1.m1.1.1.1.1.2.cmml">D</mi><mn id="S5.SS1.p1.1.m1.1.1.1.1.3" xref="S5.SS1.p1.1.m1.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS1.p1.1.m1.2.2.2.4" xref="S5.SS1.p1.1.m1.2.2.3.cmml">,</mo><msub id="S5.SS1.p1.1.m1.2.2.2.2" xref="S5.SS1.p1.1.m1.2.2.2.2.cmml"><mi id="S5.SS1.p1.1.m1.2.2.2.2.2" xref="S5.SS1.p1.1.m1.2.2.2.2.2.cmml">D</mi><mn id="S5.SS1.p1.1.m1.2.2.2.2.3" xref="S5.SS1.p1.1.m1.2.2.2.2.3.cmml">3</mn></msub><mo id="S5.SS1.p1.1.m1.2.2.2.5" stretchy="false" xref="S5.SS1.p1.1.m1.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.1.m1.2b"><interval closure="closed" id="S5.SS1.p1.1.m1.2.2.3.cmml" xref="S5.SS1.p1.1.m1.2.2.2"><apply id="S5.SS1.p1.1.m1.1.1.1.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.1.1.1.1.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1">subscript</csymbol><ci id="S5.SS1.p1.1.m1.1.1.1.1.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.2">𝐷</ci><cn id="S5.SS1.p1.1.m1.1.1.1.1.3.cmml" type="integer" xref="S5.SS1.p1.1.m1.1.1.1.1.3">1</cn></apply><apply id="S5.SS1.p1.1.m1.2.2.2.2.cmml" xref="S5.SS1.p1.1.m1.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.2.2.2.2.1.cmml" xref="S5.SS1.p1.1.m1.2.2.2.2">subscript</csymbol><ci id="S5.SS1.p1.1.m1.2.2.2.2.2.cmml" xref="S5.SS1.p1.1.m1.2.2.2.2.2">𝐷</ci><cn id="S5.SS1.p1.1.m1.2.2.2.2.3.cmml" type="integer" xref="S5.SS1.p1.1.m1.2.2.2.2.3">3</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.1.m1.2c">[D_{1},D_{3}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.1.m1.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT ]</annotation></semantics></math> with key-value tensors <math alttext="KV" class="ltx_Math" display="inline" id="S5.SS1.p1.2.m2.1"><semantics id="S5.SS1.p1.2.m2.1a"><mrow id="S5.SS1.p1.2.m2.1.1" xref="S5.SS1.p1.2.m2.1.1.cmml"><mi id="S5.SS1.p1.2.m2.1.1.2" xref="S5.SS1.p1.2.m2.1.1.2.cmml">K</mi><mo id="S5.SS1.p1.2.m2.1.1.1" xref="S5.SS1.p1.2.m2.1.1.1.cmml">⁢</mo><mi id="S5.SS1.p1.2.m2.1.1.3" xref="S5.SS1.p1.2.m2.1.1.3.cmml">V</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.2.m2.1b"><apply id="S5.SS1.p1.2.m2.1.1.cmml" xref="S5.SS1.p1.2.m2.1.1"><times id="S5.SS1.p1.2.m2.1.1.1.cmml" xref="S5.SS1.p1.2.m2.1.1.1"></times><ci id="S5.SS1.p1.2.m2.1.1.2.cmml" xref="S5.SS1.p1.2.m2.1.1.2">𝐾</ci><ci id="S5.SS1.p1.2.m2.1.1.3.cmml" xref="S5.SS1.p1.2.m2.1.1.3">𝑉</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.2.m2.1c">KV</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.2.m2.1d">italic_K italic_V</annotation></semantics></math> and <math alttext="[D_{2},D_{3}]" class="ltx_Math" display="inline" id="S5.SS1.p1.3.m3.2"><semantics id="S5.SS1.p1.3.m3.2a"><mrow id="S5.SS1.p1.3.m3.2.2.2" xref="S5.SS1.p1.3.m3.2.2.3.cmml"><mo id="S5.SS1.p1.3.m3.2.2.2.3" stretchy="false" xref="S5.SS1.p1.3.m3.2.2.3.cmml">[</mo><msub id="S5.SS1.p1.3.m3.1.1.1.1" xref="S5.SS1.p1.3.m3.1.1.1.1.cmml"><mi id="S5.SS1.p1.3.m3.1.1.1.1.2" xref="S5.SS1.p1.3.m3.1.1.1.1.2.cmml">D</mi><mn id="S5.SS1.p1.3.m3.1.1.1.1.3" xref="S5.SS1.p1.3.m3.1.1.1.1.3.cmml">2</mn></msub><mo id="S5.SS1.p1.3.m3.2.2.2.4" xref="S5.SS1.p1.3.m3.2.2.3.cmml">,</mo><msub id="S5.SS1.p1.3.m3.2.2.2.2" xref="S5.SS1.p1.3.m3.2.2.2.2.cmml"><mi id="S5.SS1.p1.3.m3.2.2.2.2.2" xref="S5.SS1.p1.3.m3.2.2.2.2.2.cmml">D</mi><mn id="S5.SS1.p1.3.m3.2.2.2.2.3" xref="S5.SS1.p1.3.m3.2.2.2.2.3.cmml">3</mn></msub><mo id="S5.SS1.p1.3.m3.2.2.2.5" stretchy="false" xref="S5.SS1.p1.3.m3.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.3.m3.2b"><interval closure="closed" id="S5.SS1.p1.3.m3.2.2.3.cmml" xref="S5.SS1.p1.3.m3.2.2.2"><apply id="S5.SS1.p1.3.m3.1.1.1.1.cmml" xref="S5.SS1.p1.3.m3.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS1.p1.3.m3.1.1.1.1.1.cmml" xref="S5.SS1.p1.3.m3.1.1.1.1">subscript</csymbol><ci id="S5.SS1.p1.3.m3.1.1.1.1.2.cmml" xref="S5.SS1.p1.3.m3.1.1.1.1.2">𝐷</ci><cn id="S5.SS1.p1.3.m3.1.1.1.1.3.cmml" type="integer" xref="S5.SS1.p1.3.m3.1.1.1.1.3">2</cn></apply><apply id="S5.SS1.p1.3.m3.2.2.2.2.cmml" xref="S5.SS1.p1.3.m3.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS1.p1.3.m3.2.2.2.2.1.cmml" xref="S5.SS1.p1.3.m3.2.2.2.2">subscript</csymbol><ci id="S5.SS1.p1.3.m3.2.2.2.2.2.cmml" xref="S5.SS1.p1.3.m3.2.2.2.2.2">𝐷</ci><cn id="S5.SS1.p1.3.m3.2.2.2.2.3.cmml" type="integer" xref="S5.SS1.p1.3.m3.2.2.2.2.3">3</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.3.m3.2c">[D_{2},D_{3}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.3.m3.2d">[ italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT ]</annotation></semantics></math> with <math alttext="KV^{\prime}" class="ltx_Math" display="inline" id="S5.SS1.p1.4.m4.1"><semantics id="S5.SS1.p1.4.m4.1a"><mrow id="S5.SS1.p1.4.m4.1.1" xref="S5.SS1.p1.4.m4.1.1.cmml"><mi id="S5.SS1.p1.4.m4.1.1.2" xref="S5.SS1.p1.4.m4.1.1.2.cmml">K</mi><mo id="S5.SS1.p1.4.m4.1.1.1" xref="S5.SS1.p1.4.m4.1.1.1.cmml">⁢</mo><msup id="S5.SS1.p1.4.m4.1.1.3" xref="S5.SS1.p1.4.m4.1.1.3.cmml"><mi id="S5.SS1.p1.4.m4.1.1.3.2" xref="S5.SS1.p1.4.m4.1.1.3.2.cmml">V</mi><mo id="S5.SS1.p1.4.m4.1.1.3.3" xref="S5.SS1.p1.4.m4.1.1.3.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.4.m4.1b"><apply id="S5.SS1.p1.4.m4.1.1.cmml" xref="S5.SS1.p1.4.m4.1.1"><times id="S5.SS1.p1.4.m4.1.1.1.cmml" xref="S5.SS1.p1.4.m4.1.1.1"></times><ci id="S5.SS1.p1.4.m4.1.1.2.cmml" xref="S5.SS1.p1.4.m4.1.1.2">𝐾</ci><apply id="S5.SS1.p1.4.m4.1.1.3.cmml" xref="S5.SS1.p1.4.m4.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.p1.4.m4.1.1.3.1.cmml" xref="S5.SS1.p1.4.m4.1.1.3">superscript</csymbol><ci id="S5.SS1.p1.4.m4.1.1.3.2.cmml" xref="S5.SS1.p1.4.m4.1.1.3.2">𝑉</ci><ci id="S5.SS1.p1.4.m4.1.1.3.3.cmml" xref="S5.SS1.p1.4.m4.1.1.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.4.m4.1c">KV^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.4.m4.1d">italic_K italic_V start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>.
Although <math alttext="KV[1]" class="ltx_Math" display="inline" id="S5.SS1.p1.5.m5.1"><semantics id="S5.SS1.p1.5.m5.1a"><mrow id="S5.SS1.p1.5.m5.1.2" xref="S5.SS1.p1.5.m5.1.2.cmml"><mi id="S5.SS1.p1.5.m5.1.2.2" xref="S5.SS1.p1.5.m5.1.2.2.cmml">K</mi><mo id="S5.SS1.p1.5.m5.1.2.1" xref="S5.SS1.p1.5.m5.1.2.1.cmml">⁢</mo><mi id="S5.SS1.p1.5.m5.1.2.3" xref="S5.SS1.p1.5.m5.1.2.3.cmml">V</mi><mo id="S5.SS1.p1.5.m5.1.2.1a" xref="S5.SS1.p1.5.m5.1.2.1.cmml">⁢</mo><mrow id="S5.SS1.p1.5.m5.1.2.4.2" xref="S5.SS1.p1.5.m5.1.2.4.1.cmml"><mo id="S5.SS1.p1.5.m5.1.2.4.2.1" stretchy="false" xref="S5.SS1.p1.5.m5.1.2.4.1.1.cmml">[</mo><mn id="S5.SS1.p1.5.m5.1.1" xref="S5.SS1.p1.5.m5.1.1.cmml">1</mn><mo id="S5.SS1.p1.5.m5.1.2.4.2.2" stretchy="false" xref="S5.SS1.p1.5.m5.1.2.4.1.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.5.m5.1b"><apply id="S5.SS1.p1.5.m5.1.2.cmml" xref="S5.SS1.p1.5.m5.1.2"><times id="S5.SS1.p1.5.m5.1.2.1.cmml" xref="S5.SS1.p1.5.m5.1.2.1"></times><ci id="S5.SS1.p1.5.m5.1.2.2.cmml" xref="S5.SS1.p1.5.m5.1.2.2">𝐾</ci><ci id="S5.SS1.p1.5.m5.1.2.3.cmml" xref="S5.SS1.p1.5.m5.1.2.3">𝑉</ci><apply id="S5.SS1.p1.5.m5.1.2.4.1.cmml" xref="S5.SS1.p1.5.m5.1.2.4.2"><csymbol cd="latexml" id="S5.SS1.p1.5.m5.1.2.4.1.1.cmml" xref="S5.SS1.p1.5.m5.1.2.4.2.1">delimited-[]</csymbol><cn id="S5.SS1.p1.5.m5.1.1.cmml" type="integer" xref="S5.SS1.p1.5.m5.1.1">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.5.m5.1c">KV[1]</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.5.m5.1d">italic_K italic_V [ 1 ]</annotation></semantics></math> and <math alttext="KV^{\prime}[1]" class="ltx_Math" display="inline" id="S5.SS1.p1.6.m6.1"><semantics id="S5.SS1.p1.6.m6.1a"><mrow id="S5.SS1.p1.6.m6.1.2" xref="S5.SS1.p1.6.m6.1.2.cmml"><mi id="S5.SS1.p1.6.m6.1.2.2" xref="S5.SS1.p1.6.m6.1.2.2.cmml">K</mi><mo id="S5.SS1.p1.6.m6.1.2.1" xref="S5.SS1.p1.6.m6.1.2.1.cmml">⁢</mo><msup id="S5.SS1.p1.6.m6.1.2.3" xref="S5.SS1.p1.6.m6.1.2.3.cmml"><mi id="S5.SS1.p1.6.m6.1.2.3.2" xref="S5.SS1.p1.6.m6.1.2.3.2.cmml">V</mi><mo id="S5.SS1.p1.6.m6.1.2.3.3" xref="S5.SS1.p1.6.m6.1.2.3.3.cmml">′</mo></msup><mo id="S5.SS1.p1.6.m6.1.2.1a" xref="S5.SS1.p1.6.m6.1.2.1.cmml">⁢</mo><mrow id="S5.SS1.p1.6.m6.1.2.4.2" xref="S5.SS1.p1.6.m6.1.2.4.1.cmml"><mo id="S5.SS1.p1.6.m6.1.2.4.2.1" stretchy="false" xref="S5.SS1.p1.6.m6.1.2.4.1.1.cmml">[</mo><mn id="S5.SS1.p1.6.m6.1.1" xref="S5.SS1.p1.6.m6.1.1.cmml">1</mn><mo id="S5.SS1.p1.6.m6.1.2.4.2.2" stretchy="false" xref="S5.SS1.p1.6.m6.1.2.4.1.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.6.m6.1b"><apply id="S5.SS1.p1.6.m6.1.2.cmml" xref="S5.SS1.p1.6.m6.1.2"><times id="S5.SS1.p1.6.m6.1.2.1.cmml" xref="S5.SS1.p1.6.m6.1.2.1"></times><ci id="S5.SS1.p1.6.m6.1.2.2.cmml" xref="S5.SS1.p1.6.m6.1.2.2">𝐾</ci><apply id="S5.SS1.p1.6.m6.1.2.3.cmml" xref="S5.SS1.p1.6.m6.1.2.3"><csymbol cd="ambiguous" id="S5.SS1.p1.6.m6.1.2.3.1.cmml" xref="S5.SS1.p1.6.m6.1.2.3">superscript</csymbol><ci id="S5.SS1.p1.6.m6.1.2.3.2.cmml" xref="S5.SS1.p1.6.m6.1.2.3.2">𝑉</ci><ci id="S5.SS1.p1.6.m6.1.2.3.3.cmml" xref="S5.SS1.p1.6.m6.1.2.3.3">′</ci></apply><apply id="S5.SS1.p1.6.m6.1.2.4.1.cmml" xref="S5.SS1.p1.6.m6.1.2.4.2"><csymbol cd="latexml" id="S5.SS1.p1.6.m6.1.2.4.1.1.cmml" xref="S5.SS1.p1.6.m6.1.2.4.2.1">delimited-[]</csymbol><cn id="S5.SS1.p1.6.m6.1.1.cmml" type="integer" xref="S5.SS1.p1.6.m6.1.1">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.6.m6.1c">KV^{\prime}[1]</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.6.m6.1d">italic_K italic_V start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT [ 1 ]</annotation></semantics></math> both pertain to <math alttext="D_{3}" class="ltx_Math" display="inline" id="S5.SS1.p1.7.m7.1"><semantics id="S5.SS1.p1.7.m7.1a"><msub id="S5.SS1.p1.7.m7.1.1" xref="S5.SS1.p1.7.m7.1.1.cmml"><mi id="S5.SS1.p1.7.m7.1.1.2" xref="S5.SS1.p1.7.m7.1.1.2.cmml">D</mi><mn id="S5.SS1.p1.7.m7.1.1.3" xref="S5.SS1.p1.7.m7.1.1.3.cmml">3</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.7.m7.1b"><apply id="S5.SS1.p1.7.m7.1.1.cmml" xref="S5.SS1.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S5.SS1.p1.7.m7.1.1.1.cmml" xref="S5.SS1.p1.7.m7.1.1">subscript</csymbol><ci id="S5.SS1.p1.7.m7.1.1.2.cmml" xref="S5.SS1.p1.7.m7.1.1.2">𝐷</ci><cn id="S5.SS1.p1.7.m7.1.1.3.cmml" type="integer" xref="S5.SS1.p1.7.m7.1.1.3">3</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.7.m7.1c">D_{3}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.7.m7.1d">italic_D start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT</annotation></semantics></math>,
they are different in values. This discrepancy arises because the key-value tensor
for a given token is generated based on the preceding tokens,
underscoring the order-dependence of key-value tensors.</p>
</div>
<figure class="ltx_figure" id="S5.F8"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_missing ltx_missing_image" id="S5.F8.g1" src=""/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F8.2.1.1" style="font-size:90%;">Figure 8</span>. </span><span class="ltx_text" id="S5.F8.3.2" style="font-size:90%;">Knowledge tree.</span></figcaption>
</figure>
<div class="ltx_para" id="S5.SS1.p2">
<p class="ltx_p" id="S5.SS1.p2.1">To facilitate fast retrieval while maintaining the document order, RAGCache structures the documents’ key-value tensors
with a knowledge tree, as depicted in Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.F8" title="Figure 8 ‣ 5.1. Cache Structure and Replacement Policy ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">8</span></a>.
This tree assigns each document to a node, which refers to the memory addresses of the
document’s key-value tensors. Following vLLM <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>)</cite>, RAGCache stores
the key-value tensors in non-continuous memory blocks for KV cache reuse.
The root node <math alttext="S" class="ltx_Math" display="inline" id="S5.SS1.p2.1.m1.1"><semantics id="S5.SS1.p2.1.m1.1a"><mi id="S5.SS1.p2.1.m1.1.1" xref="S5.SS1.p2.1.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p2.1.m1.1b"><ci id="S5.SS1.p2.1.m1.1.1.cmml" xref="S5.SS1.p2.1.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p2.1.m1.1c">S</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p2.1.m1.1d">italic_S</annotation></semantics></math> denotes the shared system prompt.
A path from the root to a particular node represents a sequence of documents.</p>
</div>
<div class="ltx_para" id="S5.SS1.p3">
<p class="ltx_p" id="S5.SS1.p3.2">This design inherently allows RAGCache to serve multiple requests simultaneously through overlapping paths in the
tree. RAGCache retrieves tensors by prefix matching along these paths. During the prefix matching process,
if a subsequent document is not located among the child nodes, the traversal is promptly terminated,
and the identified document sequence is returned.
This method ensures efficiency with a time complexity of <math alttext="O(h)" class="ltx_Math" display="inline" id="S5.SS1.p3.1.m1.1"><semantics id="S5.SS1.p3.1.m1.1a"><mrow id="S5.SS1.p3.1.m1.1.2" xref="S5.SS1.p3.1.m1.1.2.cmml"><mi id="S5.SS1.p3.1.m1.1.2.2" xref="S5.SS1.p3.1.m1.1.2.2.cmml">O</mi><mo id="S5.SS1.p3.1.m1.1.2.1" xref="S5.SS1.p3.1.m1.1.2.1.cmml">⁢</mo><mrow id="S5.SS1.p3.1.m1.1.2.3.2" xref="S5.SS1.p3.1.m1.1.2.cmml"><mo id="S5.SS1.p3.1.m1.1.2.3.2.1" stretchy="false" xref="S5.SS1.p3.1.m1.1.2.cmml">(</mo><mi id="S5.SS1.p3.1.m1.1.1" xref="S5.SS1.p3.1.m1.1.1.cmml">h</mi><mo id="S5.SS1.p3.1.m1.1.2.3.2.2" stretchy="false" xref="S5.SS1.p3.1.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p3.1.m1.1b"><apply id="S5.SS1.p3.1.m1.1.2.cmml" xref="S5.SS1.p3.1.m1.1.2"><times id="S5.SS1.p3.1.m1.1.2.1.cmml" xref="S5.SS1.p3.1.m1.1.2.1"></times><ci id="S5.SS1.p3.1.m1.1.2.2.cmml" xref="S5.SS1.p3.1.m1.1.2.2">𝑂</ci><ci id="S5.SS1.p3.1.m1.1.1.cmml" xref="S5.SS1.p3.1.m1.1.1">ℎ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p3.1.m1.1c">O(h)</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p3.1.m1.1d">italic_O ( italic_h )</annotation></semantics></math>, where <math alttext="h" class="ltx_Math" display="inline" id="S5.SS1.p3.2.m2.1"><semantics id="S5.SS1.p3.2.m2.1a"><mi id="S5.SS1.p3.2.m2.1.1" xref="S5.SS1.p3.2.m2.1.1.cmml">h</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p3.2.m2.1b"><ci id="S5.SS1.p3.2.m2.1.1.cmml" xref="S5.SS1.p3.2.m2.1.1">ℎ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p3.2.m2.1c">h</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p3.2.m2.1d">italic_h</annotation></semantics></math> represents the tree’s height.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS1.p4">
<p class="ltx_p" id="S5.SS1.p4.6"><span class="ltx_text ltx_font_bold" id="S5.SS1.p4.6.1">Prefix-aware Greedy-Dual-Size-Frequency (PGDSF) replacement policy.</span>
With the knowledge tree, RAGCache has to decide each node’s placement within a hierarchical cache.
Nodes that are accessed more frequently are ideally stored in GPU memory for faster access speeds,
while those accessed less often are allocated to the slower host memory or simply freed.
To optimize node placement, RAGCache employs a prefix-aware Greedy-Dual-Size-Frequency (PGDSF) replacement policy,
which is based on the classic GDSF policy <cite class="ltx_cite ltx_citemacro_citep">(Cherkasova, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib13" title="">1998</a>)</cite>.
Unlike traditional caching strategies such as LRU, which neglect the variable sizes of documents,
PGDSF evaluates each node based on its access frequency, size, and access cost.
This method utilizes limited storage capacity by maintaining the most beneficial nodes, whose <em class="ltx_emph ltx_font_italic" id="S5.SS1.p4.6.2">priority</em> is
defined as follows:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S10.EGx2">
<tbody id="S5.E1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(1)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\mathit{Priority}=\mathit{Clock}+\frac{\mathit{Frequency}\times%
\mathit{Cost}}{\mathit{Size}}" class="ltx_Math" display="inline" id="S5.E1.m2.1"><semantics id="S5.E1.m2.1a"><mrow id="S5.E1.m2.1.1" xref="S5.E1.m2.1.1.cmml"><mi id="S5.E1.m2.1.1.2" xref="S5.E1.m2.1.1.2.cmml">𝑃𝑟𝑖𝑜𝑟𝑖𝑡𝑦</mi><mo id="S5.E1.m2.1.1.1" xref="S5.E1.m2.1.1.1.cmml">=</mo><mrow id="S5.E1.m2.1.1.3" xref="S5.E1.m2.1.1.3.cmml"><mi id="S5.E1.m2.1.1.3.2" xref="S5.E1.m2.1.1.3.2.cmml">𝐶𝑙𝑜𝑐𝑘</mi><mo id="S5.E1.m2.1.1.3.1" xref="S5.E1.m2.1.1.3.1.cmml">+</mo><mstyle displaystyle="true" id="S5.E1.m2.1.1.3.3" xref="S5.E1.m2.1.1.3.3.cmml"><mfrac id="S5.E1.m2.1.1.3.3a" xref="S5.E1.m2.1.1.3.3.cmml"><mrow id="S5.E1.m2.1.1.3.3.2" xref="S5.E1.m2.1.1.3.3.2.cmml"><mi id="S5.E1.m2.1.1.3.3.2.2" xref="S5.E1.m2.1.1.3.3.2.2.cmml">𝐹𝑟𝑒𝑞𝑢𝑒𝑛𝑐𝑦</mi><mo id="S5.E1.m2.1.1.3.3.2.1" lspace="0.222em" rspace="0.222em" xref="S5.E1.m2.1.1.3.3.2.1.cmml">×</mo><mi id="S5.E1.m2.1.1.3.3.2.3" xref="S5.E1.m2.1.1.3.3.2.3.cmml">𝐶𝑜𝑠𝑡</mi></mrow><mi id="S5.E1.m2.1.1.3.3.3" xref="S5.E1.m2.1.1.3.3.3.cmml">𝑆𝑖𝑧𝑒</mi></mfrac></mstyle></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.E1.m2.1b"><apply id="S5.E1.m2.1.1.cmml" xref="S5.E1.m2.1.1"><eq id="S5.E1.m2.1.1.1.cmml" xref="S5.E1.m2.1.1.1"></eq><ci id="S5.E1.m2.1.1.2.cmml" xref="S5.E1.m2.1.1.2">𝑃𝑟𝑖𝑜𝑟𝑖𝑡𝑦</ci><apply id="S5.E1.m2.1.1.3.cmml" xref="S5.E1.m2.1.1.3"><plus id="S5.E1.m2.1.1.3.1.cmml" xref="S5.E1.m2.1.1.3.1"></plus><ci id="S5.E1.m2.1.1.3.2.cmml" xref="S5.E1.m2.1.1.3.2">𝐶𝑙𝑜𝑐𝑘</ci><apply id="S5.E1.m2.1.1.3.3.cmml" xref="S5.E1.m2.1.1.3.3"><divide id="S5.E1.m2.1.1.3.3.1.cmml" xref="S5.E1.m2.1.1.3.3"></divide><apply id="S5.E1.m2.1.1.3.3.2.cmml" xref="S5.E1.m2.1.1.3.3.2"><times id="S5.E1.m2.1.1.3.3.2.1.cmml" xref="S5.E1.m2.1.1.3.3.2.1"></times><ci id="S5.E1.m2.1.1.3.3.2.2.cmml" xref="S5.E1.m2.1.1.3.3.2.2">𝐹𝑟𝑒𝑞𝑢𝑒𝑛𝑐𝑦</ci><ci id="S5.E1.m2.1.1.3.3.2.3.cmml" xref="S5.E1.m2.1.1.3.3.2.3">𝐶𝑜𝑠𝑡</ci></apply><ci id="S5.E1.m2.1.1.3.3.3.cmml" xref="S5.E1.m2.1.1.3.3.3">𝑆𝑖𝑧𝑒</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E1.m2.1c">\displaystyle\mathit{Priority}=\mathit{Clock}+\frac{\mathit{Frequency}\times%
\mathit{Cost}}{\mathit{Size}}</annotation><annotation encoding="application/x-llamapun" id="S5.E1.m2.1d">italic_Priority = italic_Clock + divide start_ARG italic_Frequency × italic_Cost end_ARG start_ARG italic_Size end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS1.p4.2">Nodes with lower priority are evicted first.
<math alttext="\mathit{Clock}" class="ltx_Math" display="inline" id="S5.SS1.p4.1.m1.1"><semantics id="S5.SS1.p4.1.m1.1a"><mi id="S5.SS1.p4.1.m1.1.1" xref="S5.SS1.p4.1.m1.1.1.cmml">𝐶𝑙𝑜𝑐𝑘</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p4.1.m1.1b"><ci id="S5.SS1.p4.1.m1.1.1.cmml" xref="S5.SS1.p4.1.m1.1.1">𝐶𝑙𝑜𝑐𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p4.1.m1.1c">\mathit{Clock}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p4.1.m1.1d">italic_Clock</annotation></semantics></math> tracks node access recency.
We maintain two separate logical clocks in the RAG controller for GPU and host memory, respectively,
to adapt to the cache hierarchy. Each clock starts at zero and updates with every eviction. When
a document is retrieved, its node’s clock is set and its priority is adjusted.
Nodes with older clock, indicating less recent use, receive lower priorities.
Let <math alttext="E" class="ltx_Math" display="inline" id="S5.SS1.p4.2.m2.1"><semantics id="S5.SS1.p4.2.m2.1a"><mi id="S5.SS1.p4.2.m2.1.1" xref="S5.SS1.p4.2.m2.1.1.cmml">E</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p4.2.m2.1b"><ci id="S5.SS1.p4.2.m2.1.1.cmml" xref="S5.SS1.p4.2.m2.1.1">𝐸</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p4.2.m2.1c">E</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p4.2.m2.1d">italic_E</annotation></semantics></math> be the set of evicted nodes in one eviction operation. The clock is updated accordingly:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S10.EGx3">
<tbody id="S5.E2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(2)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\mathit{Clock}=\max_{n\in E}\mathit{Priority}(n)" class="ltx_Math" display="inline" id="S5.E2.m2.1"><semantics id="S5.E2.m2.1a"><mrow id="S5.E2.m2.1.2" xref="S5.E2.m2.1.2.cmml"><mi id="S5.E2.m2.1.2.2" xref="S5.E2.m2.1.2.2.cmml">𝐶𝑙𝑜𝑐𝑘</mi><mo id="S5.E2.m2.1.2.1" xref="S5.E2.m2.1.2.1.cmml">=</mo><mrow id="S5.E2.m2.1.2.3" xref="S5.E2.m2.1.2.3.cmml"><mrow id="S5.E2.m2.1.2.3.2" xref="S5.E2.m2.1.2.3.2.cmml"><munder id="S5.E2.m2.1.2.3.2.1" xref="S5.E2.m2.1.2.3.2.1.cmml"><mi id="S5.E2.m2.1.2.3.2.1.2" xref="S5.E2.m2.1.2.3.2.1.2.cmml">max</mi><mrow id="S5.E2.m2.1.2.3.2.1.3" xref="S5.E2.m2.1.2.3.2.1.3.cmml"><mi id="S5.E2.m2.1.2.3.2.1.3.2" xref="S5.E2.m2.1.2.3.2.1.3.2.cmml">n</mi><mo id="S5.E2.m2.1.2.3.2.1.3.1" xref="S5.E2.m2.1.2.3.2.1.3.1.cmml">∈</mo><mi id="S5.E2.m2.1.2.3.2.1.3.3" xref="S5.E2.m2.1.2.3.2.1.3.3.cmml">E</mi></mrow></munder><mo id="S5.E2.m2.1.2.3.2a" lspace="0.167em" xref="S5.E2.m2.1.2.3.2.cmml">⁡</mo><mi id="S5.E2.m2.1.2.3.2.2" xref="S5.E2.m2.1.2.3.2.2.cmml">𝑃𝑟𝑖𝑜𝑟𝑖𝑡𝑦</mi></mrow><mo id="S5.E2.m2.1.2.3.1" xref="S5.E2.m2.1.2.3.1.cmml">⁢</mo><mrow id="S5.E2.m2.1.2.3.3.2" xref="S5.E2.m2.1.2.3.cmml"><mo id="S5.E2.m2.1.2.3.3.2.1" stretchy="false" xref="S5.E2.m2.1.2.3.cmml">(</mo><mi id="S5.E2.m2.1.1" xref="S5.E2.m2.1.1.cmml">n</mi><mo id="S5.E2.m2.1.2.3.3.2.2" stretchy="false" xref="S5.E2.m2.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.E2.m2.1b"><apply id="S5.E2.m2.1.2.cmml" xref="S5.E2.m2.1.2"><eq id="S5.E2.m2.1.2.1.cmml" xref="S5.E2.m2.1.2.1"></eq><ci id="S5.E2.m2.1.2.2.cmml" xref="S5.E2.m2.1.2.2">𝐶𝑙𝑜𝑐𝑘</ci><apply id="S5.E2.m2.1.2.3.cmml" xref="S5.E2.m2.1.2.3"><times id="S5.E2.m2.1.2.3.1.cmml" xref="S5.E2.m2.1.2.3.1"></times><apply id="S5.E2.m2.1.2.3.2.cmml" xref="S5.E2.m2.1.2.3.2"><apply id="S5.E2.m2.1.2.3.2.1.cmml" xref="S5.E2.m2.1.2.3.2.1"><csymbol cd="ambiguous" id="S5.E2.m2.1.2.3.2.1.1.cmml" xref="S5.E2.m2.1.2.3.2.1">subscript</csymbol><max id="S5.E2.m2.1.2.3.2.1.2.cmml" xref="S5.E2.m2.1.2.3.2.1.2"></max><apply id="S5.E2.m2.1.2.3.2.1.3.cmml" xref="S5.E2.m2.1.2.3.2.1.3"><in id="S5.E2.m2.1.2.3.2.1.3.1.cmml" xref="S5.E2.m2.1.2.3.2.1.3.1"></in><ci id="S5.E2.m2.1.2.3.2.1.3.2.cmml" xref="S5.E2.m2.1.2.3.2.1.3.2">𝑛</ci><ci id="S5.E2.m2.1.2.3.2.1.3.3.cmml" xref="S5.E2.m2.1.2.3.2.1.3.3">𝐸</ci></apply></apply><ci id="S5.E2.m2.1.2.3.2.2.cmml" xref="S5.E2.m2.1.2.3.2.2">𝑃𝑟𝑖𝑜𝑟𝑖𝑡𝑦</ci></apply><ci id="S5.E2.m2.1.1.cmml" xref="S5.E2.m2.1.1">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E2.m2.1c">\displaystyle\mathit{Clock}=\max_{n\in E}\mathit{Priority}(n)</annotation><annotation encoding="application/x-llamapun" id="S5.E2.m2.1d">italic_Clock = roman_max start_POSTSUBSCRIPT italic_n ∈ italic_E end_POSTSUBSCRIPT italic_Priority ( italic_n )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS1.p4.5"><math alttext="\mathit{Frequency}" class="ltx_Math" display="inline" id="S5.SS1.p4.3.m1.1"><semantics id="S5.SS1.p4.3.m1.1a"><mi id="S5.SS1.p4.3.m1.1.1" xref="S5.SS1.p4.3.m1.1.1.cmml">𝐹𝑟𝑒𝑞𝑢𝑒𝑛𝑐𝑦</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p4.3.m1.1b"><ci id="S5.SS1.p4.3.m1.1.1.cmml" xref="S5.SS1.p4.3.m1.1.1">𝐹𝑟𝑒𝑞𝑢𝑒𝑛𝑐𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p4.3.m1.1c">\mathit{Frequency}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p4.3.m1.1d">italic_Frequency</annotation></semantics></math> represents the total retrieval count for a document within a time window.
This count is reset to zero upon system start or cache clearance. The priority is proportional to the frequency,
and thus more frequently accessed documents have higher priorities.
<math alttext="\mathit{Size}" class="ltx_Math" display="inline" id="S5.SS1.p4.4.m2.1"><semantics id="S5.SS1.p4.4.m2.1a"><mi id="S5.SS1.p4.4.m2.1.1" xref="S5.SS1.p4.4.m2.1.1.cmml">𝑆𝑖𝑧𝑒</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p4.4.m2.1b"><ci id="S5.SS1.p4.4.m2.1.1.cmml" xref="S5.SS1.p4.4.m2.1.1">𝑆𝑖𝑧𝑒</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p4.4.m2.1c">\mathit{Size}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p4.4.m2.1d">italic_Size</annotation></semantics></math> reflects the number of tokens in a document post-tokenization, directly influencing the memory
required for its key-value tensors.
<math alttext="\mathit{Cost}" class="ltx_Math" display="inline" id="S5.SS1.p4.5.m3.1"><semantics id="S5.SS1.p4.5.m3.1a"><mi id="S5.SS1.p4.5.m3.1.1" xref="S5.SS1.p4.5.m3.1.1.cmml">𝐶𝑜𝑠𝑡</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p4.5.m3.1b"><ci id="S5.SS1.p4.5.m3.1.1.cmml" xref="S5.SS1.p4.5.m3.1.1">𝐶𝑜𝑠𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p4.5.m3.1c">\mathit{Cost}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p4.5.m3.1d">italic_Cost</annotation></semantics></math>, defined as the time taken to compute a document’s key-value tensors, varies with GPU
computational capacity, document size, and the sequence of preceding documents.</p>
</div>
<figure class="ltx_figure" id="S5.F9"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_missing ltx_missing_image" id="S5.F9.g1" src=""/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F9.2.1.1" style="font-size:90%;">Figure 9</span>. </span><span class="ltx_text" id="S5.F9.3.2" style="font-size:90%;">Cost estimation in PGDSF.</span></figcaption>
</figure>
<div class="ltx_para" id="S5.SS1.p5">
<p class="ltx_p" id="S5.SS1.p5.8">PGDSF achieves prefix awareness for RAG systems in two aspects: <math alttext="Cost" class="ltx_Math" display="inline" id="S5.SS1.p5.1.m1.1"><semantics id="S5.SS1.p5.1.m1.1a"><mrow id="S5.SS1.p5.1.m1.1.1" xref="S5.SS1.p5.1.m1.1.1.cmml"><mi id="S5.SS1.p5.1.m1.1.1.2" xref="S5.SS1.p5.1.m1.1.1.2.cmml">C</mi><mo id="S5.SS1.p5.1.m1.1.1.1" xref="S5.SS1.p5.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS1.p5.1.m1.1.1.3" xref="S5.SS1.p5.1.m1.1.1.3.cmml">o</mi><mo id="S5.SS1.p5.1.m1.1.1.1a" xref="S5.SS1.p5.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS1.p5.1.m1.1.1.4" xref="S5.SS1.p5.1.m1.1.1.4.cmml">s</mi><mo id="S5.SS1.p5.1.m1.1.1.1b" xref="S5.SS1.p5.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS1.p5.1.m1.1.1.5" xref="S5.SS1.p5.1.m1.1.1.5.cmml">t</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.1.m1.1b"><apply id="S5.SS1.p5.1.m1.1.1.cmml" xref="S5.SS1.p5.1.m1.1.1"><times id="S5.SS1.p5.1.m1.1.1.1.cmml" xref="S5.SS1.p5.1.m1.1.1.1"></times><ci id="S5.SS1.p5.1.m1.1.1.2.cmml" xref="S5.SS1.p5.1.m1.1.1.2">𝐶</ci><ci id="S5.SS1.p5.1.m1.1.1.3.cmml" xref="S5.SS1.p5.1.m1.1.1.3">𝑜</ci><ci id="S5.SS1.p5.1.m1.1.1.4.cmml" xref="S5.SS1.p5.1.m1.1.1.4">𝑠</ci><ci id="S5.SS1.p5.1.m1.1.1.5.cmml" xref="S5.SS1.p5.1.m1.1.1.5">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.1.m1.1c">Cost</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.1.m1.1d">italic_C italic_o italic_s italic_t</annotation></semantics></math> estimation and node placement.
Unlike GDSF, where costs are straightforward (e.g., object size in web caching),
RAG costs involve complex LLM generation dynamics. For example, Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.F9" title="Figure 9 ‣ 5.1. Cache Structure and Replacement Policy ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">9</span></a> shows
varying costs incurred by the same request denoted as
<math alttext="[S,D_{1},D_{2},Q]" class="ltx_Math" display="inline" id="S5.SS1.p5.2.m2.4"><semantics id="S5.SS1.p5.2.m2.4a"><mrow id="S5.SS1.p5.2.m2.4.4.2" xref="S5.SS1.p5.2.m2.4.4.3.cmml"><mo id="S5.SS1.p5.2.m2.4.4.2.3" stretchy="false" xref="S5.SS1.p5.2.m2.4.4.3.cmml">[</mo><mi id="S5.SS1.p5.2.m2.1.1" xref="S5.SS1.p5.2.m2.1.1.cmml">S</mi><mo id="S5.SS1.p5.2.m2.4.4.2.4" xref="S5.SS1.p5.2.m2.4.4.3.cmml">,</mo><msub id="S5.SS1.p5.2.m2.3.3.1.1" xref="S5.SS1.p5.2.m2.3.3.1.1.cmml"><mi id="S5.SS1.p5.2.m2.3.3.1.1.2" xref="S5.SS1.p5.2.m2.3.3.1.1.2.cmml">D</mi><mn id="S5.SS1.p5.2.m2.3.3.1.1.3" xref="S5.SS1.p5.2.m2.3.3.1.1.3.cmml">1</mn></msub><mo id="S5.SS1.p5.2.m2.4.4.2.5" xref="S5.SS1.p5.2.m2.4.4.3.cmml">,</mo><msub id="S5.SS1.p5.2.m2.4.4.2.2" xref="S5.SS1.p5.2.m2.4.4.2.2.cmml"><mi id="S5.SS1.p5.2.m2.4.4.2.2.2" xref="S5.SS1.p5.2.m2.4.4.2.2.2.cmml">D</mi><mn id="S5.SS1.p5.2.m2.4.4.2.2.3" xref="S5.SS1.p5.2.m2.4.4.2.2.3.cmml">2</mn></msub><mo id="S5.SS1.p5.2.m2.4.4.2.6" xref="S5.SS1.p5.2.m2.4.4.3.cmml">,</mo><mi id="S5.SS1.p5.2.m2.2.2" xref="S5.SS1.p5.2.m2.2.2.cmml">Q</mi><mo id="S5.SS1.p5.2.m2.4.4.2.7" stretchy="false" xref="S5.SS1.p5.2.m2.4.4.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.2.m2.4b"><list id="S5.SS1.p5.2.m2.4.4.3.cmml" xref="S5.SS1.p5.2.m2.4.4.2"><ci id="S5.SS1.p5.2.m2.1.1.cmml" xref="S5.SS1.p5.2.m2.1.1">𝑆</ci><apply id="S5.SS1.p5.2.m2.3.3.1.1.cmml" xref="S5.SS1.p5.2.m2.3.3.1.1"><csymbol cd="ambiguous" id="S5.SS1.p5.2.m2.3.3.1.1.1.cmml" xref="S5.SS1.p5.2.m2.3.3.1.1">subscript</csymbol><ci id="S5.SS1.p5.2.m2.3.3.1.1.2.cmml" xref="S5.SS1.p5.2.m2.3.3.1.1.2">𝐷</ci><cn id="S5.SS1.p5.2.m2.3.3.1.1.3.cmml" type="integer" xref="S5.SS1.p5.2.m2.3.3.1.1.3">1</cn></apply><apply id="S5.SS1.p5.2.m2.4.4.2.2.cmml" xref="S5.SS1.p5.2.m2.4.4.2.2"><csymbol cd="ambiguous" id="S5.SS1.p5.2.m2.4.4.2.2.1.cmml" xref="S5.SS1.p5.2.m2.4.4.2.2">subscript</csymbol><ci id="S5.SS1.p5.2.m2.4.4.2.2.2.cmml" xref="S5.SS1.p5.2.m2.4.4.2.2.2">𝐷</ci><cn id="S5.SS1.p5.2.m2.4.4.2.2.3.cmml" type="integer" xref="S5.SS1.p5.2.m2.4.4.2.2.3">2</cn></apply><ci id="S5.SS1.p5.2.m2.2.2.cmml" xref="S5.SS1.p5.2.m2.2.2">𝑄</ci></list></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.2.m2.4c">[S,D_{1},D_{2},Q]</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.2.m2.4d">[ italic_S , italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_Q ]</annotation></semantics></math>. To estimate the cost for <math alttext="D_{2}" class="ltx_Math" display="inline" id="S5.SS1.p5.3.m3.1"><semantics id="S5.SS1.p5.3.m3.1a"><msub id="S5.SS1.p5.3.m3.1.1" xref="S5.SS1.p5.3.m3.1.1.cmml"><mi id="S5.SS1.p5.3.m3.1.1.2" xref="S5.SS1.p5.3.m3.1.1.2.cmml">D</mi><mn id="S5.SS1.p5.3.m3.1.1.3" xref="S5.SS1.p5.3.m3.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.3.m3.1b"><apply id="S5.SS1.p5.3.m3.1.1.cmml" xref="S5.SS1.p5.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS1.p5.3.m3.1.1.1.cmml" xref="S5.SS1.p5.3.m3.1.1">subscript</csymbol><ci id="S5.SS1.p5.3.m3.1.1.2.cmml" xref="S5.SS1.p5.3.m3.1.1.2">𝐷</ci><cn id="S5.SS1.p5.3.m3.1.1.3.cmml" type="integer" xref="S5.SS1.p5.3.m3.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.3.m3.1c">D_{2}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.3.m3.1d">italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>, directly using the the cost where
<math alttext="[S,D_{1}]" class="ltx_Math" display="inline" id="S5.SS1.p5.4.m4.2"><semantics id="S5.SS1.p5.4.m4.2a"><mrow id="S5.SS1.p5.4.m4.2.2.1" xref="S5.SS1.p5.4.m4.2.2.2.cmml"><mo id="S5.SS1.p5.4.m4.2.2.1.2" stretchy="false" xref="S5.SS1.p5.4.m4.2.2.2.cmml">[</mo><mi id="S5.SS1.p5.4.m4.1.1" xref="S5.SS1.p5.4.m4.1.1.cmml">S</mi><mo id="S5.SS1.p5.4.m4.2.2.1.3" xref="S5.SS1.p5.4.m4.2.2.2.cmml">,</mo><msub id="S5.SS1.p5.4.m4.2.2.1.1" xref="S5.SS1.p5.4.m4.2.2.1.1.cmml"><mi id="S5.SS1.p5.4.m4.2.2.1.1.2" xref="S5.SS1.p5.4.m4.2.2.1.1.2.cmml">D</mi><mn id="S5.SS1.p5.4.m4.2.2.1.1.3" xref="S5.SS1.p5.4.m4.2.2.1.1.3.cmml">1</mn></msub><mo id="S5.SS1.p5.4.m4.2.2.1.4" stretchy="false" xref="S5.SS1.p5.4.m4.2.2.2.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.4.m4.2b"><interval closure="closed" id="S5.SS1.p5.4.m4.2.2.2.cmml" xref="S5.SS1.p5.4.m4.2.2.1"><ci id="S5.SS1.p5.4.m4.1.1.cmml" xref="S5.SS1.p5.4.m4.1.1">𝑆</ci><apply id="S5.SS1.p5.4.m4.2.2.1.1.cmml" xref="S5.SS1.p5.4.m4.2.2.1.1"><csymbol cd="ambiguous" id="S5.SS1.p5.4.m4.2.2.1.1.1.cmml" xref="S5.SS1.p5.4.m4.2.2.1.1">subscript</csymbol><ci id="S5.SS1.p5.4.m4.2.2.1.1.2.cmml" xref="S5.SS1.p5.4.m4.2.2.1.1.2">𝐷</ci><cn id="S5.SS1.p5.4.m4.2.2.1.1.3.cmml" type="integer" xref="S5.SS1.p5.4.m4.2.2.1.1.3">1</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.4.m4.2c">[S,D_{1}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.4.m4.2d">[ italic_S , italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ]</annotation></semantics></math> is cached or only <math alttext="S" class="ltx_Math" display="inline" id="S5.SS1.p5.5.m5.1"><semantics id="S5.SS1.p5.5.m5.1a"><mi id="S5.SS1.p5.5.m5.1.1" xref="S5.SS1.p5.5.m5.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.5.m5.1b"><ci id="S5.SS1.p5.5.m5.1.1.cmml" xref="S5.SS1.p5.5.m5.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.5.m5.1c">S</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.5.m5.1d">italic_S</annotation></semantics></math> is cached is imprecise. Besides, the latter case’s cost also includes
the time to compute the key-value tensors for <math alttext="D_{1}" class="ltx_Math" display="inline" id="S5.SS1.p5.6.m6.1"><semantics id="S5.SS1.p5.6.m6.1a"><msub id="S5.SS1.p5.6.m6.1.1" xref="S5.SS1.p5.6.m6.1.1.cmml"><mi id="S5.SS1.p5.6.m6.1.1.2" xref="S5.SS1.p5.6.m6.1.1.2.cmml">D</mi><mn id="S5.SS1.p5.6.m6.1.1.3" xref="S5.SS1.p5.6.m6.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.6.m6.1b"><apply id="S5.SS1.p5.6.m6.1.1.cmml" xref="S5.SS1.p5.6.m6.1.1"><csymbol cd="ambiguous" id="S5.SS1.p5.6.m6.1.1.1.cmml" xref="S5.SS1.p5.6.m6.1.1">subscript</csymbol><ci id="S5.SS1.p5.6.m6.1.1.2.cmml" xref="S5.SS1.p5.6.m6.1.1.2">𝐷</ci><cn id="S5.SS1.p5.6.m6.1.1.3.cmml" type="integer" xref="S5.SS1.p5.6.m6.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.6.m6.1c">D_{1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.6.m6.1d">italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="Q" class="ltx_Math" display="inline" id="S5.SS1.p5.7.m7.1"><semantics id="S5.SS1.p5.7.m7.1a"><mi id="S5.SS1.p5.7.m7.1.1" xref="S5.SS1.p5.7.m7.1.1.cmml">Q</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.7.m7.1b"><ci id="S5.SS1.p5.7.m7.1.1.cmml" xref="S5.SS1.p5.7.m7.1.1">𝑄</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.7.m7.1c">Q</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.7.m7.1d">italic_Q</annotation></semantics></math>.
PGDSF addresses this problem by replacing <math alttext="Cost/Size" class="ltx_Math" display="inline" id="S5.SS1.p5.8.m8.1"><semantics id="S5.SS1.p5.8.m8.1a"><mrow id="S5.SS1.p5.8.m8.1.1" xref="S5.SS1.p5.8.m8.1.1.cmml"><mrow id="S5.SS1.p5.8.m8.1.1.2" xref="S5.SS1.p5.8.m8.1.1.2.cmml"><mrow id="S5.SS1.p5.8.m8.1.1.2.2" xref="S5.SS1.p5.8.m8.1.1.2.2.cmml"><mi id="S5.SS1.p5.8.m8.1.1.2.2.2" xref="S5.SS1.p5.8.m8.1.1.2.2.2.cmml">C</mi><mo id="S5.SS1.p5.8.m8.1.1.2.2.1" xref="S5.SS1.p5.8.m8.1.1.2.2.1.cmml">⁢</mo><mi id="S5.SS1.p5.8.m8.1.1.2.2.3" xref="S5.SS1.p5.8.m8.1.1.2.2.3.cmml">o</mi><mo id="S5.SS1.p5.8.m8.1.1.2.2.1a" xref="S5.SS1.p5.8.m8.1.1.2.2.1.cmml">⁢</mo><mi id="S5.SS1.p5.8.m8.1.1.2.2.4" xref="S5.SS1.p5.8.m8.1.1.2.2.4.cmml">s</mi><mo id="S5.SS1.p5.8.m8.1.1.2.2.1b" xref="S5.SS1.p5.8.m8.1.1.2.2.1.cmml">⁢</mo><mi id="S5.SS1.p5.8.m8.1.1.2.2.5" xref="S5.SS1.p5.8.m8.1.1.2.2.5.cmml">t</mi></mrow><mo id="S5.SS1.p5.8.m8.1.1.2.1" xref="S5.SS1.p5.8.m8.1.1.2.1.cmml">/</mo><mi id="S5.SS1.p5.8.m8.1.1.2.3" xref="S5.SS1.p5.8.m8.1.1.2.3.cmml">S</mi></mrow><mo id="S5.SS1.p5.8.m8.1.1.1" xref="S5.SS1.p5.8.m8.1.1.1.cmml">⁢</mo><mi id="S5.SS1.p5.8.m8.1.1.3" xref="S5.SS1.p5.8.m8.1.1.3.cmml">i</mi><mo id="S5.SS1.p5.8.m8.1.1.1a" xref="S5.SS1.p5.8.m8.1.1.1.cmml">⁢</mo><mi id="S5.SS1.p5.8.m8.1.1.4" xref="S5.SS1.p5.8.m8.1.1.4.cmml">z</mi><mo id="S5.SS1.p5.8.m8.1.1.1b" xref="S5.SS1.p5.8.m8.1.1.1.cmml">⁢</mo><mi id="S5.SS1.p5.8.m8.1.1.5" xref="S5.SS1.p5.8.m8.1.1.5.cmml">e</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.8.m8.1b"><apply id="S5.SS1.p5.8.m8.1.1.cmml" xref="S5.SS1.p5.8.m8.1.1"><times id="S5.SS1.p5.8.m8.1.1.1.cmml" xref="S5.SS1.p5.8.m8.1.1.1"></times><apply id="S5.SS1.p5.8.m8.1.1.2.cmml" xref="S5.SS1.p5.8.m8.1.1.2"><divide id="S5.SS1.p5.8.m8.1.1.2.1.cmml" xref="S5.SS1.p5.8.m8.1.1.2.1"></divide><apply id="S5.SS1.p5.8.m8.1.1.2.2.cmml" xref="S5.SS1.p5.8.m8.1.1.2.2"><times id="S5.SS1.p5.8.m8.1.1.2.2.1.cmml" xref="S5.SS1.p5.8.m8.1.1.2.2.1"></times><ci id="S5.SS1.p5.8.m8.1.1.2.2.2.cmml" xref="S5.SS1.p5.8.m8.1.1.2.2.2">𝐶</ci><ci id="S5.SS1.p5.8.m8.1.1.2.2.3.cmml" xref="S5.SS1.p5.8.m8.1.1.2.2.3">𝑜</ci><ci id="S5.SS1.p5.8.m8.1.1.2.2.4.cmml" xref="S5.SS1.p5.8.m8.1.1.2.2.4">𝑠</ci><ci id="S5.SS1.p5.8.m8.1.1.2.2.5.cmml" xref="S5.SS1.p5.8.m8.1.1.2.2.5">𝑡</ci></apply><ci id="S5.SS1.p5.8.m8.1.1.2.3.cmml" xref="S5.SS1.p5.8.m8.1.1.2.3">𝑆</ci></apply><ci id="S5.SS1.p5.8.m8.1.1.3.cmml" xref="S5.SS1.p5.8.m8.1.1.3">𝑖</ci><ci id="S5.SS1.p5.8.m8.1.1.4.cmml" xref="S5.SS1.p5.8.m8.1.1.4">𝑧</ci><ci id="S5.SS1.p5.8.m8.1.1.5.cmml" xref="S5.SS1.p5.8.m8.1.1.5">𝑒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.8.m8.1c">Cost/Size</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.8.m8.1d">italic_C italic_o italic_s italic_t / italic_S italic_i italic_z italic_e</annotation></semantics></math> in Formula <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.E1" title="In 5.1. Cache Structure and Replacement Policy ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">1</span></a> as follows:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S10.EGx4">
<tbody id="S5.E3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(3)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\frac{\mathit{Cost}}{\mathit{Size}}=\frac{1}{m}\sum_{i=1}^{m}%
\frac{\mathit{Cost}_{i}}{\mathit{NewSize_{i}}}" class="ltx_Math" display="inline" id="S5.E3.m2.1"><semantics id="S5.E3.m2.1a"><mrow id="S5.E3.m2.1.1" xref="S5.E3.m2.1.1.cmml"><mstyle displaystyle="true" id="S5.E3.m2.1.1.2" xref="S5.E3.m2.1.1.2.cmml"><mfrac id="S5.E3.m2.1.1.2a" xref="S5.E3.m2.1.1.2.cmml"><mi id="S5.E3.m2.1.1.2.2" xref="S5.E3.m2.1.1.2.2.cmml">𝐶𝑜𝑠𝑡</mi><mi id="S5.E3.m2.1.1.2.3" xref="S5.E3.m2.1.1.2.3.cmml">𝑆𝑖𝑧𝑒</mi></mfrac></mstyle><mo id="S5.E3.m2.1.1.1" xref="S5.E3.m2.1.1.1.cmml">=</mo><mrow id="S5.E3.m2.1.1.3" xref="S5.E3.m2.1.1.3.cmml"><mstyle displaystyle="true" id="S5.E3.m2.1.1.3.2" xref="S5.E3.m2.1.1.3.2.cmml"><mfrac id="S5.E3.m2.1.1.3.2a" xref="S5.E3.m2.1.1.3.2.cmml"><mn id="S5.E3.m2.1.1.3.2.2" xref="S5.E3.m2.1.1.3.2.2.cmml">1</mn><mi id="S5.E3.m2.1.1.3.2.3" xref="S5.E3.m2.1.1.3.2.3.cmml">m</mi></mfrac></mstyle><mo id="S5.E3.m2.1.1.3.1" xref="S5.E3.m2.1.1.3.1.cmml">⁢</mo><mrow id="S5.E3.m2.1.1.3.3" xref="S5.E3.m2.1.1.3.3.cmml"><mstyle displaystyle="true" id="S5.E3.m2.1.1.3.3.1" xref="S5.E3.m2.1.1.3.3.1.cmml"><munderover id="S5.E3.m2.1.1.3.3.1a" xref="S5.E3.m2.1.1.3.3.1.cmml"><mo id="S5.E3.m2.1.1.3.3.1.2.2" movablelimits="false" xref="S5.E3.m2.1.1.3.3.1.2.2.cmml">∑</mo><mrow id="S5.E3.m2.1.1.3.3.1.2.3" xref="S5.E3.m2.1.1.3.3.1.2.3.cmml"><mi id="S5.E3.m2.1.1.3.3.1.2.3.2" xref="S5.E3.m2.1.1.3.3.1.2.3.2.cmml">i</mi><mo id="S5.E3.m2.1.1.3.3.1.2.3.1" xref="S5.E3.m2.1.1.3.3.1.2.3.1.cmml">=</mo><mn id="S5.E3.m2.1.1.3.3.1.2.3.3" xref="S5.E3.m2.1.1.3.3.1.2.3.3.cmml">1</mn></mrow><mi id="S5.E3.m2.1.1.3.3.1.3" xref="S5.E3.m2.1.1.3.3.1.3.cmml">m</mi></munderover></mstyle><mstyle displaystyle="true" id="S5.E3.m2.1.1.3.3.2" xref="S5.E3.m2.1.1.3.3.2.cmml"><mfrac id="S5.E3.m2.1.1.3.3.2a" xref="S5.E3.m2.1.1.3.3.2.cmml"><msub id="S5.E3.m2.1.1.3.3.2.2" xref="S5.E3.m2.1.1.3.3.2.2.cmml"><mi id="S5.E3.m2.1.1.3.3.2.2.2" xref="S5.E3.m2.1.1.3.3.2.2.2.cmml">𝐶𝑜𝑠𝑡</mi><mi id="S5.E3.m2.1.1.3.3.2.2.3" xref="S5.E3.m2.1.1.3.3.2.2.3.cmml">i</mi></msub><msub id="S5.E3.m2.1.1.3.3.2.3" xref="S5.E3.m2.1.1.3.3.2.3.cmml"><mi id="S5.E3.m2.1.1.3.3.2.3.2" xref="S5.E3.m2.1.1.3.3.2.3.2.cmml">𝑁𝑒𝑤𝑆𝑖𝑧𝑒</mi><mi id="S5.E3.m2.1.1.3.3.2.3.3" xref="S5.E3.m2.1.1.3.3.2.3.3.cmml">i</mi></msub></mfrac></mstyle></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.E3.m2.1b"><apply id="S5.E3.m2.1.1.cmml" xref="S5.E3.m2.1.1"><eq id="S5.E3.m2.1.1.1.cmml" xref="S5.E3.m2.1.1.1"></eq><apply id="S5.E3.m2.1.1.2.cmml" xref="S5.E3.m2.1.1.2"><divide id="S5.E3.m2.1.1.2.1.cmml" xref="S5.E3.m2.1.1.2"></divide><ci id="S5.E3.m2.1.1.2.2.cmml" xref="S5.E3.m2.1.1.2.2">𝐶𝑜𝑠𝑡</ci><ci id="S5.E3.m2.1.1.2.3.cmml" xref="S5.E3.m2.1.1.2.3">𝑆𝑖𝑧𝑒</ci></apply><apply id="S5.E3.m2.1.1.3.cmml" xref="S5.E3.m2.1.1.3"><times id="S5.E3.m2.1.1.3.1.cmml" xref="S5.E3.m2.1.1.3.1"></times><apply id="S5.E3.m2.1.1.3.2.cmml" xref="S5.E3.m2.1.1.3.2"><divide id="S5.E3.m2.1.1.3.2.1.cmml" xref="S5.E3.m2.1.1.3.2"></divide><cn id="S5.E3.m2.1.1.3.2.2.cmml" type="integer" xref="S5.E3.m2.1.1.3.2.2">1</cn><ci id="S5.E3.m2.1.1.3.2.3.cmml" xref="S5.E3.m2.1.1.3.2.3">𝑚</ci></apply><apply id="S5.E3.m2.1.1.3.3.cmml" xref="S5.E3.m2.1.1.3.3"><apply id="S5.E3.m2.1.1.3.3.1.cmml" xref="S5.E3.m2.1.1.3.3.1"><csymbol cd="ambiguous" id="S5.E3.m2.1.1.3.3.1.1.cmml" xref="S5.E3.m2.1.1.3.3.1">superscript</csymbol><apply id="S5.E3.m2.1.1.3.3.1.2.cmml" xref="S5.E3.m2.1.1.3.3.1"><csymbol cd="ambiguous" id="S5.E3.m2.1.1.3.3.1.2.1.cmml" xref="S5.E3.m2.1.1.3.3.1">subscript</csymbol><sum id="S5.E3.m2.1.1.3.3.1.2.2.cmml" xref="S5.E3.m2.1.1.3.3.1.2.2"></sum><apply id="S5.E3.m2.1.1.3.3.1.2.3.cmml" xref="S5.E3.m2.1.1.3.3.1.2.3"><eq id="S5.E3.m2.1.1.3.3.1.2.3.1.cmml" xref="S5.E3.m2.1.1.3.3.1.2.3.1"></eq><ci id="S5.E3.m2.1.1.3.3.1.2.3.2.cmml" xref="S5.E3.m2.1.1.3.3.1.2.3.2">𝑖</ci><cn id="S5.E3.m2.1.1.3.3.1.2.3.3.cmml" type="integer" xref="S5.E3.m2.1.1.3.3.1.2.3.3">1</cn></apply></apply><ci id="S5.E3.m2.1.1.3.3.1.3.cmml" xref="S5.E3.m2.1.1.3.3.1.3">𝑚</ci></apply><apply id="S5.E3.m2.1.1.3.3.2.cmml" xref="S5.E3.m2.1.1.3.3.2"><divide id="S5.E3.m2.1.1.3.3.2.1.cmml" xref="S5.E3.m2.1.1.3.3.2"></divide><apply id="S5.E3.m2.1.1.3.3.2.2.cmml" xref="S5.E3.m2.1.1.3.3.2.2"><csymbol cd="ambiguous" id="S5.E3.m2.1.1.3.3.2.2.1.cmml" xref="S5.E3.m2.1.1.3.3.2.2">subscript</csymbol><ci id="S5.E3.m2.1.1.3.3.2.2.2.cmml" xref="S5.E3.m2.1.1.3.3.2.2.2">𝐶𝑜𝑠𝑡</ci><ci id="S5.E3.m2.1.1.3.3.2.2.3.cmml" xref="S5.E3.m2.1.1.3.3.2.2.3">𝑖</ci></apply><apply id="S5.E3.m2.1.1.3.3.2.3.cmml" xref="S5.E3.m2.1.1.3.3.2.3"><csymbol cd="ambiguous" id="S5.E3.m2.1.1.3.3.2.3.1.cmml" xref="S5.E3.m2.1.1.3.3.2.3">subscript</csymbol><ci id="S5.E3.m2.1.1.3.3.2.3.2.cmml" xref="S5.E3.m2.1.1.3.3.2.3.2">𝑁𝑒𝑤𝑆𝑖𝑧𝑒</ci><ci id="S5.E3.m2.1.1.3.3.2.3.3.cmml" xref="S5.E3.m2.1.1.3.3.2.3.3">𝑖</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E3.m2.1c">\displaystyle\frac{\mathit{Cost}}{\mathit{Size}}=\frac{1}{m}\sum_{i=1}^{m}%
\frac{\mathit{Cost}_{i}}{\mathit{NewSize_{i}}}</annotation><annotation encoding="application/x-llamapun" id="S5.E3.m2.1d">divide start_ARG italic_Cost end_ARG start_ARG italic_Size end_ARG = divide start_ARG 1 end_ARG start_ARG italic_m end_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT divide start_ARG italic_Cost start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG start_ARG italic_NewSize start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS1.p5.12">where <math alttext="m" class="ltx_Math" display="inline" id="S5.SS1.p5.9.m1.1"><semantics id="S5.SS1.p5.9.m1.1a"><mi id="S5.SS1.p5.9.m1.1.1" xref="S5.SS1.p5.9.m1.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.9.m1.1b"><ci id="S5.SS1.p5.9.m1.1.1.cmml" xref="S5.SS1.p5.9.m1.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.9.m1.1c">m</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.9.m1.1d">italic_m</annotation></semantics></math> is the number of requests that access the document but do not have the document cached.
<math alttext="\mathit{Cost}_{i}/\mathit{NewSize_{i}}" class="ltx_Math" display="inline" id="S5.SS1.p5.10.m2.1"><semantics id="S5.SS1.p5.10.m2.1a"><mrow id="S5.SS1.p5.10.m2.1.1" xref="S5.SS1.p5.10.m2.1.1.cmml"><msub id="S5.SS1.p5.10.m2.1.1.2" xref="S5.SS1.p5.10.m2.1.1.2.cmml"><mi id="S5.SS1.p5.10.m2.1.1.2.2" xref="S5.SS1.p5.10.m2.1.1.2.2.cmml">𝐶𝑜𝑠𝑡</mi><mi id="S5.SS1.p5.10.m2.1.1.2.3" xref="S5.SS1.p5.10.m2.1.1.2.3.cmml">i</mi></msub><mo id="S5.SS1.p5.10.m2.1.1.1" xref="S5.SS1.p5.10.m2.1.1.1.cmml">/</mo><msub id="S5.SS1.p5.10.m2.1.1.3" xref="S5.SS1.p5.10.m2.1.1.3.cmml"><mi id="S5.SS1.p5.10.m2.1.1.3.2" xref="S5.SS1.p5.10.m2.1.1.3.2.cmml">𝑁𝑒𝑤𝑆𝑖𝑧𝑒</mi><mi id="S5.SS1.p5.10.m2.1.1.3.3" xref="S5.SS1.p5.10.m2.1.1.3.3.cmml">i</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.10.m2.1b"><apply id="S5.SS1.p5.10.m2.1.1.cmml" xref="S5.SS1.p5.10.m2.1.1"><divide id="S5.SS1.p5.10.m2.1.1.1.cmml" xref="S5.SS1.p5.10.m2.1.1.1"></divide><apply id="S5.SS1.p5.10.m2.1.1.2.cmml" xref="S5.SS1.p5.10.m2.1.1.2"><csymbol cd="ambiguous" id="S5.SS1.p5.10.m2.1.1.2.1.cmml" xref="S5.SS1.p5.10.m2.1.1.2">subscript</csymbol><ci id="S5.SS1.p5.10.m2.1.1.2.2.cmml" xref="S5.SS1.p5.10.m2.1.1.2.2">𝐶𝑜𝑠𝑡</ci><ci id="S5.SS1.p5.10.m2.1.1.2.3.cmml" xref="S5.SS1.p5.10.m2.1.1.2.3">𝑖</ci></apply><apply id="S5.SS1.p5.10.m2.1.1.3.cmml" xref="S5.SS1.p5.10.m2.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.p5.10.m2.1.1.3.1.cmml" xref="S5.SS1.p5.10.m2.1.1.3">subscript</csymbol><ci id="S5.SS1.p5.10.m2.1.1.3.2.cmml" xref="S5.SS1.p5.10.m2.1.1.3.2">𝑁𝑒𝑤𝑆𝑖𝑧𝑒</ci><ci id="S5.SS1.p5.10.m2.1.1.3.3.cmml" xref="S5.SS1.p5.10.m2.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.10.m2.1c">\mathit{Cost}_{i}/\mathit{NewSize_{i}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.10.m2.1d">italic_Cost start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT / italic_NewSize start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> represents the compute time per non-cached token for the <math alttext="i" class="ltx_Math" display="inline" id="S5.SS1.p5.11.m3.1"><semantics id="S5.SS1.p5.11.m3.1a"><mi id="S5.SS1.p5.11.m3.1.1" xref="S5.SS1.p5.11.m3.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.11.m3.1b"><ci id="S5.SS1.p5.11.m3.1.1.cmml" xref="S5.SS1.p5.11.m3.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.11.m3.1c">i</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.11.m3.1d">italic_i</annotation></semantics></math>-th request.
Such estimation inherently considers the document size by amortizing the cost to all non-cached tokens.
As for <math alttext="\mathit{Cost_{i}}" class="ltx_Math" display="inline" id="S5.SS1.p5.12.m4.1"><semantics id="S5.SS1.p5.12.m4.1a"><msub id="S5.SS1.p5.12.m4.1.1" xref="S5.SS1.p5.12.m4.1.1.cmml"><mi id="S5.SS1.p5.12.m4.1.1.2" xref="S5.SS1.p5.12.m4.1.1.2.cmml">𝐶𝑜𝑠𝑡</mi><mi id="S5.SS1.p5.12.m4.1.1.3" xref="S5.SS1.p5.12.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.12.m4.1b"><apply id="S5.SS1.p5.12.m4.1.1.cmml" xref="S5.SS1.p5.12.m4.1.1"><csymbol cd="ambiguous" id="S5.SS1.p5.12.m4.1.1.1.cmml" xref="S5.SS1.p5.12.m4.1.1">subscript</csymbol><ci id="S5.SS1.p5.12.m4.1.1.2.cmml" xref="S5.SS1.p5.12.m4.1.1.2">𝐶𝑜𝑠𝑡</ci><ci id="S5.SS1.p5.12.m4.1.1.3.cmml" xref="S5.SS1.p5.12.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.12.m4.1c">\mathit{Cost_{i}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.12.m4.1d">italic_Cost start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, RAGCache profiles the LLM prefill time with varying cached and non-cached token lengths
offline and uses bilinear interpolation to estimate the cost for a given request.
Document retrieval triggers an update in node frequency, cost estimation and clock within the knowledge tree,
or initiates a new node for documents not previously cached.</p>
</div>
<div class="ltx_para" id="S5.SS1.p6">
<p class="ltx_p" id="S5.SS1.p6.1">PGDSF orchestrates node placement in the knowledge tree, which is divided into GPU, host, and free segments,
as illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.F8" title="Figure 8 ‣ 5.1. Cache Structure and Replacement Policy ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">8</span></a>.
Nodes in GPU memory serve as parent nodes to those in host memory,
establishing a hierarchical structure.
RAGCache dynamically manages node eviction across these segments for efficiency.
Specifically, when the GPU memory is full, RAGCache swaps
the least priority node in leaf nodes to the host memory.
RAGCache applies a similar process for host memory oversubscription.
This eviction strategy upholds the tree’s hierarchical partitioning, which is pivotal for aligning with
the memory hierarchy and prefix sensitivity in LLM generation.
A node relies on its parent node for key-value tensor calculation, emphasizing the need for prioritizing parent
node placement for rapid retrieval.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.2.1.1">Algorithm 1</span> </span> Knowledge Tree Operations</figcaption>
<div class="ltx_listing ltx_listing" id="alg1.3">
<div class="ltx_listingline" id="alg1.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l1.1.1.1" style="font-size:80%;">1:</span></span><span class="ltx_text ltx_font_bold" id="alg1.l1.2" style="font-size:80%;">function</span><span class="ltx_text" id="alg1.l1.3" style="font-size:80%;"> </span><span class="ltx_text ltx_font_smallcaps" id="alg1.l1.4" style="font-size:80%;">UPDATE_NODE_IN_GPU</span><span class="ltx_text" id="alg1.l1.5" style="font-size:80%;">(</span><math alttext="node" class="ltx_Math" display="inline" id="alg1.l1.m1.1"><semantics id="alg1.l1.m1.1a"><mrow id="alg1.l1.m1.1.1" xref="alg1.l1.m1.1.1.cmml"><mi id="alg1.l1.m1.1.1.2" mathsize="80%" xref="alg1.l1.m1.1.1.2.cmml">n</mi><mo id="alg1.l1.m1.1.1.1" xref="alg1.l1.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m1.1.1.3" mathsize="80%" xref="alg1.l1.m1.1.1.3.cmml">o</mi><mo id="alg1.l1.m1.1.1.1a" xref="alg1.l1.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m1.1.1.4" mathsize="80%" xref="alg1.l1.m1.1.1.4.cmml">d</mi><mo id="alg1.l1.m1.1.1.1b" xref="alg1.l1.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m1.1.1.5" mathsize="80%" xref="alg1.l1.m1.1.1.5.cmml">e</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l1.m1.1b"><apply id="alg1.l1.m1.1.1.cmml" xref="alg1.l1.m1.1.1"><times id="alg1.l1.m1.1.1.1.cmml" xref="alg1.l1.m1.1.1.1"></times><ci id="alg1.l1.m1.1.1.2.cmml" xref="alg1.l1.m1.1.1.2">𝑛</ci><ci id="alg1.l1.m1.1.1.3.cmml" xref="alg1.l1.m1.1.1.3">𝑜</ci><ci id="alg1.l1.m1.1.1.4.cmml" xref="alg1.l1.m1.1.1.4">𝑑</ci><ci id="alg1.l1.m1.1.1.5.cmml" xref="alg1.l1.m1.1.1.5">𝑒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m1.1c">node</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m1.1d">italic_n italic_o italic_d italic_e</annotation></semantics></math><span class="ltx_text" id="alg1.l1.6" style="font-size:80%;">, </span><math alttext="is\_cached" class="ltx_Math" display="inline" id="alg1.l1.m2.1"><semantics id="alg1.l1.m2.1a"><mrow id="alg1.l1.m2.1.1" xref="alg1.l1.m2.1.1.cmml"><mi id="alg1.l1.m2.1.1.2" mathsize="80%" xref="alg1.l1.m2.1.1.2.cmml">i</mi><mo id="alg1.l1.m2.1.1.1" xref="alg1.l1.m2.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m2.1.1.3" mathsize="80%" xref="alg1.l1.m2.1.1.3.cmml">s</mi><mo id="alg1.l1.m2.1.1.1a" xref="alg1.l1.m2.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m2.1.1.4" mathsize="80%" mathvariant="normal" xref="alg1.l1.m2.1.1.4.cmml">_</mi><mo id="alg1.l1.m2.1.1.1b" xref="alg1.l1.m2.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m2.1.1.5" mathsize="80%" xref="alg1.l1.m2.1.1.5.cmml">c</mi><mo id="alg1.l1.m2.1.1.1c" xref="alg1.l1.m2.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m2.1.1.6" mathsize="80%" xref="alg1.l1.m2.1.1.6.cmml">a</mi><mo id="alg1.l1.m2.1.1.1d" xref="alg1.l1.m2.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m2.1.1.7" mathsize="80%" xref="alg1.l1.m2.1.1.7.cmml">c</mi><mo id="alg1.l1.m2.1.1.1e" xref="alg1.l1.m2.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m2.1.1.8" mathsize="80%" xref="alg1.l1.m2.1.1.8.cmml">h</mi><mo id="alg1.l1.m2.1.1.1f" xref="alg1.l1.m2.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m2.1.1.9" mathsize="80%" xref="alg1.l1.m2.1.1.9.cmml">e</mi><mo id="alg1.l1.m2.1.1.1g" xref="alg1.l1.m2.1.1.1.cmml">⁢</mo><mi id="alg1.l1.m2.1.1.10" mathsize="80%" xref="alg1.l1.m2.1.1.10.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l1.m2.1b"><apply id="alg1.l1.m2.1.1.cmml" xref="alg1.l1.m2.1.1"><times id="alg1.l1.m2.1.1.1.cmml" xref="alg1.l1.m2.1.1.1"></times><ci id="alg1.l1.m2.1.1.2.cmml" xref="alg1.l1.m2.1.1.2">𝑖</ci><ci id="alg1.l1.m2.1.1.3.cmml" xref="alg1.l1.m2.1.1.3">𝑠</ci><ci id="alg1.l1.m2.1.1.4.cmml" xref="alg1.l1.m2.1.1.4">_</ci><ci id="alg1.l1.m2.1.1.5.cmml" xref="alg1.l1.m2.1.1.5">𝑐</ci><ci id="alg1.l1.m2.1.1.6.cmml" xref="alg1.l1.m2.1.1.6">𝑎</ci><ci id="alg1.l1.m2.1.1.7.cmml" xref="alg1.l1.m2.1.1.7">𝑐</ci><ci id="alg1.l1.m2.1.1.8.cmml" xref="alg1.l1.m2.1.1.8">ℎ</ci><ci id="alg1.l1.m2.1.1.9.cmml" xref="alg1.l1.m2.1.1.9">𝑒</ci><ci id="alg1.l1.m2.1.1.10.cmml" xref="alg1.l1.m2.1.1.10">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m2.1c">is\_cached</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m2.1d">italic_i italic_s _ italic_c italic_a italic_c italic_h italic_e italic_d</annotation></semantics></math><span class="ltx_text" id="alg1.l1.7" style="font-size:80%;">, </span><math alttext="\alpha" class="ltx_Math" display="inline" id="alg1.l1.m3.1"><semantics id="alg1.l1.m3.1a"><mi id="alg1.l1.m3.1.1" mathsize="80%" xref="alg1.l1.m3.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m3.1b"><ci id="alg1.l1.m3.1.1.cmml" xref="alg1.l1.m3.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m3.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m3.1d">italic_α</annotation></semantics></math><span class="ltx_text" id="alg1.l1.8" style="font-size:80%;">, </span><math alttext="\beta" class="ltx_Math" display="inline" id="alg1.l1.m4.1"><semantics id="alg1.l1.m4.1a"><mi id="alg1.l1.m4.1.1" mathsize="80%" xref="alg1.l1.m4.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m4.1b"><ci id="alg1.l1.m4.1.1.cmml" xref="alg1.l1.m4.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m4.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m4.1d">italic_β</annotation></semantics></math><span class="ltx_text" id="alg1.l1.9" style="font-size:80%;">)
</span>
</div>
<div class="ltx_listingline" id="alg1.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l2.3.1.1" style="font-size:80%;">2:</span></span><span class="ltx_text" id="alg1.l2.4" style="font-size:80%;">    </span><span class="ltx_text ltx_font_bold" id="alg1.l2.2" style="font-size:80%;">// <math alttext="\alpha" class="ltx_Math" display="inline" id="alg1.l2.1.m1.1"><semantics id="alg1.l2.1.m1.1a"><mi id="alg1.l2.1.m1.1.1" xref="alg1.l2.1.m1.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="alg1.l2.1.m1.1b"><ci id="alg1.l2.1.m1.1.1.cmml" xref="alg1.l2.1.m1.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.1.m1.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.1.m1.1d">italic_α</annotation></semantics></math> and <math alttext="\beta" class="ltx_Math" display="inline" id="alg1.l2.2.m2.1"><semantics id="alg1.l2.2.m2.1a"><mi id="alg1.l2.2.m2.1.1" xref="alg1.l2.2.m2.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="alg1.l2.2.m2.1b"><ci id="alg1.l2.2.m2.1.1.cmml" xref="alg1.l2.2.m2.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.2.m2.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.2.m2.1d">italic_β</annotation></semantics></math> are cached and non-cached sizes of the request</span><span class="ltx_text" id="alg1.l2.5" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l3.1.1.1" style="font-size:80%;">3:</span></span><span class="ltx_text" id="alg1.l3.2" style="font-size:80%;">    </span><math alttext="node.Frequency\leftarrow node.Frequency+1" class="ltx_Math" display="inline" id="alg1.l3.m1.3"><semantics id="alg1.l3.m1.3a"><mrow id="alg1.l3.m1.3.3.3" xref="alg1.l3.m1.3.3.4.cmml"><mrow id="alg1.l3.m1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.cmml"><mi id="alg1.l3.m1.1.1.1.1.2" mathsize="80%" xref="alg1.l3.m1.1.1.1.1.2.cmml">n</mi><mo id="alg1.l3.m1.1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l3.m1.1.1.1.1.3" mathsize="80%" xref="alg1.l3.m1.1.1.1.1.3.cmml">o</mi><mo id="alg1.l3.m1.1.1.1.1.1a" xref="alg1.l3.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l3.m1.1.1.1.1.4" mathsize="80%" xref="alg1.l3.m1.1.1.1.1.4.cmml">d</mi><mo id="alg1.l3.m1.1.1.1.1.1b" xref="alg1.l3.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l3.m1.1.1.1.1.5" mathsize="80%" xref="alg1.l3.m1.1.1.1.1.5.cmml">e</mi></mrow><mo id="alg1.l3.m1.3.3.3.4" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l3.m1.3.3.4a.cmml">.</mo><mrow id="alg1.l3.m1.2.2.2.2" xref="alg1.l3.m1.2.2.2.2.cmml"><mrow id="alg1.l3.m1.2.2.2.2.2" xref="alg1.l3.m1.2.2.2.2.2.cmml"><mi id="alg1.l3.m1.2.2.2.2.2.2" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.2.2.cmml">F</mi><mo id="alg1.l3.m1.2.2.2.2.2.1" xref="alg1.l3.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.2.3" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.2.3.cmml">r</mi><mo id="alg1.l3.m1.2.2.2.2.2.1a" xref="alg1.l3.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.2.4" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.2.4.cmml">e</mi><mo id="alg1.l3.m1.2.2.2.2.2.1b" xref="alg1.l3.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.2.5" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.2.5.cmml">q</mi><mo id="alg1.l3.m1.2.2.2.2.2.1c" xref="alg1.l3.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.2.6" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.2.6.cmml">u</mi><mo id="alg1.l3.m1.2.2.2.2.2.1d" xref="alg1.l3.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.2.7" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.2.7.cmml">e</mi><mo id="alg1.l3.m1.2.2.2.2.2.1e" xref="alg1.l3.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.2.8" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.2.8.cmml">n</mi><mo id="alg1.l3.m1.2.2.2.2.2.1f" xref="alg1.l3.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.2.9" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.2.9.cmml">c</mi><mo id="alg1.l3.m1.2.2.2.2.2.1g" xref="alg1.l3.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.2.10" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.2.10.cmml">y</mi></mrow><mo id="alg1.l3.m1.2.2.2.2.1" mathsize="80%" stretchy="false" xref="alg1.l3.m1.2.2.2.2.1.cmml">←</mo><mrow id="alg1.l3.m1.2.2.2.2.3" xref="alg1.l3.m1.2.2.2.2.3.cmml"><mi id="alg1.l3.m1.2.2.2.2.3.2" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.3.2.cmml">n</mi><mo id="alg1.l3.m1.2.2.2.2.3.1" xref="alg1.l3.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.3.3" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.3.3.cmml">o</mi><mo id="alg1.l3.m1.2.2.2.2.3.1a" xref="alg1.l3.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.3.4" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.3.4.cmml">d</mi><mo id="alg1.l3.m1.2.2.2.2.3.1b" xref="alg1.l3.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l3.m1.2.2.2.2.3.5" mathsize="80%" xref="alg1.l3.m1.2.2.2.2.3.5.cmml">e</mi></mrow></mrow><mo id="alg1.l3.m1.3.3.3.5" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l3.m1.3.3.4a.cmml">.</mo><mrow id="alg1.l3.m1.3.3.3.3" xref="alg1.l3.m1.3.3.3.3.cmml"><mrow id="alg1.l3.m1.3.3.3.3.2" xref="alg1.l3.m1.3.3.3.3.2.cmml"><mi id="alg1.l3.m1.3.3.3.3.2.2" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.2.2.cmml">F</mi><mo id="alg1.l3.m1.3.3.3.3.2.1" xref="alg1.l3.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.3.3.3.3.2.3" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.2.3.cmml">r</mi><mo id="alg1.l3.m1.3.3.3.3.2.1a" xref="alg1.l3.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.3.3.3.3.2.4" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.2.4.cmml">e</mi><mo id="alg1.l3.m1.3.3.3.3.2.1b" xref="alg1.l3.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.3.3.3.3.2.5" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.2.5.cmml">q</mi><mo id="alg1.l3.m1.3.3.3.3.2.1c" xref="alg1.l3.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.3.3.3.3.2.6" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.2.6.cmml">u</mi><mo id="alg1.l3.m1.3.3.3.3.2.1d" xref="alg1.l3.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.3.3.3.3.2.7" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.2.7.cmml">e</mi><mo id="alg1.l3.m1.3.3.3.3.2.1e" xref="alg1.l3.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.3.3.3.3.2.8" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.2.8.cmml">n</mi><mo id="alg1.l3.m1.3.3.3.3.2.1f" xref="alg1.l3.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.3.3.3.3.2.9" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.2.9.cmml">c</mi><mo id="alg1.l3.m1.3.3.3.3.2.1g" xref="alg1.l3.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l3.m1.3.3.3.3.2.10" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.2.10.cmml">y</mi></mrow><mo id="alg1.l3.m1.3.3.3.3.1" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.1.cmml">+</mo><mn id="alg1.l3.m1.3.3.3.3.3" mathsize="80%" xref="alg1.l3.m1.3.3.3.3.3.cmml">1</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l3.m1.3b"><apply id="alg1.l3.m1.3.3.4.cmml" xref="alg1.l3.m1.3.3.3"><csymbol cd="ambiguous" id="alg1.l3.m1.3.3.4a.cmml" xref="alg1.l3.m1.3.3.3.4">formulae-sequence</csymbol><apply id="alg1.l3.m1.1.1.1.1.cmml" xref="alg1.l3.m1.1.1.1.1"><times id="alg1.l3.m1.1.1.1.1.1.cmml" xref="alg1.l3.m1.1.1.1.1.1"></times><ci id="alg1.l3.m1.1.1.1.1.2.cmml" xref="alg1.l3.m1.1.1.1.1.2">𝑛</ci><ci id="alg1.l3.m1.1.1.1.1.3.cmml" xref="alg1.l3.m1.1.1.1.1.3">𝑜</ci><ci id="alg1.l3.m1.1.1.1.1.4.cmml" xref="alg1.l3.m1.1.1.1.1.4">𝑑</ci><ci id="alg1.l3.m1.1.1.1.1.5.cmml" xref="alg1.l3.m1.1.1.1.1.5">𝑒</ci></apply><apply id="alg1.l3.m1.2.2.2.2.cmml" xref="alg1.l3.m1.2.2.2.2"><ci id="alg1.l3.m1.2.2.2.2.1.cmml" xref="alg1.l3.m1.2.2.2.2.1">←</ci><apply id="alg1.l3.m1.2.2.2.2.2.cmml" xref="alg1.l3.m1.2.2.2.2.2"><times id="alg1.l3.m1.2.2.2.2.2.1.cmml" xref="alg1.l3.m1.2.2.2.2.2.1"></times><ci id="alg1.l3.m1.2.2.2.2.2.2.cmml" xref="alg1.l3.m1.2.2.2.2.2.2">𝐹</ci><ci id="alg1.l3.m1.2.2.2.2.2.3.cmml" xref="alg1.l3.m1.2.2.2.2.2.3">𝑟</ci><ci id="alg1.l3.m1.2.2.2.2.2.4.cmml" xref="alg1.l3.m1.2.2.2.2.2.4">𝑒</ci><ci id="alg1.l3.m1.2.2.2.2.2.5.cmml" xref="alg1.l3.m1.2.2.2.2.2.5">𝑞</ci><ci id="alg1.l3.m1.2.2.2.2.2.6.cmml" xref="alg1.l3.m1.2.2.2.2.2.6">𝑢</ci><ci id="alg1.l3.m1.2.2.2.2.2.7.cmml" xref="alg1.l3.m1.2.2.2.2.2.7">𝑒</ci><ci id="alg1.l3.m1.2.2.2.2.2.8.cmml" xref="alg1.l3.m1.2.2.2.2.2.8">𝑛</ci><ci id="alg1.l3.m1.2.2.2.2.2.9.cmml" xref="alg1.l3.m1.2.2.2.2.2.9">𝑐</ci><ci id="alg1.l3.m1.2.2.2.2.2.10.cmml" xref="alg1.l3.m1.2.2.2.2.2.10">𝑦</ci></apply><apply id="alg1.l3.m1.2.2.2.2.3.cmml" xref="alg1.l3.m1.2.2.2.2.3"><times id="alg1.l3.m1.2.2.2.2.3.1.cmml" xref="alg1.l3.m1.2.2.2.2.3.1"></times><ci id="alg1.l3.m1.2.2.2.2.3.2.cmml" xref="alg1.l3.m1.2.2.2.2.3.2">𝑛</ci><ci id="alg1.l3.m1.2.2.2.2.3.3.cmml" xref="alg1.l3.m1.2.2.2.2.3.3">𝑜</ci><ci id="alg1.l3.m1.2.2.2.2.3.4.cmml" xref="alg1.l3.m1.2.2.2.2.3.4">𝑑</ci><ci id="alg1.l3.m1.2.2.2.2.3.5.cmml" xref="alg1.l3.m1.2.2.2.2.3.5">𝑒</ci></apply></apply><apply id="alg1.l3.m1.3.3.3.3.cmml" xref="alg1.l3.m1.3.3.3.3"><plus id="alg1.l3.m1.3.3.3.3.1.cmml" xref="alg1.l3.m1.3.3.3.3.1"></plus><apply id="alg1.l3.m1.3.3.3.3.2.cmml" xref="alg1.l3.m1.3.3.3.3.2"><times id="alg1.l3.m1.3.3.3.3.2.1.cmml" xref="alg1.l3.m1.3.3.3.3.2.1"></times><ci id="alg1.l3.m1.3.3.3.3.2.2.cmml" xref="alg1.l3.m1.3.3.3.3.2.2">𝐹</ci><ci id="alg1.l3.m1.3.3.3.3.2.3.cmml" xref="alg1.l3.m1.3.3.3.3.2.3">𝑟</ci><ci id="alg1.l3.m1.3.3.3.3.2.4.cmml" xref="alg1.l3.m1.3.3.3.3.2.4">𝑒</ci><ci id="alg1.l3.m1.3.3.3.3.2.5.cmml" xref="alg1.l3.m1.3.3.3.3.2.5">𝑞</ci><ci id="alg1.l3.m1.3.3.3.3.2.6.cmml" xref="alg1.l3.m1.3.3.3.3.2.6">𝑢</ci><ci id="alg1.l3.m1.3.3.3.3.2.7.cmml" xref="alg1.l3.m1.3.3.3.3.2.7">𝑒</ci><ci id="alg1.l3.m1.3.3.3.3.2.8.cmml" xref="alg1.l3.m1.3.3.3.3.2.8">𝑛</ci><ci id="alg1.l3.m1.3.3.3.3.2.9.cmml" xref="alg1.l3.m1.3.3.3.3.2.9">𝑐</ci><ci id="alg1.l3.m1.3.3.3.3.2.10.cmml" xref="alg1.l3.m1.3.3.3.3.2.10">𝑦</ci></apply><cn id="alg1.l3.m1.3.3.3.3.3.cmml" type="integer" xref="alg1.l3.m1.3.3.3.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m1.3c">node.Frequency\leftarrow node.Frequency+1</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.m1.3d">italic_n italic_o italic_d italic_e . italic_F italic_r italic_e italic_q italic_u italic_e italic_n italic_c italic_y ← italic_n italic_o italic_d italic_e . italic_F italic_r italic_e italic_q italic_u italic_e italic_n italic_c italic_y + 1</annotation></semantics></math><span class="ltx_text" id="alg1.l3.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l4.1.1.1" style="font-size:80%;">4:</span></span><span class="ltx_text" id="alg1.l4.2" style="font-size:80%;">    </span><span class="ltx_text ltx_font_bold" id="alg1.l4.3" style="font-size:80%;">if</span><span class="ltx_text" id="alg1.l4.4" style="font-size:80%;"> </span><math alttext="is\_cached" class="ltx_Math" display="inline" id="alg1.l4.m1.1"><semantics id="alg1.l4.m1.1a"><mrow id="alg1.l4.m1.1.1" xref="alg1.l4.m1.1.1.cmml"><mi id="alg1.l4.m1.1.1.2" mathsize="80%" xref="alg1.l4.m1.1.1.2.cmml">i</mi><mo id="alg1.l4.m1.1.1.1" xref="alg1.l4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l4.m1.1.1.3" mathsize="80%" xref="alg1.l4.m1.1.1.3.cmml">s</mi><mo id="alg1.l4.m1.1.1.1a" xref="alg1.l4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l4.m1.1.1.4" mathsize="80%" mathvariant="normal" xref="alg1.l4.m1.1.1.4.cmml">_</mi><mo id="alg1.l4.m1.1.1.1b" xref="alg1.l4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l4.m1.1.1.5" mathsize="80%" xref="alg1.l4.m1.1.1.5.cmml">c</mi><mo id="alg1.l4.m1.1.1.1c" xref="alg1.l4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l4.m1.1.1.6" mathsize="80%" xref="alg1.l4.m1.1.1.6.cmml">a</mi><mo id="alg1.l4.m1.1.1.1d" xref="alg1.l4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l4.m1.1.1.7" mathsize="80%" xref="alg1.l4.m1.1.1.7.cmml">c</mi><mo id="alg1.l4.m1.1.1.1e" xref="alg1.l4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l4.m1.1.1.8" mathsize="80%" xref="alg1.l4.m1.1.1.8.cmml">h</mi><mo id="alg1.l4.m1.1.1.1f" xref="alg1.l4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l4.m1.1.1.9" mathsize="80%" xref="alg1.l4.m1.1.1.9.cmml">e</mi><mo id="alg1.l4.m1.1.1.1g" xref="alg1.l4.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l4.m1.1.1.10" mathsize="80%" xref="alg1.l4.m1.1.1.10.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l4.m1.1b"><apply id="alg1.l4.m1.1.1.cmml" xref="alg1.l4.m1.1.1"><times id="alg1.l4.m1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1"></times><ci id="alg1.l4.m1.1.1.2.cmml" xref="alg1.l4.m1.1.1.2">𝑖</ci><ci id="alg1.l4.m1.1.1.3.cmml" xref="alg1.l4.m1.1.1.3">𝑠</ci><ci id="alg1.l4.m1.1.1.4.cmml" xref="alg1.l4.m1.1.1.4">_</ci><ci id="alg1.l4.m1.1.1.5.cmml" xref="alg1.l4.m1.1.1.5">𝑐</ci><ci id="alg1.l4.m1.1.1.6.cmml" xref="alg1.l4.m1.1.1.6">𝑎</ci><ci id="alg1.l4.m1.1.1.7.cmml" xref="alg1.l4.m1.1.1.7">𝑐</ci><ci id="alg1.l4.m1.1.1.8.cmml" xref="alg1.l4.m1.1.1.8">ℎ</ci><ci id="alg1.l4.m1.1.1.9.cmml" xref="alg1.l4.m1.1.1.9">𝑒</ci><ci id="alg1.l4.m1.1.1.10.cmml" xref="alg1.l4.m1.1.1.10">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m1.1c">is\_cached</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m1.1d">italic_i italic_s _ italic_c italic_a italic_c italic_h italic_e italic_d</annotation></semantics></math><span class="ltx_text" id="alg1.l4.5" style="font-size:80%;"> is false </span><span class="ltx_text ltx_font_bold" id="alg1.l4.6" style="font-size:80%;">then</span><span class="ltx_text" id="alg1.l4.7" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l5.1.1.1" style="font-size:80%;">5:</span></span><span class="ltx_text" id="alg1.l5.2" style="font-size:80%;">        </span><span class="ltx_text ltx_font_bold" id="alg1.l5.3" style="font-size:80%;">// Bilinear interpolation to estimate the cost</span><span class="ltx_text" id="alg1.l5.4" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l6.1.1.1" style="font-size:80%;">6:</span></span><span class="ltx_text" id="alg1.l6.2" style="font-size:80%;">        Find </span><math alttext="\alpha_{l}&lt;\alpha&lt;\alpha_{h}" class="ltx_Math" display="inline" id="alg1.l6.m1.1"><semantics id="alg1.l6.m1.1a"><mrow id="alg1.l6.m1.1.1" xref="alg1.l6.m1.1.1.cmml"><msub id="alg1.l6.m1.1.1.2" xref="alg1.l6.m1.1.1.2.cmml"><mi id="alg1.l6.m1.1.1.2.2" mathsize="80%" xref="alg1.l6.m1.1.1.2.2.cmml">α</mi><mi id="alg1.l6.m1.1.1.2.3" mathsize="80%" xref="alg1.l6.m1.1.1.2.3.cmml">l</mi></msub><mo id="alg1.l6.m1.1.1.3" mathsize="80%" xref="alg1.l6.m1.1.1.3.cmml">&lt;</mo><mi id="alg1.l6.m1.1.1.4" mathsize="80%" xref="alg1.l6.m1.1.1.4.cmml">α</mi><mo id="alg1.l6.m1.1.1.5" mathsize="80%" xref="alg1.l6.m1.1.1.5.cmml">&lt;</mo><msub id="alg1.l6.m1.1.1.6" xref="alg1.l6.m1.1.1.6.cmml"><mi id="alg1.l6.m1.1.1.6.2" mathsize="80%" xref="alg1.l6.m1.1.1.6.2.cmml">α</mi><mi id="alg1.l6.m1.1.1.6.3" mathsize="80%" xref="alg1.l6.m1.1.1.6.3.cmml">h</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l6.m1.1b"><apply id="alg1.l6.m1.1.1.cmml" xref="alg1.l6.m1.1.1"><and id="alg1.l6.m1.1.1a.cmml" xref="alg1.l6.m1.1.1"></and><apply id="alg1.l6.m1.1.1b.cmml" xref="alg1.l6.m1.1.1"><lt id="alg1.l6.m1.1.1.3.cmml" xref="alg1.l6.m1.1.1.3"></lt><apply id="alg1.l6.m1.1.1.2.cmml" xref="alg1.l6.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l6.m1.1.1.2.1.cmml" xref="alg1.l6.m1.1.1.2">subscript</csymbol><ci id="alg1.l6.m1.1.1.2.2.cmml" xref="alg1.l6.m1.1.1.2.2">𝛼</ci><ci id="alg1.l6.m1.1.1.2.3.cmml" xref="alg1.l6.m1.1.1.2.3">𝑙</ci></apply><ci id="alg1.l6.m1.1.1.4.cmml" xref="alg1.l6.m1.1.1.4">𝛼</ci></apply><apply id="alg1.l6.m1.1.1c.cmml" xref="alg1.l6.m1.1.1"><lt id="alg1.l6.m1.1.1.5.cmml" xref="alg1.l6.m1.1.1.5"></lt><share href="https://arxiv.org/html/2404.12457v2#alg1.l6.m1.1.1.4.cmml" id="alg1.l6.m1.1.1d.cmml" xref="alg1.l6.m1.1.1"></share><apply id="alg1.l6.m1.1.1.6.cmml" xref="alg1.l6.m1.1.1.6"><csymbol cd="ambiguous" id="alg1.l6.m1.1.1.6.1.cmml" xref="alg1.l6.m1.1.1.6">subscript</csymbol><ci id="alg1.l6.m1.1.1.6.2.cmml" xref="alg1.l6.m1.1.1.6.2">𝛼</ci><ci id="alg1.l6.m1.1.1.6.3.cmml" xref="alg1.l6.m1.1.1.6.3">ℎ</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.m1.1c">\alpha_{l}&lt;\alpha&lt;\alpha_{h}</annotation><annotation encoding="application/x-llamapun" id="alg1.l6.m1.1d">italic_α start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT &lt; italic_α &lt; italic_α start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT</annotation></semantics></math><span class="ltx_text" id="alg1.l6.3" style="font-size:80%;"> and </span><math alttext="\beta_{l}&lt;\beta&lt;\beta_{h}" class="ltx_Math" display="inline" id="alg1.l6.m2.1"><semantics id="alg1.l6.m2.1a"><mrow id="alg1.l6.m2.1.1" xref="alg1.l6.m2.1.1.cmml"><msub id="alg1.l6.m2.1.1.2" xref="alg1.l6.m2.1.1.2.cmml"><mi id="alg1.l6.m2.1.1.2.2" mathsize="80%" xref="alg1.l6.m2.1.1.2.2.cmml">β</mi><mi id="alg1.l6.m2.1.1.2.3" mathsize="80%" xref="alg1.l6.m2.1.1.2.3.cmml">l</mi></msub><mo id="alg1.l6.m2.1.1.3" mathsize="80%" xref="alg1.l6.m2.1.1.3.cmml">&lt;</mo><mi id="alg1.l6.m2.1.1.4" mathsize="80%" xref="alg1.l6.m2.1.1.4.cmml">β</mi><mo id="alg1.l6.m2.1.1.5" mathsize="80%" xref="alg1.l6.m2.1.1.5.cmml">&lt;</mo><msub id="alg1.l6.m2.1.1.6" xref="alg1.l6.m2.1.1.6.cmml"><mi id="alg1.l6.m2.1.1.6.2" mathsize="80%" xref="alg1.l6.m2.1.1.6.2.cmml">β</mi><mi id="alg1.l6.m2.1.1.6.3" mathsize="80%" xref="alg1.l6.m2.1.1.6.3.cmml">h</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l6.m2.1b"><apply id="alg1.l6.m2.1.1.cmml" xref="alg1.l6.m2.1.1"><and id="alg1.l6.m2.1.1a.cmml" xref="alg1.l6.m2.1.1"></and><apply id="alg1.l6.m2.1.1b.cmml" xref="alg1.l6.m2.1.1"><lt id="alg1.l6.m2.1.1.3.cmml" xref="alg1.l6.m2.1.1.3"></lt><apply id="alg1.l6.m2.1.1.2.cmml" xref="alg1.l6.m2.1.1.2"><csymbol cd="ambiguous" id="alg1.l6.m2.1.1.2.1.cmml" xref="alg1.l6.m2.1.1.2">subscript</csymbol><ci id="alg1.l6.m2.1.1.2.2.cmml" xref="alg1.l6.m2.1.1.2.2">𝛽</ci><ci id="alg1.l6.m2.1.1.2.3.cmml" xref="alg1.l6.m2.1.1.2.3">𝑙</ci></apply><ci id="alg1.l6.m2.1.1.4.cmml" xref="alg1.l6.m2.1.1.4">𝛽</ci></apply><apply id="alg1.l6.m2.1.1c.cmml" xref="alg1.l6.m2.1.1"><lt id="alg1.l6.m2.1.1.5.cmml" xref="alg1.l6.m2.1.1.5"></lt><share href="https://arxiv.org/html/2404.12457v2#alg1.l6.m2.1.1.4.cmml" id="alg1.l6.m2.1.1d.cmml" xref="alg1.l6.m2.1.1"></share><apply id="alg1.l6.m2.1.1.6.cmml" xref="alg1.l6.m2.1.1.6"><csymbol cd="ambiguous" id="alg1.l6.m2.1.1.6.1.cmml" xref="alg1.l6.m2.1.1.6">subscript</csymbol><ci id="alg1.l6.m2.1.1.6.2.cmml" xref="alg1.l6.m2.1.1.6.2">𝛽</ci><ci id="alg1.l6.m2.1.1.6.3.cmml" xref="alg1.l6.m2.1.1.6.3">ℎ</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.m2.1c">\beta_{l}&lt;\beta&lt;\beta_{h}</annotation><annotation encoding="application/x-llamapun" id="alg1.l6.m2.1d">italic_β start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT &lt; italic_β &lt; italic_β start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT</annotation></semantics></math><span class="ltx_text" id="alg1.l6.4" style="font-size:80%;"> from the profiler
</span>
</div>
<div class="ltx_listingline" id="alg1.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l7.1.1.1" style="font-size:80%;">7:</span></span><span class="ltx_text" id="alg1.l7.2" style="font-size:80%;">        </span><math alttext="T_{l}\leftarrow T(\alpha_{l},\beta_{l})+\frac{\alpha-\alpha_{l}}{\alpha_{h}-%
\alpha_{l}}\cdot[T(\alpha_{h},\beta_{l})-T(\alpha_{l},\beta_{l})]" class="ltx_Math" display="inline" id="alg1.l7.m1.3"><semantics id="alg1.l7.m1.3a"><mrow id="alg1.l7.m1.3.3" xref="alg1.l7.m1.3.3.cmml"><msub id="alg1.l7.m1.3.3.5" xref="alg1.l7.m1.3.3.5.cmml"><mi id="alg1.l7.m1.3.3.5.2" mathsize="80%" xref="alg1.l7.m1.3.3.5.2.cmml">T</mi><mi id="alg1.l7.m1.3.3.5.3" mathsize="80%" xref="alg1.l7.m1.3.3.5.3.cmml">l</mi></msub><mo id="alg1.l7.m1.3.3.4" mathsize="80%" stretchy="false" xref="alg1.l7.m1.3.3.4.cmml">←</mo><mrow id="alg1.l7.m1.3.3.3" xref="alg1.l7.m1.3.3.3.cmml"><mrow id="alg1.l7.m1.2.2.2.2" xref="alg1.l7.m1.2.2.2.2.cmml"><mi id="alg1.l7.m1.2.2.2.2.4" mathsize="80%" xref="alg1.l7.m1.2.2.2.2.4.cmml">T</mi><mo id="alg1.l7.m1.2.2.2.2.3" xref="alg1.l7.m1.2.2.2.2.3.cmml">⁢</mo><mrow id="alg1.l7.m1.2.2.2.2.2.2" xref="alg1.l7.m1.2.2.2.2.2.3.cmml"><mo id="alg1.l7.m1.2.2.2.2.2.2.3" maxsize="80%" minsize="80%" xref="alg1.l7.m1.2.2.2.2.2.3.cmml">(</mo><msub id="alg1.l7.m1.1.1.1.1.1.1.1" xref="alg1.l7.m1.1.1.1.1.1.1.1.cmml"><mi id="alg1.l7.m1.1.1.1.1.1.1.1.2" mathsize="80%" xref="alg1.l7.m1.1.1.1.1.1.1.1.2.cmml">α</mi><mi id="alg1.l7.m1.1.1.1.1.1.1.1.3" mathsize="80%" xref="alg1.l7.m1.1.1.1.1.1.1.1.3.cmml">l</mi></msub><mo id="alg1.l7.m1.2.2.2.2.2.2.4" mathsize="80%" xref="alg1.l7.m1.2.2.2.2.2.3.cmml">,</mo><msub id="alg1.l7.m1.2.2.2.2.2.2.2" xref="alg1.l7.m1.2.2.2.2.2.2.2.cmml"><mi id="alg1.l7.m1.2.2.2.2.2.2.2.2" mathsize="80%" xref="alg1.l7.m1.2.2.2.2.2.2.2.2.cmml">β</mi><mi id="alg1.l7.m1.2.2.2.2.2.2.2.3" mathsize="80%" xref="alg1.l7.m1.2.2.2.2.2.2.2.3.cmml">l</mi></msub><mo id="alg1.l7.m1.2.2.2.2.2.2.5" maxsize="80%" minsize="80%" xref="alg1.l7.m1.2.2.2.2.2.3.cmml">)</mo></mrow></mrow><mo id="alg1.l7.m1.3.3.3.4" mathsize="80%" xref="alg1.l7.m1.3.3.3.4.cmml">+</mo><mrow id="alg1.l7.m1.3.3.3.3" xref="alg1.l7.m1.3.3.3.3.cmml"><mfrac id="alg1.l7.m1.3.3.3.3.3" xref="alg1.l7.m1.3.3.3.3.3.cmml"><mrow id="alg1.l7.m1.3.3.3.3.3.2" xref="alg1.l7.m1.3.3.3.3.3.2.cmml"><mi id="alg1.l7.m1.3.3.3.3.3.2.2" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.3.2.2.cmml">α</mi><mo id="alg1.l7.m1.3.3.3.3.3.2.1" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.3.2.1.cmml">−</mo><msub id="alg1.l7.m1.3.3.3.3.3.2.3" xref="alg1.l7.m1.3.3.3.3.3.2.3.cmml"><mi id="alg1.l7.m1.3.3.3.3.3.2.3.2" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.3.2.3.2.cmml">α</mi><mi id="alg1.l7.m1.3.3.3.3.3.2.3.3" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.3.2.3.3.cmml">l</mi></msub></mrow><mrow id="alg1.l7.m1.3.3.3.3.3.3" xref="alg1.l7.m1.3.3.3.3.3.3.cmml"><msub id="alg1.l7.m1.3.3.3.3.3.3.2" xref="alg1.l7.m1.3.3.3.3.3.3.2.cmml"><mi id="alg1.l7.m1.3.3.3.3.3.3.2.2" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.3.3.2.2.cmml">α</mi><mi id="alg1.l7.m1.3.3.3.3.3.3.2.3" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.3.3.2.3.cmml">h</mi></msub><mo id="alg1.l7.m1.3.3.3.3.3.3.1" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.3.3.1.cmml">−</mo><msub id="alg1.l7.m1.3.3.3.3.3.3.3" xref="alg1.l7.m1.3.3.3.3.3.3.3.cmml"><mi id="alg1.l7.m1.3.3.3.3.3.3.3.2" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.3.3.3.2.cmml">α</mi><mi id="alg1.l7.m1.3.3.3.3.3.3.3.3" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.3.3.3.3.cmml">l</mi></msub></mrow></mfrac><mo id="alg1.l7.m1.3.3.3.3.2" lspace="0.222em" mathsize="80%" rspace="0.222em" xref="alg1.l7.m1.3.3.3.3.2.cmml">⋅</mo><mrow id="alg1.l7.m1.3.3.3.3.1.1" xref="alg1.l7.m1.3.3.3.3.1.2.cmml"><mo id="alg1.l7.m1.3.3.3.3.1.1.2" maxsize="80%" minsize="80%" xref="alg1.l7.m1.3.3.3.3.1.2.1.cmml">[</mo><mrow id="alg1.l7.m1.3.3.3.3.1.1.1" xref="alg1.l7.m1.3.3.3.3.1.1.1.cmml"><mrow id="alg1.l7.m1.3.3.3.3.1.1.1.2" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.cmml"><mi id="alg1.l7.m1.3.3.3.3.1.1.1.2.4" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.4.cmml">T</mi><mo id="alg1.l7.m1.3.3.3.3.1.1.1.2.3" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.3.cmml">⁢</mo><mrow id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.3.cmml"><mo id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.3" maxsize="80%" minsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.3.cmml">(</mo><msub id="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1" xref="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.cmml"><mi id="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.2" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.2.cmml">α</mi><mi id="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.3" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.3.cmml">h</mi></msub><mo id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.4" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.3.cmml">,</mo><msub id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.cmml"><mi id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.2" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.2.cmml">β</mi><mi id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.3" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.3.cmml">l</mi></msub><mo id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.5" maxsize="80%" minsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.3.cmml">)</mo></mrow></mrow><mo id="alg1.l7.m1.3.3.3.3.1.1.1.5" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.5.cmml">−</mo><mrow id="alg1.l7.m1.3.3.3.3.1.1.1.4" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.cmml"><mi id="alg1.l7.m1.3.3.3.3.1.1.1.4.4" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.4.cmml">T</mi><mo id="alg1.l7.m1.3.3.3.3.1.1.1.4.3" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.3.cmml">⁢</mo><mrow id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.3.cmml"><mo id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.3" maxsize="80%" minsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.3.cmml">(</mo><msub id="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1" xref="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.cmml"><mi id="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.2" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.2.cmml">α</mi><mi id="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.3" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.3.cmml">l</mi></msub><mo id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.4" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.3.cmml">,</mo><msub id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.cmml"><mi id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.2" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.2.cmml">β</mi><mi id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.3" mathsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.3.cmml">l</mi></msub><mo id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.5" maxsize="80%" minsize="80%" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="alg1.l7.m1.3.3.3.3.1.1.3" maxsize="80%" minsize="80%" xref="alg1.l7.m1.3.3.3.3.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l7.m1.3b"><apply id="alg1.l7.m1.3.3.cmml" xref="alg1.l7.m1.3.3"><ci id="alg1.l7.m1.3.3.4.cmml" xref="alg1.l7.m1.3.3.4">←</ci><apply id="alg1.l7.m1.3.3.5.cmml" xref="alg1.l7.m1.3.3.5"><csymbol cd="ambiguous" id="alg1.l7.m1.3.3.5.1.cmml" xref="alg1.l7.m1.3.3.5">subscript</csymbol><ci id="alg1.l7.m1.3.3.5.2.cmml" xref="alg1.l7.m1.3.3.5.2">𝑇</ci><ci id="alg1.l7.m1.3.3.5.3.cmml" xref="alg1.l7.m1.3.3.5.3">𝑙</ci></apply><apply id="alg1.l7.m1.3.3.3.cmml" xref="alg1.l7.m1.3.3.3"><plus id="alg1.l7.m1.3.3.3.4.cmml" xref="alg1.l7.m1.3.3.3.4"></plus><apply id="alg1.l7.m1.2.2.2.2.cmml" xref="alg1.l7.m1.2.2.2.2"><times id="alg1.l7.m1.2.2.2.2.3.cmml" xref="alg1.l7.m1.2.2.2.2.3"></times><ci id="alg1.l7.m1.2.2.2.2.4.cmml" xref="alg1.l7.m1.2.2.2.2.4">𝑇</ci><interval closure="open" id="alg1.l7.m1.2.2.2.2.2.3.cmml" xref="alg1.l7.m1.2.2.2.2.2.2"><apply id="alg1.l7.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l7.m1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l7.m1.1.1.1.1.1.1.1.1.cmml" xref="alg1.l7.m1.1.1.1.1.1.1.1">subscript</csymbol><ci id="alg1.l7.m1.1.1.1.1.1.1.1.2.cmml" xref="alg1.l7.m1.1.1.1.1.1.1.1.2">𝛼</ci><ci id="alg1.l7.m1.1.1.1.1.1.1.1.3.cmml" xref="alg1.l7.m1.1.1.1.1.1.1.1.3">𝑙</ci></apply><apply id="alg1.l7.m1.2.2.2.2.2.2.2.cmml" xref="alg1.l7.m1.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l7.m1.2.2.2.2.2.2.2.1.cmml" xref="alg1.l7.m1.2.2.2.2.2.2.2">subscript</csymbol><ci id="alg1.l7.m1.2.2.2.2.2.2.2.2.cmml" xref="alg1.l7.m1.2.2.2.2.2.2.2.2">𝛽</ci><ci id="alg1.l7.m1.2.2.2.2.2.2.2.3.cmml" xref="alg1.l7.m1.2.2.2.2.2.2.2.3">𝑙</ci></apply></interval></apply><apply id="alg1.l7.m1.3.3.3.3.cmml" xref="alg1.l7.m1.3.3.3.3"><ci id="alg1.l7.m1.3.3.3.3.2.cmml" xref="alg1.l7.m1.3.3.3.3.2">⋅</ci><apply id="alg1.l7.m1.3.3.3.3.3.cmml" xref="alg1.l7.m1.3.3.3.3.3"><divide id="alg1.l7.m1.3.3.3.3.3.1.cmml" xref="alg1.l7.m1.3.3.3.3.3"></divide><apply id="alg1.l7.m1.3.3.3.3.3.2.cmml" xref="alg1.l7.m1.3.3.3.3.3.2"><minus id="alg1.l7.m1.3.3.3.3.3.2.1.cmml" xref="alg1.l7.m1.3.3.3.3.3.2.1"></minus><ci id="alg1.l7.m1.3.3.3.3.3.2.2.cmml" xref="alg1.l7.m1.3.3.3.3.3.2.2">𝛼</ci><apply id="alg1.l7.m1.3.3.3.3.3.2.3.cmml" xref="alg1.l7.m1.3.3.3.3.3.2.3"><csymbol cd="ambiguous" id="alg1.l7.m1.3.3.3.3.3.2.3.1.cmml" xref="alg1.l7.m1.3.3.3.3.3.2.3">subscript</csymbol><ci id="alg1.l7.m1.3.3.3.3.3.2.3.2.cmml" xref="alg1.l7.m1.3.3.3.3.3.2.3.2">𝛼</ci><ci id="alg1.l7.m1.3.3.3.3.3.2.3.3.cmml" xref="alg1.l7.m1.3.3.3.3.3.2.3.3">𝑙</ci></apply></apply><apply id="alg1.l7.m1.3.3.3.3.3.3.cmml" xref="alg1.l7.m1.3.3.3.3.3.3"><minus id="alg1.l7.m1.3.3.3.3.3.3.1.cmml" xref="alg1.l7.m1.3.3.3.3.3.3.1"></minus><apply id="alg1.l7.m1.3.3.3.3.3.3.2.cmml" xref="alg1.l7.m1.3.3.3.3.3.3.2"><csymbol cd="ambiguous" id="alg1.l7.m1.3.3.3.3.3.3.2.1.cmml" xref="alg1.l7.m1.3.3.3.3.3.3.2">subscript</csymbol><ci id="alg1.l7.m1.3.3.3.3.3.3.2.2.cmml" xref="alg1.l7.m1.3.3.3.3.3.3.2.2">𝛼</ci><ci id="alg1.l7.m1.3.3.3.3.3.3.2.3.cmml" xref="alg1.l7.m1.3.3.3.3.3.3.2.3">ℎ</ci></apply><apply id="alg1.l7.m1.3.3.3.3.3.3.3.cmml" xref="alg1.l7.m1.3.3.3.3.3.3.3"><csymbol cd="ambiguous" id="alg1.l7.m1.3.3.3.3.3.3.3.1.cmml" xref="alg1.l7.m1.3.3.3.3.3.3.3">subscript</csymbol><ci id="alg1.l7.m1.3.3.3.3.3.3.3.2.cmml" xref="alg1.l7.m1.3.3.3.3.3.3.3.2">𝛼</ci><ci id="alg1.l7.m1.3.3.3.3.3.3.3.3.cmml" xref="alg1.l7.m1.3.3.3.3.3.3.3.3">𝑙</ci></apply></apply></apply><apply id="alg1.l7.m1.3.3.3.3.1.2.cmml" xref="alg1.l7.m1.3.3.3.3.1.1"><csymbol cd="latexml" id="alg1.l7.m1.3.3.3.3.1.2.1.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.2">delimited-[]</csymbol><apply id="alg1.l7.m1.3.3.3.3.1.1.1.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1"><minus id="alg1.l7.m1.3.3.3.3.1.1.1.5.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.5"></minus><apply id="alg1.l7.m1.3.3.3.3.1.1.1.2.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.2"><times id="alg1.l7.m1.3.3.3.3.1.1.1.2.3.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.3"></times><ci id="alg1.l7.m1.3.3.3.3.1.1.1.2.4.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.4">𝑇</ci><interval closure="open" id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.3.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2"><apply id="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.1.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1">subscript</csymbol><ci id="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.2.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.2">𝛼</ci><ci id="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.3.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.1.1.1.1.3">ℎ</ci></apply><apply id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.1.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2">subscript</csymbol><ci id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.2.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.2">𝛽</ci><ci id="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.3.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.2.2.2.2.3">𝑙</ci></apply></interval></apply><apply id="alg1.l7.m1.3.3.3.3.1.1.1.4.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.4"><times id="alg1.l7.m1.3.3.3.3.1.1.1.4.3.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.3"></times><ci id="alg1.l7.m1.3.3.3.3.1.1.1.4.4.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.4">𝑇</ci><interval closure="open" id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.3.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2"><apply id="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1"><csymbol cd="ambiguous" id="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.1.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1">subscript</csymbol><ci id="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.2.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.2">𝛼</ci><ci id="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.3.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.3.1.1.1.3">𝑙</ci></apply><apply id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2"><csymbol cd="ambiguous" id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.1.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2">subscript</csymbol><ci id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.2.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.2">𝛽</ci><ci id="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.3.cmml" xref="alg1.l7.m1.3.3.3.3.1.1.1.4.2.2.2.3">𝑙</ci></apply></interval></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l7.m1.3c">T_{l}\leftarrow T(\alpha_{l},\beta_{l})+\frac{\alpha-\alpha_{l}}{\alpha_{h}-%
\alpha_{l}}\cdot[T(\alpha_{h},\beta_{l})-T(\alpha_{l},\beta_{l})]</annotation><annotation encoding="application/x-llamapun" id="alg1.l7.m1.3d">italic_T start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ← italic_T ( italic_α start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT , italic_β start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) + divide start_ARG italic_α - italic_α start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT end_ARG start_ARG italic_α start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT - italic_α start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT end_ARG ⋅ [ italic_T ( italic_α start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT , italic_β start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) - italic_T ( italic_α start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT , italic_β start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) ]</annotation></semantics></math><span class="ltx_text" id="alg1.l7.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l8.1.1.1" style="font-size:80%;">8:</span></span><span class="ltx_text" id="alg1.l8.2" style="font-size:80%;">        </span><math alttext="T_{h}\leftarrow T(\alpha_{l},\beta_{h})+\frac{\alpha-\alpha_{l}}{\alpha_{h}-%
\alpha_{l}}\cdot[T(\alpha_{h},\beta_{h})-T(\alpha_{l},\beta_{h})]" class="ltx_Math" display="inline" id="alg1.l8.m1.3"><semantics id="alg1.l8.m1.3a"><mrow id="alg1.l8.m1.3.3" xref="alg1.l8.m1.3.3.cmml"><msub id="alg1.l8.m1.3.3.5" xref="alg1.l8.m1.3.3.5.cmml"><mi id="alg1.l8.m1.3.3.5.2" mathsize="80%" xref="alg1.l8.m1.3.3.5.2.cmml">T</mi><mi id="alg1.l8.m1.3.3.5.3" mathsize="80%" xref="alg1.l8.m1.3.3.5.3.cmml">h</mi></msub><mo id="alg1.l8.m1.3.3.4" mathsize="80%" stretchy="false" xref="alg1.l8.m1.3.3.4.cmml">←</mo><mrow id="alg1.l8.m1.3.3.3" xref="alg1.l8.m1.3.3.3.cmml"><mrow id="alg1.l8.m1.2.2.2.2" xref="alg1.l8.m1.2.2.2.2.cmml"><mi id="alg1.l8.m1.2.2.2.2.4" mathsize="80%" xref="alg1.l8.m1.2.2.2.2.4.cmml">T</mi><mo id="alg1.l8.m1.2.2.2.2.3" xref="alg1.l8.m1.2.2.2.2.3.cmml">⁢</mo><mrow id="alg1.l8.m1.2.2.2.2.2.2" xref="alg1.l8.m1.2.2.2.2.2.3.cmml"><mo id="alg1.l8.m1.2.2.2.2.2.2.3" maxsize="80%" minsize="80%" xref="alg1.l8.m1.2.2.2.2.2.3.cmml">(</mo><msub id="alg1.l8.m1.1.1.1.1.1.1.1" xref="alg1.l8.m1.1.1.1.1.1.1.1.cmml"><mi id="alg1.l8.m1.1.1.1.1.1.1.1.2" mathsize="80%" xref="alg1.l8.m1.1.1.1.1.1.1.1.2.cmml">α</mi><mi id="alg1.l8.m1.1.1.1.1.1.1.1.3" mathsize="80%" xref="alg1.l8.m1.1.1.1.1.1.1.1.3.cmml">l</mi></msub><mo id="alg1.l8.m1.2.2.2.2.2.2.4" mathsize="80%" xref="alg1.l8.m1.2.2.2.2.2.3.cmml">,</mo><msub id="alg1.l8.m1.2.2.2.2.2.2.2" xref="alg1.l8.m1.2.2.2.2.2.2.2.cmml"><mi id="alg1.l8.m1.2.2.2.2.2.2.2.2" mathsize="80%" xref="alg1.l8.m1.2.2.2.2.2.2.2.2.cmml">β</mi><mi id="alg1.l8.m1.2.2.2.2.2.2.2.3" mathsize="80%" xref="alg1.l8.m1.2.2.2.2.2.2.2.3.cmml">h</mi></msub><mo id="alg1.l8.m1.2.2.2.2.2.2.5" maxsize="80%" minsize="80%" xref="alg1.l8.m1.2.2.2.2.2.3.cmml">)</mo></mrow></mrow><mo id="alg1.l8.m1.3.3.3.4" mathsize="80%" xref="alg1.l8.m1.3.3.3.4.cmml">+</mo><mrow id="alg1.l8.m1.3.3.3.3" xref="alg1.l8.m1.3.3.3.3.cmml"><mfrac id="alg1.l8.m1.3.3.3.3.3" xref="alg1.l8.m1.3.3.3.3.3.cmml"><mrow id="alg1.l8.m1.3.3.3.3.3.2" xref="alg1.l8.m1.3.3.3.3.3.2.cmml"><mi id="alg1.l8.m1.3.3.3.3.3.2.2" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.3.2.2.cmml">α</mi><mo id="alg1.l8.m1.3.3.3.3.3.2.1" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.3.2.1.cmml">−</mo><msub id="alg1.l8.m1.3.3.3.3.3.2.3" xref="alg1.l8.m1.3.3.3.3.3.2.3.cmml"><mi id="alg1.l8.m1.3.3.3.3.3.2.3.2" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.3.2.3.2.cmml">α</mi><mi id="alg1.l8.m1.3.3.3.3.3.2.3.3" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.3.2.3.3.cmml">l</mi></msub></mrow><mrow id="alg1.l8.m1.3.3.3.3.3.3" xref="alg1.l8.m1.3.3.3.3.3.3.cmml"><msub id="alg1.l8.m1.3.3.3.3.3.3.2" xref="alg1.l8.m1.3.3.3.3.3.3.2.cmml"><mi id="alg1.l8.m1.3.3.3.3.3.3.2.2" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.3.3.2.2.cmml">α</mi><mi id="alg1.l8.m1.3.3.3.3.3.3.2.3" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.3.3.2.3.cmml">h</mi></msub><mo id="alg1.l8.m1.3.3.3.3.3.3.1" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.3.3.1.cmml">−</mo><msub id="alg1.l8.m1.3.3.3.3.3.3.3" xref="alg1.l8.m1.3.3.3.3.3.3.3.cmml"><mi id="alg1.l8.m1.3.3.3.3.3.3.3.2" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.3.3.3.2.cmml">α</mi><mi id="alg1.l8.m1.3.3.3.3.3.3.3.3" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.3.3.3.3.cmml">l</mi></msub></mrow></mfrac><mo id="alg1.l8.m1.3.3.3.3.2" lspace="0.222em" mathsize="80%" rspace="0.222em" xref="alg1.l8.m1.3.3.3.3.2.cmml">⋅</mo><mrow id="alg1.l8.m1.3.3.3.3.1.1" xref="alg1.l8.m1.3.3.3.3.1.2.cmml"><mo id="alg1.l8.m1.3.3.3.3.1.1.2" maxsize="80%" minsize="80%" xref="alg1.l8.m1.3.3.3.3.1.2.1.cmml">[</mo><mrow id="alg1.l8.m1.3.3.3.3.1.1.1" xref="alg1.l8.m1.3.3.3.3.1.1.1.cmml"><mrow id="alg1.l8.m1.3.3.3.3.1.1.1.2" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.cmml"><mi id="alg1.l8.m1.3.3.3.3.1.1.1.2.4" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.4.cmml">T</mi><mo id="alg1.l8.m1.3.3.3.3.1.1.1.2.3" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.3.cmml">⁢</mo><mrow id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.3.cmml"><mo id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.3" maxsize="80%" minsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.3.cmml">(</mo><msub id="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1" xref="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.cmml"><mi id="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.2" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.2.cmml">α</mi><mi id="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.3" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.3.cmml">h</mi></msub><mo id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.4" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.3.cmml">,</mo><msub id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.cmml"><mi id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.2" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.2.cmml">β</mi><mi id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.3" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.3.cmml">h</mi></msub><mo id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.5" maxsize="80%" minsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.3.cmml">)</mo></mrow></mrow><mo id="alg1.l8.m1.3.3.3.3.1.1.1.5" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.5.cmml">−</mo><mrow id="alg1.l8.m1.3.3.3.3.1.1.1.4" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.cmml"><mi id="alg1.l8.m1.3.3.3.3.1.1.1.4.4" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.4.cmml">T</mi><mo id="alg1.l8.m1.3.3.3.3.1.1.1.4.3" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.3.cmml">⁢</mo><mrow id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.3.cmml"><mo id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.3" maxsize="80%" minsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.3.cmml">(</mo><msub id="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1" xref="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.cmml"><mi id="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.2" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.2.cmml">α</mi><mi id="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.3" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.3.cmml">l</mi></msub><mo id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.4" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.3.cmml">,</mo><msub id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.cmml"><mi id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.2" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.2.cmml">β</mi><mi id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.3" mathsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.3.cmml">h</mi></msub><mo id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.5" maxsize="80%" minsize="80%" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="alg1.l8.m1.3.3.3.3.1.1.3" maxsize="80%" minsize="80%" xref="alg1.l8.m1.3.3.3.3.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l8.m1.3b"><apply id="alg1.l8.m1.3.3.cmml" xref="alg1.l8.m1.3.3"><ci id="alg1.l8.m1.3.3.4.cmml" xref="alg1.l8.m1.3.3.4">←</ci><apply id="alg1.l8.m1.3.3.5.cmml" xref="alg1.l8.m1.3.3.5"><csymbol cd="ambiguous" id="alg1.l8.m1.3.3.5.1.cmml" xref="alg1.l8.m1.3.3.5">subscript</csymbol><ci id="alg1.l8.m1.3.3.5.2.cmml" xref="alg1.l8.m1.3.3.5.2">𝑇</ci><ci id="alg1.l8.m1.3.3.5.3.cmml" xref="alg1.l8.m1.3.3.5.3">ℎ</ci></apply><apply id="alg1.l8.m1.3.3.3.cmml" xref="alg1.l8.m1.3.3.3"><plus id="alg1.l8.m1.3.3.3.4.cmml" xref="alg1.l8.m1.3.3.3.4"></plus><apply id="alg1.l8.m1.2.2.2.2.cmml" xref="alg1.l8.m1.2.2.2.2"><times id="alg1.l8.m1.2.2.2.2.3.cmml" xref="alg1.l8.m1.2.2.2.2.3"></times><ci id="alg1.l8.m1.2.2.2.2.4.cmml" xref="alg1.l8.m1.2.2.2.2.4">𝑇</ci><interval closure="open" id="alg1.l8.m1.2.2.2.2.2.3.cmml" xref="alg1.l8.m1.2.2.2.2.2.2"><apply id="alg1.l8.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l8.m1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l8.m1.1.1.1.1.1.1.1.1.cmml" xref="alg1.l8.m1.1.1.1.1.1.1.1">subscript</csymbol><ci id="alg1.l8.m1.1.1.1.1.1.1.1.2.cmml" xref="alg1.l8.m1.1.1.1.1.1.1.1.2">𝛼</ci><ci id="alg1.l8.m1.1.1.1.1.1.1.1.3.cmml" xref="alg1.l8.m1.1.1.1.1.1.1.1.3">𝑙</ci></apply><apply id="alg1.l8.m1.2.2.2.2.2.2.2.cmml" xref="alg1.l8.m1.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l8.m1.2.2.2.2.2.2.2.1.cmml" xref="alg1.l8.m1.2.2.2.2.2.2.2">subscript</csymbol><ci id="alg1.l8.m1.2.2.2.2.2.2.2.2.cmml" xref="alg1.l8.m1.2.2.2.2.2.2.2.2">𝛽</ci><ci id="alg1.l8.m1.2.2.2.2.2.2.2.3.cmml" xref="alg1.l8.m1.2.2.2.2.2.2.2.3">ℎ</ci></apply></interval></apply><apply id="alg1.l8.m1.3.3.3.3.cmml" xref="alg1.l8.m1.3.3.3.3"><ci id="alg1.l8.m1.3.3.3.3.2.cmml" xref="alg1.l8.m1.3.3.3.3.2">⋅</ci><apply id="alg1.l8.m1.3.3.3.3.3.cmml" xref="alg1.l8.m1.3.3.3.3.3"><divide id="alg1.l8.m1.3.3.3.3.3.1.cmml" xref="alg1.l8.m1.3.3.3.3.3"></divide><apply id="alg1.l8.m1.3.3.3.3.3.2.cmml" xref="alg1.l8.m1.3.3.3.3.3.2"><minus id="alg1.l8.m1.3.3.3.3.3.2.1.cmml" xref="alg1.l8.m1.3.3.3.3.3.2.1"></minus><ci id="alg1.l8.m1.3.3.3.3.3.2.2.cmml" xref="alg1.l8.m1.3.3.3.3.3.2.2">𝛼</ci><apply id="alg1.l8.m1.3.3.3.3.3.2.3.cmml" xref="alg1.l8.m1.3.3.3.3.3.2.3"><csymbol cd="ambiguous" id="alg1.l8.m1.3.3.3.3.3.2.3.1.cmml" xref="alg1.l8.m1.3.3.3.3.3.2.3">subscript</csymbol><ci id="alg1.l8.m1.3.3.3.3.3.2.3.2.cmml" xref="alg1.l8.m1.3.3.3.3.3.2.3.2">𝛼</ci><ci id="alg1.l8.m1.3.3.3.3.3.2.3.3.cmml" xref="alg1.l8.m1.3.3.3.3.3.2.3.3">𝑙</ci></apply></apply><apply id="alg1.l8.m1.3.3.3.3.3.3.cmml" xref="alg1.l8.m1.3.3.3.3.3.3"><minus id="alg1.l8.m1.3.3.3.3.3.3.1.cmml" xref="alg1.l8.m1.3.3.3.3.3.3.1"></minus><apply id="alg1.l8.m1.3.3.3.3.3.3.2.cmml" xref="alg1.l8.m1.3.3.3.3.3.3.2"><csymbol cd="ambiguous" id="alg1.l8.m1.3.3.3.3.3.3.2.1.cmml" xref="alg1.l8.m1.3.3.3.3.3.3.2">subscript</csymbol><ci id="alg1.l8.m1.3.3.3.3.3.3.2.2.cmml" xref="alg1.l8.m1.3.3.3.3.3.3.2.2">𝛼</ci><ci id="alg1.l8.m1.3.3.3.3.3.3.2.3.cmml" xref="alg1.l8.m1.3.3.3.3.3.3.2.3">ℎ</ci></apply><apply id="alg1.l8.m1.3.3.3.3.3.3.3.cmml" xref="alg1.l8.m1.3.3.3.3.3.3.3"><csymbol cd="ambiguous" id="alg1.l8.m1.3.3.3.3.3.3.3.1.cmml" xref="alg1.l8.m1.3.3.3.3.3.3.3">subscript</csymbol><ci id="alg1.l8.m1.3.3.3.3.3.3.3.2.cmml" xref="alg1.l8.m1.3.3.3.3.3.3.3.2">𝛼</ci><ci id="alg1.l8.m1.3.3.3.3.3.3.3.3.cmml" xref="alg1.l8.m1.3.3.3.3.3.3.3.3">𝑙</ci></apply></apply></apply><apply id="alg1.l8.m1.3.3.3.3.1.2.cmml" xref="alg1.l8.m1.3.3.3.3.1.1"><csymbol cd="latexml" id="alg1.l8.m1.3.3.3.3.1.2.1.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.2">delimited-[]</csymbol><apply id="alg1.l8.m1.3.3.3.3.1.1.1.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1"><minus id="alg1.l8.m1.3.3.3.3.1.1.1.5.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.5"></minus><apply id="alg1.l8.m1.3.3.3.3.1.1.1.2.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.2"><times id="alg1.l8.m1.3.3.3.3.1.1.1.2.3.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.3"></times><ci id="alg1.l8.m1.3.3.3.3.1.1.1.2.4.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.4">𝑇</ci><interval closure="open" id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.3.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2"><apply id="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.1.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1">subscript</csymbol><ci id="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.2.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.2">𝛼</ci><ci id="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.3.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.1.1.1.1.3">ℎ</ci></apply><apply id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.1.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2">subscript</csymbol><ci id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.2.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.2">𝛽</ci><ci id="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.3.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.2.2.2.2.3">ℎ</ci></apply></interval></apply><apply id="alg1.l8.m1.3.3.3.3.1.1.1.4.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.4"><times id="alg1.l8.m1.3.3.3.3.1.1.1.4.3.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.3"></times><ci id="alg1.l8.m1.3.3.3.3.1.1.1.4.4.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.4">𝑇</ci><interval closure="open" id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.3.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2"><apply id="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1"><csymbol cd="ambiguous" id="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.1.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1">subscript</csymbol><ci id="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.2.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.2">𝛼</ci><ci id="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.3.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.3.1.1.1.3">𝑙</ci></apply><apply id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2"><csymbol cd="ambiguous" id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.1.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2">subscript</csymbol><ci id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.2.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.2">𝛽</ci><ci id="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.3.cmml" xref="alg1.l8.m1.3.3.3.3.1.1.1.4.2.2.2.3">ℎ</ci></apply></interval></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l8.m1.3c">T_{h}\leftarrow T(\alpha_{l},\beta_{h})+\frac{\alpha-\alpha_{l}}{\alpha_{h}-%
\alpha_{l}}\cdot[T(\alpha_{h},\beta_{h})-T(\alpha_{l},\beta_{h})]</annotation><annotation encoding="application/x-llamapun" id="alg1.l8.m1.3d">italic_T start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT ← italic_T ( italic_α start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT , italic_β start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT ) + divide start_ARG italic_α - italic_α start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT end_ARG start_ARG italic_α start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT - italic_α start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT end_ARG ⋅ [ italic_T ( italic_α start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT , italic_β start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT ) - italic_T ( italic_α start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT , italic_β start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT ) ]</annotation></semantics></math><span class="ltx_text" id="alg1.l8.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l9.1.1.1" style="font-size:80%;">9:</span></span><span class="ltx_text" id="alg1.l9.2" style="font-size:80%;">        </span><math alttext="T(\alpha,\beta)\leftarrow T_{l}+\frac{\beta-\beta_{l}}{\beta_{h}-\beta_{l}}%
\cdot(T_{h}-T_{l})" class="ltx_Math" display="inline" id="alg1.l9.m1.3"><semantics id="alg1.l9.m1.3a"><mrow id="alg1.l9.m1.3.3" xref="alg1.l9.m1.3.3.cmml"><mrow id="alg1.l9.m1.3.3.3" xref="alg1.l9.m1.3.3.3.cmml"><mi id="alg1.l9.m1.3.3.3.2" mathsize="80%" xref="alg1.l9.m1.3.3.3.2.cmml">T</mi><mo id="alg1.l9.m1.3.3.3.1" xref="alg1.l9.m1.3.3.3.1.cmml">⁢</mo><mrow id="alg1.l9.m1.3.3.3.3.2" xref="alg1.l9.m1.3.3.3.3.1.cmml"><mo id="alg1.l9.m1.3.3.3.3.2.1" maxsize="80%" minsize="80%" xref="alg1.l9.m1.3.3.3.3.1.cmml">(</mo><mi id="alg1.l9.m1.1.1" mathsize="80%" xref="alg1.l9.m1.1.1.cmml">α</mi><mo id="alg1.l9.m1.3.3.3.3.2.2" mathsize="80%" xref="alg1.l9.m1.3.3.3.3.1.cmml">,</mo><mi id="alg1.l9.m1.2.2" mathsize="80%" xref="alg1.l9.m1.2.2.cmml">β</mi><mo id="alg1.l9.m1.3.3.3.3.2.3" maxsize="80%" minsize="80%" xref="alg1.l9.m1.3.3.3.3.1.cmml">)</mo></mrow></mrow><mo id="alg1.l9.m1.3.3.2" mathsize="80%" stretchy="false" xref="alg1.l9.m1.3.3.2.cmml">←</mo><mrow id="alg1.l9.m1.3.3.1" xref="alg1.l9.m1.3.3.1.cmml"><msub id="alg1.l9.m1.3.3.1.3" xref="alg1.l9.m1.3.3.1.3.cmml"><mi id="alg1.l9.m1.3.3.1.3.2" mathsize="80%" xref="alg1.l9.m1.3.3.1.3.2.cmml">T</mi><mi id="alg1.l9.m1.3.3.1.3.3" mathsize="80%" xref="alg1.l9.m1.3.3.1.3.3.cmml">l</mi></msub><mo id="alg1.l9.m1.3.3.1.2" mathsize="80%" xref="alg1.l9.m1.3.3.1.2.cmml">+</mo><mrow id="alg1.l9.m1.3.3.1.1" xref="alg1.l9.m1.3.3.1.1.cmml"><mfrac id="alg1.l9.m1.3.3.1.1.3" xref="alg1.l9.m1.3.3.1.1.3.cmml"><mrow id="alg1.l9.m1.3.3.1.1.3.2" xref="alg1.l9.m1.3.3.1.1.3.2.cmml"><mi id="alg1.l9.m1.3.3.1.1.3.2.2" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.3.2.2.cmml">β</mi><mo id="alg1.l9.m1.3.3.1.1.3.2.1" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.3.2.1.cmml">−</mo><msub id="alg1.l9.m1.3.3.1.1.3.2.3" xref="alg1.l9.m1.3.3.1.1.3.2.3.cmml"><mi id="alg1.l9.m1.3.3.1.1.3.2.3.2" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.3.2.3.2.cmml">β</mi><mi id="alg1.l9.m1.3.3.1.1.3.2.3.3" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.3.2.3.3.cmml">l</mi></msub></mrow><mrow id="alg1.l9.m1.3.3.1.1.3.3" xref="alg1.l9.m1.3.3.1.1.3.3.cmml"><msub id="alg1.l9.m1.3.3.1.1.3.3.2" xref="alg1.l9.m1.3.3.1.1.3.3.2.cmml"><mi id="alg1.l9.m1.3.3.1.1.3.3.2.2" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.3.3.2.2.cmml">β</mi><mi id="alg1.l9.m1.3.3.1.1.3.3.2.3" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.3.3.2.3.cmml">h</mi></msub><mo id="alg1.l9.m1.3.3.1.1.3.3.1" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.3.3.1.cmml">−</mo><msub id="alg1.l9.m1.3.3.1.1.3.3.3" xref="alg1.l9.m1.3.3.1.1.3.3.3.cmml"><mi id="alg1.l9.m1.3.3.1.1.3.3.3.2" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.3.3.3.2.cmml">β</mi><mi id="alg1.l9.m1.3.3.1.1.3.3.3.3" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.3.3.3.3.cmml">l</mi></msub></mrow></mfrac><mo id="alg1.l9.m1.3.3.1.1.2" lspace="0.222em" mathsize="80%" rspace="0.222em" xref="alg1.l9.m1.3.3.1.1.2.cmml">⋅</mo><mrow id="alg1.l9.m1.3.3.1.1.1.1" xref="alg1.l9.m1.3.3.1.1.1.1.1.cmml"><mo id="alg1.l9.m1.3.3.1.1.1.1.2" maxsize="80%" minsize="80%" xref="alg1.l9.m1.3.3.1.1.1.1.1.cmml">(</mo><mrow id="alg1.l9.m1.3.3.1.1.1.1.1" xref="alg1.l9.m1.3.3.1.1.1.1.1.cmml"><msub id="alg1.l9.m1.3.3.1.1.1.1.1.2" xref="alg1.l9.m1.3.3.1.1.1.1.1.2.cmml"><mi id="alg1.l9.m1.3.3.1.1.1.1.1.2.2" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.1.1.1.2.2.cmml">T</mi><mi id="alg1.l9.m1.3.3.1.1.1.1.1.2.3" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.1.1.1.2.3.cmml">h</mi></msub><mo id="alg1.l9.m1.3.3.1.1.1.1.1.1" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.1.1.1.1.cmml">−</mo><msub id="alg1.l9.m1.3.3.1.1.1.1.1.3" xref="alg1.l9.m1.3.3.1.1.1.1.1.3.cmml"><mi id="alg1.l9.m1.3.3.1.1.1.1.1.3.2" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.1.1.1.3.2.cmml">T</mi><mi id="alg1.l9.m1.3.3.1.1.1.1.1.3.3" mathsize="80%" xref="alg1.l9.m1.3.3.1.1.1.1.1.3.3.cmml">l</mi></msub></mrow><mo id="alg1.l9.m1.3.3.1.1.1.1.3" maxsize="80%" minsize="80%" xref="alg1.l9.m1.3.3.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l9.m1.3b"><apply id="alg1.l9.m1.3.3.cmml" xref="alg1.l9.m1.3.3"><ci id="alg1.l9.m1.3.3.2.cmml" xref="alg1.l9.m1.3.3.2">←</ci><apply id="alg1.l9.m1.3.3.3.cmml" xref="alg1.l9.m1.3.3.3"><times id="alg1.l9.m1.3.3.3.1.cmml" xref="alg1.l9.m1.3.3.3.1"></times><ci id="alg1.l9.m1.3.3.3.2.cmml" xref="alg1.l9.m1.3.3.3.2">𝑇</ci><interval closure="open" id="alg1.l9.m1.3.3.3.3.1.cmml" xref="alg1.l9.m1.3.3.3.3.2"><ci id="alg1.l9.m1.1.1.cmml" xref="alg1.l9.m1.1.1">𝛼</ci><ci id="alg1.l9.m1.2.2.cmml" xref="alg1.l9.m1.2.2">𝛽</ci></interval></apply><apply id="alg1.l9.m1.3.3.1.cmml" xref="alg1.l9.m1.3.3.1"><plus id="alg1.l9.m1.3.3.1.2.cmml" xref="alg1.l9.m1.3.3.1.2"></plus><apply id="alg1.l9.m1.3.3.1.3.cmml" xref="alg1.l9.m1.3.3.1.3"><csymbol cd="ambiguous" id="alg1.l9.m1.3.3.1.3.1.cmml" xref="alg1.l9.m1.3.3.1.3">subscript</csymbol><ci id="alg1.l9.m1.3.3.1.3.2.cmml" xref="alg1.l9.m1.3.3.1.3.2">𝑇</ci><ci id="alg1.l9.m1.3.3.1.3.3.cmml" xref="alg1.l9.m1.3.3.1.3.3">𝑙</ci></apply><apply id="alg1.l9.m1.3.3.1.1.cmml" xref="alg1.l9.m1.3.3.1.1"><ci id="alg1.l9.m1.3.3.1.1.2.cmml" xref="alg1.l9.m1.3.3.1.1.2">⋅</ci><apply id="alg1.l9.m1.3.3.1.1.3.cmml" xref="alg1.l9.m1.3.3.1.1.3"><divide id="alg1.l9.m1.3.3.1.1.3.1.cmml" xref="alg1.l9.m1.3.3.1.1.3"></divide><apply id="alg1.l9.m1.3.3.1.1.3.2.cmml" xref="alg1.l9.m1.3.3.1.1.3.2"><minus id="alg1.l9.m1.3.3.1.1.3.2.1.cmml" xref="alg1.l9.m1.3.3.1.1.3.2.1"></minus><ci id="alg1.l9.m1.3.3.1.1.3.2.2.cmml" xref="alg1.l9.m1.3.3.1.1.3.2.2">𝛽</ci><apply id="alg1.l9.m1.3.3.1.1.3.2.3.cmml" xref="alg1.l9.m1.3.3.1.1.3.2.3"><csymbol cd="ambiguous" id="alg1.l9.m1.3.3.1.1.3.2.3.1.cmml" xref="alg1.l9.m1.3.3.1.1.3.2.3">subscript</csymbol><ci id="alg1.l9.m1.3.3.1.1.3.2.3.2.cmml" xref="alg1.l9.m1.3.3.1.1.3.2.3.2">𝛽</ci><ci id="alg1.l9.m1.3.3.1.1.3.2.3.3.cmml" xref="alg1.l9.m1.3.3.1.1.3.2.3.3">𝑙</ci></apply></apply><apply id="alg1.l9.m1.3.3.1.1.3.3.cmml" xref="alg1.l9.m1.3.3.1.1.3.3"><minus id="alg1.l9.m1.3.3.1.1.3.3.1.cmml" xref="alg1.l9.m1.3.3.1.1.3.3.1"></minus><apply id="alg1.l9.m1.3.3.1.1.3.3.2.cmml" xref="alg1.l9.m1.3.3.1.1.3.3.2"><csymbol cd="ambiguous" id="alg1.l9.m1.3.3.1.1.3.3.2.1.cmml" xref="alg1.l9.m1.3.3.1.1.3.3.2">subscript</csymbol><ci id="alg1.l9.m1.3.3.1.1.3.3.2.2.cmml" xref="alg1.l9.m1.3.3.1.1.3.3.2.2">𝛽</ci><ci id="alg1.l9.m1.3.3.1.1.3.3.2.3.cmml" xref="alg1.l9.m1.3.3.1.1.3.3.2.3">ℎ</ci></apply><apply id="alg1.l9.m1.3.3.1.1.3.3.3.cmml" xref="alg1.l9.m1.3.3.1.1.3.3.3"><csymbol cd="ambiguous" id="alg1.l9.m1.3.3.1.1.3.3.3.1.cmml" xref="alg1.l9.m1.3.3.1.1.3.3.3">subscript</csymbol><ci id="alg1.l9.m1.3.3.1.1.3.3.3.2.cmml" xref="alg1.l9.m1.3.3.1.1.3.3.3.2">𝛽</ci><ci id="alg1.l9.m1.3.3.1.1.3.3.3.3.cmml" xref="alg1.l9.m1.3.3.1.1.3.3.3.3">𝑙</ci></apply></apply></apply><apply id="alg1.l9.m1.3.3.1.1.1.1.1.cmml" xref="alg1.l9.m1.3.3.1.1.1.1"><minus id="alg1.l9.m1.3.3.1.1.1.1.1.1.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.1"></minus><apply id="alg1.l9.m1.3.3.1.1.1.1.1.2.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg1.l9.m1.3.3.1.1.1.1.1.2.1.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.2">subscript</csymbol><ci id="alg1.l9.m1.3.3.1.1.1.1.1.2.2.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.2.2">𝑇</ci><ci id="alg1.l9.m1.3.3.1.1.1.1.1.2.3.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.2.3">ℎ</ci></apply><apply id="alg1.l9.m1.3.3.1.1.1.1.1.3.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.3"><csymbol cd="ambiguous" id="alg1.l9.m1.3.3.1.1.1.1.1.3.1.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.3">subscript</csymbol><ci id="alg1.l9.m1.3.3.1.1.1.1.1.3.2.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.3.2">𝑇</ci><ci id="alg1.l9.m1.3.3.1.1.1.1.1.3.3.cmml" xref="alg1.l9.m1.3.3.1.1.1.1.1.3.3">𝑙</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l9.m1.3c">T(\alpha,\beta)\leftarrow T_{l}+\frac{\beta-\beta_{l}}{\beta_{h}-\beta_{l}}%
\cdot(T_{h}-T_{l})</annotation><annotation encoding="application/x-llamapun" id="alg1.l9.m1.3d">italic_T ( italic_α , italic_β ) ← italic_T start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT + divide start_ARG italic_β - italic_β start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT end_ARG start_ARG italic_β start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT - italic_β start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT end_ARG ⋅ ( italic_T start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT - italic_T start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT )</annotation></semantics></math><span class="ltx_text" id="alg1.l9.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l10.1.1.1" style="font-size:80%;">10:</span></span><span class="ltx_text" id="alg1.l10.2" style="font-size:80%;">        </span><math alttext="node.TotalCost\leftarrow node.TotalCost+\frac{T(\alpha,\beta)}{\beta}" class="ltx_Math" display="inline" id="alg1.l10.m1.5"><semantics id="alg1.l10.m1.5a"><mrow id="alg1.l10.m1.5.5.3" xref="alg1.l10.m1.5.5.4.cmml"><mrow id="alg1.l10.m1.3.3.1.1" xref="alg1.l10.m1.3.3.1.1.cmml"><mi id="alg1.l10.m1.3.3.1.1.2" mathsize="80%" xref="alg1.l10.m1.3.3.1.1.2.cmml">n</mi><mo id="alg1.l10.m1.3.3.1.1.1" xref="alg1.l10.m1.3.3.1.1.1.cmml">⁢</mo><mi id="alg1.l10.m1.3.3.1.1.3" mathsize="80%" xref="alg1.l10.m1.3.3.1.1.3.cmml">o</mi><mo id="alg1.l10.m1.3.3.1.1.1a" xref="alg1.l10.m1.3.3.1.1.1.cmml">⁢</mo><mi id="alg1.l10.m1.3.3.1.1.4" mathsize="80%" xref="alg1.l10.m1.3.3.1.1.4.cmml">d</mi><mo id="alg1.l10.m1.3.3.1.1.1b" xref="alg1.l10.m1.3.3.1.1.1.cmml">⁢</mo><mi id="alg1.l10.m1.3.3.1.1.5" mathsize="80%" xref="alg1.l10.m1.3.3.1.1.5.cmml">e</mi></mrow><mo id="alg1.l10.m1.5.5.3.4" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l10.m1.5.5.4a.cmml">.</mo><mrow id="alg1.l10.m1.4.4.2.2" xref="alg1.l10.m1.4.4.2.2.cmml"><mrow id="alg1.l10.m1.4.4.2.2.2" xref="alg1.l10.m1.4.4.2.2.2.cmml"><mi id="alg1.l10.m1.4.4.2.2.2.2" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.2.2.cmml">T</mi><mo id="alg1.l10.m1.4.4.2.2.2.1" xref="alg1.l10.m1.4.4.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.2.3" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.2.3.cmml">o</mi><mo id="alg1.l10.m1.4.4.2.2.2.1a" xref="alg1.l10.m1.4.4.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.2.4" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.2.4.cmml">t</mi><mo id="alg1.l10.m1.4.4.2.2.2.1b" xref="alg1.l10.m1.4.4.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.2.5" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.2.5.cmml">a</mi><mo id="alg1.l10.m1.4.4.2.2.2.1c" xref="alg1.l10.m1.4.4.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.2.6" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.2.6.cmml">l</mi><mo id="alg1.l10.m1.4.4.2.2.2.1d" xref="alg1.l10.m1.4.4.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.2.7" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.2.7.cmml">C</mi><mo id="alg1.l10.m1.4.4.2.2.2.1e" xref="alg1.l10.m1.4.4.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.2.8" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.2.8.cmml">o</mi><mo id="alg1.l10.m1.4.4.2.2.2.1f" xref="alg1.l10.m1.4.4.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.2.9" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.2.9.cmml">s</mi><mo id="alg1.l10.m1.4.4.2.2.2.1g" xref="alg1.l10.m1.4.4.2.2.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.2.10" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.2.10.cmml">t</mi></mrow><mo id="alg1.l10.m1.4.4.2.2.1" mathsize="80%" stretchy="false" xref="alg1.l10.m1.4.4.2.2.1.cmml">←</mo><mrow id="alg1.l10.m1.4.4.2.2.3" xref="alg1.l10.m1.4.4.2.2.3.cmml"><mi id="alg1.l10.m1.4.4.2.2.3.2" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.3.2.cmml">n</mi><mo id="alg1.l10.m1.4.4.2.2.3.1" xref="alg1.l10.m1.4.4.2.2.3.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.3.3" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.3.3.cmml">o</mi><mo id="alg1.l10.m1.4.4.2.2.3.1a" xref="alg1.l10.m1.4.4.2.2.3.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.3.4" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.3.4.cmml">d</mi><mo id="alg1.l10.m1.4.4.2.2.3.1b" xref="alg1.l10.m1.4.4.2.2.3.1.cmml">⁢</mo><mi id="alg1.l10.m1.4.4.2.2.3.5" mathsize="80%" xref="alg1.l10.m1.4.4.2.2.3.5.cmml">e</mi></mrow></mrow><mo id="alg1.l10.m1.5.5.3.5" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l10.m1.5.5.4a.cmml">.</mo><mrow id="alg1.l10.m1.5.5.3.3" xref="alg1.l10.m1.5.5.3.3.cmml"><mrow id="alg1.l10.m1.5.5.3.3.2" xref="alg1.l10.m1.5.5.3.3.2.cmml"><mi id="alg1.l10.m1.5.5.3.3.2.2" mathsize="80%" xref="alg1.l10.m1.5.5.3.3.2.2.cmml">T</mi><mo id="alg1.l10.m1.5.5.3.3.2.1" xref="alg1.l10.m1.5.5.3.3.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.5.5.3.3.2.3" mathsize="80%" xref="alg1.l10.m1.5.5.3.3.2.3.cmml">o</mi><mo id="alg1.l10.m1.5.5.3.3.2.1a" xref="alg1.l10.m1.5.5.3.3.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.5.5.3.3.2.4" mathsize="80%" xref="alg1.l10.m1.5.5.3.3.2.4.cmml">t</mi><mo id="alg1.l10.m1.5.5.3.3.2.1b" xref="alg1.l10.m1.5.5.3.3.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.5.5.3.3.2.5" mathsize="80%" xref="alg1.l10.m1.5.5.3.3.2.5.cmml">a</mi><mo id="alg1.l10.m1.5.5.3.3.2.1c" xref="alg1.l10.m1.5.5.3.3.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.5.5.3.3.2.6" mathsize="80%" xref="alg1.l10.m1.5.5.3.3.2.6.cmml">l</mi><mo id="alg1.l10.m1.5.5.3.3.2.1d" xref="alg1.l10.m1.5.5.3.3.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.5.5.3.3.2.7" mathsize="80%" xref="alg1.l10.m1.5.5.3.3.2.7.cmml">C</mi><mo id="alg1.l10.m1.5.5.3.3.2.1e" xref="alg1.l10.m1.5.5.3.3.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.5.5.3.3.2.8" mathsize="80%" xref="alg1.l10.m1.5.5.3.3.2.8.cmml">o</mi><mo id="alg1.l10.m1.5.5.3.3.2.1f" xref="alg1.l10.m1.5.5.3.3.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.5.5.3.3.2.9" mathsize="80%" xref="alg1.l10.m1.5.5.3.3.2.9.cmml">s</mi><mo id="alg1.l10.m1.5.5.3.3.2.1g" xref="alg1.l10.m1.5.5.3.3.2.1.cmml">⁢</mo><mi id="alg1.l10.m1.5.5.3.3.2.10" mathsize="80%" xref="alg1.l10.m1.5.5.3.3.2.10.cmml">t</mi></mrow><mo id="alg1.l10.m1.5.5.3.3.1" mathsize="80%" xref="alg1.l10.m1.5.5.3.3.1.cmml">+</mo><mfrac id="alg1.l10.m1.2.2" xref="alg1.l10.m1.2.2.cmml"><mrow id="alg1.l10.m1.2.2.2" xref="alg1.l10.m1.2.2.2.cmml"><mi id="alg1.l10.m1.2.2.2.4" mathsize="80%" xref="alg1.l10.m1.2.2.2.4.cmml">T</mi><mo id="alg1.l10.m1.2.2.2.3" xref="alg1.l10.m1.2.2.2.3.cmml">⁢</mo><mrow id="alg1.l10.m1.2.2.2.5.2" xref="alg1.l10.m1.2.2.2.5.1.cmml"><mo id="alg1.l10.m1.2.2.2.5.2.1" maxsize="80%" minsize="80%" xref="alg1.l10.m1.2.2.2.5.1.cmml">(</mo><mi id="alg1.l10.m1.1.1.1.1" mathsize="80%" xref="alg1.l10.m1.1.1.1.1.cmml">α</mi><mo id="alg1.l10.m1.2.2.2.5.2.2" mathsize="80%" xref="alg1.l10.m1.2.2.2.5.1.cmml">,</mo><mi id="alg1.l10.m1.2.2.2.2" mathsize="80%" xref="alg1.l10.m1.2.2.2.2.cmml">β</mi><mo id="alg1.l10.m1.2.2.2.5.2.3" maxsize="80%" minsize="80%" xref="alg1.l10.m1.2.2.2.5.1.cmml">)</mo></mrow></mrow><mi id="alg1.l10.m1.2.2.4" mathsize="80%" xref="alg1.l10.m1.2.2.4.cmml">β</mi></mfrac></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l10.m1.5b"><apply id="alg1.l10.m1.5.5.4.cmml" xref="alg1.l10.m1.5.5.3"><csymbol cd="ambiguous" id="alg1.l10.m1.5.5.4a.cmml" xref="alg1.l10.m1.5.5.3.4">formulae-sequence</csymbol><apply id="alg1.l10.m1.3.3.1.1.cmml" xref="alg1.l10.m1.3.3.1.1"><times id="alg1.l10.m1.3.3.1.1.1.cmml" xref="alg1.l10.m1.3.3.1.1.1"></times><ci id="alg1.l10.m1.3.3.1.1.2.cmml" xref="alg1.l10.m1.3.3.1.1.2">𝑛</ci><ci id="alg1.l10.m1.3.3.1.1.3.cmml" xref="alg1.l10.m1.3.3.1.1.3">𝑜</ci><ci id="alg1.l10.m1.3.3.1.1.4.cmml" xref="alg1.l10.m1.3.3.1.1.4">𝑑</ci><ci id="alg1.l10.m1.3.3.1.1.5.cmml" xref="alg1.l10.m1.3.3.1.1.5">𝑒</ci></apply><apply id="alg1.l10.m1.4.4.2.2.cmml" xref="alg1.l10.m1.4.4.2.2"><ci id="alg1.l10.m1.4.4.2.2.1.cmml" xref="alg1.l10.m1.4.4.2.2.1">←</ci><apply id="alg1.l10.m1.4.4.2.2.2.cmml" xref="alg1.l10.m1.4.4.2.2.2"><times id="alg1.l10.m1.4.4.2.2.2.1.cmml" xref="alg1.l10.m1.4.4.2.2.2.1"></times><ci id="alg1.l10.m1.4.4.2.2.2.2.cmml" xref="alg1.l10.m1.4.4.2.2.2.2">𝑇</ci><ci id="alg1.l10.m1.4.4.2.2.2.3.cmml" xref="alg1.l10.m1.4.4.2.2.2.3">𝑜</ci><ci id="alg1.l10.m1.4.4.2.2.2.4.cmml" xref="alg1.l10.m1.4.4.2.2.2.4">𝑡</ci><ci id="alg1.l10.m1.4.4.2.2.2.5.cmml" xref="alg1.l10.m1.4.4.2.2.2.5">𝑎</ci><ci id="alg1.l10.m1.4.4.2.2.2.6.cmml" xref="alg1.l10.m1.4.4.2.2.2.6">𝑙</ci><ci id="alg1.l10.m1.4.4.2.2.2.7.cmml" xref="alg1.l10.m1.4.4.2.2.2.7">𝐶</ci><ci id="alg1.l10.m1.4.4.2.2.2.8.cmml" xref="alg1.l10.m1.4.4.2.2.2.8">𝑜</ci><ci id="alg1.l10.m1.4.4.2.2.2.9.cmml" xref="alg1.l10.m1.4.4.2.2.2.9">𝑠</ci><ci id="alg1.l10.m1.4.4.2.2.2.10.cmml" xref="alg1.l10.m1.4.4.2.2.2.10">𝑡</ci></apply><apply id="alg1.l10.m1.4.4.2.2.3.cmml" xref="alg1.l10.m1.4.4.2.2.3"><times id="alg1.l10.m1.4.4.2.2.3.1.cmml" xref="alg1.l10.m1.4.4.2.2.3.1"></times><ci id="alg1.l10.m1.4.4.2.2.3.2.cmml" xref="alg1.l10.m1.4.4.2.2.3.2">𝑛</ci><ci id="alg1.l10.m1.4.4.2.2.3.3.cmml" xref="alg1.l10.m1.4.4.2.2.3.3">𝑜</ci><ci id="alg1.l10.m1.4.4.2.2.3.4.cmml" xref="alg1.l10.m1.4.4.2.2.3.4">𝑑</ci><ci id="alg1.l10.m1.4.4.2.2.3.5.cmml" xref="alg1.l10.m1.4.4.2.2.3.5">𝑒</ci></apply></apply><apply id="alg1.l10.m1.5.5.3.3.cmml" xref="alg1.l10.m1.5.5.3.3"><plus id="alg1.l10.m1.5.5.3.3.1.cmml" xref="alg1.l10.m1.5.5.3.3.1"></plus><apply id="alg1.l10.m1.5.5.3.3.2.cmml" xref="alg1.l10.m1.5.5.3.3.2"><times id="alg1.l10.m1.5.5.3.3.2.1.cmml" xref="alg1.l10.m1.5.5.3.3.2.1"></times><ci id="alg1.l10.m1.5.5.3.3.2.2.cmml" xref="alg1.l10.m1.5.5.3.3.2.2">𝑇</ci><ci id="alg1.l10.m1.5.5.3.3.2.3.cmml" xref="alg1.l10.m1.5.5.3.3.2.3">𝑜</ci><ci id="alg1.l10.m1.5.5.3.3.2.4.cmml" xref="alg1.l10.m1.5.5.3.3.2.4">𝑡</ci><ci id="alg1.l10.m1.5.5.3.3.2.5.cmml" xref="alg1.l10.m1.5.5.3.3.2.5">𝑎</ci><ci id="alg1.l10.m1.5.5.3.3.2.6.cmml" xref="alg1.l10.m1.5.5.3.3.2.6">𝑙</ci><ci id="alg1.l10.m1.5.5.3.3.2.7.cmml" xref="alg1.l10.m1.5.5.3.3.2.7">𝐶</ci><ci id="alg1.l10.m1.5.5.3.3.2.8.cmml" xref="alg1.l10.m1.5.5.3.3.2.8">𝑜</ci><ci id="alg1.l10.m1.5.5.3.3.2.9.cmml" xref="alg1.l10.m1.5.5.3.3.2.9">𝑠</ci><ci id="alg1.l10.m1.5.5.3.3.2.10.cmml" xref="alg1.l10.m1.5.5.3.3.2.10">𝑡</ci></apply><apply id="alg1.l10.m1.2.2.cmml" xref="alg1.l10.m1.2.2"><divide id="alg1.l10.m1.2.2.3.cmml" xref="alg1.l10.m1.2.2"></divide><apply id="alg1.l10.m1.2.2.2.cmml" xref="alg1.l10.m1.2.2.2"><times id="alg1.l10.m1.2.2.2.3.cmml" xref="alg1.l10.m1.2.2.2.3"></times><ci id="alg1.l10.m1.2.2.2.4.cmml" xref="alg1.l10.m1.2.2.2.4">𝑇</ci><interval closure="open" id="alg1.l10.m1.2.2.2.5.1.cmml" xref="alg1.l10.m1.2.2.2.5.2"><ci id="alg1.l10.m1.1.1.1.1.cmml" xref="alg1.l10.m1.1.1.1.1">𝛼</ci><ci id="alg1.l10.m1.2.2.2.2.cmml" xref="alg1.l10.m1.2.2.2.2">𝛽</ci></interval></apply><ci id="alg1.l10.m1.2.2.4.cmml" xref="alg1.l10.m1.2.2.4">𝛽</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l10.m1.5c">node.TotalCost\leftarrow node.TotalCost+\frac{T(\alpha,\beta)}{\beta}</annotation><annotation encoding="application/x-llamapun" id="alg1.l10.m1.5d">italic_n italic_o italic_d italic_e . italic_T italic_o italic_t italic_a italic_l italic_C italic_o italic_s italic_t ← italic_n italic_o italic_d italic_e . italic_T italic_o italic_t italic_a italic_l italic_C italic_o italic_s italic_t + divide start_ARG italic_T ( italic_α , italic_β ) end_ARG start_ARG italic_β end_ARG</annotation></semantics></math><span class="ltx_text" id="alg1.l10.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l11.1.1.1" style="font-size:80%;">11:</span></span><span class="ltx_text" id="alg1.l11.2" style="font-size:80%;">        </span><math alttext="node.numComputed\leftarrow node.numComputed+1" class="ltx_Math" display="inline" id="alg1.l11.m1.3"><semantics id="alg1.l11.m1.3a"><mrow id="alg1.l11.m1.3.3.3" xref="alg1.l11.m1.3.3.4.cmml"><mrow id="alg1.l11.m1.1.1.1.1" xref="alg1.l11.m1.1.1.1.1.cmml"><mi id="alg1.l11.m1.1.1.1.1.2" mathsize="80%" xref="alg1.l11.m1.1.1.1.1.2.cmml">n</mi><mo id="alg1.l11.m1.1.1.1.1.1" xref="alg1.l11.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l11.m1.1.1.1.1.3" mathsize="80%" xref="alg1.l11.m1.1.1.1.1.3.cmml">o</mi><mo id="alg1.l11.m1.1.1.1.1.1a" xref="alg1.l11.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l11.m1.1.1.1.1.4" mathsize="80%" xref="alg1.l11.m1.1.1.1.1.4.cmml">d</mi><mo id="alg1.l11.m1.1.1.1.1.1b" xref="alg1.l11.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l11.m1.1.1.1.1.5" mathsize="80%" xref="alg1.l11.m1.1.1.1.1.5.cmml">e</mi></mrow><mo id="alg1.l11.m1.3.3.3.4" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l11.m1.3.3.4a.cmml">.</mo><mrow id="alg1.l11.m1.2.2.2.2" xref="alg1.l11.m1.2.2.2.2.cmml"><mrow id="alg1.l11.m1.2.2.2.2.2" xref="alg1.l11.m1.2.2.2.2.2.cmml"><mi id="alg1.l11.m1.2.2.2.2.2.2" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.2.cmml">n</mi><mo id="alg1.l11.m1.2.2.2.2.2.1" xref="alg1.l11.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.2.3" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.3.cmml">u</mi><mo id="alg1.l11.m1.2.2.2.2.2.1a" xref="alg1.l11.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.2.4" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.4.cmml">m</mi><mo id="alg1.l11.m1.2.2.2.2.2.1b" xref="alg1.l11.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.2.5" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.5.cmml">C</mi><mo id="alg1.l11.m1.2.2.2.2.2.1c" xref="alg1.l11.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.2.6" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.6.cmml">o</mi><mo id="alg1.l11.m1.2.2.2.2.2.1d" xref="alg1.l11.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.2.7" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.7.cmml">m</mi><mo id="alg1.l11.m1.2.2.2.2.2.1e" xref="alg1.l11.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.2.8" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.8.cmml">p</mi><mo id="alg1.l11.m1.2.2.2.2.2.1f" xref="alg1.l11.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.2.9" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.9.cmml">u</mi><mo id="alg1.l11.m1.2.2.2.2.2.1g" xref="alg1.l11.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.2.10" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.10.cmml">t</mi><mo id="alg1.l11.m1.2.2.2.2.2.1h" xref="alg1.l11.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.2.11" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.11.cmml">e</mi><mo id="alg1.l11.m1.2.2.2.2.2.1i" xref="alg1.l11.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.2.12" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.2.12.cmml">d</mi></mrow><mo id="alg1.l11.m1.2.2.2.2.1" mathsize="80%" stretchy="false" xref="alg1.l11.m1.2.2.2.2.1.cmml">←</mo><mrow id="alg1.l11.m1.2.2.2.2.3" xref="alg1.l11.m1.2.2.2.2.3.cmml"><mi id="alg1.l11.m1.2.2.2.2.3.2" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.3.2.cmml">n</mi><mo id="alg1.l11.m1.2.2.2.2.3.1" xref="alg1.l11.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.3.3" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.3.3.cmml">o</mi><mo id="alg1.l11.m1.2.2.2.2.3.1a" xref="alg1.l11.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.3.4" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.3.4.cmml">d</mi><mo id="alg1.l11.m1.2.2.2.2.3.1b" xref="alg1.l11.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l11.m1.2.2.2.2.3.5" mathsize="80%" xref="alg1.l11.m1.2.2.2.2.3.5.cmml">e</mi></mrow></mrow><mo id="alg1.l11.m1.3.3.3.5" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l11.m1.3.3.4a.cmml">.</mo><mrow id="alg1.l11.m1.3.3.3.3" xref="alg1.l11.m1.3.3.3.3.cmml"><mrow id="alg1.l11.m1.3.3.3.3.2" xref="alg1.l11.m1.3.3.3.3.2.cmml"><mi id="alg1.l11.m1.3.3.3.3.2.2" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.2.cmml">n</mi><mo id="alg1.l11.m1.3.3.3.3.2.1" xref="alg1.l11.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.3.3.3.3.2.3" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.3.cmml">u</mi><mo id="alg1.l11.m1.3.3.3.3.2.1a" xref="alg1.l11.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.3.3.3.3.2.4" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.4.cmml">m</mi><mo id="alg1.l11.m1.3.3.3.3.2.1b" xref="alg1.l11.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.3.3.3.3.2.5" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.5.cmml">C</mi><mo id="alg1.l11.m1.3.3.3.3.2.1c" xref="alg1.l11.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.3.3.3.3.2.6" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.6.cmml">o</mi><mo id="alg1.l11.m1.3.3.3.3.2.1d" xref="alg1.l11.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.3.3.3.3.2.7" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.7.cmml">m</mi><mo id="alg1.l11.m1.3.3.3.3.2.1e" xref="alg1.l11.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.3.3.3.3.2.8" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.8.cmml">p</mi><mo id="alg1.l11.m1.3.3.3.3.2.1f" xref="alg1.l11.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.3.3.3.3.2.9" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.9.cmml">u</mi><mo id="alg1.l11.m1.3.3.3.3.2.1g" xref="alg1.l11.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.3.3.3.3.2.10" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.10.cmml">t</mi><mo id="alg1.l11.m1.3.3.3.3.2.1h" xref="alg1.l11.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.3.3.3.3.2.11" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.11.cmml">e</mi><mo id="alg1.l11.m1.3.3.3.3.2.1i" xref="alg1.l11.m1.3.3.3.3.2.1.cmml">⁢</mo><mi id="alg1.l11.m1.3.3.3.3.2.12" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.2.12.cmml">d</mi></mrow><mo id="alg1.l11.m1.3.3.3.3.1" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.1.cmml">+</mo><mn id="alg1.l11.m1.3.3.3.3.3" mathsize="80%" xref="alg1.l11.m1.3.3.3.3.3.cmml">1</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l11.m1.3b"><apply id="alg1.l11.m1.3.3.4.cmml" xref="alg1.l11.m1.3.3.3"><csymbol cd="ambiguous" id="alg1.l11.m1.3.3.4a.cmml" xref="alg1.l11.m1.3.3.3.4">formulae-sequence</csymbol><apply id="alg1.l11.m1.1.1.1.1.cmml" xref="alg1.l11.m1.1.1.1.1"><times id="alg1.l11.m1.1.1.1.1.1.cmml" xref="alg1.l11.m1.1.1.1.1.1"></times><ci id="alg1.l11.m1.1.1.1.1.2.cmml" xref="alg1.l11.m1.1.1.1.1.2">𝑛</ci><ci id="alg1.l11.m1.1.1.1.1.3.cmml" xref="alg1.l11.m1.1.1.1.1.3">𝑜</ci><ci id="alg1.l11.m1.1.1.1.1.4.cmml" xref="alg1.l11.m1.1.1.1.1.4">𝑑</ci><ci id="alg1.l11.m1.1.1.1.1.5.cmml" xref="alg1.l11.m1.1.1.1.1.5">𝑒</ci></apply><apply id="alg1.l11.m1.2.2.2.2.cmml" xref="alg1.l11.m1.2.2.2.2"><ci id="alg1.l11.m1.2.2.2.2.1.cmml" xref="alg1.l11.m1.2.2.2.2.1">←</ci><apply id="alg1.l11.m1.2.2.2.2.2.cmml" xref="alg1.l11.m1.2.2.2.2.2"><times id="alg1.l11.m1.2.2.2.2.2.1.cmml" xref="alg1.l11.m1.2.2.2.2.2.1"></times><ci id="alg1.l11.m1.2.2.2.2.2.2.cmml" xref="alg1.l11.m1.2.2.2.2.2.2">𝑛</ci><ci id="alg1.l11.m1.2.2.2.2.2.3.cmml" xref="alg1.l11.m1.2.2.2.2.2.3">𝑢</ci><ci id="alg1.l11.m1.2.2.2.2.2.4.cmml" xref="alg1.l11.m1.2.2.2.2.2.4">𝑚</ci><ci id="alg1.l11.m1.2.2.2.2.2.5.cmml" xref="alg1.l11.m1.2.2.2.2.2.5">𝐶</ci><ci id="alg1.l11.m1.2.2.2.2.2.6.cmml" xref="alg1.l11.m1.2.2.2.2.2.6">𝑜</ci><ci id="alg1.l11.m1.2.2.2.2.2.7.cmml" xref="alg1.l11.m1.2.2.2.2.2.7">𝑚</ci><ci id="alg1.l11.m1.2.2.2.2.2.8.cmml" xref="alg1.l11.m1.2.2.2.2.2.8">𝑝</ci><ci id="alg1.l11.m1.2.2.2.2.2.9.cmml" xref="alg1.l11.m1.2.2.2.2.2.9">𝑢</ci><ci id="alg1.l11.m1.2.2.2.2.2.10.cmml" xref="alg1.l11.m1.2.2.2.2.2.10">𝑡</ci><ci id="alg1.l11.m1.2.2.2.2.2.11.cmml" xref="alg1.l11.m1.2.2.2.2.2.11">𝑒</ci><ci id="alg1.l11.m1.2.2.2.2.2.12.cmml" xref="alg1.l11.m1.2.2.2.2.2.12">𝑑</ci></apply><apply id="alg1.l11.m1.2.2.2.2.3.cmml" xref="alg1.l11.m1.2.2.2.2.3"><times id="alg1.l11.m1.2.2.2.2.3.1.cmml" xref="alg1.l11.m1.2.2.2.2.3.1"></times><ci id="alg1.l11.m1.2.2.2.2.3.2.cmml" xref="alg1.l11.m1.2.2.2.2.3.2">𝑛</ci><ci id="alg1.l11.m1.2.2.2.2.3.3.cmml" xref="alg1.l11.m1.2.2.2.2.3.3">𝑜</ci><ci id="alg1.l11.m1.2.2.2.2.3.4.cmml" xref="alg1.l11.m1.2.2.2.2.3.4">𝑑</ci><ci id="alg1.l11.m1.2.2.2.2.3.5.cmml" xref="alg1.l11.m1.2.2.2.2.3.5">𝑒</ci></apply></apply><apply id="alg1.l11.m1.3.3.3.3.cmml" xref="alg1.l11.m1.3.3.3.3"><plus id="alg1.l11.m1.3.3.3.3.1.cmml" xref="alg1.l11.m1.3.3.3.3.1"></plus><apply id="alg1.l11.m1.3.3.3.3.2.cmml" xref="alg1.l11.m1.3.3.3.3.2"><times id="alg1.l11.m1.3.3.3.3.2.1.cmml" xref="alg1.l11.m1.3.3.3.3.2.1"></times><ci id="alg1.l11.m1.3.3.3.3.2.2.cmml" xref="alg1.l11.m1.3.3.3.3.2.2">𝑛</ci><ci id="alg1.l11.m1.3.3.3.3.2.3.cmml" xref="alg1.l11.m1.3.3.3.3.2.3">𝑢</ci><ci id="alg1.l11.m1.3.3.3.3.2.4.cmml" xref="alg1.l11.m1.3.3.3.3.2.4">𝑚</ci><ci id="alg1.l11.m1.3.3.3.3.2.5.cmml" xref="alg1.l11.m1.3.3.3.3.2.5">𝐶</ci><ci id="alg1.l11.m1.3.3.3.3.2.6.cmml" xref="alg1.l11.m1.3.3.3.3.2.6">𝑜</ci><ci id="alg1.l11.m1.3.3.3.3.2.7.cmml" xref="alg1.l11.m1.3.3.3.3.2.7">𝑚</ci><ci id="alg1.l11.m1.3.3.3.3.2.8.cmml" xref="alg1.l11.m1.3.3.3.3.2.8">𝑝</ci><ci id="alg1.l11.m1.3.3.3.3.2.9.cmml" xref="alg1.l11.m1.3.3.3.3.2.9">𝑢</ci><ci id="alg1.l11.m1.3.3.3.3.2.10.cmml" xref="alg1.l11.m1.3.3.3.3.2.10">𝑡</ci><ci id="alg1.l11.m1.3.3.3.3.2.11.cmml" xref="alg1.l11.m1.3.3.3.3.2.11">𝑒</ci><ci id="alg1.l11.m1.3.3.3.3.2.12.cmml" xref="alg1.l11.m1.3.3.3.3.2.12">𝑑</ci></apply><cn id="alg1.l11.m1.3.3.3.3.3.cmml" type="integer" xref="alg1.l11.m1.3.3.3.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l11.m1.3c">node.numComputed\leftarrow node.numComputed+1</annotation><annotation encoding="application/x-llamapun" id="alg1.l11.m1.3d">italic_n italic_o italic_d italic_e . italic_n italic_u italic_m italic_C italic_o italic_m italic_p italic_u italic_t italic_e italic_d ← italic_n italic_o italic_d italic_e . italic_n italic_u italic_m italic_C italic_o italic_m italic_p italic_u italic_t italic_e italic_d + 1</annotation></semantics></math><span class="ltx_text" id="alg1.l11.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l12">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l12.1.1.1" style="font-size:80%;">12:</span></span><span class="ltx_text" id="alg1.l12.2" style="font-size:80%;">        </span><math alttext="node.AvgCost\leftarrow\frac{node.TotalCost}{node.numComputed}" class="ltx_Math" display="inline" id="alg1.l12.m1.6"><semantics id="alg1.l12.m1.6a"><mrow id="alg1.l12.m1.6.6.2" xref="alg1.l12.m1.6.6.3.cmml"><mrow id="alg1.l12.m1.5.5.1.1" xref="alg1.l12.m1.5.5.1.1.cmml"><mi id="alg1.l12.m1.5.5.1.1.2" mathsize="80%" xref="alg1.l12.m1.5.5.1.1.2.cmml">n</mi><mo id="alg1.l12.m1.5.5.1.1.1" xref="alg1.l12.m1.5.5.1.1.1.cmml">⁢</mo><mi id="alg1.l12.m1.5.5.1.1.3" mathsize="80%" xref="alg1.l12.m1.5.5.1.1.3.cmml">o</mi><mo id="alg1.l12.m1.5.5.1.1.1a" xref="alg1.l12.m1.5.5.1.1.1.cmml">⁢</mo><mi id="alg1.l12.m1.5.5.1.1.4" mathsize="80%" xref="alg1.l12.m1.5.5.1.1.4.cmml">d</mi><mo id="alg1.l12.m1.5.5.1.1.1b" xref="alg1.l12.m1.5.5.1.1.1.cmml">⁢</mo><mi id="alg1.l12.m1.5.5.1.1.5" mathsize="80%" xref="alg1.l12.m1.5.5.1.1.5.cmml">e</mi></mrow><mo id="alg1.l12.m1.6.6.2.3" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l12.m1.6.6.3a.cmml">.</mo><mrow id="alg1.l12.m1.6.6.2.2" xref="alg1.l12.m1.6.6.2.2.cmml"><mrow id="alg1.l12.m1.6.6.2.2.2" xref="alg1.l12.m1.6.6.2.2.2.cmml"><mi id="alg1.l12.m1.6.6.2.2.2.2" mathsize="80%" xref="alg1.l12.m1.6.6.2.2.2.2.cmml">A</mi><mo id="alg1.l12.m1.6.6.2.2.2.1" xref="alg1.l12.m1.6.6.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.6.6.2.2.2.3" mathsize="80%" xref="alg1.l12.m1.6.6.2.2.2.3.cmml">v</mi><mo id="alg1.l12.m1.6.6.2.2.2.1a" xref="alg1.l12.m1.6.6.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.6.6.2.2.2.4" mathsize="80%" xref="alg1.l12.m1.6.6.2.2.2.4.cmml">g</mi><mo id="alg1.l12.m1.6.6.2.2.2.1b" xref="alg1.l12.m1.6.6.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.6.6.2.2.2.5" mathsize="80%" xref="alg1.l12.m1.6.6.2.2.2.5.cmml">C</mi><mo id="alg1.l12.m1.6.6.2.2.2.1c" xref="alg1.l12.m1.6.6.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.6.6.2.2.2.6" mathsize="80%" xref="alg1.l12.m1.6.6.2.2.2.6.cmml">o</mi><mo id="alg1.l12.m1.6.6.2.2.2.1d" xref="alg1.l12.m1.6.6.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.6.6.2.2.2.7" mathsize="80%" xref="alg1.l12.m1.6.6.2.2.2.7.cmml">s</mi><mo id="alg1.l12.m1.6.6.2.2.2.1e" xref="alg1.l12.m1.6.6.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.6.6.2.2.2.8" mathsize="80%" xref="alg1.l12.m1.6.6.2.2.2.8.cmml">t</mi></mrow><mo id="alg1.l12.m1.6.6.2.2.1" mathsize="80%" stretchy="false" xref="alg1.l12.m1.6.6.2.2.1.cmml">←</mo><mfrac id="alg1.l12.m1.4.4" xref="alg1.l12.m1.4.4.cmml"><mrow id="alg1.l12.m1.2.2.2.2" xref="alg1.l12.m1.2.2.2.3.cmml"><mrow id="alg1.l12.m1.1.1.1.1.1" xref="alg1.l12.m1.1.1.1.1.1.cmml"><mi id="alg1.l12.m1.1.1.1.1.1.2" mathsize="80%" xref="alg1.l12.m1.1.1.1.1.1.2.cmml">n</mi><mo id="alg1.l12.m1.1.1.1.1.1.1" xref="alg1.l12.m1.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l12.m1.1.1.1.1.1.3" mathsize="80%" xref="alg1.l12.m1.1.1.1.1.1.3.cmml">o</mi><mo id="alg1.l12.m1.1.1.1.1.1.1a" xref="alg1.l12.m1.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l12.m1.1.1.1.1.1.4" mathsize="80%" xref="alg1.l12.m1.1.1.1.1.1.4.cmml">d</mi><mo id="alg1.l12.m1.1.1.1.1.1.1b" xref="alg1.l12.m1.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l12.m1.1.1.1.1.1.5" mathsize="80%" xref="alg1.l12.m1.1.1.1.1.1.5.cmml">e</mi></mrow><mo id="alg1.l12.m1.2.2.2.2.3" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l12.m1.2.2.2.3a.cmml">.</mo><mrow id="alg1.l12.m1.2.2.2.2.2" xref="alg1.l12.m1.2.2.2.2.2.cmml"><mi id="alg1.l12.m1.2.2.2.2.2.2" mathsize="80%" xref="alg1.l12.m1.2.2.2.2.2.2.cmml">T</mi><mo id="alg1.l12.m1.2.2.2.2.2.1" xref="alg1.l12.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.2.2.2.2.2.3" mathsize="80%" xref="alg1.l12.m1.2.2.2.2.2.3.cmml">o</mi><mo id="alg1.l12.m1.2.2.2.2.2.1a" xref="alg1.l12.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.2.2.2.2.2.4" mathsize="80%" xref="alg1.l12.m1.2.2.2.2.2.4.cmml">t</mi><mo id="alg1.l12.m1.2.2.2.2.2.1b" xref="alg1.l12.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.2.2.2.2.2.5" mathsize="80%" xref="alg1.l12.m1.2.2.2.2.2.5.cmml">a</mi><mo id="alg1.l12.m1.2.2.2.2.2.1c" xref="alg1.l12.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.2.2.2.2.2.6" mathsize="80%" xref="alg1.l12.m1.2.2.2.2.2.6.cmml">l</mi><mo id="alg1.l12.m1.2.2.2.2.2.1d" xref="alg1.l12.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.2.2.2.2.2.7" mathsize="80%" xref="alg1.l12.m1.2.2.2.2.2.7.cmml">C</mi><mo id="alg1.l12.m1.2.2.2.2.2.1e" xref="alg1.l12.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.2.2.2.2.2.8" mathsize="80%" xref="alg1.l12.m1.2.2.2.2.2.8.cmml">o</mi><mo id="alg1.l12.m1.2.2.2.2.2.1f" xref="alg1.l12.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.2.2.2.2.2.9" mathsize="80%" xref="alg1.l12.m1.2.2.2.2.2.9.cmml">s</mi><mo id="alg1.l12.m1.2.2.2.2.2.1g" xref="alg1.l12.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.2.2.2.2.2.10" mathsize="80%" xref="alg1.l12.m1.2.2.2.2.2.10.cmml">t</mi></mrow></mrow><mrow id="alg1.l12.m1.4.4.4.2" xref="alg1.l12.m1.4.4.4.3.cmml"><mrow id="alg1.l12.m1.3.3.3.1.1" xref="alg1.l12.m1.3.3.3.1.1.cmml"><mi id="alg1.l12.m1.3.3.3.1.1.2" mathsize="80%" xref="alg1.l12.m1.3.3.3.1.1.2.cmml">n</mi><mo id="alg1.l12.m1.3.3.3.1.1.1" xref="alg1.l12.m1.3.3.3.1.1.1.cmml">⁢</mo><mi id="alg1.l12.m1.3.3.3.1.1.3" mathsize="80%" xref="alg1.l12.m1.3.3.3.1.1.3.cmml">o</mi><mo id="alg1.l12.m1.3.3.3.1.1.1a" xref="alg1.l12.m1.3.3.3.1.1.1.cmml">⁢</mo><mi id="alg1.l12.m1.3.3.3.1.1.4" mathsize="80%" xref="alg1.l12.m1.3.3.3.1.1.4.cmml">d</mi><mo id="alg1.l12.m1.3.3.3.1.1.1b" xref="alg1.l12.m1.3.3.3.1.1.1.cmml">⁢</mo><mi id="alg1.l12.m1.3.3.3.1.1.5" mathsize="80%" xref="alg1.l12.m1.3.3.3.1.1.5.cmml">e</mi></mrow><mo id="alg1.l12.m1.4.4.4.2.3" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l12.m1.4.4.4.3a.cmml">.</mo><mrow id="alg1.l12.m1.4.4.4.2.2" xref="alg1.l12.m1.4.4.4.2.2.cmml"><mi id="alg1.l12.m1.4.4.4.2.2.2" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.2.cmml">n</mi><mo id="alg1.l12.m1.4.4.4.2.2.1" xref="alg1.l12.m1.4.4.4.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.4.4.4.2.2.3" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.3.cmml">u</mi><mo id="alg1.l12.m1.4.4.4.2.2.1a" xref="alg1.l12.m1.4.4.4.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.4.4.4.2.2.4" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.4.cmml">m</mi><mo id="alg1.l12.m1.4.4.4.2.2.1b" xref="alg1.l12.m1.4.4.4.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.4.4.4.2.2.5" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.5.cmml">C</mi><mo id="alg1.l12.m1.4.4.4.2.2.1c" xref="alg1.l12.m1.4.4.4.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.4.4.4.2.2.6" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.6.cmml">o</mi><mo id="alg1.l12.m1.4.4.4.2.2.1d" xref="alg1.l12.m1.4.4.4.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.4.4.4.2.2.7" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.7.cmml">m</mi><mo id="alg1.l12.m1.4.4.4.2.2.1e" xref="alg1.l12.m1.4.4.4.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.4.4.4.2.2.8" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.8.cmml">p</mi><mo id="alg1.l12.m1.4.4.4.2.2.1f" xref="alg1.l12.m1.4.4.4.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.4.4.4.2.2.9" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.9.cmml">u</mi><mo id="alg1.l12.m1.4.4.4.2.2.1g" xref="alg1.l12.m1.4.4.4.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.4.4.4.2.2.10" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.10.cmml">t</mi><mo id="alg1.l12.m1.4.4.4.2.2.1h" xref="alg1.l12.m1.4.4.4.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.4.4.4.2.2.11" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.11.cmml">e</mi><mo id="alg1.l12.m1.4.4.4.2.2.1i" xref="alg1.l12.m1.4.4.4.2.2.1.cmml">⁢</mo><mi id="alg1.l12.m1.4.4.4.2.2.12" mathsize="80%" xref="alg1.l12.m1.4.4.4.2.2.12.cmml">d</mi></mrow></mrow></mfrac></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l12.m1.6b"><apply id="alg1.l12.m1.6.6.3.cmml" xref="alg1.l12.m1.6.6.2"><csymbol cd="ambiguous" id="alg1.l12.m1.6.6.3a.cmml" xref="alg1.l12.m1.6.6.2.3">formulae-sequence</csymbol><apply id="alg1.l12.m1.5.5.1.1.cmml" xref="alg1.l12.m1.5.5.1.1"><times id="alg1.l12.m1.5.5.1.1.1.cmml" xref="alg1.l12.m1.5.5.1.1.1"></times><ci id="alg1.l12.m1.5.5.1.1.2.cmml" xref="alg1.l12.m1.5.5.1.1.2">𝑛</ci><ci id="alg1.l12.m1.5.5.1.1.3.cmml" xref="alg1.l12.m1.5.5.1.1.3">𝑜</ci><ci id="alg1.l12.m1.5.5.1.1.4.cmml" xref="alg1.l12.m1.5.5.1.1.4">𝑑</ci><ci id="alg1.l12.m1.5.5.1.1.5.cmml" xref="alg1.l12.m1.5.5.1.1.5">𝑒</ci></apply><apply id="alg1.l12.m1.6.6.2.2.cmml" xref="alg1.l12.m1.6.6.2.2"><ci id="alg1.l12.m1.6.6.2.2.1.cmml" xref="alg1.l12.m1.6.6.2.2.1">←</ci><apply id="alg1.l12.m1.6.6.2.2.2.cmml" xref="alg1.l12.m1.6.6.2.2.2"><times id="alg1.l12.m1.6.6.2.2.2.1.cmml" xref="alg1.l12.m1.6.6.2.2.2.1"></times><ci id="alg1.l12.m1.6.6.2.2.2.2.cmml" xref="alg1.l12.m1.6.6.2.2.2.2">𝐴</ci><ci id="alg1.l12.m1.6.6.2.2.2.3.cmml" xref="alg1.l12.m1.6.6.2.2.2.3">𝑣</ci><ci id="alg1.l12.m1.6.6.2.2.2.4.cmml" xref="alg1.l12.m1.6.6.2.2.2.4">𝑔</ci><ci id="alg1.l12.m1.6.6.2.2.2.5.cmml" xref="alg1.l12.m1.6.6.2.2.2.5">𝐶</ci><ci id="alg1.l12.m1.6.6.2.2.2.6.cmml" xref="alg1.l12.m1.6.6.2.2.2.6">𝑜</ci><ci id="alg1.l12.m1.6.6.2.2.2.7.cmml" xref="alg1.l12.m1.6.6.2.2.2.7">𝑠</ci><ci id="alg1.l12.m1.6.6.2.2.2.8.cmml" xref="alg1.l12.m1.6.6.2.2.2.8">𝑡</ci></apply><apply id="alg1.l12.m1.4.4.cmml" xref="alg1.l12.m1.4.4"><divide id="alg1.l12.m1.4.4.5.cmml" xref="alg1.l12.m1.4.4"></divide><apply id="alg1.l12.m1.2.2.2.3.cmml" xref="alg1.l12.m1.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l12.m1.2.2.2.3a.cmml" xref="alg1.l12.m1.2.2.2.2.3">formulae-sequence</csymbol><apply id="alg1.l12.m1.1.1.1.1.1.cmml" xref="alg1.l12.m1.1.1.1.1.1"><times id="alg1.l12.m1.1.1.1.1.1.1.cmml" xref="alg1.l12.m1.1.1.1.1.1.1"></times><ci id="alg1.l12.m1.1.1.1.1.1.2.cmml" xref="alg1.l12.m1.1.1.1.1.1.2">𝑛</ci><ci id="alg1.l12.m1.1.1.1.1.1.3.cmml" xref="alg1.l12.m1.1.1.1.1.1.3">𝑜</ci><ci id="alg1.l12.m1.1.1.1.1.1.4.cmml" xref="alg1.l12.m1.1.1.1.1.1.4">𝑑</ci><ci id="alg1.l12.m1.1.1.1.1.1.5.cmml" xref="alg1.l12.m1.1.1.1.1.1.5">𝑒</ci></apply><apply id="alg1.l12.m1.2.2.2.2.2.cmml" xref="alg1.l12.m1.2.2.2.2.2"><times id="alg1.l12.m1.2.2.2.2.2.1.cmml" xref="alg1.l12.m1.2.2.2.2.2.1"></times><ci id="alg1.l12.m1.2.2.2.2.2.2.cmml" xref="alg1.l12.m1.2.2.2.2.2.2">𝑇</ci><ci id="alg1.l12.m1.2.2.2.2.2.3.cmml" xref="alg1.l12.m1.2.2.2.2.2.3">𝑜</ci><ci id="alg1.l12.m1.2.2.2.2.2.4.cmml" xref="alg1.l12.m1.2.2.2.2.2.4">𝑡</ci><ci id="alg1.l12.m1.2.2.2.2.2.5.cmml" xref="alg1.l12.m1.2.2.2.2.2.5">𝑎</ci><ci id="alg1.l12.m1.2.2.2.2.2.6.cmml" xref="alg1.l12.m1.2.2.2.2.2.6">𝑙</ci><ci id="alg1.l12.m1.2.2.2.2.2.7.cmml" xref="alg1.l12.m1.2.2.2.2.2.7">𝐶</ci><ci id="alg1.l12.m1.2.2.2.2.2.8.cmml" xref="alg1.l12.m1.2.2.2.2.2.8">𝑜</ci><ci id="alg1.l12.m1.2.2.2.2.2.9.cmml" xref="alg1.l12.m1.2.2.2.2.2.9">𝑠</ci><ci id="alg1.l12.m1.2.2.2.2.2.10.cmml" xref="alg1.l12.m1.2.2.2.2.2.10">𝑡</ci></apply></apply><apply id="alg1.l12.m1.4.4.4.3.cmml" xref="alg1.l12.m1.4.4.4.2"><csymbol cd="ambiguous" id="alg1.l12.m1.4.4.4.3a.cmml" xref="alg1.l12.m1.4.4.4.2.3">formulae-sequence</csymbol><apply id="alg1.l12.m1.3.3.3.1.1.cmml" xref="alg1.l12.m1.3.3.3.1.1"><times id="alg1.l12.m1.3.3.3.1.1.1.cmml" xref="alg1.l12.m1.3.3.3.1.1.1"></times><ci id="alg1.l12.m1.3.3.3.1.1.2.cmml" xref="alg1.l12.m1.3.3.3.1.1.2">𝑛</ci><ci id="alg1.l12.m1.3.3.3.1.1.3.cmml" xref="alg1.l12.m1.3.3.3.1.1.3">𝑜</ci><ci id="alg1.l12.m1.3.3.3.1.1.4.cmml" xref="alg1.l12.m1.3.3.3.1.1.4">𝑑</ci><ci id="alg1.l12.m1.3.3.3.1.1.5.cmml" xref="alg1.l12.m1.3.3.3.1.1.5">𝑒</ci></apply><apply id="alg1.l12.m1.4.4.4.2.2.cmml" xref="alg1.l12.m1.4.4.4.2.2"><times id="alg1.l12.m1.4.4.4.2.2.1.cmml" xref="alg1.l12.m1.4.4.4.2.2.1"></times><ci id="alg1.l12.m1.4.4.4.2.2.2.cmml" xref="alg1.l12.m1.4.4.4.2.2.2">𝑛</ci><ci id="alg1.l12.m1.4.4.4.2.2.3.cmml" xref="alg1.l12.m1.4.4.4.2.2.3">𝑢</ci><ci id="alg1.l12.m1.4.4.4.2.2.4.cmml" xref="alg1.l12.m1.4.4.4.2.2.4">𝑚</ci><ci id="alg1.l12.m1.4.4.4.2.2.5.cmml" xref="alg1.l12.m1.4.4.4.2.2.5">𝐶</ci><ci id="alg1.l12.m1.4.4.4.2.2.6.cmml" xref="alg1.l12.m1.4.4.4.2.2.6">𝑜</ci><ci id="alg1.l12.m1.4.4.4.2.2.7.cmml" xref="alg1.l12.m1.4.4.4.2.2.7">𝑚</ci><ci id="alg1.l12.m1.4.4.4.2.2.8.cmml" xref="alg1.l12.m1.4.4.4.2.2.8">𝑝</ci><ci id="alg1.l12.m1.4.4.4.2.2.9.cmml" xref="alg1.l12.m1.4.4.4.2.2.9">𝑢</ci><ci id="alg1.l12.m1.4.4.4.2.2.10.cmml" xref="alg1.l12.m1.4.4.4.2.2.10">𝑡</ci><ci id="alg1.l12.m1.4.4.4.2.2.11.cmml" xref="alg1.l12.m1.4.4.4.2.2.11">𝑒</ci><ci id="alg1.l12.m1.4.4.4.2.2.12.cmml" xref="alg1.l12.m1.4.4.4.2.2.12">𝑑</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l12.m1.6c">node.AvgCost\leftarrow\frac{node.TotalCost}{node.numComputed}</annotation><annotation encoding="application/x-llamapun" id="alg1.l12.m1.6d">italic_n italic_o italic_d italic_e . italic_A italic_v italic_g italic_C italic_o italic_s italic_t ← divide start_ARG italic_n italic_o italic_d italic_e . italic_T italic_o italic_t italic_a italic_l italic_C italic_o italic_s italic_t end_ARG start_ARG italic_n italic_o italic_d italic_e . italic_n italic_u italic_m italic_C italic_o italic_m italic_p italic_u italic_t italic_e italic_d end_ARG</annotation></semantics></math><span class="ltx_text" id="alg1.l12.3" style="font-size:80%;">
    </span>
</div>
<div class="ltx_listingline" id="alg1.l13">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l13.1.1.1" style="font-size:80%;">13:</span></span><span class="ltx_text" id="alg1.l13.2" style="font-size:80%;">    </span><math alttext="node.Priority\leftarrow Clock+node.AvgCost\times node.Frequency" class="ltx_Math" display="inline" id="alg1.l13.m1.4"><semantics id="alg1.l13.m1.4a"><mrow id="alg1.l13.m1.4.4.4" xref="alg1.l13.m1.4.4.5.cmml"><mrow id="alg1.l13.m1.1.1.1.1" xref="alg1.l13.m1.1.1.1.1.cmml"><mi id="alg1.l13.m1.1.1.1.1.2" mathsize="80%" xref="alg1.l13.m1.1.1.1.1.2.cmml">n</mi><mo id="alg1.l13.m1.1.1.1.1.1" xref="alg1.l13.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l13.m1.1.1.1.1.3" mathsize="80%" xref="alg1.l13.m1.1.1.1.1.3.cmml">o</mi><mo id="alg1.l13.m1.1.1.1.1.1a" xref="alg1.l13.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l13.m1.1.1.1.1.4" mathsize="80%" xref="alg1.l13.m1.1.1.1.1.4.cmml">d</mi><mo id="alg1.l13.m1.1.1.1.1.1b" xref="alg1.l13.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg1.l13.m1.1.1.1.1.5" mathsize="80%" xref="alg1.l13.m1.1.1.1.1.5.cmml">e</mi></mrow><mo id="alg1.l13.m1.4.4.4.5" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l13.m1.4.4.5a.cmml">.</mo><mrow id="alg1.l13.m1.2.2.2.2" xref="alg1.l13.m1.2.2.2.2.cmml"><mrow id="alg1.l13.m1.2.2.2.2.2" xref="alg1.l13.m1.2.2.2.2.2.cmml"><mi id="alg1.l13.m1.2.2.2.2.2.2" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.2.2.cmml">P</mi><mo id="alg1.l13.m1.2.2.2.2.2.1" xref="alg1.l13.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.2.3" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.2.3.cmml">r</mi><mo id="alg1.l13.m1.2.2.2.2.2.1a" xref="alg1.l13.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.2.4" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.2.4.cmml">i</mi><mo id="alg1.l13.m1.2.2.2.2.2.1b" xref="alg1.l13.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.2.5" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.2.5.cmml">o</mi><mo id="alg1.l13.m1.2.2.2.2.2.1c" xref="alg1.l13.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.2.6" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.2.6.cmml">r</mi><mo id="alg1.l13.m1.2.2.2.2.2.1d" xref="alg1.l13.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.2.7" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.2.7.cmml">i</mi><mo id="alg1.l13.m1.2.2.2.2.2.1e" xref="alg1.l13.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.2.8" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.2.8.cmml">t</mi><mo id="alg1.l13.m1.2.2.2.2.2.1f" xref="alg1.l13.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.2.9" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.2.9.cmml">y</mi></mrow><mo id="alg1.l13.m1.2.2.2.2.1" mathsize="80%" stretchy="false" xref="alg1.l13.m1.2.2.2.2.1.cmml">←</mo><mrow id="alg1.l13.m1.2.2.2.2.3" xref="alg1.l13.m1.2.2.2.2.3.cmml"><mrow id="alg1.l13.m1.2.2.2.2.3.2" xref="alg1.l13.m1.2.2.2.2.3.2.cmml"><mi id="alg1.l13.m1.2.2.2.2.3.2.2" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.3.2.2.cmml">C</mi><mo id="alg1.l13.m1.2.2.2.2.3.2.1" xref="alg1.l13.m1.2.2.2.2.3.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.3.2.3" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.3.2.3.cmml">l</mi><mo id="alg1.l13.m1.2.2.2.2.3.2.1a" xref="alg1.l13.m1.2.2.2.2.3.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.3.2.4" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.3.2.4.cmml">o</mi><mo id="alg1.l13.m1.2.2.2.2.3.2.1b" xref="alg1.l13.m1.2.2.2.2.3.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.3.2.5" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.3.2.5.cmml">c</mi><mo id="alg1.l13.m1.2.2.2.2.3.2.1c" xref="alg1.l13.m1.2.2.2.2.3.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.3.2.6" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.3.2.6.cmml">k</mi></mrow><mo id="alg1.l13.m1.2.2.2.2.3.1" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.3.1.cmml">+</mo><mrow id="alg1.l13.m1.2.2.2.2.3.3" xref="alg1.l13.m1.2.2.2.2.3.3.cmml"><mi id="alg1.l13.m1.2.2.2.2.3.3.2" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.3.3.2.cmml">n</mi><mo id="alg1.l13.m1.2.2.2.2.3.3.1" xref="alg1.l13.m1.2.2.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.3.3.3" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.3.3.3.cmml">o</mi><mo id="alg1.l13.m1.2.2.2.2.3.3.1a" xref="alg1.l13.m1.2.2.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.3.3.4" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.3.3.4.cmml">d</mi><mo id="alg1.l13.m1.2.2.2.2.3.3.1b" xref="alg1.l13.m1.2.2.2.2.3.3.1.cmml">⁢</mo><mi id="alg1.l13.m1.2.2.2.2.3.3.5" mathsize="80%" xref="alg1.l13.m1.2.2.2.2.3.3.5.cmml">e</mi></mrow></mrow></mrow><mo id="alg1.l13.m1.4.4.4.6" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l13.m1.4.4.5a.cmml">.</mo><mrow id="alg1.l13.m1.3.3.3.3" xref="alg1.l13.m1.3.3.3.3.cmml"><mrow id="alg1.l13.m1.3.3.3.3.2" xref="alg1.l13.m1.3.3.3.3.2.cmml"><mrow id="alg1.l13.m1.3.3.3.3.2.2" xref="alg1.l13.m1.3.3.3.3.2.2.cmml"><mi id="alg1.l13.m1.3.3.3.3.2.2.2" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.2.2.2.cmml">A</mi><mo id="alg1.l13.m1.3.3.3.3.2.2.1" xref="alg1.l13.m1.3.3.3.3.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.3.3.3.3.2.2.3" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.2.2.3.cmml">v</mi><mo id="alg1.l13.m1.3.3.3.3.2.2.1a" xref="alg1.l13.m1.3.3.3.3.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.3.3.3.3.2.2.4" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.2.2.4.cmml">g</mi><mo id="alg1.l13.m1.3.3.3.3.2.2.1b" xref="alg1.l13.m1.3.3.3.3.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.3.3.3.3.2.2.5" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.2.2.5.cmml">C</mi><mo id="alg1.l13.m1.3.3.3.3.2.2.1c" xref="alg1.l13.m1.3.3.3.3.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.3.3.3.3.2.2.6" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.2.2.6.cmml">o</mi><mo id="alg1.l13.m1.3.3.3.3.2.2.1d" xref="alg1.l13.m1.3.3.3.3.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.3.3.3.3.2.2.7" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.2.2.7.cmml">s</mi><mo id="alg1.l13.m1.3.3.3.3.2.2.1e" xref="alg1.l13.m1.3.3.3.3.2.2.1.cmml">⁢</mo><mi id="alg1.l13.m1.3.3.3.3.2.2.8" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.2.2.8.cmml">t</mi></mrow><mo id="alg1.l13.m1.3.3.3.3.2.1" lspace="0.222em" mathsize="80%" rspace="0.222em" xref="alg1.l13.m1.3.3.3.3.2.1.cmml">×</mo><mi id="alg1.l13.m1.3.3.3.3.2.3" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.2.3.cmml">n</mi></mrow><mo id="alg1.l13.m1.3.3.3.3.1" xref="alg1.l13.m1.3.3.3.3.1.cmml">⁢</mo><mi id="alg1.l13.m1.3.3.3.3.3" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.3.cmml">o</mi><mo id="alg1.l13.m1.3.3.3.3.1a" xref="alg1.l13.m1.3.3.3.3.1.cmml">⁢</mo><mi id="alg1.l13.m1.3.3.3.3.4" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.4.cmml">d</mi><mo id="alg1.l13.m1.3.3.3.3.1b" xref="alg1.l13.m1.3.3.3.3.1.cmml">⁢</mo><mi id="alg1.l13.m1.3.3.3.3.5" mathsize="80%" xref="alg1.l13.m1.3.3.3.3.5.cmml">e</mi></mrow><mo id="alg1.l13.m1.4.4.4.7" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l13.m1.4.4.5a.cmml">.</mo><mrow id="alg1.l13.m1.4.4.4.4" xref="alg1.l13.m1.4.4.4.4.cmml"><mi id="alg1.l13.m1.4.4.4.4.2" mathsize="80%" xref="alg1.l13.m1.4.4.4.4.2.cmml">F</mi><mo id="alg1.l13.m1.4.4.4.4.1" xref="alg1.l13.m1.4.4.4.4.1.cmml">⁢</mo><mi id="alg1.l13.m1.4.4.4.4.3" mathsize="80%" xref="alg1.l13.m1.4.4.4.4.3.cmml">r</mi><mo id="alg1.l13.m1.4.4.4.4.1a" xref="alg1.l13.m1.4.4.4.4.1.cmml">⁢</mo><mi id="alg1.l13.m1.4.4.4.4.4" mathsize="80%" xref="alg1.l13.m1.4.4.4.4.4.cmml">e</mi><mo id="alg1.l13.m1.4.4.4.4.1b" xref="alg1.l13.m1.4.4.4.4.1.cmml">⁢</mo><mi id="alg1.l13.m1.4.4.4.4.5" mathsize="80%" xref="alg1.l13.m1.4.4.4.4.5.cmml">q</mi><mo id="alg1.l13.m1.4.4.4.4.1c" xref="alg1.l13.m1.4.4.4.4.1.cmml">⁢</mo><mi id="alg1.l13.m1.4.4.4.4.6" mathsize="80%" xref="alg1.l13.m1.4.4.4.4.6.cmml">u</mi><mo id="alg1.l13.m1.4.4.4.4.1d" xref="alg1.l13.m1.4.4.4.4.1.cmml">⁢</mo><mi id="alg1.l13.m1.4.4.4.4.7" mathsize="80%" xref="alg1.l13.m1.4.4.4.4.7.cmml">e</mi><mo id="alg1.l13.m1.4.4.4.4.1e" xref="alg1.l13.m1.4.4.4.4.1.cmml">⁢</mo><mi id="alg1.l13.m1.4.4.4.4.8" mathsize="80%" xref="alg1.l13.m1.4.4.4.4.8.cmml">n</mi><mo id="alg1.l13.m1.4.4.4.4.1f" xref="alg1.l13.m1.4.4.4.4.1.cmml">⁢</mo><mi id="alg1.l13.m1.4.4.4.4.9" mathsize="80%" xref="alg1.l13.m1.4.4.4.4.9.cmml">c</mi><mo id="alg1.l13.m1.4.4.4.4.1g" xref="alg1.l13.m1.4.4.4.4.1.cmml">⁢</mo><mi id="alg1.l13.m1.4.4.4.4.10" mathsize="80%" xref="alg1.l13.m1.4.4.4.4.10.cmml">y</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l13.m1.4b"><apply id="alg1.l13.m1.4.4.5.cmml" xref="alg1.l13.m1.4.4.4"><csymbol cd="ambiguous" id="alg1.l13.m1.4.4.5a.cmml" xref="alg1.l13.m1.4.4.4.5">formulae-sequence</csymbol><apply id="alg1.l13.m1.1.1.1.1.cmml" xref="alg1.l13.m1.1.1.1.1"><times id="alg1.l13.m1.1.1.1.1.1.cmml" xref="alg1.l13.m1.1.1.1.1.1"></times><ci id="alg1.l13.m1.1.1.1.1.2.cmml" xref="alg1.l13.m1.1.1.1.1.2">𝑛</ci><ci id="alg1.l13.m1.1.1.1.1.3.cmml" xref="alg1.l13.m1.1.1.1.1.3">𝑜</ci><ci id="alg1.l13.m1.1.1.1.1.4.cmml" xref="alg1.l13.m1.1.1.1.1.4">𝑑</ci><ci id="alg1.l13.m1.1.1.1.1.5.cmml" xref="alg1.l13.m1.1.1.1.1.5">𝑒</ci></apply><apply id="alg1.l13.m1.2.2.2.2.cmml" xref="alg1.l13.m1.2.2.2.2"><ci id="alg1.l13.m1.2.2.2.2.1.cmml" xref="alg1.l13.m1.2.2.2.2.1">←</ci><apply id="alg1.l13.m1.2.2.2.2.2.cmml" xref="alg1.l13.m1.2.2.2.2.2"><times id="alg1.l13.m1.2.2.2.2.2.1.cmml" xref="alg1.l13.m1.2.2.2.2.2.1"></times><ci id="alg1.l13.m1.2.2.2.2.2.2.cmml" xref="alg1.l13.m1.2.2.2.2.2.2">𝑃</ci><ci id="alg1.l13.m1.2.2.2.2.2.3.cmml" xref="alg1.l13.m1.2.2.2.2.2.3">𝑟</ci><ci id="alg1.l13.m1.2.2.2.2.2.4.cmml" xref="alg1.l13.m1.2.2.2.2.2.4">𝑖</ci><ci id="alg1.l13.m1.2.2.2.2.2.5.cmml" xref="alg1.l13.m1.2.2.2.2.2.5">𝑜</ci><ci id="alg1.l13.m1.2.2.2.2.2.6.cmml" xref="alg1.l13.m1.2.2.2.2.2.6">𝑟</ci><ci id="alg1.l13.m1.2.2.2.2.2.7.cmml" xref="alg1.l13.m1.2.2.2.2.2.7">𝑖</ci><ci id="alg1.l13.m1.2.2.2.2.2.8.cmml" xref="alg1.l13.m1.2.2.2.2.2.8">𝑡</ci><ci id="alg1.l13.m1.2.2.2.2.2.9.cmml" xref="alg1.l13.m1.2.2.2.2.2.9">𝑦</ci></apply><apply id="alg1.l13.m1.2.2.2.2.3.cmml" xref="alg1.l13.m1.2.2.2.2.3"><plus id="alg1.l13.m1.2.2.2.2.3.1.cmml" xref="alg1.l13.m1.2.2.2.2.3.1"></plus><apply id="alg1.l13.m1.2.2.2.2.3.2.cmml" xref="alg1.l13.m1.2.2.2.2.3.2"><times id="alg1.l13.m1.2.2.2.2.3.2.1.cmml" xref="alg1.l13.m1.2.2.2.2.3.2.1"></times><ci id="alg1.l13.m1.2.2.2.2.3.2.2.cmml" xref="alg1.l13.m1.2.2.2.2.3.2.2">𝐶</ci><ci id="alg1.l13.m1.2.2.2.2.3.2.3.cmml" xref="alg1.l13.m1.2.2.2.2.3.2.3">𝑙</ci><ci id="alg1.l13.m1.2.2.2.2.3.2.4.cmml" xref="alg1.l13.m1.2.2.2.2.3.2.4">𝑜</ci><ci id="alg1.l13.m1.2.2.2.2.3.2.5.cmml" xref="alg1.l13.m1.2.2.2.2.3.2.5">𝑐</ci><ci id="alg1.l13.m1.2.2.2.2.3.2.6.cmml" xref="alg1.l13.m1.2.2.2.2.3.2.6">𝑘</ci></apply><apply id="alg1.l13.m1.2.2.2.2.3.3.cmml" xref="alg1.l13.m1.2.2.2.2.3.3"><times id="alg1.l13.m1.2.2.2.2.3.3.1.cmml" xref="alg1.l13.m1.2.2.2.2.3.3.1"></times><ci id="alg1.l13.m1.2.2.2.2.3.3.2.cmml" xref="alg1.l13.m1.2.2.2.2.3.3.2">𝑛</ci><ci id="alg1.l13.m1.2.2.2.2.3.3.3.cmml" xref="alg1.l13.m1.2.2.2.2.3.3.3">𝑜</ci><ci id="alg1.l13.m1.2.2.2.2.3.3.4.cmml" xref="alg1.l13.m1.2.2.2.2.3.3.4">𝑑</ci><ci id="alg1.l13.m1.2.2.2.2.3.3.5.cmml" xref="alg1.l13.m1.2.2.2.2.3.3.5">𝑒</ci></apply></apply></apply><apply id="alg1.l13.m1.3.3.3.3.cmml" xref="alg1.l13.m1.3.3.3.3"><times id="alg1.l13.m1.3.3.3.3.1.cmml" xref="alg1.l13.m1.3.3.3.3.1"></times><apply id="alg1.l13.m1.3.3.3.3.2.cmml" xref="alg1.l13.m1.3.3.3.3.2"><times id="alg1.l13.m1.3.3.3.3.2.1.cmml" xref="alg1.l13.m1.3.3.3.3.2.1"></times><apply id="alg1.l13.m1.3.3.3.3.2.2.cmml" xref="alg1.l13.m1.3.3.3.3.2.2"><times id="alg1.l13.m1.3.3.3.3.2.2.1.cmml" xref="alg1.l13.m1.3.3.3.3.2.2.1"></times><ci id="alg1.l13.m1.3.3.3.3.2.2.2.cmml" xref="alg1.l13.m1.3.3.3.3.2.2.2">𝐴</ci><ci id="alg1.l13.m1.3.3.3.3.2.2.3.cmml" xref="alg1.l13.m1.3.3.3.3.2.2.3">𝑣</ci><ci id="alg1.l13.m1.3.3.3.3.2.2.4.cmml" xref="alg1.l13.m1.3.3.3.3.2.2.4">𝑔</ci><ci id="alg1.l13.m1.3.3.3.3.2.2.5.cmml" xref="alg1.l13.m1.3.3.3.3.2.2.5">𝐶</ci><ci id="alg1.l13.m1.3.3.3.3.2.2.6.cmml" xref="alg1.l13.m1.3.3.3.3.2.2.6">𝑜</ci><ci id="alg1.l13.m1.3.3.3.3.2.2.7.cmml" xref="alg1.l13.m1.3.3.3.3.2.2.7">𝑠</ci><ci id="alg1.l13.m1.3.3.3.3.2.2.8.cmml" xref="alg1.l13.m1.3.3.3.3.2.2.8">𝑡</ci></apply><ci id="alg1.l13.m1.3.3.3.3.2.3.cmml" xref="alg1.l13.m1.3.3.3.3.2.3">𝑛</ci></apply><ci id="alg1.l13.m1.3.3.3.3.3.cmml" xref="alg1.l13.m1.3.3.3.3.3">𝑜</ci><ci id="alg1.l13.m1.3.3.3.3.4.cmml" xref="alg1.l13.m1.3.3.3.3.4">𝑑</ci><ci id="alg1.l13.m1.3.3.3.3.5.cmml" xref="alg1.l13.m1.3.3.3.3.5">𝑒</ci></apply><apply id="alg1.l13.m1.4.4.4.4.cmml" xref="alg1.l13.m1.4.4.4.4"><times id="alg1.l13.m1.4.4.4.4.1.cmml" xref="alg1.l13.m1.4.4.4.4.1"></times><ci id="alg1.l13.m1.4.4.4.4.2.cmml" xref="alg1.l13.m1.4.4.4.4.2">𝐹</ci><ci id="alg1.l13.m1.4.4.4.4.3.cmml" xref="alg1.l13.m1.4.4.4.4.3">𝑟</ci><ci id="alg1.l13.m1.4.4.4.4.4.cmml" xref="alg1.l13.m1.4.4.4.4.4">𝑒</ci><ci id="alg1.l13.m1.4.4.4.4.5.cmml" xref="alg1.l13.m1.4.4.4.4.5">𝑞</ci><ci id="alg1.l13.m1.4.4.4.4.6.cmml" xref="alg1.l13.m1.4.4.4.4.6">𝑢</ci><ci id="alg1.l13.m1.4.4.4.4.7.cmml" xref="alg1.l13.m1.4.4.4.4.7">𝑒</ci><ci id="alg1.l13.m1.4.4.4.4.8.cmml" xref="alg1.l13.m1.4.4.4.4.8">𝑛</ci><ci id="alg1.l13.m1.4.4.4.4.9.cmml" xref="alg1.l13.m1.4.4.4.4.9">𝑐</ci><ci id="alg1.l13.m1.4.4.4.4.10.cmml" xref="alg1.l13.m1.4.4.4.4.10">𝑦</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l13.m1.4c">node.Priority\leftarrow Clock+node.AvgCost\times node.Frequency</annotation><annotation encoding="application/x-llamapun" id="alg1.l13.m1.4d">italic_n italic_o italic_d italic_e . italic_P italic_r italic_i italic_o italic_r italic_i italic_t italic_y ← italic_C italic_l italic_o italic_c italic_k + italic_n italic_o italic_d italic_e . italic_A italic_v italic_g italic_C italic_o italic_s italic_t × italic_n italic_o italic_d italic_e . italic_F italic_r italic_e italic_q italic_u italic_e italic_n italic_c italic_y</annotation></semantics></math><span class="ltx_text" id="alg1.l13.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l14">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l14.1.1.1" style="font-size:80%;">14:</span></span>
</div>
<div class="ltx_listingline" id="alg1.l15">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l15.1.1.1" style="font-size:80%;">15:</span></span><span class="ltx_text ltx_font_bold" id="alg1.l15.2" style="font-size:80%;">function</span><span class="ltx_text" id="alg1.l15.3" style="font-size:80%;"> </span><span class="ltx_text ltx_font_smallcaps" id="alg1.l15.4" style="font-size:80%;">EVICT_IN_GPU</span><span class="ltx_text" id="alg1.l15.5" style="font-size:80%;">(</span><math alttext="required\_size" class="ltx_Math" display="inline" id="alg1.l15.m1.1"><semantics id="alg1.l15.m1.1a"><mrow id="alg1.l15.m1.1.1" xref="alg1.l15.m1.1.1.cmml"><mi id="alg1.l15.m1.1.1.2" mathsize="80%" xref="alg1.l15.m1.1.1.2.cmml">r</mi><mo id="alg1.l15.m1.1.1.1" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.3" mathsize="80%" xref="alg1.l15.m1.1.1.3.cmml">e</mi><mo id="alg1.l15.m1.1.1.1a" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.4" mathsize="80%" xref="alg1.l15.m1.1.1.4.cmml">q</mi><mo id="alg1.l15.m1.1.1.1b" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.5" mathsize="80%" xref="alg1.l15.m1.1.1.5.cmml">u</mi><mo id="alg1.l15.m1.1.1.1c" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.6" mathsize="80%" xref="alg1.l15.m1.1.1.6.cmml">i</mi><mo id="alg1.l15.m1.1.1.1d" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.7" mathsize="80%" xref="alg1.l15.m1.1.1.7.cmml">r</mi><mo id="alg1.l15.m1.1.1.1e" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.8" mathsize="80%" xref="alg1.l15.m1.1.1.8.cmml">e</mi><mo id="alg1.l15.m1.1.1.1f" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.9" mathsize="80%" xref="alg1.l15.m1.1.1.9.cmml">d</mi><mo id="alg1.l15.m1.1.1.1g" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.10" mathsize="80%" mathvariant="normal" xref="alg1.l15.m1.1.1.10.cmml">_</mi><mo id="alg1.l15.m1.1.1.1h" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.11" mathsize="80%" xref="alg1.l15.m1.1.1.11.cmml">s</mi><mo id="alg1.l15.m1.1.1.1i" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.12" mathsize="80%" xref="alg1.l15.m1.1.1.12.cmml">i</mi><mo id="alg1.l15.m1.1.1.1j" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.13" mathsize="80%" xref="alg1.l15.m1.1.1.13.cmml">z</mi><mo id="alg1.l15.m1.1.1.1k" xref="alg1.l15.m1.1.1.1.cmml">⁢</mo><mi id="alg1.l15.m1.1.1.14" mathsize="80%" xref="alg1.l15.m1.1.1.14.cmml">e</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l15.m1.1b"><apply id="alg1.l15.m1.1.1.cmml" xref="alg1.l15.m1.1.1"><times id="alg1.l15.m1.1.1.1.cmml" xref="alg1.l15.m1.1.1.1"></times><ci id="alg1.l15.m1.1.1.2.cmml" xref="alg1.l15.m1.1.1.2">𝑟</ci><ci id="alg1.l15.m1.1.1.3.cmml" xref="alg1.l15.m1.1.1.3">𝑒</ci><ci id="alg1.l15.m1.1.1.4.cmml" xref="alg1.l15.m1.1.1.4">𝑞</ci><ci id="alg1.l15.m1.1.1.5.cmml" xref="alg1.l15.m1.1.1.5">𝑢</ci><ci id="alg1.l15.m1.1.1.6.cmml" xref="alg1.l15.m1.1.1.6">𝑖</ci><ci id="alg1.l15.m1.1.1.7.cmml" xref="alg1.l15.m1.1.1.7">𝑟</ci><ci id="alg1.l15.m1.1.1.8.cmml" xref="alg1.l15.m1.1.1.8">𝑒</ci><ci id="alg1.l15.m1.1.1.9.cmml" xref="alg1.l15.m1.1.1.9">𝑑</ci><ci id="alg1.l15.m1.1.1.10.cmml" xref="alg1.l15.m1.1.1.10">_</ci><ci id="alg1.l15.m1.1.1.11.cmml" xref="alg1.l15.m1.1.1.11">𝑠</ci><ci id="alg1.l15.m1.1.1.12.cmml" xref="alg1.l15.m1.1.1.12">𝑖</ci><ci id="alg1.l15.m1.1.1.13.cmml" xref="alg1.l15.m1.1.1.13">𝑧</ci><ci id="alg1.l15.m1.1.1.14.cmml" xref="alg1.l15.m1.1.1.14">𝑒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l15.m1.1c">required\_size</annotation><annotation encoding="application/x-llamapun" id="alg1.l15.m1.1d">italic_r italic_e italic_q italic_u italic_i italic_r italic_e italic_d _ italic_s italic_i italic_z italic_e</annotation></semantics></math><span class="ltx_text" id="alg1.l15.6" style="font-size:80%;">)
</span>
</div>
<div class="ltx_listingline" id="alg1.l16">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l16.1.1.1" style="font-size:80%;">16:</span></span><span class="ltx_text" id="alg1.l16.2" style="font-size:80%;">    </span><math alttext="E\leftarrow\emptyset" class="ltx_Math" display="inline" id="alg1.l16.m1.1"><semantics id="alg1.l16.m1.1a"><mrow id="alg1.l16.m1.1.1" xref="alg1.l16.m1.1.1.cmml"><mi id="alg1.l16.m1.1.1.2" mathsize="80%" xref="alg1.l16.m1.1.1.2.cmml">E</mi><mo id="alg1.l16.m1.1.1.1" mathsize="80%" stretchy="false" xref="alg1.l16.m1.1.1.1.cmml">←</mo><mi id="alg1.l16.m1.1.1.3" mathsize="80%" mathvariant="normal" xref="alg1.l16.m1.1.1.3.cmml">∅</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l16.m1.1b"><apply id="alg1.l16.m1.1.1.cmml" xref="alg1.l16.m1.1.1"><ci id="alg1.l16.m1.1.1.1.cmml" xref="alg1.l16.m1.1.1.1">←</ci><ci id="alg1.l16.m1.1.1.2.cmml" xref="alg1.l16.m1.1.1.2">𝐸</ci><emptyset id="alg1.l16.m1.1.1.3.cmml" xref="alg1.l16.m1.1.1.3"></emptyset></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l16.m1.1c">E\leftarrow\emptyset</annotation><annotation encoding="application/x-llamapun" id="alg1.l16.m1.1d">italic_E ← ∅</annotation></semantics></math><span class="ltx_text" id="alg1.l16.3" style="font-size:80%;"> </span><span class="ltx_text ltx_font_bold" id="alg1.l16.4" style="font-size:80%;">// Evicted nodes in GPU</span><span class="ltx_text" id="alg1.l16.5" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l17">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l17.1.1.1" style="font-size:80%;">17:</span></span><span class="ltx_text" id="alg1.l17.2" style="font-size:80%;">    </span><math alttext="S\leftarrow\{n\in GPU\wedge n.Children\notin GPU\}" class="ltx_math_unparsed" display="inline" id="alg1.l17.m1.1"><semantics id="alg1.l17.m1.1a"><mrow id="alg1.l17.m1.1b"><mi id="alg1.l17.m1.1.1" mathsize="80%">S</mi><mo id="alg1.l17.m1.1.2" mathsize="80%" stretchy="false">←</mo><mrow id="alg1.l17.m1.1.3"><mo id="alg1.l17.m1.1.3.1" maxsize="80%" minsize="80%">{</mo><mi id="alg1.l17.m1.1.3.2" mathsize="80%">n</mi><mo id="alg1.l17.m1.1.3.3" mathsize="80%">∈</mo><mi id="alg1.l17.m1.1.3.4" mathsize="80%">G</mi><mi id="alg1.l17.m1.1.3.5" mathsize="80%">P</mi><mi id="alg1.l17.m1.1.3.6" mathsize="80%">U</mi><mo id="alg1.l17.m1.1.3.7" mathsize="80%">∧</mo><mi id="alg1.l17.m1.1.3.8" mathsize="80%">n</mi><mo id="alg1.l17.m1.1.3.9" lspace="0em" mathsize="80%" rspace="0.167em">.</mo><mi id="alg1.l17.m1.1.3.10" mathsize="80%">C</mi><mi id="alg1.l17.m1.1.3.11" mathsize="80%">h</mi><mi id="alg1.l17.m1.1.3.12" mathsize="80%">i</mi><mi id="alg1.l17.m1.1.3.13" mathsize="80%">l</mi><mi id="alg1.l17.m1.1.3.14" mathsize="80%">d</mi><mi id="alg1.l17.m1.1.3.15" mathsize="80%">r</mi><mi id="alg1.l17.m1.1.3.16" mathsize="80%">e</mi><mi id="alg1.l17.m1.1.3.17" mathsize="80%">n</mi><mo id="alg1.l17.m1.1.3.18" mathsize="80%">∉</mo><mi id="alg1.l17.m1.1.3.19" mathsize="80%">G</mi><mi id="alg1.l17.m1.1.3.20" mathsize="80%">P</mi><mi id="alg1.l17.m1.1.3.21" mathsize="80%">U</mi><mo id="alg1.l17.m1.1.3.22" maxsize="80%" minsize="80%">}</mo></mrow></mrow><annotation encoding="application/x-tex" id="alg1.l17.m1.1c">S\leftarrow\{n\in GPU\wedge n.Children\notin GPU\}</annotation><annotation encoding="application/x-llamapun" id="alg1.l17.m1.1d">italic_S ← { italic_n ∈ italic_G italic_P italic_U ∧ italic_n . italic_C italic_h italic_i italic_l italic_d italic_r italic_e italic_n ∉ italic_G italic_P italic_U }</annotation></semantics></math><span class="ltx_text" id="alg1.l17.3" style="font-size:80%;"> </span><span class="ltx_text ltx_font_bold" id="alg1.l17.4" style="font-size:80%;">// Leaf nodes in GPU</span><span class="ltx_text" id="alg1.l17.5" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l18">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l18.1.1.1" style="font-size:80%;">18:</span></span><span class="ltx_text" id="alg1.l18.2" style="font-size:80%;">    </span><span class="ltx_text ltx_font_bold" id="alg1.l18.3" style="font-size:80%;">while</span><span class="ltx_text" id="alg1.l18.4" style="font-size:80%;"> </span><math alttext="\sum_{n\in E}n.Size&lt;required\_size" class="ltx_Math" display="inline" id="alg1.l18.m1.2"><semantics id="alg1.l18.m1.2a"><mrow id="alg1.l18.m1.2.2.2" xref="alg1.l18.m1.2.2.3.cmml"><mrow id="alg1.l18.m1.1.1.1.1" xref="alg1.l18.m1.1.1.1.1.cmml"><msub id="alg1.l18.m1.1.1.1.1.1" xref="alg1.l18.m1.1.1.1.1.1.cmml"><mo id="alg1.l18.m1.1.1.1.1.1.2" maxsize="80%" minsize="80%" stretchy="true" xref="alg1.l18.m1.1.1.1.1.1.2.cmml">∑</mo><mrow id="alg1.l18.m1.1.1.1.1.1.3" xref="alg1.l18.m1.1.1.1.1.1.3.cmml"><mi id="alg1.l18.m1.1.1.1.1.1.3.2" mathsize="80%" xref="alg1.l18.m1.1.1.1.1.1.3.2.cmml">n</mi><mo id="alg1.l18.m1.1.1.1.1.1.3.1" mathsize="80%" xref="alg1.l18.m1.1.1.1.1.1.3.1.cmml">∈</mo><mi id="alg1.l18.m1.1.1.1.1.1.3.3" mathsize="80%" xref="alg1.l18.m1.1.1.1.1.1.3.3.cmml">E</mi></mrow></msub><mi id="alg1.l18.m1.1.1.1.1.2" mathsize="80%" xref="alg1.l18.m1.1.1.1.1.2.cmml">n</mi></mrow><mo id="alg1.l18.m1.2.2.2.3" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l18.m1.2.2.3a.cmml">.</mo><mrow id="alg1.l18.m1.2.2.2.2" xref="alg1.l18.m1.2.2.2.2.cmml"><mrow id="alg1.l18.m1.2.2.2.2.2" xref="alg1.l18.m1.2.2.2.2.2.cmml"><mi id="alg1.l18.m1.2.2.2.2.2.2" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.2.2.cmml">S</mi><mo id="alg1.l18.m1.2.2.2.2.2.1" xref="alg1.l18.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.2.3" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.2.3.cmml">i</mi><mo id="alg1.l18.m1.2.2.2.2.2.1a" xref="alg1.l18.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.2.4" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.2.4.cmml">z</mi><mo id="alg1.l18.m1.2.2.2.2.2.1b" xref="alg1.l18.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.2.5" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.2.5.cmml">e</mi></mrow><mo id="alg1.l18.m1.2.2.2.2.1" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.1.cmml">&lt;</mo><mrow id="alg1.l18.m1.2.2.2.2.3" xref="alg1.l18.m1.2.2.2.2.3.cmml"><mi id="alg1.l18.m1.2.2.2.2.3.2" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.2.cmml">r</mi><mo id="alg1.l18.m1.2.2.2.2.3.1" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.3" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.3.cmml">e</mi><mo id="alg1.l18.m1.2.2.2.2.3.1a" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.4" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.4.cmml">q</mi><mo id="alg1.l18.m1.2.2.2.2.3.1b" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.5" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.5.cmml">u</mi><mo id="alg1.l18.m1.2.2.2.2.3.1c" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.6" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.6.cmml">i</mi><mo id="alg1.l18.m1.2.2.2.2.3.1d" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.7" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.7.cmml">r</mi><mo id="alg1.l18.m1.2.2.2.2.3.1e" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.8" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.8.cmml">e</mi><mo id="alg1.l18.m1.2.2.2.2.3.1f" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.9" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.9.cmml">d</mi><mo id="alg1.l18.m1.2.2.2.2.3.1g" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.10" mathsize="80%" mathvariant="normal" xref="alg1.l18.m1.2.2.2.2.3.10.cmml">_</mi><mo id="alg1.l18.m1.2.2.2.2.3.1h" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.11" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.11.cmml">s</mi><mo id="alg1.l18.m1.2.2.2.2.3.1i" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.12" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.12.cmml">i</mi><mo id="alg1.l18.m1.2.2.2.2.3.1j" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.13" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.13.cmml">z</mi><mo id="alg1.l18.m1.2.2.2.2.3.1k" xref="alg1.l18.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg1.l18.m1.2.2.2.2.3.14" mathsize="80%" xref="alg1.l18.m1.2.2.2.2.3.14.cmml">e</mi></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l18.m1.2b"><apply id="alg1.l18.m1.2.2.3.cmml" xref="alg1.l18.m1.2.2.2"><csymbol cd="ambiguous" id="alg1.l18.m1.2.2.3a.cmml" xref="alg1.l18.m1.2.2.2.3">formulae-sequence</csymbol><apply id="alg1.l18.m1.1.1.1.1.cmml" xref="alg1.l18.m1.1.1.1.1"><apply id="alg1.l18.m1.1.1.1.1.1.cmml" xref="alg1.l18.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l18.m1.1.1.1.1.1.1.cmml" xref="alg1.l18.m1.1.1.1.1.1">subscript</csymbol><sum id="alg1.l18.m1.1.1.1.1.1.2.cmml" xref="alg1.l18.m1.1.1.1.1.1.2"></sum><apply id="alg1.l18.m1.1.1.1.1.1.3.cmml" xref="alg1.l18.m1.1.1.1.1.1.3"><in id="alg1.l18.m1.1.1.1.1.1.3.1.cmml" xref="alg1.l18.m1.1.1.1.1.1.3.1"></in><ci id="alg1.l18.m1.1.1.1.1.1.3.2.cmml" xref="alg1.l18.m1.1.1.1.1.1.3.2">𝑛</ci><ci id="alg1.l18.m1.1.1.1.1.1.3.3.cmml" xref="alg1.l18.m1.1.1.1.1.1.3.3">𝐸</ci></apply></apply><ci id="alg1.l18.m1.1.1.1.1.2.cmml" xref="alg1.l18.m1.1.1.1.1.2">𝑛</ci></apply><apply id="alg1.l18.m1.2.2.2.2.cmml" xref="alg1.l18.m1.2.2.2.2"><lt id="alg1.l18.m1.2.2.2.2.1.cmml" xref="alg1.l18.m1.2.2.2.2.1"></lt><apply id="alg1.l18.m1.2.2.2.2.2.cmml" xref="alg1.l18.m1.2.2.2.2.2"><times id="alg1.l18.m1.2.2.2.2.2.1.cmml" xref="alg1.l18.m1.2.2.2.2.2.1"></times><ci id="alg1.l18.m1.2.2.2.2.2.2.cmml" xref="alg1.l18.m1.2.2.2.2.2.2">𝑆</ci><ci id="alg1.l18.m1.2.2.2.2.2.3.cmml" xref="alg1.l18.m1.2.2.2.2.2.3">𝑖</ci><ci id="alg1.l18.m1.2.2.2.2.2.4.cmml" xref="alg1.l18.m1.2.2.2.2.2.4">𝑧</ci><ci id="alg1.l18.m1.2.2.2.2.2.5.cmml" xref="alg1.l18.m1.2.2.2.2.2.5">𝑒</ci></apply><apply id="alg1.l18.m1.2.2.2.2.3.cmml" xref="alg1.l18.m1.2.2.2.2.3"><times id="alg1.l18.m1.2.2.2.2.3.1.cmml" xref="alg1.l18.m1.2.2.2.2.3.1"></times><ci id="alg1.l18.m1.2.2.2.2.3.2.cmml" xref="alg1.l18.m1.2.2.2.2.3.2">𝑟</ci><ci id="alg1.l18.m1.2.2.2.2.3.3.cmml" xref="alg1.l18.m1.2.2.2.2.3.3">𝑒</ci><ci id="alg1.l18.m1.2.2.2.2.3.4.cmml" xref="alg1.l18.m1.2.2.2.2.3.4">𝑞</ci><ci id="alg1.l18.m1.2.2.2.2.3.5.cmml" xref="alg1.l18.m1.2.2.2.2.3.5">𝑢</ci><ci id="alg1.l18.m1.2.2.2.2.3.6.cmml" xref="alg1.l18.m1.2.2.2.2.3.6">𝑖</ci><ci id="alg1.l18.m1.2.2.2.2.3.7.cmml" xref="alg1.l18.m1.2.2.2.2.3.7">𝑟</ci><ci id="alg1.l18.m1.2.2.2.2.3.8.cmml" xref="alg1.l18.m1.2.2.2.2.3.8">𝑒</ci><ci id="alg1.l18.m1.2.2.2.2.3.9.cmml" xref="alg1.l18.m1.2.2.2.2.3.9">𝑑</ci><ci id="alg1.l18.m1.2.2.2.2.3.10.cmml" xref="alg1.l18.m1.2.2.2.2.3.10">_</ci><ci id="alg1.l18.m1.2.2.2.2.3.11.cmml" xref="alg1.l18.m1.2.2.2.2.3.11">𝑠</ci><ci id="alg1.l18.m1.2.2.2.2.3.12.cmml" xref="alg1.l18.m1.2.2.2.2.3.12">𝑖</ci><ci id="alg1.l18.m1.2.2.2.2.3.13.cmml" xref="alg1.l18.m1.2.2.2.2.3.13">𝑧</ci><ci id="alg1.l18.m1.2.2.2.2.3.14.cmml" xref="alg1.l18.m1.2.2.2.2.3.14">𝑒</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l18.m1.2c">\sum_{n\in E}n.Size&lt;required\_size</annotation><annotation encoding="application/x-llamapun" id="alg1.l18.m1.2d">∑ start_POSTSUBSCRIPT italic_n ∈ italic_E end_POSTSUBSCRIPT italic_n . italic_S italic_i italic_z italic_e &lt; italic_r italic_e italic_q italic_u italic_i italic_r italic_e italic_d _ italic_s italic_i italic_z italic_e</annotation></semantics></math><span class="ltx_text" id="alg1.l18.5" style="font-size:80%;"> </span><span class="ltx_text ltx_font_bold" id="alg1.l18.6" style="font-size:80%;">do</span><span class="ltx_text" id="alg1.l18.7" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l19">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l19.1.1.1" style="font-size:80%;">19:</span></span><span class="ltx_text" id="alg1.l19.2" style="font-size:80%;">        </span><math alttext="n\leftarrow\operatorname*{arg\,min}_{n\in S}n.Priority" class="ltx_Math" display="inline" id="alg1.l19.m1.2"><semantics id="alg1.l19.m1.2a"><mrow id="alg1.l19.m1.2.2.2" xref="alg1.l19.m1.2.2.3.cmml"><mrow id="alg1.l19.m1.1.1.1.1" xref="alg1.l19.m1.1.1.1.1.cmml"><mi id="alg1.l19.m1.1.1.1.1.2" mathsize="80%" xref="alg1.l19.m1.1.1.1.1.2.cmml">n</mi><mo id="alg1.l19.m1.1.1.1.1.1" mathsize="80%" stretchy="false" xref="alg1.l19.m1.1.1.1.1.1.cmml">←</mo><mrow id="alg1.l19.m1.1.1.1.1.3" xref="alg1.l19.m1.1.1.1.1.3.cmml"><msub id="alg1.l19.m1.1.1.1.1.3.1" xref="alg1.l19.m1.1.1.1.1.3.1.cmml"><mrow id="alg1.l19.m1.1.1.1.1.3.1.2" xref="alg1.l19.m1.1.1.1.1.3.1.2.cmml"><mi id="alg1.l19.m1.1.1.1.1.3.1.2.2" mathsize="80%" xref="alg1.l19.m1.1.1.1.1.3.1.2.2.cmml">arg</mi><mo id="alg1.l19.m1.1.1.1.1.3.1.2.1" lspace="0.170em" xref="alg1.l19.m1.1.1.1.1.3.1.2.1.cmml">⁢</mo><mi id="alg1.l19.m1.1.1.1.1.3.1.2.3" mathsize="80%" xref="alg1.l19.m1.1.1.1.1.3.1.2.3.cmml">min</mi></mrow><mrow id="alg1.l19.m1.1.1.1.1.3.1.3" xref="alg1.l19.m1.1.1.1.1.3.1.3.cmml"><mi id="alg1.l19.m1.1.1.1.1.3.1.3.2" mathsize="80%" xref="alg1.l19.m1.1.1.1.1.3.1.3.2.cmml">n</mi><mo id="alg1.l19.m1.1.1.1.1.3.1.3.1" mathsize="80%" xref="alg1.l19.m1.1.1.1.1.3.1.3.1.cmml">∈</mo><mi id="alg1.l19.m1.1.1.1.1.3.1.3.3" mathsize="80%" xref="alg1.l19.m1.1.1.1.1.3.1.3.3.cmml">S</mi></mrow></msub><mo id="alg1.l19.m1.1.1.1.1.3a" xref="alg1.l19.m1.1.1.1.1.3.cmml">⁡</mo><mi id="alg1.l19.m1.1.1.1.1.3.2" mathsize="80%" xref="alg1.l19.m1.1.1.1.1.3.2.cmml">n</mi></mrow></mrow><mo id="alg1.l19.m1.2.2.2.3" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l19.m1.2.2.3a.cmml">.</mo><mrow id="alg1.l19.m1.2.2.2.2" xref="alg1.l19.m1.2.2.2.2.cmml"><mi id="alg1.l19.m1.2.2.2.2.2" mathsize="80%" xref="alg1.l19.m1.2.2.2.2.2.cmml">P</mi><mo id="alg1.l19.m1.2.2.2.2.1" xref="alg1.l19.m1.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l19.m1.2.2.2.2.3" mathsize="80%" xref="alg1.l19.m1.2.2.2.2.3.cmml">r</mi><mo id="alg1.l19.m1.2.2.2.2.1a" xref="alg1.l19.m1.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l19.m1.2.2.2.2.4" mathsize="80%" xref="alg1.l19.m1.2.2.2.2.4.cmml">i</mi><mo id="alg1.l19.m1.2.2.2.2.1b" xref="alg1.l19.m1.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l19.m1.2.2.2.2.5" mathsize="80%" xref="alg1.l19.m1.2.2.2.2.5.cmml">o</mi><mo id="alg1.l19.m1.2.2.2.2.1c" xref="alg1.l19.m1.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l19.m1.2.2.2.2.6" mathsize="80%" xref="alg1.l19.m1.2.2.2.2.6.cmml">r</mi><mo id="alg1.l19.m1.2.2.2.2.1d" xref="alg1.l19.m1.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l19.m1.2.2.2.2.7" mathsize="80%" xref="alg1.l19.m1.2.2.2.2.7.cmml">i</mi><mo id="alg1.l19.m1.2.2.2.2.1e" xref="alg1.l19.m1.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l19.m1.2.2.2.2.8" mathsize="80%" xref="alg1.l19.m1.2.2.2.2.8.cmml">t</mi><mo id="alg1.l19.m1.2.2.2.2.1f" xref="alg1.l19.m1.2.2.2.2.1.cmml">⁢</mo><mi id="alg1.l19.m1.2.2.2.2.9" mathsize="80%" xref="alg1.l19.m1.2.2.2.2.9.cmml">y</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l19.m1.2b"><apply id="alg1.l19.m1.2.2.3.cmml" xref="alg1.l19.m1.2.2.2"><csymbol cd="ambiguous" id="alg1.l19.m1.2.2.3a.cmml" xref="alg1.l19.m1.2.2.2.3">formulae-sequence</csymbol><apply id="alg1.l19.m1.1.1.1.1.cmml" xref="alg1.l19.m1.1.1.1.1"><ci id="alg1.l19.m1.1.1.1.1.1.cmml" xref="alg1.l19.m1.1.1.1.1.1">←</ci><ci id="alg1.l19.m1.1.1.1.1.2.cmml" xref="alg1.l19.m1.1.1.1.1.2">𝑛</ci><apply id="alg1.l19.m1.1.1.1.1.3.cmml" xref="alg1.l19.m1.1.1.1.1.3"><apply id="alg1.l19.m1.1.1.1.1.3.1.cmml" xref="alg1.l19.m1.1.1.1.1.3.1"><csymbol cd="ambiguous" id="alg1.l19.m1.1.1.1.1.3.1.1.cmml" xref="alg1.l19.m1.1.1.1.1.3.1">subscript</csymbol><apply id="alg1.l19.m1.1.1.1.1.3.1.2.cmml" xref="alg1.l19.m1.1.1.1.1.3.1.2"><times id="alg1.l19.m1.1.1.1.1.3.1.2.1.cmml" xref="alg1.l19.m1.1.1.1.1.3.1.2.1"></times><ci id="alg1.l19.m1.1.1.1.1.3.1.2.2.cmml" xref="alg1.l19.m1.1.1.1.1.3.1.2.2">arg</ci><ci id="alg1.l19.m1.1.1.1.1.3.1.2.3.cmml" xref="alg1.l19.m1.1.1.1.1.3.1.2.3">min</ci></apply><apply id="alg1.l19.m1.1.1.1.1.3.1.3.cmml" xref="alg1.l19.m1.1.1.1.1.3.1.3"><in id="alg1.l19.m1.1.1.1.1.3.1.3.1.cmml" xref="alg1.l19.m1.1.1.1.1.3.1.3.1"></in><ci id="alg1.l19.m1.1.1.1.1.3.1.3.2.cmml" xref="alg1.l19.m1.1.1.1.1.3.1.3.2">𝑛</ci><ci id="alg1.l19.m1.1.1.1.1.3.1.3.3.cmml" xref="alg1.l19.m1.1.1.1.1.3.1.3.3">𝑆</ci></apply></apply><ci id="alg1.l19.m1.1.1.1.1.3.2.cmml" xref="alg1.l19.m1.1.1.1.1.3.2">𝑛</ci></apply></apply><apply id="alg1.l19.m1.2.2.2.2.cmml" xref="alg1.l19.m1.2.2.2.2"><times id="alg1.l19.m1.2.2.2.2.1.cmml" xref="alg1.l19.m1.2.2.2.2.1"></times><ci id="alg1.l19.m1.2.2.2.2.2.cmml" xref="alg1.l19.m1.2.2.2.2.2">𝑃</ci><ci id="alg1.l19.m1.2.2.2.2.3.cmml" xref="alg1.l19.m1.2.2.2.2.3">𝑟</ci><ci id="alg1.l19.m1.2.2.2.2.4.cmml" xref="alg1.l19.m1.2.2.2.2.4">𝑖</ci><ci id="alg1.l19.m1.2.2.2.2.5.cmml" xref="alg1.l19.m1.2.2.2.2.5">𝑜</ci><ci id="alg1.l19.m1.2.2.2.2.6.cmml" xref="alg1.l19.m1.2.2.2.2.6">𝑟</ci><ci id="alg1.l19.m1.2.2.2.2.7.cmml" xref="alg1.l19.m1.2.2.2.2.7">𝑖</ci><ci id="alg1.l19.m1.2.2.2.2.8.cmml" xref="alg1.l19.m1.2.2.2.2.8">𝑡</ci><ci id="alg1.l19.m1.2.2.2.2.9.cmml" xref="alg1.l19.m1.2.2.2.2.9">𝑦</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l19.m1.2c">n\leftarrow\operatorname*{arg\,min}_{n\in S}n.Priority</annotation><annotation encoding="application/x-llamapun" id="alg1.l19.m1.2d">italic_n ← start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_n ∈ italic_S end_POSTSUBSCRIPT italic_n . italic_P italic_r italic_i italic_o italic_r italic_i italic_t italic_y</annotation></semantics></math><span class="ltx_text" id="alg1.l19.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l20">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l20.1.1.1" style="font-size:80%;">20:</span></span><span class="ltx_text" id="alg1.l20.2" style="font-size:80%;">        </span><math alttext="E\leftarrow E\cup\{n\}" class="ltx_Math" display="inline" id="alg1.l20.m1.1"><semantics id="alg1.l20.m1.1a"><mrow id="alg1.l20.m1.1.2" xref="alg1.l20.m1.1.2.cmml"><mi id="alg1.l20.m1.1.2.2" mathsize="80%" xref="alg1.l20.m1.1.2.2.cmml">E</mi><mo id="alg1.l20.m1.1.2.1" mathsize="80%" stretchy="false" xref="alg1.l20.m1.1.2.1.cmml">←</mo><mrow id="alg1.l20.m1.1.2.3" xref="alg1.l20.m1.1.2.3.cmml"><mi id="alg1.l20.m1.1.2.3.2" mathsize="80%" xref="alg1.l20.m1.1.2.3.2.cmml">E</mi><mo id="alg1.l20.m1.1.2.3.1" mathsize="80%" xref="alg1.l20.m1.1.2.3.1.cmml">∪</mo><mrow id="alg1.l20.m1.1.2.3.3.2" xref="alg1.l20.m1.1.2.3.3.1.cmml"><mo id="alg1.l20.m1.1.2.3.3.2.1" maxsize="80%" minsize="80%" xref="alg1.l20.m1.1.2.3.3.1.cmml">{</mo><mi id="alg1.l20.m1.1.1" mathsize="80%" xref="alg1.l20.m1.1.1.cmml">n</mi><mo id="alg1.l20.m1.1.2.3.3.2.2" maxsize="80%" minsize="80%" xref="alg1.l20.m1.1.2.3.3.1.cmml">}</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l20.m1.1b"><apply id="alg1.l20.m1.1.2.cmml" xref="alg1.l20.m1.1.2"><ci id="alg1.l20.m1.1.2.1.cmml" xref="alg1.l20.m1.1.2.1">←</ci><ci id="alg1.l20.m1.1.2.2.cmml" xref="alg1.l20.m1.1.2.2">𝐸</ci><apply id="alg1.l20.m1.1.2.3.cmml" xref="alg1.l20.m1.1.2.3"><union id="alg1.l20.m1.1.2.3.1.cmml" xref="alg1.l20.m1.1.2.3.1"></union><ci id="alg1.l20.m1.1.2.3.2.cmml" xref="alg1.l20.m1.1.2.3.2">𝐸</ci><set id="alg1.l20.m1.1.2.3.3.1.cmml" xref="alg1.l20.m1.1.2.3.3.2"><ci id="alg1.l20.m1.1.1.cmml" xref="alg1.l20.m1.1.1">𝑛</ci></set></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l20.m1.1c">E\leftarrow E\cup\{n\}</annotation><annotation encoding="application/x-llamapun" id="alg1.l20.m1.1d">italic_E ← italic_E ∪ { italic_n }</annotation></semantics></math><span class="ltx_text" id="alg1.l20.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l21">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l21.1.1.1" style="font-size:80%;">21:</span></span><span class="ltx_text" id="alg1.l21.2" style="font-size:80%;">        </span><math alttext="Clock\leftarrow\max\{Clock,n.Priority\}" class="ltx_math_unparsed" display="inline" id="alg1.l21.m1.1"><semantics id="alg1.l21.m1.1a"><mrow id="alg1.l21.m1.1b"><mi id="alg1.l21.m1.1.2" mathsize="80%">C</mi><mi id="alg1.l21.m1.1.3" mathsize="80%">l</mi><mi id="alg1.l21.m1.1.4" mathsize="80%">o</mi><mi id="alg1.l21.m1.1.5" mathsize="80%">c</mi><mi id="alg1.l21.m1.1.6" mathsize="80%">k</mi><mo id="alg1.l21.m1.1.7" mathsize="80%" stretchy="false">←</mo><mi id="alg1.l21.m1.1.8" mathsize="80%">max</mi><mrow id="alg1.l21.m1.1.9"><mo id="alg1.l21.m1.1.9.1" maxsize="80%" minsize="80%">{</mo><mi id="alg1.l21.m1.1.9.2" mathsize="80%">C</mi><mi id="alg1.l21.m1.1.9.3" mathsize="80%">l</mi><mi id="alg1.l21.m1.1.9.4" mathsize="80%">o</mi><mi id="alg1.l21.m1.1.9.5" mathsize="80%">c</mi><mi id="alg1.l21.m1.1.9.6" mathsize="80%">k</mi><mo id="alg1.l21.m1.1.9.7" mathsize="80%">,</mo><mi id="alg1.l21.m1.1.1" mathsize="80%">n</mi><mo id="alg1.l21.m1.1.9.8" lspace="0em" mathsize="80%" rspace="0.167em">.</mo><mi id="alg1.l21.m1.1.9.9" mathsize="80%">P</mi><mi id="alg1.l21.m1.1.9.10" mathsize="80%">r</mi><mi id="alg1.l21.m1.1.9.11" mathsize="80%">i</mi><mi id="alg1.l21.m1.1.9.12" mathsize="80%">o</mi><mi id="alg1.l21.m1.1.9.13" mathsize="80%">r</mi><mi id="alg1.l21.m1.1.9.14" mathsize="80%">i</mi><mi id="alg1.l21.m1.1.9.15" mathsize="80%">t</mi><mi id="alg1.l21.m1.1.9.16" mathsize="80%">y</mi><mo id="alg1.l21.m1.1.9.17" maxsize="80%" minsize="80%">}</mo></mrow></mrow><annotation encoding="application/x-tex" id="alg1.l21.m1.1c">Clock\leftarrow\max\{Clock,n.Priority\}</annotation><annotation encoding="application/x-llamapun" id="alg1.l21.m1.1d">italic_C italic_l italic_o italic_c italic_k ← roman_max { italic_C italic_l italic_o italic_c italic_k , italic_n . italic_P italic_r italic_i italic_o italic_r italic_i italic_t italic_y }</annotation></semantics></math><span class="ltx_text" id="alg1.l21.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l22">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l22.1.1.1" style="font-size:80%;">22:</span></span><span class="ltx_text" id="alg1.l22.2" style="font-size:80%;">        </span><span class="ltx_text ltx_font_bold" id="alg1.l22.3" style="font-size:80%;">if</span><span class="ltx_text" id="alg1.l22.4" style="font-size:80%;"> </span><math alttext="n.Parent.Children\notin GPU" class="ltx_Math" display="inline" id="alg1.l22.m1.3"><semantics id="alg1.l22.m1.3a"><mrow id="alg1.l22.m1.3.3.2" xref="alg1.l22.m1.3.3.3.cmml"><mi id="alg1.l22.m1.1.1" mathsize="80%" xref="alg1.l22.m1.1.1.cmml">n</mi><mo id="alg1.l22.m1.3.3.2.3" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l22.m1.3.3.3a.cmml">.</mo><mrow id="alg1.l22.m1.2.2.1.1" xref="alg1.l22.m1.2.2.1.1.cmml"><mi id="alg1.l22.m1.2.2.1.1.2" mathsize="80%" xref="alg1.l22.m1.2.2.1.1.2.cmml">P</mi><mo id="alg1.l22.m1.2.2.1.1.1" xref="alg1.l22.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg1.l22.m1.2.2.1.1.3" mathsize="80%" xref="alg1.l22.m1.2.2.1.1.3.cmml">a</mi><mo id="alg1.l22.m1.2.2.1.1.1a" xref="alg1.l22.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg1.l22.m1.2.2.1.1.4" mathsize="80%" xref="alg1.l22.m1.2.2.1.1.4.cmml">r</mi><mo id="alg1.l22.m1.2.2.1.1.1b" xref="alg1.l22.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg1.l22.m1.2.2.1.1.5" mathsize="80%" xref="alg1.l22.m1.2.2.1.1.5.cmml">e</mi><mo id="alg1.l22.m1.2.2.1.1.1c" xref="alg1.l22.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg1.l22.m1.2.2.1.1.6" mathsize="80%" xref="alg1.l22.m1.2.2.1.1.6.cmml">n</mi><mo id="alg1.l22.m1.2.2.1.1.1d" xref="alg1.l22.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg1.l22.m1.2.2.1.1.7" mathsize="80%" xref="alg1.l22.m1.2.2.1.1.7.cmml">t</mi></mrow><mo id="alg1.l22.m1.3.3.2.4" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg1.l22.m1.3.3.3a.cmml">.</mo><mrow id="alg1.l22.m1.3.3.2.2" xref="alg1.l22.m1.3.3.2.2.cmml"><mrow id="alg1.l22.m1.3.3.2.2.2" xref="alg1.l22.m1.3.3.2.2.2.cmml"><mi id="alg1.l22.m1.3.3.2.2.2.2" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.2.2.cmml">C</mi><mo id="alg1.l22.m1.3.3.2.2.2.1" xref="alg1.l22.m1.3.3.2.2.2.1.cmml">⁢</mo><mi id="alg1.l22.m1.3.3.2.2.2.3" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.2.3.cmml">h</mi><mo id="alg1.l22.m1.3.3.2.2.2.1a" xref="alg1.l22.m1.3.3.2.2.2.1.cmml">⁢</mo><mi id="alg1.l22.m1.3.3.2.2.2.4" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.2.4.cmml">i</mi><mo id="alg1.l22.m1.3.3.2.2.2.1b" xref="alg1.l22.m1.3.3.2.2.2.1.cmml">⁢</mo><mi id="alg1.l22.m1.3.3.2.2.2.5" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.2.5.cmml">l</mi><mo id="alg1.l22.m1.3.3.2.2.2.1c" xref="alg1.l22.m1.3.3.2.2.2.1.cmml">⁢</mo><mi id="alg1.l22.m1.3.3.2.2.2.6" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.2.6.cmml">d</mi><mo id="alg1.l22.m1.3.3.2.2.2.1d" xref="alg1.l22.m1.3.3.2.2.2.1.cmml">⁢</mo><mi id="alg1.l22.m1.3.3.2.2.2.7" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.2.7.cmml">r</mi><mo id="alg1.l22.m1.3.3.2.2.2.1e" xref="alg1.l22.m1.3.3.2.2.2.1.cmml">⁢</mo><mi id="alg1.l22.m1.3.3.2.2.2.8" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.2.8.cmml">e</mi><mo id="alg1.l22.m1.3.3.2.2.2.1f" xref="alg1.l22.m1.3.3.2.2.2.1.cmml">⁢</mo><mi id="alg1.l22.m1.3.3.2.2.2.9" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.2.9.cmml">n</mi></mrow><mo id="alg1.l22.m1.3.3.2.2.1" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.1.cmml">∉</mo><mrow id="alg1.l22.m1.3.3.2.2.3" xref="alg1.l22.m1.3.3.2.2.3.cmml"><mi id="alg1.l22.m1.3.3.2.2.3.2" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.3.2.cmml">G</mi><mo id="alg1.l22.m1.3.3.2.2.3.1" xref="alg1.l22.m1.3.3.2.2.3.1.cmml">⁢</mo><mi id="alg1.l22.m1.3.3.2.2.3.3" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.3.3.cmml">P</mi><mo id="alg1.l22.m1.3.3.2.2.3.1a" xref="alg1.l22.m1.3.3.2.2.3.1.cmml">⁢</mo><mi id="alg1.l22.m1.3.3.2.2.3.4" mathsize="80%" xref="alg1.l22.m1.3.3.2.2.3.4.cmml">U</mi></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l22.m1.3b"><apply id="alg1.l22.m1.3.3.3.cmml" xref="alg1.l22.m1.3.3.2"><csymbol cd="ambiguous" id="alg1.l22.m1.3.3.3a.cmml" xref="alg1.l22.m1.3.3.2.3">formulae-sequence</csymbol><ci id="alg1.l22.m1.1.1.cmml" xref="alg1.l22.m1.1.1">𝑛</ci><apply id="alg1.l22.m1.2.2.1.1.cmml" xref="alg1.l22.m1.2.2.1.1"><times id="alg1.l22.m1.2.2.1.1.1.cmml" xref="alg1.l22.m1.2.2.1.1.1"></times><ci id="alg1.l22.m1.2.2.1.1.2.cmml" xref="alg1.l22.m1.2.2.1.1.2">𝑃</ci><ci id="alg1.l22.m1.2.2.1.1.3.cmml" xref="alg1.l22.m1.2.2.1.1.3">𝑎</ci><ci id="alg1.l22.m1.2.2.1.1.4.cmml" xref="alg1.l22.m1.2.2.1.1.4">𝑟</ci><ci id="alg1.l22.m1.2.2.1.1.5.cmml" xref="alg1.l22.m1.2.2.1.1.5">𝑒</ci><ci id="alg1.l22.m1.2.2.1.1.6.cmml" xref="alg1.l22.m1.2.2.1.1.6">𝑛</ci><ci id="alg1.l22.m1.2.2.1.1.7.cmml" xref="alg1.l22.m1.2.2.1.1.7">𝑡</ci></apply><apply id="alg1.l22.m1.3.3.2.2.cmml" xref="alg1.l22.m1.3.3.2.2"><notin id="alg1.l22.m1.3.3.2.2.1.cmml" xref="alg1.l22.m1.3.3.2.2.1"></notin><apply id="alg1.l22.m1.3.3.2.2.2.cmml" xref="alg1.l22.m1.3.3.2.2.2"><times id="alg1.l22.m1.3.3.2.2.2.1.cmml" xref="alg1.l22.m1.3.3.2.2.2.1"></times><ci id="alg1.l22.m1.3.3.2.2.2.2.cmml" xref="alg1.l22.m1.3.3.2.2.2.2">𝐶</ci><ci id="alg1.l22.m1.3.3.2.2.2.3.cmml" xref="alg1.l22.m1.3.3.2.2.2.3">ℎ</ci><ci id="alg1.l22.m1.3.3.2.2.2.4.cmml" xref="alg1.l22.m1.3.3.2.2.2.4">𝑖</ci><ci id="alg1.l22.m1.3.3.2.2.2.5.cmml" xref="alg1.l22.m1.3.3.2.2.2.5">𝑙</ci><ci id="alg1.l22.m1.3.3.2.2.2.6.cmml" xref="alg1.l22.m1.3.3.2.2.2.6">𝑑</ci><ci id="alg1.l22.m1.3.3.2.2.2.7.cmml" xref="alg1.l22.m1.3.3.2.2.2.7">𝑟</ci><ci id="alg1.l22.m1.3.3.2.2.2.8.cmml" xref="alg1.l22.m1.3.3.2.2.2.8">𝑒</ci><ci id="alg1.l22.m1.3.3.2.2.2.9.cmml" xref="alg1.l22.m1.3.3.2.2.2.9">𝑛</ci></apply><apply id="alg1.l22.m1.3.3.2.2.3.cmml" xref="alg1.l22.m1.3.3.2.2.3"><times id="alg1.l22.m1.3.3.2.2.3.1.cmml" xref="alg1.l22.m1.3.3.2.2.3.1"></times><ci id="alg1.l22.m1.3.3.2.2.3.2.cmml" xref="alg1.l22.m1.3.3.2.2.3.2">𝐺</ci><ci id="alg1.l22.m1.3.3.2.2.3.3.cmml" xref="alg1.l22.m1.3.3.2.2.3.3">𝑃</ci><ci id="alg1.l22.m1.3.3.2.2.3.4.cmml" xref="alg1.l22.m1.3.3.2.2.3.4">𝑈</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l22.m1.3c">n.Parent.Children\notin GPU</annotation><annotation encoding="application/x-llamapun" id="alg1.l22.m1.3d">italic_n . italic_P italic_a italic_r italic_e italic_n italic_t . italic_C italic_h italic_i italic_l italic_d italic_r italic_e italic_n ∉ italic_G italic_P italic_U</annotation></semantics></math><span class="ltx_text" id="alg1.l22.5" style="font-size:80%;"> </span><span class="ltx_text ltx_font_bold" id="alg1.l22.6" style="font-size:80%;">then</span><span class="ltx_text" id="alg1.l22.7" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg1.l23">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l23.1.1.1" style="font-size:80%;">23:</span></span><span class="ltx_text" id="alg1.l23.2" style="font-size:80%;">           </span><math alttext="S\leftarrow S\cup\{n.Parent\}" class="ltx_math_unparsed" display="inline" id="alg1.l23.m1.1"><semantics id="alg1.l23.m1.1a"><mrow id="alg1.l23.m1.1b"><mi id="alg1.l23.m1.1.1" mathsize="80%">S</mi><mo id="alg1.l23.m1.1.2" mathsize="80%" stretchy="false">←</mo><mi id="alg1.l23.m1.1.3" mathsize="80%">S</mi><mo id="alg1.l23.m1.1.4" mathsize="80%">∪</mo><mrow id="alg1.l23.m1.1.5"><mo id="alg1.l23.m1.1.5.1" maxsize="80%" minsize="80%">{</mo><mi id="alg1.l23.m1.1.5.2" mathsize="80%">n</mi><mo id="alg1.l23.m1.1.5.3" lspace="0em" mathsize="80%" rspace="0.167em">.</mo><mi id="alg1.l23.m1.1.5.4" mathsize="80%">P</mi><mi id="alg1.l23.m1.1.5.5" mathsize="80%">a</mi><mi id="alg1.l23.m1.1.5.6" mathsize="80%">r</mi><mi id="alg1.l23.m1.1.5.7" mathsize="80%">e</mi><mi id="alg1.l23.m1.1.5.8" mathsize="80%">n</mi><mi id="alg1.l23.m1.1.5.9" mathsize="80%">t</mi><mo id="alg1.l23.m1.1.5.10" maxsize="80%" minsize="80%">}</mo></mrow></mrow><annotation encoding="application/x-tex" id="alg1.l23.m1.1c">S\leftarrow S\cup\{n.Parent\}</annotation><annotation encoding="application/x-llamapun" id="alg1.l23.m1.1d">italic_S ← italic_S ∪ { italic_n . italic_P italic_a italic_r italic_e italic_n italic_t }</annotation></semantics></math><span class="ltx_text" id="alg1.l23.3" style="font-size:80%;">
            </span>
</div>
</div>
</figure>
<div class="ltx_para" id="S5.SS1.p7">
<p class="ltx_p" id="S5.SS1.p7.4">Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#alg1" title="Algorithm 1 ‣ 5.1. Cache Structure and Replacement Policy ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">1</span></a> outlines the operations for updating and evicting nodes in the GPU memory
of the knowledge tree. <math alttext="T(\alpha,\beta)" class="ltx_Math" display="inline" id="S5.SS1.p7.1.m1.2"><semantics id="S5.SS1.p7.1.m1.2a"><mrow id="S5.SS1.p7.1.m1.2.3" xref="S5.SS1.p7.1.m1.2.3.cmml"><mi id="S5.SS1.p7.1.m1.2.3.2" xref="S5.SS1.p7.1.m1.2.3.2.cmml">T</mi><mo id="S5.SS1.p7.1.m1.2.3.1" xref="S5.SS1.p7.1.m1.2.3.1.cmml">⁢</mo><mrow id="S5.SS1.p7.1.m1.2.3.3.2" xref="S5.SS1.p7.1.m1.2.3.3.1.cmml"><mo id="S5.SS1.p7.1.m1.2.3.3.2.1" stretchy="false" xref="S5.SS1.p7.1.m1.2.3.3.1.cmml">(</mo><mi id="S5.SS1.p7.1.m1.1.1" xref="S5.SS1.p7.1.m1.1.1.cmml">α</mi><mo id="S5.SS1.p7.1.m1.2.3.3.2.2" xref="S5.SS1.p7.1.m1.2.3.3.1.cmml">,</mo><mi id="S5.SS1.p7.1.m1.2.2" xref="S5.SS1.p7.1.m1.2.2.cmml">β</mi><mo id="S5.SS1.p7.1.m1.2.3.3.2.3" stretchy="false" xref="S5.SS1.p7.1.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p7.1.m1.2b"><apply id="S5.SS1.p7.1.m1.2.3.cmml" xref="S5.SS1.p7.1.m1.2.3"><times id="S5.SS1.p7.1.m1.2.3.1.cmml" xref="S5.SS1.p7.1.m1.2.3.1"></times><ci id="S5.SS1.p7.1.m1.2.3.2.cmml" xref="S5.SS1.p7.1.m1.2.3.2">𝑇</ci><interval closure="open" id="S5.SS1.p7.1.m1.2.3.3.1.cmml" xref="S5.SS1.p7.1.m1.2.3.3.2"><ci id="S5.SS1.p7.1.m1.1.1.cmml" xref="S5.SS1.p7.1.m1.1.1">𝛼</ci><ci id="S5.SS1.p7.1.m1.2.2.cmml" xref="S5.SS1.p7.1.m1.2.2">𝛽</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p7.1.m1.2c">T(\alpha,\beta)</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p7.1.m1.2d">italic_T ( italic_α , italic_β )</annotation></semantics></math> represents the estimated compute time for a request with
<math alttext="\alpha" class="ltx_Math" display="inline" id="S5.SS1.p7.2.m2.1"><semantics id="S5.SS1.p7.2.m2.1a"><mi id="S5.SS1.p7.2.m2.1.1" xref="S5.SS1.p7.2.m2.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p7.2.m2.1b"><ci id="S5.SS1.p7.2.m2.1.1.cmml" xref="S5.SS1.p7.2.m2.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p7.2.m2.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p7.2.m2.1d">italic_α</annotation></semantics></math> cached tokens and <math alttext="\beta" class="ltx_Math" display="inline" id="S5.SS1.p7.3.m3.1"><semantics id="S5.SS1.p7.3.m3.1a"><mi id="S5.SS1.p7.3.m3.1.1" xref="S5.SS1.p7.3.m3.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p7.3.m3.1b"><ci id="S5.SS1.p7.3.m3.1.1.cmml" xref="S5.SS1.p7.3.m3.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p7.3.m3.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p7.3.m3.1d">italic_β</annotation></semantics></math> non-cached tokens. Upon a document retrieval by a request,
RAGCache updates the cost using bilinear interpolation (line 6–9) if the document is not cached,
<span class="ltx_text ltx_font_smallcaps" id="S5.SS1.p7.4.1">EVICT_IN_GPU</span> evicts nodes from the GPU memory to accommodate new requests and
updates the clock according to Formula <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.E2" title="In 5.1. Cache Structure and Replacement Policy ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">2</span></a>. If a parent node becomes a leaf following eviction,
it is added to the candidate set <math alttext="S" class="ltx_Math" display="inline" id="S5.SS1.p7.4.m4.1"><semantics id="S5.SS1.p7.4.m4.1a"><mi id="S5.SS1.p7.4.m4.1.1" xref="S5.SS1.p7.4.m4.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p7.4.m4.1b"><ci id="S5.SS1.p7.4.m4.1.1.cmml" xref="S5.SS1.p7.4.m4.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p7.4.m4.1c">S</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p7.4.m4.1d">italic_S</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS1.p8">
<p class="ltx_p" id="S5.SS1.p8.1"><span class="ltx_text ltx_font_bold" id="S5.SS1.p8.1.1">Swap out only once.</span> The GPU connects to the host memory via the PCIe bus, which typically offers
much lower bandwidth than the GPU HBM. To minimize data transfer between the GPU and host memory,
RAGCache adopts a swap-out-only-once strategy as shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.F8" title="Figure 8 ‣ 5.1. Cache Structure and Replacement Policy ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">8</span></a>.
The key-value tensors of a node are swapped out to the host memory only for the first eviction.
The host memory keeps the key-value tensors until the node is evicted from the whole cache.
For subsequent evictions in GPU memory, RAGCache directly frees the node with zero data copy.
Given that the capacity of the host memory is one or two orders of magnitude larger than the GPU memory,
keeping one copy of the key-value tensors in the host memory is acceptable.</p>
</div>
<figure class="ltx_figure" id="S5.F10">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_missing ltx_missing_image" id="S5.F10.g1" src=""/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F10.sf1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F10.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S5.F10.sf1.3.2" style="font-size:90%;">Differ in cached length.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F10.sf2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F10.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S5.F10.sf2.3.2" style="font-size:90%;">Differ in compute length.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F10.2.1.1" style="font-size:90%;">Figure 10</span>. </span><span class="ltx_text" id="S5.F10.3.2" style="font-size:90%;">Cache-aware reordering.</span></figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2. </span>Cache-aware Reordering</h3>
<div class="ltx_para" id="S5.SS2.p1">
<p class="ltx_p" id="S5.SS2.p1.8">Cache hit rate is vital for RAGCache’s cache efficiency,
yet the unpredictable arrival pattern of user requests results in substantial cache trashing.
The requests referring to the same documents may not be issued together, affecting
cache efficiency. For illustration, let requests <math alttext="\{Q_{i},i\%2==0\}" class="ltx_math_unparsed" display="inline" id="S5.SS2.p1.1.m1.1"><semantics id="S5.SS2.p1.1.m1.1a"><mrow id="S5.SS2.p1.1.m1.1b"><mo id="S5.SS2.p1.1.m1.1.1" stretchy="false">{</mo><msub id="S5.SS2.p1.1.m1.1.2"><mi id="S5.SS2.p1.1.m1.1.2.2">Q</mi><mi id="S5.SS2.p1.1.m1.1.2.3">i</mi></msub><mo id="S5.SS2.p1.1.m1.1.3">,</mo><mi id="S5.SS2.p1.1.m1.1.4">i</mi><mo id="S5.SS2.p1.1.m1.1.5">%</mo><mn id="S5.SS2.p1.1.m1.1.6">2</mn><mo id="S5.SS2.p1.1.m1.1.7" rspace="0em">=</mo><mo id="S5.SS2.p1.1.m1.1.8" lspace="0em">=</mo><mn id="S5.SS2.p1.1.m1.1.9">0</mn><mo id="S5.SS2.p1.1.m1.1.10" stretchy="false">}</mo></mrow><annotation encoding="application/x-tex" id="S5.SS2.p1.1.m1.1c">\{Q_{i},i\%2==0\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.1.m1.1d">{ italic_Q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_i % 2 = = 0 }</annotation></semantics></math> and <math alttext="\{Q_{i},i\%2==1\}" class="ltx_math_unparsed" display="inline" id="S5.SS2.p1.2.m2.1"><semantics id="S5.SS2.p1.2.m2.1a"><mrow id="S5.SS2.p1.2.m2.1b"><mo id="S5.SS2.p1.2.m2.1.1" stretchy="false">{</mo><msub id="S5.SS2.p1.2.m2.1.2"><mi id="S5.SS2.p1.2.m2.1.2.2">Q</mi><mi id="S5.SS2.p1.2.m2.1.2.3">i</mi></msub><mo id="S5.SS2.p1.2.m2.1.3">,</mo><mi id="S5.SS2.p1.2.m2.1.4">i</mi><mo id="S5.SS2.p1.2.m2.1.5">%</mo><mn id="S5.SS2.p1.2.m2.1.6">2</mn><mo id="S5.SS2.p1.2.m2.1.7" rspace="0em">=</mo><mo id="S5.SS2.p1.2.m2.1.8" lspace="0em">=</mo><mn id="S5.SS2.p1.2.m2.1.9">1</mn><mo id="S5.SS2.p1.2.m2.1.10" stretchy="false">}</mo></mrow><annotation encoding="application/x-tex" id="S5.SS2.p1.2.m2.1c">\{Q_{i},i\%2==1\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.2.m2.1d">{ italic_Q start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_i % 2 = = 1 }</annotation></semantics></math> target
documents <math alttext="D_{1}" class="ltx_Math" display="inline" id="S5.SS2.p1.3.m3.1"><semantics id="S5.SS2.p1.3.m3.1a"><msub id="S5.SS2.p1.3.m3.1.1" xref="S5.SS2.p1.3.m3.1.1.cmml"><mi id="S5.SS2.p1.3.m3.1.1.2" xref="S5.SS2.p1.3.m3.1.1.2.cmml">D</mi><mn id="S5.SS2.p1.3.m3.1.1.3" xref="S5.SS2.p1.3.m3.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.3.m3.1b"><apply id="S5.SS2.p1.3.m3.1.1.cmml" xref="S5.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.3.m3.1.1.1.cmml" xref="S5.SS2.p1.3.m3.1.1">subscript</csymbol><ci id="S5.SS2.p1.3.m3.1.1.2.cmml" xref="S5.SS2.p1.3.m3.1.1.2">𝐷</ci><cn id="S5.SS2.p1.3.m3.1.1.3.cmml" type="integer" xref="S5.SS2.p1.3.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.3.m3.1c">D_{1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.3.m3.1d">italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="D_{2}" class="ltx_Math" display="inline" id="S5.SS2.p1.4.m4.1"><semantics id="S5.SS2.p1.4.m4.1a"><msub id="S5.SS2.p1.4.m4.1.1" xref="S5.SS2.p1.4.m4.1.1.cmml"><mi id="S5.SS2.p1.4.m4.1.1.2" xref="S5.SS2.p1.4.m4.1.1.2.cmml">D</mi><mn id="S5.SS2.p1.4.m4.1.1.3" xref="S5.SS2.p1.4.m4.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.4.m4.1b"><apply id="S5.SS2.p1.4.m4.1.1.cmml" xref="S5.SS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.4.m4.1.1.1.cmml" xref="S5.SS2.p1.4.m4.1.1">subscript</csymbol><ci id="S5.SS2.p1.4.m4.1.1.2.cmml" xref="S5.SS2.p1.4.m4.1.1.2">𝐷</ci><cn id="S5.SS2.p1.4.m4.1.1.3.cmml" type="integer" xref="S5.SS2.p1.4.m4.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.4.m4.1c">D_{2}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.4.m4.1d">italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>, respectively. The cache capacity is one document.
The sequence <math alttext="\{Q_{1},Q_{2},Q_{3}...\}" class="ltx_Math" display="inline" id="S5.SS2.p1.5.m5.3"><semantics id="S5.SS2.p1.5.m5.3a"><mrow id="S5.SS2.p1.5.m5.3.3.3" xref="S5.SS2.p1.5.m5.3.3.4.cmml"><mo id="S5.SS2.p1.5.m5.3.3.3.4" stretchy="false" xref="S5.SS2.p1.5.m5.3.3.4.cmml">{</mo><msub id="S5.SS2.p1.5.m5.1.1.1.1" xref="S5.SS2.p1.5.m5.1.1.1.1.cmml"><mi id="S5.SS2.p1.5.m5.1.1.1.1.2" xref="S5.SS2.p1.5.m5.1.1.1.1.2.cmml">Q</mi><mn id="S5.SS2.p1.5.m5.1.1.1.1.3" xref="S5.SS2.p1.5.m5.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS2.p1.5.m5.3.3.3.5" xref="S5.SS2.p1.5.m5.3.3.4.cmml">,</mo><msub id="S5.SS2.p1.5.m5.2.2.2.2" xref="S5.SS2.p1.5.m5.2.2.2.2.cmml"><mi id="S5.SS2.p1.5.m5.2.2.2.2.2" xref="S5.SS2.p1.5.m5.2.2.2.2.2.cmml">Q</mi><mn id="S5.SS2.p1.5.m5.2.2.2.2.3" xref="S5.SS2.p1.5.m5.2.2.2.2.3.cmml">2</mn></msub><mo id="S5.SS2.p1.5.m5.3.3.3.6" xref="S5.SS2.p1.5.m5.3.3.4.cmml">,</mo><mrow id="S5.SS2.p1.5.m5.3.3.3.3" xref="S5.SS2.p1.5.m5.3.3.3.3.cmml"><msub id="S5.SS2.p1.5.m5.3.3.3.3.2" xref="S5.SS2.p1.5.m5.3.3.3.3.2.cmml"><mi id="S5.SS2.p1.5.m5.3.3.3.3.2.2" xref="S5.SS2.p1.5.m5.3.3.3.3.2.2.cmml">Q</mi><mn id="S5.SS2.p1.5.m5.3.3.3.3.2.3" xref="S5.SS2.p1.5.m5.3.3.3.3.2.3.cmml">3</mn></msub><mo id="S5.SS2.p1.5.m5.3.3.3.3.1" xref="S5.SS2.p1.5.m5.3.3.3.3.1.cmml">⁢</mo><mi id="S5.SS2.p1.5.m5.3.3.3.3.3" mathvariant="normal" xref="S5.SS2.p1.5.m5.3.3.3.3.3.cmml">…</mi></mrow><mo id="S5.SS2.p1.5.m5.3.3.3.7" stretchy="false" xref="S5.SS2.p1.5.m5.3.3.4.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.5.m5.3b"><set id="S5.SS2.p1.5.m5.3.3.4.cmml" xref="S5.SS2.p1.5.m5.3.3.3"><apply id="S5.SS2.p1.5.m5.1.1.1.1.cmml" xref="S5.SS2.p1.5.m5.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.5.m5.1.1.1.1.1.cmml" xref="S5.SS2.p1.5.m5.1.1.1.1">subscript</csymbol><ci id="S5.SS2.p1.5.m5.1.1.1.1.2.cmml" xref="S5.SS2.p1.5.m5.1.1.1.1.2">𝑄</ci><cn id="S5.SS2.p1.5.m5.1.1.1.1.3.cmml" type="integer" xref="S5.SS2.p1.5.m5.1.1.1.1.3">1</cn></apply><apply id="S5.SS2.p1.5.m5.2.2.2.2.cmml" xref="S5.SS2.p1.5.m5.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS2.p1.5.m5.2.2.2.2.1.cmml" xref="S5.SS2.p1.5.m5.2.2.2.2">subscript</csymbol><ci id="S5.SS2.p1.5.m5.2.2.2.2.2.cmml" xref="S5.SS2.p1.5.m5.2.2.2.2.2">𝑄</ci><cn id="S5.SS2.p1.5.m5.2.2.2.2.3.cmml" type="integer" xref="S5.SS2.p1.5.m5.2.2.2.2.3">2</cn></apply><apply id="S5.SS2.p1.5.m5.3.3.3.3.cmml" xref="S5.SS2.p1.5.m5.3.3.3.3"><times id="S5.SS2.p1.5.m5.3.3.3.3.1.cmml" xref="S5.SS2.p1.5.m5.3.3.3.3.1"></times><apply id="S5.SS2.p1.5.m5.3.3.3.3.2.cmml" xref="S5.SS2.p1.5.m5.3.3.3.3.2"><csymbol cd="ambiguous" id="S5.SS2.p1.5.m5.3.3.3.3.2.1.cmml" xref="S5.SS2.p1.5.m5.3.3.3.3.2">subscript</csymbol><ci id="S5.SS2.p1.5.m5.3.3.3.3.2.2.cmml" xref="S5.SS2.p1.5.m5.3.3.3.3.2.2">𝑄</ci><cn id="S5.SS2.p1.5.m5.3.3.3.3.2.3.cmml" type="integer" xref="S5.SS2.p1.5.m5.3.3.3.3.2.3">3</cn></apply><ci id="S5.SS2.p1.5.m5.3.3.3.3.3.cmml" xref="S5.SS2.p1.5.m5.3.3.3.3.3">…</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.5.m5.3c">\{Q_{1},Q_{2},Q_{3}...\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.5.m5.3d">{ italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT … }</annotation></semantics></math> causes frequent swapping of the key-value cache of <math alttext="D_{1}" class="ltx_Math" display="inline" id="S5.SS2.p1.6.m6.1"><semantics id="S5.SS2.p1.6.m6.1a"><msub id="S5.SS2.p1.6.m6.1.1" xref="S5.SS2.p1.6.m6.1.1.cmml"><mi id="S5.SS2.p1.6.m6.1.1.2" xref="S5.SS2.p1.6.m6.1.1.2.cmml">D</mi><mn id="S5.SS2.p1.6.m6.1.1.3" xref="S5.SS2.p1.6.m6.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.6.m6.1b"><apply id="S5.SS2.p1.6.m6.1.1.cmml" xref="S5.SS2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.6.m6.1.1.1.cmml" xref="S5.SS2.p1.6.m6.1.1">subscript</csymbol><ci id="S5.SS2.p1.6.m6.1.1.2.cmml" xref="S5.SS2.p1.6.m6.1.1.2">𝐷</ci><cn id="S5.SS2.p1.6.m6.1.1.3.cmml" type="integer" xref="S5.SS2.p1.6.m6.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.6.m6.1c">D_{1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.6.m6.1d">italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="D_{2}" class="ltx_Math" display="inline" id="S5.SS2.p1.7.m7.1"><semantics id="S5.SS2.p1.7.m7.1a"><msub id="S5.SS2.p1.7.m7.1.1" xref="S5.SS2.p1.7.m7.1.1.cmml"><mi id="S5.SS2.p1.7.m7.1.1.2" xref="S5.SS2.p1.7.m7.1.1.2.cmml">D</mi><mn id="S5.SS2.p1.7.m7.1.1.3" xref="S5.SS2.p1.7.m7.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.7.m7.1b"><apply id="S5.SS2.p1.7.m7.1.1.cmml" xref="S5.SS2.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.7.m7.1.1.1.cmml" xref="S5.SS2.p1.7.m7.1.1">subscript</csymbol><ci id="S5.SS2.p1.7.m7.1.1.2.cmml" xref="S5.SS2.p1.7.m7.1.1.2">𝐷</ci><cn id="S5.SS2.p1.7.m7.1.1.3.cmml" type="integer" xref="S5.SS2.p1.7.m7.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.7.m7.1c">D_{2}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.7.m7.1d">italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>,
rendering a zero cache hit rate. Conversely, rearranging requests to <math alttext="\{Q_{1},Q_{3},Q_{5},Q_{2},Q_{4},Q_{6},Q_{7},\ldots\}" class="ltx_Math" display="inline" id="S5.SS2.p1.8.m8.8"><semantics id="S5.SS2.p1.8.m8.8a"><mrow id="S5.SS2.p1.8.m8.8.8.7" xref="S5.SS2.p1.8.m8.8.8.8.cmml"><mo id="S5.SS2.p1.8.m8.8.8.7.8" stretchy="false" xref="S5.SS2.p1.8.m8.8.8.8.cmml">{</mo><msub id="S5.SS2.p1.8.m8.2.2.1.1" xref="S5.SS2.p1.8.m8.2.2.1.1.cmml"><mi id="S5.SS2.p1.8.m8.2.2.1.1.2" xref="S5.SS2.p1.8.m8.2.2.1.1.2.cmml">Q</mi><mn id="S5.SS2.p1.8.m8.2.2.1.1.3" xref="S5.SS2.p1.8.m8.2.2.1.1.3.cmml">1</mn></msub><mo id="S5.SS2.p1.8.m8.8.8.7.9" xref="S5.SS2.p1.8.m8.8.8.8.cmml">,</mo><msub id="S5.SS2.p1.8.m8.3.3.2.2" xref="S5.SS2.p1.8.m8.3.3.2.2.cmml"><mi id="S5.SS2.p1.8.m8.3.3.2.2.2" xref="S5.SS2.p1.8.m8.3.3.2.2.2.cmml">Q</mi><mn id="S5.SS2.p1.8.m8.3.3.2.2.3" xref="S5.SS2.p1.8.m8.3.3.2.2.3.cmml">3</mn></msub><mo id="S5.SS2.p1.8.m8.8.8.7.10" xref="S5.SS2.p1.8.m8.8.8.8.cmml">,</mo><msub id="S5.SS2.p1.8.m8.4.4.3.3" xref="S5.SS2.p1.8.m8.4.4.3.3.cmml"><mi id="S5.SS2.p1.8.m8.4.4.3.3.2" xref="S5.SS2.p1.8.m8.4.4.3.3.2.cmml">Q</mi><mn id="S5.SS2.p1.8.m8.4.4.3.3.3" xref="S5.SS2.p1.8.m8.4.4.3.3.3.cmml">5</mn></msub><mo id="S5.SS2.p1.8.m8.8.8.7.11" xref="S5.SS2.p1.8.m8.8.8.8.cmml">,</mo><msub id="S5.SS2.p1.8.m8.5.5.4.4" xref="S5.SS2.p1.8.m8.5.5.4.4.cmml"><mi id="S5.SS2.p1.8.m8.5.5.4.4.2" xref="S5.SS2.p1.8.m8.5.5.4.4.2.cmml">Q</mi><mn id="S5.SS2.p1.8.m8.5.5.4.4.3" xref="S5.SS2.p1.8.m8.5.5.4.4.3.cmml">2</mn></msub><mo id="S5.SS2.p1.8.m8.8.8.7.12" xref="S5.SS2.p1.8.m8.8.8.8.cmml">,</mo><msub id="S5.SS2.p1.8.m8.6.6.5.5" xref="S5.SS2.p1.8.m8.6.6.5.5.cmml"><mi id="S5.SS2.p1.8.m8.6.6.5.5.2" xref="S5.SS2.p1.8.m8.6.6.5.5.2.cmml">Q</mi><mn id="S5.SS2.p1.8.m8.6.6.5.5.3" xref="S5.SS2.p1.8.m8.6.6.5.5.3.cmml">4</mn></msub><mo id="S5.SS2.p1.8.m8.8.8.7.13" xref="S5.SS2.p1.8.m8.8.8.8.cmml">,</mo><msub id="S5.SS2.p1.8.m8.7.7.6.6" xref="S5.SS2.p1.8.m8.7.7.6.6.cmml"><mi id="S5.SS2.p1.8.m8.7.7.6.6.2" xref="S5.SS2.p1.8.m8.7.7.6.6.2.cmml">Q</mi><mn id="S5.SS2.p1.8.m8.7.7.6.6.3" xref="S5.SS2.p1.8.m8.7.7.6.6.3.cmml">6</mn></msub><mo id="S5.SS2.p1.8.m8.8.8.7.14" xref="S5.SS2.p1.8.m8.8.8.8.cmml">,</mo><msub id="S5.SS2.p1.8.m8.8.8.7.7" xref="S5.SS2.p1.8.m8.8.8.7.7.cmml"><mi id="S5.SS2.p1.8.m8.8.8.7.7.2" xref="S5.SS2.p1.8.m8.8.8.7.7.2.cmml">Q</mi><mn id="S5.SS2.p1.8.m8.8.8.7.7.3" xref="S5.SS2.p1.8.m8.8.8.7.7.3.cmml">7</mn></msub><mo id="S5.SS2.p1.8.m8.8.8.7.15" xref="S5.SS2.p1.8.m8.8.8.8.cmml">,</mo><mi id="S5.SS2.p1.8.m8.1.1" mathvariant="normal" xref="S5.SS2.p1.8.m8.1.1.cmml">…</mi><mo id="S5.SS2.p1.8.m8.8.8.7.16" stretchy="false" xref="S5.SS2.p1.8.m8.8.8.8.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.8.m8.8b"><set id="S5.SS2.p1.8.m8.8.8.8.cmml" xref="S5.SS2.p1.8.m8.8.8.7"><apply id="S5.SS2.p1.8.m8.2.2.1.1.cmml" xref="S5.SS2.p1.8.m8.2.2.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.8.m8.2.2.1.1.1.cmml" xref="S5.SS2.p1.8.m8.2.2.1.1">subscript</csymbol><ci id="S5.SS2.p1.8.m8.2.2.1.1.2.cmml" xref="S5.SS2.p1.8.m8.2.2.1.1.2">𝑄</ci><cn id="S5.SS2.p1.8.m8.2.2.1.1.3.cmml" type="integer" xref="S5.SS2.p1.8.m8.2.2.1.1.3">1</cn></apply><apply id="S5.SS2.p1.8.m8.3.3.2.2.cmml" xref="S5.SS2.p1.8.m8.3.3.2.2"><csymbol cd="ambiguous" id="S5.SS2.p1.8.m8.3.3.2.2.1.cmml" xref="S5.SS2.p1.8.m8.3.3.2.2">subscript</csymbol><ci id="S5.SS2.p1.8.m8.3.3.2.2.2.cmml" xref="S5.SS2.p1.8.m8.3.3.2.2.2">𝑄</ci><cn id="S5.SS2.p1.8.m8.3.3.2.2.3.cmml" type="integer" xref="S5.SS2.p1.8.m8.3.3.2.2.3">3</cn></apply><apply id="S5.SS2.p1.8.m8.4.4.3.3.cmml" xref="S5.SS2.p1.8.m8.4.4.3.3"><csymbol cd="ambiguous" id="S5.SS2.p1.8.m8.4.4.3.3.1.cmml" xref="S5.SS2.p1.8.m8.4.4.3.3">subscript</csymbol><ci id="S5.SS2.p1.8.m8.4.4.3.3.2.cmml" xref="S5.SS2.p1.8.m8.4.4.3.3.2">𝑄</ci><cn id="S5.SS2.p1.8.m8.4.4.3.3.3.cmml" type="integer" xref="S5.SS2.p1.8.m8.4.4.3.3.3">5</cn></apply><apply id="S5.SS2.p1.8.m8.5.5.4.4.cmml" xref="S5.SS2.p1.8.m8.5.5.4.4"><csymbol cd="ambiguous" id="S5.SS2.p1.8.m8.5.5.4.4.1.cmml" xref="S5.SS2.p1.8.m8.5.5.4.4">subscript</csymbol><ci id="S5.SS2.p1.8.m8.5.5.4.4.2.cmml" xref="S5.SS2.p1.8.m8.5.5.4.4.2">𝑄</ci><cn id="S5.SS2.p1.8.m8.5.5.4.4.3.cmml" type="integer" xref="S5.SS2.p1.8.m8.5.5.4.4.3">2</cn></apply><apply id="S5.SS2.p1.8.m8.6.6.5.5.cmml" xref="S5.SS2.p1.8.m8.6.6.5.5"><csymbol cd="ambiguous" id="S5.SS2.p1.8.m8.6.6.5.5.1.cmml" xref="S5.SS2.p1.8.m8.6.6.5.5">subscript</csymbol><ci id="S5.SS2.p1.8.m8.6.6.5.5.2.cmml" xref="S5.SS2.p1.8.m8.6.6.5.5.2">𝑄</ci><cn id="S5.SS2.p1.8.m8.6.6.5.5.3.cmml" type="integer" xref="S5.SS2.p1.8.m8.6.6.5.5.3">4</cn></apply><apply id="S5.SS2.p1.8.m8.7.7.6.6.cmml" xref="S5.SS2.p1.8.m8.7.7.6.6"><csymbol cd="ambiguous" id="S5.SS2.p1.8.m8.7.7.6.6.1.cmml" xref="S5.SS2.p1.8.m8.7.7.6.6">subscript</csymbol><ci id="S5.SS2.p1.8.m8.7.7.6.6.2.cmml" xref="S5.SS2.p1.8.m8.7.7.6.6.2">𝑄</ci><cn id="S5.SS2.p1.8.m8.7.7.6.6.3.cmml" type="integer" xref="S5.SS2.p1.8.m8.7.7.6.6.3">6</cn></apply><apply id="S5.SS2.p1.8.m8.8.8.7.7.cmml" xref="S5.SS2.p1.8.m8.8.8.7.7"><csymbol cd="ambiguous" id="S5.SS2.p1.8.m8.8.8.7.7.1.cmml" xref="S5.SS2.p1.8.m8.8.8.7.7">subscript</csymbol><ci id="S5.SS2.p1.8.m8.8.8.7.7.2.cmml" xref="S5.SS2.p1.8.m8.8.8.7.7.2">𝑄</ci><cn id="S5.SS2.p1.8.m8.8.8.7.7.3.cmml" type="integer" xref="S5.SS2.p1.8.m8.8.8.7.7.3">7</cn></apply><ci id="S5.SS2.p1.8.m8.1.1.cmml" xref="S5.SS2.p1.8.m8.1.1">…</ci></set></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.8.m8.8c">\{Q_{1},Q_{3},Q_{5},Q_{2},Q_{4},Q_{6},Q_{7},\ldots\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.8.m8.8d">{ italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 5 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 4 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 6 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 7 end_POSTSUBSCRIPT , … }</annotation></semantics></math> optimizes cache utilization,
which improves the hit rate to 66%. This exemplifies how strategic request ordering can mitigate cache volatility and enhance cache efficiency.</p>
</div>
<div class="ltx_para" id="S5.SS2.p2">
<p class="ltx_p" id="S5.SS2.p2.11">Before introducing the cache-aware reordering algorithm, we first consider two scenarios to illustrate the key insights.
We assume that the recomputation cost is proportional to the recomputation length in this example.
The first scenario (Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.F10.sf1" title="In Figure 10 ‣ 5.1. Cache Structure and Replacement Policy ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">10(a)</span></a>) considers requests with identical recomputation
demands but varying cached context lengths, under a cache limit of four. With an initial order of <math alttext="\{Q_{1},Q_{2}\}" class="ltx_Math" display="inline" id="S5.SS2.p2.1.m1.2"><semantics id="S5.SS2.p2.1.m1.2a"><mrow id="S5.SS2.p2.1.m1.2.2.2" xref="S5.SS2.p2.1.m1.2.2.3.cmml"><mo id="S5.SS2.p2.1.m1.2.2.2.3" stretchy="false" xref="S5.SS2.p2.1.m1.2.2.3.cmml">{</mo><msub id="S5.SS2.p2.1.m1.1.1.1.1" xref="S5.SS2.p2.1.m1.1.1.1.1.cmml"><mi id="S5.SS2.p2.1.m1.1.1.1.1.2" xref="S5.SS2.p2.1.m1.1.1.1.1.2.cmml">Q</mi><mn id="S5.SS2.p2.1.m1.1.1.1.1.3" xref="S5.SS2.p2.1.m1.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS2.p2.1.m1.2.2.2.4" xref="S5.SS2.p2.1.m1.2.2.3.cmml">,</mo><msub id="S5.SS2.p2.1.m1.2.2.2.2" xref="S5.SS2.p2.1.m1.2.2.2.2.cmml"><mi id="S5.SS2.p2.1.m1.2.2.2.2.2" xref="S5.SS2.p2.1.m1.2.2.2.2.2.cmml">Q</mi><mn id="S5.SS2.p2.1.m1.2.2.2.2.3" xref="S5.SS2.p2.1.m1.2.2.2.2.3.cmml">2</mn></msub><mo id="S5.SS2.p2.1.m1.2.2.2.5" stretchy="false" xref="S5.SS2.p2.1.m1.2.2.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.1.m1.2b"><set id="S5.SS2.p2.1.m1.2.2.3.cmml" xref="S5.SS2.p2.1.m1.2.2.2"><apply id="S5.SS2.p2.1.m1.1.1.1.1.cmml" xref="S5.SS2.p2.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.1.m1.1.1.1.1.1.cmml" xref="S5.SS2.p2.1.m1.1.1.1.1">subscript</csymbol><ci id="S5.SS2.p2.1.m1.1.1.1.1.2.cmml" xref="S5.SS2.p2.1.m1.1.1.1.1.2">𝑄</ci><cn id="S5.SS2.p2.1.m1.1.1.1.1.3.cmml" type="integer" xref="S5.SS2.p2.1.m1.1.1.1.1.3">1</cn></apply><apply id="S5.SS2.p2.1.m1.2.2.2.2.cmml" xref="S5.SS2.p2.1.m1.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS2.p2.1.m1.2.2.2.2.1.cmml" xref="S5.SS2.p2.1.m1.2.2.2.2">subscript</csymbol><ci id="S5.SS2.p2.1.m1.2.2.2.2.2.cmml" xref="S5.SS2.p2.1.m1.2.2.2.2.2">𝑄</ci><cn id="S5.SS2.p2.1.m1.2.2.2.2.3.cmml" type="integer" xref="S5.SS2.p2.1.m1.2.2.2.2.3">2</cn></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.1.m1.2c">\{Q_{1},Q_{2}\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.1.m1.2d">{ italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT }</annotation></semantics></math>, the
system must clear <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S5.SS2.p2.2.m2.1"><semantics id="S5.SS2.p2.2.m2.1a"><msub id="S5.SS2.p2.2.m2.1.1" xref="S5.SS2.p2.2.m2.1.1.cmml"><mi id="S5.SS2.p2.2.m2.1.1.2" xref="S5.SS2.p2.2.m2.1.1.2.cmml">Q</mi><mn id="S5.SS2.p2.2.m2.1.1.3" xref="S5.SS2.p2.2.m2.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.2.m2.1b"><apply id="S5.SS2.p2.2.m2.1.1.cmml" xref="S5.SS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.2.m2.1.1.1.cmml" xref="S5.SS2.p2.2.m2.1.1">subscript</csymbol><ci id="S5.SS2.p2.2.m2.1.1.2.cmml" xref="S5.SS2.p2.2.m2.1.1.2">𝑄</ci><cn id="S5.SS2.p2.2.m2.1.1.3.cmml" type="integer" xref="S5.SS2.p2.2.m2.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.2.m2.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.2.m2.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>’s cache space to accommodate <math alttext="Q_{1}" class="ltx_Math" display="inline" id="S5.SS2.p2.3.m3.1"><semantics id="S5.SS2.p2.3.m3.1a"><msub id="S5.SS2.p2.3.m3.1.1" xref="S5.SS2.p2.3.m3.1.1.cmml"><mi id="S5.SS2.p2.3.m3.1.1.2" xref="S5.SS2.p2.3.m3.1.1.2.cmml">Q</mi><mn id="S5.SS2.p2.3.m3.1.1.3" xref="S5.SS2.p2.3.m3.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.3.m3.1b"><apply id="S5.SS2.p2.3.m3.1.1.cmml" xref="S5.SS2.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.3.m3.1.1.1.cmml" xref="S5.SS2.p2.3.m3.1.1">subscript</csymbol><ci id="S5.SS2.p2.3.m3.1.1.2.cmml" xref="S5.SS2.p2.3.m3.1.1.2">𝑄</ci><cn id="S5.SS2.p2.3.m3.1.1.3.cmml" type="integer" xref="S5.SS2.p2.3.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.3.m3.1c">Q_{1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.3.m3.1d">italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>’s computation, then reallocate memory for <math alttext="Q_{1}" class="ltx_Math" display="inline" id="S5.SS2.p2.4.m4.1"><semantics id="S5.SS2.p2.4.m4.1a"><msub id="S5.SS2.p2.4.m4.1.1" xref="S5.SS2.p2.4.m4.1.1.cmml"><mi id="S5.SS2.p2.4.m4.1.1.2" xref="S5.SS2.p2.4.m4.1.1.2.cmml">Q</mi><mn id="S5.SS2.p2.4.m4.1.1.3" xref="S5.SS2.p2.4.m4.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.4.m4.1b"><apply id="S5.SS2.p2.4.m4.1.1.cmml" xref="S5.SS2.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.4.m4.1.1.1.cmml" xref="S5.SS2.p2.4.m4.1.1">subscript</csymbol><ci id="S5.SS2.p2.4.m4.1.1.2.cmml" xref="S5.SS2.p2.4.m4.1.1.2">𝑄</ci><cn id="S5.SS2.p2.4.m4.1.1.3.cmml" type="integer" xref="S5.SS2.p2.4.m4.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.4.m4.1c">Q_{1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.4.m4.1d">italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>’s
processing. It effectively utilizes <math alttext="Q_{1}" class="ltx_Math" display="inline" id="S5.SS2.p2.5.m5.1"><semantics id="S5.SS2.p2.5.m5.1a"><msub id="S5.SS2.p2.5.m5.1.1" xref="S5.SS2.p2.5.m5.1.1.cmml"><mi id="S5.SS2.p2.5.m5.1.1.2" xref="S5.SS2.p2.5.m5.1.1.2.cmml">Q</mi><mn id="S5.SS2.p2.5.m5.1.1.3" xref="S5.SS2.p2.5.m5.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.5.m5.1b"><apply id="S5.SS2.p2.5.m5.1.1.cmml" xref="S5.SS2.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.5.m5.1.1.1.cmml" xref="S5.SS2.p2.5.m5.1.1">subscript</csymbol><ci id="S5.SS2.p2.5.m5.1.1.2.cmml" xref="S5.SS2.p2.5.m5.1.1.2">𝑄</ci><cn id="S5.SS2.p2.5.m5.1.1.3.cmml" type="integer" xref="S5.SS2.p2.5.m5.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.5.m5.1c">Q_{1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.5.m5.1d">italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>’s cache while discarding <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S5.SS2.p2.6.m6.1"><semantics id="S5.SS2.p2.6.m6.1a"><msub id="S5.SS2.p2.6.m6.1.1" xref="S5.SS2.p2.6.m6.1.1.cmml"><mi id="S5.SS2.p2.6.m6.1.1.2" xref="S5.SS2.p2.6.m6.1.1.2.cmml">Q</mi><mn id="S5.SS2.p2.6.m6.1.1.3" xref="S5.SS2.p2.6.m6.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.6.m6.1b"><apply id="S5.SS2.p2.6.m6.1.1.cmml" xref="S5.SS2.p2.6.m6.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.6.m6.1.1.1.cmml" xref="S5.SS2.p2.6.m6.1.1">subscript</csymbol><ci id="S5.SS2.p2.6.m6.1.1.2.cmml" xref="S5.SS2.p2.6.m6.1.1.2">𝑄</ci><cn id="S5.SS2.p2.6.m6.1.1.3.cmml" type="integer" xref="S5.SS2.p2.6.m6.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.6.m6.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.6.m6.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>’s. This results in a total computation cost of <math alttext="2+1+2=5" class="ltx_Math" display="inline" id="S5.SS2.p2.7.m7.1"><semantics id="S5.SS2.p2.7.m7.1a"><mrow id="S5.SS2.p2.7.m7.1.1" xref="S5.SS2.p2.7.m7.1.1.cmml"><mrow id="S5.SS2.p2.7.m7.1.1.2" xref="S5.SS2.p2.7.m7.1.1.2.cmml"><mn id="S5.SS2.p2.7.m7.1.1.2.2" xref="S5.SS2.p2.7.m7.1.1.2.2.cmml">2</mn><mo id="S5.SS2.p2.7.m7.1.1.2.1" xref="S5.SS2.p2.7.m7.1.1.2.1.cmml">+</mo><mn id="S5.SS2.p2.7.m7.1.1.2.3" xref="S5.SS2.p2.7.m7.1.1.2.3.cmml">1</mn><mo id="S5.SS2.p2.7.m7.1.1.2.1a" xref="S5.SS2.p2.7.m7.1.1.2.1.cmml">+</mo><mn id="S5.SS2.p2.7.m7.1.1.2.4" xref="S5.SS2.p2.7.m7.1.1.2.4.cmml">2</mn></mrow><mo id="S5.SS2.p2.7.m7.1.1.1" xref="S5.SS2.p2.7.m7.1.1.1.cmml">=</mo><mn id="S5.SS2.p2.7.m7.1.1.3" xref="S5.SS2.p2.7.m7.1.1.3.cmml">5</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.7.m7.1b"><apply id="S5.SS2.p2.7.m7.1.1.cmml" xref="S5.SS2.p2.7.m7.1.1"><eq id="S5.SS2.p2.7.m7.1.1.1.cmml" xref="S5.SS2.p2.7.m7.1.1.1"></eq><apply id="S5.SS2.p2.7.m7.1.1.2.cmml" xref="S5.SS2.p2.7.m7.1.1.2"><plus id="S5.SS2.p2.7.m7.1.1.2.1.cmml" xref="S5.SS2.p2.7.m7.1.1.2.1"></plus><cn id="S5.SS2.p2.7.m7.1.1.2.2.cmml" type="integer" xref="S5.SS2.p2.7.m7.1.1.2.2">2</cn><cn id="S5.SS2.p2.7.m7.1.1.2.3.cmml" type="integer" xref="S5.SS2.p2.7.m7.1.1.2.3">1</cn><cn id="S5.SS2.p2.7.m7.1.1.2.4.cmml" type="integer" xref="S5.SS2.p2.7.m7.1.1.2.4">2</cn></apply><cn id="S5.SS2.p2.7.m7.1.1.3.cmml" type="integer" xref="S5.SS2.p2.7.m7.1.1.3">5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.7.m7.1c">2+1+2=5</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.7.m7.1d">2 + 1 + 2 = 5</annotation></semantics></math>. Conversely, ordering
as <math alttext="{Q_{2},Q_{1}}" class="ltx_Math" display="inline" id="S5.SS2.p2.8.m8.2"><semantics id="S5.SS2.p2.8.m8.2a"><mrow id="S5.SS2.p2.8.m8.2.2.2" xref="S5.SS2.p2.8.m8.2.2.3.cmml"><msub id="S5.SS2.p2.8.m8.1.1.1.1" xref="S5.SS2.p2.8.m8.1.1.1.1.cmml"><mi id="S5.SS2.p2.8.m8.1.1.1.1.2" xref="S5.SS2.p2.8.m8.1.1.1.1.2.cmml">Q</mi><mn id="S5.SS2.p2.8.m8.1.1.1.1.3" xref="S5.SS2.p2.8.m8.1.1.1.1.3.cmml">2</mn></msub><mo id="S5.SS2.p2.8.m8.2.2.2.3" xref="S5.SS2.p2.8.m8.2.2.3.cmml">,</mo><msub id="S5.SS2.p2.8.m8.2.2.2.2" xref="S5.SS2.p2.8.m8.2.2.2.2.cmml"><mi id="S5.SS2.p2.8.m8.2.2.2.2.2" xref="S5.SS2.p2.8.m8.2.2.2.2.2.cmml">Q</mi><mn id="S5.SS2.p2.8.m8.2.2.2.2.3" xref="S5.SS2.p2.8.m8.2.2.2.2.3.cmml">1</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.8.m8.2b"><list id="S5.SS2.p2.8.m8.2.2.3.cmml" xref="S5.SS2.p2.8.m8.2.2.2"><apply id="S5.SS2.p2.8.m8.1.1.1.1.cmml" xref="S5.SS2.p2.8.m8.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.8.m8.1.1.1.1.1.cmml" xref="S5.SS2.p2.8.m8.1.1.1.1">subscript</csymbol><ci id="S5.SS2.p2.8.m8.1.1.1.1.2.cmml" xref="S5.SS2.p2.8.m8.1.1.1.1.2">𝑄</ci><cn id="S5.SS2.p2.8.m8.1.1.1.1.3.cmml" type="integer" xref="S5.SS2.p2.8.m8.1.1.1.1.3">2</cn></apply><apply id="S5.SS2.p2.8.m8.2.2.2.2.cmml" xref="S5.SS2.p2.8.m8.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS2.p2.8.m8.2.2.2.2.1.cmml" xref="S5.SS2.p2.8.m8.2.2.2.2">subscript</csymbol><ci id="S5.SS2.p2.8.m8.2.2.2.2.2.cmml" xref="S5.SS2.p2.8.m8.2.2.2.2.2">𝑄</ci><cn id="S5.SS2.p2.8.m8.2.2.2.2.3.cmml" type="integer" xref="S5.SS2.p2.8.m8.2.2.2.2.3">1</cn></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.8.m8.2c">{Q_{2},Q_{1}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.8.m8.2d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> utilizes <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S5.SS2.p2.9.m9.1"><semantics id="S5.SS2.p2.9.m9.1a"><msub id="S5.SS2.p2.9.m9.1.1" xref="S5.SS2.p2.9.m9.1.1.cmml"><mi id="S5.SS2.p2.9.m9.1.1.2" xref="S5.SS2.p2.9.m9.1.1.2.cmml">Q</mi><mn id="S5.SS2.p2.9.m9.1.1.3" xref="S5.SS2.p2.9.m9.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.9.m9.1b"><apply id="S5.SS2.p2.9.m9.1.1.cmml" xref="S5.SS2.p2.9.m9.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.9.m9.1.1.1.cmml" xref="S5.SS2.p2.9.m9.1.1">subscript</csymbol><ci id="S5.SS2.p2.9.m9.1.1.2.cmml" xref="S5.SS2.p2.9.m9.1.1.2">𝑄</ci><cn id="S5.SS2.p2.9.m9.1.1.3.cmml" type="integer" xref="S5.SS2.p2.9.m9.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.9.m9.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.9.m9.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>’s cache but discards <math alttext="Q_{1}" class="ltx_Math" display="inline" id="S5.SS2.p2.10.m10.1"><semantics id="S5.SS2.p2.10.m10.1a"><msub id="S5.SS2.p2.10.m10.1.1" xref="S5.SS2.p2.10.m10.1.1.cmml"><mi id="S5.SS2.p2.10.m10.1.1.2" xref="S5.SS2.p2.10.m10.1.1.2.cmml">Q</mi><mn id="S5.SS2.p2.10.m10.1.1.3" xref="S5.SS2.p2.10.m10.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.10.m10.1b"><apply id="S5.SS2.p2.10.m10.1.1.cmml" xref="S5.SS2.p2.10.m10.1.1"><csymbol cd="ambiguous" id="S5.SS2.p2.10.m10.1.1.1.cmml" xref="S5.SS2.p2.10.m10.1.1">subscript</csymbol><ci id="S5.SS2.p2.10.m10.1.1.2.cmml" xref="S5.SS2.p2.10.m10.1.1.2">𝑄</ci><cn id="S5.SS2.p2.10.m10.1.1.3.cmml" type="integer" xref="S5.SS2.p2.10.m10.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.10.m10.1c">Q_{1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.10.m10.1d">italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>’s, which increases computation to <math alttext="2+2+2=6" class="ltx_Math" display="inline" id="S5.SS2.p2.11.m11.1"><semantics id="S5.SS2.p2.11.m11.1a"><mrow id="S5.SS2.p2.11.m11.1.1" xref="S5.SS2.p2.11.m11.1.1.cmml"><mrow id="S5.SS2.p2.11.m11.1.1.2" xref="S5.SS2.p2.11.m11.1.1.2.cmml"><mn id="S5.SS2.p2.11.m11.1.1.2.2" xref="S5.SS2.p2.11.m11.1.1.2.2.cmml">2</mn><mo id="S5.SS2.p2.11.m11.1.1.2.1" xref="S5.SS2.p2.11.m11.1.1.2.1.cmml">+</mo><mn id="S5.SS2.p2.11.m11.1.1.2.3" xref="S5.SS2.p2.11.m11.1.1.2.3.cmml">2</mn><mo id="S5.SS2.p2.11.m11.1.1.2.1a" xref="S5.SS2.p2.11.m11.1.1.2.1.cmml">+</mo><mn id="S5.SS2.p2.11.m11.1.1.2.4" xref="S5.SS2.p2.11.m11.1.1.2.4.cmml">2</mn></mrow><mo id="S5.SS2.p2.11.m11.1.1.1" xref="S5.SS2.p2.11.m11.1.1.1.cmml">=</mo><mn id="S5.SS2.p2.11.m11.1.1.3" xref="S5.SS2.p2.11.m11.1.1.3.cmml">6</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p2.11.m11.1b"><apply id="S5.SS2.p2.11.m11.1.1.cmml" xref="S5.SS2.p2.11.m11.1.1"><eq id="S5.SS2.p2.11.m11.1.1.1.cmml" xref="S5.SS2.p2.11.m11.1.1.1"></eq><apply id="S5.SS2.p2.11.m11.1.1.2.cmml" xref="S5.SS2.p2.11.m11.1.1.2"><plus id="S5.SS2.p2.11.m11.1.1.2.1.cmml" xref="S5.SS2.p2.11.m11.1.1.2.1"></plus><cn id="S5.SS2.p2.11.m11.1.1.2.2.cmml" type="integer" xref="S5.SS2.p2.11.m11.1.1.2.2">2</cn><cn id="S5.SS2.p2.11.m11.1.1.2.3.cmml" type="integer" xref="S5.SS2.p2.11.m11.1.1.2.3">2</cn><cn id="S5.SS2.p2.11.m11.1.1.2.4.cmml" type="integer" xref="S5.SS2.p2.11.m11.1.1.2.4">2</cn></apply><cn id="S5.SS2.p2.11.m11.1.1.3.cmml" type="integer" xref="S5.SS2.p2.11.m11.1.1.3">6</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p2.11.m11.1c">2+2+2=6</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p2.11.m11.1d">2 + 2 + 2 = 6</annotation></semantics></math>.
Thus, cache-aware reordering advocates prioritizing requests with larger cached contexts to enhance cache efficiency,
as they bring larger benefits.</p>
</div>
<div class="ltx_para" id="S5.SS2.p3">
<p class="ltx_p" id="S5.SS2.p3.8">In the second scenario, we examine requests with identical cached context lengths but varying recomputation demands,
given a cache capacity of five. For a sequence <math alttext="\{Q_{1},Q_{2}\}" class="ltx_Math" display="inline" id="S5.SS2.p3.1.m1.2"><semantics id="S5.SS2.p3.1.m1.2a"><mrow id="S5.SS2.p3.1.m1.2.2.2" xref="S5.SS2.p3.1.m1.2.2.3.cmml"><mo id="S5.SS2.p3.1.m1.2.2.2.3" stretchy="false" xref="S5.SS2.p3.1.m1.2.2.3.cmml">{</mo><msub id="S5.SS2.p3.1.m1.1.1.1.1" xref="S5.SS2.p3.1.m1.1.1.1.1.cmml"><mi id="S5.SS2.p3.1.m1.1.1.1.1.2" xref="S5.SS2.p3.1.m1.1.1.1.1.2.cmml">Q</mi><mn id="S5.SS2.p3.1.m1.1.1.1.1.3" xref="S5.SS2.p3.1.m1.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS2.p3.1.m1.2.2.2.4" xref="S5.SS2.p3.1.m1.2.2.3.cmml">,</mo><msub id="S5.SS2.p3.1.m1.2.2.2.2" xref="S5.SS2.p3.1.m1.2.2.2.2.cmml"><mi id="S5.SS2.p3.1.m1.2.2.2.2.2" xref="S5.SS2.p3.1.m1.2.2.2.2.2.cmml">Q</mi><mn id="S5.SS2.p3.1.m1.2.2.2.2.3" xref="S5.SS2.p3.1.m1.2.2.2.2.3.cmml">2</mn></msub><mo id="S5.SS2.p3.1.m1.2.2.2.5" stretchy="false" xref="S5.SS2.p3.1.m1.2.2.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p3.1.m1.2b"><set id="S5.SS2.p3.1.m1.2.2.3.cmml" xref="S5.SS2.p3.1.m1.2.2.2"><apply id="S5.SS2.p3.1.m1.1.1.1.1.cmml" xref="S5.SS2.p3.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p3.1.m1.1.1.1.1.1.cmml" xref="S5.SS2.p3.1.m1.1.1.1.1">subscript</csymbol><ci id="S5.SS2.p3.1.m1.1.1.1.1.2.cmml" xref="S5.SS2.p3.1.m1.1.1.1.1.2">𝑄</ci><cn id="S5.SS2.p3.1.m1.1.1.1.1.3.cmml" type="integer" xref="S5.SS2.p3.1.m1.1.1.1.1.3">1</cn></apply><apply id="S5.SS2.p3.1.m1.2.2.2.2.cmml" xref="S5.SS2.p3.1.m1.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS2.p3.1.m1.2.2.2.2.1.cmml" xref="S5.SS2.p3.1.m1.2.2.2.2">subscript</csymbol><ci id="S5.SS2.p3.1.m1.2.2.2.2.2.cmml" xref="S5.SS2.p3.1.m1.2.2.2.2.2">𝑄</ci><cn id="S5.SS2.p3.1.m1.2.2.2.2.3.cmml" type="integer" xref="S5.SS2.p3.1.m1.2.2.2.2.3">2</cn></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p3.1.m1.2c">\{Q_{1},Q_{2}\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p3.1.m1.2d">{ italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT }</annotation></semantics></math>, the system must clear <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S5.SS2.p3.2.m2.1"><semantics id="S5.SS2.p3.2.m2.1a"><msub id="S5.SS2.p3.2.m2.1.1" xref="S5.SS2.p3.2.m2.1.1.cmml"><mi id="S5.SS2.p3.2.m2.1.1.2" xref="S5.SS2.p3.2.m2.1.1.2.cmml">Q</mi><mn id="S5.SS2.p3.2.m2.1.1.3" xref="S5.SS2.p3.2.m2.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p3.2.m2.1b"><apply id="S5.SS2.p3.2.m2.1.1.cmml" xref="S5.SS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS2.p3.2.m2.1.1.1.cmml" xref="S5.SS2.p3.2.m2.1.1">subscript</csymbol><ci id="S5.SS2.p3.2.m2.1.1.2.cmml" xref="S5.SS2.p3.2.m2.1.1.2">𝑄</ci><cn id="S5.SS2.p3.2.m2.1.1.3.cmml" type="integer" xref="S5.SS2.p3.2.m2.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p3.2.m2.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p3.2.m2.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>’s cache to allocate
space for <math alttext="Q_{1}" class="ltx_Math" display="inline" id="S5.SS2.p3.3.m3.1"><semantics id="S5.SS2.p3.3.m3.1a"><msub id="S5.SS2.p3.3.m3.1.1" xref="S5.SS2.p3.3.m3.1.1.cmml"><mi id="S5.SS2.p3.3.m3.1.1.2" xref="S5.SS2.p3.3.m3.1.1.2.cmml">Q</mi><mn id="S5.SS2.p3.3.m3.1.1.3" xref="S5.SS2.p3.3.m3.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p3.3.m3.1b"><apply id="S5.SS2.p3.3.m3.1.1.cmml" xref="S5.SS2.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS2.p3.3.m3.1.1.1.cmml" xref="S5.SS2.p3.3.m3.1.1">subscript</csymbol><ci id="S5.SS2.p3.3.m3.1.1.2.cmml" xref="S5.SS2.p3.3.m3.1.1.2">𝑄</ci><cn id="S5.SS2.p3.3.m3.1.1.3.cmml" type="integer" xref="S5.SS2.p3.3.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p3.3.m3.1c">Q_{1}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p3.3.m3.1d">italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>’s computation, given only one available memory slot. This necessitates recomputing <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S5.SS2.p3.4.m4.1"><semantics id="S5.SS2.p3.4.m4.1a"><msub id="S5.SS2.p3.4.m4.1.1" xref="S5.SS2.p3.4.m4.1.1.cmml"><mi id="S5.SS2.p3.4.m4.1.1.2" xref="S5.SS2.p3.4.m4.1.1.2.cmml">Q</mi><mn id="S5.SS2.p3.4.m4.1.1.3" xref="S5.SS2.p3.4.m4.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p3.4.m4.1b"><apply id="S5.SS2.p3.4.m4.1.1.cmml" xref="S5.SS2.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS2.p3.4.m4.1.1.1.cmml" xref="S5.SS2.p3.4.m4.1.1">subscript</csymbol><ci id="S5.SS2.p3.4.m4.1.1.2.cmml" xref="S5.SS2.p3.4.m4.1.1.2">𝑄</ci><cn id="S5.SS2.p3.4.m4.1.1.3.cmml" type="integer" xref="S5.SS2.p3.4.m4.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p3.4.m4.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p3.4.m4.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math> entirely,
resulting in a computation cost of <math alttext="2+2+1=5" class="ltx_Math" display="inline" id="S5.SS2.p3.5.m5.1"><semantics id="S5.SS2.p3.5.m5.1a"><mrow id="S5.SS2.p3.5.m5.1.1" xref="S5.SS2.p3.5.m5.1.1.cmml"><mrow id="S5.SS2.p3.5.m5.1.1.2" xref="S5.SS2.p3.5.m5.1.1.2.cmml"><mn id="S5.SS2.p3.5.m5.1.1.2.2" xref="S5.SS2.p3.5.m5.1.1.2.2.cmml">2</mn><mo id="S5.SS2.p3.5.m5.1.1.2.1" xref="S5.SS2.p3.5.m5.1.1.2.1.cmml">+</mo><mn id="S5.SS2.p3.5.m5.1.1.2.3" xref="S5.SS2.p3.5.m5.1.1.2.3.cmml">2</mn><mo id="S5.SS2.p3.5.m5.1.1.2.1a" xref="S5.SS2.p3.5.m5.1.1.2.1.cmml">+</mo><mn id="S5.SS2.p3.5.m5.1.1.2.4" xref="S5.SS2.p3.5.m5.1.1.2.4.cmml">1</mn></mrow><mo id="S5.SS2.p3.5.m5.1.1.1" xref="S5.SS2.p3.5.m5.1.1.1.cmml">=</mo><mn id="S5.SS2.p3.5.m5.1.1.3" xref="S5.SS2.p3.5.m5.1.1.3.cmml">5</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p3.5.m5.1b"><apply id="S5.SS2.p3.5.m5.1.1.cmml" xref="S5.SS2.p3.5.m5.1.1"><eq id="S5.SS2.p3.5.m5.1.1.1.cmml" xref="S5.SS2.p3.5.m5.1.1.1"></eq><apply id="S5.SS2.p3.5.m5.1.1.2.cmml" xref="S5.SS2.p3.5.m5.1.1.2"><plus id="S5.SS2.p3.5.m5.1.1.2.1.cmml" xref="S5.SS2.p3.5.m5.1.1.2.1"></plus><cn id="S5.SS2.p3.5.m5.1.1.2.2.cmml" type="integer" xref="S5.SS2.p3.5.m5.1.1.2.2">2</cn><cn id="S5.SS2.p3.5.m5.1.1.2.3.cmml" type="integer" xref="S5.SS2.p3.5.m5.1.1.2.3">2</cn><cn id="S5.SS2.p3.5.m5.1.1.2.4.cmml" type="integer" xref="S5.SS2.p3.5.m5.1.1.2.4">1</cn></apply><cn id="S5.SS2.p3.5.m5.1.1.3.cmml" type="integer" xref="S5.SS2.p3.5.m5.1.1.3">5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p3.5.m5.1c">2+2+1=5</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p3.5.m5.1d">2 + 2 + 1 = 5</annotation></semantics></math>. In contrast, the sequence <math alttext="\{Q_{2},Q_{1}\}" class="ltx_Math" display="inline" id="S5.SS2.p3.6.m6.2"><semantics id="S5.SS2.p3.6.m6.2a"><mrow id="S5.SS2.p3.6.m6.2.2.2" xref="S5.SS2.p3.6.m6.2.2.3.cmml"><mo id="S5.SS2.p3.6.m6.2.2.2.3" stretchy="false" xref="S5.SS2.p3.6.m6.2.2.3.cmml">{</mo><msub id="S5.SS2.p3.6.m6.1.1.1.1" xref="S5.SS2.p3.6.m6.1.1.1.1.cmml"><mi id="S5.SS2.p3.6.m6.1.1.1.1.2" xref="S5.SS2.p3.6.m6.1.1.1.1.2.cmml">Q</mi><mn id="S5.SS2.p3.6.m6.1.1.1.1.3" xref="S5.SS2.p3.6.m6.1.1.1.1.3.cmml">2</mn></msub><mo id="S5.SS2.p3.6.m6.2.2.2.4" xref="S5.SS2.p3.6.m6.2.2.3.cmml">,</mo><msub id="S5.SS2.p3.6.m6.2.2.2.2" xref="S5.SS2.p3.6.m6.2.2.2.2.cmml"><mi id="S5.SS2.p3.6.m6.2.2.2.2.2" xref="S5.SS2.p3.6.m6.2.2.2.2.2.cmml">Q</mi><mn id="S5.SS2.p3.6.m6.2.2.2.2.3" xref="S5.SS2.p3.6.m6.2.2.2.2.3.cmml">1</mn></msub><mo id="S5.SS2.p3.6.m6.2.2.2.5" stretchy="false" xref="S5.SS2.p3.6.m6.2.2.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p3.6.m6.2b"><set id="S5.SS2.p3.6.m6.2.2.3.cmml" xref="S5.SS2.p3.6.m6.2.2.2"><apply id="S5.SS2.p3.6.m6.1.1.1.1.cmml" xref="S5.SS2.p3.6.m6.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p3.6.m6.1.1.1.1.1.cmml" xref="S5.SS2.p3.6.m6.1.1.1.1">subscript</csymbol><ci id="S5.SS2.p3.6.m6.1.1.1.1.2.cmml" xref="S5.SS2.p3.6.m6.1.1.1.1.2">𝑄</ci><cn id="S5.SS2.p3.6.m6.1.1.1.1.3.cmml" type="integer" xref="S5.SS2.p3.6.m6.1.1.1.1.3">2</cn></apply><apply id="S5.SS2.p3.6.m6.2.2.2.2.cmml" xref="S5.SS2.p3.6.m6.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS2.p3.6.m6.2.2.2.2.1.cmml" xref="S5.SS2.p3.6.m6.2.2.2.2">subscript</csymbol><ci id="S5.SS2.p3.6.m6.2.2.2.2.2.cmml" xref="S5.SS2.p3.6.m6.2.2.2.2.2">𝑄</ci><cn id="S5.SS2.p3.6.m6.2.2.2.2.3.cmml" type="integer" xref="S5.SS2.p3.6.m6.2.2.2.2.3">1</cn></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p3.6.m6.2c">\{Q_{2},Q_{1}\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p3.6.m6.2d">{ italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_Q start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT }</annotation></semantics></math> allows for direct computation
of <math alttext="Q_{2}" class="ltx_Math" display="inline" id="S5.SS2.p3.7.m7.1"><semantics id="S5.SS2.p3.7.m7.1a"><msub id="S5.SS2.p3.7.m7.1.1" xref="S5.SS2.p3.7.m7.1.1.cmml"><mi id="S5.SS2.p3.7.m7.1.1.2" xref="S5.SS2.p3.7.m7.1.1.2.cmml">Q</mi><mn id="S5.SS2.p3.7.m7.1.1.3" xref="S5.SS2.p3.7.m7.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p3.7.m7.1b"><apply id="S5.SS2.p3.7.m7.1.1.cmml" xref="S5.SS2.p3.7.m7.1.1"><csymbol cd="ambiguous" id="S5.SS2.p3.7.m7.1.1.1.cmml" xref="S5.SS2.p3.7.m7.1.1">subscript</csymbol><ci id="S5.SS2.p3.7.m7.1.1.2.cmml" xref="S5.SS2.p3.7.m7.1.1.2">𝑄</ci><cn id="S5.SS2.p3.7.m7.1.1.3.cmml" type="integer" xref="S5.SS2.p3.7.m7.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p3.7.m7.1c">Q_{2}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p3.7.m7.1d">italic_Q start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math> due to adequate cache availability. It reduces the total computation to <math alttext="2+1=3" class="ltx_Math" display="inline" id="S5.SS2.p3.8.m8.1"><semantics id="S5.SS2.p3.8.m8.1a"><mrow id="S5.SS2.p3.8.m8.1.1" xref="S5.SS2.p3.8.m8.1.1.cmml"><mrow id="S5.SS2.p3.8.m8.1.1.2" xref="S5.SS2.p3.8.m8.1.1.2.cmml"><mn id="S5.SS2.p3.8.m8.1.1.2.2" xref="S5.SS2.p3.8.m8.1.1.2.2.cmml">2</mn><mo id="S5.SS2.p3.8.m8.1.1.2.1" xref="S5.SS2.p3.8.m8.1.1.2.1.cmml">+</mo><mn id="S5.SS2.p3.8.m8.1.1.2.3" xref="S5.SS2.p3.8.m8.1.1.2.3.cmml">1</mn></mrow><mo id="S5.SS2.p3.8.m8.1.1.1" xref="S5.SS2.p3.8.m8.1.1.1.cmml">=</mo><mn id="S5.SS2.p3.8.m8.1.1.3" xref="S5.SS2.p3.8.m8.1.1.3.cmml">3</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p3.8.m8.1b"><apply id="S5.SS2.p3.8.m8.1.1.cmml" xref="S5.SS2.p3.8.m8.1.1"><eq id="S5.SS2.p3.8.m8.1.1.1.cmml" xref="S5.SS2.p3.8.m8.1.1.1"></eq><apply id="S5.SS2.p3.8.m8.1.1.2.cmml" xref="S5.SS2.p3.8.m8.1.1.2"><plus id="S5.SS2.p3.8.m8.1.1.2.1.cmml" xref="S5.SS2.p3.8.m8.1.1.2.1"></plus><cn id="S5.SS2.p3.8.m8.1.1.2.2.cmml" type="integer" xref="S5.SS2.p3.8.m8.1.1.2.2">2</cn><cn id="S5.SS2.p3.8.m8.1.1.2.3.cmml" type="integer" xref="S5.SS2.p3.8.m8.1.1.2.3">1</cn></apply><cn id="S5.SS2.p3.8.m8.1.1.3.cmml" type="integer" xref="S5.SS2.p3.8.m8.1.1.3">3</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p3.8.m8.1c">2+1=3</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p3.8.m8.1d">2 + 1 = 3</annotation></semantics></math>. Hence, cache-aware
reordering is beneficial when it prioritizes requests with shorter recomputation segments,
as this approach minimizes the adverse effects on cache efficiency.</p>
</div>
<div class="ltx_para" id="S5.SS2.p4">
<p class="ltx_p" id="S5.SS2.p4.1">Drawing from these insights, we introduce a cache-aware reordering algorithm aimed at improving cache efficiency.
RAGCache employs a priority queue for managing incoming requests, prioritizing them based on their impact on
cache performance. Specifically, requests are selected for processing based on a priority metric, defined as:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="S10.EGx5">
<tbody id="S5.Ex3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\mathit{OrderPriority}=\frac{\mathit{Cached\ Length}}{\mathit{%
Computation\ Length}}" class="ltx_Math" display="inline" id="S5.Ex3.m2.1"><semantics id="S5.Ex3.m2.1a"><mrow id="S5.Ex3.m2.1.1" xref="S5.Ex3.m2.1.1.cmml"><mi id="S5.Ex3.m2.1.1.2" xref="S5.Ex3.m2.1.1.2.cmml">𝑂𝑟𝑑𝑒𝑟𝑃𝑟𝑖𝑜𝑟𝑖𝑡𝑦</mi><mo id="S5.Ex3.m2.1.1.1" xref="S5.Ex3.m2.1.1.1.cmml">=</mo><mstyle displaystyle="true" id="S5.Ex3.m2.1.1.3" xref="S5.Ex3.m2.1.1.3.cmml"><mfrac id="S5.Ex3.m2.1.1.3a" xref="S5.Ex3.m2.1.1.3.cmml"><mrow id="S5.Ex3.m2.1.1.3.2" xref="S5.Ex3.m2.1.1.3.2.cmml"><mi id="S5.Ex3.m2.1.1.3.2.2" xref="S5.Ex3.m2.1.1.3.2.2.cmml">𝐶𝑎𝑐ℎ𝑒𝑑</mi><mo id="S5.Ex3.m2.1.1.3.2.1" lspace="0.500em" xref="S5.Ex3.m2.1.1.3.2.1.cmml">⁢</mo><mi id="S5.Ex3.m2.1.1.3.2.3" xref="S5.Ex3.m2.1.1.3.2.3.cmml">𝐿𝑒𝑛𝑔𝑡ℎ</mi></mrow><mrow id="S5.Ex3.m2.1.1.3.3" xref="S5.Ex3.m2.1.1.3.3.cmml"><mi id="S5.Ex3.m2.1.1.3.3.2" xref="S5.Ex3.m2.1.1.3.3.2.cmml">𝐶𝑜𝑚𝑝𝑢𝑡𝑎𝑡𝑖𝑜𝑛</mi><mo id="S5.Ex3.m2.1.1.3.3.1" lspace="0.500em" xref="S5.Ex3.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S5.Ex3.m2.1.1.3.3.3" xref="S5.Ex3.m2.1.1.3.3.3.cmml">𝐿𝑒𝑛𝑔𝑡ℎ</mi></mrow></mfrac></mstyle></mrow><annotation-xml encoding="MathML-Content" id="S5.Ex3.m2.1b"><apply id="S5.Ex3.m2.1.1.cmml" xref="S5.Ex3.m2.1.1"><eq id="S5.Ex3.m2.1.1.1.cmml" xref="S5.Ex3.m2.1.1.1"></eq><ci id="S5.Ex3.m2.1.1.2.cmml" xref="S5.Ex3.m2.1.1.2">𝑂𝑟𝑑𝑒𝑟𝑃𝑟𝑖𝑜𝑟𝑖𝑡𝑦</ci><apply id="S5.Ex3.m2.1.1.3.cmml" xref="S5.Ex3.m2.1.1.3"><divide id="S5.Ex3.m2.1.1.3.1.cmml" xref="S5.Ex3.m2.1.1.3"></divide><apply id="S5.Ex3.m2.1.1.3.2.cmml" xref="S5.Ex3.m2.1.1.3.2"><times id="S5.Ex3.m2.1.1.3.2.1.cmml" xref="S5.Ex3.m2.1.1.3.2.1"></times><ci id="S5.Ex3.m2.1.1.3.2.2.cmml" xref="S5.Ex3.m2.1.1.3.2.2">𝐶𝑎𝑐ℎ𝑒𝑑</ci><ci id="S5.Ex3.m2.1.1.3.2.3.cmml" xref="S5.Ex3.m2.1.1.3.2.3">𝐿𝑒𝑛𝑔𝑡ℎ</ci></apply><apply id="S5.Ex3.m2.1.1.3.3.cmml" xref="S5.Ex3.m2.1.1.3.3"><times id="S5.Ex3.m2.1.1.3.3.1.cmml" xref="S5.Ex3.m2.1.1.3.3.1"></times><ci id="S5.Ex3.m2.1.1.3.3.2.cmml" xref="S5.Ex3.m2.1.1.3.3.2">𝐶𝑜𝑚𝑝𝑢𝑡𝑎𝑡𝑖𝑜𝑛</ci><ci id="S5.Ex3.m2.1.1.3.3.3.cmml" xref="S5.Ex3.m2.1.1.3.3.3">𝐿𝑒𝑛𝑔𝑡ℎ</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.Ex3.m2.1c">\displaystyle\mathit{OrderPriority}=\frac{\mathit{Cached\ Length}}{\mathit{%
Computation\ Length}}</annotation><annotation encoding="application/x-llamapun" id="S5.Ex3.m2.1d">italic_OrderPriority = divide start_ARG italic_Cached italic_Length end_ARG start_ARG italic_Computation italic_Length end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS2.p4.2">This formula prioritizes requests that are likely to enhance cache efficiency—–those with a larger cached portion
relative to their computation needs.
By adopting this cache-aware reordering, RAGCache increases the cache hit rate and decreases the total computation time,
optimizing resource use and system performance.
To avoid starvation, RAGCache sets a window for each request to ensure that all requests are processed no later than the window size.</p>
</div>
</section>
<section class="ltx_subsection" id="S5.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.3. </span>Dynamic Speculative Pipelining</h3>
<div class="ltx_para" id="S5.SS3.p1">
<p class="ltx_p" id="S5.SS3.p1.1">As we discuss in §<a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.SS1" title="3.1. Performance Bottleneck ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">3.1</span></a>, the LLM generation is the
key performance bottleneck in RAG systems. However, if the vector database grows to a
larger scale or the retrieving requires a higher accuracy, the retrieval step may
incur a substantial latency. To mitigate the impact of retrieval latency, RAGCache employs dynamic speculative pipelining to overlap knowledge retrieval and LLM inference.
The key insight behind this technique is that the vector search may produce
the final results early in the retrieval step, which can be leveraged
by LLM for speculative generation ahead of time.</p>
</div>
<figure class="ltx_figure" id="S5.F11"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_missing ltx_missing_image" id="S5.F11.g1" src=""/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F11.2.1.1" style="font-size:90%;">Figure 11</span>. </span><span class="ltx_text" id="S5.F11.3.2" style="font-size:90%;">Speculative pipelining.</span></figcaption>
</figure>
<div class="ltx_para" id="S5.SS3.p2">
<p class="ltx_p" id="S5.SS3.p2.5">Specifically, vector search maintains a queue of top-<math alttext="k" class="ltx_Math" display="inline" id="S5.SS3.p2.1.m1.1"><semantics id="S5.SS3.p2.1.m1.1a"><mi id="S5.SS3.p2.1.m1.1.1" xref="S5.SS3.p2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.1.m1.1b"><ci id="S5.SS3.p2.1.m1.1.1.cmml" xref="S5.SS3.p2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.1.m1.1d">italic_k</annotation></semantics></math> candidate documents,
which are ranked by their similarity to the request.
During the retrieval process, the top-<math alttext="k" class="ltx_Math" display="inline" id="S5.SS3.p2.2.m2.1"><semantics id="S5.SS3.p2.2.m2.1a"><mi id="S5.SS3.p2.2.m2.1.1" xref="S5.SS3.p2.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.2.m2.1b"><ci id="S5.SS3.p2.2.m2.1.1.cmml" xref="S5.SS3.p2.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.2.m2.1d">italic_k</annotation></semantics></math> documents in the queue are continuously updated
i.e., some documents with greater similarity are inserted into the queue.
However, the final top-<math alttext="k" class="ltx_Math" display="inline" id="S5.SS3.p2.3.m3.1"><semantics id="S5.SS3.p2.3.m3.1a"><mi id="S5.SS3.p2.3.m3.1.1" xref="S5.SS3.p2.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.3.m3.1b"><ci id="S5.SS3.p2.3.m3.1.1.cmml" xref="S5.SS3.p2.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.3.m3.1d">italic_k</annotation></semantics></math> documents may emerge early in the retrieval step <cite class="ltx_cite ltx_citemacro_citep">(Zhang
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib54" title="">2023b</a>; Li
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib29" title="">2020b</a>)</cite>.
Based this observation, RAGCache introduces a speculative pipelining strategy that splits a request’s retrieval process into several
stages. In each stage, RAGCache ticks the vector database to send the candidate documents to the LLM
engine for speculative generation. Then, the LLM engine starts a new speculative generation
and terminates the previous generation if the received documents are different from the previous ones.
If there is no difference, the LLM engine remains processing the previous generation.
When the final top-<math alttext="k" class="ltx_Math" display="inline" id="S5.SS3.p2.4.m4.1"><semantics id="S5.SS3.p2.4.m4.1a"><mi id="S5.SS3.p2.4.m4.1.1" xref="S5.SS3.p2.4.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.4.m4.1b"><ci id="S5.SS3.p2.4.m4.1.1.cmml" xref="S5.SS3.p2.4.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.4.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.4.m4.1d">italic_k</annotation></semantics></math> documents are produced, RAGCache sends the final results
to the LLM engine. At this moment, the LLM engine returns the results of the latest speculative generation
to users if it matches the final top-<math alttext="k" class="ltx_Math" display="inline" id="S5.SS3.p2.5.m5.1"><semantics id="S5.SS3.p2.5.m5.1a"><mi id="S5.SS3.p2.5.m5.1.1" xref="S5.SS3.p2.5.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.5.m5.1b"><ci id="S5.SS3.p2.5.m5.1.1.cmml" xref="S5.SS3.p2.5.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.5.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.5.m5.1d">italic_k</annotation></semantics></math> documents. Otherwise, the LLM engine performs re-generation.</p>
</div>
<div class="ltx_para" id="S5.SS3.p3">
<p class="ltx_p" id="S5.SS3.p3.10">As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.F11" title="Figure 11 ‣ 5.3. Dynamic Speculative Pipelining ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">11</span></a>, we split the retrieval process into four stages.
The top-<math alttext="2" class="ltx_Math" display="inline" id="S5.SS3.p3.1.m1.1"><semantics id="S5.SS3.p3.1.m1.1a"><mn id="S5.SS3.p3.1.m1.1.1" xref="S5.SS3.p3.1.m1.1.1.cmml">2</mn><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.1.m1.1b"><cn id="S5.SS3.p3.1.m1.1.1.cmml" type="integer" xref="S5.SS3.p3.1.m1.1.1">2</cn></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.1.m1.1c">2</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.1.m1.1d">2</annotation></semantics></math> documents in candidate queue are <math alttext="[D_{1},D_{3}]" class="ltx_Math" display="inline" id="S5.SS3.p3.2.m2.2"><semantics id="S5.SS3.p3.2.m2.2a"><mrow id="S5.SS3.p3.2.m2.2.2.2" xref="S5.SS3.p3.2.m2.2.2.3.cmml"><mo id="S5.SS3.p3.2.m2.2.2.2.3" stretchy="false" xref="S5.SS3.p3.2.m2.2.2.3.cmml">[</mo><msub id="S5.SS3.p3.2.m2.1.1.1.1" xref="S5.SS3.p3.2.m2.1.1.1.1.cmml"><mi id="S5.SS3.p3.2.m2.1.1.1.1.2" xref="S5.SS3.p3.2.m2.1.1.1.1.2.cmml">D</mi><mn id="S5.SS3.p3.2.m2.1.1.1.1.3" xref="S5.SS3.p3.2.m2.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS3.p3.2.m2.2.2.2.4" xref="S5.SS3.p3.2.m2.2.2.3.cmml">,</mo><msub id="S5.SS3.p3.2.m2.2.2.2.2" xref="S5.SS3.p3.2.m2.2.2.2.2.cmml"><mi id="S5.SS3.p3.2.m2.2.2.2.2.2" xref="S5.SS3.p3.2.m2.2.2.2.2.2.cmml">D</mi><mn id="S5.SS3.p3.2.m2.2.2.2.2.3" xref="S5.SS3.p3.2.m2.2.2.2.2.3.cmml">3</mn></msub><mo id="S5.SS3.p3.2.m2.2.2.2.5" stretchy="false" xref="S5.SS3.p3.2.m2.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.2.m2.2b"><interval closure="closed" id="S5.SS3.p3.2.m2.2.2.3.cmml" xref="S5.SS3.p3.2.m2.2.2.2"><apply id="S5.SS3.p3.2.m2.1.1.1.1.cmml" xref="S5.SS3.p3.2.m2.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.2.m2.1.1.1.1.1.cmml" xref="S5.SS3.p3.2.m2.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p3.2.m2.1.1.1.1.2.cmml" xref="S5.SS3.p3.2.m2.1.1.1.1.2">𝐷</ci><cn id="S5.SS3.p3.2.m2.1.1.1.1.3.cmml" type="integer" xref="S5.SS3.p3.2.m2.1.1.1.1.3">1</cn></apply><apply id="S5.SS3.p3.2.m2.2.2.2.2.cmml" xref="S5.SS3.p3.2.m2.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS3.p3.2.m2.2.2.2.2.1.cmml" xref="S5.SS3.p3.2.m2.2.2.2.2">subscript</csymbol><ci id="S5.SS3.p3.2.m2.2.2.2.2.2.cmml" xref="S5.SS3.p3.2.m2.2.2.2.2.2">𝐷</ci><cn id="S5.SS3.p3.2.m2.2.2.2.2.3.cmml" type="integer" xref="S5.SS3.p3.2.m2.2.2.2.2.3">3</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.2.m2.2c">[D_{1},D_{3}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.2.m2.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT ]</annotation></semantics></math>, <math alttext="[D_{1},D_{2}]" class="ltx_Math" display="inline" id="S5.SS3.p3.3.m3.2"><semantics id="S5.SS3.p3.3.m3.2a"><mrow id="S5.SS3.p3.3.m3.2.2.2" xref="S5.SS3.p3.3.m3.2.2.3.cmml"><mo id="S5.SS3.p3.3.m3.2.2.2.3" stretchy="false" xref="S5.SS3.p3.3.m3.2.2.3.cmml">[</mo><msub id="S5.SS3.p3.3.m3.1.1.1.1" xref="S5.SS3.p3.3.m3.1.1.1.1.cmml"><mi id="S5.SS3.p3.3.m3.1.1.1.1.2" xref="S5.SS3.p3.3.m3.1.1.1.1.2.cmml">D</mi><mn id="S5.SS3.p3.3.m3.1.1.1.1.3" xref="S5.SS3.p3.3.m3.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS3.p3.3.m3.2.2.2.4" xref="S5.SS3.p3.3.m3.2.2.3.cmml">,</mo><msub id="S5.SS3.p3.3.m3.2.2.2.2" xref="S5.SS3.p3.3.m3.2.2.2.2.cmml"><mi id="S5.SS3.p3.3.m3.2.2.2.2.2" xref="S5.SS3.p3.3.m3.2.2.2.2.2.cmml">D</mi><mn id="S5.SS3.p3.3.m3.2.2.2.2.3" xref="S5.SS3.p3.3.m3.2.2.2.2.3.cmml">2</mn></msub><mo id="S5.SS3.p3.3.m3.2.2.2.5" stretchy="false" xref="S5.SS3.p3.3.m3.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.3.m3.2b"><interval closure="closed" id="S5.SS3.p3.3.m3.2.2.3.cmml" xref="S5.SS3.p3.3.m3.2.2.2"><apply id="S5.SS3.p3.3.m3.1.1.1.1.cmml" xref="S5.SS3.p3.3.m3.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.3.m3.1.1.1.1.1.cmml" xref="S5.SS3.p3.3.m3.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p3.3.m3.1.1.1.1.2.cmml" xref="S5.SS3.p3.3.m3.1.1.1.1.2">𝐷</ci><cn id="S5.SS3.p3.3.m3.1.1.1.1.3.cmml" type="integer" xref="S5.SS3.p3.3.m3.1.1.1.1.3">1</cn></apply><apply id="S5.SS3.p3.3.m3.2.2.2.2.cmml" xref="S5.SS3.p3.3.m3.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS3.p3.3.m3.2.2.2.2.1.cmml" xref="S5.SS3.p3.3.m3.2.2.2.2">subscript</csymbol><ci id="S5.SS3.p3.3.m3.2.2.2.2.2.cmml" xref="S5.SS3.p3.3.m3.2.2.2.2.2">𝐷</ci><cn id="S5.SS3.p3.3.m3.2.2.2.2.3.cmml" type="integer" xref="S5.SS3.p3.3.m3.2.2.2.2.3">2</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.3.m3.2c">[D_{1},D_{2}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.3.m3.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ]</annotation></semantics></math>, <math alttext="[D_{1},D_{2}]" class="ltx_Math" display="inline" id="S5.SS3.p3.4.m4.2"><semantics id="S5.SS3.p3.4.m4.2a"><mrow id="S5.SS3.p3.4.m4.2.2.2" xref="S5.SS3.p3.4.m4.2.2.3.cmml"><mo id="S5.SS3.p3.4.m4.2.2.2.3" stretchy="false" xref="S5.SS3.p3.4.m4.2.2.3.cmml">[</mo><msub id="S5.SS3.p3.4.m4.1.1.1.1" xref="S5.SS3.p3.4.m4.1.1.1.1.cmml"><mi id="S5.SS3.p3.4.m4.1.1.1.1.2" xref="S5.SS3.p3.4.m4.1.1.1.1.2.cmml">D</mi><mn id="S5.SS3.p3.4.m4.1.1.1.1.3" xref="S5.SS3.p3.4.m4.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS3.p3.4.m4.2.2.2.4" xref="S5.SS3.p3.4.m4.2.2.3.cmml">,</mo><msub id="S5.SS3.p3.4.m4.2.2.2.2" xref="S5.SS3.p3.4.m4.2.2.2.2.cmml"><mi id="S5.SS3.p3.4.m4.2.2.2.2.2" xref="S5.SS3.p3.4.m4.2.2.2.2.2.cmml">D</mi><mn id="S5.SS3.p3.4.m4.2.2.2.2.3" xref="S5.SS3.p3.4.m4.2.2.2.2.3.cmml">2</mn></msub><mo id="S5.SS3.p3.4.m4.2.2.2.5" stretchy="false" xref="S5.SS3.p3.4.m4.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.4.m4.2b"><interval closure="closed" id="S5.SS3.p3.4.m4.2.2.3.cmml" xref="S5.SS3.p3.4.m4.2.2.2"><apply id="S5.SS3.p3.4.m4.1.1.1.1.cmml" xref="S5.SS3.p3.4.m4.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.4.m4.1.1.1.1.1.cmml" xref="S5.SS3.p3.4.m4.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p3.4.m4.1.1.1.1.2.cmml" xref="S5.SS3.p3.4.m4.1.1.1.1.2">𝐷</ci><cn id="S5.SS3.p3.4.m4.1.1.1.1.3.cmml" type="integer" xref="S5.SS3.p3.4.m4.1.1.1.1.3">1</cn></apply><apply id="S5.SS3.p3.4.m4.2.2.2.2.cmml" xref="S5.SS3.p3.4.m4.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS3.p3.4.m4.2.2.2.2.1.cmml" xref="S5.SS3.p3.4.m4.2.2.2.2">subscript</csymbol><ci id="S5.SS3.p3.4.m4.2.2.2.2.2.cmml" xref="S5.SS3.p3.4.m4.2.2.2.2.2">𝐷</ci><cn id="S5.SS3.p3.4.m4.2.2.2.2.3.cmml" type="integer" xref="S5.SS3.p3.4.m4.2.2.2.2.3">2</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.4.m4.2c">[D_{1},D_{2}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.4.m4.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ]</annotation></semantics></math>, and <math alttext="[D_{1},D_{2}]" class="ltx_Math" display="inline" id="S5.SS3.p3.5.m5.2"><semantics id="S5.SS3.p3.5.m5.2a"><mrow id="S5.SS3.p3.5.m5.2.2.2" xref="S5.SS3.p3.5.m5.2.2.3.cmml"><mo id="S5.SS3.p3.5.m5.2.2.2.3" stretchy="false" xref="S5.SS3.p3.5.m5.2.2.3.cmml">[</mo><msub id="S5.SS3.p3.5.m5.1.1.1.1" xref="S5.SS3.p3.5.m5.1.1.1.1.cmml"><mi id="S5.SS3.p3.5.m5.1.1.1.1.2" xref="S5.SS3.p3.5.m5.1.1.1.1.2.cmml">D</mi><mn id="S5.SS3.p3.5.m5.1.1.1.1.3" xref="S5.SS3.p3.5.m5.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS3.p3.5.m5.2.2.2.4" xref="S5.SS3.p3.5.m5.2.2.3.cmml">,</mo><msub id="S5.SS3.p3.5.m5.2.2.2.2" xref="S5.SS3.p3.5.m5.2.2.2.2.cmml"><mi id="S5.SS3.p3.5.m5.2.2.2.2.2" xref="S5.SS3.p3.5.m5.2.2.2.2.2.cmml">D</mi><mn id="S5.SS3.p3.5.m5.2.2.2.2.3" xref="S5.SS3.p3.5.m5.2.2.2.2.3.cmml">2</mn></msub><mo id="S5.SS3.p3.5.m5.2.2.2.5" stretchy="false" xref="S5.SS3.p3.5.m5.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.5.m5.2b"><interval closure="closed" id="S5.SS3.p3.5.m5.2.2.3.cmml" xref="S5.SS3.p3.5.m5.2.2.2"><apply id="S5.SS3.p3.5.m5.1.1.1.1.cmml" xref="S5.SS3.p3.5.m5.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.5.m5.1.1.1.1.1.cmml" xref="S5.SS3.p3.5.m5.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p3.5.m5.1.1.1.1.2.cmml" xref="S5.SS3.p3.5.m5.1.1.1.1.2">𝐷</ci><cn id="S5.SS3.p3.5.m5.1.1.1.1.3.cmml" type="integer" xref="S5.SS3.p3.5.m5.1.1.1.1.3">1</cn></apply><apply id="S5.SS3.p3.5.m5.2.2.2.2.cmml" xref="S5.SS3.p3.5.m5.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS3.p3.5.m5.2.2.2.2.1.cmml" xref="S5.SS3.p3.5.m5.2.2.2.2">subscript</csymbol><ci id="S5.SS3.p3.5.m5.2.2.2.2.2.cmml" xref="S5.SS3.p3.5.m5.2.2.2.2.2">𝐷</ci><cn id="S5.SS3.p3.5.m5.2.2.2.2.3.cmml" type="integer" xref="S5.SS3.p3.5.m5.2.2.2.2.3">2</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.5.m5.2c">[D_{1},D_{2}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.5.m5.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ]</annotation></semantics></math>
in the four stages.
After stage one is finished, RAGCache sends <math alttext="[D_{1},D_{3}]" class="ltx_Math" display="inline" id="S5.SS3.p3.6.m6.2"><semantics id="S5.SS3.p3.6.m6.2a"><mrow id="S5.SS3.p3.6.m6.2.2.2" xref="S5.SS3.p3.6.m6.2.2.3.cmml"><mo id="S5.SS3.p3.6.m6.2.2.2.3" stretchy="false" xref="S5.SS3.p3.6.m6.2.2.3.cmml">[</mo><msub id="S5.SS3.p3.6.m6.1.1.1.1" xref="S5.SS3.p3.6.m6.1.1.1.1.cmml"><mi id="S5.SS3.p3.6.m6.1.1.1.1.2" xref="S5.SS3.p3.6.m6.1.1.1.1.2.cmml">D</mi><mn id="S5.SS3.p3.6.m6.1.1.1.1.3" xref="S5.SS3.p3.6.m6.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS3.p3.6.m6.2.2.2.4" xref="S5.SS3.p3.6.m6.2.2.3.cmml">,</mo><msub id="S5.SS3.p3.6.m6.2.2.2.2" xref="S5.SS3.p3.6.m6.2.2.2.2.cmml"><mi id="S5.SS3.p3.6.m6.2.2.2.2.2" xref="S5.SS3.p3.6.m6.2.2.2.2.2.cmml">D</mi><mn id="S5.SS3.p3.6.m6.2.2.2.2.3" xref="S5.SS3.p3.6.m6.2.2.2.2.3.cmml">3</mn></msub><mo id="S5.SS3.p3.6.m6.2.2.2.5" stretchy="false" xref="S5.SS3.p3.6.m6.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.6.m6.2b"><interval closure="closed" id="S5.SS3.p3.6.m6.2.2.3.cmml" xref="S5.SS3.p3.6.m6.2.2.2"><apply id="S5.SS3.p3.6.m6.1.1.1.1.cmml" xref="S5.SS3.p3.6.m6.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.6.m6.1.1.1.1.1.cmml" xref="S5.SS3.p3.6.m6.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p3.6.m6.1.1.1.1.2.cmml" xref="S5.SS3.p3.6.m6.1.1.1.1.2">𝐷</ci><cn id="S5.SS3.p3.6.m6.1.1.1.1.3.cmml" type="integer" xref="S5.SS3.p3.6.m6.1.1.1.1.3">1</cn></apply><apply id="S5.SS3.p3.6.m6.2.2.2.2.cmml" xref="S5.SS3.p3.6.m6.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS3.p3.6.m6.2.2.2.2.1.cmml" xref="S5.SS3.p3.6.m6.2.2.2.2">subscript</csymbol><ci id="S5.SS3.p3.6.m6.2.2.2.2.2.cmml" xref="S5.SS3.p3.6.m6.2.2.2.2.2">𝐷</ci><cn id="S5.SS3.p3.6.m6.2.2.2.2.3.cmml" type="integer" xref="S5.SS3.p3.6.m6.2.2.2.2.3">3</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.6.m6.2c">[D_{1},D_{3}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.6.m6.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT ]</annotation></semantics></math> to the LLM engine for speculative generation.
When stage two is finished, RAGCache sends <math alttext="[D_{1},D_{2}]" class="ltx_Math" display="inline" id="S5.SS3.p3.7.m7.2"><semantics id="S5.SS3.p3.7.m7.2a"><mrow id="S5.SS3.p3.7.m7.2.2.2" xref="S5.SS3.p3.7.m7.2.2.3.cmml"><mo id="S5.SS3.p3.7.m7.2.2.2.3" stretchy="false" xref="S5.SS3.p3.7.m7.2.2.3.cmml">[</mo><msub id="S5.SS3.p3.7.m7.1.1.1.1" xref="S5.SS3.p3.7.m7.1.1.1.1.cmml"><mi id="S5.SS3.p3.7.m7.1.1.1.1.2" xref="S5.SS3.p3.7.m7.1.1.1.1.2.cmml">D</mi><mn id="S5.SS3.p3.7.m7.1.1.1.1.3" xref="S5.SS3.p3.7.m7.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS3.p3.7.m7.2.2.2.4" xref="S5.SS3.p3.7.m7.2.2.3.cmml">,</mo><msub id="S5.SS3.p3.7.m7.2.2.2.2" xref="S5.SS3.p3.7.m7.2.2.2.2.cmml"><mi id="S5.SS3.p3.7.m7.2.2.2.2.2" xref="S5.SS3.p3.7.m7.2.2.2.2.2.cmml">D</mi><mn id="S5.SS3.p3.7.m7.2.2.2.2.3" xref="S5.SS3.p3.7.m7.2.2.2.2.3.cmml">2</mn></msub><mo id="S5.SS3.p3.7.m7.2.2.2.5" stretchy="false" xref="S5.SS3.p3.7.m7.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.7.m7.2b"><interval closure="closed" id="S5.SS3.p3.7.m7.2.2.3.cmml" xref="S5.SS3.p3.7.m7.2.2.2"><apply id="S5.SS3.p3.7.m7.1.1.1.1.cmml" xref="S5.SS3.p3.7.m7.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.7.m7.1.1.1.1.1.cmml" xref="S5.SS3.p3.7.m7.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p3.7.m7.1.1.1.1.2.cmml" xref="S5.SS3.p3.7.m7.1.1.1.1.2">𝐷</ci><cn id="S5.SS3.p3.7.m7.1.1.1.1.3.cmml" type="integer" xref="S5.SS3.p3.7.m7.1.1.1.1.3">1</cn></apply><apply id="S5.SS3.p3.7.m7.2.2.2.2.cmml" xref="S5.SS3.p3.7.m7.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS3.p3.7.m7.2.2.2.2.1.cmml" xref="S5.SS3.p3.7.m7.2.2.2.2">subscript</csymbol><ci id="S5.SS3.p3.7.m7.2.2.2.2.2.cmml" xref="S5.SS3.p3.7.m7.2.2.2.2.2">𝐷</ci><cn id="S5.SS3.p3.7.m7.2.2.2.2.3.cmml" type="integer" xref="S5.SS3.p3.7.m7.2.2.2.2.3">2</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.7.m7.2c">[D_{1},D_{2}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.7.m7.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ]</annotation></semantics></math> to the LLM engine.
The LLM engine finds that <math alttext="[D_{1},D_{3}]" class="ltx_Math" display="inline" id="S5.SS3.p3.8.m8.2"><semantics id="S5.SS3.p3.8.m8.2a"><mrow id="S5.SS3.p3.8.m8.2.2.2" xref="S5.SS3.p3.8.m8.2.2.3.cmml"><mo id="S5.SS3.p3.8.m8.2.2.2.3" stretchy="false" xref="S5.SS3.p3.8.m8.2.2.3.cmml">[</mo><msub id="S5.SS3.p3.8.m8.1.1.1.1" xref="S5.SS3.p3.8.m8.1.1.1.1.cmml"><mi id="S5.SS3.p3.8.m8.1.1.1.1.2" xref="S5.SS3.p3.8.m8.1.1.1.1.2.cmml">D</mi><mn id="S5.SS3.p3.8.m8.1.1.1.1.3" xref="S5.SS3.p3.8.m8.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS3.p3.8.m8.2.2.2.4" xref="S5.SS3.p3.8.m8.2.2.3.cmml">,</mo><msub id="S5.SS3.p3.8.m8.2.2.2.2" xref="S5.SS3.p3.8.m8.2.2.2.2.cmml"><mi id="S5.SS3.p3.8.m8.2.2.2.2.2" xref="S5.SS3.p3.8.m8.2.2.2.2.2.cmml">D</mi><mn id="S5.SS3.p3.8.m8.2.2.2.2.3" xref="S5.SS3.p3.8.m8.2.2.2.2.3.cmml">3</mn></msub><mo id="S5.SS3.p3.8.m8.2.2.2.5" stretchy="false" xref="S5.SS3.p3.8.m8.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.8.m8.2b"><interval closure="closed" id="S5.SS3.p3.8.m8.2.2.3.cmml" xref="S5.SS3.p3.8.m8.2.2.2"><apply id="S5.SS3.p3.8.m8.1.1.1.1.cmml" xref="S5.SS3.p3.8.m8.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.8.m8.1.1.1.1.1.cmml" xref="S5.SS3.p3.8.m8.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p3.8.m8.1.1.1.1.2.cmml" xref="S5.SS3.p3.8.m8.1.1.1.1.2">𝐷</ci><cn id="S5.SS3.p3.8.m8.1.1.1.1.3.cmml" type="integer" xref="S5.SS3.p3.8.m8.1.1.1.1.3">1</cn></apply><apply id="S5.SS3.p3.8.m8.2.2.2.2.cmml" xref="S5.SS3.p3.8.m8.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS3.p3.8.m8.2.2.2.2.1.cmml" xref="S5.SS3.p3.8.m8.2.2.2.2">subscript</csymbol><ci id="S5.SS3.p3.8.m8.2.2.2.2.2.cmml" xref="S5.SS3.p3.8.m8.2.2.2.2.2">𝐷</ci><cn id="S5.SS3.p3.8.m8.2.2.2.2.3.cmml" type="integer" xref="S5.SS3.p3.8.m8.2.2.2.2.3">3</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.8.m8.2c">[D_{1},D_{3}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.8.m8.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT ]</annotation></semantics></math> are different from <math alttext="[D_{1},D_{2}]" class="ltx_Math" display="inline" id="S5.SS3.p3.9.m9.2"><semantics id="S5.SS3.p3.9.m9.2a"><mrow id="S5.SS3.p3.9.m9.2.2.2" xref="S5.SS3.p3.9.m9.2.2.3.cmml"><mo id="S5.SS3.p3.9.m9.2.2.2.3" stretchy="false" xref="S5.SS3.p3.9.m9.2.2.3.cmml">[</mo><msub id="S5.SS3.p3.9.m9.1.1.1.1" xref="S5.SS3.p3.9.m9.1.1.1.1.cmml"><mi id="S5.SS3.p3.9.m9.1.1.1.1.2" xref="S5.SS3.p3.9.m9.1.1.1.1.2.cmml">D</mi><mn id="S5.SS3.p3.9.m9.1.1.1.1.3" xref="S5.SS3.p3.9.m9.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.SS3.p3.9.m9.2.2.2.4" xref="S5.SS3.p3.9.m9.2.2.3.cmml">,</mo><msub id="S5.SS3.p3.9.m9.2.2.2.2" xref="S5.SS3.p3.9.m9.2.2.2.2.cmml"><mi id="S5.SS3.p3.9.m9.2.2.2.2.2" xref="S5.SS3.p3.9.m9.2.2.2.2.2.cmml">D</mi><mn id="S5.SS3.p3.9.m9.2.2.2.2.3" xref="S5.SS3.p3.9.m9.2.2.2.2.3.cmml">2</mn></msub><mo id="S5.SS3.p3.9.m9.2.2.2.5" stretchy="false" xref="S5.SS3.p3.9.m9.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.9.m9.2b"><interval closure="closed" id="S5.SS3.p3.9.m9.2.2.3.cmml" xref="S5.SS3.p3.9.m9.2.2.2"><apply id="S5.SS3.p3.9.m9.1.1.1.1.cmml" xref="S5.SS3.p3.9.m9.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.9.m9.1.1.1.1.1.cmml" xref="S5.SS3.p3.9.m9.1.1.1.1">subscript</csymbol><ci id="S5.SS3.p3.9.m9.1.1.1.1.2.cmml" xref="S5.SS3.p3.9.m9.1.1.1.1.2">𝐷</ci><cn id="S5.SS3.p3.9.m9.1.1.1.1.3.cmml" type="integer" xref="S5.SS3.p3.9.m9.1.1.1.1.3">1</cn></apply><apply id="S5.SS3.p3.9.m9.2.2.2.2.cmml" xref="S5.SS3.p3.9.m9.2.2.2.2"><csymbol cd="ambiguous" id="S5.SS3.p3.9.m9.2.2.2.2.1.cmml" xref="S5.SS3.p3.9.m9.2.2.2.2">subscript</csymbol><ci id="S5.SS3.p3.9.m9.2.2.2.2.2.cmml" xref="S5.SS3.p3.9.m9.2.2.2.2.2">𝐷</ci><cn id="S5.SS3.p3.9.m9.2.2.2.2.3.cmml" type="integer" xref="S5.SS3.p3.9.m9.2.2.2.2.3">2</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.9.m9.2c">[D_{1},D_{2}]</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.9.m9.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ]</annotation></semantics></math>, and thus terminates the
previous speculative generation and starts a new one.
As for stage three, the LLM engine receives the same documents as stage two, and
thus remains processing the previous generation.
After the final stage, RAGCache sends the final top-<math alttext="2" class="ltx_Math" display="inline" id="S5.SS3.p3.10.m10.1"><semantics id="S5.SS3.p3.10.m10.1a"><mn id="S5.SS3.p3.10.m10.1.1" xref="S5.SS3.p3.10.m10.1.1.cmml">2</mn><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.10.m10.1b"><cn id="S5.SS3.p3.10.m10.1.1.cmml" type="integer" xref="S5.SS3.p3.10.m10.1.1">2</cn></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.10.m10.1c">2</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.10.m10.1d">2</annotation></semantics></math> documents to the LLM engine
which is the same as the latest speculative generation. The LLM engine directly returns the
speculative generation results to users.</p>
</div>
<figure class="ltx_figure" id="S5.F12"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_missing ltx_missing_image" id="S5.F12.g1" src=""/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F12.2.1.1" style="font-size:90%;">Figure 12</span>. </span><span class="ltx_text" id="S5.F12.3.2" style="font-size:90%;">The optimal speculative pipelining strategy in the simplified analysis.</span></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS3.p4">
<p class="ltx_p" id="S5.SS3.p4.1"><span class="ltx_text ltx_font_bold" id="S5.SS3.p4.1.1">Dynamic speculative generation.</span> The speculative pipelining allows RAGCache to overlap the retrieval and generation steps,
which reduces the end-to-end latency of RAG systems. However, it may
introduce extra LLM computation as some speculative generations are incorrect, potentially leading to
performance degradation under high system loads. To address this problem, RAGCache dynamically
enables speculative pipelining based on the system load.
We begin with a simplified analysis to demonstrate how to minimize the end-to-end latency while
keeping the system load under control.</p>
</div>
<div class="ltx_para" id="S5.SS3.p5">
<p class="ltx_p" id="S5.SS3.p5.1">For simplicity, we assume the vector search and the LLM both serve one request at a time.
The vector search produces candidate retrieval results at the end of each stage with a fixed time interval <math alttext="d" class="ltx_Math" display="inline" id="S5.SS3.p5.1.m1.1"><semantics id="S5.SS3.p5.1.m1.1a"><mi id="S5.SS3.p5.1.m1.1.1" xref="S5.SS3.p5.1.m1.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.p5.1.m1.1b"><ci id="S5.SS3.p5.1.m1.1.1.cmml" xref="S5.SS3.p5.1.m1.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p5.1.m1.1c">d</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p5.1.m1.1d">italic_d</annotation></semantics></math>.
Since the batch size is one, we can immediately terminate any incorrect speculative generation request.
We model the LLM engine with a G/G/1 queue <cite class="ltx_cite ltx_citemacro_citep">(Shortle
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib39" title="">2018</a>)</cite>.
Since priority scheduling is widely used in LLM serving (e.g., MLFQ in FastServe <cite class="ltx_cite ltx_citemacro_citep">(Wu
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib46" title="">2023</a>)</cite> and
cache-aware reordering in RAGCache), we assume that the LLM engine can schedule the requests in the queue
with arbitrary order but executes the speculation generation requests from a single request in order.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.F12" title="Figure 12 ‣ 5.3. Dynamic Speculative Pipelining ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">12</span></a> shows the optimal speculative pipelining strategy under this setting,
which we summarize as a theorem below.</p>
</div>
<div class="ltx_theorem ltx_theorem_theorem" id="S5.Thmtheorem1">
<h6 class="ltx_title ltx_runin ltx_font_smallcaps ltx_title_theorem">Theorem 5.1.</h6>
<div class="ltx_para" id="S5.Thmtheorem1.p1">
<p class="ltx_p" id="S5.Thmtheorem1.p1.3"><span class="ltx_text ltx_font_italic" id="S5.Thmtheorem1.p1.3.3">Let <math alttext="d" class="ltx_Math" display="inline" id="S5.Thmtheorem1.p1.1.1.m1.1"><semantics id="S5.Thmtheorem1.p1.1.1.m1.1a"><mi id="S5.Thmtheorem1.p1.1.1.m1.1.1" xref="S5.Thmtheorem1.p1.1.1.m1.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S5.Thmtheorem1.p1.1.1.m1.1b"><ci id="S5.Thmtheorem1.p1.1.1.m1.1.1.cmml" xref="S5.Thmtheorem1.p1.1.1.m1.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.Thmtheorem1.p1.1.1.m1.1c">d</annotation><annotation encoding="application/x-llamapun" id="S5.Thmtheorem1.p1.1.1.m1.1d">italic_d</annotation></semantics></math> be the speculative time interval and <math alttext="T" class="ltx_Math" display="inline" id="S5.Thmtheorem1.p1.2.2.m2.1"><semantics id="S5.Thmtheorem1.p1.2.2.m2.1a"><mi id="S5.Thmtheorem1.p1.2.2.m2.1.1" xref="S5.Thmtheorem1.p1.2.2.m2.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S5.Thmtheorem1.p1.2.2.m2.1b"><ci id="S5.Thmtheorem1.p1.2.2.m2.1.1.cmml" xref="S5.Thmtheorem1.p1.2.2.m2.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.Thmtheorem1.p1.2.2.m2.1c">T</annotation><annotation encoding="application/x-llamapun" id="S5.Thmtheorem1.p1.2.2.m2.1d">italic_T</annotation></semantics></math> be the serving time distribution for the LLM in the G/G/1
request pool, satisfying <math alttext="T\geq d" class="ltx_Math" display="inline" id="S5.Thmtheorem1.p1.3.3.m3.1"><semantics id="S5.Thmtheorem1.p1.3.3.m3.1a"><mrow id="S5.Thmtheorem1.p1.3.3.m3.1.1" xref="S5.Thmtheorem1.p1.3.3.m3.1.1.cmml"><mi id="S5.Thmtheorem1.p1.3.3.m3.1.1.2" xref="S5.Thmtheorem1.p1.3.3.m3.1.1.2.cmml">T</mi><mo id="S5.Thmtheorem1.p1.3.3.m3.1.1.1" xref="S5.Thmtheorem1.p1.3.3.m3.1.1.1.cmml">≥</mo><mi id="S5.Thmtheorem1.p1.3.3.m3.1.1.3" xref="S5.Thmtheorem1.p1.3.3.m3.1.1.3.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.Thmtheorem1.p1.3.3.m3.1b"><apply id="S5.Thmtheorem1.p1.3.3.m3.1.1.cmml" xref="S5.Thmtheorem1.p1.3.3.m3.1.1"><geq id="S5.Thmtheorem1.p1.3.3.m3.1.1.1.cmml" xref="S5.Thmtheorem1.p1.3.3.m3.1.1.1"></geq><ci id="S5.Thmtheorem1.p1.3.3.m3.1.1.2.cmml" xref="S5.Thmtheorem1.p1.3.3.m3.1.1.2">𝑇</ci><ci id="S5.Thmtheorem1.p1.3.3.m3.1.1.3.cmml" xref="S5.Thmtheorem1.p1.3.3.m3.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.Thmtheorem1.p1.3.3.m3.1c">T\geq d</annotation><annotation encoding="application/x-llamapun" id="S5.Thmtheorem1.p1.3.3.m3.1d">italic_T ≥ italic_d</annotation></semantics></math> for all serving events. The optimal strategy
is: start a speculative generation if the request pool is empty after a stage ends with a
different document sequence; if not, continue vector search until the pool empties.</span></p>
</div>
</div>
<div class="ltx_proof" id="S5.SS3.6">
<h6 class="ltx_title ltx_runin ltx_font_italic ltx_title_proof">Proof.</h6>
<div class="ltx_para" id="S5.SS3.1.p1">
<p class="ltx_p" id="S5.SS3.1.p1.2">After the <math alttext="i" class="ltx_Math" display="inline" id="S5.SS3.1.p1.1.m1.1"><semantics id="S5.SS3.1.p1.1.m1.1a"><mi id="S5.SS3.1.p1.1.m1.1.1" xref="S5.SS3.1.p1.1.m1.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S5.SS3.1.p1.1.m1.1b"><ci id="S5.SS3.1.p1.1.m1.1.1.cmml" xref="S5.SS3.1.p1.1.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.1.p1.1.m1.1c">i</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.1.p1.1.m1.1d">italic_i</annotation></semantics></math>-th stage, the vector search produces a
document sequence <math alttext="D_{i}" class="ltx_Math" display="inline" id="S5.SS3.1.p1.2.m2.1"><semantics id="S5.SS3.1.p1.2.m2.1a"><msub id="S5.SS3.1.p1.2.m2.1.1" xref="S5.SS3.1.p1.2.m2.1.1.cmml"><mi id="S5.SS3.1.p1.2.m2.1.1.2" xref="S5.SS3.1.p1.2.m2.1.1.2.cmml">D</mi><mi id="S5.SS3.1.p1.2.m2.1.1.3" xref="S5.SS3.1.p1.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.1.p1.2.m2.1b"><apply id="S5.SS3.1.p1.2.m2.1.1.cmml" xref="S5.SS3.1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS3.1.p1.2.m2.1.1.1.cmml" xref="S5.SS3.1.p1.2.m2.1.1">subscript</csymbol><ci id="S5.SS3.1.p1.2.m2.1.1.2.cmml" xref="S5.SS3.1.p1.2.m2.1.1.2">𝐷</ci><ci id="S5.SS3.1.p1.2.m2.1.1.3.cmml" xref="S5.SS3.1.p1.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.1.p1.2.m2.1c">D_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.1.p1.2.m2.1d">italic_D start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. There are four cases.</p>
</div>
<div class="ltx_para" id="S5.SS3.2.p2">
<p class="ltx_p" id="S5.SS3.2.p2.1">(1) The pool is empty and <math alttext="D_{i}" class="ltx_Math" display="inline" id="S5.SS3.2.p2.1.m1.1"><semantics id="S5.SS3.2.p2.1.m1.1a"><msub id="S5.SS3.2.p2.1.m1.1.1" xref="S5.SS3.2.p2.1.m1.1.1.cmml"><mi id="S5.SS3.2.p2.1.m1.1.1.2" xref="S5.SS3.2.p2.1.m1.1.1.2.cmml">D</mi><mi id="S5.SS3.2.p2.1.m1.1.1.3" xref="S5.SS3.2.p2.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.2.p2.1.m1.1b"><apply id="S5.SS3.2.p2.1.m1.1.1.cmml" xref="S5.SS3.2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS3.2.p2.1.m1.1.1.1.cmml" xref="S5.SS3.2.p2.1.m1.1.1">subscript</csymbol><ci id="S5.SS3.2.p2.1.m1.1.1.2.cmml" xref="S5.SS3.2.p2.1.m1.1.1.2">𝐷</ci><ci id="S5.SS3.2.p2.1.m1.1.1.3.cmml" xref="S5.SS3.2.p2.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.2.p2.1.m1.1c">D_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.2.p2.1.m1.1d">italic_D start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is the final result. In this case, deferring the speculative generation
incurs additional waiting time, while starting the speculative generation immediately utilizes the LLM
generation engine. As a result, starting a speculative generation leads to a lower latency.</p>
</div>
<div class="ltx_para" id="S5.SS3.3.p3">
<p class="ltx_p" id="S5.SS3.3.p3.1">(2) The pool is non-empty and <math alttext="D_{i}" class="ltx_Math" display="inline" id="S5.SS3.3.p3.1.m1.1"><semantics id="S5.SS3.3.p3.1.m1.1a"><msub id="S5.SS3.3.p3.1.m1.1.1" xref="S5.SS3.3.p3.1.m1.1.1.cmml"><mi id="S5.SS3.3.p3.1.m1.1.1.2" xref="S5.SS3.3.p3.1.m1.1.1.2.cmml">D</mi><mi id="S5.SS3.3.p3.1.m1.1.1.3" xref="S5.SS3.3.p3.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.3.p3.1.m1.1b"><apply id="S5.SS3.3.p3.1.m1.1.1.cmml" xref="S5.SS3.3.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS3.3.p3.1.m1.1.1.1.cmml" xref="S5.SS3.3.p3.1.m1.1.1">subscript</csymbol><ci id="S5.SS3.3.p3.1.m1.1.1.2.cmml" xref="S5.SS3.3.p3.1.m1.1.1.2">𝐷</ci><ci id="S5.SS3.3.p3.1.m1.1.1.3.cmml" xref="S5.SS3.3.p3.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.3.p3.1.m1.1c">D_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.3.p3.1.m1.1d">italic_D start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is not the final result. In this case, inserting the speculative
generation may delay the request in the pool due to the reordering policy. Furthermore, computing the
speculative generation is unnecessary. In such case, deferring the speculative generation is more efficient.</p>
</div>
<div class="ltx_para" id="S5.SS3.4.p4">
<p class="ltx_p" id="S5.SS3.4.p4.1">(3) The pool is non-empty and <math alttext="D_{i}" class="ltx_Math" display="inline" id="S5.SS3.4.p4.1.m1.1"><semantics id="S5.SS3.4.p4.1.m1.1a"><msub id="S5.SS3.4.p4.1.m1.1.1" xref="S5.SS3.4.p4.1.m1.1.1.cmml"><mi id="S5.SS3.4.p4.1.m1.1.1.2" xref="S5.SS3.4.p4.1.m1.1.1.2.cmml">D</mi><mi id="S5.SS3.4.p4.1.m1.1.1.3" xref="S5.SS3.4.p4.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.4.p4.1.m1.1b"><apply id="S5.SS3.4.p4.1.m1.1.1.cmml" xref="S5.SS3.4.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS3.4.p4.1.m1.1.1.1.cmml" xref="S5.SS3.4.p4.1.m1.1.1">subscript</csymbol><ci id="S5.SS3.4.p4.1.m1.1.1.2.cmml" xref="S5.SS3.4.p4.1.m1.1.1.2">𝐷</ci><ci id="S5.SS3.4.p4.1.m1.1.1.3.cmml" xref="S5.SS3.4.p4.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.4.p4.1.m1.1c">D_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.4.p4.1.m1.1d">italic_D start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is the final result. In this case, inserting the speculative
generation into the LLM request pool allows the LLM engine scheduler to conduct more efficient scheduling
optimizations. It is more efficient to start the speculative generation immediately.</p>
</div>
<div class="ltx_para" id="S5.SS3.5.p5">
<p class="ltx_p" id="S5.SS3.5.p5.1">(4) The pool is empty and <math alttext="D_{i}" class="ltx_Math" display="inline" id="S5.SS3.5.p5.1.m1.1"><semantics id="S5.SS3.5.p5.1.m1.1a"><msub id="S5.SS3.5.p5.1.m1.1.1" xref="S5.SS3.5.p5.1.m1.1.1.cmml"><mi id="S5.SS3.5.p5.1.m1.1.1.2" xref="S5.SS3.5.p5.1.m1.1.1.2.cmml">D</mi><mi id="S5.SS3.5.p5.1.m1.1.1.3" xref="S5.SS3.5.p5.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS3.5.p5.1.m1.1b"><apply id="S5.SS3.5.p5.1.m1.1.1.cmml" xref="S5.SS3.5.p5.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS3.5.p5.1.m1.1.1.1.cmml" xref="S5.SS3.5.p5.1.m1.1.1">subscript</csymbol><ci id="S5.SS3.5.p5.1.m1.1.1.2.cmml" xref="S5.SS3.5.p5.1.m1.1.1.2">𝐷</ci><ci id="S5.SS3.5.p5.1.m1.1.1.3.cmml" xref="S5.SS3.5.p5.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.5.p5.1.m1.1c">D_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.5.p5.1.m1.1d">italic_D start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is not the final result. The incorrect speculative generation is
terminated immediately upon vector search produces the first differing result. Though the speculative generation is
incorrect, it utilizes only the idle GPU resources. Both deferring and starting the speculative generation
are equally efficient.</p>
</div>
<div class="ltx_para" id="S5.SS3.6.p6">
<p class="ltx_p" id="S5.SS3.6.p6.1">This concludes the proof.
∎</p>
</div>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg2.2.1.1">Algorithm 2</span> </span> Dynamic Speculative Pipelining Strategy</figcaption>
<div class="ltx_listing ltx_listing" id="alg2.3">
<div class="ltx_listingline" id="alg2.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l1.1.1.1" style="font-size:80%;">1:</span></span><span class="ltx_text ltx_font_bold" id="alg2.l1.2" style="font-size:80%;">function</span><span class="ltx_text" id="alg2.l1.3" style="font-size:80%;"> </span><span class="ltx_text ltx_font_smallcaps" id="alg2.l1.4" style="font-size:80%;">DYNAMIC_SPECULATIVE_PIPELINING</span><span class="ltx_text" id="alg2.l1.5" style="font-size:80%;">(</span><math alttext="request" class="ltx_Math" display="inline" id="alg2.l1.m1.1"><semantics id="alg2.l1.m1.1a"><mrow id="alg2.l1.m1.1.1" xref="alg2.l1.m1.1.1.cmml"><mi id="alg2.l1.m1.1.1.2" mathsize="80%" xref="alg2.l1.m1.1.1.2.cmml">r</mi><mo id="alg2.l1.m1.1.1.1" xref="alg2.l1.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l1.m1.1.1.3" mathsize="80%" xref="alg2.l1.m1.1.1.3.cmml">e</mi><mo id="alg2.l1.m1.1.1.1a" xref="alg2.l1.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l1.m1.1.1.4" mathsize="80%" xref="alg2.l1.m1.1.1.4.cmml">q</mi><mo id="alg2.l1.m1.1.1.1b" xref="alg2.l1.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l1.m1.1.1.5" mathsize="80%" xref="alg2.l1.m1.1.1.5.cmml">u</mi><mo id="alg2.l1.m1.1.1.1c" xref="alg2.l1.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l1.m1.1.1.6" mathsize="80%" xref="alg2.l1.m1.1.1.6.cmml">e</mi><mo id="alg2.l1.m1.1.1.1d" xref="alg2.l1.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l1.m1.1.1.7" mathsize="80%" xref="alg2.l1.m1.1.1.7.cmml">s</mi><mo id="alg2.l1.m1.1.1.1e" xref="alg2.l1.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l1.m1.1.1.8" mathsize="80%" xref="alg2.l1.m1.1.1.8.cmml">t</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l1.m1.1b"><apply id="alg2.l1.m1.1.1.cmml" xref="alg2.l1.m1.1.1"><times id="alg2.l1.m1.1.1.1.cmml" xref="alg2.l1.m1.1.1.1"></times><ci id="alg2.l1.m1.1.1.2.cmml" xref="alg2.l1.m1.1.1.2">𝑟</ci><ci id="alg2.l1.m1.1.1.3.cmml" xref="alg2.l1.m1.1.1.3">𝑒</ci><ci id="alg2.l1.m1.1.1.4.cmml" xref="alg2.l1.m1.1.1.4">𝑞</ci><ci id="alg2.l1.m1.1.1.5.cmml" xref="alg2.l1.m1.1.1.5">𝑢</ci><ci id="alg2.l1.m1.1.1.6.cmml" xref="alg2.l1.m1.1.1.6">𝑒</ci><ci id="alg2.l1.m1.1.1.7.cmml" xref="alg2.l1.m1.1.1.7">𝑠</ci><ci id="alg2.l1.m1.1.1.8.cmml" xref="alg2.l1.m1.1.1.8">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l1.m1.1c">request</annotation><annotation encoding="application/x-llamapun" id="alg2.l1.m1.1d">italic_r italic_e italic_q italic_u italic_e italic_s italic_t</annotation></semantics></math><span class="ltx_text" id="alg2.l1.6" style="font-size:80%;">)
</span>
</div>
<div class="ltx_listingline" id="alg2.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l2.1.1.1" style="font-size:80%;">2:</span></span><span class="ltx_text" id="alg2.l2.2" style="font-size:80%;">    </span><math alttext="D\leftarrow[]" class="ltx_Math" display="inline" id="alg2.l2.m1.1"><semantics id="alg2.l2.m1.1a"><mrow id="alg2.l2.m1.1.1" xref="alg2.l2.m1.1.1.cmml"><mi id="alg2.l2.m1.1.1.2" mathsize="80%" xref="alg2.l2.m1.1.1.2.cmml">D</mi><mo id="alg2.l2.m1.1.1.1" mathsize="80%" stretchy="false" xref="alg2.l2.m1.1.1.1.cmml">←</mo><mrow id="alg2.l2.m1.1.1.3.2" xref="alg2.l2.m1.1.1.cmml"><mo id="alg2.l2.m1.1.1.3.2.1" maxsize="80%" minsize="80%" xref="alg2.l2.m1.1.1.3.1.cmml">[</mo><mo id="alg2.l2.m1.1.1.3.2.2" maxsize="80%" minsize="80%" xref="alg2.l2.m1.1.1.3.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l2.m1.1b"><apply id="alg2.l2.m1.1.1.cmml" xref="alg2.l2.m1.1.1"><ci id="alg2.l2.m1.1.1.1.cmml" xref="alg2.l2.m1.1.1.1">←</ci><ci id="alg2.l2.m1.1.1.2.cmml" xref="alg2.l2.m1.1.1.2">𝐷</ci><list id="alg2.l2.m1.1.1.3.1.cmml" xref="alg2.l2.m1.1.1.3.2.1"></list></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l2.m1.1c">D\leftarrow[]</annotation><annotation encoding="application/x-llamapun" id="alg2.l2.m1.1d">italic_D ← [ ]</annotation></semantics></math><span class="ltx_text" id="alg2.l2.3" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg2.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l3.1.1.1" style="font-size:80%;">3:</span></span><span class="ltx_text" id="alg2.l3.2" style="font-size:80%;">    </span><span class="ltx_text ltx_font_bold" id="alg2.l3.3" style="font-size:80%;">while</span><span class="ltx_text" id="alg2.l3.4" style="font-size:80%;"> the vector search of </span><math alttext="request" class="ltx_Math" display="inline" id="alg2.l3.m1.1"><semantics id="alg2.l3.m1.1a"><mrow id="alg2.l3.m1.1.1" xref="alg2.l3.m1.1.1.cmml"><mi id="alg2.l3.m1.1.1.2" mathsize="80%" xref="alg2.l3.m1.1.1.2.cmml">r</mi><mo id="alg2.l3.m1.1.1.1" xref="alg2.l3.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l3.m1.1.1.3" mathsize="80%" xref="alg2.l3.m1.1.1.3.cmml">e</mi><mo id="alg2.l3.m1.1.1.1a" xref="alg2.l3.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l3.m1.1.1.4" mathsize="80%" xref="alg2.l3.m1.1.1.4.cmml">q</mi><mo id="alg2.l3.m1.1.1.1b" xref="alg2.l3.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l3.m1.1.1.5" mathsize="80%" xref="alg2.l3.m1.1.1.5.cmml">u</mi><mo id="alg2.l3.m1.1.1.1c" xref="alg2.l3.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l3.m1.1.1.6" mathsize="80%" xref="alg2.l3.m1.1.1.6.cmml">e</mi><mo id="alg2.l3.m1.1.1.1d" xref="alg2.l3.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l3.m1.1.1.7" mathsize="80%" xref="alg2.l3.m1.1.1.7.cmml">s</mi><mo id="alg2.l3.m1.1.1.1e" xref="alg2.l3.m1.1.1.1.cmml">⁢</mo><mi id="alg2.l3.m1.1.1.8" mathsize="80%" xref="alg2.l3.m1.1.1.8.cmml">t</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l3.m1.1b"><apply id="alg2.l3.m1.1.1.cmml" xref="alg2.l3.m1.1.1"><times id="alg2.l3.m1.1.1.1.cmml" xref="alg2.l3.m1.1.1.1"></times><ci id="alg2.l3.m1.1.1.2.cmml" xref="alg2.l3.m1.1.1.2">𝑟</ci><ci id="alg2.l3.m1.1.1.3.cmml" xref="alg2.l3.m1.1.1.3">𝑒</ci><ci id="alg2.l3.m1.1.1.4.cmml" xref="alg2.l3.m1.1.1.4">𝑞</ci><ci id="alg2.l3.m1.1.1.5.cmml" xref="alg2.l3.m1.1.1.5">𝑢</ci><ci id="alg2.l3.m1.1.1.6.cmml" xref="alg2.l3.m1.1.1.6">𝑒</ci><ci id="alg2.l3.m1.1.1.7.cmml" xref="alg2.l3.m1.1.1.7">𝑠</ci><ci id="alg2.l3.m1.1.1.8.cmml" xref="alg2.l3.m1.1.1.8">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l3.m1.1c">request</annotation><annotation encoding="application/x-llamapun" id="alg2.l3.m1.1d">italic_r italic_e italic_q italic_u italic_e italic_s italic_t</annotation></semantics></math><span class="ltx_text" id="alg2.l3.5" style="font-size:80%;"> is not finished </span><span class="ltx_text ltx_font_bold" id="alg2.l3.6" style="font-size:80%;">do</span><span class="ltx_text" id="alg2.l3.7" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg2.l4">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l4.1.1.1" style="font-size:80%;">4:</span></span><span class="ltx_text" id="alg2.l4.2" style="font-size:80%;">        </span><span class="ltx_text ltx_font_bold" id="alg2.l4.3" style="font-size:80%;">// Produce the candidate documents at the next stage</span><span class="ltx_text" id="alg2.l4.4" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg2.l5">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l5.1.1.1" style="font-size:80%;">5:</span></span><span class="ltx_text" id="alg2.l5.2" style="font-size:80%;">        </span><math alttext="D_{temp}\leftarrow" class="ltx_Math" display="inline" id="alg2.l5.m1.1"><semantics id="alg2.l5.m1.1a"><mrow id="alg2.l5.m1.1.1" xref="alg2.l5.m1.1.1.cmml"><msub id="alg2.l5.m1.1.1.2" xref="alg2.l5.m1.1.1.2.cmml"><mi id="alg2.l5.m1.1.1.2.2" mathsize="80%" xref="alg2.l5.m1.1.1.2.2.cmml">D</mi><mrow id="alg2.l5.m1.1.1.2.3" xref="alg2.l5.m1.1.1.2.3.cmml"><mi id="alg2.l5.m1.1.1.2.3.2" mathsize="80%" xref="alg2.l5.m1.1.1.2.3.2.cmml">t</mi><mo id="alg2.l5.m1.1.1.2.3.1" xref="alg2.l5.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg2.l5.m1.1.1.2.3.3" mathsize="80%" xref="alg2.l5.m1.1.1.2.3.3.cmml">e</mi><mo id="alg2.l5.m1.1.1.2.3.1a" xref="alg2.l5.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg2.l5.m1.1.1.2.3.4" mathsize="80%" xref="alg2.l5.m1.1.1.2.3.4.cmml">m</mi><mo id="alg2.l5.m1.1.1.2.3.1b" xref="alg2.l5.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg2.l5.m1.1.1.2.3.5" mathsize="80%" xref="alg2.l5.m1.1.1.2.3.5.cmml">p</mi></mrow></msub><mo id="alg2.l5.m1.1.1.1" mathsize="80%" stretchy="false" xref="alg2.l5.m1.1.1.1.cmml">←</mo><mi id="alg2.l5.m1.1.1.3" xref="alg2.l5.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l5.m1.1b"><apply id="alg2.l5.m1.1.1.cmml" xref="alg2.l5.m1.1.1"><ci id="alg2.l5.m1.1.1.1.cmml" xref="alg2.l5.m1.1.1.1">←</ci><apply id="alg2.l5.m1.1.1.2.cmml" xref="alg2.l5.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.l5.m1.1.1.2.1.cmml" xref="alg2.l5.m1.1.1.2">subscript</csymbol><ci id="alg2.l5.m1.1.1.2.2.cmml" xref="alg2.l5.m1.1.1.2.2">𝐷</ci><apply id="alg2.l5.m1.1.1.2.3.cmml" xref="alg2.l5.m1.1.1.2.3"><times id="alg2.l5.m1.1.1.2.3.1.cmml" xref="alg2.l5.m1.1.1.2.3.1"></times><ci id="alg2.l5.m1.1.1.2.3.2.cmml" xref="alg2.l5.m1.1.1.2.3.2">𝑡</ci><ci id="alg2.l5.m1.1.1.2.3.3.cmml" xref="alg2.l5.m1.1.1.2.3.3">𝑒</ci><ci id="alg2.l5.m1.1.1.2.3.4.cmml" xref="alg2.l5.m1.1.1.2.3.4">𝑚</ci><ci id="alg2.l5.m1.1.1.2.3.5.cmml" xref="alg2.l5.m1.1.1.2.3.5">𝑝</ci></apply></apply><csymbol cd="latexml" id="alg2.l5.m1.1.1.3.cmml" xref="alg2.l5.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l5.m1.1c">D_{temp}\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg2.l5.m1.1d">italic_D start_POSTSUBSCRIPT italic_t italic_e italic_m italic_p end_POSTSUBSCRIPT ←</annotation></semantics></math><span class="ltx_text" id="alg2.l5.3" style="font-size:80%;"> </span><span class="ltx_text ltx_font_smallcaps" id="alg2.l5.4" style="font-size:80%;">VECTOR_SEARCH</span><span class="ltx_text" id="alg2.l5.5" style="font-size:80%;">(</span><math alttext="request" class="ltx_Math" display="inline" id="alg2.l5.m2.1"><semantics id="alg2.l5.m2.1a"><mrow id="alg2.l5.m2.1.1" xref="alg2.l5.m2.1.1.cmml"><mi id="alg2.l5.m2.1.1.2" mathsize="80%" xref="alg2.l5.m2.1.1.2.cmml">r</mi><mo id="alg2.l5.m2.1.1.1" xref="alg2.l5.m2.1.1.1.cmml">⁢</mo><mi id="alg2.l5.m2.1.1.3" mathsize="80%" xref="alg2.l5.m2.1.1.3.cmml">e</mi><mo id="alg2.l5.m2.1.1.1a" xref="alg2.l5.m2.1.1.1.cmml">⁢</mo><mi id="alg2.l5.m2.1.1.4" mathsize="80%" xref="alg2.l5.m2.1.1.4.cmml">q</mi><mo id="alg2.l5.m2.1.1.1b" xref="alg2.l5.m2.1.1.1.cmml">⁢</mo><mi id="alg2.l5.m2.1.1.5" mathsize="80%" xref="alg2.l5.m2.1.1.5.cmml">u</mi><mo id="alg2.l5.m2.1.1.1c" xref="alg2.l5.m2.1.1.1.cmml">⁢</mo><mi id="alg2.l5.m2.1.1.6" mathsize="80%" xref="alg2.l5.m2.1.1.6.cmml">e</mi><mo id="alg2.l5.m2.1.1.1d" xref="alg2.l5.m2.1.1.1.cmml">⁢</mo><mi id="alg2.l5.m2.1.1.7" mathsize="80%" xref="alg2.l5.m2.1.1.7.cmml">s</mi><mo id="alg2.l5.m2.1.1.1e" xref="alg2.l5.m2.1.1.1.cmml">⁢</mo><mi id="alg2.l5.m2.1.1.8" mathsize="80%" xref="alg2.l5.m2.1.1.8.cmml">t</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l5.m2.1b"><apply id="alg2.l5.m2.1.1.cmml" xref="alg2.l5.m2.1.1"><times id="alg2.l5.m2.1.1.1.cmml" xref="alg2.l5.m2.1.1.1"></times><ci id="alg2.l5.m2.1.1.2.cmml" xref="alg2.l5.m2.1.1.2">𝑟</ci><ci id="alg2.l5.m2.1.1.3.cmml" xref="alg2.l5.m2.1.1.3">𝑒</ci><ci id="alg2.l5.m2.1.1.4.cmml" xref="alg2.l5.m2.1.1.4">𝑞</ci><ci id="alg2.l5.m2.1.1.5.cmml" xref="alg2.l5.m2.1.1.5">𝑢</ci><ci id="alg2.l5.m2.1.1.6.cmml" xref="alg2.l5.m2.1.1.6">𝑒</ci><ci id="alg2.l5.m2.1.1.7.cmml" xref="alg2.l5.m2.1.1.7">𝑠</ci><ci id="alg2.l5.m2.1.1.8.cmml" xref="alg2.l5.m2.1.1.8">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l5.m2.1c">request</annotation><annotation encoding="application/x-llamapun" id="alg2.l5.m2.1d">italic_r italic_e italic_q italic_u italic_e italic_s italic_t</annotation></semantics></math><span class="ltx_text" id="alg2.l5.6" style="font-size:80%;">, </span><math alttext="D" class="ltx_Math" display="inline" id="alg2.l5.m3.1"><semantics id="alg2.l5.m3.1a"><mi id="alg2.l5.m3.1.1" mathsize="80%" xref="alg2.l5.m3.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="alg2.l5.m3.1b"><ci id="alg2.l5.m3.1.1.cmml" xref="alg2.l5.m3.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l5.m3.1c">D</annotation><annotation encoding="application/x-llamapun" id="alg2.l5.m3.1d">italic_D</annotation></semantics></math><span class="ltx_text" id="alg2.l5.7" style="font-size:80%;">)
</span>
</div>
<div class="ltx_listingline" id="alg2.l6">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l6.1.1.1" style="font-size:80%;">6:</span></span><span class="ltx_text" id="alg2.l6.2" style="font-size:80%;">        </span><span class="ltx_text ltx_font_bold" id="alg2.l6.3" style="font-size:80%;">if</span><span class="ltx_text" id="alg2.l6.4" style="font-size:80%;"> </span><math alttext="D_{temp}\neq D" class="ltx_Math" display="inline" id="alg2.l6.m1.1"><semantics id="alg2.l6.m1.1a"><mrow id="alg2.l6.m1.1.1" xref="alg2.l6.m1.1.1.cmml"><msub id="alg2.l6.m1.1.1.2" xref="alg2.l6.m1.1.1.2.cmml"><mi id="alg2.l6.m1.1.1.2.2" mathsize="80%" xref="alg2.l6.m1.1.1.2.2.cmml">D</mi><mrow id="alg2.l6.m1.1.1.2.3" xref="alg2.l6.m1.1.1.2.3.cmml"><mi id="alg2.l6.m1.1.1.2.3.2" mathsize="80%" xref="alg2.l6.m1.1.1.2.3.2.cmml">t</mi><mo id="alg2.l6.m1.1.1.2.3.1" xref="alg2.l6.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg2.l6.m1.1.1.2.3.3" mathsize="80%" xref="alg2.l6.m1.1.1.2.3.3.cmml">e</mi><mo id="alg2.l6.m1.1.1.2.3.1a" xref="alg2.l6.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg2.l6.m1.1.1.2.3.4" mathsize="80%" xref="alg2.l6.m1.1.1.2.3.4.cmml">m</mi><mo id="alg2.l6.m1.1.1.2.3.1b" xref="alg2.l6.m1.1.1.2.3.1.cmml">⁢</mo><mi id="alg2.l6.m1.1.1.2.3.5" mathsize="80%" xref="alg2.l6.m1.1.1.2.3.5.cmml">p</mi></mrow></msub><mo id="alg2.l6.m1.1.1.1" mathsize="80%" xref="alg2.l6.m1.1.1.1.cmml">≠</mo><mi id="alg2.l6.m1.1.1.3" mathsize="80%" xref="alg2.l6.m1.1.1.3.cmml">D</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l6.m1.1b"><apply id="alg2.l6.m1.1.1.cmml" xref="alg2.l6.m1.1.1"><neq id="alg2.l6.m1.1.1.1.cmml" xref="alg2.l6.m1.1.1.1"></neq><apply id="alg2.l6.m1.1.1.2.cmml" xref="alg2.l6.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.l6.m1.1.1.2.1.cmml" xref="alg2.l6.m1.1.1.2">subscript</csymbol><ci id="alg2.l6.m1.1.1.2.2.cmml" xref="alg2.l6.m1.1.1.2.2">𝐷</ci><apply id="alg2.l6.m1.1.1.2.3.cmml" xref="alg2.l6.m1.1.1.2.3"><times id="alg2.l6.m1.1.1.2.3.1.cmml" xref="alg2.l6.m1.1.1.2.3.1"></times><ci id="alg2.l6.m1.1.1.2.3.2.cmml" xref="alg2.l6.m1.1.1.2.3.2">𝑡</ci><ci id="alg2.l6.m1.1.1.2.3.3.cmml" xref="alg2.l6.m1.1.1.2.3.3">𝑒</ci><ci id="alg2.l6.m1.1.1.2.3.4.cmml" xref="alg2.l6.m1.1.1.2.3.4">𝑚</ci><ci id="alg2.l6.m1.1.1.2.3.5.cmml" xref="alg2.l6.m1.1.1.2.3.5">𝑝</ci></apply></apply><ci id="alg2.l6.m1.1.1.3.cmml" xref="alg2.l6.m1.1.1.3">𝐷</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l6.m1.1c">D_{temp}\neq D</annotation><annotation encoding="application/x-llamapun" id="alg2.l6.m1.1d">italic_D start_POSTSUBSCRIPT italic_t italic_e italic_m italic_p end_POSTSUBSCRIPT ≠ italic_D</annotation></semantics></math><span class="ltx_text" id="alg2.l6.5" style="font-size:80%;"> </span><span class="ltx_text ltx_font_bold" id="alg2.l6.6" style="font-size:80%;">then</span><span class="ltx_text" id="alg2.l6.7" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg2.l7">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l7.1.1.1" style="font-size:80%;">7:</span></span><span class="ltx_text" id="alg2.l7.2" style="font-size:80%;">           </span><span class="ltx_text ltx_font_bold" id="alg2.l7.3" style="font-size:80%;">if</span><span class="ltx_text" id="alg2.l7.4" style="font-size:80%;"> </span><math alttext="\{request,D\}" class="ltx_Math" display="inline" id="alg2.l7.m1.2"><semantics id="alg2.l7.m1.2a"><mrow id="alg2.l7.m1.2.2.1" xref="alg2.l7.m1.2.2.2.cmml"><mo id="alg2.l7.m1.2.2.1.2" maxsize="80%" minsize="80%" xref="alg2.l7.m1.2.2.2.cmml">{</mo><mrow id="alg2.l7.m1.2.2.1.1" xref="alg2.l7.m1.2.2.1.1.cmml"><mi id="alg2.l7.m1.2.2.1.1.2" mathsize="80%" xref="alg2.l7.m1.2.2.1.1.2.cmml">r</mi><mo id="alg2.l7.m1.2.2.1.1.1" xref="alg2.l7.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l7.m1.2.2.1.1.3" mathsize="80%" xref="alg2.l7.m1.2.2.1.1.3.cmml">e</mi><mo id="alg2.l7.m1.2.2.1.1.1a" xref="alg2.l7.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l7.m1.2.2.1.1.4" mathsize="80%" xref="alg2.l7.m1.2.2.1.1.4.cmml">q</mi><mo id="alg2.l7.m1.2.2.1.1.1b" xref="alg2.l7.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l7.m1.2.2.1.1.5" mathsize="80%" xref="alg2.l7.m1.2.2.1.1.5.cmml">u</mi><mo id="alg2.l7.m1.2.2.1.1.1c" xref="alg2.l7.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l7.m1.2.2.1.1.6" mathsize="80%" xref="alg2.l7.m1.2.2.1.1.6.cmml">e</mi><mo id="alg2.l7.m1.2.2.1.1.1d" xref="alg2.l7.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l7.m1.2.2.1.1.7" mathsize="80%" xref="alg2.l7.m1.2.2.1.1.7.cmml">s</mi><mo id="alg2.l7.m1.2.2.1.1.1e" xref="alg2.l7.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l7.m1.2.2.1.1.8" mathsize="80%" xref="alg2.l7.m1.2.2.1.1.8.cmml">t</mi></mrow><mo id="alg2.l7.m1.2.2.1.3" mathsize="80%" xref="alg2.l7.m1.2.2.2.cmml">,</mo><mi id="alg2.l7.m1.1.1" mathsize="80%" xref="alg2.l7.m1.1.1.cmml">D</mi><mo id="alg2.l7.m1.2.2.1.4" maxsize="80%" minsize="80%" xref="alg2.l7.m1.2.2.2.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="alg2.l7.m1.2b"><set id="alg2.l7.m1.2.2.2.cmml" xref="alg2.l7.m1.2.2.1"><apply id="alg2.l7.m1.2.2.1.1.cmml" xref="alg2.l7.m1.2.2.1.1"><times id="alg2.l7.m1.2.2.1.1.1.cmml" xref="alg2.l7.m1.2.2.1.1.1"></times><ci id="alg2.l7.m1.2.2.1.1.2.cmml" xref="alg2.l7.m1.2.2.1.1.2">𝑟</ci><ci id="alg2.l7.m1.2.2.1.1.3.cmml" xref="alg2.l7.m1.2.2.1.1.3">𝑒</ci><ci id="alg2.l7.m1.2.2.1.1.4.cmml" xref="alg2.l7.m1.2.2.1.1.4">𝑞</ci><ci id="alg2.l7.m1.2.2.1.1.5.cmml" xref="alg2.l7.m1.2.2.1.1.5">𝑢</ci><ci id="alg2.l7.m1.2.2.1.1.6.cmml" xref="alg2.l7.m1.2.2.1.1.6">𝑒</ci><ci id="alg2.l7.m1.2.2.1.1.7.cmml" xref="alg2.l7.m1.2.2.1.1.7">𝑠</ci><ci id="alg2.l7.m1.2.2.1.1.8.cmml" xref="alg2.l7.m1.2.2.1.1.8">𝑡</ci></apply><ci id="alg2.l7.m1.1.1.cmml" xref="alg2.l7.m1.1.1">𝐷</ci></set></annotation-xml><annotation encoding="application/x-tex" id="alg2.l7.m1.2c">\{request,D\}</annotation><annotation encoding="application/x-llamapun" id="alg2.l7.m1.2d">{ italic_r italic_e italic_q italic_u italic_e italic_s italic_t , italic_D }</annotation></semantics></math><span class="ltx_text" id="alg2.l7.5" style="font-size:80%;"> in </span><math alttext="pool" class="ltx_Math" display="inline" id="alg2.l7.m2.1"><semantics id="alg2.l7.m2.1a"><mrow id="alg2.l7.m2.1.1" xref="alg2.l7.m2.1.1.cmml"><mi id="alg2.l7.m2.1.1.2" mathsize="80%" xref="alg2.l7.m2.1.1.2.cmml">p</mi><mo id="alg2.l7.m2.1.1.1" xref="alg2.l7.m2.1.1.1.cmml">⁢</mo><mi id="alg2.l7.m2.1.1.3" mathsize="80%" xref="alg2.l7.m2.1.1.3.cmml">o</mi><mo id="alg2.l7.m2.1.1.1a" xref="alg2.l7.m2.1.1.1.cmml">⁢</mo><mi id="alg2.l7.m2.1.1.4" mathsize="80%" xref="alg2.l7.m2.1.1.4.cmml">o</mi><mo id="alg2.l7.m2.1.1.1b" xref="alg2.l7.m2.1.1.1.cmml">⁢</mo><mi id="alg2.l7.m2.1.1.5" mathsize="80%" xref="alg2.l7.m2.1.1.5.cmml">l</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.l7.m2.1b"><apply id="alg2.l7.m2.1.1.cmml" xref="alg2.l7.m2.1.1"><times id="alg2.l7.m2.1.1.1.cmml" xref="alg2.l7.m2.1.1.1"></times><ci id="alg2.l7.m2.1.1.2.cmml" xref="alg2.l7.m2.1.1.2">𝑝</ci><ci id="alg2.l7.m2.1.1.3.cmml" xref="alg2.l7.m2.1.1.3">𝑜</ci><ci id="alg2.l7.m2.1.1.4.cmml" xref="alg2.l7.m2.1.1.4">𝑜</ci><ci id="alg2.l7.m2.1.1.5.cmml" xref="alg2.l7.m2.1.1.5">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l7.m2.1c">pool</annotation><annotation encoding="application/x-llamapun" id="alg2.l7.m2.1d">italic_p italic_o italic_o italic_l</annotation></semantics></math><span class="ltx_text" id="alg2.l7.6" style="font-size:80%;"> </span><span class="ltx_text ltx_font_bold" id="alg2.l7.7" style="font-size:80%;">then</span><span class="ltx_text" id="alg2.l7.8" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg2.l8">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l8.1.1.1" style="font-size:80%;">8:</span></span><span class="ltx_text" id="alg2.l8.2" style="font-size:80%;">               Terminate </span><math alttext="\{request,D\}" class="ltx_Math" display="inline" id="alg2.l8.m1.2"><semantics id="alg2.l8.m1.2a"><mrow id="alg2.l8.m1.2.2.1" xref="alg2.l8.m1.2.2.2.cmml"><mo id="alg2.l8.m1.2.2.1.2" maxsize="80%" minsize="80%" xref="alg2.l8.m1.2.2.2.cmml">{</mo><mrow id="alg2.l8.m1.2.2.1.1" xref="alg2.l8.m1.2.2.1.1.cmml"><mi id="alg2.l8.m1.2.2.1.1.2" mathsize="80%" xref="alg2.l8.m1.2.2.1.1.2.cmml">r</mi><mo id="alg2.l8.m1.2.2.1.1.1" xref="alg2.l8.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l8.m1.2.2.1.1.3" mathsize="80%" xref="alg2.l8.m1.2.2.1.1.3.cmml">e</mi><mo id="alg2.l8.m1.2.2.1.1.1a" xref="alg2.l8.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l8.m1.2.2.1.1.4" mathsize="80%" xref="alg2.l8.m1.2.2.1.1.4.cmml">q</mi><mo id="alg2.l8.m1.2.2.1.1.1b" xref="alg2.l8.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l8.m1.2.2.1.1.5" mathsize="80%" xref="alg2.l8.m1.2.2.1.1.5.cmml">u</mi><mo id="alg2.l8.m1.2.2.1.1.1c" xref="alg2.l8.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l8.m1.2.2.1.1.6" mathsize="80%" xref="alg2.l8.m1.2.2.1.1.6.cmml">e</mi><mo id="alg2.l8.m1.2.2.1.1.1d" xref="alg2.l8.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l8.m1.2.2.1.1.7" mathsize="80%" xref="alg2.l8.m1.2.2.1.1.7.cmml">s</mi><mo id="alg2.l8.m1.2.2.1.1.1e" xref="alg2.l8.m1.2.2.1.1.1.cmml">⁢</mo><mi id="alg2.l8.m1.2.2.1.1.8" mathsize="80%" xref="alg2.l8.m1.2.2.1.1.8.cmml">t</mi></mrow><mo id="alg2.l8.m1.2.2.1.3" mathsize="80%" xref="alg2.l8.m1.2.2.2.cmml">,</mo><mi id="alg2.l8.m1.1.1" mathsize="80%" xref="alg2.l8.m1.1.1.cmml">D</mi><mo id="alg2.l8.m1.2.2.1.4" maxsize="80%" minsize="80%" xref="alg2.l8.m1.2.2.2.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="alg2.l8.m1.2b"><set id="alg2.l8.m1.2.2.2.cmml" xref="alg2.l8.m1.2.2.1"><apply id="alg2.l8.m1.2.2.1.1.cmml" xref="alg2.l8.m1.2.2.1.1"><times id="alg2.l8.m1.2.2.1.1.1.cmml" xref="alg2.l8.m1.2.2.1.1.1"></times><ci id="alg2.l8.m1.2.2.1.1.2.cmml" xref="alg2.l8.m1.2.2.1.1.2">𝑟</ci><ci id="alg2.l8.m1.2.2.1.1.3.cmml" xref="alg2.l8.m1.2.2.1.1.3">𝑒</ci><ci id="alg2.l8.m1.2.2.1.1.4.cmml" xref="alg2.l8.m1.2.2.1.1.4">𝑞</ci><ci id="alg2.l8.m1.2.2.1.1.5.cmml" xref="alg2.l8.m1.2.2.1.1.5">𝑢</ci><ci id="alg2.l8.m1.2.2.1.1.6.cmml" xref="alg2.l8.m1.2.2.1.1.6">𝑒</ci><ci id="alg2.l8.m1.2.2.1.1.7.cmml" xref="alg2.l8.m1.2.2.1.1.7">𝑠</ci><ci id="alg2.l8.m1.2.2.1.1.8.cmml" xref="alg2.l8.m1.2.2.1.1.8">𝑡</ci></apply><ci id="alg2.l8.m1.1.1.cmml" xref="alg2.l8.m1.1.1">𝐷</ci></set></annotation-xml><annotation encoding="application/x-tex" id="alg2.l8.m1.2c">\{request,D\}</annotation><annotation encoding="application/x-llamapun" id="alg2.l8.m1.2d">{ italic_r italic_e italic_q italic_u italic_e italic_s italic_t , italic_D }</annotation></semantics></math><span class="ltx_text" id="alg2.l8.3" style="font-size:80%;"> after the current iteration
           </span>
</div>
<div class="ltx_listingline" id="alg2.l9">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l9.1.1.1" style="font-size:80%;">9:</span></span><span class="ltx_text" id="alg2.l9.2" style="font-size:80%;">           </span><span class="ltx_text ltx_font_bold" id="alg2.l9.3" style="font-size:80%;">if</span><span class="ltx_text" id="alg2.l9.4" style="font-size:80%;"> </span><math alttext="pool.size&lt;max\_prefill\_bs" class="ltx_Math" display="inline" id="alg2.l9.m1.2"><semantics id="alg2.l9.m1.2a"><mrow id="alg2.l9.m1.2.2.2" xref="alg2.l9.m1.2.2.3.cmml"><mrow id="alg2.l9.m1.1.1.1.1" xref="alg2.l9.m1.1.1.1.1.cmml"><mi id="alg2.l9.m1.1.1.1.1.2" mathsize="80%" xref="alg2.l9.m1.1.1.1.1.2.cmml">p</mi><mo id="alg2.l9.m1.1.1.1.1.1" xref="alg2.l9.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l9.m1.1.1.1.1.3" mathsize="80%" xref="alg2.l9.m1.1.1.1.1.3.cmml">o</mi><mo id="alg2.l9.m1.1.1.1.1.1a" xref="alg2.l9.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l9.m1.1.1.1.1.4" mathsize="80%" xref="alg2.l9.m1.1.1.1.1.4.cmml">o</mi><mo id="alg2.l9.m1.1.1.1.1.1b" xref="alg2.l9.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l9.m1.1.1.1.1.5" mathsize="80%" xref="alg2.l9.m1.1.1.1.1.5.cmml">l</mi></mrow><mo id="alg2.l9.m1.2.2.2.3" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg2.l9.m1.2.2.3a.cmml">.</mo><mrow id="alg2.l9.m1.2.2.2.2" xref="alg2.l9.m1.2.2.2.2.cmml"><mrow id="alg2.l9.m1.2.2.2.2.2" xref="alg2.l9.m1.2.2.2.2.2.cmml"><mi id="alg2.l9.m1.2.2.2.2.2.2" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.2.2.cmml">s</mi><mo id="alg2.l9.m1.2.2.2.2.2.1" xref="alg2.l9.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.2.3" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.2.3.cmml">i</mi><mo id="alg2.l9.m1.2.2.2.2.2.1a" xref="alg2.l9.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.2.4" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.2.4.cmml">z</mi><mo id="alg2.l9.m1.2.2.2.2.2.1b" xref="alg2.l9.m1.2.2.2.2.2.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.2.5" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.2.5.cmml">e</mi></mrow><mo id="alg2.l9.m1.2.2.2.2.1" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.1.cmml">&lt;</mo><mrow id="alg2.l9.m1.2.2.2.2.3" xref="alg2.l9.m1.2.2.2.2.3.cmml"><mi id="alg2.l9.m1.2.2.2.2.3.2" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.2.cmml">m</mi><mo id="alg2.l9.m1.2.2.2.2.3.1" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.3" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.3.cmml">a</mi><mo id="alg2.l9.m1.2.2.2.2.3.1a" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.4" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.4.cmml">x</mi><mo id="alg2.l9.m1.2.2.2.2.3.1b" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.5" mathsize="80%" mathvariant="normal" xref="alg2.l9.m1.2.2.2.2.3.5.cmml">_</mi><mo id="alg2.l9.m1.2.2.2.2.3.1c" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.6" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.6.cmml">p</mi><mo id="alg2.l9.m1.2.2.2.2.3.1d" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.7" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.7.cmml">r</mi><mo id="alg2.l9.m1.2.2.2.2.3.1e" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.8" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.8.cmml">e</mi><mo id="alg2.l9.m1.2.2.2.2.3.1f" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.9" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.9.cmml">f</mi><mo id="alg2.l9.m1.2.2.2.2.3.1g" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.10" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.10.cmml">i</mi><mo id="alg2.l9.m1.2.2.2.2.3.1h" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.11" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.11.cmml">l</mi><mo id="alg2.l9.m1.2.2.2.2.3.1i" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.12" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.12.cmml">l</mi><mo id="alg2.l9.m1.2.2.2.2.3.1j" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.13" mathsize="80%" mathvariant="normal" xref="alg2.l9.m1.2.2.2.2.3.13.cmml">_</mi><mo id="alg2.l9.m1.2.2.2.2.3.1k" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.14" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.14.cmml">b</mi><mo id="alg2.l9.m1.2.2.2.2.3.1l" xref="alg2.l9.m1.2.2.2.2.3.1.cmml">⁢</mo><mi id="alg2.l9.m1.2.2.2.2.3.15" mathsize="80%" xref="alg2.l9.m1.2.2.2.2.3.15.cmml">s</mi></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l9.m1.2b"><apply id="alg2.l9.m1.2.2.3.cmml" xref="alg2.l9.m1.2.2.2"><csymbol cd="ambiguous" id="alg2.l9.m1.2.2.3a.cmml" xref="alg2.l9.m1.2.2.2.3">formulae-sequence</csymbol><apply id="alg2.l9.m1.1.1.1.1.cmml" xref="alg2.l9.m1.1.1.1.1"><times id="alg2.l9.m1.1.1.1.1.1.cmml" xref="alg2.l9.m1.1.1.1.1.1"></times><ci id="alg2.l9.m1.1.1.1.1.2.cmml" xref="alg2.l9.m1.1.1.1.1.2">𝑝</ci><ci id="alg2.l9.m1.1.1.1.1.3.cmml" xref="alg2.l9.m1.1.1.1.1.3">𝑜</ci><ci id="alg2.l9.m1.1.1.1.1.4.cmml" xref="alg2.l9.m1.1.1.1.1.4">𝑜</ci><ci id="alg2.l9.m1.1.1.1.1.5.cmml" xref="alg2.l9.m1.1.1.1.1.5">𝑙</ci></apply><apply id="alg2.l9.m1.2.2.2.2.cmml" xref="alg2.l9.m1.2.2.2.2"><lt id="alg2.l9.m1.2.2.2.2.1.cmml" xref="alg2.l9.m1.2.2.2.2.1"></lt><apply id="alg2.l9.m1.2.2.2.2.2.cmml" xref="alg2.l9.m1.2.2.2.2.2"><times id="alg2.l9.m1.2.2.2.2.2.1.cmml" xref="alg2.l9.m1.2.2.2.2.2.1"></times><ci id="alg2.l9.m1.2.2.2.2.2.2.cmml" xref="alg2.l9.m1.2.2.2.2.2.2">𝑠</ci><ci id="alg2.l9.m1.2.2.2.2.2.3.cmml" xref="alg2.l9.m1.2.2.2.2.2.3">𝑖</ci><ci id="alg2.l9.m1.2.2.2.2.2.4.cmml" xref="alg2.l9.m1.2.2.2.2.2.4">𝑧</ci><ci id="alg2.l9.m1.2.2.2.2.2.5.cmml" xref="alg2.l9.m1.2.2.2.2.2.5">𝑒</ci></apply><apply id="alg2.l9.m1.2.2.2.2.3.cmml" xref="alg2.l9.m1.2.2.2.2.3"><times id="alg2.l9.m1.2.2.2.2.3.1.cmml" xref="alg2.l9.m1.2.2.2.2.3.1"></times><ci id="alg2.l9.m1.2.2.2.2.3.2.cmml" xref="alg2.l9.m1.2.2.2.2.3.2">𝑚</ci><ci id="alg2.l9.m1.2.2.2.2.3.3.cmml" xref="alg2.l9.m1.2.2.2.2.3.3">𝑎</ci><ci id="alg2.l9.m1.2.2.2.2.3.4.cmml" xref="alg2.l9.m1.2.2.2.2.3.4">𝑥</ci><ci id="alg2.l9.m1.2.2.2.2.3.5.cmml" xref="alg2.l9.m1.2.2.2.2.3.5">_</ci><ci id="alg2.l9.m1.2.2.2.2.3.6.cmml" xref="alg2.l9.m1.2.2.2.2.3.6">𝑝</ci><ci id="alg2.l9.m1.2.2.2.2.3.7.cmml" xref="alg2.l9.m1.2.2.2.2.3.7">𝑟</ci><ci id="alg2.l9.m1.2.2.2.2.3.8.cmml" xref="alg2.l9.m1.2.2.2.2.3.8">𝑒</ci><ci id="alg2.l9.m1.2.2.2.2.3.9.cmml" xref="alg2.l9.m1.2.2.2.2.3.9">𝑓</ci><ci id="alg2.l9.m1.2.2.2.2.3.10.cmml" xref="alg2.l9.m1.2.2.2.2.3.10">𝑖</ci><ci id="alg2.l9.m1.2.2.2.2.3.11.cmml" xref="alg2.l9.m1.2.2.2.2.3.11">𝑙</ci><ci id="alg2.l9.m1.2.2.2.2.3.12.cmml" xref="alg2.l9.m1.2.2.2.2.3.12">𝑙</ci><ci id="alg2.l9.m1.2.2.2.2.3.13.cmml" xref="alg2.l9.m1.2.2.2.2.3.13">_</ci><ci id="alg2.l9.m1.2.2.2.2.3.14.cmml" xref="alg2.l9.m1.2.2.2.2.3.14">𝑏</ci><ci id="alg2.l9.m1.2.2.2.2.3.15.cmml" xref="alg2.l9.m1.2.2.2.2.3.15">𝑠</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l9.m1.2c">pool.size&lt;max\_prefill\_bs</annotation><annotation encoding="application/x-llamapun" id="alg2.l9.m1.2d">italic_p italic_o italic_o italic_l . italic_s italic_i italic_z italic_e &lt; italic_m italic_a italic_x _ italic_p italic_r italic_e italic_f italic_i italic_l italic_l _ italic_b italic_s</annotation></semantics></math><span class="ltx_text" id="alg2.l9.5" style="font-size:80%;"> </span><span class="ltx_text ltx_font_bold" id="alg2.l9.6" style="font-size:80%;">then</span><span class="ltx_text" id="alg2.l9.7" style="font-size:80%;">
</span>
</div>
<div class="ltx_listingline" id="alg2.l10">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l10.1.1.1" style="font-size:80%;">10:</span></span><span class="ltx_text" id="alg2.l10.2" style="font-size:80%;">               </span><math alttext="pool.insert(\{request,D_{temp}\})" class="ltx_Math" display="inline" id="alg2.l10.m1.2"><semantics id="alg2.l10.m1.2a"><mrow id="alg2.l10.m1.2.2.2" xref="alg2.l10.m1.2.2.3.cmml"><mrow id="alg2.l10.m1.1.1.1.1" xref="alg2.l10.m1.1.1.1.1.cmml"><mi id="alg2.l10.m1.1.1.1.1.2" mathsize="80%" xref="alg2.l10.m1.1.1.1.1.2.cmml">p</mi><mo id="alg2.l10.m1.1.1.1.1.1" xref="alg2.l10.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l10.m1.1.1.1.1.3" mathsize="80%" xref="alg2.l10.m1.1.1.1.1.3.cmml">o</mi><mo id="alg2.l10.m1.1.1.1.1.1a" xref="alg2.l10.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l10.m1.1.1.1.1.4" mathsize="80%" xref="alg2.l10.m1.1.1.1.1.4.cmml">o</mi><mo id="alg2.l10.m1.1.1.1.1.1b" xref="alg2.l10.m1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l10.m1.1.1.1.1.5" mathsize="80%" xref="alg2.l10.m1.1.1.1.1.5.cmml">l</mi></mrow><mo id="alg2.l10.m1.2.2.2.3" lspace="0em" mathsize="80%" rspace="0.167em" xref="alg2.l10.m1.2.2.3a.cmml">.</mo><mrow id="alg2.l10.m1.2.2.2.2" xref="alg2.l10.m1.2.2.2.2.cmml"><mi id="alg2.l10.m1.2.2.2.2.3" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.3.cmml">i</mi><mo id="alg2.l10.m1.2.2.2.2.2" xref="alg2.l10.m1.2.2.2.2.2.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.4" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.4.cmml">n</mi><mo id="alg2.l10.m1.2.2.2.2.2a" xref="alg2.l10.m1.2.2.2.2.2.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.5" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.5.cmml">s</mi><mo id="alg2.l10.m1.2.2.2.2.2b" xref="alg2.l10.m1.2.2.2.2.2.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.6" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.6.cmml">e</mi><mo id="alg2.l10.m1.2.2.2.2.2c" xref="alg2.l10.m1.2.2.2.2.2.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.7" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.7.cmml">r</mi><mo id="alg2.l10.m1.2.2.2.2.2d" xref="alg2.l10.m1.2.2.2.2.2.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.8" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.8.cmml">t</mi><mo id="alg2.l10.m1.2.2.2.2.2e" xref="alg2.l10.m1.2.2.2.2.2.cmml">⁢</mo><mrow id="alg2.l10.m1.2.2.2.2.1.1" xref="alg2.l10.m1.2.2.2.2.cmml"><mo id="alg2.l10.m1.2.2.2.2.1.1.2" maxsize="80%" minsize="80%" xref="alg2.l10.m1.2.2.2.2.cmml">(</mo><mrow id="alg2.l10.m1.2.2.2.2.1.1.1.2" xref="alg2.l10.m1.2.2.2.2.1.1.1.3.cmml"><mo id="alg2.l10.m1.2.2.2.2.1.1.1.2.3" maxsize="80%" minsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.3.cmml">{</mo><mrow id="alg2.l10.m1.2.2.2.2.1.1.1.1.1" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.cmml"><mi id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.2" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.2.cmml">r</mi><mo id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.3" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.3.cmml">e</mi><mo id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1a" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.4" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.4.cmml">q</mi><mo id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1b" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.5" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.5.cmml">u</mi><mo id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1c" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.6" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.6.cmml">e</mi><mo id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1d" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.7" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.7.cmml">s</mi><mo id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1e" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.8" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.8.cmml">t</mi></mrow><mo id="alg2.l10.m1.2.2.2.2.1.1.1.2.4" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.3.cmml">,</mo><msub id="alg2.l10.m1.2.2.2.2.1.1.1.2.2" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.cmml"><mi id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.2" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.2.cmml">D</mi><mrow id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.cmml"><mi id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.2" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.2.cmml">t</mi><mo id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.1" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.1.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.3" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.3.cmml">e</mi><mo id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.1a" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.1.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.4" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.4.cmml">m</mi><mo id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.1b" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.1.cmml">⁢</mo><mi id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.5" mathsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.5.cmml">p</mi></mrow></msub><mo id="alg2.l10.m1.2.2.2.2.1.1.1.2.5" maxsize="80%" minsize="80%" xref="alg2.l10.m1.2.2.2.2.1.1.1.3.cmml">}</mo></mrow><mo id="alg2.l10.m1.2.2.2.2.1.1.3" maxsize="80%" minsize="80%" xref="alg2.l10.m1.2.2.2.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l10.m1.2b"><apply id="alg2.l10.m1.2.2.3.cmml" xref="alg2.l10.m1.2.2.2"><csymbol cd="ambiguous" id="alg2.l10.m1.2.2.3a.cmml" xref="alg2.l10.m1.2.2.2.3">formulae-sequence</csymbol><apply id="alg2.l10.m1.1.1.1.1.cmml" xref="alg2.l10.m1.1.1.1.1"><times id="alg2.l10.m1.1.1.1.1.1.cmml" xref="alg2.l10.m1.1.1.1.1.1"></times><ci id="alg2.l10.m1.1.1.1.1.2.cmml" xref="alg2.l10.m1.1.1.1.1.2">𝑝</ci><ci id="alg2.l10.m1.1.1.1.1.3.cmml" xref="alg2.l10.m1.1.1.1.1.3">𝑜</ci><ci id="alg2.l10.m1.1.1.1.1.4.cmml" xref="alg2.l10.m1.1.1.1.1.4">𝑜</ci><ci id="alg2.l10.m1.1.1.1.1.5.cmml" xref="alg2.l10.m1.1.1.1.1.5">𝑙</ci></apply><apply id="alg2.l10.m1.2.2.2.2.cmml" xref="alg2.l10.m1.2.2.2.2"><times id="alg2.l10.m1.2.2.2.2.2.cmml" xref="alg2.l10.m1.2.2.2.2.2"></times><ci id="alg2.l10.m1.2.2.2.2.3.cmml" xref="alg2.l10.m1.2.2.2.2.3">𝑖</ci><ci id="alg2.l10.m1.2.2.2.2.4.cmml" xref="alg2.l10.m1.2.2.2.2.4">𝑛</ci><ci id="alg2.l10.m1.2.2.2.2.5.cmml" xref="alg2.l10.m1.2.2.2.2.5">𝑠</ci><ci id="alg2.l10.m1.2.2.2.2.6.cmml" xref="alg2.l10.m1.2.2.2.2.6">𝑒</ci><ci id="alg2.l10.m1.2.2.2.2.7.cmml" xref="alg2.l10.m1.2.2.2.2.7">𝑟</ci><ci id="alg2.l10.m1.2.2.2.2.8.cmml" xref="alg2.l10.m1.2.2.2.2.8">𝑡</ci><set id="alg2.l10.m1.2.2.2.2.1.1.1.3.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.2"><apply id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1"><times id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.1"></times><ci id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.2.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.2">𝑟</ci><ci id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.3.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.3">𝑒</ci><ci id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.4.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.4">𝑞</ci><ci id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.5.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.5">𝑢</ci><ci id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.6.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.6">𝑒</ci><ci id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.7.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.7">𝑠</ci><ci id="alg2.l10.m1.2.2.2.2.1.1.1.1.1.8.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.1.1.8">𝑡</ci></apply><apply id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2"><csymbol cd="ambiguous" id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.1.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2">subscript</csymbol><ci id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.2.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.2">𝐷</ci><apply id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3"><times id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.1.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.1"></times><ci id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.2.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.2">𝑡</ci><ci id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.3.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.3">𝑒</ci><ci id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.4.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.4">𝑚</ci><ci id="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.5.cmml" xref="alg2.l10.m1.2.2.2.2.1.1.1.2.2.3.5">𝑝</ci></apply></apply></set></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l10.m1.2c">pool.insert(\{request,D_{temp}\})</annotation><annotation encoding="application/x-llamapun" id="alg2.l10.m1.2d">italic_p italic_o italic_o italic_l . italic_i italic_n italic_s italic_e italic_r italic_t ( { italic_r italic_e italic_q italic_u italic_e italic_s italic_t , italic_D start_POSTSUBSCRIPT italic_t italic_e italic_m italic_p end_POSTSUBSCRIPT } )</annotation></semantics></math><span class="ltx_text" id="alg2.l10.3" style="font-size:80%;">
                   </span>
</div>
<div class="ltx_listingline" id="alg2.l11">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l11.1.1.1" style="font-size:80%;">11:</span></span><span class="ltx_text" id="alg2.l11.2" style="font-size:80%;">        </span><math alttext="D\leftarrow D_{temp}" class="ltx_Math" display="inline" id="alg2.l11.m1.1"><semantics id="alg2.l11.m1.1a"><mrow id="alg2.l11.m1.1.1" xref="alg2.l11.m1.1.1.cmml"><mi id="alg2.l11.m1.1.1.2" mathsize="80%" xref="alg2.l11.m1.1.1.2.cmml">D</mi><mo id="alg2.l11.m1.1.1.1" mathsize="80%" stretchy="false" xref="alg2.l11.m1.1.1.1.cmml">←</mo><msub id="alg2.l11.m1.1.1.3" xref="alg2.l11.m1.1.1.3.cmml"><mi id="alg2.l11.m1.1.1.3.2" mathsize="80%" xref="alg2.l11.m1.1.1.3.2.cmml">D</mi><mrow id="alg2.l11.m1.1.1.3.3" xref="alg2.l11.m1.1.1.3.3.cmml"><mi id="alg2.l11.m1.1.1.3.3.2" mathsize="80%" xref="alg2.l11.m1.1.1.3.3.2.cmml">t</mi><mo id="alg2.l11.m1.1.1.3.3.1" xref="alg2.l11.m1.1.1.3.3.1.cmml">⁢</mo><mi id="alg2.l11.m1.1.1.3.3.3" mathsize="80%" xref="alg2.l11.m1.1.1.3.3.3.cmml">e</mi><mo id="alg2.l11.m1.1.1.3.3.1a" xref="alg2.l11.m1.1.1.3.3.1.cmml">⁢</mo><mi id="alg2.l11.m1.1.1.3.3.4" mathsize="80%" xref="alg2.l11.m1.1.1.3.3.4.cmml">m</mi><mo id="alg2.l11.m1.1.1.3.3.1b" xref="alg2.l11.m1.1.1.3.3.1.cmml">⁢</mo><mi id="alg2.l11.m1.1.1.3.3.5" mathsize="80%" xref="alg2.l11.m1.1.1.3.3.5.cmml">p</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg2.l11.m1.1b"><apply id="alg2.l11.m1.1.1.cmml" xref="alg2.l11.m1.1.1"><ci id="alg2.l11.m1.1.1.1.cmml" xref="alg2.l11.m1.1.1.1">←</ci><ci id="alg2.l11.m1.1.1.2.cmml" xref="alg2.l11.m1.1.1.2">𝐷</ci><apply id="alg2.l11.m1.1.1.3.cmml" xref="alg2.l11.m1.1.1.3"><csymbol cd="ambiguous" id="alg2.l11.m1.1.1.3.1.cmml" xref="alg2.l11.m1.1.1.3">subscript</csymbol><ci id="alg2.l11.m1.1.1.3.2.cmml" xref="alg2.l11.m1.1.1.3.2">𝐷</ci><apply id="alg2.l11.m1.1.1.3.3.cmml" xref="alg2.l11.m1.1.1.3.3"><times id="alg2.l11.m1.1.1.3.3.1.cmml" xref="alg2.l11.m1.1.1.3.3.1"></times><ci id="alg2.l11.m1.1.1.3.3.2.cmml" xref="alg2.l11.m1.1.1.3.3.2">𝑡</ci><ci id="alg2.l11.m1.1.1.3.3.3.cmml" xref="alg2.l11.m1.1.1.3.3.3">𝑒</ci><ci id="alg2.l11.m1.1.1.3.3.4.cmml" xref="alg2.l11.m1.1.1.3.3.4">𝑚</ci><ci id="alg2.l11.m1.1.1.3.3.5.cmml" xref="alg2.l11.m1.1.1.3.3.5">𝑝</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l11.m1.1c">D\leftarrow D_{temp}</annotation><annotation encoding="application/x-llamapun" id="alg2.l11.m1.1d">italic_D ← italic_D start_POSTSUBSCRIPT italic_t italic_e italic_m italic_p end_POSTSUBSCRIPT</annotation></semantics></math><span class="ltx_text" id="alg2.l11.3" style="font-size:80%;">
    </span>
</div>
</div>
</figure>
<div class="ltx_para" id="S5.SS3.p6">
<p class="ltx_p" id="S5.SS3.p6.1">The general RAG system is more complex with larger LLM batch sizes and parallel vector search. In addition,
we cannot terminate a speculative generation immediately when the request is batched with other requests.
Based on Theorem <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S5.Thmtheorem1" title="Theorem 5.1. ‣ 5.3. Dynamic Speculative Pipelining ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">5.1</span></a>, we design a dynamic speculative pipelining strategy in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#alg2" title="Algorithm 2 ‣ 5.3. Dynamic Speculative Pipelining ‣ 5. RAGCache Design ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">2</span></a>. The main idea is to start a speculative generation only if the
retrieved documents change and the number of pending LLM requests falls below a predetermined maximum batch size
for the prefill iteration (<math alttext="max\_prefill\_bs" class="ltx_Math" display="inline" id="S5.SS3.p6.1.m1.1"><semantics id="S5.SS3.p6.1.m1.1a"><mrow id="S5.SS3.p6.1.m1.1.1" xref="S5.SS3.p6.1.m1.1.1.cmml"><mi id="S5.SS3.p6.1.m1.1.1.2" xref="S5.SS3.p6.1.m1.1.1.2.cmml">m</mi><mo id="S5.SS3.p6.1.m1.1.1.1" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.3" xref="S5.SS3.p6.1.m1.1.1.3.cmml">a</mi><mo id="S5.SS3.p6.1.m1.1.1.1a" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.4" xref="S5.SS3.p6.1.m1.1.1.4.cmml">x</mi><mo id="S5.SS3.p6.1.m1.1.1.1b" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.5" mathvariant="normal" xref="S5.SS3.p6.1.m1.1.1.5.cmml">_</mi><mo id="S5.SS3.p6.1.m1.1.1.1c" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.6" xref="S5.SS3.p6.1.m1.1.1.6.cmml">p</mi><mo id="S5.SS3.p6.1.m1.1.1.1d" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.7" xref="S5.SS3.p6.1.m1.1.1.7.cmml">r</mi><mo id="S5.SS3.p6.1.m1.1.1.1e" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.8" xref="S5.SS3.p6.1.m1.1.1.8.cmml">e</mi><mo id="S5.SS3.p6.1.m1.1.1.1f" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.9" xref="S5.SS3.p6.1.m1.1.1.9.cmml">f</mi><mo id="S5.SS3.p6.1.m1.1.1.1g" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.10" xref="S5.SS3.p6.1.m1.1.1.10.cmml">i</mi><mo id="S5.SS3.p6.1.m1.1.1.1h" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.11" xref="S5.SS3.p6.1.m1.1.1.11.cmml">l</mi><mo id="S5.SS3.p6.1.m1.1.1.1i" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.12" xref="S5.SS3.p6.1.m1.1.1.12.cmml">l</mi><mo id="S5.SS3.p6.1.m1.1.1.1j" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.13" mathvariant="normal" xref="S5.SS3.p6.1.m1.1.1.13.cmml">_</mi><mo id="S5.SS3.p6.1.m1.1.1.1k" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.14" xref="S5.SS3.p6.1.m1.1.1.14.cmml">b</mi><mo id="S5.SS3.p6.1.m1.1.1.1l" xref="S5.SS3.p6.1.m1.1.1.1.cmml">⁢</mo><mi id="S5.SS3.p6.1.m1.1.1.15" xref="S5.SS3.p6.1.m1.1.1.15.cmml">s</mi></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p6.1.m1.1b"><apply id="S5.SS3.p6.1.m1.1.1.cmml" xref="S5.SS3.p6.1.m1.1.1"><times id="S5.SS3.p6.1.m1.1.1.1.cmml" xref="S5.SS3.p6.1.m1.1.1.1"></times><ci id="S5.SS3.p6.1.m1.1.1.2.cmml" xref="S5.SS3.p6.1.m1.1.1.2">𝑚</ci><ci id="S5.SS3.p6.1.m1.1.1.3.cmml" xref="S5.SS3.p6.1.m1.1.1.3">𝑎</ci><ci id="S5.SS3.p6.1.m1.1.1.4.cmml" xref="S5.SS3.p6.1.m1.1.1.4">𝑥</ci><ci id="S5.SS3.p6.1.m1.1.1.5.cmml" xref="S5.SS3.p6.1.m1.1.1.5">_</ci><ci id="S5.SS3.p6.1.m1.1.1.6.cmml" xref="S5.SS3.p6.1.m1.1.1.6">𝑝</ci><ci id="S5.SS3.p6.1.m1.1.1.7.cmml" xref="S5.SS3.p6.1.m1.1.1.7">𝑟</ci><ci id="S5.SS3.p6.1.m1.1.1.8.cmml" xref="S5.SS3.p6.1.m1.1.1.8">𝑒</ci><ci id="S5.SS3.p6.1.m1.1.1.9.cmml" xref="S5.SS3.p6.1.m1.1.1.9">𝑓</ci><ci id="S5.SS3.p6.1.m1.1.1.10.cmml" xref="S5.SS3.p6.1.m1.1.1.10">𝑖</ci><ci id="S5.SS3.p6.1.m1.1.1.11.cmml" xref="S5.SS3.p6.1.m1.1.1.11">𝑙</ci><ci id="S5.SS3.p6.1.m1.1.1.12.cmml" xref="S5.SS3.p6.1.m1.1.1.12">𝑙</ci><ci id="S5.SS3.p6.1.m1.1.1.13.cmml" xref="S5.SS3.p6.1.m1.1.1.13">_</ci><ci id="S5.SS3.p6.1.m1.1.1.14.cmml" xref="S5.SS3.p6.1.m1.1.1.14">𝑏</ci><ci id="S5.SS3.p6.1.m1.1.1.15.cmml" xref="S5.SS3.p6.1.m1.1.1.15">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p6.1.m1.1c">max\_prefill\_bs</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p6.1.m1.1d">italic_m italic_a italic_x _ italic_p italic_r italic_e italic_f italic_i italic_l italic_l _ italic_b italic_s</annotation></semantics></math>). The maximum prefill batch size is determined by the smaller
number of tokens that can either fit within the GPU memory or fully utilize the SMs. The strategy terminates
the incorrect speculative generation after the current LLM iteration, which does not affect other requests in the
batch. This strategy overlaps the retrieval and generation steps as much as possible while gauging the system load.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6. </span>Implementation</h2>
<figure class="ltx_table" id="S6.T1">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S6.T1.1" style="width:433.6pt;height:104.5pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(30.0pt,-7.2pt) scale(1.16078913852079,1.16078913852079) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S6.T1.1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S6.T1.1.1.2.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S6.T1.1.1.2.1.1"><span class="ltx_text ltx_font_bold" id="S6.T1.1.1.2.1.1.1">Model</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S6.T1.1.1.2.1.2"><span class="ltx_text ltx_font_bold" id="S6.T1.1.1.2.1.2.1">Layers</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S6.T1.1.1.2.1.3"><span class="ltx_text ltx_font_bold" id="S6.T1.1.1.2.1.3.1">Q/KV Heads</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S6.T1.1.1.2.1.4"><span class="ltx_text ltx_font_bold" id="S6.T1.1.1.2.1.4.1">MoE</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S6.T1.1.1.2.1.5"><span class="ltx_text ltx_font_bold" id="S6.T1.1.1.2.1.5.1">Model Size</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S6.T1.1.1.2.1.6"><span class="ltx_text ltx_font_bold" id="S6.T1.1.1.2.1.6.1">KV Size</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S6.T1.1.1.3.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S6.T1.1.1.3.1.1">Mistral-7B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S6.T1.1.1.3.1.2">32</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T1.1.1.3.1.3">32/8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T1.1.1.3.1.4">no</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T1.1.1.3.1.5">14 GiB</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T1.1.1.3.1.6">0.125 MiB/token</td>
</tr>
<tr class="ltx_tr" id="S6.T1.1.1.4.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S6.T1.1.1.4.2.1">LLaMA2-7B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S6.T1.1.1.4.2.2">32</th>
<td class="ltx_td ltx_align_center" id="S6.T1.1.1.4.2.3">32/32</td>
<td class="ltx_td ltx_align_center" id="S6.T1.1.1.4.2.4">no</td>
<td class="ltx_td ltx_align_center" id="S6.T1.1.1.4.2.5">14 GiB</td>
<td class="ltx_td ltx_align_center" id="S6.T1.1.1.4.2.6">0.5 MiB/token</td>
</tr>
<tr class="ltx_tr" id="S6.T1.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S6.T1.1.1.1.1">Mixtral-8<math alttext="\times" class="ltx_Math" display="inline" id="S6.T1.1.1.1.1.m1.1"><semantics id="S6.T1.1.1.1.1.m1.1a"><mo id="S6.T1.1.1.1.1.m1.1.1" xref="S6.T1.1.1.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S6.T1.1.1.1.1.m1.1b"><times id="S6.T1.1.1.1.1.m1.1.1.cmml" xref="S6.T1.1.1.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S6.T1.1.1.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S6.T1.1.1.1.1.m1.1d">×</annotation></semantics></math>7B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S6.T1.1.1.1.2">32</th>
<td class="ltx_td ltx_align_center" id="S6.T1.1.1.1.3">32/8</td>
<td class="ltx_td ltx_align_center" id="S6.T1.1.1.1.4">yes</td>
<td class="ltx_td ltx_align_center" id="S6.T1.1.1.1.5">96.8 GiB</td>
<td class="ltx_td ltx_align_center" id="S6.T1.1.1.1.6">0.125 MiB/token</td>
</tr>
<tr class="ltx_tr" id="S6.T1.1.1.5.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb" id="S6.T1.1.1.5.3.1">LLaMA2-70B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb" id="S6.T1.1.1.5.3.2">80</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S6.T1.1.1.5.3.3">64/8</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S6.T1.1.1.5.3.4">no</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S6.T1.1.1.5.3.5">140 GiB</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S6.T1.1.1.5.3.6">0.3125 MiB/token</td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S6.T1.3.1.1" style="font-size:90%;">Table 1</span>. </span><span class="ltx_text" id="S6.T1.4.2" style="font-size:90%;">Models used in the evaluation.</span></figcaption>
</figure>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">We implement a system prototype of RAGCache with <math alttext="\sim" class="ltx_Math" display="inline" id="S6.p1.1.m1.1"><semantics id="S6.p1.1.m1.1a"><mo id="S6.p1.1.m1.1.1" xref="S6.p1.1.m1.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S6.p1.1.m1.1b"><csymbol cd="latexml" id="S6.p1.1.m1.1.1.cmml" xref="S6.p1.1.m1.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S6.p1.1.m1.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S6.p1.1.m1.1d">∼</annotation></semantics></math>5000 lines of code in C++ and Python.
Our implementation is based on vLLM <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>)</cite> v0.3.0, a state-of-the-art LLM serving system.
We extend its prefill kernel in Pytorch <cite class="ltx_cite ltx_citemacro_citep">(Paszke
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib37" title="">2019</a>)</cite> and Triton <cite class="ltx_cite ltx_citemacro_citep">(Tillet
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib41" title="">2019</a>)</cite> to support
prefix caching for different attention mechanisms, e.g., multi-head attention <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib45" title="">2017</a>)</cite> and
grouped-query attention <cite class="ltx_cite ltx_citemacro_citep">(Ainslie et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib7" title="">2023</a>)</cite>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p2">
<p class="ltx_p" id="S6.p2.4"><span class="ltx_text ltx_font_bold" id="S6.p2.4.1">Pipelined vector search.</span> We implement dynamic speculative pipelining on top of
Faiss <cite class="ltx_cite ltx_citemacro_citep">(pin, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib5" title="">2024</a>)</cite>, an open-source widely-used vector database, and adapt it for
two types of indexes: IVF <cite class="ltx_cite ltx_citemacro_citep">(Babenko and
Lempitsky, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib8" title="">2014</a>)</cite> and HNSW <cite class="ltx_cite ltx_citemacro_citep">(Malkov and
Yashunin, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib35" title="">2018</a>)</cite>.
IVF divides the vector space into multiple clusters and stores the vectors in the corresponding clusters.
During vector search, IVF first locates the top-<math alttext="n" class="ltx_Math" display="inline" id="S6.p2.1.m1.1"><semantics id="S6.p2.1.m1.1a"><mi id="S6.p2.1.m1.1.1" xref="S6.p2.1.m1.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S6.p2.1.m1.1b"><ci id="S6.p2.1.m1.1.1.cmml" xref="S6.p2.1.m1.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.1.m1.1c">n</annotation><annotation encoding="application/x-llamapun" id="S6.p2.1.m1.1d">italic_n</annotation></semantics></math> closest clusters to the request vector and subsequently searches within these clusters.
HNSW constructs multi-level graphs to map the vector space, connecting vectors with edges to represent similarity.
HNSW searches the vectors by traversing the graph and maintains a candidate list to store the current top-<math alttext="k" class="ltx_Math" display="inline" id="S6.p2.2.m2.1"><semantics id="S6.p2.2.m2.1a"><mi id="S6.p2.2.m2.1.1" xref="S6.p2.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S6.p2.2.m2.1b"><ci id="S6.p2.2.m2.1.1.cmml" xref="S6.p2.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S6.p2.2.m2.1d">italic_k</annotation></semantics></math> nearest vectors.
To support pipelined vector search, we modify the search process of these two indexes.
Specifically, we split the IVF search into multiple stages, each searching the vectors in some clusters and
returning the current top-<math alttext="k" class="ltx_Math" display="inline" id="S6.p2.3.m3.1"><semantics id="S6.p2.3.m3.1a"><mi id="S6.p2.3.m3.1.1" xref="S6.p2.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S6.p2.3.m3.1b"><ci id="S6.p2.3.m3.1.1.cmml" xref="S6.p2.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S6.p2.3.m3.1d">italic_k</annotation></semantics></math> vectors.
For HNSW, we measure the average search time for a specified search configuration and split the
entire time into smaller time slices. After each time slice of searching, it returns the current top-<math alttext="k" class="ltx_Math" display="inline" id="S6.p2.4.m4.1"><semantics id="S6.p2.4.m4.1a"><mi id="S6.p2.4.m4.1.1" xref="S6.p2.4.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S6.p2.4.m4.1b"><ci id="S6.p2.4.m4.1.1.cmml" xref="S6.p2.4.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.4.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="S6.p2.4.m4.1d">italic_k</annotation></semantics></math> vectors.
These modifications aim to facilitate the dynamic speculative pipeline while maintaining the final search semantics.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p3">
<p class="ltx_p" id="S6.p3.1"><span class="ltx_text ltx_font_bold" id="S6.p3.1.1">Fault tolerance.</span> We implement two fault-tolerant mechanisms in RAGCache to handle GPU failures and
request processing failures. The GPU memory serves as RAGCache’s first-level cache, storing the
KV cache of the upper-level nodes in the knowledge tree hierarchy. Given the prefix sensitivity of LLM
inference, a GPU failure would invalidate the lower-level nodes and therefore the entire tree. We replicate
a portion of the most frequently accessed upper-level nodes (e.g., the system prompt)
in the host memory for fast recovery. We also employ a timeout mechanism to
retry the failed requests. If a request fails before completing its first iteration, it will be
recomputed. Otherwise, the request can continue computation by reusing the stored KV cache.</p>
</div>
</section>
<section class="ltx_section" id="S7">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7. </span>Evaluation</h2>
<div class="ltx_para" id="S7.p1">
<p class="ltx_p" id="S7.p1.4">In this section, we evaluate RAGCache from the following aspects: <math alttext="(i)" class="ltx_Math" display="inline" id="S7.p1.1.m1.1"><semantics id="S7.p1.1.m1.1a"><mrow id="S7.p1.1.m1.1.2.2"><mo id="S7.p1.1.m1.1.2.2.1" stretchy="false">(</mo><mi id="S7.p1.1.m1.1.1" xref="S7.p1.1.m1.1.1.cmml">i</mi><mo id="S7.p1.1.m1.1.2.2.2" stretchy="false">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S7.p1.1.m1.1b"><ci id="S7.p1.1.m1.1.1.cmml" xref="S7.p1.1.m1.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.1.m1.1c">(i)</annotation><annotation encoding="application/x-llamapun" id="S7.p1.1.m1.1d">( italic_i )</annotation></semantics></math> overall performance
against state-of-the-art approaches; <math alttext="(ii)" class="ltx_Math" display="inline" id="S7.p1.2.m2.1"><semantics id="S7.p1.2.m2.1a"><mrow id="S7.p1.2.m2.1.1.1" xref="S7.p1.2.m2.1.1.1.1.cmml"><mo id="S7.p1.2.m2.1.1.1.2" stretchy="false" xref="S7.p1.2.m2.1.1.1.1.cmml">(</mo><mrow id="S7.p1.2.m2.1.1.1.1" xref="S7.p1.2.m2.1.1.1.1.cmml"><mi id="S7.p1.2.m2.1.1.1.1.2" xref="S7.p1.2.m2.1.1.1.1.2.cmml">i</mi><mo id="S7.p1.2.m2.1.1.1.1.1" xref="S7.p1.2.m2.1.1.1.1.1.cmml">⁢</mo><mi id="S7.p1.2.m2.1.1.1.1.3" xref="S7.p1.2.m2.1.1.1.1.3.cmml">i</mi></mrow><mo id="S7.p1.2.m2.1.1.1.3" stretchy="false" xref="S7.p1.2.m2.1.1.1.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S7.p1.2.m2.1b"><apply id="S7.p1.2.m2.1.1.1.1.cmml" xref="S7.p1.2.m2.1.1.1"><times id="S7.p1.2.m2.1.1.1.1.1.cmml" xref="S7.p1.2.m2.1.1.1.1.1"></times><ci id="S7.p1.2.m2.1.1.1.1.2.cmml" xref="S7.p1.2.m2.1.1.1.1.2">𝑖</ci><ci id="S7.p1.2.m2.1.1.1.1.3.cmml" xref="S7.p1.2.m2.1.1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.2.m2.1c">(ii)</annotation><annotation encoding="application/x-llamapun" id="S7.p1.2.m2.1d">( italic_i italic_i )</annotation></semantics></math> performance under general settings; <math alttext="(iii)" class="ltx_Math" display="inline" id="S7.p1.3.m3.1"><semantics id="S7.p1.3.m3.1a"><mrow id="S7.p1.3.m3.1.1.1" xref="S7.p1.3.m3.1.1.1.1.cmml"><mo id="S7.p1.3.m3.1.1.1.2" stretchy="false" xref="S7.p1.3.m3.1.1.1.1.cmml">(</mo><mrow id="S7.p1.3.m3.1.1.1.1" xref="S7.p1.3.m3.1.1.1.1.cmml"><mi id="S7.p1.3.m3.1.1.1.1.2" xref="S7.p1.3.m3.1.1.1.1.2.cmml">i</mi><mo id="S7.p1.3.m3.1.1.1.1.1" xref="S7.p1.3.m3.1.1.1.1.1.cmml">⁢</mo><mi id="S7.p1.3.m3.1.1.1.1.3" xref="S7.p1.3.m3.1.1.1.1.3.cmml">i</mi><mo id="S7.p1.3.m3.1.1.1.1.1a" xref="S7.p1.3.m3.1.1.1.1.1.cmml">⁢</mo><mi id="S7.p1.3.m3.1.1.1.1.4" xref="S7.p1.3.m3.1.1.1.1.4.cmml">i</mi></mrow><mo id="S7.p1.3.m3.1.1.1.3" stretchy="false" xref="S7.p1.3.m3.1.1.1.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S7.p1.3.m3.1b"><apply id="S7.p1.3.m3.1.1.1.1.cmml" xref="S7.p1.3.m3.1.1.1"><times id="S7.p1.3.m3.1.1.1.1.1.cmml" xref="S7.p1.3.m3.1.1.1.1.1"></times><ci id="S7.p1.3.m3.1.1.1.1.2.cmml" xref="S7.p1.3.m3.1.1.1.1.2">𝑖</ci><ci id="S7.p1.3.m3.1.1.1.1.3.cmml" xref="S7.p1.3.m3.1.1.1.1.3">𝑖</ci><ci id="S7.p1.3.m3.1.1.1.1.4.cmml" xref="S7.p1.3.m3.1.1.1.1.4">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.3.m3.1c">(iii)</annotation><annotation encoding="application/x-llamapun" id="S7.p1.3.m3.1d">( italic_i italic_i italic_i )</annotation></semantics></math>
ablation studies on the techniques used in RAGCache; and <math alttext="(iv)" class="ltx_Math" display="inline" id="S7.p1.4.m4.1"><semantics id="S7.p1.4.m4.1a"><mrow id="S7.p1.4.m4.1.1.1" xref="S7.p1.4.m4.1.1.1.1.cmml"><mo id="S7.p1.4.m4.1.1.1.2" stretchy="false" xref="S7.p1.4.m4.1.1.1.1.cmml">(</mo><mrow id="S7.p1.4.m4.1.1.1.1" xref="S7.p1.4.m4.1.1.1.1.cmml"><mi id="S7.p1.4.m4.1.1.1.1.2" xref="S7.p1.4.m4.1.1.1.1.2.cmml">i</mi><mo id="S7.p1.4.m4.1.1.1.1.1" xref="S7.p1.4.m4.1.1.1.1.1.cmml">⁢</mo><mi id="S7.p1.4.m4.1.1.1.1.3" xref="S7.p1.4.m4.1.1.1.1.3.cmml">v</mi></mrow><mo id="S7.p1.4.m4.1.1.1.3" stretchy="false" xref="S7.p1.4.m4.1.1.1.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S7.p1.4.m4.1b"><apply id="S7.p1.4.m4.1.1.1.1.cmml" xref="S7.p1.4.m4.1.1.1"><times id="S7.p1.4.m4.1.1.1.1.1.cmml" xref="S7.p1.4.m4.1.1.1.1.1"></times><ci id="S7.p1.4.m4.1.1.1.1.2.cmml" xref="S7.p1.4.m4.1.1.1.1.2">𝑖</ci><ci id="S7.p1.4.m4.1.1.1.1.3.cmml" xref="S7.p1.4.m4.1.1.1.1.3">𝑣</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.4.m4.1c">(iv)</annotation><annotation encoding="application/x-llamapun" id="S7.p1.4.m4.1d">( italic_i italic_v )</annotation></semantics></math> scheduling time of RAGCache.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.p2">
<p class="ltx_p" id="S7.p2.2"><span class="ltx_text ltx_font_bold" id="S7.p2.2.1">Testbed.</span> Most of our experiments are conducted on AWS EC2 g5.16xlarge instances, each
with 64 vCPUs (AMD EPYC 7R32), 256 GiB host memory, and 25 Gbps NIC.
Each instance is configured with one NVIDIA A10G GPU with 24 GiB memory and
the GPU is connected to the host via PCIe 4.0<math alttext="\times" class="ltx_Math" display="inline" id="S7.p2.1.m1.1"><semantics id="S7.p2.1.m1.1a"><mo id="S7.p2.1.m1.1.1" xref="S7.p2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.p2.1.m1.1b"><times id="S7.p2.1.m1.1.1.cmml" xref="S7.p2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.p2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.p2.1.m1.1d">×</annotation></semantics></math>16.
We run experiments with 7B models on a single g5.16xlarge instance and
use 192 GiB host memory for caching unless otherwise stated.
For large models, we use two NVIDIA H800 GPUs, each with 80 GiB memory and
interconnected by NVLink. The two GPUs are connected to the host via PCIe 5.0<math alttext="\times" class="ltx_Math" display="inline" id="S7.p2.2.m2.1"><semantics id="S7.p2.2.m2.1a"><mo id="S7.p2.2.m2.1.1" xref="S7.p2.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.p2.2.m2.1b"><times id="S7.p2.2.m2.1.1.cmml" xref="S7.p2.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.p2.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.p2.2.m2.1d">×</annotation></semantics></math>16.
We use 384 GiB host memory for caching in this case.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.p3">
<p class="ltx_p" id="S7.p3.2"><span class="ltx_text ltx_font_bold" id="S7.p3.2.1">Models.</span> We evaluate RAGCache with the LLaMA 2 chat models <cite class="ltx_cite ltx_citemacro_citep">(Touvron
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib42" title="">2023</a>)</cite>
and the Mistral AI models <cite class="ltx_cite ltx_citemacro_citep">(Jiang
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib21" title="">2023</a>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib22" title="">2024a</a>)</cite>.
The model details are listed in Table <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S6.T1" title="Table 1 ‣ 6. Implementation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">1</span></a>. Most of the experiments are conducted
with Mistral-7B and LLaMA2-7B. The two models have the same size but employ different attention mechanisms,
i.e., grouped-query attention and multi-head attention.
We also evaluate RAGCache with large models, Mixtral-8<math alttext="\times" class="ltx_Math" display="inline" id="S7.p3.1.m1.1"><semantics id="S7.p3.1.m1.1a"><mo id="S7.p3.1.m1.1.1" xref="S7.p3.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.p3.1.m1.1b"><times id="S7.p3.1.m1.1.1.cmml" xref="S7.p3.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.p3.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.p3.1.m1.1d">×</annotation></semantics></math>7B and LLaMA2-70B, to demonstrate the
scalability of RAGCache. Mixtral-8<math alttext="\times" class="ltx_Math" display="inline" id="S7.p3.2.m2.1"><semantics id="S7.p3.2.m2.1a"><mo id="S7.p3.2.m2.1.1" xref="S7.p3.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.p3.2.m2.1b"><times id="S7.p3.2.m2.1.1.cmml" xref="S7.p3.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.p3.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.p3.2.m2.1d">×</annotation></semantics></math>7B is a mixture-of-experts (MoE) model with eight experts,
and two experts are activated for each token. We deploy the large models on two H800 80GB GPUs for tensor
parallelism and expert parallelism.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.p4">
<p class="ltx_p" id="S7.p4.1"><span class="ltx_text ltx_font_bold" id="S7.p4.1.1">Retrieval.</span> We use the Wikipedia dataset collected in § <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.SS2" title="3.2. Optimizations Opportunities ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">3.2</span></a> as
the knowledge base. For vector search, we use the IVF index with 1024 clusters and set the default top-<math alttext="k" class="ltx_Math" display="inline" id="S7.p4.1.m1.1"><semantics id="S7.p4.1.m1.1a"><mi id="S7.p4.1.m1.1.1" xref="S7.p4.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S7.p4.1.m1.1b"><ci id="S7.p4.1.m1.1.1.cmml" xref="S7.p4.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p4.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S7.p4.1.m1.1d">italic_k</annotation></semantics></math> to 2.
We deploy the vector database with four separate vCPUs and 30 GiB host memory on
the same instance as the GPU and expose a RESTful API for document retrieval.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.p5">
<p class="ltx_p" id="S7.p5.1"><span class="ltx_text ltx_font_bold" id="S7.p5.1.1">Workloads.</span> Our evaluation uses two representative QA datasets, MMLU <cite class="ltx_cite ltx_citemacro_citep">(Hendrycks et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib19" title="">2020</a>)</cite>
and Natural Questions <cite class="ltx_cite ltx_citemacro_citep">(Kwiatkowski
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib26" title="">2019</a>)</cite>. MMLU is a multi-choice knowledge benchmark
where the LLM outputs a single token (A/B/C/D) per question. Natural Questions comprises
anonymized questions from Google Search and provides the reference answers for each question.
For Natural Questions, we sample the output length for each question from the token length distribution
of the reference answers. The average output length is 6 tokens, and 99% of the answers contain no more
than 32 tokens. We sample a subset of the questions from the dataset,
respecting the document retrieval distribution in § <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.SS2" title="3.2. Optimizations Opportunities ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">3.2</span></a>, and
randomly shuffle the questions to generate 1-hour workloads.
In line with prior work <cite class="ltx_cite ltx_citemacro_citep">(Wu
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib46" title="">2023</a>; Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>)</cite>, we assign the arrival time for each request
using a Poisson process parameterized by the arrival rate.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.p6">
<p class="ltx_p" id="S7.p6.1"><span class="ltx_text ltx_font_bold" id="S7.p6.1.1">Metrics.</span> We report the average time-to-first-token (TTFT) as the main metric.
We also evaluate the system throughput, which is defined as the request rate that the system
can process while maintaining a TTFT below a certain threshold, e.g., 5<math alttext="\times" class="ltx_Math" display="inline" id="S7.p6.1.m1.1"><semantics id="S7.p6.1.m1.1a"><mo id="S7.p6.1.m1.1.1" xref="S7.p6.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.p6.1.m1.1b"><times id="S7.p6.1.m1.1.1.cmml" xref="S7.p6.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.p6.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.p6.1.m1.1d">×</annotation></semantics></math> of the TTFT
at the lowest request rate. In addition, we measure the cache hit rate in the ablation study.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.p7">
<p class="ltx_p" id="S7.p7.1"><span class="ltx_text ltx_font_bold" id="S7.p7.1.1">Baselines.</span> We compare RAGCache with two baselines.</p>
<ul class="ltx_itemize" id="S7.I1">
<li class="ltx_item" id="S7.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S7.I1.i1.p1">
<p class="ltx_p" id="S7.I1.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S7.I1.i1.p1.1.1">vLLM</span> <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>)</cite>, a state-of-the-art LLM serving system that supports iteration-level
scheduling <cite class="ltx_cite ltx_citemacro_citep">(Yu
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib51" title="">2022</a>)</cite> and uses PagedAttention <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>)</cite> to reduce memory fragmentation.</p>
</div>
</li>
<li class="ltx_item" id="S7.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S7.I1.i2.p1">
<p class="ltx_p" id="S7.I1.i2.p1.1"><span class="ltx_text ltx_font_bold" id="S7.I1.i2.p1.1.1">SGLang</span> <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib58" title="">2023</a>)</cite>, a high-performance LLM serving system that allows KV cache reuse
across different requests in GPU memory and employs LRU as the replacement policy.</p>
</div>
</li>
</ul>
<p class="ltx_p" id="S7.p7.2">For fair comparison, the baselines are configured with the same model parallelism, maximum batch size,
and vector database settings as RAGCache.</p>
</div>
<figure class="ltx_figure" id="S7.F13">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_missing ltx_missing_image" id="S7.F13.g1" src=""/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F13.sf1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F13.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S7.F13.sf1.3.2" style="font-size:90%;">Mistral-7B.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F13.sf2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F13.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S7.F13.sf2.3.2" style="font-size:90%;">LLaMA2-7B.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F13.2.1.1" style="font-size:90%;">Figure 13</span>. </span><span class="ltx_text" id="S7.F13.3.2" style="font-size:90%;">Overall performance on MMLU.</span></figcaption>
</figure>
<section class="ltx_subsection" id="S7.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">7.1. </span>Overall Performance</h3>
<div class="ltx_para" id="S7.SS1.p1">
<p class="ltx_p" id="S7.SS1.p1.2">We first compare the overall performance of RAGCache against the baselines.
We use MMLU and Natural Questions as the workloads and Mistral-7B and LLaMA2-7B as the models.
The maximum batch size is set to 4.
We vary the request rate and measure the average TTFT.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.F13" title="Figure 13 ‣ 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">13</span></a> and Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.F14" title="Figure 14 ‣ 7.1. Overall Performance ‣ 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">14</span></a> show the results on
MMLU and Natural Questions, respectively, which we summarize as follows.</p>
<ul class="ltx_itemize" id="S7.I2">
<li class="ltx_item" id="S7.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S7.I2.i1.p1">
<p class="ltx_p" id="S7.I2.i1.p1.2">RAGCache reduces the average TTFT by 1.2–4<math alttext="\times" class="ltx_Math" display="inline" id="S7.I2.i1.p1.1.m1.1"><semantics id="S7.I2.i1.p1.1.m1.1a"><mo id="S7.I2.i1.p1.1.m1.1.1" xref="S7.I2.i1.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.I2.i1.p1.1.m1.1b"><times id="S7.I2.i1.p1.1.m1.1.1.cmml" xref="S7.I2.i1.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.I2.i1.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.I2.i1.p1.1.m1.1d">×</annotation></semantics></math> compared to vLLM and 1.1–3.5<math alttext="\times" class="ltx_Math" display="inline" id="S7.I2.i1.p1.2.m2.1"><semantics id="S7.I2.i1.p1.2.m2.1a"><mo id="S7.I2.i1.p1.2.m2.1.1" xref="S7.I2.i1.p1.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.I2.i1.p1.2.m2.1b"><times id="S7.I2.i1.p1.2.m2.1.1.cmml" xref="S7.I2.i1.p1.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.I2.i1.p1.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.I2.i1.p1.2.m2.1d">×</annotation></semantics></math>
compared to SGLang under the same request rate. This is because RAGCache utilizes the GPU memory
and host memory to cache the KV cache of hot documents and avoids frequent recomputation.</p>
</div>
</li>
<li class="ltx_item" id="S7.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S7.I2.i2.p1">
<p class="ltx_p" id="S7.I2.i2.p1.2">Due to faster request processing, RAGCache achieves 1.3–2.1<math alttext="\times" class="ltx_Math" display="inline" id="S7.I2.i2.p1.1.m1.1"><semantics id="S7.I2.i2.p1.1.m1.1a"><mo id="S7.I2.i2.p1.1.m1.1.1" xref="S7.I2.i2.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.I2.i2.p1.1.m1.1b"><times id="S7.I2.i2.p1.1.m1.1.1.cmml" xref="S7.I2.i2.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.I2.i2.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.I2.i2.p1.1.m1.1d">×</annotation></semantics></math> higher throughput
than vLLM and 1.2–1.8<math alttext="\times" class="ltx_Math" display="inline" id="S7.I2.i2.p1.2.m2.1"><semantics id="S7.I2.i2.p1.2.m2.1a"><mo id="S7.I2.i2.p1.2.m2.1.1" xref="S7.I2.i2.p1.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.I2.i2.p1.2.m2.1b"><times id="S7.I2.i2.p1.2.m2.1.1.cmml" xref="S7.I2.i2.p1.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.I2.i2.p1.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.I2.i2.p1.2.m2.1d">×</annotation></semantics></math> higher throughput than SGLang.</p>
</div>
</li>
<li class="ltx_item" id="S7.I2.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S7.I2.i3.p1">
<p class="ltx_p" id="S7.I2.i3.p1.1">RAGCache outperforms the baselines across models with varying attention mechanisms
on different datasets.</p>
</div>
</li>
</ul>
<p class="ltx_p" id="S7.SS1.p1.1">The results also reflect the differences between the two models and datasets.
Notably, the performance gap between RAGCache and vLLM is greater for Mistral-7B than for LLaMA2-7B
This is because LLaMA2-7B has a KV cache size 4<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS1.p1.1.m1.1"><semantics id="S7.SS1.p1.1.m1.1a"><mo id="S7.SS1.p1.1.m1.1.1" xref="S7.SS1.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS1.p1.1.m1.1b"><times id="S7.SS1.p1.1.m1.1.1.cmml" xref="S7.SS1.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS1.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS1.p1.1.m1.1d">×</annotation></semantics></math> that of Mistral-7B for the same token count.
resulting in a lower cache hit rate for LLaMA2-7B with the same cache size.
According to our characterization in § <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.SS2" title="3.2. Optimizations Opportunities ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">3.2</span></a>,
MMLU benefits more from document caching than Natural Questions,
with a wider performance improvement for MMLU than for Natural Questions.
SGLang performs closely to vLLM for Natural Questions
because the limited GPU memory restricts document locality.
RAGCache, however, with its multilevel caching and the adapted knowledge tree,
outperforms in both datasets.</p>
</div>
<figure class="ltx_figure" id="S7.F14">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_missing ltx_missing_image" id="S7.F14.g1" src=""/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F14.sf1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F14.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S7.F14.sf1.3.2" style="font-size:90%;">Mistral-7B.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F14.sf2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F14.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S7.F14.sf2.3.2" style="font-size:90%;">LLaMA-2-7B.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F14.2.1.1" style="font-size:90%;">Figure 14</span>. </span><span class="ltx_text" id="S7.F14.3.2" style="font-size:90%;">Overall performance on Natural Questions.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S7.F15">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_missing ltx_missing_image" id="S7.F15.g1" src=""/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F15.sf1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F15.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S7.F15.sf1.3.2" style="font-size:90%;">Top-1.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F15.sf2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F15.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S7.F15.sf2.3.2" style="font-size:90%;">Top-3.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F15.sf3">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F15.sf3.2.1.1" style="font-size:90%;">(c)</span> </span><span class="ltx_text" id="S7.F15.sf3.3.2" style="font-size:90%;">Top-5.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F15.4.2.1" style="font-size:90%;">Figure 15</span>. </span><span class="ltx_text" id="S7.F15.2.1" style="font-size:90%;">Performance with different top-<math alttext="k" class="ltx_Math" display="inline" id="S7.F15.2.1.m1.1"><semantics id="S7.F15.2.1.m1.1b"><mi id="S7.F15.2.1.m1.1.1" xref="S7.F15.2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S7.F15.2.1.m1.1c"><ci id="S7.F15.2.1.m1.1.1.cmml" xref="S7.F15.2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.F15.2.1.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="S7.F15.2.1.m1.1e">italic_k</annotation></semantics></math> values.</span></figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S7.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">7.2. </span>Case Study</h3>
<div class="ltx_para" id="S7.SS2.p1">
<p class="ltx_p" id="S7.SS2.p1.1">We then conduct two case studies to demonstrate the benefits of RAGCache over the baselines
under general settings. We use MMLU and Mistral-7B in the case studies.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.SS2.p2">
<p class="ltx_p" id="S7.SS2.p2.6"><span class="ltx_text ltx_font_bold" id="S7.SS2.p2.1.1">Different top-<math alttext="k" class="ltx_Math" display="inline" id="S7.SS2.p2.1.1.m1.1"><semantics id="S7.SS2.p2.1.1.m1.1a"><mi id="S7.SS2.p2.1.1.m1.1.1" xref="S7.SS2.p2.1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S7.SS2.p2.1.1.m1.1b"><ci id="S7.SS2.p2.1.1.m1.1.1.cmml" xref="S7.SS2.p2.1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p2.1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p2.1.1.m1.1d">italic_k</annotation></semantics></math> values.</span> Users may have varying requirements for the number of retrieved documents.
We evaluate the performance of RAGCache and the baselines with commonly used top-<math alttext="k" class="ltx_Math" display="inline" id="S7.SS2.p2.2.m1.1"><semantics id="S7.SS2.p2.2.m1.1a"><mi id="S7.SS2.p2.2.m1.1.1" xref="S7.SS2.p2.2.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S7.SS2.p2.2.m1.1b"><ci id="S7.SS2.p2.2.m1.1.1.cmml" xref="S7.SS2.p2.2.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p2.2.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p2.2.m1.1d">italic_k</annotation></semantics></math> values: 1, 3, and 5.
We set the maximum batch size to 4 and truncate the documents in the top-5 experiment to fit within GPU capacity
limits. Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.F15" title="Figure 15 ‣ 7.1. Overall Performance ‣ 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">15</span></a> shows that RAGCache outperforms vLLM
by 1.7–3.1<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS2.p2.3.m2.1"><semantics id="S7.SS2.p2.3.m2.1a"><mo id="S7.SS2.p2.3.m2.1.1" xref="S7.SS2.p2.3.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS2.p2.3.m2.1b"><times id="S7.SS2.p2.3.m2.1.1.cmml" xref="S7.SS2.p2.3.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p2.3.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p2.3.m2.1d">×</annotation></semantics></math> and SGLang by 1.2–2.5<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS2.p2.4.m3.1"><semantics id="S7.SS2.p2.4.m3.1a"><mo id="S7.SS2.p2.4.m3.1.1" xref="S7.SS2.p2.4.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS2.p2.4.m3.1b"><times id="S7.SS2.p2.4.m3.1.1.cmml" xref="S7.SS2.p2.4.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p2.4.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p2.4.m3.1d">×</annotation></semantics></math> in average TTFT across these top-<math alttext="k" class="ltx_Math" display="inline" id="S7.SS2.p2.5.m4.1"><semantics id="S7.SS2.p2.5.m4.1a"><mi id="S7.SS2.p2.5.m4.1.1" xref="S7.SS2.p2.5.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S7.SS2.p2.5.m4.1b"><ci id="S7.SS2.p2.5.m4.1.1.cmml" xref="S7.SS2.p2.5.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p2.5.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p2.5.m4.1d">italic_k</annotation></semantics></math> values.
Despite the factorial growth in document permutations with increasing top-<math alttext="k" class="ltx_Math" display="inline" id="S7.SS2.p2.6.m5.1"><semantics id="S7.SS2.p2.6.m5.1a"><mi id="S7.SS2.p2.6.m5.1.1" xref="S7.SS2.p2.6.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S7.SS2.p2.6.m5.1b"><ci id="S7.SS2.p2.6.m5.1.1.cmml" xref="S7.SS2.p2.6.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p2.6.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p2.6.m5.1d">italic_k</annotation></semantics></math> values,
RAGCache maintains its advantage by caching frequently-used documents. This is because the knowledge tree
always evicts the node furthest from the root, ensuring that the most frequently used prefixes
remain in the cache.</p>
</div>
<figure class="ltx_figure" id="S7.F16">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_missing ltx_missing_image" id="S7.F16.g1" src=""/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F16.sf1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F16.sf1.4.2.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S7.F16.sf1.2.1" style="font-size:90%;">Mixtral-8<math alttext="\times" class="ltx_Math" display="inline" id="S7.F16.sf1.2.1.m1.1"><semantics id="S7.F16.sf1.2.1.m1.1b"><mo id="S7.F16.sf1.2.1.m1.1.1" xref="S7.F16.sf1.2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.F16.sf1.2.1.m1.1c"><times id="S7.F16.sf1.2.1.m1.1.1.cmml" xref="S7.F16.sf1.2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.F16.sf1.2.1.m1.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S7.F16.sf1.2.1.m1.1e">×</annotation></semantics></math>7B.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F16.sf2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F16.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S7.F16.sf2.3.2" style="font-size:90%;">LLaMA2-70B.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F16.2.1.1" style="font-size:90%;">Figure 16</span>. </span><span class="ltx_text" id="S7.F16.3.2" style="font-size:90%;">Performance under large models.</span></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S7.SS2.p3">
<p class="ltx_p" id="S7.SS2.p3.6"><span class="ltx_text ltx_font_bold" id="S7.SS2.p3.6.1">Large models.</span> The second case study evaluates RAGCache with larger models using MMLU as the workload.
We deploy Mixtral-8<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS2.p3.1.m1.1"><semantics id="S7.SS2.p3.1.m1.1a"><mo id="S7.SS2.p3.1.m1.1.1" xref="S7.SS2.p3.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS2.p3.1.m1.1b"><times id="S7.SS2.p3.1.m1.1.1.cmml" xref="S7.SS2.p3.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p3.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p3.1.m1.1d">×</annotation></semantics></math>7B and LLaMA2-70B on two H800 80GB GPUs.
For each model, we set the maximum batch size to the lesser of what fits in GPU memory or fully utilizes the SMs
(e.g., 8 for Mixtral-8<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS2.p3.2.m2.1"><semantics id="S7.SS2.p3.2.m2.1a"><mo id="S7.SS2.p3.2.m2.1.1" xref="S7.SS2.p3.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS2.p3.2.m2.1b"><times id="S7.SS2.p3.2.m2.1.1.cmml" xref="S7.SS2.p3.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p3.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p3.2.m2.1d">×</annotation></semantics></math>7B and 4 for LLaMA2-70B).
With a limited budget, we run the experiments with four different request rates per model and
set a TTFT SLO at 5<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS2.p3.3.m3.1"><semantics id="S7.SS2.p3.3.m3.1a"><mo id="S7.SS2.p3.3.m3.1.1" xref="S7.SS2.p3.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS2.p3.3.m3.1b"><times id="S7.SS2.p3.3.m3.1.1.cmml" xref="S7.SS2.p3.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p3.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p3.3.m3.1d">×</annotation></semantics></math> the TTFT of the lowest request rate.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.F16" title="Figure 16 ‣ 7.2. Case Study ‣ 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">16</span></a> shows that under low request rates, RAGCache reduces the average
TTFT by 1.4–2.1<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS2.p3.4.m4.1"><semantics id="S7.SS2.p3.4.m4.1a"><mo id="S7.SS2.p3.4.m4.1.1" xref="S7.SS2.p3.4.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS2.p3.4.m4.1b"><times id="S7.SS2.p3.4.m4.1.1.cmml" xref="S7.SS2.p3.4.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p3.4.m4.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p3.4.m4.1d">×</annotation></semantics></math> compared to vLLM. vLLM fails to meet the SLO above 2 and 1.5 requests per second for
Mixtral-8<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS2.p3.5.m5.1"><semantics id="S7.SS2.p3.5.m5.1a"><mo id="S7.SS2.p3.5.m5.1.1" xref="S7.SS2.p3.5.m5.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS2.p3.5.m5.1b"><times id="S7.SS2.p3.5.m5.1.1.cmml" xref="S7.SS2.p3.5.m5.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p3.5.m5.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p3.5.m5.1d">×</annotation></semantics></math>7B and LLaMA2-70B, respectively, whereas RAGCache maintains the TTFT below 1.4 seconds across varying request rates.
SGLang performs better on H800 than on A10G GPUs due to increased GPU memory for caching, but
RAGCache still surpasses SGlang by 1.2–2.6<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS2.p3.6.m6.1"><semantics id="S7.SS2.p3.6.m6.1a"><mo id="S7.SS2.p3.6.m6.1.1" xref="S7.SS2.p3.6.m6.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS2.p3.6.m6.1b"><times id="S7.SS2.p3.6.m6.1.1.cmml" xref="S7.SS2.p3.6.m6.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS2.p3.6.m6.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS2.p3.6.m6.1d">×</annotation></semantics></math> in average TTFT.</p>
</div>
</section>
<section class="ltx_subsection" id="S7.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">7.3. </span>Ablation Study</h3>
<div class="ltx_para ltx_noindent" id="S7.SS3.p1">
<p class="ltx_p" id="S7.SS3.p1.6"><span class="ltx_text ltx_font_bold" id="S7.SS3.p1.6.1">Prefix-aware GDSF policy.</span>
We compare RAGCache with versions of RAGCache that use native GDSF, LRU, and LFU as the replacement policy.
For the GDSF policy, we set the recomputation cost of a document proportional to the document size,
which aligns with our profiling results in Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S3.F2" title="Figure 2 ‣ 3. RAG System Characterization ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">2</span></a>.
We vary the host memory size for caching from 8 GiB to 128 GiB, set the request rate to 0.8 req/s,
and report the hit rate and average TTFT. The hit rate for top-2 retrieval is defined as
the ratio of the number of hit documents to the number of retrieved documents. For example,
if the stored document sequence is <math alttext="[D_{1},D_{2}]" class="ltx_Math" display="inline" id="S7.SS3.p1.1.m1.2"><semantics id="S7.SS3.p1.1.m1.2a"><mrow id="S7.SS3.p1.1.m1.2.2.2" xref="S7.SS3.p1.1.m1.2.2.3.cmml"><mo id="S7.SS3.p1.1.m1.2.2.2.3" stretchy="false" xref="S7.SS3.p1.1.m1.2.2.3.cmml">[</mo><msub id="S7.SS3.p1.1.m1.1.1.1.1" xref="S7.SS3.p1.1.m1.1.1.1.1.cmml"><mi id="S7.SS3.p1.1.m1.1.1.1.1.2" xref="S7.SS3.p1.1.m1.1.1.1.1.2.cmml">D</mi><mn id="S7.SS3.p1.1.m1.1.1.1.1.3" xref="S7.SS3.p1.1.m1.1.1.1.1.3.cmml">1</mn></msub><mo id="S7.SS3.p1.1.m1.2.2.2.4" xref="S7.SS3.p1.1.m1.2.2.3.cmml">,</mo><msub id="S7.SS3.p1.1.m1.2.2.2.2" xref="S7.SS3.p1.1.m1.2.2.2.2.cmml"><mi id="S7.SS3.p1.1.m1.2.2.2.2.2" xref="S7.SS3.p1.1.m1.2.2.2.2.2.cmml">D</mi><mn id="S7.SS3.p1.1.m1.2.2.2.2.3" xref="S7.SS3.p1.1.m1.2.2.2.2.3.cmml">2</mn></msub><mo id="S7.SS3.p1.1.m1.2.2.2.5" stretchy="false" xref="S7.SS3.p1.1.m1.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S7.SS3.p1.1.m1.2b"><interval closure="closed" id="S7.SS3.p1.1.m1.2.2.3.cmml" xref="S7.SS3.p1.1.m1.2.2.2"><apply id="S7.SS3.p1.1.m1.1.1.1.1.cmml" xref="S7.SS3.p1.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S7.SS3.p1.1.m1.1.1.1.1.1.cmml" xref="S7.SS3.p1.1.m1.1.1.1.1">subscript</csymbol><ci id="S7.SS3.p1.1.m1.1.1.1.1.2.cmml" xref="S7.SS3.p1.1.m1.1.1.1.1.2">𝐷</ci><cn id="S7.SS3.p1.1.m1.1.1.1.1.3.cmml" type="integer" xref="S7.SS3.p1.1.m1.1.1.1.1.3">1</cn></apply><apply id="S7.SS3.p1.1.m1.2.2.2.2.cmml" xref="S7.SS3.p1.1.m1.2.2.2.2"><csymbol cd="ambiguous" id="S7.SS3.p1.1.m1.2.2.2.2.1.cmml" xref="S7.SS3.p1.1.m1.2.2.2.2">subscript</csymbol><ci id="S7.SS3.p1.1.m1.2.2.2.2.2.cmml" xref="S7.SS3.p1.1.m1.2.2.2.2.2">𝐷</ci><cn id="S7.SS3.p1.1.m1.2.2.2.2.3.cmml" type="integer" xref="S7.SS3.p1.1.m1.2.2.2.2.3">2</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p1.1.m1.2c">[D_{1},D_{2}]</annotation><annotation encoding="application/x-llamapun" id="S7.SS3.p1.1.m1.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ]</annotation></semantics></math> and the requested one is <math alttext="[D_{1},D_{3}]" class="ltx_Math" display="inline" id="S7.SS3.p1.2.m2.2"><semantics id="S7.SS3.p1.2.m2.2a"><mrow id="S7.SS3.p1.2.m2.2.2.2" xref="S7.SS3.p1.2.m2.2.2.3.cmml"><mo id="S7.SS3.p1.2.m2.2.2.2.3" stretchy="false" xref="S7.SS3.p1.2.m2.2.2.3.cmml">[</mo><msub id="S7.SS3.p1.2.m2.1.1.1.1" xref="S7.SS3.p1.2.m2.1.1.1.1.cmml"><mi id="S7.SS3.p1.2.m2.1.1.1.1.2" xref="S7.SS3.p1.2.m2.1.1.1.1.2.cmml">D</mi><mn id="S7.SS3.p1.2.m2.1.1.1.1.3" xref="S7.SS3.p1.2.m2.1.1.1.1.3.cmml">1</mn></msub><mo id="S7.SS3.p1.2.m2.2.2.2.4" xref="S7.SS3.p1.2.m2.2.2.3.cmml">,</mo><msub id="S7.SS3.p1.2.m2.2.2.2.2" xref="S7.SS3.p1.2.m2.2.2.2.2.cmml"><mi id="S7.SS3.p1.2.m2.2.2.2.2.2" xref="S7.SS3.p1.2.m2.2.2.2.2.2.cmml">D</mi><mn id="S7.SS3.p1.2.m2.2.2.2.2.3" xref="S7.SS3.p1.2.m2.2.2.2.2.3.cmml">3</mn></msub><mo id="S7.SS3.p1.2.m2.2.2.2.5" stretchy="false" xref="S7.SS3.p1.2.m2.2.2.3.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S7.SS3.p1.2.m2.2b"><interval closure="closed" id="S7.SS3.p1.2.m2.2.2.3.cmml" xref="S7.SS3.p1.2.m2.2.2.2"><apply id="S7.SS3.p1.2.m2.1.1.1.1.cmml" xref="S7.SS3.p1.2.m2.1.1.1.1"><csymbol cd="ambiguous" id="S7.SS3.p1.2.m2.1.1.1.1.1.cmml" xref="S7.SS3.p1.2.m2.1.1.1.1">subscript</csymbol><ci id="S7.SS3.p1.2.m2.1.1.1.1.2.cmml" xref="S7.SS3.p1.2.m2.1.1.1.1.2">𝐷</ci><cn id="S7.SS3.p1.2.m2.1.1.1.1.3.cmml" type="integer" xref="S7.SS3.p1.2.m2.1.1.1.1.3">1</cn></apply><apply id="S7.SS3.p1.2.m2.2.2.2.2.cmml" xref="S7.SS3.p1.2.m2.2.2.2.2"><csymbol cd="ambiguous" id="S7.SS3.p1.2.m2.2.2.2.2.1.cmml" xref="S7.SS3.p1.2.m2.2.2.2.2">subscript</csymbol><ci id="S7.SS3.p1.2.m2.2.2.2.2.2.cmml" xref="S7.SS3.p1.2.m2.2.2.2.2.2">𝐷</ci><cn id="S7.SS3.p1.2.m2.2.2.2.2.3.cmml" type="integer" xref="S7.SS3.p1.2.m2.2.2.2.2.3">3</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p1.2.m2.2c">[D_{1},D_{3}]</annotation><annotation encoding="application/x-llamapun" id="S7.SS3.p1.2.m2.2d">[ italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_D start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT ]</annotation></semantics></math>, then
the hit rate would be 50%.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.F17" title="Figure 17 ‣ 7.3. Ablation Study ‣ 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">17</span></a> shows the hit rate for MMLU and Natural Questions,
and Table <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.T2" title="Table 2 ‣ 7.3. Ablation Study ‣ 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">2</span></a> lists the corresponding average TTFT.
PGDSF achieves the highest hit rate across different host memory sizes,
with a 1.02–1.32<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS3.p1.3.m3.1"><semantics id="S7.SS3.p1.3.m3.1a"><mo id="S7.SS3.p1.3.m3.1.1" xref="S7.SS3.p1.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS3.p1.3.m3.1b"><times id="S7.SS3.p1.3.m3.1.1.cmml" xref="S7.SS3.p1.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p1.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS3.p1.3.m3.1d">×</annotation></semantics></math> improvement over GDSF, 1.06–1.62<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS3.p1.4.m4.1"><semantics id="S7.SS3.p1.4.m4.1a"><mo id="S7.SS3.p1.4.m4.1.1" xref="S7.SS3.p1.4.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS3.p1.4.m4.1b"><times id="S7.SS3.p1.4.m4.1.1.cmml" xref="S7.SS3.p1.4.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p1.4.m4.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS3.p1.4.m4.1d">×</annotation></semantics></math> improvement over LRU, and
1.06–1.75<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS3.p1.5.m5.1"><semantics id="S7.SS3.p1.5.m5.1a"><mo id="S7.SS3.p1.5.m5.1.1" xref="S7.SS3.p1.5.m5.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS3.p1.5.m5.1b"><times id="S7.SS3.p1.5.m5.1.1.cmml" xref="S7.SS3.p1.5.m5.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p1.5.m5.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS3.p1.5.m5.1d">×</annotation></semantics></math> improvement over LFU.
This is because PGDSF captures the varying sizes, access patterns, and recomputation costs of different
document prefixes.
With the higher hit rate, RAGCache achieves 1.05–1.29<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS3.p1.6.m6.1"><semantics id="S7.SS3.p1.6.m6.1a"><mo id="S7.SS3.p1.6.m6.1.1" xref="S7.SS3.p1.6.m6.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS3.p1.6.m6.1b"><times id="S7.SS3.p1.6.m6.1.1.cmml" xref="S7.SS3.p1.6.m6.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p1.6.m6.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS3.p1.6.m6.1d">×</annotation></semantics></math> lower average TTFT than the
baseline policies.</p>
</div>
<div class="ltx_para ltx_noindent" id="S7.SS3.p2">
<p class="ltx_p" id="S7.SS3.p2.1"><span class="ltx_text ltx_font_bold" id="S7.SS3.p2.1.1">Cache-aware reordering.</span> Then we evaluate the impact of cache-aware reordering.
Reordering works when the request queue is saturated. We set the request rate to 2.5 req/s for MMLU and
1.4 req/s for Natural Questions, which are slightly higher than the throughput of RAGCache.
We set the reordering window size to 32 and vary the host memory size from 16 GiB to 128 GiB.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.F18" title="Figure 18 ‣ 7.4. Scheduling Time ‣ 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">18</span></a> shows that RAGCache reduces the average TTFT by 1.2–2.1<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS3.p2.1.m1.1"><semantics id="S7.SS3.p2.1.m1.1a"><mo id="S7.SS3.p2.1.m1.1.1" xref="S7.SS3.p2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS3.p2.1.m1.1b"><times id="S7.SS3.p2.1.m1.1.1.cmml" xref="S7.SS3.p2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS3.p2.1.m1.1d">×</annotation></semantics></math> with cache-aware reordering,
which demonstrates its effectiveness under high request rates.</p>
</div>
<figure class="ltx_figure" id="S7.F17">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_missing ltx_missing_image" id="S7.F17.g1" src=""/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F17.sf1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F17.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S7.F17.sf1.3.2" style="font-size:90%;">MMLU.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F17.sf2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F17.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S7.F17.sf2.3.2" style="font-size:90%;">Natural Questions.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F17.2.1.1" style="font-size:90%;">Figure 17</span>. </span><span class="ltx_text" id="S7.F17.3.2" style="font-size:90%;">Ablation study on cache replacement policy.</span></figcaption>
</figure>
<figure class="ltx_table" id="S7.T2">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S7.T2.2" style="width:433.6pt;height:141.3pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(23.5pt,-7.7pt) scale(1.12167118259087,1.12167118259087) ;">
<table class="ltx_tabular ltx_align_middle" id="S7.T2.2.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S7.T2.2.1.1.1">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S7.T2.2.1.1.1.1" rowspan="2"><span class="ltx_text" id="S7.T2.2.1.1.1.1.1">
<span class="ltx_tabular ltx_align_middle" id="S7.T2.2.1.1.1.1.1.1">
<span class="ltx_tr" id="S7.T2.2.1.1.1.1.1.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S7.T2.2.1.1.1.1.1.1.1.1">Host Memory</span></span>
<span class="ltx_tr" id="S7.T2.2.1.1.1.1.1.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S7.T2.2.1.1.1.1.1.1.2.1">Size</span></span>
</span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" colspan="4" id="S7.T2.2.1.1.1.2">MMLU</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="4" id="S7.T2.2.1.1.1.3">Natural Questions</td>
</tr>
<tr class="ltx_tr" id="S7.T2.2.1.2.2">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.2.2.1"><span class="ltx_text ltx_font_bold" id="S7.T2.2.1.2.2.1.1">PGDSF</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.2.2.2"><span class="ltx_text ltx_font_bold" id="S7.T2.2.1.2.2.2.1">GDSF</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.2.2.3"><span class="ltx_text ltx_font_bold" id="S7.T2.2.1.2.2.3.1">LRU</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.2.2.4"><span class="ltx_text ltx_font_bold" id="S7.T2.2.1.2.2.4.1">LFU</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.2.2.5"><span class="ltx_text ltx_font_bold" id="S7.T2.2.1.2.2.5.1">PGDSF</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.2.2.6"><span class="ltx_text ltx_font_bold" id="S7.T2.2.1.2.2.6.1">GDSF</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.2.2.7"><span class="ltx_text ltx_font_bold" id="S7.T2.2.1.2.2.7.1">LRU</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S7.T2.2.1.2.2.8"><span class="ltx_text ltx_font_bold" id="S7.T2.2.1.2.2.8.1">LFU</span></td>
</tr>
<tr class="ltx_tr" id="S7.T2.2.1.3.3">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.3.3.1">8 GiB</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.3.3.2">1.38</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.3.3.3">1.68</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.3.3.4">1.78</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.3.3.5">1.81</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.3.3.6">2.85</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.3.3.7">3.35</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S7.T2.2.1.3.3.8">3.41</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S7.T2.2.1.3.3.9">3.36</td>
</tr>
<tr class="ltx_tr" id="S7.T2.2.1.4.4">
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.4.4.1">16 GiB</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.4.4.2">1.32</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.4.4.3">1.55</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.4.4.4">1.61</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.4.4.5">1.63</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.4.4.6">2.50</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.4.4.7">2.89</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.4.4.8">2.92</td>
<td class="ltx_td ltx_align_center" id="S7.T2.2.1.4.4.9">2.98</td>
</tr>
<tr class="ltx_tr" id="S7.T2.2.1.5.5">
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.5.5.1">32 GiB</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.5.5.2">1.23</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.5.5.3">1.45</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.5.5.4">1.50</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.5.5.5">1.49</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.5.5.6">2.00</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.5.5.7">2.09</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.5.5.8">2.25</td>
<td class="ltx_td ltx_align_center" id="S7.T2.2.1.5.5.9">2.20</td>
</tr>
<tr class="ltx_tr" id="S7.T2.2.1.6.6">
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.6.6.1">64 GiB</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.6.6.2">1.06</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.6.6.3">1.27</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.6.6.4">1.28</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.6.6.5">1.29</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.6.6.6">1.32</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.6.6.7">1.47</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S7.T2.2.1.6.6.8">1.56</td>
<td class="ltx_td ltx_align_center" id="S7.T2.2.1.6.6.9">1.55</td>
</tr>
<tr class="ltx_tr" id="S7.T2.2.1.7.7">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S7.T2.2.1.7.7.1">128 GiB</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S7.T2.2.1.7.7.2">0.83</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S7.T2.2.1.7.7.3">0.98</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S7.T2.2.1.7.7.4">1.01</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S7.T2.2.1.7.7.5">1.03</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S7.T2.2.1.7.7.6">0.78</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S7.T2.2.1.7.7.7">0.92</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S7.T2.2.1.7.7.8">0.95</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S7.T2.2.1.7.7.9">0.95</td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S7.T2.3.1.1" style="font-size:90%;">Table 2</span>. </span><span class="ltx_text" id="S7.T2.4.2" style="font-size:90%;">Average TTFT (seconds) of different replacement policies with varying host memory size.</span></figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S7.SS3.p3">
<p class="ltx_p" id="S7.SS3.p3.2"><span class="ltx_text ltx_font_bold" id="S7.SS3.p3.2.1">Dynamic speculative pipelining.</span> Finally, we evaluate the effectiveness of dynamic
speculative pipelining against a baseline, No Dynamic Speculative Pipelining (No DSP),
which waits for vector search completion before starting LLM generation.
We vary the ratio of the number of searched vectors to the total number of vectors from 12.5% to 100%.
Note that while the search accuracy increases with the vector search ratio, the search time also extends.
We use MMLU and Natural Questions as the workloads and set the request rate to 0.1 req/s.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S7.F19" title="Figure 19 ‣ 7.4. Scheduling Time ‣ 7. Evaluation ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">19</span></a> demonstrates that RAGCache achieves up to 1.6<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS3.p3.1.m1.1"><semantics id="S7.SS3.p3.1.m1.1a"><mo id="S7.SS3.p3.1.m1.1.1" xref="S7.SS3.p3.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS3.p3.1.m1.1b"><times id="S7.SS3.p3.1.m1.1.1.cmml" xref="S7.SS3.p3.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p3.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS3.p3.1.m1.1d">×</annotation></semantics></math>
TTFT reduction with dynamic speculative pipelining. Table <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S9.T3" title="Table 3 ‣ 9. Related Work ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">3</span></a> presents the
average non-overlapping vector search time, which refers to the duration that the vector search
does not overlap with the LLM generation using the final retrieval result.
Dynamic speculative pipelining allows RAGCache to decrease non-overlapping vector search time by
1.5–4.3<math alttext="\times" class="ltx_Math" display="inline" id="S7.SS3.p3.2.m2.1"><semantics id="S7.SS3.p3.2.m2.1a"><mo id="S7.SS3.p3.2.m2.1.1" xref="S7.SS3.p3.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S7.SS3.p3.2.m2.1b"><times id="S7.SS3.p3.2.m2.1.1.cmml" xref="S7.SS3.p3.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S7.SS3.p3.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S7.SS3.p3.2.m2.1d">×</annotation></semantics></math> and leads to a lower TTFT.</p>
</div>
</section>
<section class="ltx_subsection" id="S7.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">7.4. </span>Scheduling Time</h3>
<div class="ltx_para" id="S7.SS4.p1">
<p class="ltx_p" id="S7.SS4.p1.1">We measure RAGCache’s scheduling time, including the time for knowledge tree lookup and update,
request reordering, and speculative pipelining decisions.
Using MMLU as the workload and Mistral-7B as the model, we range the request rate
from 0.5 to 2 req/s. Table <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#S9.T4" title="Table 4 ‣ 9. Related Work ‣ RAGCache: Efficient Knowledge Caching for Retrieval-Augmented Generation"><span class="ltx_text ltx_ref_tag">4</span></a> indicates that the scheduling time
remains below one millisecond across all request rates, which is negligible compared to the second-level TTFT.</p>
</div>
<figure class="ltx_figure" id="S7.F18">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_missing ltx_missing_image" id="S7.F18.g1" src=""/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F18.sf1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F18.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S7.F18.sf1.3.2" style="font-size:90%;">MMLU.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F18.sf2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F18.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S7.F18.sf2.3.2" style="font-size:90%;">Natural Questions.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F18.2.1.1" style="font-size:90%;">Figure 18</span>. </span><span class="ltx_text" id="S7.F18.3.2" style="font-size:90%;">Ablation study on cache-aware reordering.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S7.F19">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_missing ltx_missing_image" id="S7.F19.g1" src=""/></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F19.sf1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F19.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S7.F19.sf1.3.2" style="font-size:90%;">MMLU.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S7.F19.sf2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F19.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S7.F19.sf2.3.2" style="font-size:90%;">Natural Questions.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S7.F19.2.1.1" style="font-size:90%;">Figure 19</span>. </span><span class="ltx_text" id="S7.F19.3.2" style="font-size:90%;">Ablation study on speculative pipelining.</span></figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S8">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">8. </span>Discussion</h2>
<div class="ltx_para ltx_noindent" id="S8.p1">
<p class="ltx_p" id="S8.p1.1"><span class="ltx_text ltx_font_bold" id="S8.p1.1.1">Time per output token (TPOT).</span> In addition to time to first token (TTFT),
TPOT is crucial for LLM serving <cite class="ltx_cite ltx_citemacro_citep">(Zhong et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib59" title="">2024</a>)</cite>.
RAG augments the request with documents retrieved from the external knowledge base, which significantly increases
the input length and thus the latency of the prefill phase, i.e., TTFT.
Consequently, the primary concern for RAG systems is the prolonged TTFT due to the extended input length.
RAGCache reduces TTFT by caching the KV cache of the most frequently retrieved documents and
can also lower TPOT by accelerating the prefill iteration,
as decoding iterations typically take far less time than the prefill iteration <cite class="ltx_cite ltx_citemacro_citep">(Wu
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib46" title="">2023</a>)</cite>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S8.p2">
<p class="ltx_p" id="S8.p2.2"><span class="ltx_text ltx_font_bold" id="S8.p2.1.1">Large top-<math alttext="k" class="ltx_Math" display="inline" id="S8.p2.1.1.m1.1"><semantics id="S8.p2.1.1.m1.1a"><mi id="S8.p2.1.1.m1.1.1" xref="S8.p2.1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S8.p2.1.1.m1.1b"><ci id="S8.p2.1.1.m1.1.1.cmml" xref="S8.p2.1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S8.p2.1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S8.p2.1.1.m1.1d">italic_k</annotation></semantics></math>.</span> As the top-k value increases, the number of document permutations explodes in factorial growth,
making them less likely to be reused. RAGCache mitigates this by caching documents with a lower top-<math alttext="k" class="ltx_Math" display="inline" id="S8.p2.2.m1.1"><semantics id="S8.p2.2.m1.1a"><mi id="S8.p2.2.m1.1.1" xref="S8.p2.2.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S8.p2.2.m1.1b"><ci id="S8.p2.2.m1.1.1.cmml" xref="S8.p2.2.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S8.p2.2.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S8.p2.2.m1.1d">italic_k</annotation></semantics></math> value
(e.g., caching the top-3 documents for requests with top-5 documents), thereby achieving a balance between
hit rate and cache efficiency.</p>
</div>
</section>
<section class="ltx_section" id="S9">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">9. </span>Related Work</h2>
<div class="ltx_para ltx_noindent" id="S9.p1">
<p class="ltx_p" id="S9.p1.1"><span class="ltx_text ltx_font_bold" id="S9.p1.1.1">RAG.</span> RAG <cite class="ltx_cite ltx_citemacro_citep">(Lewis
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib28" title="">2020</a>; Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib23" title="">2024b</a>; Borgeaud
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib9" title="">2022</a>; Ram et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib38" title="">2023</a>; Trivedi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib43" title="">2022</a>; lan, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib2" title="">2024</a>)</cite>
enhances the generation quality of LLMs by incorporating
relevant knowledge from external databases.
Several works <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib23" title="">2024b</a>; Ram et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib38" title="">2023</a>; Trivedi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib43" title="">2022</a>; Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib57" title="">2024d</a>)</cite> suggest
iterative retrieval throughout generation to further improve the response quality.
RAGCache supports iterative retrieval by treating the intermediate iterations as separate requests and caching
the corresponding KV cache of the documents.</p>
</div>
<div class="ltx_para ltx_noindent" id="S9.p2">
<p class="ltx_p" id="S9.p2.1"><span class="ltx_text ltx_font_bold" id="S9.p2.1.1">Vector search.</span> RAG systems convert user prompts into vectors and
uses approximate nearest neighbor (ANN) indexes like IVF <cite class="ltx_cite ltx_citemacro_citep">(Babenko and
Lempitsky, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib8" title="">2014</a>; Chen et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib12" title="">2021</a>; Zhang
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib54" title="">2023b</a>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib55" title="">2024b</a>)</cite>
and graph indexes <cite class="ltx_cite ltx_citemacro_citep">(Malkov and
Yashunin, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib35" title="">2018</a>; Fu
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib16" title="">2019</a>; Jayaram Subramanya et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib20" title="">2019</a>)</cite> for efficient and accurate similarity search.
RAGCache extracts the temporary search results for speculative LLM generation and thus pipelines
the search process with LLM inference.</p>
</div>
<div class="ltx_para ltx_noindent" id="S9.p3">
<p class="ltx_p" id="S9.p3.1"><span class="ltx_text ltx_font_bold" id="S9.p3.1.1">KV cache management.</span> KV cache is widely used to accelerate the decoding phase of LLM
inference <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>; Yu
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib51" title="">2022</a>; Zhong et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib59" title="">2024</a>; Wu
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib46" title="">2023</a>; Xiao
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib47" title="">2023</a>)</cite>.
Recent efforts aim to reduce the KV cache’s memory footprint by
quantization <cite class="ltx_cite ltx_citemacro_citep">(Dettmers et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib15" title="">2022</a>)</cite>, compression <cite class="ltx_cite ltx_citemacro_citep">(Li et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib30" title="">2020a</a>; Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib33" title="">2024</a>; Ge
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib17" title="">2023</a>)</cite>, and
self-attention with a subset of tokens <cite class="ltx_cite ltx_citemacro_citep">(Xiao
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib47" title="">2023</a>; Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib56" title="">2024c</a>)</cite>.
These methods introduce approximation to the generation process, while RAGCache preserves the exact
KV cache of documents without affecting generation quality.
Inspired by virtual memory in operating systems, vLLM <cite class="ltx_cite ltx_citemacro_citep">(Kwon et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib27" title="">2023</a>)</cite> manages the KV
cache at page granularity and proposes PagedAttention to prevent external fragmentation.
RAGCache integrates the page-level management for KV cache sharing and improves over vLLM by
leveraging the characteristics of RAG to cache the KV cache of the knowledge documents.</p>
</div>
<div class="ltx_para ltx_noindent" id="S9.p4">
<p class="ltx_p" id="S9.p4.1"><span class="ltx_text ltx_font_bold" id="S9.p4.1.1">KV cache reusing.</span> Recent efforts <cite class="ltx_cite ltx_citemacro_citep">(Gim et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib18" title="">2023</a>; Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib32" title="">2023</a>; Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib58" title="">2023</a>; Ye
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib50" title="">2024</a>)</cite>
propose to reuse the KV cache across requests to reduce redundant computation.
Prompt Cache <cite class="ltx_cite ltx_citemacro_citep">(Gim et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib18" title="">2023</a>)</cite> allows flexible reuse of the same tokens at different positions, while
CacheGen <cite class="ltx_cite ltx_citemacro_citep">(Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib32" title="">2023</a>)</cite> compresses the KV cache for efficient reuse.
Both approaches may generate inaccurate responses. SGLang <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib58" title="">2023</a>)</cite> and ChunkAttention <cite class="ltx_cite ltx_citemacro_citep">(Ye
et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2404.12457v2#bib.bib50" title="">2024</a>)</cite>
identify the reusable KV cache in GPU memory. RAGCache leverages RAG’s retrieval pattern
and builds a multilevel caching system, leading to higher performance with unchanged generation results.</p>
</div>
<figure class="ltx_table" id="S9.T3">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S9.T3.2" style="width:325.2pt;height:114.3pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(8.9pt,-3.1pt) scale(1.05789531679347,1.05789531679347) ;">
<table class="ltx_tabular ltx_align_middle" id="S9.T3.2.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S9.T3.2.1.1.1">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S9.T3.2.1.1.1.1" rowspan="2"><span class="ltx_text" id="S9.T3.2.1.1.1.1.1">
<span class="ltx_tabular ltx_align_middle" id="S9.T3.2.1.1.1.1.1.1">
<span class="ltx_tr" id="S9.T3.2.1.1.1.1.1.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S9.T3.2.1.1.1.1.1.1.1.1">Vector Search</span></span>
<span class="ltx_tr" id="S9.T3.2.1.1.1.1.1.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S9.T3.2.1.1.1.1.1.1.2.1">Ratio</span></span>
</span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" colspan="2" id="S9.T3.2.1.1.1.2">MMLU</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S9.T3.2.1.1.1.3">Natural Questions</td>
</tr>
<tr class="ltx_tr" id="S9.T3.2.1.2.2">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S9.T3.2.1.2.2.1"><span class="ltx_text ltx_font_bold" id="S9.T3.2.1.2.2.1.1">RAGCache</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S9.T3.2.1.2.2.2"><span class="ltx_text ltx_font_bold" id="S9.T3.2.1.2.2.2.1">No DSP</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S9.T3.2.1.2.2.3"><span class="ltx_text ltx_font_bold" id="S9.T3.2.1.2.2.3.1">RAGCache</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S9.T3.2.1.2.2.4"><span class="ltx_text ltx_font_bold" id="S9.T3.2.1.2.2.4.1">No DSP</span></td>
</tr>
<tr class="ltx_tr" id="S9.T3.2.1.3.3">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S9.T3.2.1.3.3.1">12.5%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S9.T3.2.1.3.3.2">52.1 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S9.T3.2.1.3.3.3">78.5 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S9.T3.2.1.3.3.4">67.7 ms</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S9.T3.2.1.3.3.5">105.8 ms</td>
</tr>
<tr class="ltx_tr" id="S9.T3.2.1.4.4">
<td class="ltx_td ltx_align_center ltx_border_r" id="S9.T3.2.1.4.4.1">25%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S9.T3.2.1.4.4.2">59.2 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S9.T3.2.1.4.4.3">135.9 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S9.T3.2.1.4.4.4">72.9 ms</td>
<td class="ltx_td ltx_align_center" id="S9.T3.2.1.4.4.5">163.4 ms</td>
</tr>
<tr class="ltx_tr" id="S9.T3.2.1.5.5">
<td class="ltx_td ltx_align_center ltx_border_r" id="S9.T3.2.1.5.5.1">50%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S9.T3.2.1.5.5.2">69.7 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S9.T3.2.1.5.5.3">243.7 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S9.T3.2.1.5.5.4">94.2 ms</td>
<td class="ltx_td ltx_align_center" id="S9.T3.2.1.5.5.5">282.5 ms</td>
</tr>
<tr class="ltx_tr" id="S9.T3.2.1.6.6">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S9.T3.2.1.6.6.1">100%</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S9.T3.2.1.6.6.2">97.4 ms</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S9.T3.2.1.6.6.3">422.3 ms</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S9.T3.2.1.6.6.4">145.0 ms</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T3.2.1.6.6.5">446.1 ms</td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S9.T3.3.1.1" style="font-size:90%;">Table 3</span>. </span><span class="ltx_text" id="S9.T3.4.2" style="font-size:90%;">Average non-overlapping vector search time under different settings.</span></figcaption>
</figure>
<figure class="ltx_table" id="S9.T4">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S9.T4.2" style="width:195.1pt;height:108pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(16.2pt,-9.0pt) scale(1.19955396234804,1.19955396234804) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S9.T4.2.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S9.T4.2.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="S9.T4.2.1.1.1.1">Request Rate</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S9.T4.2.1.1.1.2">Scheduling Time</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S9.T4.2.1.2.1">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S9.T4.2.1.2.1.1">0.5 req/s</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S9.T4.2.1.2.1.2">0.880 ms</td>
</tr>
<tr class="ltx_tr" id="S9.T4.2.1.3.2">
<td class="ltx_td ltx_align_center ltx_border_r" id="S9.T4.2.1.3.2.1">1.0 req/s</td>
<td class="ltx_td ltx_align_center" id="S9.T4.2.1.3.2.2">0.872 ms</td>
</tr>
<tr class="ltx_tr" id="S9.T4.2.1.4.3">
<td class="ltx_td ltx_align_center ltx_border_r" id="S9.T4.2.1.4.3.1">1.5 req/s</td>
<td class="ltx_td ltx_align_center" id="S9.T4.2.1.4.3.2">0.902 ms</td>
</tr>
<tr class="ltx_tr" id="S9.T4.2.1.5.4">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S9.T4.2.1.5.4.1">2.0 req/s</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T4.2.1.5.4.2">0.906 ms</td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S9.T4.3.1.1" style="font-size:90%;">Table 4</span>. </span><span class="ltx_text" id="S9.T4.4.2" style="font-size:90%;">Scheduling time of RAGCache.</span></figcaption>
</figure>
</section>
<section class="ltx_section" id="S10">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">10. </span>Conclusion</h2>
<div class="ltx_para" id="S10.p1">
<p class="ltx_p" id="S10.p1.2">We present RAGCache, a multilevel caching system tailored for RAG. Based on a detail RAG system characterization,
RAGCache employs a knowledge tree with a prefix-aware replacement policy to minimize redundant computation
and a dynamic speculative pipelining mechanism to overlap the knowledge retrieval and LLM inference
in the RAG workflow.
We evaluate RAGCache with a variety of models and workloads.
The experimental results show that RAGCache outperforms the state-of-the-art solution, vLLM integrated with Faiss,
by up to 4<math alttext="\times" class="ltx_Math" display="inline" id="S10.p1.1.m1.1"><semantics id="S10.p1.1.m1.1a"><mo id="S10.p1.1.m1.1.1" xref="S10.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S10.p1.1.m1.1b"><times id="S10.p1.1.m1.1.1.cmml" xref="S10.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S10.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S10.p1.1.m1.1d">×</annotation></semantics></math> on TTFT and 2.1<math alttext="\times" class="ltx_Math" display="inline" id="S10.p1.2.m2.1"><semantics id="S10.p1.2.m2.1a"><mo id="S10.p1.2.m2.1.1" xref="S10.p1.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S10.p1.2.m2.1b"><times id="S10.p1.2.m2.1.1.cmml" xref="S10.p1.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S10.p1.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S10.p1.2.m2.1d">×</annotation></semantics></math> on throughput.
j</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(1)</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">lan (2024)</span>
<span class="ltx_bibblock">
2024.

</span>
<span class="ltx_bibblock">LangChain.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://python.langchain.com/docs/get_started/introduction" title="">https://python.langchain.com/docs/get_started/introduction</a>.
(2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">ope (2024)</span>
<span class="ltx_bibblock">
2024.

</span>
<span class="ltx_bibblock">OpenAI.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openai.com/" title="">https://openai.com/</a>.
(2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">tex (2024)</span>
<span class="ltx_bibblock">
2024.

</span>
<span class="ltx_bibblock">OpenAI text-embedding-3 model.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openai.com/blog/new-embedding-models-and-api-updates/" title="">https://openai.com/blog/new-embedding-models-and-api-updates/</a>.
(2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">pin (2024)</span>
<span class="ltx_bibblock">
2024.

</span>
<span class="ltx_bibblock">Pinecone: Introduction to Facebook AI Similarity
Search (Faiss).

</span>
<span class="ltx_bibblock">(2024).

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.pinecone.io/learn/series/faiss/faiss-tutorial/" title="">https://www.pinecone.io/learn/series/faiss/faiss-tutorial/</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">wik (2024)</span>
<span class="ltx_bibblock">
2024.

</span>
<span class="ltx_bibblock">Wikipedia (en) embedded with cohere.ai
multilingual-22-12 encoder.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://huggingface.co/datasets/Cohere/wikipedia-22-12-en-embeddings/" title="">https://huggingface.co/datasets/Cohere/wikipedia-22-12-en-embeddings/</a>.
(2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ainslie et al<span class="ltx_text" id="bib.bib7.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Joshua Ainslie, James
Lee-Thorp, Michiel de Jong, Yury
Zemlyanskiy, Federico Lebrón, and
Sumit Sanghai. 2023.

</span>
<span class="ltx_bibblock">Gqa: Training generalized multi-query transformer
models from multi-head checkpoints.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib7.3.1">arXiv preprint arXiv:2305.13245</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Babenko and
Lempitsky (2014)</span>
<span class="ltx_bibblock">
Artem Babenko and Victor
Lempitsky. 2014.

</span>
<span class="ltx_bibblock">The inverted multi-index.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib8.1.1">IEEE transactions on pattern analysis and
machine intelligence</span> (2014).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Borgeaud
et al<span class="ltx_text" id="bib.bib9.3.3.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Sebastian Borgeaud, Arthur
Mensch, Jordan Hoffmann, Trevor Cai,
Eliza Rutherford, Katie Millican,
George Bm Van Den Driessche, Jean-Baptiste
Lespiau, Bogdan Damoc, Aidan Clark,
et al<span class="ltx_text" id="bib.bib9.4.1">.</span> 2022.

</span>
<span class="ltx_bibblock">Improving language models by retrieving from
trillions of tokens. In <span class="ltx_text ltx_font_italic" id="bib.bib9.5.1">International Conference on
Machine Learning (ICML)</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen
et al<span class="ltx_text" id="bib.bib10.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Hung-Ting Chen, Fangyuan
Xu, Shane A Arora, and Eunsol Choi.
2023.

</span>
<span class="ltx_bibblock">Understanding retrieval augmentation for long-form
question answering.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib10.3.1">arXiv preprint arXiv:2310.12150</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen
et al<span class="ltx_text" id="bib.bib11.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Jiawei Chen, Hongyu Lin,
Xianpei Han, and Le Sun.
2024.

</span>
<span class="ltx_bibblock">Benchmarking large language models in
retrieval-augmented generation. In <span class="ltx_text ltx_font_italic" id="bib.bib11.3.1">AAAI Conference
on Artificial Intelligence</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al<span class="ltx_text" id="bib.bib12.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Qi Chen, Bing Zhao,
Haidong Wang, Mingqin Li,
Chuanjie Liu, Zengzhong Li,
Mao Yang, and Jingdong Wang.
2021.

</span>
<span class="ltx_bibblock">Spann: Highly-efficient billion-scale approximate
nearest neighborhood search.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib12.3.1">Advances in Neural Information Processing
Systems</span> (2021).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cherkasova (1998)</span>
<span class="ltx_bibblock">
Ludmila Cherkasova.
1998.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib13.1.1">Improving WWW proxies performance with
greedy-dual-size-frequency caching policy</span>.

</span>
<span class="ltx_bibblock">Hewlett-Packard Laboratories Palo Alto, CA, USA.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chowdhery
et al<span class="ltx_text" id="bib.bib14.3.3.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Aakanksha Chowdhery,
Sharan Narang, Jacob Devlin,
Maarten Bosma, Gaurav Mishra,
Adam Roberts, Paul Barham,
Hyung Won Chung, Charles Sutton,
Sebastian Gehrmann, et al<span class="ltx_text" id="bib.bib14.4.1">.</span>
2022.

</span>
<span class="ltx_bibblock">Palm: Scaling language modeling with pathways.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib14.5.1">arXiv preprint arXiv:2204.02311</span>
(2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dettmers et al<span class="ltx_text" id="bib.bib15.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Tim Dettmers, Mike Lewis,
Younes Belkada, and Luke Zettlemoyer.
2022.

</span>
<span class="ltx_bibblock">Gpt3. int8 (): 8-bit matrix multiplication for
transformers at scale.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib15.3.1">Advances in Neural Information Processing
Systems</span> (2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fu
et al<span class="ltx_text" id="bib.bib16.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Cong Fu, Chao Xiang,
Changxu Wang, and Deng Cai.
2019.

</span>
<span class="ltx_bibblock">Fast approximate nearest neighbor search with the
navigating spreading-out graph. In <span class="ltx_text ltx_font_italic" id="bib.bib16.3.1">Proceedings of
the VLDB Endowment</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ge
et al<span class="ltx_text" id="bib.bib17.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Suyu Ge, Yunan Zhang,
Liyuan Liu, Minjia Zhang,
Jiawei Han, and Jianfeng Gao.
2023.

</span>
<span class="ltx_bibblock">Model tells you what to discard: Adaptive kv cache
compression for llms.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib17.3.1">arXiv preprint arXiv:2310.01801</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gim et al<span class="ltx_text" id="bib.bib18.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
In Gim, Guojun Chen,
Seung-seob Lee, Nikhil Sarda,
Anurag Khandelwal, and Lin Zhong.
2023.

</span>
<span class="ltx_bibblock">Prompt cache: Modular attention reuse for
low-latency inference.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib18.3.1">arXiv preprint arXiv:2311.04934</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hendrycks et al<span class="ltx_text" id="bib.bib19.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Dan Hendrycks, Collin
Burns, Steven Basart, Andy Zou,
Mantas Mazeika, Dawn Song, and
Jacob Steinhardt. 2020.

</span>
<span class="ltx_bibblock">Measuring massive multitask language
understanding.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib19.3.1">arXiv preprint arXiv:2009.03300</span>
(2020).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jayaram Subramanya et al<span class="ltx_text" id="bib.bib20.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Suhas Jayaram Subramanya,
Fnu Devvrit, Harsha Vardhan Simhadri,
Ravishankar Krishnawamy, and Rohan
Kadekodi. 2019.

</span>
<span class="ltx_bibblock">Diskann: Fast accurate billion-point nearest
neighbor search on a single node.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib20.3.1">Advances in Neural Information Processing
Systems</span> (2019).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang
et al<span class="ltx_text" id="bib.bib21.3.3.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Albert Q Jiang, Alexandre
Sablayrolles, Arthur Mensch, Chris
Bamford, Devendra Singh Chaplot, Diego
de las Casas, Florian Bressand, Gianna
Lengyel, Guillaume Lample, Lucile
Saulnier, et al<span class="ltx_text" id="bib.bib21.4.1">.</span> 2023.

</span>
<span class="ltx_bibblock">Mistral 7B.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib21.5.1">arXiv preprint arXiv:2310.06825</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang
et al<span class="ltx_text" id="bib.bib22.3.3.1">.</span> (2024a)</span>
<span class="ltx_bibblock">
Albert Q Jiang, Alexandre
Sablayrolles, Antoine Roux, Arthur
Mensch, Blanche Savary, Chris Bamford,
Devendra Singh Chaplot, Diego de las
Casas, Emma Bou Hanna, Florian Bressand,
et al<span class="ltx_text" id="bib.bib22.4.1">.</span> 2024a.

</span>
<span class="ltx_bibblock">Mixtral of experts.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib22.5.1">arXiv preprint arXiv:2401.04088</span>
(2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et al<span class="ltx_text" id="bib.bib23.2.2.1">.</span> (2024b)</span>
<span class="ltx_bibblock">
Wenqi Jiang, Shuai Zhang,
Boran Han, Jie Wang,
Bernie Wang, and Tim Kraska.
2024b.

</span>
<span class="ltx_bibblock">Piperag: Fast retrieval-augmented generation via
algorithm-system co-design.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib23.3.1">arXiv preprint arXiv:2403.05676</span>
(2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Joshi
et al<span class="ltx_text" id="bib.bib24.2.2.1">.</span> (2017)</span>
<span class="ltx_bibblock">
Mandar Joshi, Eunsol
Choi, Daniel S Weld, and Luke
Zettlemoyer. 2017.

</span>
<span class="ltx_bibblock">Triviaqa: A large scale distantly supervised
challenge dataset for reading comprehension. In <span class="ltx_text ltx_font_italic" id="bib.bib24.3.1">Proceedings of the 55th Annual Meeting of the Association for Computational
Linguistics (Volume 1: Long Papers)</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Khattab et al<span class="ltx_text" id="bib.bib25.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Omar Khattab, Keshav
Santhanam, Xiang Lisa Li, David Hall,
Percy Liang, Christopher Potts, and
Matei Zaharia. 2022.

</span>
<span class="ltx_bibblock">Demonstrate-search-predict: Composing retrieval and
language models for knowledge-intensive nlp.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib25.3.1">arXiv preprint arXiv:2212.14024</span>
(2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kwiatkowski
et al<span class="ltx_text" id="bib.bib26.3.3.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Tom Kwiatkowski,
Jennimaria Palomaki, Olivia Redfield,
Michael Collins, Ankur Parikh,
Chris Alberti, Danielle Epstein,
Illia Polosukhin, Jacob Devlin,
Kenton Lee, et al<span class="ltx_text" id="bib.bib26.4.1">.</span>
2019.

</span>
<span class="ltx_bibblock">Natural questions: a benchmark for question
answering research.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib26.5.1">Transactions of the Association for
Computational Linguistics</span> (2019).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kwon et al<span class="ltx_text" id="bib.bib27.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Woosuk Kwon, Zhuohan Li,
Siyuan Zhuang, Ying Sheng,
Lianmin Zheng, Cody Hao Yu,
Joseph Gonzalez, Hao Zhang, and
Ion Stoica. 2023.

</span>
<span class="ltx_bibblock">Efficient memory management for large language
model serving with pagedattention. In <span class="ltx_text ltx_font_italic" id="bib.bib27.3.1">ACM SOSP</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lewis
et al<span class="ltx_text" id="bib.bib28.3.3.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Patrick Lewis, Ethan
Perez, Aleksandra Piktus, Fabio Petroni,
Vladimir Karpukhin, Naman Goyal,
Heinrich Küttler, Mike Lewis,
Wen-tau Yih, Tim Rocktäschel,
et al<span class="ltx_text" id="bib.bib28.4.1">.</span> 2020.

</span>
<span class="ltx_bibblock">Retrieval-augmented generation for
knowledge-intensive nlp tasks.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib28.5.1">Advances in Neural Information Processing
Systems</span> (2020).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li
et al<span class="ltx_text" id="bib.bib29.2.2.1">.</span> (2020b)</span>
<span class="ltx_bibblock">
Conglong Li, Minjia
Zhang, David G Andersen, and Yuxiong
He. 2020b.

</span>
<span class="ltx_bibblock">Improving approximate nearest neighbor search
through learned adaptive early termination. In <span class="ltx_text ltx_font_italic" id="bib.bib29.3.1">ACM
SIGMOD</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al<span class="ltx_text" id="bib.bib30.2.2.1">.</span> (2020a)</span>
<span class="ltx_bibblock">
Zhuohan Li, Eric Wallace,
Sheng Shen, Kevin Lin,
Kurt Keutzer, Dan Klein, and
Joey Gonzalez. 2020a.

</span>
<span class="ltx_bibblock">Train big, then compress: Rethinking model size for
efficient training and inference of transformers. In
<span class="ltx_text ltx_font_italic" id="bib.bib30.3.1">International Conference on Machine Learning
(ICML)</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span class="ltx_text" id="bib.bib31.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Nelson F Liu, Kevin Lin,
John Hewitt, Ashwin Paranjape,
Michele Bevilacqua, Fabio Petroni, and
Percy Liang. 2024.

</span>
<span class="ltx_bibblock">Lost in the middle: How language models use long
contexts.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib31.3.1">Transactions of the Association for
Computational Linguistics</span> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span class="ltx_text" id="bib.bib32.3.3.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Yuhan Liu, Hanchen Li,
Kuntai Du, Jiayi Yao,
Yihua Cheng, Yuyang Huang,
Shan Lu, Michael Maire,
Henry Hoffmann, Ari Holtzman,
et al<span class="ltx_text" id="bib.bib32.4.1">.</span> 2023.

</span>
<span class="ltx_bibblock">CacheGen: Fast Context Loading for Language Model
Applications.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib32.5.1">arXiv preprint arXiv:2310.07240</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span class="ltx_text" id="bib.bib33.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Zichang Liu, Aditya
Desai, Fangshuo Liao, Weitao Wang,
Victor Xie, Zhaozhuo Xu,
Anastasios Kyrillidis, and Anshumali
Shrivastava. 2024.

</span>
<span class="ltx_bibblock">Scissorhands: Exploiting the persistence of
importance hypothesis for llm kv cache compression at test time.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib33.3.1">Advances in Neural Information Processing
Systems</span> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lu et al<span class="ltx_text" id="bib.bib34.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Shuai Lu, Nan Duan,
Hojae Han, Daya Guo,
Seung-won Hwang, and Alexey
Svyatkovskiy. 2022.

</span>
<span class="ltx_bibblock">Reacc: A retrieval-augmented code completion
framework.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib34.3.1">arXiv preprint arXiv:2203.07722</span>
(2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Malkov and
Yashunin (2018)</span>
<span class="ltx_bibblock">
Yu A Malkov and Dmitry A
Yashunin. 2018.

</span>
<span class="ltx_bibblock">Efficient and robust approximate nearest neighbor
search using hierarchical navigable small world graphs.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib35.1.1">IEEE transactions on pattern analysis and
machine intelligence</span> (2018).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">OpenAI (2023)</span>
<span class="ltx_bibblock">
OpenAI. 2023.

</span>
<span class="ltx_bibblock">GPT-4 Technical Report.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib36.1.1">arXiv preprint arXiv:2303.08774</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Paszke
et al<span class="ltx_text" id="bib.bib37.3.3.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Adam Paszke, Sam Gross,
Francisco Massa, Adam Lerer,
James Bradbury, Gregory Chanan,
Trevor Killeen, Zeming Lin,
Natalia Gimelshein, Luca Antiga,
et al<span class="ltx_text" id="bib.bib37.4.1">.</span> 2019.

</span>
<span class="ltx_bibblock">Pytorch: An imperative style, high-performance deep
learning library.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib37.5.1">Advances in neural information processing
systems</span> (2019).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ram et al<span class="ltx_text" id="bib.bib38.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Ori Ram, Yoav Levine,
Itay Dalmedigos, Dor Muhlgay,
Amnon Shashua, Kevin Leyton-Brown, and
Yoav Shoham. 2023.

</span>
<span class="ltx_bibblock">In-context retrieval-augmented language models.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib38.3.1">Transactions of the Association for
Computational Linguistics</span> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shortle
et al<span class="ltx_text" id="bib.bib39.2.2.1">.</span> (2018)</span>
<span class="ltx_bibblock">
John F Shortle, James M
Thompson, Donald Gross, and Carl M
Harris. 2018.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib39.3.1">Fundamentals of queueing theory</span>.
Vol. 399.

</span>
<span class="ltx_bibblock">John Wiley &amp; Sons.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Siriwardhana et al<span class="ltx_text" id="bib.bib40.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Shamane Siriwardhana,
Rivindu Weerasekera, Elliott Wen,
Tharindu Kaluarachchi, Rajib Rana, and
Suranga Nanayakkara. 2023.

</span>
<span class="ltx_bibblock">Improving the domain adaptation of retrieval
augmented generation (RAG) models for open domain question answering.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib40.3.1">Transactions of the Association for
Computational Linguistics</span> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Tillet
et al<span class="ltx_text" id="bib.bib41.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Philippe Tillet,
Hsiang-Tsung Kung, and David Cox.
2019.

</span>
<span class="ltx_bibblock">Triton: an intermediate language and compiler for
tiled neural network computations. In <span class="ltx_text ltx_font_italic" id="bib.bib41.3.1">Proceedings
of the 3rd ACM SIGPLAN International Workshop on Machine Learning and
Programming Languages</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Touvron
et al<span class="ltx_text" id="bib.bib42.3.3.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Hugo Touvron, Thibaut
Lavril, Gautier Izacard, Xavier
Martinet, Marie-Anne Lachaux,
Timothée Lacroix, Baptiste
Rozière, Naman Goyal, Eric Hambro,
Faisal Azhar, et al<span class="ltx_text" id="bib.bib42.4.1">.</span>
2023.

</span>
<span class="ltx_bibblock">Llama: Open and efficient foundation language
models. CoRR, abs/2302.13971, 2023. doi: 10.48550.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib42.5.1">arXiv preprint arXiv.2302.13971</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Trivedi et al<span class="ltx_text" id="bib.bib43.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Harsh Trivedi, Niranjan
Balasubramanian, Tushar Khot, and
Ashish Sabharwal. 2022.

</span>
<span class="ltx_bibblock">Interleaving retrieval with chain-of-thought
reasoning for knowledge-intensive multi-step questions.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib43.3.1">arXiv preprint arXiv:2212.10509</span>
(2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaithilingam et al<span class="ltx_text" id="bib.bib44.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Priyan Vaithilingam,
Tianyi Zhang, and Elena L Glassman.
2022.

</span>
<span class="ltx_bibblock">Expectation vs. experience: Evaluating the
usability of code generation tools powered by large language models. In
<span class="ltx_text ltx_font_italic" id="bib.bib44.3.1">Chi conference on human factors in computing systems
extended abstracts</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al<span class="ltx_text" id="bib.bib45.2.2.1">.</span> (2017)</span>
<span class="ltx_bibblock">
Ashish Vaswani, Noam
Shazeer, Niki Parmar, Jakob Uszkoreit,
Llion Jones, Aidan N Gomez,
Łukasz Kaiser, and Illia
Polosukhin. 2017.

</span>
<span class="ltx_bibblock">Attention is all you need.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib45.3.1">Advances in neural information processing
systems</span> (2017).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wu
et al<span class="ltx_text" id="bib.bib46.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Bingyang Wu, Yinmin
Zhong, Zili Zhang, Gang Huang,
Xuanzhe Liu, and Xin Jin.
2023.

</span>
<span class="ltx_bibblock">Fast distributed inference serving for large
language models.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib46.3.1">arXiv preprint arXiv:2305.05920</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xiao
et al<span class="ltx_text" id="bib.bib47.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Guangxuan Xiao, Yuandong
Tian, Beidi Chen, Song Han, and
Mike Lewis. 2023.

</span>
<span class="ltx_bibblock">Efficient streaming language models with attention
sinks.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib47.3.1">arXiv preprint arXiv:2309.17453</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al<span class="ltx_text" id="bib.bib48.2.2.1">.</span> (2018)</span>
<span class="ltx_bibblock">
Zhilin Yang, Peng Qi,
Saizheng Zhang, Yoshua Bengio,
William W. Cohen, Ruslan Salakhutdinov,
and Christopher D. Manning.
2018.

</span>
<span class="ltx_bibblock">HotpotQA: A Dataset for Diverse, Explainable
Multi-hop Question Answering. In <span class="ltx_text ltx_font_italic" id="bib.bib48.3.1">Conference on
Empirical Methods in Natural Language Processing (EMNLP)</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib49">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yao et al<span class="ltx_text" id="bib.bib49.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Shunyu Yao, Dian Yu,
Jeffrey Zhao, Izhak Shafran,
Tom Griffiths, Yuan Cao, and
Karthik Narasimhan. 2024.

</span>
<span class="ltx_bibblock">Tree of thoughts: Deliberate problem solving with
large language models.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib49.3.1">Advances in Neural Information Processing
Systems</span> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib50">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ye
et al<span class="ltx_text" id="bib.bib50.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Lu Ye, Ze Tao,
Yong Huang, and Yang Li.
2024.

</span>
<span class="ltx_bibblock">ChunkAttention: Efficient Self-Attention with
Prefix-Aware KV Cache and Two-Phase Partition.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib50.3.1">arXiv preprint arXiv:2402.15220</span>
(2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib51">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yu
et al<span class="ltx_text" id="bib.bib51.4.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Gyeong-In Yu, Joo Seong
Jeong, Geon-Woo Kim, Soojeong Kim, and
Byung-Gon Chun. 2022.

</span>
<span class="ltx_bibblock">Orca: A Distributed Serving System for
<math alttext="\{" class="ltx_Math" display="inline" id="bib.bib51.1.m1.1"><semantics id="bib.bib51.1.m1.1a"><mo id="bib.bib51.1.m1.1.1" stretchy="false" xref="bib.bib51.1.m1.1.1.cmml">{</mo><annotation-xml encoding="MathML-Content" id="bib.bib51.1.m1.1b"><ci id="bib.bib51.1.m1.1.1.cmml" xref="bib.bib51.1.m1.1.1">{</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib51.1.m1.1c">\{</annotation><annotation encoding="application/x-llamapun" id="bib.bib51.1.m1.1d">{</annotation></semantics></math>Transformer-Based<math alttext="\}" class="ltx_Math" display="inline" id="bib.bib51.2.m2.1"><semantics id="bib.bib51.2.m2.1a"><mo id="bib.bib51.2.m2.1.1" stretchy="false" xref="bib.bib51.2.m2.1.1.cmml">}</mo><annotation-xml encoding="MathML-Content" id="bib.bib51.2.m2.1b"><ci id="bib.bib51.2.m2.1.1.cmml" xref="bib.bib51.2.m2.1.1">}</ci></annotation-xml><annotation encoding="application/x-tex" id="bib.bib51.2.m2.1c">\}</annotation><annotation encoding="application/x-llamapun" id="bib.bib51.2.m2.1d">}</annotation></semantics></math> Generative Models. In <span class="ltx_text ltx_font_italic" id="bib.bib51.5.1">USENIX OSDI</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib52">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang
et al<span class="ltx_text" id="bib.bib52.2.2.1">.</span> (2023a)</span>
<span class="ltx_bibblock">
Biao Zhang, Barry Haddow,
and Alexandra Birch. 2023a.

</span>
<span class="ltx_bibblock">Prompting large language model for machine
translation: A case study. In <span class="ltx_text ltx_font_italic" id="bib.bib52.3.1">International
Conference on Machine Learning (ICML)</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib53">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al<span class="ltx_text" id="bib.bib53.2.2.1">.</span> (2024a)</span>
<span class="ltx_bibblock">
Tianyi Zhang, Faisal
Ladhak, Esin Durmus, Percy Liang,
Kathleen McKeown, and Tatsunori B
Hashimoto. 2024a.

</span>
<span class="ltx_bibblock">Benchmarking large language models for news
summarization.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib53.3.1">Transactions of the Association for
Computational Linguistics</span> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib54">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang
et al<span class="ltx_text" id="bib.bib54.2.2.1">.</span> (2023b)</span>
<span class="ltx_bibblock">
Zili Zhang, Chao Jin,
Linpeng Tang, Xuanzhe Liu, and
Xin Jin. 2023b.

</span>
<span class="ltx_bibblock">Fast, Approximate Vector Queries on Very Large
Unstructured Datasets. In <span class="ltx_text ltx_font_italic" id="bib.bib54.3.1">USENIX NSDI</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib55">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang
et al<span class="ltx_text" id="bib.bib55.2.2.1">.</span> (2024b)</span>
<span class="ltx_bibblock">
Zili Zhang, Fangyue Liu,
Gang Huang, Xuanzhe Liu, and
Xin Jin. 2024b.

</span>
<span class="ltx_bibblock">Fast Vector Query Processing for Large Datasets
Beyond GPU Memory with Reordered Pipelining. In <span class="ltx_text ltx_font_italic" id="bib.bib55.3.1">USENIX NSDI</span>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib56">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al<span class="ltx_text" id="bib.bib56.3.3.1">.</span> (2024c)</span>
<span class="ltx_bibblock">
Zhenyu Zhang, Ying Sheng,
Tianyi Zhou, Tianlong Chen,
Lianmin Zheng, Ruisi Cai,
Zhao Song, Yuandong Tian,
Christopher Ré, Clark Barrett,
et al<span class="ltx_text" id="bib.bib56.4.1">.</span> 2024c.

</span>
<span class="ltx_bibblock">H2o: Heavy-hitter oracle for efficient generative
inference of large language models.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib56.5.1">Advances in Neural Information Processing
Systems</span> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib57">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al<span class="ltx_text" id="bib.bib57.2.2.1">.</span> (2024d)</span>
<span class="ltx_bibblock">
Zhihao Zhang, Alan Zhu,
Lijie Yang, Yihua Xu,
Lanting Li, Phitchaya Mangpo
Phothilimthana, and Zhihao Jia.
2024d.

</span>
<span class="ltx_bibblock">Accelerating retrieval-augmented language model
serving with speculation.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib57.3.1">arXiv preprint arXiv:2401.14021</span>
(2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib58">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zheng et al<span class="ltx_text" id="bib.bib58.3.3.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Lianmin Zheng, Liangsheng
Yin, Zhiqiang Xie, Jeff Huang,
Chuyue Sun, Cody Hao Yu,
Shiyi Cao, Christos Kozyrakis,
Ion Stoica, Joseph E Gonzalez,
et al<span class="ltx_text" id="bib.bib58.4.1">.</span> 2023.

</span>
<span class="ltx_bibblock">Efficiently programming large language models using
sglang.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib58.5.1">arXiv preprint arXiv:2312.07104</span>
(2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib59">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhong et al<span class="ltx_text" id="bib.bib59.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Yinmin Zhong, Shengyu
Liu, Junda Chen, Jianbo Hu,
Yibo Zhu, Xuanzhe Liu,
Xin Jin, and Hao Zhang.
2024.

</span>
<span class="ltx_bibblock">DistServe: Disaggregating Prefill and Decoding for
Goodput-optimized Large Language Model Serving.

</span>
<span class="ltx_bibblock"><span class="ltx_text ltx_font_italic" id="bib.bib59.3.1">arXiv preprint arXiv:2401.09670</span>
(2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
</ul>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Tue Apr 30 19:04:43 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
