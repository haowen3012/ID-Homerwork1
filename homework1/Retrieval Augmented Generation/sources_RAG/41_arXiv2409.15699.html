<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation</title>
<!--Generated on Tue Sep 24 03:23:02 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<meta content="Retrieval Augmented Generation,  Large Language Models,  Question Answering,  Context Compression and Optimization" lang="en" name="keywords"/>
<base href="/html/2409.15699v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S1" title="In Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S1.SS1" title="In 1. Introduction ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1.1 </span>The Challenges</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S1.SS2" title="In 1. Introduction ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1.2 </span>Our Approach</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S2" title="In Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Works</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S2.SS1" title="In 2. Related Works ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>Retrieval-augmented Generation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S2.SS2" title="In 2. Related Works ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Context Compression</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S2.SS3" title="In 2. Related Works ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.3 </span>RAG Fine-tuning</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3" title="In Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Methodology</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3.SS1" title="In 3. Methodology ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Problem Formulation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3.SS2" title="In 3. Methodology ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Architecture</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3.SS3" title="In 3. Methodology ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>Compressive Encoder</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3.SS4" title="In 3. Methodology ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4 </span>Selective Compression Mechanism</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3.SS4.SSS1" title="In 3.4. Selective Compression Mechanism ‣ 3. Methodology ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4.1 </span>Token-level estimation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3.SS4.SSS2" title="In 3.4. Selective Compression Mechanism ‣ 3. Methodology ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4.2 </span>Sentence-level estimation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3.SS4.SSS3" title="In 3.4. Selective Compression Mechanism ‣ 3. Methodology ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4.3 </span>Compression ratio allocation</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3.SS5" title="In 3. Methodology ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.5 </span>Training Workflow</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4" title="In Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS1" title="In 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Settings</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS1.SSS1" title="In 4.1. Settings ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1.1 </span>Datasets</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS1.SSS2" title="In 4.1. Settings ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1.2 </span>Baselines</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS1.SSS3" title="In 4.1. Settings ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1.3 </span>Implementations</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS2" title="In 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Cost-Effectiveness Analysis</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS2.SSS1" title="In 4.2. Cost-Effectiveness Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2.1 </span>Primary results</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS2.SSS2" title="In 4.2. Cost-Effectiveness Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2.2 </span>Efficiency</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS3" title="In 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Flexibility Analysis</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS3.SSS1" title="In 4.3. Flexibility Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3.1 </span>Flexibility in compression ratio</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS3.SSS2" title="In 4.3. Flexibility Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3.2 </span>Flexibility in compression method</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS4" title="In 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4 </span>Extended Analysis</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS4.SSS1" title="In 4.4. Extended Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4.1 </span>Robustness to working conditions</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.SS4.SSS2" title="In 4.4. Extended Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4.2 </span>Ablation studies</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S5" title="In Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Conclusion And Future Work</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line ltx_leqno">
<div class="ltx_para" id="p1">
<span class="ltx_ERROR undefined" id="p1.1">\@ACM@balancefalse</span><span class="ltx_ERROR undefined" id="p1.2">\@ACM@balancefalse</span>
</div>
<h1 class="ltx_title ltx_title_document">Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Chenyuan Wu
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id1.1.id1">University of Science and Technology of China <span class="ltx_text ltx_affiliation_country" id="id1.1.id1.1"></span></span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:wu.chenyuan@ustc.edu.cn">wu.chenyuan@ustc.edu.cn</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Ninglu Shao
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id2.1.id1">Gaoling School of AI, Renmin University of China <span class="ltx_text ltx_affiliation_country" id="id2.1.id1.1"></span></span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:shao.ninglu@ruc.edu.cn">shao.ninglu@ruc.edu.cn</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Zheng Liu
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id3.1.id1">Beijing Academy of Artificial Intelligence <span class="ltx_text ltx_affiliation_country" id="id3.1.id1.1"></span></span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:zhengliu1026@gmail.com">zhengliu1026@gmail.com</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Shitao Xiao
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id4.1.id1">Beijing Academy of Artificial Intelligence <span class="ltx_text ltx_affiliation_country" id="id4.1.id1.1"></span></span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:stxiao@baai.ac.cn">stxiao@baai.ac.cn</a>
</span></span></span>
<span class="ltx_author_before">, </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Chaozhuo Li
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id5.1.id1">Beijing University of Posts and
Telecommunications <span class="ltx_text ltx_affiliation_country" id="id5.1.id1.1"></span></span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:cli@bupt.edu.cn">cli@bupt.edu.cn</a>
</span></span></span>
<span class="ltx_author_before"> and </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Defu Lian
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id6.1.id1">University of Science and Technology of China <span class="ltx_text ltx_affiliation_country" id="id6.1.id1.1"></span></span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:lian.defu@ustc.edu.cn">lian.defu@ustc.edu.cn</a>
</span></span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract.</h6>
<p class="ltx_p" id="id7.id1">The existing Retrieval-Augmented Generation (RAG) systems face significant challenges in terms of cost and effectiveness. On one hand, they need to encode the lengthy retrieved contexts before responding to the input tasks, which imposes substantial computational overhead. On the other hand, directly using generic Large Language Models (LLMs) often leads to sub-optimal answers, while task-specific fine-tuning may compromise the LLMs’ general capabilities.
To address these challenges, we introduce a novel approach called <span class="ltx_text ltx_font_bold" id="id7.id1.1">FlexRAG</span> (<span class="ltx_text ltx_framed ltx_framed_underline" id="id7.id1.2">Flex</span>ible Context Adaptation for <span class="ltx_text ltx_framed ltx_framed_underline" id="id7.id1.3">RAG</span>). In this approach, the
retrieved contexts are compressed into compact embeddings before being encoded by the LLMs. Simultaneously, these compressed embeddings are optimized to enhance downstream RAG performance.
A key feature of FlexRAG is its flexibility, which enables effective support for diverse compression ratios and selective preservation of important contexts.
Thanks to these technical designs, FlexRAG achieves superior generation quality while significantly reducing running costs. Comprehensive experiments on various question-answering datasets validate our approach as a cost-effective and flexible solution for RAG systems.</p>
</div>
<div class="ltx_keywords">Retrieval Augmented Generation, Large Language Models, Question Answering, Context Compression and Optimization
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1. </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Large language models (LLMs) are growing as a general foundation of artificial intelligence. However, the existing LLMs are still limited by incomplete and outdated knowledge due to their static nature, and this limitation is particularly pronounced when dealing with knowledge-intensive tasks <cite class="ltx_cite ltx_citemacro_citep">(Sun et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib33" title="">2024</a>; Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib22" title="">2023</a>; Ji et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib14" title="">2023</a>)</cite>. To mitigate this limitation, people resort to retrieval-augmented generation (RAG). With proper information retrieved from external databases, the generation process can be conducted on top of knowledge-grounded contexts. Consequently, it substantially contributes to LLMs’ generation quality in terms of truthfulness and credibility <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib9" title="">2023</a>)</cite>. In recent years, influential prototyping systems, e.g., WebGPT, SearchGPT <cite class="ltx_cite ltx_citemacro_citep">(OpenAI, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib25" title="">2024</a>)</cite>, Perplexity <cite class="ltx_cite ltx_citemacro_citep">(Perplexity, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib27" title="">2024</a>)</cite>, and developing frameworks, such as Llama-Index, Lainchain, are continuously proposed by the community, facilitating both application and research in this area.</p>
</div>
<section class="ltx_subsection" id="S1.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">1.1. </span>The Challenges</h3>
<div class="ltx_para" id="S1.SS1.p1">
<p class="ltx_p" id="S1.SS1.p1.1">Despite the widespread popularity, existing RAG systems still face significant challenges, particularly in terms of running costs and effectiveness. Firstly, RAG systems often require processing lengthy contexts to handle knowledge-intensive tasks. For instance, solving multi-hop QA tasks may involve working with a series of correlated documents <cite class="ltx_cite ltx_citemacro_citep">(Trivedi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib36" title="">2022</a>; Ho et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib11" title="">2020</a>; Yang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib43" title="">2018</a>)</cite>, while general language modeling tasks may call for iterative retrieval of diverse knowledge sources <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib17" title="">2023c</a>; Asai et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib2" title="">2023</a>)</cite>. In such situations, it will take substantial computation costs in order to encode the lengthy contexts for LLMs. Secondly, the RAG systems can be limited by their answer quality if generic LLMs are directly utilized. This limitation is especially evident for many public models of moderate scale, which often struggle to effectively utilize the retrieved knowledge, particularly in complex and noisy contexts <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib9" title="">2023</a>)</cite>. While task-specific fine-tuning can improve the answer quality <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib48" title="">2024</a>)</cite>, it may come at the cost of reduced instruction-following capabilities and diminished performance on other general tasks <cite class="ltx_cite ltx_citemacro_citep">(Luo et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib23" title="">2023</a>)</cite>.</p>
</div>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="207" id="S1.F1.g1" src="x1.png" width="822"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1. </span>Comparison of related techniques. 1) <span class="ltx_text ltx_font_italic" id="S1.F1.5.1">Context compression</span>: token embeddings are compressed into compact summary vectors. 2) <span class="ltx_text ltx_font_italic" id="S1.F1.6.2">Context filtering</span>: important token embeddings are filtered from the input prompt. 3) <span class="ltx_text ltx_font_italic" id="S1.F1.7.3">Prompt tuning</span>: soft-prompt is learned to improve the downstream task. 4) <span class="ltx_text ltx_font_italic" id="S1.F1.8.4">FlexRAG</span>: unifying all functions in one framework, with compressive embeddings (summary vectors) down-sampled by importance (filtering) and learned to optimize the RAG performance (prompt tuning).</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S1.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">1.2. </span>Our Approach</h3>
<div class="ltx_para" id="S1.SS2.p1">
<p class="ltx_p" id="S1.SS2.p1.1">To address the above challenges, we propose a novel approach in this paper, called <span class="ltx_text ltx_font_bold" id="S1.SS2.p1.1.1">FlexRAG</span> (shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S1.F1" title="Figure 1 ‣ 1.1. The Challenges ‣ 1. Introduction ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">1</span></a>. 4). It transforms the retrieved contexts into compact and more usable forms, which substantially improves the cost-effectiveness of RAG systems.</p>
</div>
<div class="ltx_para" id="S1.SS2.p2">
<p class="ltx_p" id="S1.SS2.p2.1">First of all, FlexRAG helps to <span class="ltx_text ltx_font_bold" id="S1.SS2.p2.1.1">reduce the running cost of RAG</span>. Essentially, FlexRAG pre-encodes external documents into <span class="ltx_text ltx_font_italic" id="S1.SS2.p2.1.2">compressive embeddings</span> during the offline stage and performs <span class="ltx_text ltx_font_italic" id="S1.SS2.p2.1.3">down-sampling</span> of the compressive embeddings when corresponding documents are retrieved for specific RAG tasks. Since the down-sampled token embeddings are significantly shorter compared to directly tokenized documents, this approach substantially reduces the computation cost for RAG systems. A key characteristic of FlexRAG is its <span class="ltx_text ltx_font_bold" id="S1.SS2.p2.1.4">flexibility</span>. Previous methods typically perform static compression of input context based on predefined compression ratios <cite class="ltx_cite ltx_citemacro_citep">(Chevalier et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib6" title="">2023</a>; Mu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib24" title="">2024</a>; Ge et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib10" title="">2023</a>)</cite>. In contrast, our approach supports <span class="ltx_text ltx_font_bold" id="S1.SS2.p2.1.5">arbitrary compression ratios</span> specified by the user, and enables <span class="ltx_text ltx_font_bold" id="S1.SS2.p2.1.6">selective compression of the contexts</span> based on their importance in specific scenarios. This means that the critical parts of the context are preserved as much as possible, while the less important parts are assigned with large compression ratios. Consequently, useful information within the context can be better presented for downstream RAG tasks.</p>
</div>
<div class="ltx_para" id="S1.SS2.p3">
<p class="ltx_p" id="S1.SS2.p3.1">Secondly, FlexRAG <span class="ltx_text ltx_font_bold" id="S1.SS2.p3.1.1">optimizes the performance of RAG</span> in a compatible way. In our work, a two-stage training workflow is designed for FlexRAG. In the first stage, we employ task-generic pre-training using a generic corpus, like RedPajama <cite class="ltx_cite ltx_citemacro_citep">(Computer, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib7" title="">2023</a>)</cite>, which establishes the preliminary alignment between the compression module and downstream LLM. In the second stage, we perform task-specific fine-tuning using various instruction-tuning datasets, which optimizes the answer quality for downstream RAG tasks. Throughout the entire training process, the compression module remains learnable while the LLM parameters are kept fixed. As no modification is made to the LLM’s original parameters, we can optimize the performance in RAG without compromising the performance in other general tasks.</p>
</div>
<div class="ltx_para" id="S1.SS2.p4">
<p class="ltx_p" id="S1.SS2.p4.1">We perform comprehensive empirical studies using a variety of question-answering datasets. In our experiments, FlexRAG exhibits three key advantages. 1) <span class="ltx_text ltx_font_bold" id="S1.SS2.p4.1.1">Superior cost-effectiveness</span>, where substantial improvements can be achieved over generic LLMs and other context compression methods with significantly reduced costs. 2) <span class="ltx_text ltx_font_bold" id="S1.SS2.p4.1.2">Flexibility of usage</span>, as it effectively supports various compression ratios and compression methods. 3) <span class="ltx_text ltx_font_bold" id="S1.SS2.p4.1.3">General usability</span>, as the competitive performance can be well-preserved across various datasets and working conditions. These results validate FlexRAG as an effective and economical component for RAG systems.</p>
</div>
<div class="ltx_para" id="S1.SS2.p5">
<p class="ltx_p" id="S1.SS2.p5.1">To summarize, the following technical contributions are highlighted for our paper:</p>
<ul class="ltx_itemize" id="S1.I1">
<li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i1.p1">
<p class="ltx_p" id="S1.I1.i1.p1.1">We propose a novel method, FlexRAG, for compressive and optimized adaptation of the retrieved contexts for RAG.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i2.p1">
<p class="ltx_p" id="S1.I1.i2.p1.1">FlexRAG realizes flexible compression of the retrieved contexts by various ratios, and enables selective preservation of useful information leveraging estimated importance.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i3.p1">
<p class="ltx_p" id="S1.I1.i3.p1.1">We design a two-stage training workflow for FlexRAG. By making sufficient utilization of available data, it effectively enhances the downstream performance of RAG.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i4.p1">
<p class="ltx_p" id="S1.I1.i4.p1.1">We perform comprehensive experiments with a variety QA datasets, whose result verifies the cost-effectiveness, flexibility, and general usability of FlexRAG.</p>
</div>
</li>
</ul>
</div>
</section>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2. </span>Related Works</h2>
<div class="ltx_para" id="S2.p1">
<p class="ltx_p" id="S2.p1.1">In this section, the related works are discussed from three perspectives: 1) retrieval-augmented generation, 2) context compression, 3) fine-tuning for RAG optimization.</p>
</div>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1. </span>Retrieval-augmented Generation</h3>
<div class="ltx_para" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.1">Retrieval-Augmented Generation has emerged as a crucial paradigm for language models <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib20" title="">2020</a>)</cite>, particularly with the rise of LLMs. A typical RAG system consists of two components: retrieval tools that access external databases and a language model that generates knowledge-grounded content based on the retrieval results. By introducing relevant knowledge, RAG significantly enhances the truthfulness and credibility of LLM-generated outputs, making it a valuable approach for mitigating hallucinations <cite class="ltx_cite ltx_citemacro_citep">(Ji et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib14" title="">2023</a>; Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib22" title="">2023</a>)</cite>. Additionally, RAG offloads internal knowledge to external memory, contributing to improved cost-effectiveness of LLMs <cite class="ltx_cite ltx_citemacro_citep">(Borgeaud et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib4" title="">2022</a>; Izacard et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib13" title="">2023</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S2.SS1.p2">
<p class="ltx_p" id="S2.SS1.p2.1">In recent years, RAG has become a significant research focus in both academia and industry. Researchers have continuously proposed advanced architectures beyond the basic direct prompting approach, such as fusion-in-decoder <cite class="ltx_cite ltx_citemacro_citep">(Izacard and Grave, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib12" title="">2020</a>)</cite> and internal knowledge injection <cite class="ltx_cite ltx_citemacro_citep">(Borgeaud et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib4" title="">2022</a>)</cite>, which facilitate the effective use of the retrieved knowledge. Meanwhile, the training of retriever and generator has been improved from simple independent training to more advanced forms of joint training <cite class="ltx_cite ltx_citemacro_citep">(Izacard et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib13" title="">2023</a>; Shi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib31" title="">2023</a>; Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib47" title="">2023</a>)</cite>, offering users the flexibility to select the most suitable method for their specific applications. Moreover, designing appropriate mechanisms for RAG, such as determining when and where to apply retrieval augmentation and which information to retrieve, is crucial. Significant progress has been made in this field, with approaches like uncertainty-based methods (e.g., FLARE <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib17" title="">2023c</a>)</cite>), self-prompting methods (e.g., ToolFormer <cite class="ltx_cite ltx_citemacro_citep">(Schick et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib30" title="">2024</a>)</cite>, Self-RAG <cite class="ltx_cite ltx_citemacro_citep">(Asai et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib2" title="">2023</a>)</cite>), and reflection-based methods (e.g., ReAct <cite class="ltx_cite ltx_citemacro_citep">(Yao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib44" title="">2022</a>)</cite>, Reflexion <cite class="ltx_cite ltx_citemacro_citep">(Shinn et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib32" title="">2024</a>)</cite>) proposed for more effective control of RAG in complex real-world scenarios. Additionally, RAG’s application has been actively explored beyond traditional question-answering <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib20" title="">2020</a>)</cite>, such as long-context modeling <cite class="ltx_cite ltx_citemacro_citep">(Xu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib42" title="">2023a</a>)</cite>, in-context learning <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib47" title="">2023</a>; Wang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib38" title="">2023</a>)</cite>, code generation <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib39" title="">2024</a>)</cite>, and multi-modal processing <cite class="ltx_cite ltx_citemacro_citep">(Yasunaga et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib45" title="">2022</a>)</cite>, etc.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2. </span>Context Compression</h3>
<div class="ltx_para" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.1">Running costs pose a significant challenge for RAG systems, primarily due to the need to encode lengthy retrieved contexts. To address this, an important strategy involves compressing the retrieved contexts before they are processed by downstream LLMs. In line with this approach, various compression techniques have been developed in recent years.
One notable work is Gist <cite class="ltx_cite ltx_citemacro_citep">(Mu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib24" title="">2024</a>)</cite>, which implicitly compresses long contexts using a small number of Gist tokens. Similarly, ICAE <cite class="ltx_cite ltx_citemacro_citep">(Ge et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib10" title="">2023</a>)</cite> fine-tunes LLMs as specialized context compressors through LoRA, while AutoCompressor <cite class="ltx_cite ltx_citemacro_citep">(Chevalier et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib6" title="">2023</a>)</cite> integrates compression learning with the autoregressive language modeling process.
In addition to these implicit methods, another line of research focuses on explicit filtering of contexts, where less important tokens are removed directly. A representative study in this area is LLMLingua <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib15" title="">2023a</a>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib16" title="">b</a>)</cite>, which uses coarse-to-fine approaches to compress contexts based on given budgets. Besides, RECOMP <cite class="ltx_cite ltx_citemacro_citep">(Xu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib41" title="">2023b</a>)</cite> presents both extractive and abstractive compressor, which selects useful sentences and generates summaries from long-contexts, respectively. While explicit methods are generally agnostic to downstream LLMs and therefore more practical, they may suffer from higher compression loss due to the over-removal of input tokens.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.3. </span>RAG Fine-tuning</h3>
<div class="ltx_para" id="S2.SS3.p1">
<p class="ltx_p" id="S2.SS3.p1.1">While RAG systems can be constructed using off-the-shelf retrievers and LLMs, this native approach often results in sub-optimal performance. Issues may include insufficient utilization of retrieved knowledge, vulnerability to retrieval noise, and misalignment with the required answer format or human preferences <cite class="ltx_cite ltx_citemacro_citep">(Gao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib9" title="">2023</a>)</cite>. Consequently, continual fine-tuning is often necessary to enhance RAG performance. In the simplest scenarios, retrievers and LLMs can be independently fine-tuned using their respective training data <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib48" title="">2024</a>)</cite>. However, more advanced approaches involve joint training of retrievers and LLMs. In these cases, retrievers are optimized to select contexts that are more conducive to the LLM’s processing, while LLMs are trained to adapt to the specific contexts provided by the retrievers <cite class="ltx_cite ltx_citemacro_citep">(Izacard et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib13" title="">2023</a>; Shi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib31" title="">2023</a>)</cite>.
Nevertheless, fine-tuning RAG systems isn’t without its drawbacks. It can lead to a reduction in the general capacity of LLMs, a phenomenon known as catastrophic forgetting. To mitigate this issue, parameter-efficient fine-tuning (PEFT) is often employed, where only specialized learnable adapters are fine-tuned, leaving the LLM’s original parameters intact <cite class="ltx_cite ltx_citemacro_citep">(Ding et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib8" title="">2023</a>)</cite>. Among various PEFT methods, prompt-tuning is particularly effective in minimizing the impact on LLMs <cite class="ltx_cite ltx_citemacro_citep">(Lester et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib19" title="">2021</a>; Liu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib21" title="">2021</a>)</cite>. In this approach, adaptation modules, i.e. soft prompts, are introduced as external components. Following this spirit, our encoder is designed, which produces both compressive and RAG-optimized embeddings for downstream LLMs.</p>
</div>
<figure class="ltx_figure" id="S2.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="307" id="S2.F2.g1" src="x2.png" width="788"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2. </span>Architecture of FlexRAG. It transforms the retrieved contexts <math alttext="\mathbf{X}_{retr}" class="ltx_Math" display="inline" id="S2.F2.5.m1.1"><semantics id="S2.F2.5.m1.1b"><msub id="S2.F2.5.m1.1.1" xref="S2.F2.5.m1.1.1.cmml"><mi id="S2.F2.5.m1.1.1.2" xref="S2.F2.5.m1.1.1.2.cmml">𝐗</mi><mrow id="S2.F2.5.m1.1.1.3" xref="S2.F2.5.m1.1.1.3.cmml"><mi id="S2.F2.5.m1.1.1.3.2" xref="S2.F2.5.m1.1.1.3.2.cmml">r</mi><mo id="S2.F2.5.m1.1.1.3.1" xref="S2.F2.5.m1.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.5.m1.1.1.3.3" xref="S2.F2.5.m1.1.1.3.3.cmml">e</mi><mo id="S2.F2.5.m1.1.1.3.1b" xref="S2.F2.5.m1.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.5.m1.1.1.3.4" xref="S2.F2.5.m1.1.1.3.4.cmml">t</mi><mo id="S2.F2.5.m1.1.1.3.1c" xref="S2.F2.5.m1.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.5.m1.1.1.3.5" xref="S2.F2.5.m1.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.F2.5.m1.1c"><apply id="S2.F2.5.m1.1.1.cmml" xref="S2.F2.5.m1.1.1"><csymbol cd="ambiguous" id="S2.F2.5.m1.1.1.1.cmml" xref="S2.F2.5.m1.1.1">subscript</csymbol><ci id="S2.F2.5.m1.1.1.2.cmml" xref="S2.F2.5.m1.1.1.2">𝐗</ci><apply id="S2.F2.5.m1.1.1.3.cmml" xref="S2.F2.5.m1.1.1.3"><times id="S2.F2.5.m1.1.1.3.1.cmml" xref="S2.F2.5.m1.1.1.3.1"></times><ci id="S2.F2.5.m1.1.1.3.2.cmml" xref="S2.F2.5.m1.1.1.3.2">𝑟</ci><ci id="S2.F2.5.m1.1.1.3.3.cmml" xref="S2.F2.5.m1.1.1.3.3">𝑒</ci><ci id="S2.F2.5.m1.1.1.3.4.cmml" xref="S2.F2.5.m1.1.1.3.4">𝑡</ci><ci id="S2.F2.5.m1.1.1.3.5.cmml" xref="S2.F2.5.m1.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.5.m1.1d">\mathbf{X}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.5.m1.1e">bold_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math> into compressive embeddings <math alttext="\mathbf{E}_{retr}" class="ltx_Math" display="inline" id="S2.F2.6.m2.1"><semantics id="S2.F2.6.m2.1b"><msub id="S2.F2.6.m2.1.1" xref="S2.F2.6.m2.1.1.cmml"><mi id="S2.F2.6.m2.1.1.2" xref="S2.F2.6.m2.1.1.2.cmml">𝐄</mi><mrow id="S2.F2.6.m2.1.1.3" xref="S2.F2.6.m2.1.1.3.cmml"><mi id="S2.F2.6.m2.1.1.3.2" xref="S2.F2.6.m2.1.1.3.2.cmml">r</mi><mo id="S2.F2.6.m2.1.1.3.1" xref="S2.F2.6.m2.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.6.m2.1.1.3.3" xref="S2.F2.6.m2.1.1.3.3.cmml">e</mi><mo id="S2.F2.6.m2.1.1.3.1b" xref="S2.F2.6.m2.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.6.m2.1.1.3.4" xref="S2.F2.6.m2.1.1.3.4.cmml">t</mi><mo id="S2.F2.6.m2.1.1.3.1c" xref="S2.F2.6.m2.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.6.m2.1.1.3.5" xref="S2.F2.6.m2.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.F2.6.m2.1c"><apply id="S2.F2.6.m2.1.1.cmml" xref="S2.F2.6.m2.1.1"><csymbol cd="ambiguous" id="S2.F2.6.m2.1.1.1.cmml" xref="S2.F2.6.m2.1.1">subscript</csymbol><ci id="S2.F2.6.m2.1.1.2.cmml" xref="S2.F2.6.m2.1.1.2">𝐄</ci><apply id="S2.F2.6.m2.1.1.3.cmml" xref="S2.F2.6.m2.1.1.3"><times id="S2.F2.6.m2.1.1.3.1.cmml" xref="S2.F2.6.m2.1.1.3.1"></times><ci id="S2.F2.6.m2.1.1.3.2.cmml" xref="S2.F2.6.m2.1.1.3.2">𝑟</ci><ci id="S2.F2.6.m2.1.1.3.3.cmml" xref="S2.F2.6.m2.1.1.3.3">𝑒</ci><ci id="S2.F2.6.m2.1.1.3.4.cmml" xref="S2.F2.6.m2.1.1.3.4">𝑡</ci><ci id="S2.F2.6.m2.1.1.3.5.cmml" xref="S2.F2.6.m2.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.6.m2.1d">\mathbf{E}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.6.m2.1e">bold_E start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math> using the compressive encoder. With estimated importance, it down-samples <math alttext="\mathbf{E}_{retr}" class="ltx_Math" display="inline" id="S2.F2.7.m3.1"><semantics id="S2.F2.7.m3.1b"><msub id="S2.F2.7.m3.1.1" xref="S2.F2.7.m3.1.1.cmml"><mi id="S2.F2.7.m3.1.1.2" xref="S2.F2.7.m3.1.1.2.cmml">𝐄</mi><mrow id="S2.F2.7.m3.1.1.3" xref="S2.F2.7.m3.1.1.3.cmml"><mi id="S2.F2.7.m3.1.1.3.2" xref="S2.F2.7.m3.1.1.3.2.cmml">r</mi><mo id="S2.F2.7.m3.1.1.3.1" xref="S2.F2.7.m3.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.7.m3.1.1.3.3" xref="S2.F2.7.m3.1.1.3.3.cmml">e</mi><mo id="S2.F2.7.m3.1.1.3.1b" xref="S2.F2.7.m3.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.7.m3.1.1.3.4" xref="S2.F2.7.m3.1.1.3.4.cmml">t</mi><mo id="S2.F2.7.m3.1.1.3.1c" xref="S2.F2.7.m3.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.7.m3.1.1.3.5" xref="S2.F2.7.m3.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.F2.7.m3.1c"><apply id="S2.F2.7.m3.1.1.cmml" xref="S2.F2.7.m3.1.1"><csymbol cd="ambiguous" id="S2.F2.7.m3.1.1.1.cmml" xref="S2.F2.7.m3.1.1">subscript</csymbol><ci id="S2.F2.7.m3.1.1.2.cmml" xref="S2.F2.7.m3.1.1.2">𝐄</ci><apply id="S2.F2.7.m3.1.1.3.cmml" xref="S2.F2.7.m3.1.1.3"><times id="S2.F2.7.m3.1.1.3.1.cmml" xref="S2.F2.7.m3.1.1.3.1"></times><ci id="S2.F2.7.m3.1.1.3.2.cmml" xref="S2.F2.7.m3.1.1.3.2">𝑟</ci><ci id="S2.F2.7.m3.1.1.3.3.cmml" xref="S2.F2.7.m3.1.1.3.3">𝑒</ci><ci id="S2.F2.7.m3.1.1.3.4.cmml" xref="S2.F2.7.m3.1.1.3.4">𝑡</ci><ci id="S2.F2.7.m3.1.1.3.5.cmml" xref="S2.F2.7.m3.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.7.m3.1d">\mathbf{E}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.7.m3.1e">bold_E start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math> into <math alttext="\mathbf{E}^{\prime}_{retr}" class="ltx_Math" display="inline" id="S2.F2.8.m4.1"><semantics id="S2.F2.8.m4.1b"><msubsup id="S2.F2.8.m4.1.1" xref="S2.F2.8.m4.1.1.cmml"><mi id="S2.F2.8.m4.1.1.2.2" xref="S2.F2.8.m4.1.1.2.2.cmml">𝐄</mi><mrow id="S2.F2.8.m4.1.1.3" xref="S2.F2.8.m4.1.1.3.cmml"><mi id="S2.F2.8.m4.1.1.3.2" xref="S2.F2.8.m4.1.1.3.2.cmml">r</mi><mo id="S2.F2.8.m4.1.1.3.1" xref="S2.F2.8.m4.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.8.m4.1.1.3.3" xref="S2.F2.8.m4.1.1.3.3.cmml">e</mi><mo id="S2.F2.8.m4.1.1.3.1b" xref="S2.F2.8.m4.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.8.m4.1.1.3.4" xref="S2.F2.8.m4.1.1.3.4.cmml">t</mi><mo id="S2.F2.8.m4.1.1.3.1c" xref="S2.F2.8.m4.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.8.m4.1.1.3.5" xref="S2.F2.8.m4.1.1.3.5.cmml">r</mi></mrow><mo id="S2.F2.8.m4.1.1.2.3" xref="S2.F2.8.m4.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S2.F2.8.m4.1c"><apply id="S2.F2.8.m4.1.1.cmml" xref="S2.F2.8.m4.1.1"><csymbol cd="ambiguous" id="S2.F2.8.m4.1.1.1.cmml" xref="S2.F2.8.m4.1.1">subscript</csymbol><apply id="S2.F2.8.m4.1.1.2.cmml" xref="S2.F2.8.m4.1.1"><csymbol cd="ambiguous" id="S2.F2.8.m4.1.1.2.1.cmml" xref="S2.F2.8.m4.1.1">superscript</csymbol><ci id="S2.F2.8.m4.1.1.2.2.cmml" xref="S2.F2.8.m4.1.1.2.2">𝐄</ci><ci id="S2.F2.8.m4.1.1.2.3.cmml" xref="S2.F2.8.m4.1.1.2.3">′</ci></apply><apply id="S2.F2.8.m4.1.1.3.cmml" xref="S2.F2.8.m4.1.1.3"><times id="S2.F2.8.m4.1.1.3.1.cmml" xref="S2.F2.8.m4.1.1.3.1"></times><ci id="S2.F2.8.m4.1.1.3.2.cmml" xref="S2.F2.8.m4.1.1.3.2">𝑟</ci><ci id="S2.F2.8.m4.1.1.3.3.cmml" xref="S2.F2.8.m4.1.1.3.3">𝑒</ci><ci id="S2.F2.8.m4.1.1.3.4.cmml" xref="S2.F2.8.m4.1.1.3.4">𝑡</ci><ci id="S2.F2.8.m4.1.1.3.5.cmml" xref="S2.F2.8.m4.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.8.m4.1d">\mathbf{E}^{\prime}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.8.m4.1e">bold_E start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math> as the compressed context for RAG.</figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3. </span>Methodology</h2>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">In this section, we delve into the technical aspects of FlexRAG. We begin by formulating the problem of context adaptation for RAG. Following this, we introduce the architecture of FlexRAG, focusing on its two basic components: the compressive context adapter and the selective compression mechanism. Finally, we introduce the optimization of FlexRAG using various types of data.</p>
</div>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1. </span>Problem Formulation</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.5">Retrieval-Augmented Generation (RAG) is a specialized working paradigm for Large Language Models (LLMs), which is designed to facilitate knowledge-intensive tasks, such as question-answering and knowledge-grounded dialogue systems. It presents the task’s prompt (denoted as <math alttext="\mathrm{X}_{task}" class="ltx_Math" display="inline" id="S3.SS1.p1.1.m1.1"><semantics id="S3.SS1.p1.1.m1.1a"><msub id="S3.SS1.p1.1.m1.1.1" xref="S3.SS1.p1.1.m1.1.1.cmml"><mi id="S3.SS1.p1.1.m1.1.1.2" mathvariant="normal" xref="S3.SS1.p1.1.m1.1.1.2.cmml">X</mi><mrow id="S3.SS1.p1.1.m1.1.1.3" xref="S3.SS1.p1.1.m1.1.1.3.cmml"><mi id="S3.SS1.p1.1.m1.1.1.3.2" xref="S3.SS1.p1.1.m1.1.1.3.2.cmml">t</mi><mo id="S3.SS1.p1.1.m1.1.1.3.1" xref="S3.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.1.m1.1.1.3.3" xref="S3.SS1.p1.1.m1.1.1.3.3.cmml">a</mi><mo id="S3.SS1.p1.1.m1.1.1.3.1a" xref="S3.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.1.m1.1.1.3.4" xref="S3.SS1.p1.1.m1.1.1.3.4.cmml">s</mi><mo id="S3.SS1.p1.1.m1.1.1.3.1b" xref="S3.SS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.1.m1.1.1.3.5" xref="S3.SS1.p1.1.m1.1.1.3.5.cmml">k</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.1.m1.1b"><apply id="S3.SS1.p1.1.m1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.1.m1.1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS1.p1.1.m1.1.1.2.cmml" xref="S3.SS1.p1.1.m1.1.1.2">X</ci><apply id="S3.SS1.p1.1.m1.1.1.3.cmml" xref="S3.SS1.p1.1.m1.1.1.3"><times id="S3.SS1.p1.1.m1.1.1.3.1.cmml" xref="S3.SS1.p1.1.m1.1.1.3.1"></times><ci id="S3.SS1.p1.1.m1.1.1.3.2.cmml" xref="S3.SS1.p1.1.m1.1.1.3.2">𝑡</ci><ci id="S3.SS1.p1.1.m1.1.1.3.3.cmml" xref="S3.SS1.p1.1.m1.1.1.3.3">𝑎</ci><ci id="S3.SS1.p1.1.m1.1.1.3.4.cmml" xref="S3.SS1.p1.1.m1.1.1.3.4">𝑠</ci><ci id="S3.SS1.p1.1.m1.1.1.3.5.cmml" xref="S3.SS1.p1.1.m1.1.1.3.5">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.1.m1.1c">\mathrm{X}_{task}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.1.m1.1d">roman_X start_POSTSUBSCRIPT italic_t italic_a italic_s italic_k end_POSTSUBSCRIPT</annotation></semantics></math>) together with the retrieved context (denoted as <math alttext="\mathrm{X}_{retr}" class="ltx_Math" display="inline" id="S3.SS1.p1.2.m2.1"><semantics id="S3.SS1.p1.2.m2.1a"><msub id="S3.SS1.p1.2.m2.1.1" xref="S3.SS1.p1.2.m2.1.1.cmml"><mi id="S3.SS1.p1.2.m2.1.1.2" mathvariant="normal" xref="S3.SS1.p1.2.m2.1.1.2.cmml">X</mi><mrow id="S3.SS1.p1.2.m2.1.1.3" xref="S3.SS1.p1.2.m2.1.1.3.cmml"><mi id="S3.SS1.p1.2.m2.1.1.3.2" xref="S3.SS1.p1.2.m2.1.1.3.2.cmml">r</mi><mo id="S3.SS1.p1.2.m2.1.1.3.1" xref="S3.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.2.m2.1.1.3.3" xref="S3.SS1.p1.2.m2.1.1.3.3.cmml">e</mi><mo id="S3.SS1.p1.2.m2.1.1.3.1a" xref="S3.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.2.m2.1.1.3.4" xref="S3.SS1.p1.2.m2.1.1.3.4.cmml">t</mi><mo id="S3.SS1.p1.2.m2.1.1.3.1b" xref="S3.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.2.m2.1.1.3.5" xref="S3.SS1.p1.2.m2.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.2.m2.1b"><apply id="S3.SS1.p1.2.m2.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.2.m2.1.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS1.p1.2.m2.1.1.2.cmml" xref="S3.SS1.p1.2.m2.1.1.2">X</ci><apply id="S3.SS1.p1.2.m2.1.1.3.cmml" xref="S3.SS1.p1.2.m2.1.1.3"><times id="S3.SS1.p1.2.m2.1.1.3.1.cmml" xref="S3.SS1.p1.2.m2.1.1.3.1"></times><ci id="S3.SS1.p1.2.m2.1.1.3.2.cmml" xref="S3.SS1.p1.2.m2.1.1.3.2">𝑟</ci><ci id="S3.SS1.p1.2.m2.1.1.3.3.cmml" xref="S3.SS1.p1.2.m2.1.1.3.3">𝑒</ci><ci id="S3.SS1.p1.2.m2.1.1.3.4.cmml" xref="S3.SS1.p1.2.m2.1.1.3.4">𝑡</ci><ci id="S3.SS1.p1.2.m2.1.1.3.5.cmml" xref="S3.SS1.p1.2.m2.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.2.m2.1c">\mathrm{X}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.2.m2.1d">roman_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math>) as the input for LLM, based on which the ground-truth answer (denoted as <math alttext="\mathrm{X}_{ans}" class="ltx_Math" display="inline" id="S3.SS1.p1.3.m3.1"><semantics id="S3.SS1.p1.3.m3.1a"><msub id="S3.SS1.p1.3.m3.1.1" xref="S3.SS1.p1.3.m3.1.1.cmml"><mi id="S3.SS1.p1.3.m3.1.1.2" mathvariant="normal" xref="S3.SS1.p1.3.m3.1.1.2.cmml">X</mi><mrow id="S3.SS1.p1.3.m3.1.1.3" xref="S3.SS1.p1.3.m3.1.1.3.cmml"><mi id="S3.SS1.p1.3.m3.1.1.3.2" xref="S3.SS1.p1.3.m3.1.1.3.2.cmml">a</mi><mo id="S3.SS1.p1.3.m3.1.1.3.1" xref="S3.SS1.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.3.m3.1.1.3.3" xref="S3.SS1.p1.3.m3.1.1.3.3.cmml">n</mi><mo id="S3.SS1.p1.3.m3.1.1.3.1a" xref="S3.SS1.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.3.m3.1.1.3.4" xref="S3.SS1.p1.3.m3.1.1.3.4.cmml">s</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.3.m3.1b"><apply id="S3.SS1.p1.3.m3.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.3.m3.1.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1">subscript</csymbol><ci id="S3.SS1.p1.3.m3.1.1.2.cmml" xref="S3.SS1.p1.3.m3.1.1.2">X</ci><apply id="S3.SS1.p1.3.m3.1.1.3.cmml" xref="S3.SS1.p1.3.m3.1.1.3"><times id="S3.SS1.p1.3.m3.1.1.3.1.cmml" xref="S3.SS1.p1.3.m3.1.1.3.1"></times><ci id="S3.SS1.p1.3.m3.1.1.3.2.cmml" xref="S3.SS1.p1.3.m3.1.1.3.2">𝑎</ci><ci id="S3.SS1.p1.3.m3.1.1.3.3.cmml" xref="S3.SS1.p1.3.m3.1.1.3.3">𝑛</ci><ci id="S3.SS1.p1.3.m3.1.1.3.4.cmml" xref="S3.SS1.p1.3.m3.1.1.3.4">𝑠</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.3.m3.1c">\mathrm{X}_{ans}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.3.m3.1d">roman_X start_POSTSUBSCRIPT italic_a italic_n italic_s end_POSTSUBSCRIPT</annotation></semantics></math>) is predicted. The retrieved context is expected to include necessary knowledge to the task, such that the ground-truth answer can be better predicted. In spite of widespread popularity, the directly application of LLMs for RAG is constrained by suboptimal performance and high computational costs. To address these challenges, we propose <span class="ltx_text ltx_font_bold" id="S3.SS1.p1.5.1">Flexible Context Adaptation for RAG</span> with the following objectives: 1) the retrieved context is compressed into a concise form: <math alttext="|\phi(\mathrm{X}_{retr})|&lt;|\mathrm{X}_{retr}|" class="ltx_Math" display="inline" id="S3.SS1.p1.4.m4.2"><semantics id="S3.SS1.p1.4.m4.2a"><mrow id="S3.SS1.p1.4.m4.2.2" xref="S3.SS1.p1.4.m4.2.2.cmml"><mrow id="S3.SS1.p1.4.m4.1.1.1.1" xref="S3.SS1.p1.4.m4.1.1.1.2.cmml"><mo id="S3.SS1.p1.4.m4.1.1.1.1.2" stretchy="false" xref="S3.SS1.p1.4.m4.1.1.1.2.1.cmml">|</mo><mrow id="S3.SS1.p1.4.m4.1.1.1.1.1" xref="S3.SS1.p1.4.m4.1.1.1.1.1.cmml"><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.3" xref="S3.SS1.p1.4.m4.1.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.cmml"><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.cmml"><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.2" mathvariant="normal" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.2.cmml">X</mi><mrow id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.2.cmml">r</mi><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.1" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.3" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.3.cmml">e</mi><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.1a" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.4" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.4.cmml">t</mi><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.1b" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.5" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.5.cmml">r</mi></mrow></msub><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS1.p1.4.m4.1.1.1.1.3" stretchy="false" xref="S3.SS1.p1.4.m4.1.1.1.2.1.cmml">|</mo></mrow><mo id="S3.SS1.p1.4.m4.2.2.3" xref="S3.SS1.p1.4.m4.2.2.3.cmml">&lt;</mo><mrow id="S3.SS1.p1.4.m4.2.2.2.1" xref="S3.SS1.p1.4.m4.2.2.2.2.cmml"><mo id="S3.SS1.p1.4.m4.2.2.2.1.2" stretchy="false" xref="S3.SS1.p1.4.m4.2.2.2.2.1.cmml">|</mo><msub id="S3.SS1.p1.4.m4.2.2.2.1.1" xref="S3.SS1.p1.4.m4.2.2.2.1.1.cmml"><mi id="S3.SS1.p1.4.m4.2.2.2.1.1.2" mathvariant="normal" xref="S3.SS1.p1.4.m4.2.2.2.1.1.2.cmml">X</mi><mrow id="S3.SS1.p1.4.m4.2.2.2.1.1.3" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.cmml"><mi id="S3.SS1.p1.4.m4.2.2.2.1.1.3.2" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.2.cmml">r</mi><mo id="S3.SS1.p1.4.m4.2.2.2.1.1.3.1" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.4.m4.2.2.2.1.1.3.3" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.3.cmml">e</mi><mo id="S3.SS1.p1.4.m4.2.2.2.1.1.3.1a" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.4.m4.2.2.2.1.1.3.4" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.4.cmml">t</mi><mo id="S3.SS1.p1.4.m4.2.2.2.1.1.3.1b" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.4.m4.2.2.2.1.1.3.5" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.5.cmml">r</mi></mrow></msub><mo id="S3.SS1.p1.4.m4.2.2.2.1.3" stretchy="false" xref="S3.SS1.p1.4.m4.2.2.2.2.1.cmml">|</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.4.m4.2b"><apply id="S3.SS1.p1.4.m4.2.2.cmml" xref="S3.SS1.p1.4.m4.2.2"><lt id="S3.SS1.p1.4.m4.2.2.3.cmml" xref="S3.SS1.p1.4.m4.2.2.3"></lt><apply id="S3.SS1.p1.4.m4.1.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1"><abs id="S3.SS1.p1.4.m4.1.1.1.2.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.2"></abs><apply id="S3.SS1.p1.4.m4.1.1.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1"><times id="S3.SS1.p1.4.m4.1.1.1.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2"></times><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.3">italic-ϕ</ci><apply id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.2">X</ci><apply id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3"><times id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.1"></times><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.2">𝑟</ci><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.3">𝑒</ci><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.4.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.4">𝑡</ci><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.5.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.3.5">𝑟</ci></apply></apply></apply></apply><apply id="S3.SS1.p1.4.m4.2.2.2.2.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1"><abs id="S3.SS1.p1.4.m4.2.2.2.2.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1.2"></abs><apply id="S3.SS1.p1.4.m4.2.2.2.1.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.2.2.2.1.1.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1.1">subscript</csymbol><ci id="S3.SS1.p1.4.m4.2.2.2.1.1.2.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1.1.2">X</ci><apply id="S3.SS1.p1.4.m4.2.2.2.1.1.3.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3"><times id="S3.SS1.p1.4.m4.2.2.2.1.1.3.1.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.1"></times><ci id="S3.SS1.p1.4.m4.2.2.2.1.1.3.2.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.2">𝑟</ci><ci id="S3.SS1.p1.4.m4.2.2.2.1.1.3.3.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.3">𝑒</ci><ci id="S3.SS1.p1.4.m4.2.2.2.1.1.3.4.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.4">𝑡</ci><ci id="S3.SS1.p1.4.m4.2.2.2.1.1.3.5.cmml" xref="S3.SS1.p1.4.m4.2.2.2.1.1.3.5">𝑟</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.4.m4.2c">|\phi(\mathrm{X}_{retr})|&lt;|\mathrm{X}_{retr}|</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.4.m4.2d">| italic_ϕ ( roman_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT ) | &lt; | roman_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT |</annotation></semantics></math> (<math alttext="\phi(\cdot)" class="ltx_Math" display="inline" id="S3.SS1.p1.5.m5.1"><semantics id="S3.SS1.p1.5.m5.1a"><mrow id="S3.SS1.p1.5.m5.1.2" xref="S3.SS1.p1.5.m5.1.2.cmml"><mi id="S3.SS1.p1.5.m5.1.2.2" xref="S3.SS1.p1.5.m5.1.2.2.cmml">ϕ</mi><mo id="S3.SS1.p1.5.m5.1.2.1" xref="S3.SS1.p1.5.m5.1.2.1.cmml">⁢</mo><mrow id="S3.SS1.p1.5.m5.1.2.3.2" xref="S3.SS1.p1.5.m5.1.2.cmml"><mo id="S3.SS1.p1.5.m5.1.2.3.2.1" stretchy="false" xref="S3.SS1.p1.5.m5.1.2.cmml">(</mo><mo id="S3.SS1.p1.5.m5.1.1" lspace="0em" rspace="0em" xref="S3.SS1.p1.5.m5.1.1.cmml">⋅</mo><mo id="S3.SS1.p1.5.m5.1.2.3.2.2" stretchy="false" xref="S3.SS1.p1.5.m5.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.5.m5.1b"><apply id="S3.SS1.p1.5.m5.1.2.cmml" xref="S3.SS1.p1.5.m5.1.2"><times id="S3.SS1.p1.5.m5.1.2.1.cmml" xref="S3.SS1.p1.5.m5.1.2.1"></times><ci id="S3.SS1.p1.5.m5.1.2.2.cmml" xref="S3.SS1.p1.5.m5.1.2.2">italic-ϕ</ci><ci id="S3.SS1.p1.5.m5.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.5.m5.1c">\phi(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.5.m5.1d">italic_ϕ ( ⋅ )</annotation></semantics></math> stands for the compressor); 2) the compressed context helps to deliver optimized performance for RAG. These objectives can be generalized and formulated as the following optimization problem:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(1)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\begin{split}&amp;\max\limits_{\phi}~{}P_{LLM}(\mathrm{X}_{ans}|\phi(\mathrm{X}_{%
retr}),\mathrm{X}_{task})\\
&amp;~{}~{}s.t.~{}|\phi(\mathrm{X}_{retr})|=k,~{}~{}\text{where }k&lt;|X_{retr}|\end{split}" class="ltx_Math" display="block" id="S3.E1.m1.42"><semantics id="S3.E1.m1.42a"><mtable columnspacing="0pt" displaystyle="true" id="S3.E1.m1.42.42.4" rowspacing="0pt"><mtr id="S3.E1.m1.42.42.4a"><mtd id="S3.E1.m1.42.42.4b" xref="S3.E1.m1.40.40.2.3.cmml"></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E1.m1.42.42.4c"><mrow id="S3.E1.m1.41.41.3.39.18.18"><mrow id="S3.E1.m1.41.41.3.39.18.18.20"><munder id="S3.E1.m1.41.41.3.39.18.18.20.1"><mi id="S3.E1.m1.1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.1.1.cmml">max</mi><mi id="S3.E1.m1.2.2.2.2.2.2.1" xref="S3.E1.m1.2.2.2.2.2.2.1.cmml">ϕ</mi></munder><mo id="S3.E1.m1.41.41.3.39.18.18.20a" lspace="0.497em" xref="S3.E1.m1.40.40.2.3.cmml">⁡</mo><msub id="S3.E1.m1.41.41.3.39.18.18.20.2"><mi id="S3.E1.m1.3.3.3.3.3.3" xref="S3.E1.m1.3.3.3.3.3.3.cmml">P</mi><mrow id="S3.E1.m1.4.4.4.4.4.4.1" xref="S3.E1.m1.4.4.4.4.4.4.1.cmml"><mi id="S3.E1.m1.4.4.4.4.4.4.1.2" xref="S3.E1.m1.4.4.4.4.4.4.1.2.cmml">L</mi><mo id="S3.E1.m1.4.4.4.4.4.4.1.1" xref="S3.E1.m1.4.4.4.4.4.4.1.1.cmml">⁢</mo><mi id="S3.E1.m1.4.4.4.4.4.4.1.3" xref="S3.E1.m1.4.4.4.4.4.4.1.3.cmml">L</mi><mo id="S3.E1.m1.4.4.4.4.4.4.1.1a" xref="S3.E1.m1.4.4.4.4.4.4.1.1.cmml">⁢</mo><mi id="S3.E1.m1.4.4.4.4.4.4.1.4" xref="S3.E1.m1.4.4.4.4.4.4.1.4.cmml">M</mi></mrow></msub></mrow><mo id="S3.E1.m1.41.41.3.39.18.18.19" xref="S3.E1.m1.40.40.2.3.cmml">⁢</mo><mrow id="S3.E1.m1.41.41.3.39.18.18.18.1"><mo id="S3.E1.m1.5.5.5.5.5.5" stretchy="false" xref="S3.E1.m1.40.40.2.3.cmml">(</mo><mrow id="S3.E1.m1.41.41.3.39.18.18.18.1.1"><msub id="S3.E1.m1.41.41.3.39.18.18.18.1.1.3"><mi id="S3.E1.m1.6.6.6.6.6.6" mathvariant="normal" xref="S3.E1.m1.6.6.6.6.6.6.cmml">X</mi><mrow id="S3.E1.m1.7.7.7.7.7.7.1" xref="S3.E1.m1.7.7.7.7.7.7.1.cmml"><mi id="S3.E1.m1.7.7.7.7.7.7.1.2" xref="S3.E1.m1.7.7.7.7.7.7.1.2.cmml">a</mi><mo id="S3.E1.m1.7.7.7.7.7.7.1.1" xref="S3.E1.m1.7.7.7.7.7.7.1.1.cmml">⁢</mo><mi id="S3.E1.m1.7.7.7.7.7.7.1.3" xref="S3.E1.m1.7.7.7.7.7.7.1.3.cmml">n</mi><mo id="S3.E1.m1.7.7.7.7.7.7.1.1a" xref="S3.E1.m1.7.7.7.7.7.7.1.1.cmml">⁢</mo><mi id="S3.E1.m1.7.7.7.7.7.7.1.4" xref="S3.E1.m1.7.7.7.7.7.7.1.4.cmml">s</mi></mrow></msub><mo fence="false" id="S3.E1.m1.8.8.8.8.8.8" xref="S3.E1.m1.8.8.8.8.8.8.cmml">|</mo><mrow id="S3.E1.m1.41.41.3.39.18.18.18.1.1.2.2"><mrow id="S3.E1.m1.41.41.3.39.18.18.18.1.1.1.1.1"><mi id="S3.E1.m1.9.9.9.9.9.9" xref="S3.E1.m1.9.9.9.9.9.9.cmml">ϕ</mi><mo id="S3.E1.m1.41.41.3.39.18.18.18.1.1.1.1.1.2" xref="S3.E1.m1.40.40.2.3.cmml">⁢</mo><mrow id="S3.E1.m1.41.41.3.39.18.18.18.1.1.1.1.1.1.1"><mo id="S3.E1.m1.10.10.10.10.10.10" stretchy="false" xref="S3.E1.m1.40.40.2.3.cmml">(</mo><msub id="S3.E1.m1.41.41.3.39.18.18.18.1.1.1.1.1.1.1.1"><mi id="S3.E1.m1.11.11.11.11.11.11" mathvariant="normal" xref="S3.E1.m1.11.11.11.11.11.11.cmml">X</mi><mrow id="S3.E1.m1.12.12.12.12.12.12.1" xref="S3.E1.m1.12.12.12.12.12.12.1.cmml"><mi id="S3.E1.m1.12.12.12.12.12.12.1.2" xref="S3.E1.m1.12.12.12.12.12.12.1.2.cmml">r</mi><mo id="S3.E1.m1.12.12.12.12.12.12.1.1" xref="S3.E1.m1.12.12.12.12.12.12.1.1.cmml">⁢</mo><mi id="S3.E1.m1.12.12.12.12.12.12.1.3" xref="S3.E1.m1.12.12.12.12.12.12.1.3.cmml">e</mi><mo id="S3.E1.m1.12.12.12.12.12.12.1.1a" xref="S3.E1.m1.12.12.12.12.12.12.1.1.cmml">⁢</mo><mi id="S3.E1.m1.12.12.12.12.12.12.1.4" xref="S3.E1.m1.12.12.12.12.12.12.1.4.cmml">t</mi><mo id="S3.E1.m1.12.12.12.12.12.12.1.1b" xref="S3.E1.m1.12.12.12.12.12.12.1.1.cmml">⁢</mo><mi id="S3.E1.m1.12.12.12.12.12.12.1.5" xref="S3.E1.m1.12.12.12.12.12.12.1.5.cmml">r</mi></mrow></msub><mo id="S3.E1.m1.13.13.13.13.13.13" stretchy="false" xref="S3.E1.m1.40.40.2.3.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.14.14.14.14.14.14" xref="S3.E1.m1.40.40.2.3.cmml">,</mo><msub id="S3.E1.m1.41.41.3.39.18.18.18.1.1.2.2.2"><mi id="S3.E1.m1.15.15.15.15.15.15" mathvariant="normal" xref="S3.E1.m1.15.15.15.15.15.15.cmml">X</mi><mrow id="S3.E1.m1.16.16.16.16.16.16.1" xref="S3.E1.m1.16.16.16.16.16.16.1.cmml"><mi id="S3.E1.m1.16.16.16.16.16.16.1.2" xref="S3.E1.m1.16.16.16.16.16.16.1.2.cmml">t</mi><mo id="S3.E1.m1.16.16.16.16.16.16.1.1" xref="S3.E1.m1.16.16.16.16.16.16.1.1.cmml">⁢</mo><mi id="S3.E1.m1.16.16.16.16.16.16.1.3" xref="S3.E1.m1.16.16.16.16.16.16.1.3.cmml">a</mi><mo id="S3.E1.m1.16.16.16.16.16.16.1.1a" xref="S3.E1.m1.16.16.16.16.16.16.1.1.cmml">⁢</mo><mi id="S3.E1.m1.16.16.16.16.16.16.1.4" xref="S3.E1.m1.16.16.16.16.16.16.1.4.cmml">s</mi><mo id="S3.E1.m1.16.16.16.16.16.16.1.1b" xref="S3.E1.m1.16.16.16.16.16.16.1.1.cmml">⁢</mo><mi id="S3.E1.m1.16.16.16.16.16.16.1.5" xref="S3.E1.m1.16.16.16.16.16.16.1.5.cmml">k</mi></mrow></msub></mrow></mrow><mo id="S3.E1.m1.17.17.17.17.17.17" stretchy="false" xref="S3.E1.m1.40.40.2.3.cmml">)</mo></mrow></mrow></mtd></mtr><mtr id="S3.E1.m1.42.42.4d"><mtd id="S3.E1.m1.42.42.4e" xref="S3.E1.m1.40.40.2.3.cmml"></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E1.m1.42.42.4f"><mrow id="S3.E1.m1.42.42.4.40.22.22.22"><mi id="S3.E1.m1.18.18.18.1.1.1" xref="S3.E1.m1.18.18.18.1.1.1.cmml">s</mi><mo id="S3.E1.m1.19.19.19.2.2.2" lspace="0em" rspace="0.167em" xref="S3.E1.m1.40.40.2.3.cmml">.</mo><mi id="S3.E1.m1.20.20.20.3.3.3" xref="S3.E1.m1.20.20.20.3.3.3.cmml">t</mi><mo id="S3.E1.m1.21.21.21.4.4.4" lspace="0em" rspace="0.497em" xref="S3.E1.m1.40.40.2.3.cmml">.</mo><mrow id="S3.E1.m1.42.42.4.40.22.22.22.1"><mrow id="S3.E1.m1.42.42.4.40.22.22.22.1.1.1"><mrow id="S3.E1.m1.42.42.4.40.22.22.22.1.1.1.1.1"><mo id="S3.E1.m1.22.22.22.5.5.5" stretchy="false" xref="S3.E1.m1.40.40.2.3.cmml">|</mo><mrow id="S3.E1.m1.42.42.4.40.22.22.22.1.1.1.1.1.1"><mi id="S3.E1.m1.23.23.23.6.6.6" xref="S3.E1.m1.23.23.23.6.6.6.cmml">ϕ</mi><mo id="S3.E1.m1.42.42.4.40.22.22.22.1.1.1.1.1.1.2" xref="S3.E1.m1.40.40.2.3.cmml">⁢</mo><mrow id="S3.E1.m1.42.42.4.40.22.22.22.1.1.1.1.1.1.1.1"><mo id="S3.E1.m1.24.24.24.7.7.7" stretchy="false" xref="S3.E1.m1.40.40.2.3.cmml">(</mo><msub id="S3.E1.m1.42.42.4.40.22.22.22.1.1.1.1.1.1.1.1.1"><mi id="S3.E1.m1.25.25.25.8.8.8" mathvariant="normal" xref="S3.E1.m1.25.25.25.8.8.8.cmml">X</mi><mrow id="S3.E1.m1.26.26.26.9.9.9.1" xref="S3.E1.m1.26.26.26.9.9.9.1.cmml"><mi id="S3.E1.m1.26.26.26.9.9.9.1.2" xref="S3.E1.m1.26.26.26.9.9.9.1.2.cmml">r</mi><mo id="S3.E1.m1.26.26.26.9.9.9.1.1" xref="S3.E1.m1.26.26.26.9.9.9.1.1.cmml">⁢</mo><mi id="S3.E1.m1.26.26.26.9.9.9.1.3" xref="S3.E1.m1.26.26.26.9.9.9.1.3.cmml">e</mi><mo id="S3.E1.m1.26.26.26.9.9.9.1.1a" xref="S3.E1.m1.26.26.26.9.9.9.1.1.cmml">⁢</mo><mi id="S3.E1.m1.26.26.26.9.9.9.1.4" xref="S3.E1.m1.26.26.26.9.9.9.1.4.cmml">t</mi><mo id="S3.E1.m1.26.26.26.9.9.9.1.1b" xref="S3.E1.m1.26.26.26.9.9.9.1.1.cmml">⁢</mo><mi id="S3.E1.m1.26.26.26.9.9.9.1.5" xref="S3.E1.m1.26.26.26.9.9.9.1.5.cmml">r</mi></mrow></msub><mo id="S3.E1.m1.27.27.27.10.10.10" stretchy="false" xref="S3.E1.m1.40.40.2.3.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.28.28.28.11.11.11" stretchy="false" xref="S3.E1.m1.40.40.2.3.cmml">|</mo></mrow><mo id="S3.E1.m1.29.29.29.12.12.12" xref="S3.E1.m1.29.29.29.12.12.12.cmml">=</mo><mi id="S3.E1.m1.30.30.30.13.13.13" xref="S3.E1.m1.30.30.30.13.13.13.cmml">k</mi></mrow><mo id="S3.E1.m1.31.31.31.14.14.14" rspace="0.827em" xref="S3.E1.m1.40.40.2.3.cmml">,</mo><mrow id="S3.E1.m1.42.42.4.40.22.22.22.1.2.2"><mrow id="S3.E1.m1.42.42.4.40.22.22.22.1.2.2.2"><mtext id="S3.E1.m1.32.32.32.15.15.15" xref="S3.E1.m1.32.32.32.15.15.15a.cmml">where </mtext><mo id="S3.E1.m1.42.42.4.40.22.22.22.1.2.2.2.1" xref="S3.E1.m1.40.40.2.3.cmml">⁢</mo><mi id="S3.E1.m1.33.33.33.16.16.16" xref="S3.E1.m1.33.33.33.16.16.16.cmml">k</mi></mrow><mo id="S3.E1.m1.34.34.34.17.17.17" xref="S3.E1.m1.34.34.34.17.17.17.cmml">&lt;</mo><mrow id="S3.E1.m1.42.42.4.40.22.22.22.1.2.2.1.1"><mo id="S3.E1.m1.35.35.35.18.18.18" stretchy="false" xref="S3.E1.m1.40.40.2.3.cmml">|</mo><msub id="S3.E1.m1.42.42.4.40.22.22.22.1.2.2.1.1.1"><mi id="S3.E1.m1.36.36.36.19.19.19" xref="S3.E1.m1.36.36.36.19.19.19.cmml">X</mi><mrow id="S3.E1.m1.37.37.37.20.20.20.1" xref="S3.E1.m1.37.37.37.20.20.20.1.cmml"><mi id="S3.E1.m1.37.37.37.20.20.20.1.2" xref="S3.E1.m1.37.37.37.20.20.20.1.2.cmml">r</mi><mo id="S3.E1.m1.37.37.37.20.20.20.1.1" xref="S3.E1.m1.37.37.37.20.20.20.1.1.cmml">⁢</mo><mi id="S3.E1.m1.37.37.37.20.20.20.1.3" xref="S3.E1.m1.37.37.37.20.20.20.1.3.cmml">e</mi><mo id="S3.E1.m1.37.37.37.20.20.20.1.1a" xref="S3.E1.m1.37.37.37.20.20.20.1.1.cmml">⁢</mo><mi id="S3.E1.m1.37.37.37.20.20.20.1.4" xref="S3.E1.m1.37.37.37.20.20.20.1.4.cmml">t</mi><mo id="S3.E1.m1.37.37.37.20.20.20.1.1b" xref="S3.E1.m1.37.37.37.20.20.20.1.1.cmml">⁢</mo><mi id="S3.E1.m1.37.37.37.20.20.20.1.5" xref="S3.E1.m1.37.37.37.20.20.20.1.5.cmml">r</mi></mrow></msub><mo id="S3.E1.m1.38.38.38.21.21.21" stretchy="false" xref="S3.E1.m1.40.40.2.3.cmml">|</mo></mrow></mrow></mrow></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E1.m1.42b"><apply id="S3.E1.m1.40.40.2.3.cmml" xref="S3.E1.m1.42.42.4b"><csymbol cd="ambiguous" id="S3.E1.m1.40.40.2.3a.cmml" xref="S3.E1.m1.42.42.4b">formulae-sequence</csymbol><apply id="S3.E1.m1.39.39.1.1.1.cmml" xref="S3.E1.m1.42.42.4b"><times id="S3.E1.m1.39.39.1.1.1.2.cmml" xref="S3.E1.m1.42.42.4b"></times><apply id="S3.E1.m1.39.39.1.1.1.3.cmml" xref="S3.E1.m1.42.42.4b"><apply id="S3.E1.m1.39.39.1.1.1.3.1.cmml" xref="S3.E1.m1.42.42.4b"><csymbol cd="ambiguous" id="S3.E1.m1.39.39.1.1.1.3.1.1.cmml" xref="S3.E1.m1.42.42.4b">subscript</csymbol><max id="S3.E1.m1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1"></max><ci id="S3.E1.m1.2.2.2.2.2.2.1.cmml" xref="S3.E1.m1.2.2.2.2.2.2.1">italic-ϕ</ci></apply><apply id="S3.E1.m1.39.39.1.1.1.3.2.cmml" xref="S3.E1.m1.42.42.4b"><csymbol cd="ambiguous" id="S3.E1.m1.39.39.1.1.1.3.2.1.cmml" xref="S3.E1.m1.42.42.4b">subscript</csymbol><ci id="S3.E1.m1.3.3.3.3.3.3.cmml" xref="S3.E1.m1.3.3.3.3.3.3">𝑃</ci><apply id="S3.E1.m1.4.4.4.4.4.4.1.cmml" xref="S3.E1.m1.4.4.4.4.4.4.1"><times id="S3.E1.m1.4.4.4.4.4.4.1.1.cmml" xref="S3.E1.m1.4.4.4.4.4.4.1.1"></times><ci id="S3.E1.m1.4.4.4.4.4.4.1.2.cmml" xref="S3.E1.m1.4.4.4.4.4.4.1.2">𝐿</ci><ci id="S3.E1.m1.4.4.4.4.4.4.1.3.cmml" xref="S3.E1.m1.4.4.4.4.4.4.1.3">𝐿</ci><ci id="S3.E1.m1.4.4.4.4.4.4.1.4.cmml" xref="S3.E1.m1.4.4.4.4.4.4.1.4">𝑀</ci></apply></apply></apply><apply id="S3.E1.m1.39.39.1.1.1.1.1.1.cmml" xref="S3.E1.m1.42.42.4b"><csymbol cd="latexml" id="S3.E1.m1.8.8.8.8.8.8.cmml" xref="S3.E1.m1.8.8.8.8.8.8">conditional</csymbol><apply id="S3.E1.m1.39.39.1.1.1.1.1.1.4.cmml" xref="S3.E1.m1.42.42.4b"><csymbol cd="ambiguous" id="S3.E1.m1.39.39.1.1.1.1.1.1.4.1.cmml" xref="S3.E1.m1.42.42.4b">subscript</csymbol><ci id="S3.E1.m1.6.6.6.6.6.6.cmml" xref="S3.E1.m1.6.6.6.6.6.6">X</ci><apply id="S3.E1.m1.7.7.7.7.7.7.1.cmml" xref="S3.E1.m1.7.7.7.7.7.7.1"><times id="S3.E1.m1.7.7.7.7.7.7.1.1.cmml" xref="S3.E1.m1.7.7.7.7.7.7.1.1"></times><ci id="S3.E1.m1.7.7.7.7.7.7.1.2.cmml" xref="S3.E1.m1.7.7.7.7.7.7.1.2">𝑎</ci><ci id="S3.E1.m1.7.7.7.7.7.7.1.3.cmml" xref="S3.E1.m1.7.7.7.7.7.7.1.3">𝑛</ci><ci id="S3.E1.m1.7.7.7.7.7.7.1.4.cmml" xref="S3.E1.m1.7.7.7.7.7.7.1.4">𝑠</ci></apply></apply><list id="S3.E1.m1.39.39.1.1.1.1.1.1.2.3.cmml" xref="S3.E1.m1.42.42.4b"><apply id="S3.E1.m1.39.39.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.42.42.4b"><times id="S3.E1.m1.39.39.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.42.42.4b"></times><ci id="S3.E1.m1.9.9.9.9.9.9.cmml" xref="S3.E1.m1.9.9.9.9.9.9">italic-ϕ</ci><apply id="S3.E1.m1.39.39.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.42.42.4b"><csymbol cd="ambiguous" id="S3.E1.m1.39.39.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.42.42.4b">subscript</csymbol><ci id="S3.E1.m1.11.11.11.11.11.11.cmml" xref="S3.E1.m1.11.11.11.11.11.11">X</ci><apply id="S3.E1.m1.12.12.12.12.12.12.1.cmml" xref="S3.E1.m1.12.12.12.12.12.12.1"><times id="S3.E1.m1.12.12.12.12.12.12.1.1.cmml" xref="S3.E1.m1.12.12.12.12.12.12.1.1"></times><ci id="S3.E1.m1.12.12.12.12.12.12.1.2.cmml" xref="S3.E1.m1.12.12.12.12.12.12.1.2">𝑟</ci><ci id="S3.E1.m1.12.12.12.12.12.12.1.3.cmml" xref="S3.E1.m1.12.12.12.12.12.12.1.3">𝑒</ci><ci id="S3.E1.m1.12.12.12.12.12.12.1.4.cmml" xref="S3.E1.m1.12.12.12.12.12.12.1.4">𝑡</ci><ci id="S3.E1.m1.12.12.12.12.12.12.1.5.cmml" xref="S3.E1.m1.12.12.12.12.12.12.1.5">𝑟</ci></apply></apply></apply><apply id="S3.E1.m1.39.39.1.1.1.1.1.1.2.2.2.cmml" xref="S3.E1.m1.42.42.4b"><csymbol cd="ambiguous" id="S3.E1.m1.39.39.1.1.1.1.1.1.2.2.2.1.cmml" xref="S3.E1.m1.42.42.4b">subscript</csymbol><ci id="S3.E1.m1.15.15.15.15.15.15.cmml" xref="S3.E1.m1.15.15.15.15.15.15">X</ci><apply id="S3.E1.m1.16.16.16.16.16.16.1.cmml" xref="S3.E1.m1.16.16.16.16.16.16.1"><times id="S3.E1.m1.16.16.16.16.16.16.1.1.cmml" xref="S3.E1.m1.16.16.16.16.16.16.1.1"></times><ci id="S3.E1.m1.16.16.16.16.16.16.1.2.cmml" xref="S3.E1.m1.16.16.16.16.16.16.1.2">𝑡</ci><ci id="S3.E1.m1.16.16.16.16.16.16.1.3.cmml" xref="S3.E1.m1.16.16.16.16.16.16.1.3">𝑎</ci><ci id="S3.E1.m1.16.16.16.16.16.16.1.4.cmml" xref="S3.E1.m1.16.16.16.16.16.16.1.4">𝑠</ci><ci id="S3.E1.m1.16.16.16.16.16.16.1.5.cmml" xref="S3.E1.m1.16.16.16.16.16.16.1.5">𝑘</ci></apply></apply></list></apply><ci id="S3.E1.m1.18.18.18.1.1.1.cmml" xref="S3.E1.m1.18.18.18.1.1.1">𝑠</ci></apply><ci id="S3.E1.m1.20.20.20.3.3.3.cmml" xref="S3.E1.m1.20.20.20.3.3.3">𝑡</ci><apply id="S3.E1.m1.40.40.2.2.2.3.cmml" xref="S3.E1.m1.42.42.4b"><csymbol cd="ambiguous" id="S3.E1.m1.40.40.2.2.2.3a.cmml" xref="S3.E1.m1.42.42.4b">formulae-sequence</csymbol><apply id="S3.E1.m1.40.40.2.2.2.1.1.cmml" xref="S3.E1.m1.42.42.4b"><eq id="S3.E1.m1.29.29.29.12.12.12.cmml" xref="S3.E1.m1.29.29.29.12.12.12"></eq><apply id="S3.E1.m1.40.40.2.2.2.1.1.1.2.cmml" xref="S3.E1.m1.42.42.4b"><abs id="S3.E1.m1.40.40.2.2.2.1.1.1.2.1.cmml" xref="S3.E1.m1.42.42.4b"></abs><apply id="S3.E1.m1.40.40.2.2.2.1.1.1.1.1.cmml" xref="S3.E1.m1.42.42.4b"><times id="S3.E1.m1.40.40.2.2.2.1.1.1.1.1.2.cmml" xref="S3.E1.m1.42.42.4b"></times><ci id="S3.E1.m1.23.23.23.6.6.6.cmml" xref="S3.E1.m1.23.23.23.6.6.6">italic-ϕ</ci><apply id="S3.E1.m1.40.40.2.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.42.42.4b"><csymbol cd="ambiguous" id="S3.E1.m1.40.40.2.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.42.42.4b">subscript</csymbol><ci id="S3.E1.m1.25.25.25.8.8.8.cmml" xref="S3.E1.m1.25.25.25.8.8.8">X</ci><apply id="S3.E1.m1.26.26.26.9.9.9.1.cmml" xref="S3.E1.m1.26.26.26.9.9.9.1"><times id="S3.E1.m1.26.26.26.9.9.9.1.1.cmml" xref="S3.E1.m1.26.26.26.9.9.9.1.1"></times><ci id="S3.E1.m1.26.26.26.9.9.9.1.2.cmml" xref="S3.E1.m1.26.26.26.9.9.9.1.2">𝑟</ci><ci id="S3.E1.m1.26.26.26.9.9.9.1.3.cmml" xref="S3.E1.m1.26.26.26.9.9.9.1.3">𝑒</ci><ci id="S3.E1.m1.26.26.26.9.9.9.1.4.cmml" xref="S3.E1.m1.26.26.26.9.9.9.1.4">𝑡</ci><ci id="S3.E1.m1.26.26.26.9.9.9.1.5.cmml" xref="S3.E1.m1.26.26.26.9.9.9.1.5">𝑟</ci></apply></apply></apply></apply><ci id="S3.E1.m1.30.30.30.13.13.13.cmml" xref="S3.E1.m1.30.30.30.13.13.13">𝑘</ci></apply><apply id="S3.E1.m1.40.40.2.2.2.2.2.cmml" xref="S3.E1.m1.42.42.4b"><lt id="S3.E1.m1.34.34.34.17.17.17.cmml" xref="S3.E1.m1.34.34.34.17.17.17"></lt><apply id="S3.E1.m1.40.40.2.2.2.2.2.3.cmml" xref="S3.E1.m1.42.42.4b"><times id="S3.E1.m1.40.40.2.2.2.2.2.3.1.cmml" xref="S3.E1.m1.42.42.4b"></times><ci id="S3.E1.m1.32.32.32.15.15.15a.cmml" xref="S3.E1.m1.32.32.32.15.15.15"><mtext id="S3.E1.m1.32.32.32.15.15.15.cmml" xref="S3.E1.m1.32.32.32.15.15.15">where </mtext></ci><ci id="S3.E1.m1.33.33.33.16.16.16.cmml" xref="S3.E1.m1.33.33.33.16.16.16">𝑘</ci></apply><apply id="S3.E1.m1.40.40.2.2.2.2.2.1.2.cmml" xref="S3.E1.m1.42.42.4b"><abs id="S3.E1.m1.40.40.2.2.2.2.2.1.2.1.cmml" xref="S3.E1.m1.42.42.4b"></abs><apply id="S3.E1.m1.40.40.2.2.2.2.2.1.1.1.cmml" xref="S3.E1.m1.42.42.4b"><csymbol cd="ambiguous" id="S3.E1.m1.40.40.2.2.2.2.2.1.1.1.1.cmml" xref="S3.E1.m1.42.42.4b">subscript</csymbol><ci id="S3.E1.m1.36.36.36.19.19.19.cmml" xref="S3.E1.m1.36.36.36.19.19.19">𝑋</ci><apply id="S3.E1.m1.37.37.37.20.20.20.1.cmml" xref="S3.E1.m1.37.37.37.20.20.20.1"><times id="S3.E1.m1.37.37.37.20.20.20.1.1.cmml" xref="S3.E1.m1.37.37.37.20.20.20.1.1"></times><ci id="S3.E1.m1.37.37.37.20.20.20.1.2.cmml" xref="S3.E1.m1.37.37.37.20.20.20.1.2">𝑟</ci><ci id="S3.E1.m1.37.37.37.20.20.20.1.3.cmml" xref="S3.E1.m1.37.37.37.20.20.20.1.3">𝑒</ci><ci id="S3.E1.m1.37.37.37.20.20.20.1.4.cmml" xref="S3.E1.m1.37.37.37.20.20.20.1.4">𝑡</ci><ci id="S3.E1.m1.37.37.37.20.20.20.1.5.cmml" xref="S3.E1.m1.37.37.37.20.20.20.1.5">𝑟</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.42c">\begin{split}&amp;\max\limits_{\phi}~{}P_{LLM}(\mathrm{X}_{ans}|\phi(\mathrm{X}_{%
retr}),\mathrm{X}_{task})\\
&amp;~{}~{}s.t.~{}|\phi(\mathrm{X}_{retr})|=k,~{}~{}\text{where }k&lt;|X_{retr}|\end{split}</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.42d">start_ROW start_CELL end_CELL start_CELL roman_max start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT italic_P start_POSTSUBSCRIPT italic_L italic_L italic_M end_POSTSUBSCRIPT ( roman_X start_POSTSUBSCRIPT italic_a italic_n italic_s end_POSTSUBSCRIPT | italic_ϕ ( roman_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT ) , roman_X start_POSTSUBSCRIPT italic_t italic_a italic_s italic_k end_POSTSUBSCRIPT ) end_CELL end_ROW start_ROW start_CELL end_CELL start_CELL italic_s . italic_t . | italic_ϕ ( roman_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT ) | = italic_k , where italic_k &lt; | italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT | end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p1.7">In other words, we aim to realize the <span class="ltx_text ltx_font_bold" id="S3.SS1.p1.7.1">optimal compression</span>, where the compressed context of the predefined size <math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p1.6.m1.1"><semantics id="S3.SS1.p1.6.m1.1a"><mi id="S3.SS1.p1.6.m1.1.1" xref="S3.SS1.p1.6.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.6.m1.1b"><ci id="S3.SS1.p1.6.m1.1.1.cmml" xref="S3.SS1.p1.6.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.6.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.6.m1.1d">italic_k</annotation></semantics></math> can maximize the generation likelihood of the ground-truth answer. Additionally, the compressor is expected to achieve <span class="ltx_text ltx_font_bold" id="S3.SS1.p1.7.2">flexible compression</span>, allowing the retrieved context to be compressed to any length within the original context length <math alttext="|X_{retr}|" class="ltx_Math" display="inline" id="S3.SS1.p1.7.m2.1"><semantics id="S3.SS1.p1.7.m2.1a"><mrow id="S3.SS1.p1.7.m2.1.1.1" xref="S3.SS1.p1.7.m2.1.1.2.cmml"><mo id="S3.SS1.p1.7.m2.1.1.1.2" stretchy="false" xref="S3.SS1.p1.7.m2.1.1.2.1.cmml">|</mo><msub id="S3.SS1.p1.7.m2.1.1.1.1" xref="S3.SS1.p1.7.m2.1.1.1.1.cmml"><mi id="S3.SS1.p1.7.m2.1.1.1.1.2" xref="S3.SS1.p1.7.m2.1.1.1.1.2.cmml">X</mi><mrow id="S3.SS1.p1.7.m2.1.1.1.1.3" xref="S3.SS1.p1.7.m2.1.1.1.1.3.cmml"><mi id="S3.SS1.p1.7.m2.1.1.1.1.3.2" xref="S3.SS1.p1.7.m2.1.1.1.1.3.2.cmml">r</mi><mo id="S3.SS1.p1.7.m2.1.1.1.1.3.1" xref="S3.SS1.p1.7.m2.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.7.m2.1.1.1.1.3.3" xref="S3.SS1.p1.7.m2.1.1.1.1.3.3.cmml">e</mi><mo id="S3.SS1.p1.7.m2.1.1.1.1.3.1a" xref="S3.SS1.p1.7.m2.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.7.m2.1.1.1.1.3.4" xref="S3.SS1.p1.7.m2.1.1.1.1.3.4.cmml">t</mi><mo id="S3.SS1.p1.7.m2.1.1.1.1.3.1b" xref="S3.SS1.p1.7.m2.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.7.m2.1.1.1.1.3.5" xref="S3.SS1.p1.7.m2.1.1.1.1.3.5.cmml">r</mi></mrow></msub><mo id="S3.SS1.p1.7.m2.1.1.1.3" stretchy="false" xref="S3.SS1.p1.7.m2.1.1.2.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.7.m2.1b"><apply id="S3.SS1.p1.7.m2.1.1.2.cmml" xref="S3.SS1.p1.7.m2.1.1.1"><abs id="S3.SS1.p1.7.m2.1.1.2.1.cmml" xref="S3.SS1.p1.7.m2.1.1.1.2"></abs><apply id="S3.SS1.p1.7.m2.1.1.1.1.cmml" xref="S3.SS1.p1.7.m2.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.7.m2.1.1.1.1.1.cmml" xref="S3.SS1.p1.7.m2.1.1.1.1">subscript</csymbol><ci id="S3.SS1.p1.7.m2.1.1.1.1.2.cmml" xref="S3.SS1.p1.7.m2.1.1.1.1.2">𝑋</ci><apply id="S3.SS1.p1.7.m2.1.1.1.1.3.cmml" xref="S3.SS1.p1.7.m2.1.1.1.1.3"><times id="S3.SS1.p1.7.m2.1.1.1.1.3.1.cmml" xref="S3.SS1.p1.7.m2.1.1.1.1.3.1"></times><ci id="S3.SS1.p1.7.m2.1.1.1.1.3.2.cmml" xref="S3.SS1.p1.7.m2.1.1.1.1.3.2">𝑟</ci><ci id="S3.SS1.p1.7.m2.1.1.1.1.3.3.cmml" xref="S3.SS1.p1.7.m2.1.1.1.1.3.3">𝑒</ci><ci id="S3.SS1.p1.7.m2.1.1.1.1.3.4.cmml" xref="S3.SS1.p1.7.m2.1.1.1.1.3.4">𝑡</ci><ci id="S3.SS1.p1.7.m2.1.1.1.1.3.5.cmml" xref="S3.SS1.p1.7.m2.1.1.1.1.3.5">𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.7.m2.1c">|X_{retr}|</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.7.m2.1d">| italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT |</annotation></semantics></math>.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2. </span>Architecture</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.5">The workflow of FlexRAG consists of the following steps (Figure <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S2.F2" title="Figure 2 ‣ 2.3. RAG Fine-tuning ‣ 2. Related Works ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">2</span></a>). First, the retrieved context is tokenized and jointly encoded as a sequence of embeddings, denoted as <math alttext="\mathbf{E}_{retr}" class="ltx_Math" display="inline" id="S3.SS2.p1.1.m1.1"><semantics id="S3.SS2.p1.1.m1.1a"><msub id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml"><mi id="S3.SS2.p1.1.m1.1.1.2" xref="S3.SS2.p1.1.m1.1.1.2.cmml">𝐄</mi><mrow id="S3.SS2.p1.1.m1.1.1.3" xref="S3.SS2.p1.1.m1.1.1.3.cmml"><mi id="S3.SS2.p1.1.m1.1.1.3.2" xref="S3.SS2.p1.1.m1.1.1.3.2.cmml">r</mi><mo id="S3.SS2.p1.1.m1.1.1.3.1" xref="S3.SS2.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.1.m1.1.1.3.3" xref="S3.SS2.p1.1.m1.1.1.3.3.cmml">e</mi><mo id="S3.SS2.p1.1.m1.1.1.3.1a" xref="S3.SS2.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.1.m1.1.1.3.4" xref="S3.SS2.p1.1.m1.1.1.3.4.cmml">t</mi><mo id="S3.SS2.p1.1.m1.1.1.3.1b" xref="S3.SS2.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.1.m1.1.1.3.5" xref="S3.SS2.p1.1.m1.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b"><apply id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.1.m1.1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p1.1.m1.1.1.2.cmml" xref="S3.SS2.p1.1.m1.1.1.2">𝐄</ci><apply id="S3.SS2.p1.1.m1.1.1.3.cmml" xref="S3.SS2.p1.1.m1.1.1.3"><times id="S3.SS2.p1.1.m1.1.1.3.1.cmml" xref="S3.SS2.p1.1.m1.1.1.3.1"></times><ci id="S3.SS2.p1.1.m1.1.1.3.2.cmml" xref="S3.SS2.p1.1.m1.1.1.3.2">𝑟</ci><ci id="S3.SS2.p1.1.m1.1.1.3.3.cmml" xref="S3.SS2.p1.1.m1.1.1.3.3">𝑒</ci><ci id="S3.SS2.p1.1.m1.1.1.3.4.cmml" xref="S3.SS2.p1.1.m1.1.1.3.4">𝑡</ci><ci id="S3.SS2.p1.1.m1.1.1.3.5.cmml" xref="S3.SS2.p1.1.m1.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">\mathbf{E}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.1.m1.1d">bold_E start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math>, using a specialized context encoder <math alttext="\psi(\cdot)" class="ltx_Math" display="inline" id="S3.SS2.p1.2.m2.1"><semantics id="S3.SS2.p1.2.m2.1a"><mrow id="S3.SS2.p1.2.m2.1.2" xref="S3.SS2.p1.2.m2.1.2.cmml"><mi id="S3.SS2.p1.2.m2.1.2.2" xref="S3.SS2.p1.2.m2.1.2.2.cmml">ψ</mi><mo id="S3.SS2.p1.2.m2.1.2.1" xref="S3.SS2.p1.2.m2.1.2.1.cmml">⁢</mo><mrow id="S3.SS2.p1.2.m2.1.2.3.2" xref="S3.SS2.p1.2.m2.1.2.cmml"><mo id="S3.SS2.p1.2.m2.1.2.3.2.1" stretchy="false" xref="S3.SS2.p1.2.m2.1.2.cmml">(</mo><mo id="S3.SS2.p1.2.m2.1.1" lspace="0em" rspace="0em" xref="S3.SS2.p1.2.m2.1.1.cmml">⋅</mo><mo id="S3.SS2.p1.2.m2.1.2.3.2.2" stretchy="false" xref="S3.SS2.p1.2.m2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.2.m2.1b"><apply id="S3.SS2.p1.2.m2.1.2.cmml" xref="S3.SS2.p1.2.m2.1.2"><times id="S3.SS2.p1.2.m2.1.2.1.cmml" xref="S3.SS2.p1.2.m2.1.2.1"></times><ci id="S3.SS2.p1.2.m2.1.2.2.cmml" xref="S3.SS2.p1.2.m2.1.2.2">𝜓</ci><ci id="S3.SS2.p1.2.m2.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.2.m2.1c">\psi(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.2.m2.1d">italic_ψ ( ⋅ )</annotation></semantics></math>: <math alttext="\mathbf{E}_{retr}\leftarrow\psi(X_{retr})" class="ltx_Math" display="inline" id="S3.SS2.p1.3.m3.1"><semantics id="S3.SS2.p1.3.m3.1a"><mrow id="S3.SS2.p1.3.m3.1.1" xref="S3.SS2.p1.3.m3.1.1.cmml"><msub id="S3.SS2.p1.3.m3.1.1.3" xref="S3.SS2.p1.3.m3.1.1.3.cmml"><mi id="S3.SS2.p1.3.m3.1.1.3.2" xref="S3.SS2.p1.3.m3.1.1.3.2.cmml">𝐄</mi><mrow id="S3.SS2.p1.3.m3.1.1.3.3" xref="S3.SS2.p1.3.m3.1.1.3.3.cmml"><mi id="S3.SS2.p1.3.m3.1.1.3.3.2" xref="S3.SS2.p1.3.m3.1.1.3.3.2.cmml">r</mi><mo id="S3.SS2.p1.3.m3.1.1.3.3.1" xref="S3.SS2.p1.3.m3.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.3.m3.1.1.3.3.3" xref="S3.SS2.p1.3.m3.1.1.3.3.3.cmml">e</mi><mo id="S3.SS2.p1.3.m3.1.1.3.3.1a" xref="S3.SS2.p1.3.m3.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.3.m3.1.1.3.3.4" xref="S3.SS2.p1.3.m3.1.1.3.3.4.cmml">t</mi><mo id="S3.SS2.p1.3.m3.1.1.3.3.1b" xref="S3.SS2.p1.3.m3.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.3.m3.1.1.3.3.5" xref="S3.SS2.p1.3.m3.1.1.3.3.5.cmml">r</mi></mrow></msub><mo id="S3.SS2.p1.3.m3.1.1.2" stretchy="false" xref="S3.SS2.p1.3.m3.1.1.2.cmml">←</mo><mrow id="S3.SS2.p1.3.m3.1.1.1" xref="S3.SS2.p1.3.m3.1.1.1.cmml"><mi id="S3.SS2.p1.3.m3.1.1.1.3" xref="S3.SS2.p1.3.m3.1.1.1.3.cmml">ψ</mi><mo id="S3.SS2.p1.3.m3.1.1.1.2" xref="S3.SS2.p1.3.m3.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.p1.3.m3.1.1.1.1.1" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.cmml"><mo id="S3.SS2.p1.3.m3.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.cmml">(</mo><msub id="S3.SS2.p1.3.m3.1.1.1.1.1.1" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.cmml"><mi id="S3.SS2.p1.3.m3.1.1.1.1.1.1.2" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.2.cmml">X</mi><mrow id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.cmml"><mi id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.2" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.2.cmml">r</mi><mo id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.1" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.3" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.3.cmml">e</mi><mo id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.1a" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.4" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.4.cmml">t</mi><mo id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.1b" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.5" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.5.cmml">r</mi></mrow></msub><mo id="S3.SS2.p1.3.m3.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.3.m3.1b"><apply id="S3.SS2.p1.3.m3.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1"><ci id="S3.SS2.p1.3.m3.1.1.2.cmml" xref="S3.SS2.p1.3.m3.1.1.2">←</ci><apply id="S3.SS2.p1.3.m3.1.1.3.cmml" xref="S3.SS2.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.p1.3.m3.1.1.3.1.cmml" xref="S3.SS2.p1.3.m3.1.1.3">subscript</csymbol><ci id="S3.SS2.p1.3.m3.1.1.3.2.cmml" xref="S3.SS2.p1.3.m3.1.1.3.2">𝐄</ci><apply id="S3.SS2.p1.3.m3.1.1.3.3.cmml" xref="S3.SS2.p1.3.m3.1.1.3.3"><times id="S3.SS2.p1.3.m3.1.1.3.3.1.cmml" xref="S3.SS2.p1.3.m3.1.1.3.3.1"></times><ci id="S3.SS2.p1.3.m3.1.1.3.3.2.cmml" xref="S3.SS2.p1.3.m3.1.1.3.3.2">𝑟</ci><ci id="S3.SS2.p1.3.m3.1.1.3.3.3.cmml" xref="S3.SS2.p1.3.m3.1.1.3.3.3">𝑒</ci><ci id="S3.SS2.p1.3.m3.1.1.3.3.4.cmml" xref="S3.SS2.p1.3.m3.1.1.3.3.4">𝑡</ci><ci id="S3.SS2.p1.3.m3.1.1.3.3.5.cmml" xref="S3.SS2.p1.3.m3.1.1.3.3.5">𝑟</ci></apply></apply><apply id="S3.SS2.p1.3.m3.1.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1.1"><times id="S3.SS2.p1.3.m3.1.1.1.2.cmml" xref="S3.SS2.p1.3.m3.1.1.1.2"></times><ci id="S3.SS2.p1.3.m3.1.1.1.3.cmml" xref="S3.SS2.p1.3.m3.1.1.1.3">𝜓</ci><apply id="S3.SS2.p1.3.m3.1.1.1.1.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.3.m3.1.1.1.1.1.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p1.3.m3.1.1.1.1.1.1.2.cmml" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.2">𝑋</ci><apply id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.cmml" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3"><times id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.1.cmml" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.1"></times><ci id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.2.cmml" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.2">𝑟</ci><ci id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.3.cmml" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.3">𝑒</ci><ci id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.4.cmml" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.4">𝑡</ci><ci id="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.5.cmml" xref="S3.SS2.p1.3.m3.1.1.1.1.1.1.3.5">𝑟</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.3.m3.1c">\mathbf{E}_{retr}\leftarrow\psi(X_{retr})</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.3.m3.1d">bold_E start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT ← italic_ψ ( italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT )</annotation></semantics></math>. Next, the well-encoded embeddings <math alttext="\mathbf{E}_{retr}" class="ltx_Math" display="inline" id="S3.SS2.p1.4.m4.1"><semantics id="S3.SS2.p1.4.m4.1a"><msub id="S3.SS2.p1.4.m4.1.1" xref="S3.SS2.p1.4.m4.1.1.cmml"><mi id="S3.SS2.p1.4.m4.1.1.2" xref="S3.SS2.p1.4.m4.1.1.2.cmml">𝐄</mi><mrow id="S3.SS2.p1.4.m4.1.1.3" xref="S3.SS2.p1.4.m4.1.1.3.cmml"><mi id="S3.SS2.p1.4.m4.1.1.3.2" xref="S3.SS2.p1.4.m4.1.1.3.2.cmml">r</mi><mo id="S3.SS2.p1.4.m4.1.1.3.1" xref="S3.SS2.p1.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.4.m4.1.1.3.3" xref="S3.SS2.p1.4.m4.1.1.3.3.cmml">e</mi><mo id="S3.SS2.p1.4.m4.1.1.3.1a" xref="S3.SS2.p1.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.4.m4.1.1.3.4" xref="S3.SS2.p1.4.m4.1.1.3.4.cmml">t</mi><mo id="S3.SS2.p1.4.m4.1.1.3.1b" xref="S3.SS2.p1.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.4.m4.1.1.3.5" xref="S3.SS2.p1.4.m4.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.4.m4.1b"><apply id="S3.SS2.p1.4.m4.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.4.m4.1.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1">subscript</csymbol><ci id="S3.SS2.p1.4.m4.1.1.2.cmml" xref="S3.SS2.p1.4.m4.1.1.2">𝐄</ci><apply id="S3.SS2.p1.4.m4.1.1.3.cmml" xref="S3.SS2.p1.4.m4.1.1.3"><times id="S3.SS2.p1.4.m4.1.1.3.1.cmml" xref="S3.SS2.p1.4.m4.1.1.3.1"></times><ci id="S3.SS2.p1.4.m4.1.1.3.2.cmml" xref="S3.SS2.p1.4.m4.1.1.3.2">𝑟</ci><ci id="S3.SS2.p1.4.m4.1.1.3.3.cmml" xref="S3.SS2.p1.4.m4.1.1.3.3">𝑒</ci><ci id="S3.SS2.p1.4.m4.1.1.3.4.cmml" xref="S3.SS2.p1.4.m4.1.1.3.4">𝑡</ci><ci id="S3.SS2.p1.4.m4.1.1.3.5.cmml" xref="S3.SS2.p1.4.m4.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.4.m4.1c">\mathbf{E}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.4.m4.1d">bold_E start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math> are down-scaled by a sampling function <math alttext="\gamma(\cdot)" class="ltx_Math" display="inline" id="S3.SS2.p1.5.m5.1"><semantics id="S3.SS2.p1.5.m5.1a"><mrow id="S3.SS2.p1.5.m5.1.2" xref="S3.SS2.p1.5.m5.1.2.cmml"><mi id="S3.SS2.p1.5.m5.1.2.2" xref="S3.SS2.p1.5.m5.1.2.2.cmml">γ</mi><mo id="S3.SS2.p1.5.m5.1.2.1" xref="S3.SS2.p1.5.m5.1.2.1.cmml">⁢</mo><mrow id="S3.SS2.p1.5.m5.1.2.3.2" xref="S3.SS2.p1.5.m5.1.2.cmml"><mo id="S3.SS2.p1.5.m5.1.2.3.2.1" stretchy="false" xref="S3.SS2.p1.5.m5.1.2.cmml">(</mo><mo id="S3.SS2.p1.5.m5.1.1" lspace="0em" rspace="0em" xref="S3.SS2.p1.5.m5.1.1.cmml">⋅</mo><mo id="S3.SS2.p1.5.m5.1.2.3.2.2" stretchy="false" xref="S3.SS2.p1.5.m5.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.5.m5.1b"><apply id="S3.SS2.p1.5.m5.1.2.cmml" xref="S3.SS2.p1.5.m5.1.2"><times id="S3.SS2.p1.5.m5.1.2.1.cmml" xref="S3.SS2.p1.5.m5.1.2.1"></times><ci id="S3.SS2.p1.5.m5.1.2.2.cmml" xref="S3.SS2.p1.5.m5.1.2.2">𝛾</ci><ci id="S3.SS2.p1.5.m5.1.1.cmml" xref="S3.SS2.p1.5.m5.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.5.m5.1c">\gamma(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.5.m5.1d">italic_γ ( ⋅ )</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(2)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathbf{E}^{\prime}_{retr}\leftarrow\gamma(\mathbf{E}_{retr},k),~{}~{}~{}~{}%
\text{where}~{}~{}~{}~{}|\mathbf{E}^{\prime}_{retr}|=k," class="ltx_Math" display="block" id="S3.E2.m1.3"><semantics id="S3.E2.m1.3a"><mrow id="S3.E2.m1.3.3.1"><mrow id="S3.E2.m1.3.3.1.1.2" xref="S3.E2.m1.3.3.1.1.3.cmml"><mrow id="S3.E2.m1.3.3.1.1.1.1" xref="S3.E2.m1.3.3.1.1.1.1.cmml"><msubsup id="S3.E2.m1.3.3.1.1.1.1.3" xref="S3.E2.m1.3.3.1.1.1.1.3.cmml"><mi id="S3.E2.m1.3.3.1.1.1.1.3.2.2" xref="S3.E2.m1.3.3.1.1.1.1.3.2.2.cmml">𝐄</mi><mrow id="S3.E2.m1.3.3.1.1.1.1.3.3" xref="S3.E2.m1.3.3.1.1.1.1.3.3.cmml"><mi id="S3.E2.m1.3.3.1.1.1.1.3.3.2" xref="S3.E2.m1.3.3.1.1.1.1.3.3.2.cmml">r</mi><mo id="S3.E2.m1.3.3.1.1.1.1.3.3.1" xref="S3.E2.m1.3.3.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.3.3.1.1.1.1.3.3.3" xref="S3.E2.m1.3.3.1.1.1.1.3.3.3.cmml">e</mi><mo id="S3.E2.m1.3.3.1.1.1.1.3.3.1a" xref="S3.E2.m1.3.3.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.3.3.1.1.1.1.3.3.4" xref="S3.E2.m1.3.3.1.1.1.1.3.3.4.cmml">t</mi><mo id="S3.E2.m1.3.3.1.1.1.1.3.3.1b" xref="S3.E2.m1.3.3.1.1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.E2.m1.3.3.1.1.1.1.3.3.5" xref="S3.E2.m1.3.3.1.1.1.1.3.3.5.cmml">r</mi></mrow><mo id="S3.E2.m1.3.3.1.1.1.1.3.2.3" xref="S3.E2.m1.3.3.1.1.1.1.3.2.3.cmml">′</mo></msubsup><mo id="S3.E2.m1.3.3.1.1.1.1.2" stretchy="false" xref="S3.E2.m1.3.3.1.1.1.1.2.cmml">←</mo><mrow id="S3.E2.m1.3.3.1.1.1.1.1.1" xref="S3.E2.m1.3.3.1.1.1.1.1.2.cmml"><mrow id="S3.E2.m1.3.3.1.1.1.1.1.1.1" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.cmml"><mi id="S3.E2.m1.3.3.1.1.1.1.1.1.1.3" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.3.cmml">γ</mi><mo id="S3.E2.m1.3.3.1.1.1.1.1.1.1.2" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.2.cmml">(</mo><msub id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml">𝐄</mi><mrow id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.2" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.2.cmml">r</mi><mo id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.3" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.3.cmml">e</mi><mo id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1a" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.4" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.4.cmml">t</mi><mo id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1b" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.5" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.5.cmml">r</mi></mrow></msub><mo id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.3" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.2.cmml">,</mo><mi id="S3.E2.m1.1.1" xref="S3.E2.m1.1.1.cmml">k</mi><mo id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.3.3.1.1.1.1.1.1.2" rspace="1.487em" xref="S3.E2.m1.3.3.1.1.1.1.1.2.cmml">,</mo><mtext id="S3.E2.m1.2.2" xref="S3.E2.m1.2.2a.cmml">where</mtext></mrow></mrow><mspace id="S3.E2.m1.3.3.1.1.2.3" width="1.32em" xref="S3.E2.m1.3.3.1.1.3a.cmml"></mspace><mrow id="S3.E2.m1.3.3.1.1.2.2" xref="S3.E2.m1.3.3.1.1.2.2.cmml"><mrow id="S3.E2.m1.3.3.1.1.2.2.1.1" xref="S3.E2.m1.3.3.1.1.2.2.1.2.cmml"><mo id="S3.E2.m1.3.3.1.1.2.2.1.1.2" stretchy="false" xref="S3.E2.m1.3.3.1.1.2.2.1.2.1.cmml">|</mo><msubsup id="S3.E2.m1.3.3.1.1.2.2.1.1.1" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.cmml"><mi id="S3.E2.m1.3.3.1.1.2.2.1.1.1.2.2" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.2.2.cmml">𝐄</mi><mrow id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.cmml"><mi id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.2" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.2.cmml">r</mi><mo id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.1" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.3" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.3.cmml">e</mi><mo id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.1a" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.4" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.4.cmml">t</mi><mo id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.1b" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.5" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.5.cmml">r</mi></mrow><mo id="S3.E2.m1.3.3.1.1.2.2.1.1.1.2.3" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.2.3.cmml">′</mo></msubsup><mo id="S3.E2.m1.3.3.1.1.2.2.1.1.3" stretchy="false" xref="S3.E2.m1.3.3.1.1.2.2.1.2.1.cmml">|</mo></mrow><mo id="S3.E2.m1.3.3.1.1.2.2.2" xref="S3.E2.m1.3.3.1.1.2.2.2.cmml">=</mo><mi id="S3.E2.m1.3.3.1.1.2.2.3" xref="S3.E2.m1.3.3.1.1.2.2.3.cmml">k</mi></mrow></mrow><mo id="S3.E2.m1.3.3.1.2">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m1.3b"><apply id="S3.E2.m1.3.3.1.1.3.cmml" xref="S3.E2.m1.3.3.1.1.2"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.1.1.3a.cmml" xref="S3.E2.m1.3.3.1.1.2.3">formulae-sequence</csymbol><apply id="S3.E2.m1.3.3.1.1.1.1.cmml" xref="S3.E2.m1.3.3.1.1.1.1"><ci id="S3.E2.m1.3.3.1.1.1.1.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1.2">←</ci><apply id="S3.E2.m1.3.3.1.1.1.1.3.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.1.1.1.1.3.1.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3">subscript</csymbol><apply id="S3.E2.m1.3.3.1.1.1.1.3.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.1.1.1.1.3.2.1.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3">superscript</csymbol><ci id="S3.E2.m1.3.3.1.1.1.1.3.2.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3.2.2">𝐄</ci><ci id="S3.E2.m1.3.3.1.1.1.1.3.2.3.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3.2.3">′</ci></apply><apply id="S3.E2.m1.3.3.1.1.1.1.3.3.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3.3"><times id="S3.E2.m1.3.3.1.1.1.1.3.3.1.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3.3.1"></times><ci id="S3.E2.m1.3.3.1.1.1.1.3.3.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3.3.2">𝑟</ci><ci id="S3.E2.m1.3.3.1.1.1.1.3.3.3.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3.3.3">𝑒</ci><ci id="S3.E2.m1.3.3.1.1.1.1.3.3.4.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3.3.4">𝑡</ci><ci id="S3.E2.m1.3.3.1.1.1.1.3.3.5.cmml" xref="S3.E2.m1.3.3.1.1.1.1.3.3.5">𝑟</ci></apply></apply><list id="S3.E2.m1.3.3.1.1.1.1.1.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1"><apply id="S3.E2.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1"><times id="S3.E2.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.2"></times><ci id="S3.E2.m1.3.3.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.3">𝛾</ci><interval closure="open" id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1"><apply id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.2">𝐄</ci><apply id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3"><times id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1"></times><ci id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.2">𝑟</ci><ci id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.3">𝑒</ci><ci id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.4.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.4">𝑡</ci><ci id="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.5.cmml" xref="S3.E2.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.5">𝑟</ci></apply></apply><ci id="S3.E2.m1.1.1.cmml" xref="S3.E2.m1.1.1">𝑘</ci></interval></apply><ci id="S3.E2.m1.2.2a.cmml" xref="S3.E2.m1.2.2"><mtext id="S3.E2.m1.2.2.cmml" xref="S3.E2.m1.2.2">where</mtext></ci></list></apply><apply id="S3.E2.m1.3.3.1.1.2.2.cmml" xref="S3.E2.m1.3.3.1.1.2.2"><eq id="S3.E2.m1.3.3.1.1.2.2.2.cmml" xref="S3.E2.m1.3.3.1.1.2.2.2"></eq><apply id="S3.E2.m1.3.3.1.1.2.2.1.2.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1"><abs id="S3.E2.m1.3.3.1.1.2.2.1.2.1.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.2"></abs><apply id="S3.E2.m1.3.3.1.1.2.2.1.1.1.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.1.1.2.2.1.1.1.1.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1">subscript</csymbol><apply id="S3.E2.m1.3.3.1.1.2.2.1.1.1.2.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.1.1.2.2.1.1.1.2.1.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1">superscript</csymbol><ci id="S3.E2.m1.3.3.1.1.2.2.1.1.1.2.2.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.2.2">𝐄</ci><ci id="S3.E2.m1.3.3.1.1.2.2.1.1.1.2.3.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.2.3">′</ci></apply><apply id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3"><times id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.1.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.1"></times><ci id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.2.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.2">𝑟</ci><ci id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.3.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.3">𝑒</ci><ci id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.4.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.4">𝑡</ci><ci id="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.5.cmml" xref="S3.E2.m1.3.3.1.1.2.2.1.1.1.3.5">𝑟</ci></apply></apply></apply><ci id="S3.E2.m1.3.3.1.1.2.2.3.cmml" xref="S3.E2.m1.3.3.1.1.2.2.3">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.3c">\mathbf{E}^{\prime}_{retr}\leftarrow\gamma(\mathbf{E}_{retr},k),~{}~{}~{}~{}%
\text{where}~{}~{}~{}~{}|\mathbf{E}^{\prime}_{retr}|=k,</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.3d">bold_E start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT ← italic_γ ( bold_E start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT , italic_k ) , where | bold_E start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT | = italic_k ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p1.7">In this place, <math alttext="k" class="ltx_Math" display="inline" id="S3.SS2.p1.6.m1.1"><semantics id="S3.SS2.p1.6.m1.1a"><mi id="S3.SS2.p1.6.m1.1.1" xref="S3.SS2.p1.6.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.6.m1.1b"><ci id="S3.SS2.p1.6.m1.1.1.cmml" xref="S3.SS2.p1.6.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.6.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.6.m1.1d">italic_k</annotation></semantics></math> indicates the predefined size of compressed context. The down-scaled embeddings <math alttext="\mathbf{E}^{\prime}_{retr}" class="ltx_Math" display="inline" id="S3.SS2.p1.7.m2.1"><semantics id="S3.SS2.p1.7.m2.1a"><msubsup id="S3.SS2.p1.7.m2.1.1" xref="S3.SS2.p1.7.m2.1.1.cmml"><mi id="S3.SS2.p1.7.m2.1.1.2.2" xref="S3.SS2.p1.7.m2.1.1.2.2.cmml">𝐄</mi><mrow id="S3.SS2.p1.7.m2.1.1.3" xref="S3.SS2.p1.7.m2.1.1.3.cmml"><mi id="S3.SS2.p1.7.m2.1.1.3.2" xref="S3.SS2.p1.7.m2.1.1.3.2.cmml">r</mi><mo id="S3.SS2.p1.7.m2.1.1.3.1" xref="S3.SS2.p1.7.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.7.m2.1.1.3.3" xref="S3.SS2.p1.7.m2.1.1.3.3.cmml">e</mi><mo id="S3.SS2.p1.7.m2.1.1.3.1a" xref="S3.SS2.p1.7.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.7.m2.1.1.3.4" xref="S3.SS2.p1.7.m2.1.1.3.4.cmml">t</mi><mo id="S3.SS2.p1.7.m2.1.1.3.1b" xref="S3.SS2.p1.7.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.7.m2.1.1.3.5" xref="S3.SS2.p1.7.m2.1.1.3.5.cmml">r</mi></mrow><mo id="S3.SS2.p1.7.m2.1.1.2.3" xref="S3.SS2.p1.7.m2.1.1.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.7.m2.1b"><apply id="S3.SS2.p1.7.m2.1.1.cmml" xref="S3.SS2.p1.7.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.7.m2.1.1.1.cmml" xref="S3.SS2.p1.7.m2.1.1">subscript</csymbol><apply id="S3.SS2.p1.7.m2.1.1.2.cmml" xref="S3.SS2.p1.7.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.7.m2.1.1.2.1.cmml" xref="S3.SS2.p1.7.m2.1.1">superscript</csymbol><ci id="S3.SS2.p1.7.m2.1.1.2.2.cmml" xref="S3.SS2.p1.7.m2.1.1.2.2">𝐄</ci><ci id="S3.SS2.p1.7.m2.1.1.2.3.cmml" xref="S3.SS2.p1.7.m2.1.1.2.3">′</ci></apply><apply id="S3.SS2.p1.7.m2.1.1.3.cmml" xref="S3.SS2.p1.7.m2.1.1.3"><times id="S3.SS2.p1.7.m2.1.1.3.1.cmml" xref="S3.SS2.p1.7.m2.1.1.3.1"></times><ci id="S3.SS2.p1.7.m2.1.1.3.2.cmml" xref="S3.SS2.p1.7.m2.1.1.3.2">𝑟</ci><ci id="S3.SS2.p1.7.m2.1.1.3.3.cmml" xref="S3.SS2.p1.7.m2.1.1.3.3">𝑒</ci><ci id="S3.SS2.p1.7.m2.1.1.3.4.cmml" xref="S3.SS2.p1.7.m2.1.1.3.4">𝑡</ci><ci id="S3.SS2.p1.7.m2.1.1.3.5.cmml" xref="S3.SS2.p1.7.m2.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.7.m2.1c">\mathbf{E}^{\prime}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.7.m2.1d">bold_E start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math> serve as compact yet informative representations of the retrieved context, which are passed to the downstream LLM for retrieval-augmented generation.</p>
</div>
<div class="ltx_para" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.2">The above workflow consists of two basic modules. The first is the <span class="ltx_text ltx_font_bold" id="S3.SS2.p2.2.1">compressive encoder</span>, which implements the encoding function <math alttext="\psi(\cdot)" class="ltx_Math" display="inline" id="S3.SS2.p2.1.m1.1"><semantics id="S3.SS2.p2.1.m1.1a"><mrow id="S3.SS2.p2.1.m1.1.2" xref="S3.SS2.p2.1.m1.1.2.cmml"><mi id="S3.SS2.p2.1.m1.1.2.2" xref="S3.SS2.p2.1.m1.1.2.2.cmml">ψ</mi><mo id="S3.SS2.p2.1.m1.1.2.1" xref="S3.SS2.p2.1.m1.1.2.1.cmml">⁢</mo><mrow id="S3.SS2.p2.1.m1.1.2.3.2" xref="S3.SS2.p2.1.m1.1.2.cmml"><mo id="S3.SS2.p2.1.m1.1.2.3.2.1" stretchy="false" xref="S3.SS2.p2.1.m1.1.2.cmml">(</mo><mo id="S3.SS2.p2.1.m1.1.1" lspace="0em" rspace="0em" xref="S3.SS2.p2.1.m1.1.1.cmml">⋅</mo><mo id="S3.SS2.p2.1.m1.1.2.3.2.2" stretchy="false" xref="S3.SS2.p2.1.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b"><apply id="S3.SS2.p2.1.m1.1.2.cmml" xref="S3.SS2.p2.1.m1.1.2"><times id="S3.SS2.p2.1.m1.1.2.1.cmml" xref="S3.SS2.p2.1.m1.1.2.1"></times><ci id="S3.SS2.p2.1.m1.1.2.2.cmml" xref="S3.SS2.p2.1.m1.1.2.2">𝜓</ci><ci id="S3.SS2.p2.1.m1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">\psi(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.1.m1.1d">italic_ψ ( ⋅ )</annotation></semantics></math> to transform the retrieved context into informative and flexible-to-sample embeddings. The second is the <span class="ltx_text ltx_font_bold" id="S3.SS2.p2.2.2">importance estimator</span>, which assesses the importance of each part of the context. Based on the estimation results, selective compression is conducted through down-sampling, i.e. <math alttext="\gamma(\cdot)" class="ltx_Math" display="inline" id="S3.SS2.p2.2.m2.1"><semantics id="S3.SS2.p2.2.m2.1a"><mrow id="S3.SS2.p2.2.m2.1.2" xref="S3.SS2.p2.2.m2.1.2.cmml"><mi id="S3.SS2.p2.2.m2.1.2.2" xref="S3.SS2.p2.2.m2.1.2.2.cmml">γ</mi><mo id="S3.SS2.p2.2.m2.1.2.1" xref="S3.SS2.p2.2.m2.1.2.1.cmml">⁢</mo><mrow id="S3.SS2.p2.2.m2.1.2.3.2" xref="S3.SS2.p2.2.m2.1.2.cmml"><mo id="S3.SS2.p2.2.m2.1.2.3.2.1" stretchy="false" xref="S3.SS2.p2.2.m2.1.2.cmml">(</mo><mo id="S3.SS2.p2.2.m2.1.1" lspace="0em" rspace="0em" xref="S3.SS2.p2.2.m2.1.1.cmml">⋅</mo><mo id="S3.SS2.p2.2.m2.1.2.3.2.2" stretchy="false" xref="S3.SS2.p2.2.m2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.2.m2.1b"><apply id="S3.SS2.p2.2.m2.1.2.cmml" xref="S3.SS2.p2.2.m2.1.2"><times id="S3.SS2.p2.2.m2.1.2.1.cmml" xref="S3.SS2.p2.2.m2.1.2.1"></times><ci id="S3.SS2.p2.2.m2.1.2.2.cmml" xref="S3.SS2.p2.2.m2.1.2.2">𝛾</ci><ci id="S3.SS2.p2.2.m2.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.2.m2.1c">\gamma(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.2.m2.1d">italic_γ ( ⋅ )</annotation></semantics></math>, allowing for the preservation of the most critical information with higher emphasis.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3. </span>Compressive Encoder</h3>
<div class="ltx_para" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.2">As described, the compressive encoder transforms the tokenized retrieved contexts <math alttext="\mathbf{X}_{retr}" class="ltx_Math" display="inline" id="S3.SS3.p1.1.m1.1"><semantics id="S3.SS3.p1.1.m1.1a"><msub id="S3.SS3.p1.1.m1.1.1" xref="S3.SS3.p1.1.m1.1.1.cmml"><mi id="S3.SS3.p1.1.m1.1.1.2" xref="S3.SS3.p1.1.m1.1.1.2.cmml">𝐗</mi><mrow id="S3.SS3.p1.1.m1.1.1.3" xref="S3.SS3.p1.1.m1.1.1.3.cmml"><mi id="S3.SS3.p1.1.m1.1.1.3.2" xref="S3.SS3.p1.1.m1.1.1.3.2.cmml">r</mi><mo id="S3.SS3.p1.1.m1.1.1.3.1" xref="S3.SS3.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.1.m1.1.1.3.3" xref="S3.SS3.p1.1.m1.1.1.3.3.cmml">e</mi><mo id="S3.SS3.p1.1.m1.1.1.3.1a" xref="S3.SS3.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.1.m1.1.1.3.4" xref="S3.SS3.p1.1.m1.1.1.3.4.cmml">t</mi><mo id="S3.SS3.p1.1.m1.1.1.3.1b" xref="S3.SS3.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.1.m1.1.1.3.5" xref="S3.SS3.p1.1.m1.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.1.m1.1b"><apply id="S3.SS3.p1.1.m1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.1.m1.1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS3.p1.1.m1.1.1.2.cmml" xref="S3.SS3.p1.1.m1.1.1.2">𝐗</ci><apply id="S3.SS3.p1.1.m1.1.1.3.cmml" xref="S3.SS3.p1.1.m1.1.1.3"><times id="S3.SS3.p1.1.m1.1.1.3.1.cmml" xref="S3.SS3.p1.1.m1.1.1.3.1"></times><ci id="S3.SS3.p1.1.m1.1.1.3.2.cmml" xref="S3.SS3.p1.1.m1.1.1.3.2">𝑟</ci><ci id="S3.SS3.p1.1.m1.1.1.3.3.cmml" xref="S3.SS3.p1.1.m1.1.1.3.3">𝑒</ci><ci id="S3.SS3.p1.1.m1.1.1.3.4.cmml" xref="S3.SS3.p1.1.m1.1.1.3.4">𝑡</ci><ci id="S3.SS3.p1.1.m1.1.1.3.5.cmml" xref="S3.SS3.p1.1.m1.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.1.m1.1c">\mathbf{X}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.1.m1.1d">bold_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math> into compressive embeddings <math alttext="\mathbf{E}_{retr}" class="ltx_Math" display="inline" id="S3.SS3.p1.2.m2.1"><semantics id="S3.SS3.p1.2.m2.1a"><msub id="S3.SS3.p1.2.m2.1.1" xref="S3.SS3.p1.2.m2.1.1.cmml"><mi id="S3.SS3.p1.2.m2.1.1.2" xref="S3.SS3.p1.2.m2.1.1.2.cmml">𝐄</mi><mrow id="S3.SS3.p1.2.m2.1.1.3" xref="S3.SS3.p1.2.m2.1.1.3.cmml"><mi id="S3.SS3.p1.2.m2.1.1.3.2" xref="S3.SS3.p1.2.m2.1.1.3.2.cmml">r</mi><mo id="S3.SS3.p1.2.m2.1.1.3.1" xref="S3.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.2.m2.1.1.3.3" xref="S3.SS3.p1.2.m2.1.1.3.3.cmml">e</mi><mo id="S3.SS3.p1.2.m2.1.1.3.1a" xref="S3.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.2.m2.1.1.3.4" xref="S3.SS3.p1.2.m2.1.1.3.4.cmml">t</mi><mo id="S3.SS3.p1.2.m2.1.1.3.1b" xref="S3.SS3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p1.2.m2.1.1.3.5" xref="S3.SS3.p1.2.m2.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.2.m2.1b"><apply id="S3.SS3.p1.2.m2.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS3.p1.2.m2.1.1.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2">𝐄</ci><apply id="S3.SS3.p1.2.m2.1.1.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3"><times id="S3.SS3.p1.2.m2.1.1.3.1.cmml" xref="S3.SS3.p1.2.m2.1.1.3.1"></times><ci id="S3.SS3.p1.2.m2.1.1.3.2.cmml" xref="S3.SS3.p1.2.m2.1.1.3.2">𝑟</ci><ci id="S3.SS3.p1.2.m2.1.1.3.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3">𝑒</ci><ci id="S3.SS3.p1.2.m2.1.1.3.4.cmml" xref="S3.SS3.p1.2.m2.1.1.3.4">𝑡</ci><ci id="S3.SS3.p1.2.m2.1.1.3.5.cmml" xref="S3.SS3.p1.2.m2.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.2.m2.1c">\mathbf{E}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.2.m2.1d">bold_E start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math>, which can be flexibly down-sampled to provide a high-quality compression of the original input. As a result, the realization of compressive encoder is guided by the following considerations.</p>
</div>
<div class="ltx_para" id="S3.SS3.p2">
<p class="ltx_p" id="S3.SS3.p2.1">First, to serve as compressive representations of input, each element of <math alttext="\mathbf{E}_{retr}" class="ltx_Math" display="inline" id="S3.SS3.p2.1.m1.1"><semantics id="S3.SS3.p2.1.m1.1a"><msub id="S3.SS3.p2.1.m1.1.1" xref="S3.SS3.p2.1.m1.1.1.cmml"><mi id="S3.SS3.p2.1.m1.1.1.2" xref="S3.SS3.p2.1.m1.1.1.2.cmml">𝐄</mi><mrow id="S3.SS3.p2.1.m1.1.1.3" xref="S3.SS3.p2.1.m1.1.1.3.cmml"><mi id="S3.SS3.p2.1.m1.1.1.3.2" xref="S3.SS3.p2.1.m1.1.1.3.2.cmml">r</mi><mo id="S3.SS3.p2.1.m1.1.1.3.1" xref="S3.SS3.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p2.1.m1.1.1.3.3" xref="S3.SS3.p2.1.m1.1.1.3.3.cmml">e</mi><mo id="S3.SS3.p2.1.m1.1.1.3.1a" xref="S3.SS3.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p2.1.m1.1.1.3.4" xref="S3.SS3.p2.1.m1.1.1.3.4.cmml">t</mi><mo id="S3.SS3.p2.1.m1.1.1.3.1b" xref="S3.SS3.p2.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS3.p2.1.m1.1.1.3.5" xref="S3.SS3.p2.1.m1.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.1.m1.1b"><apply id="S3.SS3.p2.1.m1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.1.m1.1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1">subscript</csymbol><ci id="S3.SS3.p2.1.m1.1.1.2.cmml" xref="S3.SS3.p2.1.m1.1.1.2">𝐄</ci><apply id="S3.SS3.p2.1.m1.1.1.3.cmml" xref="S3.SS3.p2.1.m1.1.1.3"><times id="S3.SS3.p2.1.m1.1.1.3.1.cmml" xref="S3.SS3.p2.1.m1.1.1.3.1"></times><ci id="S3.SS3.p2.1.m1.1.1.3.2.cmml" xref="S3.SS3.p2.1.m1.1.1.3.2">𝑟</ci><ci id="S3.SS3.p2.1.m1.1.1.3.3.cmml" xref="S3.SS3.p2.1.m1.1.1.3.3">𝑒</ci><ci id="S3.SS3.p2.1.m1.1.1.3.4.cmml" xref="S3.SS3.p2.1.m1.1.1.3.4">𝑡</ci><ci id="S3.SS3.p2.1.m1.1.1.3.5.cmml" xref="S3.SS3.p2.1.m1.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.1.m1.1c">\mathbf{E}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.1.m1.1d">bold_E start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math> needs to fully capture the information for its nearby context. This requires a highly <span class="ltx_text ltx_font_bold" id="S3.SS3.p2.1.1">expressive</span> encoding backbone to generate rich-semantic embeddings. To achieve this goal, we exploy LLMs as the foundation of our compressive encoder.</p>
</div>
<div class="ltx_para" id="S3.SS3.p3">
<p class="ltx_p" id="S3.SS3.p3.1">Second, it needs to ensure a <span class="ltx_text ltx_font_bold" id="S3.SS3.p3.1.1">seamless connection</span> between the compressive embeddings and the downstream LLM. To facilitate this objective, the compressive embeddings must resemble the input token embeddings of the downstream LLM. With this consideration, we employ the same backbone as the downstream LLM. Besides, we choose to leverage the first-<math alttext="n" class="ltx_Math" display="inline" id="S3.SS3.p3.1.m1.1"><semantics id="S3.SS3.p3.1.m1.1a"><mi id="S3.SS3.p3.1.m1.1.1" xref="S3.SS3.p3.1.m1.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p3.1.m1.1b"><ci id="S3.SS3.p3.1.m1.1.1.cmml" xref="S3.SS3.p3.1.m1.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p3.1.m1.1c">n</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p3.1.m1.1d">italic_n</annotation></semantics></math> layers instead of the entire LLM, considering that the intermediate embeddings from the mid-layers are more similar to the LLM’s token embeddings.</p>
</div>
<div class="ltx_para" id="S3.SS3.p4">
<p class="ltx_p" id="S3.SS3.p4.1">Third, the length of retrieved context is likely to exceed the window size of compressive encoder, making it inevitable to chunk the input and encode each segment individually. However, it has to avoid over-chunking so as to maintain the coherence of input. Therefore, the chunking size is expanded to the maximum extent in each specific scenario.</p>
</div>
<div class="ltx_para" id="S3.SS3.p5">
<p class="ltx_p" id="S3.SS3.p5.3">Therefore, the compressive encoding can be formulated as the following workflow:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(3)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\psi(\mathbf{X}_{retr})\rightarrow\bigl{[}\mathrm{LLM}^{e}_{:\mathrm{n}}(%
\mathbf{X}_{retr}^{1}),~{}...~{},\mathrm{LLM}^{e}_{:\mathrm{n}}(\mathbf{X}_{%
retr}^{m})\bigr{]}\rightarrow\mathbf{E}_{retr}" class="ltx_Math" display="block" id="S3.E3.m1.4"><semantics id="S3.E3.m1.4a"><mrow id="S3.E3.m1.4.4" xref="S3.E3.m1.4.4.cmml"><mrow id="S3.E3.m1.2.2.1" xref="S3.E3.m1.2.2.1.cmml"><mi id="S3.E3.m1.2.2.1.3" xref="S3.E3.m1.2.2.1.3.cmml">ψ</mi><mo id="S3.E3.m1.2.2.1.2" xref="S3.E3.m1.2.2.1.2.cmml">⁢</mo><mrow id="S3.E3.m1.2.2.1.1.1" xref="S3.E3.m1.2.2.1.1.1.1.cmml"><mo id="S3.E3.m1.2.2.1.1.1.2" stretchy="false" xref="S3.E3.m1.2.2.1.1.1.1.cmml">(</mo><msub id="S3.E3.m1.2.2.1.1.1.1" xref="S3.E3.m1.2.2.1.1.1.1.cmml"><mi id="S3.E3.m1.2.2.1.1.1.1.2" xref="S3.E3.m1.2.2.1.1.1.1.2.cmml">𝐗</mi><mrow id="S3.E3.m1.2.2.1.1.1.1.3" xref="S3.E3.m1.2.2.1.1.1.1.3.cmml"><mi id="S3.E3.m1.2.2.1.1.1.1.3.2" xref="S3.E3.m1.2.2.1.1.1.1.3.2.cmml">r</mi><mo id="S3.E3.m1.2.2.1.1.1.1.3.1" xref="S3.E3.m1.2.2.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E3.m1.2.2.1.1.1.1.3.3" xref="S3.E3.m1.2.2.1.1.1.1.3.3.cmml">e</mi><mo id="S3.E3.m1.2.2.1.1.1.1.3.1a" xref="S3.E3.m1.2.2.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E3.m1.2.2.1.1.1.1.3.4" xref="S3.E3.m1.2.2.1.1.1.1.3.4.cmml">t</mi><mo id="S3.E3.m1.2.2.1.1.1.1.3.1b" xref="S3.E3.m1.2.2.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E3.m1.2.2.1.1.1.1.3.5" xref="S3.E3.m1.2.2.1.1.1.1.3.5.cmml">r</mi></mrow></msub><mo id="S3.E3.m1.2.2.1.1.1.3" stretchy="false" xref="S3.E3.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E3.m1.4.4.5" stretchy="false" xref="S3.E3.m1.4.4.5.cmml">→</mo><mrow id="S3.E3.m1.4.4.3.2" xref="S3.E3.m1.4.4.3.3.cmml"><mo id="S3.E3.m1.4.4.3.2.3" maxsize="120%" minsize="120%" xref="S3.E3.m1.4.4.3.3.cmml">[</mo><mrow id="S3.E3.m1.3.3.2.1.1" xref="S3.E3.m1.3.3.2.1.1.cmml"><msubsup id="S3.E3.m1.3.3.2.1.1.3" xref="S3.E3.m1.3.3.2.1.1.3.cmml"><mi id="S3.E3.m1.3.3.2.1.1.3.2.2" xref="S3.E3.m1.3.3.2.1.1.3.2.2.cmml">LLM</mi><mrow id="S3.E3.m1.3.3.2.1.1.3.3" xref="S3.E3.m1.3.3.2.1.1.3.3.cmml"><mi id="S3.E3.m1.3.3.2.1.1.3.3.2" xref="S3.E3.m1.3.3.2.1.1.3.3.2.cmml"></mi><mo id="S3.E3.m1.3.3.2.1.1.3.3.1" lspace="0.278em" rspace="0.278em" xref="S3.E3.m1.3.3.2.1.1.3.3.1.cmml">:</mo><mi id="S3.E3.m1.3.3.2.1.1.3.3.3" mathvariant="normal" xref="S3.E3.m1.3.3.2.1.1.3.3.3.cmml">n</mi></mrow><mi id="S3.E3.m1.3.3.2.1.1.3.2.3" xref="S3.E3.m1.3.3.2.1.1.3.2.3.cmml">e</mi></msubsup><mo id="S3.E3.m1.3.3.2.1.1.2" xref="S3.E3.m1.3.3.2.1.1.2.cmml">⁢</mo><mrow id="S3.E3.m1.3.3.2.1.1.1.1" xref="S3.E3.m1.3.3.2.1.1.1.1.1.cmml"><mo id="S3.E3.m1.3.3.2.1.1.1.1.2" stretchy="false" xref="S3.E3.m1.3.3.2.1.1.1.1.1.cmml">(</mo><msubsup id="S3.E3.m1.3.3.2.1.1.1.1.1" xref="S3.E3.m1.3.3.2.1.1.1.1.1.cmml"><mi id="S3.E3.m1.3.3.2.1.1.1.1.1.2.2" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.2.cmml">𝐗</mi><mrow id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.cmml"><mi id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.2" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.2.cmml">r</mi><mo id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.1" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.3" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.3.cmml">e</mi><mo id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.1a" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.4" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.4.cmml">t</mi><mo id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.1b" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.5" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.5.cmml">r</mi></mrow><mn id="S3.E3.m1.3.3.2.1.1.1.1.1.3" xref="S3.E3.m1.3.3.2.1.1.1.1.1.3.cmml">1</mn></msubsup><mo id="S3.E3.m1.3.3.2.1.1.1.1.3" stretchy="false" xref="S3.E3.m1.3.3.2.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E3.m1.4.4.3.2.4" rspace="0.497em" xref="S3.E3.m1.4.4.3.3.cmml">,</mo><mi id="S3.E3.m1.1.1" mathvariant="normal" xref="S3.E3.m1.1.1.cmml">…</mi><mo id="S3.E3.m1.4.4.3.2.5" lspace="0.330em" xref="S3.E3.m1.4.4.3.3.cmml">,</mo><mrow id="S3.E3.m1.4.4.3.2.2" xref="S3.E3.m1.4.4.3.2.2.cmml"><msubsup id="S3.E3.m1.4.4.3.2.2.3" xref="S3.E3.m1.4.4.3.2.2.3.cmml"><mi id="S3.E3.m1.4.4.3.2.2.3.2.2" xref="S3.E3.m1.4.4.3.2.2.3.2.2.cmml">LLM</mi><mrow id="S3.E3.m1.4.4.3.2.2.3.3" xref="S3.E3.m1.4.4.3.2.2.3.3.cmml"><mi id="S3.E3.m1.4.4.3.2.2.3.3.2" xref="S3.E3.m1.4.4.3.2.2.3.3.2.cmml"></mi><mo id="S3.E3.m1.4.4.3.2.2.3.3.1" lspace="0.278em" rspace="0.278em" xref="S3.E3.m1.4.4.3.2.2.3.3.1.cmml">:</mo><mi id="S3.E3.m1.4.4.3.2.2.3.3.3" mathvariant="normal" xref="S3.E3.m1.4.4.3.2.2.3.3.3.cmml">n</mi></mrow><mi id="S3.E3.m1.4.4.3.2.2.3.2.3" xref="S3.E3.m1.4.4.3.2.2.3.2.3.cmml">e</mi></msubsup><mo id="S3.E3.m1.4.4.3.2.2.2" xref="S3.E3.m1.4.4.3.2.2.2.cmml">⁢</mo><mrow id="S3.E3.m1.4.4.3.2.2.1.1" xref="S3.E3.m1.4.4.3.2.2.1.1.1.cmml"><mo id="S3.E3.m1.4.4.3.2.2.1.1.2" stretchy="false" xref="S3.E3.m1.4.4.3.2.2.1.1.1.cmml">(</mo><msubsup id="S3.E3.m1.4.4.3.2.2.1.1.1" xref="S3.E3.m1.4.4.3.2.2.1.1.1.cmml"><mi id="S3.E3.m1.4.4.3.2.2.1.1.1.2.2" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.2.cmml">𝐗</mi><mrow id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.cmml"><mi id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.2" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.2.cmml">r</mi><mo id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.1" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.3" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.3.cmml">e</mi><mo id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.1a" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.4" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.4.cmml">t</mi><mo id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.1b" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.1.cmml">⁢</mo><mi id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.5" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.5.cmml">r</mi></mrow><mi id="S3.E3.m1.4.4.3.2.2.1.1.1.3" xref="S3.E3.m1.4.4.3.2.2.1.1.1.3.cmml">m</mi></msubsup><mo id="S3.E3.m1.4.4.3.2.2.1.1.3" stretchy="false" xref="S3.E3.m1.4.4.3.2.2.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E3.m1.4.4.3.2.6" maxsize="120%" minsize="120%" xref="S3.E3.m1.4.4.3.3.cmml">]</mo></mrow><mo id="S3.E3.m1.4.4.6" stretchy="false" xref="S3.E3.m1.4.4.6.cmml">→</mo><msub id="S3.E3.m1.4.4.7" xref="S3.E3.m1.4.4.7.cmml"><mi id="S3.E3.m1.4.4.7.2" xref="S3.E3.m1.4.4.7.2.cmml">𝐄</mi><mrow id="S3.E3.m1.4.4.7.3" xref="S3.E3.m1.4.4.7.3.cmml"><mi id="S3.E3.m1.4.4.7.3.2" xref="S3.E3.m1.4.4.7.3.2.cmml">r</mi><mo id="S3.E3.m1.4.4.7.3.1" xref="S3.E3.m1.4.4.7.3.1.cmml">⁢</mo><mi id="S3.E3.m1.4.4.7.3.3" xref="S3.E3.m1.4.4.7.3.3.cmml">e</mi><mo id="S3.E3.m1.4.4.7.3.1a" xref="S3.E3.m1.4.4.7.3.1.cmml">⁢</mo><mi id="S3.E3.m1.4.4.7.3.4" xref="S3.E3.m1.4.4.7.3.4.cmml">t</mi><mo id="S3.E3.m1.4.4.7.3.1b" xref="S3.E3.m1.4.4.7.3.1.cmml">⁢</mo><mi id="S3.E3.m1.4.4.7.3.5" xref="S3.E3.m1.4.4.7.3.5.cmml">r</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.E3.m1.4b"><apply id="S3.E3.m1.4.4.cmml" xref="S3.E3.m1.4.4"><and id="S3.E3.m1.4.4a.cmml" xref="S3.E3.m1.4.4"></and><apply id="S3.E3.m1.4.4b.cmml" xref="S3.E3.m1.4.4"><ci id="S3.E3.m1.4.4.5.cmml" xref="S3.E3.m1.4.4.5">→</ci><apply id="S3.E3.m1.2.2.1.cmml" xref="S3.E3.m1.2.2.1"><times id="S3.E3.m1.2.2.1.2.cmml" xref="S3.E3.m1.2.2.1.2"></times><ci id="S3.E3.m1.2.2.1.3.cmml" xref="S3.E3.m1.2.2.1.3">𝜓</ci><apply id="S3.E3.m1.2.2.1.1.1.1.cmml" xref="S3.E3.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.2.2.1.1.1.1.1.cmml" xref="S3.E3.m1.2.2.1.1.1">subscript</csymbol><ci id="S3.E3.m1.2.2.1.1.1.1.2.cmml" xref="S3.E3.m1.2.2.1.1.1.1.2">𝐗</ci><apply id="S3.E3.m1.2.2.1.1.1.1.3.cmml" xref="S3.E3.m1.2.2.1.1.1.1.3"><times id="S3.E3.m1.2.2.1.1.1.1.3.1.cmml" xref="S3.E3.m1.2.2.1.1.1.1.3.1"></times><ci id="S3.E3.m1.2.2.1.1.1.1.3.2.cmml" xref="S3.E3.m1.2.2.1.1.1.1.3.2">𝑟</ci><ci id="S3.E3.m1.2.2.1.1.1.1.3.3.cmml" xref="S3.E3.m1.2.2.1.1.1.1.3.3">𝑒</ci><ci id="S3.E3.m1.2.2.1.1.1.1.3.4.cmml" xref="S3.E3.m1.2.2.1.1.1.1.3.4">𝑡</ci><ci id="S3.E3.m1.2.2.1.1.1.1.3.5.cmml" xref="S3.E3.m1.2.2.1.1.1.1.3.5">𝑟</ci></apply></apply></apply><list id="S3.E3.m1.4.4.3.3.cmml" xref="S3.E3.m1.4.4.3.2"><apply id="S3.E3.m1.3.3.2.1.1.cmml" xref="S3.E3.m1.3.3.2.1.1"><times id="S3.E3.m1.3.3.2.1.1.2.cmml" xref="S3.E3.m1.3.3.2.1.1.2"></times><apply id="S3.E3.m1.3.3.2.1.1.3.cmml" xref="S3.E3.m1.3.3.2.1.1.3"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.2.1.1.3.1.cmml" xref="S3.E3.m1.3.3.2.1.1.3">subscript</csymbol><apply id="S3.E3.m1.3.3.2.1.1.3.2.cmml" xref="S3.E3.m1.3.3.2.1.1.3"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.2.1.1.3.2.1.cmml" xref="S3.E3.m1.3.3.2.1.1.3">superscript</csymbol><ci id="S3.E3.m1.3.3.2.1.1.3.2.2.cmml" xref="S3.E3.m1.3.3.2.1.1.3.2.2">LLM</ci><ci id="S3.E3.m1.3.3.2.1.1.3.2.3.cmml" xref="S3.E3.m1.3.3.2.1.1.3.2.3">𝑒</ci></apply><apply id="S3.E3.m1.3.3.2.1.1.3.3.cmml" xref="S3.E3.m1.3.3.2.1.1.3.3"><ci id="S3.E3.m1.3.3.2.1.1.3.3.1.cmml" xref="S3.E3.m1.3.3.2.1.1.3.3.1">:</ci><csymbol cd="latexml" id="S3.E3.m1.3.3.2.1.1.3.3.2.cmml" xref="S3.E3.m1.3.3.2.1.1.3.3.2">absent</csymbol><ci id="S3.E3.m1.3.3.2.1.1.3.3.3.cmml" xref="S3.E3.m1.3.3.2.1.1.3.3.3">n</ci></apply></apply><apply id="S3.E3.m1.3.3.2.1.1.1.1.1.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.2.1.1.1.1.1.1.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1">superscript</csymbol><apply id="S3.E3.m1.3.3.2.1.1.1.1.1.2.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.2.1.1.1.1.1.2.1.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1">subscript</csymbol><ci id="S3.E3.m1.3.3.2.1.1.1.1.1.2.2.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.2">𝐗</ci><apply id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3"><times id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.1.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.1"></times><ci id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.2.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.2">𝑟</ci><ci id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.3.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.3">𝑒</ci><ci id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.4.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.4">𝑡</ci><ci id="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.5.cmml" xref="S3.E3.m1.3.3.2.1.1.1.1.1.2.3.5">𝑟</ci></apply></apply><cn id="S3.E3.m1.3.3.2.1.1.1.1.1.3.cmml" type="integer" xref="S3.E3.m1.3.3.2.1.1.1.1.1.3">1</cn></apply></apply><ci id="S3.E3.m1.1.1.cmml" xref="S3.E3.m1.1.1">…</ci><apply id="S3.E3.m1.4.4.3.2.2.cmml" xref="S3.E3.m1.4.4.3.2.2"><times id="S3.E3.m1.4.4.3.2.2.2.cmml" xref="S3.E3.m1.4.4.3.2.2.2"></times><apply id="S3.E3.m1.4.4.3.2.2.3.cmml" xref="S3.E3.m1.4.4.3.2.2.3"><csymbol cd="ambiguous" id="S3.E3.m1.4.4.3.2.2.3.1.cmml" xref="S3.E3.m1.4.4.3.2.2.3">subscript</csymbol><apply id="S3.E3.m1.4.4.3.2.2.3.2.cmml" xref="S3.E3.m1.4.4.3.2.2.3"><csymbol cd="ambiguous" id="S3.E3.m1.4.4.3.2.2.3.2.1.cmml" xref="S3.E3.m1.4.4.3.2.2.3">superscript</csymbol><ci id="S3.E3.m1.4.4.3.2.2.3.2.2.cmml" xref="S3.E3.m1.4.4.3.2.2.3.2.2">LLM</ci><ci id="S3.E3.m1.4.4.3.2.2.3.2.3.cmml" xref="S3.E3.m1.4.4.3.2.2.3.2.3">𝑒</ci></apply><apply id="S3.E3.m1.4.4.3.2.2.3.3.cmml" xref="S3.E3.m1.4.4.3.2.2.3.3"><ci id="S3.E3.m1.4.4.3.2.2.3.3.1.cmml" xref="S3.E3.m1.4.4.3.2.2.3.3.1">:</ci><csymbol cd="latexml" id="S3.E3.m1.4.4.3.2.2.3.3.2.cmml" xref="S3.E3.m1.4.4.3.2.2.3.3.2">absent</csymbol><ci id="S3.E3.m1.4.4.3.2.2.3.3.3.cmml" xref="S3.E3.m1.4.4.3.2.2.3.3.3">n</ci></apply></apply><apply id="S3.E3.m1.4.4.3.2.2.1.1.1.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.4.4.3.2.2.1.1.1.1.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1">superscript</csymbol><apply id="S3.E3.m1.4.4.3.2.2.1.1.1.2.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.4.4.3.2.2.1.1.1.2.1.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1">subscript</csymbol><ci id="S3.E3.m1.4.4.3.2.2.1.1.1.2.2.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.2">𝐗</ci><apply id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3"><times id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.1.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.1"></times><ci id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.2.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.2">𝑟</ci><ci id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.3.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.3">𝑒</ci><ci id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.4.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.4">𝑡</ci><ci id="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.5.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1.1.2.3.5">𝑟</ci></apply></apply><ci id="S3.E3.m1.4.4.3.2.2.1.1.1.3.cmml" xref="S3.E3.m1.4.4.3.2.2.1.1.1.3">𝑚</ci></apply></apply></list></apply><apply id="S3.E3.m1.4.4c.cmml" xref="S3.E3.m1.4.4"><ci id="S3.E3.m1.4.4.6.cmml" xref="S3.E3.m1.4.4.6">→</ci><share href="https://arxiv.org/html/2409.15699v1#S3.E3.m1.4.4.3.cmml" id="S3.E3.m1.4.4d.cmml" xref="S3.E3.m1.4.4"></share><apply id="S3.E3.m1.4.4.7.cmml" xref="S3.E3.m1.4.4.7"><csymbol cd="ambiguous" id="S3.E3.m1.4.4.7.1.cmml" xref="S3.E3.m1.4.4.7">subscript</csymbol><ci id="S3.E3.m1.4.4.7.2.cmml" xref="S3.E3.m1.4.4.7.2">𝐄</ci><apply id="S3.E3.m1.4.4.7.3.cmml" xref="S3.E3.m1.4.4.7.3"><times id="S3.E3.m1.4.4.7.3.1.cmml" xref="S3.E3.m1.4.4.7.3.1"></times><ci id="S3.E3.m1.4.4.7.3.2.cmml" xref="S3.E3.m1.4.4.7.3.2">𝑟</ci><ci id="S3.E3.m1.4.4.7.3.3.cmml" xref="S3.E3.m1.4.4.7.3.3">𝑒</ci><ci id="S3.E3.m1.4.4.7.3.4.cmml" xref="S3.E3.m1.4.4.7.3.4">𝑡</ci><ci id="S3.E3.m1.4.4.7.3.5.cmml" xref="S3.E3.m1.4.4.7.3.5">𝑟</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m1.4c">\psi(\mathbf{X}_{retr})\rightarrow\bigl{[}\mathrm{LLM}^{e}_{:\mathrm{n}}(%
\mathbf{X}_{retr}^{1}),~{}...~{},\mathrm{LLM}^{e}_{:\mathrm{n}}(\mathbf{X}_{%
retr}^{m})\bigr{]}\rightarrow\mathbf{E}_{retr}</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.4d">italic_ψ ( bold_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT ) → [ roman_LLM start_POSTSUPERSCRIPT italic_e end_POSTSUPERSCRIPT start_POSTSUBSCRIPT : roman_n end_POSTSUBSCRIPT ( bold_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT ) , … , roman_LLM start_POSTSUPERSCRIPT italic_e end_POSTSUPERSCRIPT start_POSTSUBSCRIPT : roman_n end_POSTSUBSCRIPT ( bold_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT ) ] → bold_E start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.p5.2">In this place, <math alttext="\mathrm{LLM}^{e}" class="ltx_Math" display="inline" id="S3.SS3.p5.1.m1.1"><semantics id="S3.SS3.p5.1.m1.1a"><msup id="S3.SS3.p5.1.m1.1.1" xref="S3.SS3.p5.1.m1.1.1.cmml"><mi id="S3.SS3.p5.1.m1.1.1.2" xref="S3.SS3.p5.1.m1.1.1.2.cmml">LLM</mi><mi id="S3.SS3.p5.1.m1.1.1.3" xref="S3.SS3.p5.1.m1.1.1.3.cmml">e</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p5.1.m1.1b"><apply id="S3.SS3.p5.1.m1.1.1.cmml" xref="S3.SS3.p5.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p5.1.m1.1.1.1.cmml" xref="S3.SS3.p5.1.m1.1.1">superscript</csymbol><ci id="S3.SS3.p5.1.m1.1.1.2.cmml" xref="S3.SS3.p5.1.m1.1.1.2">LLM</ci><ci id="S3.SS3.p5.1.m1.1.1.3.cmml" xref="S3.SS3.p5.1.m1.1.1.3">𝑒</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p5.1.m1.1c">\mathrm{LLM}^{e}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p5.1.m1.1d">roman_LLM start_POSTSUPERSCRIPT italic_e end_POSTSUPERSCRIPT</annotation></semantics></math> is the LLM backbone employed for compressive encoding, while “<math alttext=":\mathrm{n}" class="ltx_Math" display="inline" id="S3.SS3.p5.2.m2.1"><semantics id="S3.SS3.p5.2.m2.1a"><mrow id="S3.SS3.p5.2.m2.1.1" xref="S3.SS3.p5.2.m2.1.1.cmml"><mi id="S3.SS3.p5.2.m2.1.1.2" xref="S3.SS3.p5.2.m2.1.1.2.cmml"></mi><mo id="S3.SS3.p5.2.m2.1.1.1" lspace="0.278em" rspace="0.278em" xref="S3.SS3.p5.2.m2.1.1.1.cmml">:</mo><mi id="S3.SS3.p5.2.m2.1.1.3" mathvariant="normal" xref="S3.SS3.p5.2.m2.1.1.3.cmml">n</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p5.2.m2.1b"><apply id="S3.SS3.p5.2.m2.1.1.cmml" xref="S3.SS3.p5.2.m2.1.1"><ci id="S3.SS3.p5.2.m2.1.1.1.cmml" xref="S3.SS3.p5.2.m2.1.1.1">:</ci><csymbol cd="latexml" id="S3.SS3.p5.2.m2.1.1.2.cmml" xref="S3.SS3.p5.2.m2.1.1.2">absent</csymbol><ci id="S3.SS3.p5.2.m2.1.1.3.cmml" xref="S3.SS3.p5.2.m2.1.1.3">n</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p5.2.m2.1c">:\mathrm{n}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p5.2.m2.1d">: roman_n</annotation></semantics></math>” indicates that the first-n layers are utilized.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.4. </span>Selective Compression Mechanism</h3>
<div class="ltx_para" id="S3.SS4.p1">
<p class="ltx_p" id="S3.SS4.p1.1">Once the retrieved contexts are encoded as compressive embeddings, selective compression is applied, which produces the compressed context for RAG through down-sampling. It emphasizes the useful information to RAG tasks, where the related contexts are assigned with a high sampling ratio. In contrast, it neglects the less useful information, whose related contexts are assigned with a small sampling ratio. With this processing, the useful information can be better preserved from compression.</p>
</div>
<div class="ltx_para" id="S3.SS4.p2">
<p class="ltx_p" id="S3.SS4.p2.1">Selective compression calls for accurate estimation of context importance. In our work, we propose two alternative approaches to achieve this goal, providing users with the flexibility to choose the most suitable option for their specific applications.</p>
</div>
<section class="ltx_subsubsection" id="S3.SS4.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.4.1. </span>Token-level estimation</h4>
<div class="ltx_para" id="S3.SS4.SSS1.p1">
<p class="ltx_p" id="S3.SS4.SSS1.p1.2">The first alternative estimates context importance on the token basis, which is a popular principle adopted by many studies <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib15" title="">2023a</a>; Pan et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib26" title="">2024</a>)</cite>. Given the input prompt of RAG task <math alttext="X_{task}" class="ltx_Math" display="inline" id="S3.SS4.SSS1.p1.1.m1.1"><semantics id="S3.SS4.SSS1.p1.1.m1.1a"><msub id="S3.SS4.SSS1.p1.1.m1.1.1" xref="S3.SS4.SSS1.p1.1.m1.1.1.cmml"><mi id="S3.SS4.SSS1.p1.1.m1.1.1.2" xref="S3.SS4.SSS1.p1.1.m1.1.1.2.cmml">X</mi><mrow id="S3.SS4.SSS1.p1.1.m1.1.1.3" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.cmml"><mi id="S3.SS4.SSS1.p1.1.m1.1.1.3.2" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.2.cmml">t</mi><mo id="S3.SS4.SSS1.p1.1.m1.1.1.3.1" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS1.p1.1.m1.1.1.3.3" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.3.cmml">a</mi><mo id="S3.SS4.SSS1.p1.1.m1.1.1.3.1a" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS1.p1.1.m1.1.1.3.4" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.4.cmml">s</mi><mo id="S3.SS4.SSS1.p1.1.m1.1.1.3.1b" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS1.p1.1.m1.1.1.3.5" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.5.cmml">k</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.p1.1.m1.1b"><apply id="S3.SS4.SSS1.p1.1.m1.1.1.cmml" xref="S3.SS4.SSS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.p1.1.m1.1.1.1.cmml" xref="S3.SS4.SSS1.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS4.SSS1.p1.1.m1.1.1.2.cmml" xref="S3.SS4.SSS1.p1.1.m1.1.1.2">𝑋</ci><apply id="S3.SS4.SSS1.p1.1.m1.1.1.3.cmml" xref="S3.SS4.SSS1.p1.1.m1.1.1.3"><times id="S3.SS4.SSS1.p1.1.m1.1.1.3.1.cmml" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.1"></times><ci id="S3.SS4.SSS1.p1.1.m1.1.1.3.2.cmml" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.2">𝑡</ci><ci id="S3.SS4.SSS1.p1.1.m1.1.1.3.3.cmml" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.3">𝑎</ci><ci id="S3.SS4.SSS1.p1.1.m1.1.1.3.4.cmml" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.4">𝑠</ci><ci id="S3.SS4.SSS1.p1.1.m1.1.1.3.5.cmml" xref="S3.SS4.SSS1.p1.1.m1.1.1.3.5">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.p1.1.m1.1c">X_{task}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.p1.1.m1.1d">italic_X start_POSTSUBSCRIPT italic_t italic_a italic_s italic_k end_POSTSUBSCRIPT</annotation></semantics></math>, the importance tokens within the retrieved contexts <math alttext="X_{retr}" class="ltx_Math" display="inline" id="S3.SS4.SSS1.p1.2.m2.1"><semantics id="S3.SS4.SSS1.p1.2.m2.1a"><msub id="S3.SS4.SSS1.p1.2.m2.1.1" xref="S3.SS4.SSS1.p1.2.m2.1.1.cmml"><mi id="S3.SS4.SSS1.p1.2.m2.1.1.2" xref="S3.SS4.SSS1.p1.2.m2.1.1.2.cmml">X</mi><mrow id="S3.SS4.SSS1.p1.2.m2.1.1.3" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.cmml"><mi id="S3.SS4.SSS1.p1.2.m2.1.1.3.2" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.2.cmml">r</mi><mo id="S3.SS4.SSS1.p1.2.m2.1.1.3.1" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS1.p1.2.m2.1.1.3.3" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.3.cmml">e</mi><mo id="S3.SS4.SSS1.p1.2.m2.1.1.3.1a" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS1.p1.2.m2.1.1.3.4" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.4.cmml">t</mi><mo id="S3.SS4.SSS1.p1.2.m2.1.1.3.1b" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS1.p1.2.m2.1.1.3.5" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.p1.2.m2.1b"><apply id="S3.SS4.SSS1.p1.2.m2.1.1.cmml" xref="S3.SS4.SSS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.p1.2.m2.1.1.1.cmml" xref="S3.SS4.SSS1.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS4.SSS1.p1.2.m2.1.1.2.cmml" xref="S3.SS4.SSS1.p1.2.m2.1.1.2">𝑋</ci><apply id="S3.SS4.SSS1.p1.2.m2.1.1.3.cmml" xref="S3.SS4.SSS1.p1.2.m2.1.1.3"><times id="S3.SS4.SSS1.p1.2.m2.1.1.3.1.cmml" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.1"></times><ci id="S3.SS4.SSS1.p1.2.m2.1.1.3.2.cmml" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.2">𝑟</ci><ci id="S3.SS4.SSS1.p1.2.m2.1.1.3.3.cmml" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.3">𝑒</ci><ci id="S3.SS4.SSS1.p1.2.m2.1.1.3.4.cmml" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.4">𝑡</ci><ci id="S3.SS4.SSS1.p1.2.m2.1.1.3.5.cmml" xref="S3.SS4.SSS1.p1.2.m2.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.p1.2.m2.1c">X_{retr}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.p1.2.m2.1d">italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math> are generally favored by the LLM, leading to relatively higher generation likelihood compared to other less useful tokens. Based on this principle, we introduce the following relationship as an approximate indicator of token importance:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(4)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{for}~{}~{}x_{i}\in X_{retr}:~{}~{}w_{i}\leftarrow P_{LLM}(x_{i}|{X}_{%
task},X_{retr}[:x_{i}])" class="ltx_math_unparsed" display="block" id="S3.E4.m1.1"><semantics id="S3.E4.m1.1a"><mrow id="S3.E4.m1.1b"><mtext id="S3.E4.m1.1.1">for</mtext><msub id="S3.E4.m1.1.2"><mi id="S3.E4.m1.1.2.2">x</mi><mi id="S3.E4.m1.1.2.3">i</mi></msub><mo id="S3.E4.m1.1.3">∈</mo><msub id="S3.E4.m1.1.4"><mi id="S3.E4.m1.1.4.2">X</mi><mrow id="S3.E4.m1.1.4.3"><mi id="S3.E4.m1.1.4.3.2">r</mi><mo id="S3.E4.m1.1.4.3.1">⁢</mo><mi id="S3.E4.m1.1.4.3.3">e</mi><mo id="S3.E4.m1.1.4.3.1a">⁢</mo><mi id="S3.E4.m1.1.4.3.4">t</mi><mo id="S3.E4.m1.1.4.3.1b">⁢</mo><mi id="S3.E4.m1.1.4.3.5">r</mi></mrow></msub><mo id="S3.E4.m1.1.5" lspace="0.278em" rspace="0.938em">:</mo><msub id="S3.E4.m1.1.6"><mi id="S3.E4.m1.1.6.2">w</mi><mi id="S3.E4.m1.1.6.3">i</mi></msub><mo id="S3.E4.m1.1.7" stretchy="false">←</mo><msub id="S3.E4.m1.1.8"><mi id="S3.E4.m1.1.8.2">P</mi><mrow id="S3.E4.m1.1.8.3"><mi id="S3.E4.m1.1.8.3.2">L</mi><mo id="S3.E4.m1.1.8.3.1">⁢</mo><mi id="S3.E4.m1.1.8.3.3">L</mi><mo id="S3.E4.m1.1.8.3.1a">⁢</mo><mi id="S3.E4.m1.1.8.3.4">M</mi></mrow></msub><mrow id="S3.E4.m1.1.9"><mo id="S3.E4.m1.1.9.1" stretchy="false">(</mo><msub id="S3.E4.m1.1.9.2"><mi id="S3.E4.m1.1.9.2.2">x</mi><mi id="S3.E4.m1.1.9.2.3">i</mi></msub><mo fence="false" id="S3.E4.m1.1.9.3" rspace="0.167em" stretchy="false">|</mo><msub id="S3.E4.m1.1.9.4"><mi id="S3.E4.m1.1.9.4.2">X</mi><mrow id="S3.E4.m1.1.9.4.3"><mi id="S3.E4.m1.1.9.4.3.2">t</mi><mo id="S3.E4.m1.1.9.4.3.1">⁢</mo><mi id="S3.E4.m1.1.9.4.3.3">a</mi><mo id="S3.E4.m1.1.9.4.3.1a">⁢</mo><mi id="S3.E4.m1.1.9.4.3.4">s</mi><mo id="S3.E4.m1.1.9.4.3.1b">⁢</mo><mi id="S3.E4.m1.1.9.4.3.5">k</mi></mrow></msub><mo id="S3.E4.m1.1.9.5">,</mo><msub id="S3.E4.m1.1.9.6"><mi id="S3.E4.m1.1.9.6.2">X</mi><mrow id="S3.E4.m1.1.9.6.3"><mi id="S3.E4.m1.1.9.6.3.2">r</mi><mo id="S3.E4.m1.1.9.6.3.1">⁢</mo><mi id="S3.E4.m1.1.9.6.3.3">e</mi><mo id="S3.E4.m1.1.9.6.3.1a">⁢</mo><mi id="S3.E4.m1.1.9.6.3.4">t</mi><mo id="S3.E4.m1.1.9.6.3.1b">⁢</mo><mi id="S3.E4.m1.1.9.6.3.5">r</mi></mrow></msub><mrow id="S3.E4.m1.1.9.7"><mo id="S3.E4.m1.1.9.7.1" stretchy="false">[</mo><mo id="S3.E4.m1.1.9.7.2" rspace="0.278em">:</mo><msub id="S3.E4.m1.1.9.7.3"><mi id="S3.E4.m1.1.9.7.3.2">x</mi><mi id="S3.E4.m1.1.9.7.3.3">i</mi></msub><mo id="S3.E4.m1.1.9.7.4" stretchy="false">]</mo></mrow><mo id="S3.E4.m1.1.9.8" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S3.E4.m1.1c">\text{for}~{}~{}x_{i}\in X_{retr}:~{}~{}w_{i}\leftarrow P_{LLM}(x_{i}|{X}_{%
task},X_{retr}[:x_{i}])</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.1d">for italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT : italic_w start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← italic_P start_POSTSUBSCRIPT italic_L italic_L italic_M end_POSTSUBSCRIPT ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_X start_POSTSUBSCRIPT italic_t italic_a italic_s italic_k end_POSTSUBSCRIPT , italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT [ : italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ] )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS4.SSS1.p1.7">where <math alttext="X_{retr}[:x_{i}]" class="ltx_math_unparsed" display="inline" id="S3.SS4.SSS1.p1.3.m1.1"><semantics id="S3.SS4.SSS1.p1.3.m1.1a"><mrow id="S3.SS4.SSS1.p1.3.m1.1b"><msub id="S3.SS4.SSS1.p1.3.m1.1.1"><mi id="S3.SS4.SSS1.p1.3.m1.1.1.2">X</mi><mrow id="S3.SS4.SSS1.p1.3.m1.1.1.3"><mi id="S3.SS4.SSS1.p1.3.m1.1.1.3.2">r</mi><mo id="S3.SS4.SSS1.p1.3.m1.1.1.3.1">⁢</mo><mi id="S3.SS4.SSS1.p1.3.m1.1.1.3.3">e</mi><mo id="S3.SS4.SSS1.p1.3.m1.1.1.3.1a">⁢</mo><mi id="S3.SS4.SSS1.p1.3.m1.1.1.3.4">t</mi><mo id="S3.SS4.SSS1.p1.3.m1.1.1.3.1b">⁢</mo><mi id="S3.SS4.SSS1.p1.3.m1.1.1.3.5">r</mi></mrow></msub><mrow id="S3.SS4.SSS1.p1.3.m1.1.2"><mo id="S3.SS4.SSS1.p1.3.m1.1.2.1" stretchy="false">[</mo><mo id="S3.SS4.SSS1.p1.3.m1.1.2.2" rspace="0.278em">:</mo><msub id="S3.SS4.SSS1.p1.3.m1.1.2.3"><mi id="S3.SS4.SSS1.p1.3.m1.1.2.3.2">x</mi><mi id="S3.SS4.SSS1.p1.3.m1.1.2.3.3">i</mi></msub><mo id="S3.SS4.SSS1.p1.3.m1.1.2.4" stretchy="false">]</mo></mrow></mrow><annotation encoding="application/x-tex" id="S3.SS4.SSS1.p1.3.m1.1c">X_{retr}[:x_{i}]</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.p1.3.m1.1d">italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT [ : italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ]</annotation></semantics></math> represents the prefix of <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.SS4.SSS1.p1.4.m2.1"><semantics id="S3.SS4.SSS1.p1.4.m2.1a"><msub id="S3.SS4.SSS1.p1.4.m2.1.1" xref="S3.SS4.SSS1.p1.4.m2.1.1.cmml"><mi id="S3.SS4.SSS1.p1.4.m2.1.1.2" xref="S3.SS4.SSS1.p1.4.m2.1.1.2.cmml">x</mi><mi id="S3.SS4.SSS1.p1.4.m2.1.1.3" xref="S3.SS4.SSS1.p1.4.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.p1.4.m2.1b"><apply id="S3.SS4.SSS1.p1.4.m2.1.1.cmml" xref="S3.SS4.SSS1.p1.4.m2.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.p1.4.m2.1.1.1.cmml" xref="S3.SS4.SSS1.p1.4.m2.1.1">subscript</csymbol><ci id="S3.SS4.SSS1.p1.4.m2.1.1.2.cmml" xref="S3.SS4.SSS1.p1.4.m2.1.1.2">𝑥</ci><ci id="S3.SS4.SSS1.p1.4.m2.1.1.3.cmml" xref="S3.SS4.SSS1.p1.4.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.p1.4.m2.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.p1.4.m2.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. In other words, <math alttext="w_{i}&gt;w_{j}" class="ltx_Math" display="inline" id="S3.SS4.SSS1.p1.5.m3.1"><semantics id="S3.SS4.SSS1.p1.5.m3.1a"><mrow id="S3.SS4.SSS1.p1.5.m3.1.1" xref="S3.SS4.SSS1.p1.5.m3.1.1.cmml"><msub id="S3.SS4.SSS1.p1.5.m3.1.1.2" xref="S3.SS4.SSS1.p1.5.m3.1.1.2.cmml"><mi id="S3.SS4.SSS1.p1.5.m3.1.1.2.2" xref="S3.SS4.SSS1.p1.5.m3.1.1.2.2.cmml">w</mi><mi id="S3.SS4.SSS1.p1.5.m3.1.1.2.3" xref="S3.SS4.SSS1.p1.5.m3.1.1.2.3.cmml">i</mi></msub><mo id="S3.SS4.SSS1.p1.5.m3.1.1.1" xref="S3.SS4.SSS1.p1.5.m3.1.1.1.cmml">&gt;</mo><msub id="S3.SS4.SSS1.p1.5.m3.1.1.3" xref="S3.SS4.SSS1.p1.5.m3.1.1.3.cmml"><mi id="S3.SS4.SSS1.p1.5.m3.1.1.3.2" xref="S3.SS4.SSS1.p1.5.m3.1.1.3.2.cmml">w</mi><mi id="S3.SS4.SSS1.p1.5.m3.1.1.3.3" xref="S3.SS4.SSS1.p1.5.m3.1.1.3.3.cmml">j</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.p1.5.m3.1b"><apply id="S3.SS4.SSS1.p1.5.m3.1.1.cmml" xref="S3.SS4.SSS1.p1.5.m3.1.1"><gt id="S3.SS4.SSS1.p1.5.m3.1.1.1.cmml" xref="S3.SS4.SSS1.p1.5.m3.1.1.1"></gt><apply id="S3.SS4.SSS1.p1.5.m3.1.1.2.cmml" xref="S3.SS4.SSS1.p1.5.m3.1.1.2"><csymbol cd="ambiguous" id="S3.SS4.SSS1.p1.5.m3.1.1.2.1.cmml" xref="S3.SS4.SSS1.p1.5.m3.1.1.2">subscript</csymbol><ci id="S3.SS4.SSS1.p1.5.m3.1.1.2.2.cmml" xref="S3.SS4.SSS1.p1.5.m3.1.1.2.2">𝑤</ci><ci id="S3.SS4.SSS1.p1.5.m3.1.1.2.3.cmml" xref="S3.SS4.SSS1.p1.5.m3.1.1.2.3">𝑖</ci></apply><apply id="S3.SS4.SSS1.p1.5.m3.1.1.3.cmml" xref="S3.SS4.SSS1.p1.5.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.SSS1.p1.5.m3.1.1.3.1.cmml" xref="S3.SS4.SSS1.p1.5.m3.1.1.3">subscript</csymbol><ci id="S3.SS4.SSS1.p1.5.m3.1.1.3.2.cmml" xref="S3.SS4.SSS1.p1.5.m3.1.1.3.2">𝑤</ci><ci id="S3.SS4.SSS1.p1.5.m3.1.1.3.3.cmml" xref="S3.SS4.SSS1.p1.5.m3.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.p1.5.m3.1c">w_{i}&gt;w_{j}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.p1.5.m3.1d">italic_w start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT &gt; italic_w start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> if <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.SS4.SSS1.p1.6.m4.1"><semantics id="S3.SS4.SSS1.p1.6.m4.1a"><msub id="S3.SS4.SSS1.p1.6.m4.1.1" xref="S3.SS4.SSS1.p1.6.m4.1.1.cmml"><mi id="S3.SS4.SSS1.p1.6.m4.1.1.2" xref="S3.SS4.SSS1.p1.6.m4.1.1.2.cmml">x</mi><mi id="S3.SS4.SSS1.p1.6.m4.1.1.3" xref="S3.SS4.SSS1.p1.6.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.p1.6.m4.1b"><apply id="S3.SS4.SSS1.p1.6.m4.1.1.cmml" xref="S3.SS4.SSS1.p1.6.m4.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.p1.6.m4.1.1.1.cmml" xref="S3.SS4.SSS1.p1.6.m4.1.1">subscript</csymbol><ci id="S3.SS4.SSS1.p1.6.m4.1.1.2.cmml" xref="S3.SS4.SSS1.p1.6.m4.1.1.2">𝑥</ci><ci id="S3.SS4.SSS1.p1.6.m4.1.1.3.cmml" xref="S3.SS4.SSS1.p1.6.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.p1.6.m4.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.p1.6.m4.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is more important than <math alttext="x_{j}" class="ltx_Math" display="inline" id="S3.SS4.SSS1.p1.7.m5.1"><semantics id="S3.SS4.SSS1.p1.7.m5.1a"><msub id="S3.SS4.SSS1.p1.7.m5.1.1" xref="S3.SS4.SSS1.p1.7.m5.1.1.cmml"><mi id="S3.SS4.SSS1.p1.7.m5.1.1.2" xref="S3.SS4.SSS1.p1.7.m5.1.1.2.cmml">x</mi><mi id="S3.SS4.SSS1.p1.7.m5.1.1.3" xref="S3.SS4.SSS1.p1.7.m5.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.p1.7.m5.1b"><apply id="S3.SS4.SSS1.p1.7.m5.1.1.cmml" xref="S3.SS4.SSS1.p1.7.m5.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.p1.7.m5.1.1.1.cmml" xref="S3.SS4.SSS1.p1.7.m5.1.1">subscript</csymbol><ci id="S3.SS4.SSS1.p1.7.m5.1.1.2.cmml" xref="S3.SS4.SSS1.p1.7.m5.1.1.2">𝑥</ci><ci id="S3.SS4.SSS1.p1.7.m5.1.1.3.cmml" xref="S3.SS4.SSS1.p1.7.m5.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.p1.7.m5.1c">x_{j}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.p1.7.m5.1d">italic_x start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math>.
Despite simplicity, the above indicator can basically identify useful contexts as demonstrated by related works <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib15" title="">2023a</a>; Pan et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib26" title="">2024</a>)</cite>. However, it might suffer from incoherence and broken semantic as discrete tokens are sampled from context.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S3.SS4.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.4.2. </span>Sentence-level estimation</h4>
<div class="ltx_para" id="S3.SS4.SSS2.p1">
<p class="ltx_p" id="S3.SS4.SSS2.p1.1">The second alternative estimates the importance for each sentence within the retrieved contexts. To this end, we employ an ad-hoc model to estimate the sentence’s relevance to the task’s prompt, where the relevance score is used as the importance. Although the original retriever which produce the retrieved contexts is a desirable option, it is not always always in practice. Therefore, we leverage a general purpose embedder, such as E5 <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib37" title="">2022</a>)</cite> and BGE <cite class="ltx_cite ltx_citemacro_citep">(Xiao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib40" title="">2023</a>)</cite>, as the relevance oracle, denoted as <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S3.SS4.SSS2.p1.1.m1.1"><semantics id="S3.SS4.SSS2.p1.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.SSS2.p1.1.m1.1.1" xref="S3.SS4.SSS2.p1.1.m1.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS2.p1.1.m1.1b"><ci id="S3.SS4.SSS2.p1.1.m1.1.1.cmml" xref="S3.SS4.SSS2.p1.1.m1.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS2.p1.1.m1.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS2.p1.1.m1.1d">caligraphic_M</annotation></semantics></math>. Therefore, the importance is computed as:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(5)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{for}~{}~{}sent_{i}\in X_{retr}:~{}~{}w_{i}\leftarrow\mathcal{M}(X_{task}%
,sent_{i})," class="ltx_Math" display="block" id="S3.E5.m1.1"><semantics id="S3.E5.m1.1a"><mrow id="S3.E5.m1.1.1.1" xref="S3.E5.m1.1.1.1.1.cmml"><mrow id="S3.E5.m1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.cmml"><mrow id="S3.E5.m1.1.1.1.1.4" xref="S3.E5.m1.1.1.1.1.4.cmml"><mrow id="S3.E5.m1.1.1.1.1.4.2" xref="S3.E5.m1.1.1.1.1.4.2.cmml"><mtext id="S3.E5.m1.1.1.1.1.4.2.2" xref="S3.E5.m1.1.1.1.1.4.2.2a.cmml">for</mtext><mo id="S3.E5.m1.1.1.1.1.4.2.1" lspace="0.660em" xref="S3.E5.m1.1.1.1.1.4.2.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.4.2.3" xref="S3.E5.m1.1.1.1.1.4.2.3.cmml">s</mi><mo id="S3.E5.m1.1.1.1.1.4.2.1a" xref="S3.E5.m1.1.1.1.1.4.2.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.4.2.4" xref="S3.E5.m1.1.1.1.1.4.2.4.cmml">e</mi><mo id="S3.E5.m1.1.1.1.1.4.2.1b" xref="S3.E5.m1.1.1.1.1.4.2.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.4.2.5" xref="S3.E5.m1.1.1.1.1.4.2.5.cmml">n</mi><mo id="S3.E5.m1.1.1.1.1.4.2.1c" xref="S3.E5.m1.1.1.1.1.4.2.1.cmml">⁢</mo><msub id="S3.E5.m1.1.1.1.1.4.2.6" xref="S3.E5.m1.1.1.1.1.4.2.6.cmml"><mi id="S3.E5.m1.1.1.1.1.4.2.6.2" xref="S3.E5.m1.1.1.1.1.4.2.6.2.cmml">t</mi><mi id="S3.E5.m1.1.1.1.1.4.2.6.3" xref="S3.E5.m1.1.1.1.1.4.2.6.3.cmml">i</mi></msub></mrow><mo id="S3.E5.m1.1.1.1.1.4.1" xref="S3.E5.m1.1.1.1.1.4.1.cmml">∈</mo><msub id="S3.E5.m1.1.1.1.1.4.3" xref="S3.E5.m1.1.1.1.1.4.3.cmml"><mi id="S3.E5.m1.1.1.1.1.4.3.2" xref="S3.E5.m1.1.1.1.1.4.3.2.cmml">X</mi><mrow id="S3.E5.m1.1.1.1.1.4.3.3" xref="S3.E5.m1.1.1.1.1.4.3.3.cmml"><mi id="S3.E5.m1.1.1.1.1.4.3.3.2" xref="S3.E5.m1.1.1.1.1.4.3.3.2.cmml">r</mi><mo id="S3.E5.m1.1.1.1.1.4.3.3.1" xref="S3.E5.m1.1.1.1.1.4.3.3.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.4.3.3.3" xref="S3.E5.m1.1.1.1.1.4.3.3.3.cmml">e</mi><mo id="S3.E5.m1.1.1.1.1.4.3.3.1a" xref="S3.E5.m1.1.1.1.1.4.3.3.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.4.3.3.4" xref="S3.E5.m1.1.1.1.1.4.3.3.4.cmml">t</mi><mo id="S3.E5.m1.1.1.1.1.4.3.3.1b" xref="S3.E5.m1.1.1.1.1.4.3.3.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.4.3.3.5" xref="S3.E5.m1.1.1.1.1.4.3.3.5.cmml">r</mi></mrow></msub></mrow><mo id="S3.E5.m1.1.1.1.1.3" lspace="0.278em" rspace="0.938em" xref="S3.E5.m1.1.1.1.1.3.cmml">:</mo><mrow id="S3.E5.m1.1.1.1.1.2" xref="S3.E5.m1.1.1.1.1.2.cmml"><msub id="S3.E5.m1.1.1.1.1.2.4" xref="S3.E5.m1.1.1.1.1.2.4.cmml"><mi id="S3.E5.m1.1.1.1.1.2.4.2" xref="S3.E5.m1.1.1.1.1.2.4.2.cmml">w</mi><mi id="S3.E5.m1.1.1.1.1.2.4.3" xref="S3.E5.m1.1.1.1.1.2.4.3.cmml">i</mi></msub><mo id="S3.E5.m1.1.1.1.1.2.3" stretchy="false" xref="S3.E5.m1.1.1.1.1.2.3.cmml">←</mo><mrow id="S3.E5.m1.1.1.1.1.2.2" xref="S3.E5.m1.1.1.1.1.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.1.1.1.1.2.2.4" xref="S3.E5.m1.1.1.1.1.2.2.4.cmml">ℳ</mi><mo id="S3.E5.m1.1.1.1.1.2.2.3" xref="S3.E5.m1.1.1.1.1.2.2.3.cmml">⁢</mo><mrow id="S3.E5.m1.1.1.1.1.2.2.2.2" xref="S3.E5.m1.1.1.1.1.2.2.2.3.cmml"><mo id="S3.E5.m1.1.1.1.1.2.2.2.2.3" stretchy="false" xref="S3.E5.m1.1.1.1.1.2.2.2.3.cmml">(</mo><msub id="S3.E5.m1.1.1.1.1.1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E5.m1.1.1.1.1.1.1.1.1.1.2" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mrow id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.2" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.2.cmml">t</mi><mo id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.1" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.3" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.3.cmml">a</mi><mo id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.1a" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.4" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.4.cmml">s</mi><mo id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.1b" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.5" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.5.cmml">k</mi></mrow></msub><mo id="S3.E5.m1.1.1.1.1.2.2.2.2.4" xref="S3.E5.m1.1.1.1.1.2.2.2.3.cmml">,</mo><mrow id="S3.E5.m1.1.1.1.1.2.2.2.2.2" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.cmml"><mi id="S3.E5.m1.1.1.1.1.2.2.2.2.2.2" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.2.cmml">s</mi><mo id="S3.E5.m1.1.1.1.1.2.2.2.2.2.1" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.2.2.2.2.2.3" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.3.cmml">e</mi><mo id="S3.E5.m1.1.1.1.1.2.2.2.2.2.1a" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.1.cmml">⁢</mo><mi id="S3.E5.m1.1.1.1.1.2.2.2.2.2.4" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.4.cmml">n</mi><mo id="S3.E5.m1.1.1.1.1.2.2.2.2.2.1b" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.1.cmml">⁢</mo><msub id="S3.E5.m1.1.1.1.1.2.2.2.2.2.5" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.cmml"><mi id="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.2" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.2.cmml">t</mi><mi id="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.3" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.3.cmml">i</mi></msub></mrow><mo id="S3.E5.m1.1.1.1.1.2.2.2.2.5" stretchy="false" xref="S3.E5.m1.1.1.1.1.2.2.2.3.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S3.E5.m1.1.1.1.2" xref="S3.E5.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E5.m1.1b"><apply id="S3.E5.m1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1"><ci id="S3.E5.m1.1.1.1.1.3.cmml" xref="S3.E5.m1.1.1.1.1.3">:</ci><apply id="S3.E5.m1.1.1.1.1.4.cmml" xref="S3.E5.m1.1.1.1.1.4"><in id="S3.E5.m1.1.1.1.1.4.1.cmml" xref="S3.E5.m1.1.1.1.1.4.1"></in><apply id="S3.E5.m1.1.1.1.1.4.2.cmml" xref="S3.E5.m1.1.1.1.1.4.2"><times id="S3.E5.m1.1.1.1.1.4.2.1.cmml" xref="S3.E5.m1.1.1.1.1.4.2.1"></times><ci id="S3.E5.m1.1.1.1.1.4.2.2a.cmml" xref="S3.E5.m1.1.1.1.1.4.2.2"><mtext id="S3.E5.m1.1.1.1.1.4.2.2.cmml" xref="S3.E5.m1.1.1.1.1.4.2.2">for</mtext></ci><ci id="S3.E5.m1.1.1.1.1.4.2.3.cmml" xref="S3.E5.m1.1.1.1.1.4.2.3">𝑠</ci><ci id="S3.E5.m1.1.1.1.1.4.2.4.cmml" xref="S3.E5.m1.1.1.1.1.4.2.4">𝑒</ci><ci id="S3.E5.m1.1.1.1.1.4.2.5.cmml" xref="S3.E5.m1.1.1.1.1.4.2.5">𝑛</ci><apply id="S3.E5.m1.1.1.1.1.4.2.6.cmml" xref="S3.E5.m1.1.1.1.1.4.2.6"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.4.2.6.1.cmml" xref="S3.E5.m1.1.1.1.1.4.2.6">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.4.2.6.2.cmml" xref="S3.E5.m1.1.1.1.1.4.2.6.2">𝑡</ci><ci id="S3.E5.m1.1.1.1.1.4.2.6.3.cmml" xref="S3.E5.m1.1.1.1.1.4.2.6.3">𝑖</ci></apply></apply><apply id="S3.E5.m1.1.1.1.1.4.3.cmml" xref="S3.E5.m1.1.1.1.1.4.3"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.4.3.1.cmml" xref="S3.E5.m1.1.1.1.1.4.3">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.4.3.2.cmml" xref="S3.E5.m1.1.1.1.1.4.3.2">𝑋</ci><apply id="S3.E5.m1.1.1.1.1.4.3.3.cmml" xref="S3.E5.m1.1.1.1.1.4.3.3"><times id="S3.E5.m1.1.1.1.1.4.3.3.1.cmml" xref="S3.E5.m1.1.1.1.1.4.3.3.1"></times><ci id="S3.E5.m1.1.1.1.1.4.3.3.2.cmml" xref="S3.E5.m1.1.1.1.1.4.3.3.2">𝑟</ci><ci id="S3.E5.m1.1.1.1.1.4.3.3.3.cmml" xref="S3.E5.m1.1.1.1.1.4.3.3.3">𝑒</ci><ci id="S3.E5.m1.1.1.1.1.4.3.3.4.cmml" xref="S3.E5.m1.1.1.1.1.4.3.3.4">𝑡</ci><ci id="S3.E5.m1.1.1.1.1.4.3.3.5.cmml" xref="S3.E5.m1.1.1.1.1.4.3.3.5">𝑟</ci></apply></apply></apply><apply id="S3.E5.m1.1.1.1.1.2.cmml" xref="S3.E5.m1.1.1.1.1.2"><ci id="S3.E5.m1.1.1.1.1.2.3.cmml" xref="S3.E5.m1.1.1.1.1.2.3">←</ci><apply id="S3.E5.m1.1.1.1.1.2.4.cmml" xref="S3.E5.m1.1.1.1.1.2.4"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.2.4.1.cmml" xref="S3.E5.m1.1.1.1.1.2.4">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.2.4.2.cmml" xref="S3.E5.m1.1.1.1.1.2.4.2">𝑤</ci><ci id="S3.E5.m1.1.1.1.1.2.4.3.cmml" xref="S3.E5.m1.1.1.1.1.2.4.3">𝑖</ci></apply><apply id="S3.E5.m1.1.1.1.1.2.2.cmml" xref="S3.E5.m1.1.1.1.1.2.2"><times id="S3.E5.m1.1.1.1.1.2.2.3.cmml" xref="S3.E5.m1.1.1.1.1.2.2.3"></times><ci id="S3.E5.m1.1.1.1.1.2.2.4.cmml" xref="S3.E5.m1.1.1.1.1.2.2.4">ℳ</ci><interval closure="open" id="S3.E5.m1.1.1.1.1.2.2.2.3.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2"><apply id="S3.E5.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.2">𝑋</ci><apply id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3"><times id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.1"></times><ci id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.2">𝑡</ci><ci id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.3">𝑎</ci><ci id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.4.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.4">𝑠</ci><ci id="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.5.cmml" xref="S3.E5.m1.1.1.1.1.1.1.1.1.1.3.5">𝑘</ci></apply></apply><apply id="S3.E5.m1.1.1.1.1.2.2.2.2.2.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2"><times id="S3.E5.m1.1.1.1.1.2.2.2.2.2.1.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.1"></times><ci id="S3.E5.m1.1.1.1.1.2.2.2.2.2.2.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.2">𝑠</ci><ci id="S3.E5.m1.1.1.1.1.2.2.2.2.2.3.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.3">𝑒</ci><ci id="S3.E5.m1.1.1.1.1.2.2.2.2.2.4.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.4">𝑛</ci><apply id="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.5"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.1.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.5">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.2.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.2">𝑡</ci><ci id="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.3.cmml" xref="S3.E5.m1.1.1.1.1.2.2.2.2.2.5.3">𝑖</ci></apply></apply></interval></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E5.m1.1c">\text{for}~{}~{}sent_{i}\in X_{retr}:~{}~{}w_{i}\leftarrow\mathcal{M}(X_{task}%
,sent_{i}),</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.1d">for italic_s italic_e italic_n italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT : italic_w start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← caligraphic_M ( italic_X start_POSTSUBSCRIPT italic_t italic_a italic_s italic_k end_POSTSUBSCRIPT , italic_s italic_e italic_n italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS4.SSS2.p1.3">where <math alttext="sent_{i}" class="ltx_Math" display="inline" id="S3.SS4.SSS2.p1.2.m1.1"><semantics id="S3.SS4.SSS2.p1.2.m1.1a"><mrow id="S3.SS4.SSS2.p1.2.m1.1.1" xref="S3.SS4.SSS2.p1.2.m1.1.1.cmml"><mi id="S3.SS4.SSS2.p1.2.m1.1.1.2" xref="S3.SS4.SSS2.p1.2.m1.1.1.2.cmml">s</mi><mo id="S3.SS4.SSS2.p1.2.m1.1.1.1" xref="S3.SS4.SSS2.p1.2.m1.1.1.1.cmml">⁢</mo><mi id="S3.SS4.SSS2.p1.2.m1.1.1.3" xref="S3.SS4.SSS2.p1.2.m1.1.1.3.cmml">e</mi><mo id="S3.SS4.SSS2.p1.2.m1.1.1.1a" xref="S3.SS4.SSS2.p1.2.m1.1.1.1.cmml">⁢</mo><mi id="S3.SS4.SSS2.p1.2.m1.1.1.4" xref="S3.SS4.SSS2.p1.2.m1.1.1.4.cmml">n</mi><mo id="S3.SS4.SSS2.p1.2.m1.1.1.1b" xref="S3.SS4.SSS2.p1.2.m1.1.1.1.cmml">⁢</mo><msub id="S3.SS4.SSS2.p1.2.m1.1.1.5" xref="S3.SS4.SSS2.p1.2.m1.1.1.5.cmml"><mi id="S3.SS4.SSS2.p1.2.m1.1.1.5.2" xref="S3.SS4.SSS2.p1.2.m1.1.1.5.2.cmml">t</mi><mi id="S3.SS4.SSS2.p1.2.m1.1.1.5.3" xref="S3.SS4.SSS2.p1.2.m1.1.1.5.3.cmml">i</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS2.p1.2.m1.1b"><apply id="S3.SS4.SSS2.p1.2.m1.1.1.cmml" xref="S3.SS4.SSS2.p1.2.m1.1.1"><times id="S3.SS4.SSS2.p1.2.m1.1.1.1.cmml" xref="S3.SS4.SSS2.p1.2.m1.1.1.1"></times><ci id="S3.SS4.SSS2.p1.2.m1.1.1.2.cmml" xref="S3.SS4.SSS2.p1.2.m1.1.1.2">𝑠</ci><ci id="S3.SS4.SSS2.p1.2.m1.1.1.3.cmml" xref="S3.SS4.SSS2.p1.2.m1.1.1.3">𝑒</ci><ci id="S3.SS4.SSS2.p1.2.m1.1.1.4.cmml" xref="S3.SS4.SSS2.p1.2.m1.1.1.4">𝑛</ci><apply id="S3.SS4.SSS2.p1.2.m1.1.1.5.cmml" xref="S3.SS4.SSS2.p1.2.m1.1.1.5"><csymbol cd="ambiguous" id="S3.SS4.SSS2.p1.2.m1.1.1.5.1.cmml" xref="S3.SS4.SSS2.p1.2.m1.1.1.5">subscript</csymbol><ci id="S3.SS4.SSS2.p1.2.m1.1.1.5.2.cmml" xref="S3.SS4.SSS2.p1.2.m1.1.1.5.2">𝑡</ci><ci id="S3.SS4.SSS2.p1.2.m1.1.1.5.3.cmml" xref="S3.SS4.SSS2.p1.2.m1.1.1.5.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS2.p1.2.m1.1c">sent_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS2.p1.2.m1.1d">italic_s italic_e italic_n italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> stands for the <math alttext="i" class="ltx_Math" display="inline" id="S3.SS4.SSS2.p1.3.m2.1"><semantics id="S3.SS4.SSS2.p1.3.m2.1a"><mi id="S3.SS4.SSS2.p1.3.m2.1.1" xref="S3.SS4.SSS2.p1.3.m2.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS2.p1.3.m2.1b"><ci id="S3.SS4.SSS2.p1.3.m2.1.1.cmml" xref="S3.SS4.SSS2.p1.3.m2.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS2.p1.3.m2.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS2.p1.3.m2.1d">italic_i</annotation></semantics></math>-th sentence in the retrieved contexts. Compared to the token-level method, the sentence-level approach is able to better maintain semantic coherence, as the retrieved contexts are down-sampled on a sentence basis.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S3.SS4.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.4.3. </span>Compression ratio allocation</h4>
<div class="ltx_para" id="S3.SS4.SSS3.p1">
<p class="ltx_p" id="S3.SS4.SSS3.p1.9">Although the estimated importance is positively correlated with the usefulness of context, it serves more as an indicator of relative relationships rather than a direct basis for sampling ratios. To address this, we propose a stepped scheme for allocating the sampling ratios.
This method partitions the retrieved contexts into groups, where higher-priority groups receive a greater sampling ratio. The allocation process is straightforward which involves three simple steps.
First, we rank different parts of the contexts based on their estimated importance (by tokens with the token-level estimation, or by sentences with the sentence-level estimation). Next, we introduce <math alttext="k" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.1.m1.1"><semantics id="S3.SS4.SSS3.p1.1.m1.1a"><mi id="S3.SS4.SSS3.p1.1.m1.1.1" xref="S3.SS4.SSS3.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.1.m1.1b"><ci id="S3.SS4.SSS3.p1.1.m1.1.1.cmml" xref="S3.SS4.SSS3.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.1.m1.1d">italic_k</annotation></semantics></math> groups: <math alttext="g_{1}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.2.m2.1"><semantics id="S3.SS4.SSS3.p1.2.m2.1a"><msub id="S3.SS4.SSS3.p1.2.m2.1.1" xref="S3.SS4.SSS3.p1.2.m2.1.1.cmml"><mi id="S3.SS4.SSS3.p1.2.m2.1.1.2" xref="S3.SS4.SSS3.p1.2.m2.1.1.2.cmml">g</mi><mn id="S3.SS4.SSS3.p1.2.m2.1.1.3" xref="S3.SS4.SSS3.p1.2.m2.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.2.m2.1b"><apply id="S3.SS4.SSS3.p1.2.m2.1.1.cmml" xref="S3.SS4.SSS3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.2.m2.1.1.1.cmml" xref="S3.SS4.SSS3.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.2.m2.1.1.2.cmml" xref="S3.SS4.SSS3.p1.2.m2.1.1.2">𝑔</ci><cn id="S3.SS4.SSS3.p1.2.m2.1.1.3.cmml" type="integer" xref="S3.SS4.SSS3.p1.2.m2.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.2.m2.1c">g_{1}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.2.m2.1d">italic_g start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="g_{2}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.3.m3.1"><semantics id="S3.SS4.SSS3.p1.3.m3.1a"><msub id="S3.SS4.SSS3.p1.3.m3.1.1" xref="S3.SS4.SSS3.p1.3.m3.1.1.cmml"><mi id="S3.SS4.SSS3.p1.3.m3.1.1.2" xref="S3.SS4.SSS3.p1.3.m3.1.1.2.cmml">g</mi><mn id="S3.SS4.SSS3.p1.3.m3.1.1.3" xref="S3.SS4.SSS3.p1.3.m3.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.3.m3.1b"><apply id="S3.SS4.SSS3.p1.3.m3.1.1.cmml" xref="S3.SS4.SSS3.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.3.m3.1.1.1.cmml" xref="S3.SS4.SSS3.p1.3.m3.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.3.m3.1.1.2.cmml" xref="S3.SS4.SSS3.p1.3.m3.1.1.2">𝑔</ci><cn id="S3.SS4.SSS3.p1.3.m3.1.1.3.cmml" type="integer" xref="S3.SS4.SSS3.p1.3.m3.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.3.m3.1c">g_{2}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.3.m3.1d">italic_g start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>, … , <math alttext="g_{k}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.4.m4.1"><semantics id="S3.SS4.SSS3.p1.4.m4.1a"><msub id="S3.SS4.SSS3.p1.4.m4.1.1" xref="S3.SS4.SSS3.p1.4.m4.1.1.cmml"><mi id="S3.SS4.SSS3.p1.4.m4.1.1.2" xref="S3.SS4.SSS3.p1.4.m4.1.1.2.cmml">g</mi><mi id="S3.SS4.SSS3.p1.4.m4.1.1.3" xref="S3.SS4.SSS3.p1.4.m4.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.4.m4.1b"><apply id="S3.SS4.SSS3.p1.4.m4.1.1.cmml" xref="S3.SS4.SSS3.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.4.m4.1.1.1.cmml" xref="S3.SS4.SSS3.p1.4.m4.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.4.m4.1.1.2.cmml" xref="S3.SS4.SSS3.p1.4.m4.1.1.2">𝑔</ci><ci id="S3.SS4.SSS3.p1.4.m4.1.1.3.cmml" xref="S3.SS4.SSS3.p1.4.m4.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.4.m4.1c">g_{k}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.4.m4.1d">italic_g start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>, with increasing priorities. We also define sampling ratio for these <math alttext="k" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.5.m5.1"><semantics id="S3.SS4.SSS3.p1.5.m5.1a"><mi id="S3.SS4.SSS3.p1.5.m5.1.1" xref="S3.SS4.SSS3.p1.5.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.5.m5.1b"><ci id="S3.SS4.SSS3.p1.5.m5.1.1.cmml" xref="S3.SS4.SSS3.p1.5.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.5.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.5.m5.1d">italic_k</annotation></semantics></math> groups: <math alttext="w_{1}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.6.m6.1"><semantics id="S3.SS4.SSS3.p1.6.m6.1a"><msub id="S3.SS4.SSS3.p1.6.m6.1.1" xref="S3.SS4.SSS3.p1.6.m6.1.1.cmml"><mi id="S3.SS4.SSS3.p1.6.m6.1.1.2" xref="S3.SS4.SSS3.p1.6.m6.1.1.2.cmml">w</mi><mn id="S3.SS4.SSS3.p1.6.m6.1.1.3" xref="S3.SS4.SSS3.p1.6.m6.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.6.m6.1b"><apply id="S3.SS4.SSS3.p1.6.m6.1.1.cmml" xref="S3.SS4.SSS3.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.6.m6.1.1.1.cmml" xref="S3.SS4.SSS3.p1.6.m6.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.6.m6.1.1.2.cmml" xref="S3.SS4.SSS3.p1.6.m6.1.1.2">𝑤</ci><cn id="S3.SS4.SSS3.p1.6.m6.1.1.3.cmml" type="integer" xref="S3.SS4.SSS3.p1.6.m6.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.6.m6.1c">w_{1}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.6.m6.1d">italic_w start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="w_{2}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.7.m7.1"><semantics id="S3.SS4.SSS3.p1.7.m7.1a"><msub id="S3.SS4.SSS3.p1.7.m7.1.1" xref="S3.SS4.SSS3.p1.7.m7.1.1.cmml"><mi id="S3.SS4.SSS3.p1.7.m7.1.1.2" xref="S3.SS4.SSS3.p1.7.m7.1.1.2.cmml">w</mi><mn id="S3.SS4.SSS3.p1.7.m7.1.1.3" xref="S3.SS4.SSS3.p1.7.m7.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.7.m7.1b"><apply id="S3.SS4.SSS3.p1.7.m7.1.1.cmml" xref="S3.SS4.SSS3.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.7.m7.1.1.1.cmml" xref="S3.SS4.SSS3.p1.7.m7.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.7.m7.1.1.2.cmml" xref="S3.SS4.SSS3.p1.7.m7.1.1.2">𝑤</ci><cn id="S3.SS4.SSS3.p1.7.m7.1.1.3.cmml" type="integer" xref="S3.SS4.SSS3.p1.7.m7.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.7.m7.1c">w_{2}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.7.m7.1d">italic_w start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>, … , <math alttext="w_{k}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.8.m8.1"><semantics id="S3.SS4.SSS3.p1.8.m8.1a"><msub id="S3.SS4.SSS3.p1.8.m8.1.1" xref="S3.SS4.SSS3.p1.8.m8.1.1.cmml"><mi id="S3.SS4.SSS3.p1.8.m8.1.1.2" xref="S3.SS4.SSS3.p1.8.m8.1.1.2.cmml">w</mi><mi id="S3.SS4.SSS3.p1.8.m8.1.1.3" xref="S3.SS4.SSS3.p1.8.m8.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.8.m8.1b"><apply id="S3.SS4.SSS3.p1.8.m8.1.1.cmml" xref="S3.SS4.SSS3.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.8.m8.1.1.1.cmml" xref="S3.SS4.SSS3.p1.8.m8.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.8.m8.1.1.2.cmml" xref="S3.SS4.SSS3.p1.8.m8.1.1.2">𝑤</ci><ci id="S3.SS4.SSS3.p1.8.m8.1.1.3.cmml" xref="S3.SS4.SSS3.p1.8.m8.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.8.m8.1c">w_{k}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.8.m8.1d">italic_w start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>, in an ascending order. Finally, we make linear allocation of the contexts to the <math alttext="k" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.9.m9.1"><semantics id="S3.SS4.SSS3.p1.9.m9.1a"><mi id="S3.SS4.SSS3.p1.9.m9.1.1" xref="S3.SS4.SSS3.p1.9.m9.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.9.m9.1b"><ci id="S3.SS4.SSS3.p1.9.m9.1.1.cmml" xref="S3.SS4.SSS3.p1.9.m9.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.9.m9.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.9.m9.1d">italic_k</annotation></semantics></math> groups to ensure that the following relationship holds:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(6)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="w_{1}*n_{1}+w_{2}*n_{2}+...w_{k}*n_{k}=\alpha*n" class="ltx_Math" display="block" id="S3.E6.m1.1"><semantics id="S3.E6.m1.1a"><mrow id="S3.E6.m1.1.1" xref="S3.E6.m1.1.1.cmml"><mrow id="S3.E6.m1.1.1.2" xref="S3.E6.m1.1.1.2.cmml"><mrow id="S3.E6.m1.1.1.2.2" xref="S3.E6.m1.1.1.2.2.cmml"><msub id="S3.E6.m1.1.1.2.2.2" xref="S3.E6.m1.1.1.2.2.2.cmml"><mi id="S3.E6.m1.1.1.2.2.2.2" xref="S3.E6.m1.1.1.2.2.2.2.cmml">w</mi><mn id="S3.E6.m1.1.1.2.2.2.3" xref="S3.E6.m1.1.1.2.2.2.3.cmml">1</mn></msub><mo id="S3.E6.m1.1.1.2.2.1" lspace="0.222em" rspace="0.222em" xref="S3.E6.m1.1.1.2.2.1.cmml">∗</mo><msub id="S3.E6.m1.1.1.2.2.3" xref="S3.E6.m1.1.1.2.2.3.cmml"><mi id="S3.E6.m1.1.1.2.2.3.2" xref="S3.E6.m1.1.1.2.2.3.2.cmml">n</mi><mn id="S3.E6.m1.1.1.2.2.3.3" xref="S3.E6.m1.1.1.2.2.3.3.cmml">1</mn></msub></mrow><mo id="S3.E6.m1.1.1.2.1" xref="S3.E6.m1.1.1.2.1.cmml">+</mo><mrow id="S3.E6.m1.1.1.2.3" xref="S3.E6.m1.1.1.2.3.cmml"><msub id="S3.E6.m1.1.1.2.3.2" xref="S3.E6.m1.1.1.2.3.2.cmml"><mi id="S3.E6.m1.1.1.2.3.2.2" xref="S3.E6.m1.1.1.2.3.2.2.cmml">w</mi><mn id="S3.E6.m1.1.1.2.3.2.3" xref="S3.E6.m1.1.1.2.3.2.3.cmml">2</mn></msub><mo id="S3.E6.m1.1.1.2.3.1" lspace="0.222em" rspace="0.222em" xref="S3.E6.m1.1.1.2.3.1.cmml">∗</mo><msub id="S3.E6.m1.1.1.2.3.3" xref="S3.E6.m1.1.1.2.3.3.cmml"><mi id="S3.E6.m1.1.1.2.3.3.2" xref="S3.E6.m1.1.1.2.3.3.2.cmml">n</mi><mn id="S3.E6.m1.1.1.2.3.3.3" xref="S3.E6.m1.1.1.2.3.3.3.cmml">2</mn></msub></mrow><mo id="S3.E6.m1.1.1.2.1a" xref="S3.E6.m1.1.1.2.1.cmml">+</mo><mrow id="S3.E6.m1.1.1.2.4" xref="S3.E6.m1.1.1.2.4.cmml"><mrow id="S3.E6.m1.1.1.2.4.2" xref="S3.E6.m1.1.1.2.4.2.cmml"><mi id="S3.E6.m1.1.1.2.4.2.2" mathvariant="normal" xref="S3.E6.m1.1.1.2.4.2.2.cmml">…</mi><mo id="S3.E6.m1.1.1.2.4.2.1" xref="S3.E6.m1.1.1.2.4.2.1.cmml">⁢</mo><msub id="S3.E6.m1.1.1.2.4.2.3" xref="S3.E6.m1.1.1.2.4.2.3.cmml"><mi id="S3.E6.m1.1.1.2.4.2.3.2" xref="S3.E6.m1.1.1.2.4.2.3.2.cmml">w</mi><mi id="S3.E6.m1.1.1.2.4.2.3.3" xref="S3.E6.m1.1.1.2.4.2.3.3.cmml">k</mi></msub></mrow><mo id="S3.E6.m1.1.1.2.4.1" lspace="0.222em" rspace="0.222em" xref="S3.E6.m1.1.1.2.4.1.cmml">∗</mo><msub id="S3.E6.m1.1.1.2.4.3" xref="S3.E6.m1.1.1.2.4.3.cmml"><mi id="S3.E6.m1.1.1.2.4.3.2" xref="S3.E6.m1.1.1.2.4.3.2.cmml">n</mi><mi id="S3.E6.m1.1.1.2.4.3.3" xref="S3.E6.m1.1.1.2.4.3.3.cmml">k</mi></msub></mrow></mrow><mo id="S3.E6.m1.1.1.1" xref="S3.E6.m1.1.1.1.cmml">=</mo><mrow id="S3.E6.m1.1.1.3" xref="S3.E6.m1.1.1.3.cmml"><mi id="S3.E6.m1.1.1.3.2" xref="S3.E6.m1.1.1.3.2.cmml">α</mi><mo id="S3.E6.m1.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S3.E6.m1.1.1.3.1.cmml">∗</mo><mi id="S3.E6.m1.1.1.3.3" xref="S3.E6.m1.1.1.3.3.cmml">n</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E6.m1.1b"><apply id="S3.E6.m1.1.1.cmml" xref="S3.E6.m1.1.1"><eq id="S3.E6.m1.1.1.1.cmml" xref="S3.E6.m1.1.1.1"></eq><apply id="S3.E6.m1.1.1.2.cmml" xref="S3.E6.m1.1.1.2"><plus id="S3.E6.m1.1.1.2.1.cmml" xref="S3.E6.m1.1.1.2.1"></plus><apply id="S3.E6.m1.1.1.2.2.cmml" xref="S3.E6.m1.1.1.2.2"><times id="S3.E6.m1.1.1.2.2.1.cmml" xref="S3.E6.m1.1.1.2.2.1"></times><apply id="S3.E6.m1.1.1.2.2.2.cmml" xref="S3.E6.m1.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.2.2.2.1.cmml" xref="S3.E6.m1.1.1.2.2.2">subscript</csymbol><ci id="S3.E6.m1.1.1.2.2.2.2.cmml" xref="S3.E6.m1.1.1.2.2.2.2">𝑤</ci><cn id="S3.E6.m1.1.1.2.2.2.3.cmml" type="integer" xref="S3.E6.m1.1.1.2.2.2.3">1</cn></apply><apply id="S3.E6.m1.1.1.2.2.3.cmml" xref="S3.E6.m1.1.1.2.2.3"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.2.2.3.1.cmml" xref="S3.E6.m1.1.1.2.2.3">subscript</csymbol><ci id="S3.E6.m1.1.1.2.2.3.2.cmml" xref="S3.E6.m1.1.1.2.2.3.2">𝑛</ci><cn id="S3.E6.m1.1.1.2.2.3.3.cmml" type="integer" xref="S3.E6.m1.1.1.2.2.3.3">1</cn></apply></apply><apply id="S3.E6.m1.1.1.2.3.cmml" xref="S3.E6.m1.1.1.2.3"><times id="S3.E6.m1.1.1.2.3.1.cmml" xref="S3.E6.m1.1.1.2.3.1"></times><apply id="S3.E6.m1.1.1.2.3.2.cmml" xref="S3.E6.m1.1.1.2.3.2"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.2.3.2.1.cmml" xref="S3.E6.m1.1.1.2.3.2">subscript</csymbol><ci id="S3.E6.m1.1.1.2.3.2.2.cmml" xref="S3.E6.m1.1.1.2.3.2.2">𝑤</ci><cn id="S3.E6.m1.1.1.2.3.2.3.cmml" type="integer" xref="S3.E6.m1.1.1.2.3.2.3">2</cn></apply><apply id="S3.E6.m1.1.1.2.3.3.cmml" xref="S3.E6.m1.1.1.2.3.3"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.2.3.3.1.cmml" xref="S3.E6.m1.1.1.2.3.3">subscript</csymbol><ci id="S3.E6.m1.1.1.2.3.3.2.cmml" xref="S3.E6.m1.1.1.2.3.3.2">𝑛</ci><cn id="S3.E6.m1.1.1.2.3.3.3.cmml" type="integer" xref="S3.E6.m1.1.1.2.3.3.3">2</cn></apply></apply><apply id="S3.E6.m1.1.1.2.4.cmml" xref="S3.E6.m1.1.1.2.4"><times id="S3.E6.m1.1.1.2.4.1.cmml" xref="S3.E6.m1.1.1.2.4.1"></times><apply id="S3.E6.m1.1.1.2.4.2.cmml" xref="S3.E6.m1.1.1.2.4.2"><times id="S3.E6.m1.1.1.2.4.2.1.cmml" xref="S3.E6.m1.1.1.2.4.2.1"></times><ci id="S3.E6.m1.1.1.2.4.2.2.cmml" xref="S3.E6.m1.1.1.2.4.2.2">…</ci><apply id="S3.E6.m1.1.1.2.4.2.3.cmml" xref="S3.E6.m1.1.1.2.4.2.3"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.2.4.2.3.1.cmml" xref="S3.E6.m1.1.1.2.4.2.3">subscript</csymbol><ci id="S3.E6.m1.1.1.2.4.2.3.2.cmml" xref="S3.E6.m1.1.1.2.4.2.3.2">𝑤</ci><ci id="S3.E6.m1.1.1.2.4.2.3.3.cmml" xref="S3.E6.m1.1.1.2.4.2.3.3">𝑘</ci></apply></apply><apply id="S3.E6.m1.1.1.2.4.3.cmml" xref="S3.E6.m1.1.1.2.4.3"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.2.4.3.1.cmml" xref="S3.E6.m1.1.1.2.4.3">subscript</csymbol><ci id="S3.E6.m1.1.1.2.4.3.2.cmml" xref="S3.E6.m1.1.1.2.4.3.2">𝑛</ci><ci id="S3.E6.m1.1.1.2.4.3.3.cmml" xref="S3.E6.m1.1.1.2.4.3.3">𝑘</ci></apply></apply></apply><apply id="S3.E6.m1.1.1.3.cmml" xref="S3.E6.m1.1.1.3"><times id="S3.E6.m1.1.1.3.1.cmml" xref="S3.E6.m1.1.1.3.1"></times><ci id="S3.E6.m1.1.1.3.2.cmml" xref="S3.E6.m1.1.1.3.2">𝛼</ci><ci id="S3.E6.m1.1.1.3.3.cmml" xref="S3.E6.m1.1.1.3.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E6.m1.1c">w_{1}*n_{1}+w_{2}*n_{2}+...w_{k}*n_{k}=\alpha*n</annotation><annotation encoding="application/x-llamapun" id="S3.E6.m1.1d">italic_w start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∗ italic_n start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT + italic_w start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∗ italic_n start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT + … italic_w start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∗ italic_n start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT = italic_α ∗ italic_n</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS4.SSS3.p1.16">Here, <math alttext="n_{i}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.10.m1.1"><semantics id="S3.SS4.SSS3.p1.10.m1.1a"><msub id="S3.SS4.SSS3.p1.10.m1.1.1" xref="S3.SS4.SSS3.p1.10.m1.1.1.cmml"><mi id="S3.SS4.SSS3.p1.10.m1.1.1.2" xref="S3.SS4.SSS3.p1.10.m1.1.1.2.cmml">n</mi><mi id="S3.SS4.SSS3.p1.10.m1.1.1.3" xref="S3.SS4.SSS3.p1.10.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.10.m1.1b"><apply id="S3.SS4.SSS3.p1.10.m1.1.1.cmml" xref="S3.SS4.SSS3.p1.10.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.10.m1.1.1.1.cmml" xref="S3.SS4.SSS3.p1.10.m1.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.10.m1.1.1.2.cmml" xref="S3.SS4.SSS3.p1.10.m1.1.1.2">𝑛</ci><ci id="S3.SS4.SSS3.p1.10.m1.1.1.3.cmml" xref="S3.SS4.SSS3.p1.10.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.10.m1.1c">n_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.10.m1.1d">italic_n start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="n" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.11.m2.1"><semantics id="S3.SS4.SSS3.p1.11.m2.1a"><mi id="S3.SS4.SSS3.p1.11.m2.1.1" xref="S3.SS4.SSS3.p1.11.m2.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.11.m2.1b"><ci id="S3.SS4.SSS3.p1.11.m2.1.1.cmml" xref="S3.SS4.SSS3.p1.11.m2.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.11.m2.1c">n</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.11.m2.1d">italic_n</annotation></semantics></math> represent the length for the <math alttext="g_{i}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.12.m3.1"><semantics id="S3.SS4.SSS3.p1.12.m3.1a"><msub id="S3.SS4.SSS3.p1.12.m3.1.1" xref="S3.SS4.SSS3.p1.12.m3.1.1.cmml"><mi id="S3.SS4.SSS3.p1.12.m3.1.1.2" xref="S3.SS4.SSS3.p1.12.m3.1.1.2.cmml">g</mi><mi id="S3.SS4.SSS3.p1.12.m3.1.1.3" xref="S3.SS4.SSS3.p1.12.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.12.m3.1b"><apply id="S3.SS4.SSS3.p1.12.m3.1.1.cmml" xref="S3.SS4.SSS3.p1.12.m3.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.12.m3.1.1.1.cmml" xref="S3.SS4.SSS3.p1.12.m3.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.12.m3.1.1.2.cmml" xref="S3.SS4.SSS3.p1.12.m3.1.1.2">𝑔</ci><ci id="S3.SS4.SSS3.p1.12.m3.1.1.3.cmml" xref="S3.SS4.SSS3.p1.12.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.12.m3.1c">g_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.12.m3.1d">italic_g start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="X_{retr}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.13.m4.1"><semantics id="S3.SS4.SSS3.p1.13.m4.1a"><msub id="S3.SS4.SSS3.p1.13.m4.1.1" xref="S3.SS4.SSS3.p1.13.m4.1.1.cmml"><mi id="S3.SS4.SSS3.p1.13.m4.1.1.2" xref="S3.SS4.SSS3.p1.13.m4.1.1.2.cmml">X</mi><mrow id="S3.SS4.SSS3.p1.13.m4.1.1.3" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.cmml"><mi id="S3.SS4.SSS3.p1.13.m4.1.1.3.2" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.2.cmml">r</mi><mo id="S3.SS4.SSS3.p1.13.m4.1.1.3.1" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS3.p1.13.m4.1.1.3.3" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.3.cmml">e</mi><mo id="S3.SS4.SSS3.p1.13.m4.1.1.3.1a" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS3.p1.13.m4.1.1.3.4" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.4.cmml">t</mi><mo id="S3.SS4.SSS3.p1.13.m4.1.1.3.1b" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS3.p1.13.m4.1.1.3.5" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.5.cmml">r</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.13.m4.1b"><apply id="S3.SS4.SSS3.p1.13.m4.1.1.cmml" xref="S3.SS4.SSS3.p1.13.m4.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.13.m4.1.1.1.cmml" xref="S3.SS4.SSS3.p1.13.m4.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.13.m4.1.1.2.cmml" xref="S3.SS4.SSS3.p1.13.m4.1.1.2">𝑋</ci><apply id="S3.SS4.SSS3.p1.13.m4.1.1.3.cmml" xref="S3.SS4.SSS3.p1.13.m4.1.1.3"><times id="S3.SS4.SSS3.p1.13.m4.1.1.3.1.cmml" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.1"></times><ci id="S3.SS4.SSS3.p1.13.m4.1.1.3.2.cmml" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.2">𝑟</ci><ci id="S3.SS4.SSS3.p1.13.m4.1.1.3.3.cmml" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.3">𝑒</ci><ci id="S3.SS4.SSS3.p1.13.m4.1.1.3.4.cmml" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.4">𝑡</ci><ci id="S3.SS4.SSS3.p1.13.m4.1.1.3.5.cmml" xref="S3.SS4.SSS3.p1.13.m4.1.1.3.5">𝑟</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.13.m4.1c">X_{retr}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.13.m4.1d">italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT</annotation></semantics></math>, respectively, while <math alttext="\alpha" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.14.m5.1"><semantics id="S3.SS4.SSS3.p1.14.m5.1a"><mi id="S3.SS4.SSS3.p1.14.m5.1.1" xref="S3.SS4.SSS3.p1.14.m5.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.14.m5.1b"><ci id="S3.SS4.SSS3.p1.14.m5.1.1.cmml" xref="S3.SS4.SSS3.p1.14.m5.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.14.m5.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.14.m5.1d">italic_α</annotation></semantics></math> denotes the required compression ratio. In the simplest case where a binary partition is made (i.e., forming a low-priority group <math alttext="g_{1}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.15.m6.1"><semantics id="S3.SS4.SSS3.p1.15.m6.1a"><msub id="S3.SS4.SSS3.p1.15.m6.1.1" xref="S3.SS4.SSS3.p1.15.m6.1.1.cmml"><mi id="S3.SS4.SSS3.p1.15.m6.1.1.2" xref="S3.SS4.SSS3.p1.15.m6.1.1.2.cmml">g</mi><mn id="S3.SS4.SSS3.p1.15.m6.1.1.3" xref="S3.SS4.SSS3.p1.15.m6.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.15.m6.1b"><apply id="S3.SS4.SSS3.p1.15.m6.1.1.cmml" xref="S3.SS4.SSS3.p1.15.m6.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.15.m6.1.1.1.cmml" xref="S3.SS4.SSS3.p1.15.m6.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.15.m6.1.1.2.cmml" xref="S3.SS4.SSS3.p1.15.m6.1.1.2">𝑔</ci><cn id="S3.SS4.SSS3.p1.15.m6.1.1.3.cmml" type="integer" xref="S3.SS4.SSS3.p1.15.m6.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.15.m6.1c">g_{1}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.15.m6.1d">italic_g start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> and a high-priority group <math alttext="g_{2}" class="ltx_Math" display="inline" id="S3.SS4.SSS3.p1.16.m7.1"><semantics id="S3.SS4.SSS3.p1.16.m7.1a"><msub id="S3.SS4.SSS3.p1.16.m7.1.1" xref="S3.SS4.SSS3.p1.16.m7.1.1.cmml"><mi id="S3.SS4.SSS3.p1.16.m7.1.1.2" xref="S3.SS4.SSS3.p1.16.m7.1.1.2.cmml">g</mi><mn id="S3.SS4.SSS3.p1.16.m7.1.1.3" xref="S3.SS4.SSS3.p1.16.m7.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS3.p1.16.m7.1b"><apply id="S3.SS4.SSS3.p1.16.m7.1.1.cmml" xref="S3.SS4.SSS3.p1.16.m7.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS3.p1.16.m7.1.1.1.cmml" xref="S3.SS4.SSS3.p1.16.m7.1.1">subscript</csymbol><ci id="S3.SS4.SSS3.p1.16.m7.1.1.2.cmml" xref="S3.SS4.SSS3.p1.16.m7.1.1.2">𝑔</ci><cn id="S3.SS4.SSS3.p1.16.m7.1.1.3.cmml" type="integer" xref="S3.SS4.SSS3.p1.16.m7.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS3.p1.16.m7.1c">g_{2}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS3.p1.16.m7.1d">italic_g start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math> are formed), the context allocation can be directly calculated once the sampling ratios are determined.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S3.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.5. </span>Training Workflow</h3>
<div class="ltx_para" id="S3.SS5.p1">
<p class="ltx_p" id="S3.SS5.p1.9">The training process takes place to optimize the compressive encoder, enabling it to generate high-quality compressed contexts that enhance RAG performance. Given the abundance of unlabeled data (e.g., general corpora like Pile, RedPajama) and the limited availability of labeled data (e.g., for question answering), we design a <span class="ltx_text ltx_font_bold" id="S3.SS5.p1.9.1">two-stage training workflow</span> to fully optimize the model based on the accessible data resource. First, we perform auto-regressive <span class="ltx_text ltx_font_bold" id="S3.SS5.p1.9.2">pre-training</span> on the unlabeled data, where language modeling is conducted based on the compressed contexts. In this stage, the following training objective is maximized:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(7)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max\sum\nolimits_{x_{i}\in X_{pre}}P_{LLM}(x_{i}|\phi(X_{pre}[:x_{i}]))." class="ltx_math_unparsed" display="block" id="S3.E7.m1.1"><semantics id="S3.E7.m1.1a"><mrow id="S3.E7.m1.1b"><mi id="S3.E7.m1.1.1">max</mi><msub id="S3.E7.m1.1.2"><mo id="S3.E7.m1.1.2.2">∑</mo><mrow id="S3.E7.m1.1.2.3"><msub id="S3.E7.m1.1.2.3.2"><mi id="S3.E7.m1.1.2.3.2.2">x</mi><mi id="S3.E7.m1.1.2.3.2.3">i</mi></msub><mo id="S3.E7.m1.1.2.3.1">∈</mo><msub id="S3.E7.m1.1.2.3.3"><mi id="S3.E7.m1.1.2.3.3.2">X</mi><mrow id="S3.E7.m1.1.2.3.3.3"><mi id="S3.E7.m1.1.2.3.3.3.2">p</mi><mo id="S3.E7.m1.1.2.3.3.3.1">⁢</mo><mi id="S3.E7.m1.1.2.3.3.3.3">r</mi><mo id="S3.E7.m1.1.2.3.3.3.1a">⁢</mo><mi id="S3.E7.m1.1.2.3.3.3.4">e</mi></mrow></msub></mrow></msub><msub id="S3.E7.m1.1.3"><mi id="S3.E7.m1.1.3.2">P</mi><mrow id="S3.E7.m1.1.3.3"><mi id="S3.E7.m1.1.3.3.2">L</mi><mo id="S3.E7.m1.1.3.3.1">⁢</mo><mi id="S3.E7.m1.1.3.3.3">L</mi><mo id="S3.E7.m1.1.3.3.1a">⁢</mo><mi id="S3.E7.m1.1.3.3.4">M</mi></mrow></msub><mrow id="S3.E7.m1.1.4"><mo id="S3.E7.m1.1.4.1" stretchy="false">(</mo><msub id="S3.E7.m1.1.4.2"><mi id="S3.E7.m1.1.4.2.2">x</mi><mi id="S3.E7.m1.1.4.2.3">i</mi></msub><mo fence="false" id="S3.E7.m1.1.4.3" rspace="0.167em" stretchy="false">|</mo><mi id="S3.E7.m1.1.4.4">ϕ</mi><mrow id="S3.E7.m1.1.4.5"><mo id="S3.E7.m1.1.4.5.1" stretchy="false">(</mo><msub id="S3.E7.m1.1.4.5.2"><mi id="S3.E7.m1.1.4.5.2.2">X</mi><mrow id="S3.E7.m1.1.4.5.2.3"><mi id="S3.E7.m1.1.4.5.2.3.2">p</mi><mo id="S3.E7.m1.1.4.5.2.3.1">⁢</mo><mi id="S3.E7.m1.1.4.5.2.3.3">r</mi><mo id="S3.E7.m1.1.4.5.2.3.1a">⁢</mo><mi id="S3.E7.m1.1.4.5.2.3.4">e</mi></mrow></msub><mrow id="S3.E7.m1.1.4.5.3"><mo id="S3.E7.m1.1.4.5.3.1" stretchy="false">[</mo><mo id="S3.E7.m1.1.4.5.3.2" rspace="0.278em">:</mo><msub id="S3.E7.m1.1.4.5.3.3"><mi id="S3.E7.m1.1.4.5.3.3.2">x</mi><mi id="S3.E7.m1.1.4.5.3.3.3">i</mi></msub><mo id="S3.E7.m1.1.4.5.3.4" stretchy="false">]</mo></mrow><mo id="S3.E7.m1.1.4.5.4" stretchy="false">)</mo></mrow><mo id="S3.E7.m1.1.4.6" stretchy="false">)</mo></mrow><mo id="S3.E7.m1.1.5" lspace="0em">.</mo></mrow><annotation encoding="application/x-tex" id="S3.E7.m1.1c">\max\sum\nolimits_{x_{i}\in X_{pre}}P_{LLM}(x_{i}|\phi(X_{pre}[:x_{i}])).</annotation><annotation encoding="application/x-llamapun" id="S3.E7.m1.1d">roman_max ∑ start_POSTSUBSCRIPT italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_X start_POSTSUBSCRIPT italic_p italic_r italic_e end_POSTSUBSCRIPT end_POSTSUBSCRIPT italic_P start_POSTSUBSCRIPT italic_L italic_L italic_M end_POSTSUBSCRIPT ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_ϕ ( italic_X start_POSTSUBSCRIPT italic_p italic_r italic_e end_POSTSUBSCRIPT [ : italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ] ) ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS5.p1.8">Here, <math alttext="X_{pre}" class="ltx_Math" display="inline" id="S3.SS5.p1.1.m1.1"><semantics id="S3.SS5.p1.1.m1.1a"><msub id="S3.SS5.p1.1.m1.1.1" xref="S3.SS5.p1.1.m1.1.1.cmml"><mi id="S3.SS5.p1.1.m1.1.1.2" xref="S3.SS5.p1.1.m1.1.1.2.cmml">X</mi><mrow id="S3.SS5.p1.1.m1.1.1.3" xref="S3.SS5.p1.1.m1.1.1.3.cmml"><mi id="S3.SS5.p1.1.m1.1.1.3.2" xref="S3.SS5.p1.1.m1.1.1.3.2.cmml">p</mi><mo id="S3.SS5.p1.1.m1.1.1.3.1" xref="S3.SS5.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS5.p1.1.m1.1.1.3.3" xref="S3.SS5.p1.1.m1.1.1.3.3.cmml">r</mi><mo id="S3.SS5.p1.1.m1.1.1.3.1a" xref="S3.SS5.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS5.p1.1.m1.1.1.3.4" xref="S3.SS5.p1.1.m1.1.1.3.4.cmml">e</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS5.p1.1.m1.1b"><apply id="S3.SS5.p1.1.m1.1.1.cmml" xref="S3.SS5.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS5.p1.1.m1.1.1.1.cmml" xref="S3.SS5.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS5.p1.1.m1.1.1.2.cmml" xref="S3.SS5.p1.1.m1.1.1.2">𝑋</ci><apply id="S3.SS5.p1.1.m1.1.1.3.cmml" xref="S3.SS5.p1.1.m1.1.1.3"><times id="S3.SS5.p1.1.m1.1.1.3.1.cmml" xref="S3.SS5.p1.1.m1.1.1.3.1"></times><ci id="S3.SS5.p1.1.m1.1.1.3.2.cmml" xref="S3.SS5.p1.1.m1.1.1.3.2">𝑝</ci><ci id="S3.SS5.p1.1.m1.1.1.3.3.cmml" xref="S3.SS5.p1.1.m1.1.1.3.3">𝑟</ci><ci id="S3.SS5.p1.1.m1.1.1.3.4.cmml" xref="S3.SS5.p1.1.m1.1.1.3.4">𝑒</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS5.p1.1.m1.1c">X_{pre}</annotation><annotation encoding="application/x-llamapun" id="S3.SS5.p1.1.m1.1d">italic_X start_POSTSUBSCRIPT italic_p italic_r italic_e end_POSTSUBSCRIPT</annotation></semantics></math> stands for a sample of unlabeled data for pre-training, <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.SS5.p1.2.m2.1"><semantics id="S3.SS5.p1.2.m2.1a"><msub id="S3.SS5.p1.2.m2.1.1" xref="S3.SS5.p1.2.m2.1.1.cmml"><mi id="S3.SS5.p1.2.m2.1.1.2" xref="S3.SS5.p1.2.m2.1.1.2.cmml">x</mi><mi id="S3.SS5.p1.2.m2.1.1.3" xref="S3.SS5.p1.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS5.p1.2.m2.1b"><apply id="S3.SS5.p1.2.m2.1.1.cmml" xref="S3.SS5.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS5.p1.2.m2.1.1.1.cmml" xref="S3.SS5.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS5.p1.2.m2.1.1.2.cmml" xref="S3.SS5.p1.2.m2.1.1.2">𝑥</ci><ci id="S3.SS5.p1.2.m2.1.1.3.cmml" xref="S3.SS5.p1.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS5.p1.2.m2.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS5.p1.2.m2.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is the <math alttext="i" class="ltx_Math" display="inline" id="S3.SS5.p1.3.m3.1"><semantics id="S3.SS5.p1.3.m3.1a"><mi id="S3.SS5.p1.3.m3.1.1" xref="S3.SS5.p1.3.m3.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS5.p1.3.m3.1b"><ci id="S3.SS5.p1.3.m3.1.1.cmml" xref="S3.SS5.p1.3.m3.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS5.p1.3.m3.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS5.p1.3.m3.1d">italic_i</annotation></semantics></math>-th token, and <math alttext="\phi(X_{pre}[:x_{i}])" class="ltx_math_unparsed" display="inline" id="S3.SS5.p1.4.m4.1"><semantics id="S3.SS5.p1.4.m4.1a"><mrow id="S3.SS5.p1.4.m4.1b"><mi id="S3.SS5.p1.4.m4.1.1">ϕ</mi><mrow id="S3.SS5.p1.4.m4.1.2"><mo id="S3.SS5.p1.4.m4.1.2.1" stretchy="false">(</mo><msub id="S3.SS5.p1.4.m4.1.2.2"><mi id="S3.SS5.p1.4.m4.1.2.2.2">X</mi><mrow id="S3.SS5.p1.4.m4.1.2.2.3"><mi id="S3.SS5.p1.4.m4.1.2.2.3.2">p</mi><mo id="S3.SS5.p1.4.m4.1.2.2.3.1">⁢</mo><mi id="S3.SS5.p1.4.m4.1.2.2.3.3">r</mi><mo id="S3.SS5.p1.4.m4.1.2.2.3.1a">⁢</mo><mi id="S3.SS5.p1.4.m4.1.2.2.3.4">e</mi></mrow></msub><mrow id="S3.SS5.p1.4.m4.1.2.3"><mo id="S3.SS5.p1.4.m4.1.2.3.1" stretchy="false">[</mo><mo id="S3.SS5.p1.4.m4.1.2.3.2" rspace="0.278em">:</mo><msub id="S3.SS5.p1.4.m4.1.2.3.3"><mi id="S3.SS5.p1.4.m4.1.2.3.3.2">x</mi><mi id="S3.SS5.p1.4.m4.1.2.3.3.3">i</mi></msub><mo id="S3.SS5.p1.4.m4.1.2.3.4" stretchy="false">]</mo></mrow><mo id="S3.SS5.p1.4.m4.1.2.4" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S3.SS5.p1.4.m4.1c">\phi(X_{pre}[:x_{i}])</annotation><annotation encoding="application/x-llamapun" id="S3.SS5.p1.4.m4.1d">italic_ϕ ( italic_X start_POSTSUBSCRIPT italic_p italic_r italic_e end_POSTSUBSCRIPT [ : italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ] )</annotation></semantics></math> is the compression of <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.SS5.p1.5.m5.1"><semantics id="S3.SS5.p1.5.m5.1a"><msub id="S3.SS5.p1.5.m5.1.1" xref="S3.SS5.p1.5.m5.1.1.cmml"><mi id="S3.SS5.p1.5.m5.1.1.2" xref="S3.SS5.p1.5.m5.1.1.2.cmml">x</mi><mi id="S3.SS5.p1.5.m5.1.1.3" xref="S3.SS5.p1.5.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS5.p1.5.m5.1b"><apply id="S3.SS5.p1.5.m5.1.1.cmml" xref="S3.SS5.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS5.p1.5.m5.1.1.1.cmml" xref="S3.SS5.p1.5.m5.1.1">subscript</csymbol><ci id="S3.SS5.p1.5.m5.1.1.2.cmml" xref="S3.SS5.p1.5.m5.1.1.2">𝑥</ci><ci id="S3.SS5.p1.5.m5.1.1.3.cmml" xref="S3.SS5.p1.5.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS5.p1.5.m5.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS5.p1.5.m5.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>’s prefix. With the first stage of training, the connection is established between the compressive encoder and the downstream LLM. Next, we move on to perform fine-tuning based on label QA datasets. For each training sample, the ground-truth answer <math alttext="X_{ans}" class="ltx_Math" display="inline" id="S3.SS5.p1.6.m6.1"><semantics id="S3.SS5.p1.6.m6.1a"><msub id="S3.SS5.p1.6.m6.1.1" xref="S3.SS5.p1.6.m6.1.1.cmml"><mi id="S3.SS5.p1.6.m6.1.1.2" xref="S3.SS5.p1.6.m6.1.1.2.cmml">X</mi><mrow id="S3.SS5.p1.6.m6.1.1.3" xref="S3.SS5.p1.6.m6.1.1.3.cmml"><mi id="S3.SS5.p1.6.m6.1.1.3.2" xref="S3.SS5.p1.6.m6.1.1.3.2.cmml">a</mi><mo id="S3.SS5.p1.6.m6.1.1.3.1" xref="S3.SS5.p1.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S3.SS5.p1.6.m6.1.1.3.3" xref="S3.SS5.p1.6.m6.1.1.3.3.cmml">n</mi><mo id="S3.SS5.p1.6.m6.1.1.3.1a" xref="S3.SS5.p1.6.m6.1.1.3.1.cmml">⁢</mo><mi id="S3.SS5.p1.6.m6.1.1.3.4" xref="S3.SS5.p1.6.m6.1.1.3.4.cmml">s</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS5.p1.6.m6.1b"><apply id="S3.SS5.p1.6.m6.1.1.cmml" xref="S3.SS5.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.SS5.p1.6.m6.1.1.1.cmml" xref="S3.SS5.p1.6.m6.1.1">subscript</csymbol><ci id="S3.SS5.p1.6.m6.1.1.2.cmml" xref="S3.SS5.p1.6.m6.1.1.2">𝑋</ci><apply id="S3.SS5.p1.6.m6.1.1.3.cmml" xref="S3.SS5.p1.6.m6.1.1.3"><times id="S3.SS5.p1.6.m6.1.1.3.1.cmml" xref="S3.SS5.p1.6.m6.1.1.3.1"></times><ci id="S3.SS5.p1.6.m6.1.1.3.2.cmml" xref="S3.SS5.p1.6.m6.1.1.3.2">𝑎</ci><ci id="S3.SS5.p1.6.m6.1.1.3.3.cmml" xref="S3.SS5.p1.6.m6.1.1.3.3">𝑛</ci><ci id="S3.SS5.p1.6.m6.1.1.3.4.cmml" xref="S3.SS5.p1.6.m6.1.1.3.4">𝑠</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS5.p1.6.m6.1c">X_{ans}</annotation><annotation encoding="application/x-llamapun" id="S3.SS5.p1.6.m6.1d">italic_X start_POSTSUBSCRIPT italic_a italic_n italic_s end_POSTSUBSCRIPT</annotation></semantics></math> is predicted based on the question <math alttext="X_{q}" class="ltx_Math" display="inline" id="S3.SS5.p1.7.m7.1"><semantics id="S3.SS5.p1.7.m7.1a"><msub id="S3.SS5.p1.7.m7.1.1" xref="S3.SS5.p1.7.m7.1.1.cmml"><mi id="S3.SS5.p1.7.m7.1.1.2" xref="S3.SS5.p1.7.m7.1.1.2.cmml">X</mi><mi id="S3.SS5.p1.7.m7.1.1.3" xref="S3.SS5.p1.7.m7.1.1.3.cmml">q</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS5.p1.7.m7.1b"><apply id="S3.SS5.p1.7.m7.1.1.cmml" xref="S3.SS5.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S3.SS5.p1.7.m7.1.1.1.cmml" xref="S3.SS5.p1.7.m7.1.1">subscript</csymbol><ci id="S3.SS5.p1.7.m7.1.1.2.cmml" xref="S3.SS5.p1.7.m7.1.1.2">𝑋</ci><ci id="S3.SS5.p1.7.m7.1.1.3.cmml" xref="S3.SS5.p1.7.m7.1.1.3">𝑞</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS5.p1.7.m7.1c">X_{q}</annotation><annotation encoding="application/x-llamapun" id="S3.SS5.p1.7.m7.1d">italic_X start_POSTSUBSCRIPT italic_q end_POSTSUBSCRIPT</annotation></semantics></math> and the compressed retrieved contexts <math alttext="\phi(X_{retr})" class="ltx_Math" display="inline" id="S3.SS5.p1.8.m8.1"><semantics id="S3.SS5.p1.8.m8.1a"><mrow id="S3.SS5.p1.8.m8.1.1" xref="S3.SS5.p1.8.m8.1.1.cmml"><mi id="S3.SS5.p1.8.m8.1.1.3" xref="S3.SS5.p1.8.m8.1.1.3.cmml">ϕ</mi><mo id="S3.SS5.p1.8.m8.1.1.2" xref="S3.SS5.p1.8.m8.1.1.2.cmml">⁢</mo><mrow id="S3.SS5.p1.8.m8.1.1.1.1" xref="S3.SS5.p1.8.m8.1.1.1.1.1.cmml"><mo id="S3.SS5.p1.8.m8.1.1.1.1.2" stretchy="false" xref="S3.SS5.p1.8.m8.1.1.1.1.1.cmml">(</mo><msub id="S3.SS5.p1.8.m8.1.1.1.1.1" xref="S3.SS5.p1.8.m8.1.1.1.1.1.cmml"><mi id="S3.SS5.p1.8.m8.1.1.1.1.1.2" xref="S3.SS5.p1.8.m8.1.1.1.1.1.2.cmml">X</mi><mrow id="S3.SS5.p1.8.m8.1.1.1.1.1.3" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.cmml"><mi id="S3.SS5.p1.8.m8.1.1.1.1.1.3.2" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.2.cmml">r</mi><mo id="S3.SS5.p1.8.m8.1.1.1.1.1.3.1" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS5.p1.8.m8.1.1.1.1.1.3.3" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.3.cmml">e</mi><mo id="S3.SS5.p1.8.m8.1.1.1.1.1.3.1a" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS5.p1.8.m8.1.1.1.1.1.3.4" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.4.cmml">t</mi><mo id="S3.SS5.p1.8.m8.1.1.1.1.1.3.1b" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS5.p1.8.m8.1.1.1.1.1.3.5" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.5.cmml">r</mi></mrow></msub><mo id="S3.SS5.p1.8.m8.1.1.1.1.3" stretchy="false" xref="S3.SS5.p1.8.m8.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS5.p1.8.m8.1b"><apply id="S3.SS5.p1.8.m8.1.1.cmml" xref="S3.SS5.p1.8.m8.1.1"><times id="S3.SS5.p1.8.m8.1.1.2.cmml" xref="S3.SS5.p1.8.m8.1.1.2"></times><ci id="S3.SS5.p1.8.m8.1.1.3.cmml" xref="S3.SS5.p1.8.m8.1.1.3">italic-ϕ</ci><apply id="S3.SS5.p1.8.m8.1.1.1.1.1.cmml" xref="S3.SS5.p1.8.m8.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS5.p1.8.m8.1.1.1.1.1.1.cmml" xref="S3.SS5.p1.8.m8.1.1.1.1">subscript</csymbol><ci id="S3.SS5.p1.8.m8.1.1.1.1.1.2.cmml" xref="S3.SS5.p1.8.m8.1.1.1.1.1.2">𝑋</ci><apply id="S3.SS5.p1.8.m8.1.1.1.1.1.3.cmml" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3"><times id="S3.SS5.p1.8.m8.1.1.1.1.1.3.1.cmml" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.1"></times><ci id="S3.SS5.p1.8.m8.1.1.1.1.1.3.2.cmml" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.2">𝑟</ci><ci id="S3.SS5.p1.8.m8.1.1.1.1.1.3.3.cmml" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.3">𝑒</ci><ci id="S3.SS5.p1.8.m8.1.1.1.1.1.3.4.cmml" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.4">𝑡</ci><ci id="S3.SS5.p1.8.m8.1.1.1.1.1.3.5.cmml" xref="S3.SS5.p1.8.m8.1.1.1.1.1.3.5">𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS5.p1.8.m8.1c">\phi(X_{retr})</annotation><annotation encoding="application/x-llamapun" id="S3.SS5.p1.8.m8.1d">italic_ϕ ( italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT )</annotation></semantics></math> (i.e. relevant docs to the question). As a result, we can formulate the following objective function:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(8)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max\sum\nolimits_{x_{i}\in X_{ans}}P_{LLM}(x_{i}|\phi(X_{retr}),X_{q},X_{ans}%
[:x_{i}])." class="ltx_math_unparsed" display="block" id="S3.E8.m1.1"><semantics id="S3.E8.m1.1a"><mrow id="S3.E8.m1.1b"><mi id="S3.E8.m1.1.1">max</mi><msub id="S3.E8.m1.1.2"><mo id="S3.E8.m1.1.2.2">∑</mo><mrow id="S3.E8.m1.1.2.3"><msub id="S3.E8.m1.1.2.3.2"><mi id="S3.E8.m1.1.2.3.2.2">x</mi><mi id="S3.E8.m1.1.2.3.2.3">i</mi></msub><mo id="S3.E8.m1.1.2.3.1">∈</mo><msub id="S3.E8.m1.1.2.3.3"><mi id="S3.E8.m1.1.2.3.3.2">X</mi><mrow id="S3.E8.m1.1.2.3.3.3"><mi id="S3.E8.m1.1.2.3.3.3.2">a</mi><mo id="S3.E8.m1.1.2.3.3.3.1">⁢</mo><mi id="S3.E8.m1.1.2.3.3.3.3">n</mi><mo id="S3.E8.m1.1.2.3.3.3.1a">⁢</mo><mi id="S3.E8.m1.1.2.3.3.3.4">s</mi></mrow></msub></mrow></msub><msub id="S3.E8.m1.1.3"><mi id="S3.E8.m1.1.3.2">P</mi><mrow id="S3.E8.m1.1.3.3"><mi id="S3.E8.m1.1.3.3.2">L</mi><mo id="S3.E8.m1.1.3.3.1">⁢</mo><mi id="S3.E8.m1.1.3.3.3">L</mi><mo id="S3.E8.m1.1.3.3.1a">⁢</mo><mi id="S3.E8.m1.1.3.3.4">M</mi></mrow></msub><mrow id="S3.E8.m1.1.4"><mo id="S3.E8.m1.1.4.1" stretchy="false">(</mo><msub id="S3.E8.m1.1.4.2"><mi id="S3.E8.m1.1.4.2.2">x</mi><mi id="S3.E8.m1.1.4.2.3">i</mi></msub><mo fence="false" id="S3.E8.m1.1.4.3" rspace="0.167em" stretchy="false">|</mo><mi id="S3.E8.m1.1.4.4">ϕ</mi><mrow id="S3.E8.m1.1.4.5"><mo id="S3.E8.m1.1.4.5.1" stretchy="false">(</mo><msub id="S3.E8.m1.1.4.5.2"><mi id="S3.E8.m1.1.4.5.2.2">X</mi><mrow id="S3.E8.m1.1.4.5.2.3"><mi id="S3.E8.m1.1.4.5.2.3.2">r</mi><mo id="S3.E8.m1.1.4.5.2.3.1">⁢</mo><mi id="S3.E8.m1.1.4.5.2.3.3">e</mi><mo id="S3.E8.m1.1.4.5.2.3.1a">⁢</mo><mi id="S3.E8.m1.1.4.5.2.3.4">t</mi><mo id="S3.E8.m1.1.4.5.2.3.1b">⁢</mo><mi id="S3.E8.m1.1.4.5.2.3.5">r</mi></mrow></msub><mo id="S3.E8.m1.1.4.5.3" stretchy="false">)</mo></mrow><mo id="S3.E8.m1.1.4.6">,</mo><msub id="S3.E8.m1.1.4.7"><mi id="S3.E8.m1.1.4.7.2">X</mi><mi id="S3.E8.m1.1.4.7.3">q</mi></msub><mo id="S3.E8.m1.1.4.8">,</mo><msub id="S3.E8.m1.1.4.9"><mi id="S3.E8.m1.1.4.9.2">X</mi><mrow id="S3.E8.m1.1.4.9.3"><mi id="S3.E8.m1.1.4.9.3.2">a</mi><mo id="S3.E8.m1.1.4.9.3.1">⁢</mo><mi id="S3.E8.m1.1.4.9.3.3">n</mi><mo id="S3.E8.m1.1.4.9.3.1a">⁢</mo><mi id="S3.E8.m1.1.4.9.3.4">s</mi></mrow></msub><mrow id="S3.E8.m1.1.4.10"><mo id="S3.E8.m1.1.4.10.1" stretchy="false">[</mo><mo id="S3.E8.m1.1.4.10.2" rspace="0.278em">:</mo><msub id="S3.E8.m1.1.4.10.3"><mi id="S3.E8.m1.1.4.10.3.2">x</mi><mi id="S3.E8.m1.1.4.10.3.3">i</mi></msub><mo id="S3.E8.m1.1.4.10.4" stretchy="false">]</mo></mrow><mo id="S3.E8.m1.1.4.11" stretchy="false">)</mo></mrow><mo id="S3.E8.m1.1.5" lspace="0em">.</mo></mrow><annotation encoding="application/x-tex" id="S3.E8.m1.1c">\max\sum\nolimits_{x_{i}\in X_{ans}}P_{LLM}(x_{i}|\phi(X_{retr}),X_{q},X_{ans}%
[:x_{i}]).</annotation><annotation encoding="application/x-llamapun" id="S3.E8.m1.1d">roman_max ∑ start_POSTSUBSCRIPT italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ italic_X start_POSTSUBSCRIPT italic_a italic_n italic_s end_POSTSUBSCRIPT end_POSTSUBSCRIPT italic_P start_POSTSUBSCRIPT italic_L italic_L italic_M end_POSTSUBSCRIPT ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_ϕ ( italic_X start_POSTSUBSCRIPT italic_r italic_e italic_t italic_r end_POSTSUBSCRIPT ) , italic_X start_POSTSUBSCRIPT italic_q end_POSTSUBSCRIPT , italic_X start_POSTSUBSCRIPT italic_a italic_n italic_s end_POSTSUBSCRIPT [ : italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ] ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS5.p1.10">Thanks to the second stage of training, the compressive encoder can be further enhanced to optimize the RAG performance.</p>
</div>
<div class="ltx_para" id="S3.SS5.p2">
<p class="ltx_p" id="S3.SS5.p2.1">The training process is further <span class="ltx_text ltx_font_bold" id="S3.SS5.p2.1.1">enhanced in two ways</span>. First, we introduce two-stream processing during pre-training. This involves encoding all chunks of each input at the very beginning (encoding stream) and then performing auto-regressive decoding based on the pre-encoded contexts (decoding stream). This approach allows for parallelized auto-regressive language modeling, making it more sample-efficient than traditional recurrent method <cite class="ltx_cite ltx_citemacro_citep">(Chevalier et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib6" title="">2023</a>)</cite>. Second, we randomly sample the compressive embeddings using a dynamic rate during training. In other words, selective compression is only made during inference. This approach lets the entire output of the encoder to be trained as compressive embeddings; meanwhile, it also enables the model to flexibly accommodate various compression ratios.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4. </span>Experiments</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">Our experiments are dedicated to the following research questions. <span class="ltx_text ltx_font_bold" id="S4.p1.1.1">RQ. 1</span> Can FlexRAG bring forth cost-effective compression results for general RAG tasks. <span class="ltx_text ltx_font_bold" id="S4.p1.1.2">RQ. 2</span> Can FlexRAG flexibly support diverse compression ratios and compression methods. <span class="ltx_text ltx_font_bold" id="S4.p1.1.3">RQ. 3</span> Extended analysis of various aspects, including FlexRAG’s robustness to different working conditions and the impact of each technical factor.</p>
</div>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1. </span>Settings</h3>
<section class="ltx_subsubsection" id="S4.SS1.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.1. </span>Datasets</h4>
<div class="ltx_para" id="S4.SS1.SSS1.p1">
<p class="ltx_p" id="S4.SS1.SSS1.p1.1">The experiments focus on evaluating RAG performance, where two types of tasks are used: Long-sequence Multi-doc QA (LMQA) and conventional Open-Domain QA (ODQA). For LMQA, the retrieved contexts consist of multiple long documents, whose entire length is usually longer than the LLM’s window size. We include the following datasets for LMQA: HoptpotQA, 2WikiMQA, Musique, where we use the curated version offered by LongBench <cite class="ltx_cite ltx_citemacro_citep">(Bai et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib3" title="">2023</a>)</cite>. The retrieved contexts have been well-presented in these datasets, thus no additional retriever is needed. For ODQA, the retrieved contexts consist of short passages from Wikipedia corpus, whose entire length is usually within the context window of LLM. We include the following datasets for ODQA: Natural Questions (NQ), PopQA, and TriviaQA, where we use the curated version offered by KILT <cite class="ltx_cite ltx_citemacro_citep">(Petroni et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib28" title="">2020</a>)</cite>. The retrieved contexts are not presented in these datasets, therefore, we employ various retrievers to undertake this role in our experiment. Following the requirements from LongBench and KILT, we use F1 and Exact Match (EM) as the metrics for LMQA and ODQA, respectively.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS1.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.2. </span>Baselines</h4>
<div class="ltx_para" id="S4.SS1.SSS2.p1">
<p class="ltx_p" id="S4.SS1.SSS2.p1.1">We make comparison with various types of popular baselines in our experiment. First, we introduce two methods which employ LLaMA-2-7B (chat) for question answering: 1) Llama (retrieval), which directly makes use of the retrieved contexts without compression, and Llama (w/o retrieval) which answers the question without using retrieved contexts. Second, we include two types of context compression methods. One is the context compression methods, which contains ICAE <cite class="ltx_cite ltx_citemacro_citep">(Ge et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib10" title="">2023</a>)</cite> and AutoCompressor <cite class="ltx_cite ltx_citemacro_citep">(Chevalier et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib6" title="">2023</a>)</cite>. Both methods generate summary vectors as the compressed inputs for RAG. The other one is the context filtering methods, including LLMLingua <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib15" title="">2023a</a>)</cite>, LongLLMLingua <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib16" title="">2023b</a>)</cite>, and TF-IDF (as implemented by Gist <cite class="ltx_cite ltx_citemacro_citep">(Mu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib24" title="">2024</a>)</cite>). These methods filtering important tokens from the retrieved contexts for RAG tasks.</p>
</div>
<figure class="ltx_table" id="S4.T1">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T1.8" style="width:433.6pt;height:122.3pt;vertical-align:-0.6pt;"><span class="ltx_transformed_inner" style="transform:translate(-168.1pt,47.2pt) scale(0.563304309270869,0.563304309270869) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T1.8.8">
<tr class="ltx_tr" id="S4.T1.8.8.9">
<td class="ltx_td ltx_border_r ltx_border_tt" id="S4.T1.8.8.9.1" style="padding-top:1.25pt;padding-bottom:1.25pt;"></td>
<td class="ltx_td ltx_border_r ltx_border_tt" id="S4.T1.8.8.9.2" style="padding-top:1.25pt;padding-bottom:1.25pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" colspan="4" id="S4.T1.8.8.9.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">LMQA</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="4" id="S4.T1.8.8.9.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">ODQA</td>
</tr>
<tr class="ltx_tr" id="S4.T1.8.8.10">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.8.8.10.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Method</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.8.8.10.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">CP. Ratio</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T1.8.8.10.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">HotpotQA</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T1.8.8.10.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">2WikiMQA</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T1.8.8.10.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">Musique</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T1.8.8.10.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">Average</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T1.8.8.10.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">NQ</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T1.8.8.10.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">PopQA</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T1.8.8.10.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">TriviaQA</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T1.8.8.10.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">Average</td>
</tr>
<tr class="ltx_tr" id="S4.T1.8.8.11">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.8.8.11.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Llama (w/o retrieval)</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.8.8.11.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">–</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.8.8.11.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">19.07</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.8.8.11.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">27.78</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.8.8.11.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">5.65</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.8.8.11.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">17.50</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.8.8.11.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">14.17</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.8.8.11.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">18.01</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.8.8.11.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">53.67</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.8.8.11.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">28.62</td>
</tr>
<tr class="ltx_tr" id="S4.T1.8.8.12">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T1.8.8.12.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Llama (w. retrieval)</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.8.8.12.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">–</td>
<td class="ltx_td ltx_align_center" id="S4.T1.8.8.12.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">27.20</td>
<td class="ltx_td ltx_align_center" id="S4.T1.8.8.12.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">32.21</td>
<td class="ltx_td ltx_align_center" id="S4.T1.8.8.12.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">7.61</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.8.8.12.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">22.34</td>
<td class="ltx_td ltx_align_center" id="S4.T1.8.8.12.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">25.13</td>
<td class="ltx_td ltx_align_center" id="S4.T1.8.8.12.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">31.04</td>
<td class="ltx_td ltx_align_center" id="S4.T1.8.8.12.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">55.59</td>
<td class="ltx_td ltx_align_center" id="S4.T1.8.8.12.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">37.25</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.1.1.1.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">ICAE <cite class="ltx_cite ltx_citemacro_citep">(Ge et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib10" title="">2023</a>)</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.1.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T1.1.1.1.1.m1.1"><semantics id="S4.T1.1.1.1.1.m1.1a"><mo id="S4.T1.1.1.1.1.m1.1.1" xref="S4.T1.1.1.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T1.1.1.1.1.m1.1b"><times id="S4.T1.1.1.1.1.m1.1.1.cmml" xref="S4.T1.1.1.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.1.1.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T1.1.1.1.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.1.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">19.56</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.1.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">25.07</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.1.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">5.73</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.1.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">16.79</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.1.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">10.53</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.1.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">4.44</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.1.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">8.21</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.1.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">7.73</td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.2.2">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T1.2.2.2.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">AutoCompressor <cite class="ltx_cite ltx_citemacro_citep">(Chevalier et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib6" title="">2023</a>)</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.2.2.2.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T1.2.2.2.1.m1.1"><semantics id="S4.T1.2.2.2.1.m1.1a"><mo id="S4.T1.2.2.2.1.m1.1.1" xref="S4.T1.2.2.2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T1.2.2.2.1.m1.1b"><times id="S4.T1.2.2.2.1.m1.1.1.cmml" xref="S4.T1.2.2.2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.2.2.2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T1.2.2.2.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.2.2.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">13.80</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.2.2.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">17.31</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.2.2.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">7.05</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.2.2.2.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">12.72</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.2.2.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">13.20</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.2.2.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">17.78</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.2.2.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">49.55</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.2.2.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">26.84</td>
</tr>
<tr class="ltx_tr" id="S4.T1.3.3.3">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T1.3.3.3.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">TF-IDF <cite class="ltx_cite ltx_citemacro_citep">(Mu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib24" title="">2024</a>)</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.3.3.3.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T1.3.3.3.1.m1.1"><semantics id="S4.T1.3.3.3.1.m1.1a"><mo id="S4.T1.3.3.3.1.m1.1.1" xref="S4.T1.3.3.3.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T1.3.3.3.1.m1.1b"><times id="S4.T1.3.3.3.1.m1.1.1.cmml" xref="S4.T1.3.3.3.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.3.3.3.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T1.3.3.3.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T1.3.3.3.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">19.20</td>
<td class="ltx_td ltx_align_center" id="S4.T1.3.3.3.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">24.77</td>
<td class="ltx_td ltx_align_center" id="S4.T1.3.3.3.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">6.28</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.3.3.3.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">16.75</td>
<td class="ltx_td ltx_align_center" id="S4.T1.3.3.3.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">11.49</td>
<td class="ltx_td ltx_align_center" id="S4.T1.3.3.3.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">14.05</td>
<td class="ltx_td ltx_align_center" id="S4.T1.3.3.3.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">46.73</td>
<td class="ltx_td ltx_align_center" id="S4.T1.3.3.3.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">24.09</td>
</tr>
<tr class="ltx_tr" id="S4.T1.4.4.4">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T1.4.4.4.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">LLMLingua <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib15" title="">2023a</a>)</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.4.4.4.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T1.4.4.4.1.m1.1"><semantics id="S4.T1.4.4.4.1.m1.1a"><mo id="S4.T1.4.4.4.1.m1.1.1" xref="S4.T1.4.4.4.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T1.4.4.4.1.m1.1b"><times id="S4.T1.4.4.4.1.m1.1.1.cmml" xref="S4.T1.4.4.4.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.4.4.4.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T1.4.4.4.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T1.4.4.4.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">21.07</td>
<td class="ltx_td ltx_align_center" id="S4.T1.4.4.4.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">26.40</td>
<td class="ltx_td ltx_align_center" id="S4.T1.4.4.4.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">5.46</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.4.4.4.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">17.64</td>
<td class="ltx_td ltx_align_center" id="S4.T1.4.4.4.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">10.22</td>
<td class="ltx_td ltx_align_center" id="S4.T1.4.4.4.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">11.92</td>
<td class="ltx_td ltx_align_center" id="S4.T1.4.4.4.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">35.75</td>
<td class="ltx_td ltx_align_center" id="S4.T1.4.4.4.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">19.30</td>
</tr>
<tr class="ltx_tr" id="S4.T1.5.5.5">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T1.5.5.5.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">LongLLMLingua <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib16" title="">2023b</a>)</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.5.5.5.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T1.5.5.5.1.m1.1"><semantics id="S4.T1.5.5.5.1.m1.1a"><mo id="S4.T1.5.5.5.1.m1.1.1" xref="S4.T1.5.5.5.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T1.5.5.5.1.m1.1b"><times id="S4.T1.5.5.5.1.m1.1.1.cmml" xref="S4.T1.5.5.5.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.5.5.5.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T1.5.5.5.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T1.5.5.5.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">21.55</td>
<td class="ltx_td ltx_align_center" id="S4.T1.5.5.5.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">24.77</td>
<td class="ltx_td ltx_align_center" id="S4.T1.5.5.5.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">7.15</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.5.5.5.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">17.82</td>
<td class="ltx_td ltx_align_center" id="S4.T1.5.5.5.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">18.15</td>
<td class="ltx_td ltx_align_center" id="S4.T1.5.5.5.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">22.74</td>
<td class="ltx_td ltx_align_center" id="S4.T1.5.5.5.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">52.77</td>
<td class="ltx_td ltx_align_center" id="S4.T1.5.5.5.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">31.22</td>
</tr>
<tr class="ltx_tr" id="S4.T1.6.6.6">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T1.6.6.6.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">LLMLingua-2 <cite class="ltx_cite ltx_citemacro_citep">(Pan et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib26" title="">2024</a>)</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.6.6.6.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T1.6.6.6.1.m1.1"><semantics id="S4.T1.6.6.6.1.m1.1a"><mo id="S4.T1.6.6.6.1.m1.1.1" xref="S4.T1.6.6.6.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T1.6.6.6.1.m1.1b"><times id="S4.T1.6.6.6.1.m1.1.1.cmml" xref="S4.T1.6.6.6.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.6.6.6.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T1.6.6.6.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T1.6.6.6.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">29.51</td>
<td class="ltx_td ltx_align_center" id="S4.T1.6.6.6.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">26.37</td>
<td class="ltx_td ltx_align_center" id="S4.T1.6.6.6.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">11.89</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.6.6.6.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">22.59</td>
<td class="ltx_td ltx_align_center" id="S4.T1.6.6.6.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">14.03</td>
<td class="ltx_td ltx_align_center" id="S4.T1.6.6.6.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">16.67</td>
<td class="ltx_td ltx_align_center" id="S4.T1.6.6.6.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">44.19</td>
<td class="ltx_td ltx_align_center" id="S4.T1.6.6.6.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">24.96</td>
</tr>
<tr class="ltx_tr" id="S4.T1.7.7.7">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.7.7.7.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">FlexRAG w/o SC.</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.7.7.7.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T1.7.7.7.1.m1.1"><semantics id="S4.T1.7.7.7.1.m1.1a"><mo id="S4.T1.7.7.7.1.m1.1.1" xref="S4.T1.7.7.7.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T1.7.7.7.1.m1.1b"><times id="S4.T1.7.7.7.1.m1.1.1.cmml" xref="S4.T1.7.7.7.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.7.7.7.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T1.7.7.7.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.7.7.7.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">33.81</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.7.7.7.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">38.76</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.7.7.7.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">12.56</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.7.7.7.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">28.38</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.7.7.7.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">31.44</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.7.7.7.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">24.55</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.7.7.7.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">65.07</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.7.7.7.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">40.35</td>
</tr>
<tr class="ltx_tr" id="S4.T1.8.8.8">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="S4.T1.8.8.8.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">FlexRAG w. SC.</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S4.T1.8.8.8.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T1.8.8.8.1.m1.1"><semantics id="S4.T1.8.8.8.1.m1.1a"><mo id="S4.T1.8.8.8.1.m1.1.1" xref="S4.T1.8.8.8.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T1.8.8.8.1.m1.1b"><times id="S4.T1.8.8.8.1.m1.1.1.cmml" xref="S4.T1.8.8.8.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T1.8.8.8.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T1.8.8.8.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.8.8.8.3" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.8.8.8.3.1">36.30</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.8.8.8.4" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.8.8.8.4.1">39.15</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.8.8.8.5" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.8.8.8.5.1">14.33</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S4.T1.8.8.8.6" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.8.8.8.6.1">29.93</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.8.8.8.7" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.8.8.8.7.1">33.45</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.8.8.8.8" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.8.8.8.8.1">35.96</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.8.8.8.9" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.8.8.8.9.1">66.71</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.8.8.8.10" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.8.8.8.10.1">45.37</span></td>
</tr>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1. </span>Cost-effectiveness Analysis on LMQA and ODQA (FlexRAG w. SC. stands for FlexRAG with selective compression).</figcaption>
</figure>
<figure class="ltx_table" id="S4.T2">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T2.5" style="width:433.6pt;height:157.6pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(68.2pt,-24.8pt) scale(1.45890626437461,1.45890626437461) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T2.5.5">
<tr class="ltx_tr" id="S4.T2.5.5.6">
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.5.5.6.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Model</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.5.5.6.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">CP. Ratio</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.5.5.6.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">EM</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.5.5.6.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">CUDA Time (s)</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.5.5.6.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">TFLOPs</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.1.1">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.1.1.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">Llama (w.r.)</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.1.1.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">1 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T2.1.1.1.1.m1.1"><semantics id="S4.T2.1.1.1.1.m1.1a"><mo id="S4.T2.1.1.1.1.m1.1.1" xref="S4.T2.1.1.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T2.1.1.1.1.m1.1b"><times id="S4.T2.1.1.1.1.m1.1.1.cmml" xref="S4.T2.1.1.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.1.1.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T2.1.1.1.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.1.1.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">37.25</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.1.1.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">7.78</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.1.1.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">14.17</td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.2.2">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T2.2.2.2.2" rowspan="4" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T2.2.2.2.2.1">FlexRAG</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.2.2.2.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">2 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T2.2.2.2.1.m1.1"><semantics id="S4.T2.2.2.2.1.m1.1a"><mo id="S4.T2.2.2.2.1.m1.1.1" xref="S4.T2.2.2.2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T2.2.2.2.1.m1.1b"><times id="S4.T2.2.2.2.1.m1.1.1.cmml" xref="S4.T2.2.2.2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.2.2.2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T2.2.2.2.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.2.2.2.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">47.23</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.2.2.2.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">4.97</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.2.2.2.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">10.48</td>
</tr>
<tr class="ltx_tr" id="S4.T2.3.3.3">
<td class="ltx_td ltx_align_center" id="S4.T2.3.3.3.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">4 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T2.3.3.3.1.m1.1"><semantics id="S4.T2.3.3.3.1.m1.1a"><mo id="S4.T2.3.3.3.1.m1.1.1" xref="S4.T2.3.3.3.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T2.3.3.3.1.m1.1b"><times id="S4.T2.3.3.3.1.m1.1.1.cmml" xref="S4.T2.3.3.3.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.3.3.3.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T2.3.3.3.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T2.3.3.3.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">47.25</td>
<td class="ltx_td ltx_align_center" id="S4.T2.3.3.3.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">3.13</td>
<td class="ltx_td ltx_align_center" id="S4.T2.3.3.3.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">7.03</td>
</tr>
<tr class="ltx_tr" id="S4.T2.4.4.4">
<td class="ltx_td ltx_align_center" id="S4.T2.4.4.4.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T2.4.4.4.1.m1.1"><semantics id="S4.T2.4.4.4.1.m1.1a"><mo id="S4.T2.4.4.4.1.m1.1.1" xref="S4.T2.4.4.4.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T2.4.4.4.1.m1.1b"><times id="S4.T2.4.4.4.1.m1.1.1.cmml" xref="S4.T2.4.4.4.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.4.4.4.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T2.4.4.4.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T2.4.4.4.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">45.37</td>
<td class="ltx_td ltx_align_center" id="S4.T2.4.4.4.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">2.48</td>
<td class="ltx_td ltx_align_center" id="S4.T2.4.4.4.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">5.39</td>
</tr>
<tr class="ltx_tr" id="S4.T2.5.5.5">
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.5.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">16 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T2.5.5.5.1.m1.1"><semantics id="S4.T2.5.5.5.1.m1.1a"><mo id="S4.T2.5.5.5.1.m1.1.1" xref="S4.T2.5.5.5.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T2.5.5.5.1.m1.1b"><times id="S4.T2.5.5.5.1.m1.1.1.cmml" xref="S4.T2.5.5.5.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.5.5.5.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T2.5.5.5.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.5.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">38.93</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.5.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">2.20</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.5.5.5.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">4.59</td>
</tr>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 2. </span>Efficiency analysis using CUDA Time and TFLOPs. Compression ratios are varied from 2<math alttext="\times" class="ltx_Math" display="inline" id="S4.T2.8.m1.1"><semantics id="S4.T2.8.m1.1b"><mo id="S4.T2.8.m1.1.1" xref="S4.T2.8.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T2.8.m1.1c"><times id="S4.T2.8.m1.1.1.cmml" xref="S4.T2.8.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.8.m1.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T2.8.m1.1e">×</annotation></semantics></math> to 16<math alttext="\times" class="ltx_Math" display="inline" id="S4.T2.9.m2.1"><semantics id="S4.T2.9.m2.1b"><mo id="S4.T2.9.m2.1.1" xref="S4.T2.9.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T2.9.m2.1c"><times id="S4.T2.9.m2.1.1.cmml" xref="S4.T2.9.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.9.m2.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T2.9.m2.1e">×</annotation></semantics></math>.
Experiments are performed on ODQA with EM as the quality metric.</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S4.SS1.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.3. </span>Implementations</h4>
<div class="ltx_para" id="S4.SS1.SSS3.p1">
<p class="ltx_p" id="S4.SS1.SSS3.p1.1">We initialize FlexRAG with the first 8 layers of LLaMA-2-7B (chat), and
we leverage LLaMA-2-7B (chat) <cite class="ltx_cite ltx_citemacro_citep">(Touvron et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib35" title="">2023</a>)</cite> as our downstream LLM. This ensures a fair comparison with the baselines and maintains the economical running of the experiments. The pre-traininig is performed with 90K sampled instances from Redpajama <cite class="ltx_cite ltx_citemacro_citep">(Computer, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib7" title="">2023</a>)</cite> and 10K training instances from LongAlpaca <cite class="ltx_cite ltx_citemacro_citep">(Chen et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib5" title="">2023</a>)</cite>, while the fine-tuning is performed with 10K sampled instances from a blend of HotpotQA <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib43" title="">2018</a>)</cite> and Natural Questions dataset <cite class="ltx_cite ltx_citemacro_citep">(Kwiatkowski et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib18" title="">2019</a>)</cite>. During training, the compression ratios are randomly sampled from 1, 2, 4, and 8. The training takes place on a Nvidia 8×A800 GPU machine. By default, we use BGE-EN-large <cite class="ltx_cite ltx_citemacro_citep">(Xiao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib40" title="">2023</a>)</cite> as the retriever, where the top-5 documents are returned during the testing stage. Meanwhile, FlexRAG’s compression is made by sentence-level importance estimation and selection.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2. </span>Cost-Effectiveness Analysis</h3>
<section class="ltx_subsubsection" id="S4.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.2.1. </span>Primary results</h4>
<div class="ltx_para" id="S4.SS2.SSS1.p1">
<p class="ltx_p" id="S4.SS2.SSS1.p1.1">We first evaluate the primary question answering performance under the default setting, where a uniform compression ratio (CP. Ratio) of 8<math alttext="\times" class="ltx_Math" display="inline" id="S4.SS2.SSS1.p1.1.m1.1"><semantics id="S4.SS2.SSS1.p1.1.m1.1a"><mo id="S4.SS2.SSS1.p1.1.m1.1.1" xref="S4.SS2.SSS1.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS1.p1.1.m1.1b"><times id="S4.SS2.SSS1.p1.1.m1.1.1.cmml" xref="S4.SS2.SSS1.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS1.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS1.p1.1.m1.1d">×</annotation></semantics></math> is applied. For LMQA, all retrieved contexts are confined within 32K tokens, allowing them to be fully utilized by the downstream LLM after compression. In contrast, Llama (w. retrieval) must truncate the retrieved contexts to fit within the 4K window of Llama-2, as implemented by Longbench <cite class="ltx_cite ltx_citemacro_citep">(Bai et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib3" title="">2023</a>)</cite>. We compare two variants of our method: FlexRAG w/o SC, which disables selective compression and uniformly down-samples the retrieved contexts at an interval of 8 tokens, and FlexRAG w. SC, the default method using selective compression. The following observations can be drawn from the experiment results in Table <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.T1" title="Table 1 ‣ 4.1.2. Baselines ‣ 4.1. Settings ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">1</span></a>.</p>
</div>
<div class="ltx_para" id="S4.SS2.SSS1.p2">
<p class="ltx_p" id="S4.SS2.SSS1.p2.1">First, FlexRAG demonstrates superior performance in the experiment. Even without using selective compression, FlexRAG w/o SC already outperforms all baselines with notable advantages. With the enhancement from selective compression, FlexRAG’s performance is further improved, which leads to the optimal question answering quality across all datasets. The above result preliminarily validates the effectiveness FlexRAG, indicating that the context compression and RAG optimization are realized simultaneously.</p>
</div>
<div class="ltx_para" id="S4.SS2.SSS1.p3">
<p class="ltx_p" id="S4.SS2.SSS1.p3.1">Second, FlexRAG’s effectiveness is more pronounced on ODQA tasks, whose retrieved contexts are much shorter than those from LMQA, e.g., it notably improves upon the best of the compression baselines (LongLLMLingual) from 18.15 to 33.45 on PopQA. This is because when retrieved contexts are concise, they are more likely to suffer from information loss once compressed. It is a more challenging task to handle the compression on ODQA, and the increased challenge expands the gap between FlexRAG and baselines.</p>
</div>
<div class="ltx_para" id="S4.SS2.SSS1.p4">
<p class="ltx_p" id="S4.SS2.SSS1.p4.1">Third, Llama (w. retrieval) falls behind many compression baselines in LMQA, whereas it outperforms all of them in ODQA. As mentioned, the compression baselines can fully leverage the retrieved contexts with a uniform compression ratio 8<math alttext="\times" class="ltx_Math" display="inline" id="S4.SS2.SSS1.p4.1.m1.1"><semantics id="S4.SS2.SSS1.p4.1.m1.1a"><mo id="S4.SS2.SSS1.p4.1.m1.1.1" xref="S4.SS2.SSS1.p4.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS1.p4.1.m1.1b"><times id="S4.SS2.SSS1.p4.1.m1.1.1.cmml" xref="S4.SS2.SSS1.p4.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS1.p4.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS1.p4.1.m1.1d">×</annotation></semantics></math>; while Llama (w. retrieval) has to truncate the retrieved contexts, which incurs information. However, the retrieved context is concise on ODQA, where no truncation is needed for Llama (w. retrieval); by comparison, the compression baselines will not leverage any extra information, but suffer from the information loss caused by compression.</p>
</div>
<figure class="ltx_table" id="S4.T3">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T3.7" style="width:433.6pt;height:153.5pt;vertical-align:-0.8pt;"><span class="ltx_transformed_inner" style="transform:translate(-64.4pt,22.7pt) scale(0.770992866984134,0.770992866984134) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T3.7.7">
<tr class="ltx_tr" id="S4.T3.7.7.8">
<td class="ltx_td ltx_border_r ltx_border_tt" id="S4.T3.7.7.8.1" style="padding-top:1.25pt;padding-bottom:1.25pt;"></td>
<td class="ltx_td ltx_border_r ltx_border_tt" id="S4.T3.7.7.8.2" style="padding-top:1.25pt;padding-bottom:1.25pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" colspan="4" id="S4.T3.7.7.8.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">LMQA</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="4" id="S4.T3.7.7.8.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">ODQA</td>
</tr>
<tr class="ltx_tr" id="S4.T3.7.7.9">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.7.7.9.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Method</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.7.7.9.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">CP. Ratio</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.9.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">HotpotQA</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.9.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">2WikiMQA</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.9.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">Musique</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.7.7.9.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">Average</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.9.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">NQ</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.9.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">PopQA</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.9.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">TriviaQA</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.9.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">Average</td>
</tr>
<tr class="ltx_tr" id="S4.T3.7.7.10">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.7.7.10.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Llama (w/o retrieval)</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.7.7.10.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">–</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.10.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">19.07</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.10.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">27.78</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.10.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">5.65</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.7.7.10.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">17.50</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.10.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">14.17</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.10.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">18.01</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.10.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">53.67</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.7.7.10.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">28.62</td>
</tr>
<tr class="ltx_tr" id="S4.T3.7.7.11">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.7.7.11.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Llama (w. retrieval)</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.7.7.11.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">–</td>
<td class="ltx_td ltx_align_center" id="S4.T3.7.7.11.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">27.20</td>
<td class="ltx_td ltx_align_center" id="S4.T3.7.7.11.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">32.21</td>
<td class="ltx_td ltx_align_center" id="S4.T3.7.7.11.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">7.61</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.7.7.11.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">22.34</td>
<td class="ltx_td ltx_align_center" id="S4.T3.7.7.11.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">25.13</td>
<td class="ltx_td ltx_align_center" id="S4.T3.7.7.11.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">31.04</td>
<td class="ltx_td ltx_align_center" id="S4.T3.7.7.11.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">55.59</td>
<td class="ltx_td ltx_align_center" id="S4.T3.7.7.11.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">37.25</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.1.1.1.2" rowspan="4" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T3.1.1.1.2.1">FlexRAG w/o SC.</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.1.1.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">1 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.1.1.1.1.m1.1"><semantics id="S4.T3.1.1.1.1.m1.1a"><mo id="S4.T3.1.1.1.1.m1.1.1" xref="S4.T3.1.1.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.1.1.1.1.m1.1b"><times id="S4.T3.1.1.1.1.m1.1.1.cmml" xref="S4.T3.1.1.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.1.1.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.1.1.1.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">30.83</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">35.01</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">12.86</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.1.1.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">26.23</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">37.01</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">33.92</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">66.93</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">45.95</td>
</tr>
<tr class="ltx_tr" id="S4.T3.2.2.2">
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.2.2.2.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">2 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.2.2.2.1.m1.1"><semantics id="S4.T3.2.2.2.1.m1.1a"><mo id="S4.T3.2.2.2.1.m1.1.1" xref="S4.T3.2.2.2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.2.2.2.1.m1.1b"><times id="S4.T3.2.2.2.1.m1.1.1.cmml" xref="S4.T3.2.2.2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.2.2.2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.2.2.2.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">32.06</td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">35.72</td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">12.02</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.2.2.2.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">26.60</td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">36.62</td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">31.03</td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">67.74</td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">45.13</td>
</tr>
<tr class="ltx_tr" id="S4.T3.3.3.3">
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.3.3.3.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">4 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.3.3.3.1.m1.1"><semantics id="S4.T3.3.3.3.1.m1.1a"><mo id="S4.T3.3.3.3.1.m1.1.1" xref="S4.T3.3.3.3.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.3.3.3.1.m1.1b"><times id="S4.T3.3.3.3.1.m1.1.1.cmml" xref="S4.T3.3.3.3.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.3.3.3.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.3.3.3.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T3.3.3.3.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">31.23</td>
<td class="ltx_td ltx_align_center" id="S4.T3.3.3.3.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">34.19</td>
<td class="ltx_td ltx_align_center" id="S4.T3.3.3.3.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">11.83</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.3.3.3.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">25.75</td>
<td class="ltx_td ltx_align_center" id="S4.T3.3.3.3.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">35.28</td>
<td class="ltx_td ltx_align_center" id="S4.T3.3.3.3.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">28.09</td>
<td class="ltx_td ltx_align_center" id="S4.T3.3.3.3.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">67.10</td>
<td class="ltx_td ltx_align_center" id="S4.T3.3.3.3.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">43.49</td>
</tr>
<tr class="ltx_tr" id="S4.T3.4.4.4">
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.4.4.4.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.4.4.4.1.m1.1"><semantics id="S4.T3.4.4.4.1.m1.1a"><mo id="S4.T3.4.4.4.1.m1.1.1" xref="S4.T3.4.4.4.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.4.4.4.1.m1.1b"><times id="S4.T3.4.4.4.1.m1.1.1.cmml" xref="S4.T3.4.4.4.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.4.4.4.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.4.4.4.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">33.81</td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">38.76</td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">12.56</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.4.4.4.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">28.38</td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">31.44</td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">24.55</td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">65.07</td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">40.35</td>
</tr>
<tr class="ltx_tr" id="S4.T3.5.5.5">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r ltx_border_t" id="S4.T3.5.5.5.2" rowspan="3" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T3.5.5.5.2.1">FlexRAG w. SC.</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.5.5.5.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">2 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.5.5.5.1.m1.1"><semantics id="S4.T3.5.5.5.1.m1.1a"><mo id="S4.T3.5.5.5.1.m1.1.1" xref="S4.T3.5.5.5.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.5.5.5.1.m1.1b"><times id="S4.T3.5.5.5.1.m1.1.1.cmml" xref="S4.T3.5.5.5.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.5.5.5.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.5.5.5.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">34.31</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">37.41</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">13.28</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.5.5.5.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">28.33</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.7" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.5.5.5.7.1">37.19</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">36.10</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">68.41</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">47.23</td>
</tr>
<tr class="ltx_tr" id="S4.T3.6.6.6">
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.6.6.6.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">4 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.6.6.6.1.m1.1"><semantics id="S4.T3.6.6.6.1.m1.1a"><mo id="S4.T3.6.6.6.1.m1.1.1" xref="S4.T3.6.6.6.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.6.6.6.1.m1.1b"><times id="S4.T3.6.6.6.1.m1.1.1.cmml" xref="S4.T3.6.6.6.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.6.6.6.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.6.6.6.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.6.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">35.06</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.6.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">36.40</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.6.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">14.93</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.6.6.6.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">28.80</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.6.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">36.02</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.6.7" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.6.7.1">37.15</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.6.8" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.6.8.1">68.59</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.6.9" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.6.9.1">47.25</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.7.7.7">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S4.T3.7.7.7.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.7.7.7.1.m1.1"><semantics id="S4.T3.7.7.7.1.m1.1a"><mo id="S4.T3.7.7.7.1.m1.1.1" xref="S4.T3.7.7.7.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.7.7.7.1.m1.1b"><times id="S4.T3.7.7.7.1.m1.1.1.cmml" xref="S4.T3.7.7.7.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.7.7.7.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.7.7.7.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.7.7.7.2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.7.7.7.2.1">36.30</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.7.7.7.3" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.7.7.7.3.1">39.15</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.7.7.7.4" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.7.7.7.4.1">14.33</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S4.T3.7.7.7.5" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.7.7.7.5.1">29.93</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.7.7.7.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">33.45</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.7.7.7.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">35.96</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.7.7.7.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">66.71</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.7.7.7.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">45.37</td>
</tr>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 3. </span>Flexibility analysis on LMQA and ODQA using different compression ratios (1<math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.12.m1.1"><semantics id="S4.T3.12.m1.1b"><mo id="S4.T3.12.m1.1.1" xref="S4.T3.12.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.12.m1.1c"><times id="S4.T3.12.m1.1.1.cmml" xref="S4.T3.12.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.12.m1.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.12.m1.1e">×</annotation></semantics></math>, 2<math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.13.m2.1"><semantics id="S4.T3.13.m2.1b"><mo id="S4.T3.13.m2.1.1" xref="S4.T3.13.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.13.m2.1c"><times id="S4.T3.13.m2.1.1.cmml" xref="S4.T3.13.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.13.m2.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.13.m2.1e">×</annotation></semantics></math>, 4<math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.14.m3.1"><semantics id="S4.T3.14.m3.1b"><mo id="S4.T3.14.m3.1.1" xref="S4.T3.14.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.14.m3.1c"><times id="S4.T3.14.m3.1.1.cmml" xref="S4.T3.14.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.14.m3.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.14.m3.1e">×</annotation></semantics></math>, 8<math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.15.m4.1"><semantics id="S4.T3.15.m4.1b"><mo id="S4.T3.15.m4.1.1" xref="S4.T3.15.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.15.m4.1c"><times id="S4.T3.15.m4.1.1.cmml" xref="S4.T3.15.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.15.m4.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.15.m4.1e">×</annotation></semantics></math>).</figcaption>
</figure>
<figure class="ltx_table" id="S4.T4">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T4.17" style="width:433.6pt;height:102.4pt;vertical-align:-0.8pt;"><span class="ltx_transformed_inner" style="transform:translate(-51.9pt,12.2pt) scale(0.806733546325806,0.806733546325806) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T4.17.17">
<tr class="ltx_tr" id="S4.T4.17.17.18">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.17.17.18.1" rowspan="2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T4.17.17.18.1.1">Method</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.17.17.18.2" rowspan="2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T4.17.17.18.2.1">Estimator</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.17.17.18.3" rowspan="2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T4.17.17.18.3.1">HP. Prop.</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" colspan="3" id="S4.T4.17.17.18.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">Compression Ratio</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="4" id="S4.T4.17.17.18.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">LMQA</td>
</tr>
<tr class="ltx_tr" id="S4.T4.17.17.19">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.17.17.19.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">HP.</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.17.17.19.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">LP.</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.17.17.19.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">Overall</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.17.17.19.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">HotpotQA</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.17.17.19.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">2WikiMQA</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.17.17.19.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">Musique</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.17.17.19.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">Average</td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.1.1">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.1.1.1.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">Token w/o SC</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.1.1.1.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">Uniform</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.1.1.1.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">N.A.</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.1.1.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">N.A.</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.1.1.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">N.A.</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.1.1.1.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.1.1.1.1.m1.1"><semantics id="S4.T4.1.1.1.1.m1.1a"><mo id="S4.T4.1.1.1.1.m1.1.1" xref="S4.T4.1.1.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.1.1.1.1.m1.1b"><times id="S4.T4.1.1.1.1.m1.1.1.cmml" xref="S4.T4.1.1.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.1.1.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.1.1.1.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.1.1.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">33.81</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.1.1.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">38.76</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.1.1.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">12.56</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.1.1.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">28.38</td>
</tr>
<tr class="ltx_tr" id="S4.T4.5.5.5">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.5.5.5.5" rowspan="2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T4.5.5.5.5.1">Token w. SC</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.5.5.5.6" rowspan="2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T4.5.5.5.6.1">Likelihood</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="S4.T4.5.5.5.7" rowspan="4" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T4.5.5.5.7.1">1: 16</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.2.2.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">1 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.2.2.2.1.m1.1"><semantics id="S4.T4.2.2.2.1.m1.1a"><mo id="S4.T4.2.2.2.1.m1.1.1" xref="S4.T4.2.2.2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.2.2.2.1.m1.1b"><times id="S4.T4.2.2.2.1.m1.1.1.cmml" xref="S4.T4.2.2.2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.2.2.2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.2.2.2.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.4.4.4.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">
<math alttext="\sim" class="ltx_Math" display="inline" id="S4.T4.3.3.3.2.m1.1"><semantics id="S4.T4.3.3.3.2.m1.1a"><mo id="S4.T4.3.3.3.2.m1.1.1" xref="S4.T4.3.3.3.2.m1.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S4.T4.3.3.3.2.m1.1b"><csymbol cd="latexml" id="S4.T4.3.3.3.2.m1.1.1.cmml" xref="S4.T4.3.3.3.2.m1.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.3.3.3.2.m1.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S4.T4.3.3.3.2.m1.1d">∼</annotation></semantics></math> 16 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.4.4.4.3.m2.1"><semantics id="S4.T4.4.4.4.3.m2.1a"><mo id="S4.T4.4.4.4.3.m2.1.1" xref="S4.T4.4.4.4.3.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.4.4.4.3.m2.1b"><times id="S4.T4.4.4.4.3.m2.1.1.cmml" xref="S4.T4.4.4.4.3.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.4.4.4.3.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.4.4.4.3.m2.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.5.5.5.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.5.5.5.4.m1.1"><semantics id="S4.T4.5.5.5.4.m1.1a"><mo id="S4.T4.5.5.5.4.m1.1.1" xref="S4.T4.5.5.5.4.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.5.5.5.4.m1.1b"><times id="S4.T4.5.5.5.4.m1.1.1.cmml" xref="S4.T4.5.5.5.4.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.5.5.5.4.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.5.5.5.4.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.5.5.5.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">33.18</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.5.5.5.9" style="padding-top:1.25pt;padding-bottom:1.25pt;">37.80</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.5.5.5.10" style="padding-top:1.25pt;padding-bottom:1.25pt;">11.82</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.5.5.5.11" style="padding-top:1.25pt;padding-bottom:1.25pt;">27.60</td>
</tr>
<tr class="ltx_tr" id="S4.T4.9.9.9">
<td class="ltx_td ltx_align_center" id="S4.T4.6.6.6.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">2 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.6.6.6.1.m1.1"><semantics id="S4.T4.6.6.6.1.m1.1a"><mo id="S4.T4.6.6.6.1.m1.1.1" xref="S4.T4.6.6.6.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.6.6.6.1.m1.1b"><times id="S4.T4.6.6.6.1.m1.1.1.cmml" xref="S4.T4.6.6.6.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.6.6.6.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.6.6.6.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T4.8.8.8.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">
<math alttext="\sim" class="ltx_Math" display="inline" id="S4.T4.7.7.7.2.m1.1"><semantics id="S4.T4.7.7.7.2.m1.1a"><mo id="S4.T4.7.7.7.2.m1.1.1" xref="S4.T4.7.7.7.2.m1.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S4.T4.7.7.7.2.m1.1b"><csymbol cd="latexml" id="S4.T4.7.7.7.2.m1.1.1.cmml" xref="S4.T4.7.7.7.2.m1.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.7.7.7.2.m1.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S4.T4.7.7.7.2.m1.1d">∼</annotation></semantics></math> 11 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.8.8.8.3.m2.1"><semantics id="S4.T4.8.8.8.3.m2.1a"><mo id="S4.T4.8.8.8.3.m2.1.1" xref="S4.T4.8.8.8.3.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.8.8.8.3.m2.1b"><times id="S4.T4.8.8.8.3.m2.1.1.cmml" xref="S4.T4.8.8.8.3.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.8.8.8.3.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.8.8.8.3.m2.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.9.9.9.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.9.9.9.4.m1.1"><semantics id="S4.T4.9.9.9.4.m1.1a"><mo id="S4.T4.9.9.9.4.m1.1.1" xref="S4.T4.9.9.9.4.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.9.9.9.4.m1.1b"><times id="S4.T4.9.9.9.4.m1.1.1.cmml" xref="S4.T4.9.9.9.4.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.9.9.9.4.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.9.9.9.4.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center" id="S4.T4.9.9.9.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">35.17</td>
<td class="ltx_td ltx_align_center" id="S4.T4.9.9.9.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">38.60</td>
<td class="ltx_td ltx_align_center" id="S4.T4.9.9.9.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">11.84</td>
<td class="ltx_td ltx_align_center" id="S4.T4.9.9.9.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">28.54</td>
</tr>
<tr class="ltx_tr" id="S4.T4.13.13.13">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="S4.T4.13.13.13.5" rowspan="2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T4.13.13.13.5.1">Sentence w. SC</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="S4.T4.13.13.13.6" rowspan="2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T4.13.13.13.6.1">Embedding</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.10.10.10.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">1 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.10.10.10.1.m1.1"><semantics id="S4.T4.10.10.10.1.m1.1a"><mo id="S4.T4.10.10.10.1.m1.1.1" xref="S4.T4.10.10.10.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.10.10.10.1.m1.1b"><times id="S4.T4.10.10.10.1.m1.1.1.cmml" xref="S4.T4.10.10.10.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.10.10.10.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.10.10.10.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.12.12.12.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">
<math alttext="\sim" class="ltx_Math" display="inline" id="S4.T4.11.11.11.2.m1.1"><semantics id="S4.T4.11.11.11.2.m1.1a"><mo id="S4.T4.11.11.11.2.m1.1.1" xref="S4.T4.11.11.11.2.m1.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S4.T4.11.11.11.2.m1.1b"><csymbol cd="latexml" id="S4.T4.11.11.11.2.m1.1.1.cmml" xref="S4.T4.11.11.11.2.m1.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.11.11.11.2.m1.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S4.T4.11.11.11.2.m1.1d">∼</annotation></semantics></math> 16 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.12.12.12.3.m2.1"><semantics id="S4.T4.12.12.12.3.m2.1a"><mo id="S4.T4.12.12.12.3.m2.1.1" xref="S4.T4.12.12.12.3.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.12.12.12.3.m2.1b"><times id="S4.T4.12.12.12.3.m2.1.1.cmml" xref="S4.T4.12.12.12.3.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.12.12.12.3.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.12.12.12.3.m2.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.13.13.13.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.13.13.13.4.m1.1"><semantics id="S4.T4.13.13.13.4.m1.1a"><mo id="S4.T4.13.13.13.4.m1.1.1" xref="S4.T4.13.13.13.4.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.13.13.13.4.m1.1b"><times id="S4.T4.13.13.13.4.m1.1.1.cmml" xref="S4.T4.13.13.13.4.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.13.13.13.4.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.13.13.13.4.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.13.13.13.7" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.13.13.13.7.1">36.30</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.13.13.13.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">39.15</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.13.13.13.9" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.13.13.13.9.1">14.33</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.13.13.13.10" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.13.13.13.10.1">29.93</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.17.17.17">
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.14.14.14.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">2 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.14.14.14.1.m1.1"><semantics id="S4.T4.14.14.14.1.m1.1a"><mo id="S4.T4.14.14.14.1.m1.1.1" xref="S4.T4.14.14.14.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.14.14.14.1.m1.1b"><times id="S4.T4.14.14.14.1.m1.1.1.cmml" xref="S4.T4.14.14.14.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.14.14.14.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.14.14.14.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.16.16.16.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">
<math alttext="\sim" class="ltx_Math" display="inline" id="S4.T4.15.15.15.2.m1.1"><semantics id="S4.T4.15.15.15.2.m1.1a"><mo id="S4.T4.15.15.15.2.m1.1.1" xref="S4.T4.15.15.15.2.m1.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S4.T4.15.15.15.2.m1.1b"><csymbol cd="latexml" id="S4.T4.15.15.15.2.m1.1.1.cmml" xref="S4.T4.15.15.15.2.m1.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.15.15.15.2.m1.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S4.T4.15.15.15.2.m1.1d">∼</annotation></semantics></math> 11 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.16.16.16.3.m2.1"><semantics id="S4.T4.16.16.16.3.m2.1a"><mo id="S4.T4.16.16.16.3.m2.1.1" xref="S4.T4.16.16.16.3.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.16.16.16.3.m2.1b"><times id="S4.T4.16.16.16.3.m2.1.1.cmml" xref="S4.T4.16.16.16.3.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.16.16.16.3.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.16.16.16.3.m2.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S4.T4.17.17.17.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">8 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T4.17.17.17.4.m1.1"><semantics id="S4.T4.17.17.17.4.m1.1a"><mo id="S4.T4.17.17.17.4.m1.1.1" xref="S4.T4.17.17.17.4.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T4.17.17.17.4.m1.1b"><times id="S4.T4.17.17.17.4.m1.1.1.cmml" xref="S4.T4.17.17.17.4.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.17.17.17.4.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T4.17.17.17.4.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.17.17.17.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">35.70</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.17.17.17.6" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.17.17.17.6.1">39.96</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.17.17.17.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">12.52</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.17.17.17.8" style="padding-top:1.25pt;padding-bottom:1.25pt;">29.39</td>
</tr>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 4. </span>Flexibility Analysis on LMQA using different importance estimators and compression ratios (HP/LP: high-priority / low-priority contexts. In our experiment, the top 1/16 (1:16) of the retrieved contexts are allocated with the high priority).</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S4.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.2.2. </span>Efficiency</h4>
<div class="ltx_para" id="S4.SS2.SSS2.p1">
<p class="ltx_p" id="S4.SS2.SSS2.p1.2">We further explore the efficiency of FlexRAG using Torch Profiler <cite class="ltx_cite ltx_citemacro_citep">(Torch, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib34" title="">2024</a>)</cite>.
The evaluation takes place on one NVIDIA A800 GPU, with a batch size of 8 with BF16 precision. FlexRAG is compared with Llama (w. retrieval), where both methods employ the identical input and output lengths. The experiment is conducted with the ODQA datasets, where EM is the quality metric. The compression ratio is varied from 2<math alttext="\times" class="ltx_Math" display="inline" id="S4.SS2.SSS2.p1.1.m1.1"><semantics id="S4.SS2.SSS2.p1.1.m1.1a"><mo id="S4.SS2.SSS2.p1.1.m1.1.1" xref="S4.SS2.SSS2.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS2.p1.1.m1.1b"><times id="S4.SS2.SSS2.p1.1.m1.1.1.cmml" xref="S4.SS2.SSS2.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS2.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS2.p1.1.m1.1d">×</annotation></semantics></math> to 8<math alttext="\times" class="ltx_Math" display="inline" id="S4.SS2.SSS2.p1.2.m2.1"><semantics id="S4.SS2.SSS2.p1.2.m2.1a"><mo id="S4.SS2.SSS2.p1.2.m2.1.1" xref="S4.SS2.SSS2.p1.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS2.p1.2.m2.1b"><times id="S4.SS2.SSS2.p1.2.m2.1.1.cmml" xref="S4.SS2.SSS2.p1.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS2.p1.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS2.p1.2.m2.1d">×</annotation></semantics></math> for FlexRAG.</p>
</div>
<div class="ltx_para" id="S4.SS2.SSS2.p2">
<p class="ltx_p" id="S4.SS2.SSS2.p2.4">As shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.T2" title="Table 2 ‣ 4.1.2. Baselines ‣ 4.1. Settings ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">2</span></a>, FlexRAG is faster than Llama (w.r.) while improving the RAG’s performance simultaneously. With the increasing of compression ratio, FlexRAG becomes even faster, leading to 3.54<math alttext="\times" class="ltx_Math" display="inline" id="S4.SS2.SSS2.p2.1.m1.1"><semantics id="S4.SS2.SSS2.p2.1.m1.1a"><mo id="S4.SS2.SSS2.p2.1.m1.1.1" xref="S4.SS2.SSS2.p2.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS2.p2.1.m1.1b"><times id="S4.SS2.SSS2.p2.1.m1.1.1.cmml" xref="S4.SS2.SSS2.p2.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS2.p2.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS2.p2.1.m1.1d">×</annotation></semantics></math> reduction in CUDA time and 3.09<math alttext="\times" class="ltx_Math" display="inline" id="S4.SS2.SSS2.p2.2.m2.1"><semantics id="S4.SS2.SSS2.p2.2.m2.1a"><mo id="S4.SS2.SSS2.p2.2.m2.1.1" xref="S4.SS2.SSS2.p2.2.m2.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS2.p2.2.m2.1b"><times id="S4.SS2.SSS2.p2.2.m2.1.1.cmml" xref="S4.SS2.SSS2.p2.2.m2.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS2.p2.2.m2.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS2.p2.2.m2.1d">×</annotation></semantics></math> reduction in TFLOPs at a 16<math alttext="\times" class="ltx_Math" display="inline" id="S4.SS2.SSS2.p2.3.m3.1"><semantics id="S4.SS2.SSS2.p2.3.m3.1a"><mo id="S4.SS2.SSS2.p2.3.m3.1.1" xref="S4.SS2.SSS2.p2.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS2.p2.3.m3.1b"><times id="S4.SS2.SSS2.p2.3.m3.1.1.cmml" xref="S4.SS2.SSS2.p2.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS2.p2.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS2.p2.3.m3.1d">×</annotation></semantics></math> compression ratio. Moreover, FlexRAG substantially improves upon Llama (w.r.) in terms of RAG quality, achieving a 10% improvement in ODQA datasets at a 4<math alttext="\times" class="ltx_Math" display="inline" id="S4.SS2.SSS2.p2.4.m4.1"><semantics id="S4.SS2.SSS2.p2.4.m4.1a"><mo id="S4.SS2.SSS2.p2.4.m4.1.1" xref="S4.SS2.SSS2.p2.4.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS2.p2.4.m4.1b"><times id="S4.SS2.SSS2.p2.4.m4.1.1.cmml" xref="S4.SS2.SSS2.p2.4.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS2.p2.4.m4.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS2.p2.4.m4.1d">×</annotation></semantics></math> compression ratio.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3. </span>Flexibility Analysis</h3>
<section class="ltx_subsubsection" id="S4.SS3.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.3.1. </span>Flexibility in compression ratio</h4>
<div class="ltx_para" id="S4.SS3.SSS1.p1">
<p class="ltx_p" id="S4.SS3.SSS1.p1.5">We make evaluation of four compression ratios: <math alttext="1\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS1.p1.1.m1.1"><semantics id="S4.SS3.SSS1.p1.1.m1.1a"><mrow id="S4.SS3.SSS1.p1.1.m1.1b"><mn id="S4.SS3.SSS1.p1.1.m1.1.1">1</mn><mo id="S4.SS3.SSS1.p1.1.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS1.p1.1.m1.1c">1\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS1.p1.1.m1.1d">1 ×</annotation></semantics></math> (a special case without down-sampling), <math alttext="2\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS1.p1.2.m2.1"><semantics id="S4.SS3.SSS1.p1.2.m2.1a"><mrow id="S4.SS3.SSS1.p1.2.m2.1b"><mn id="S4.SS3.SSS1.p1.2.m2.1.1">2</mn><mo id="S4.SS3.SSS1.p1.2.m2.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS1.p1.2.m2.1c">2\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS1.p1.2.m2.1d">2 ×</annotation></semantics></math>, <math alttext="4\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS1.p1.3.m3.1"><semantics id="S4.SS3.SSS1.p1.3.m3.1a"><mrow id="S4.SS3.SSS1.p1.3.m3.1b"><mn id="S4.SS3.SSS1.p1.3.m3.1.1">4</mn><mo id="S4.SS3.SSS1.p1.3.m3.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS1.p1.3.m3.1c">4\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS1.p1.3.m3.1d">4 ×</annotation></semantics></math>, <math alttext="8\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS1.p1.4.m4.1"><semantics id="S4.SS3.SSS1.p1.4.m4.1a"><mrow id="S4.SS3.SSS1.p1.4.m4.1b"><mn id="S4.SS3.SSS1.p1.4.m4.1.1">8</mn><mo id="S4.SS3.SSS1.p1.4.m4.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS1.p1.4.m4.1c">8\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS1.p1.4.m4.1d">8 ×</annotation></semantics></math>. Both FlexRAG w. SC and FlexRAG w/o SC are included in our experiment, allowing us to evaluate the impact where selective compression is enabled or disabled. The experiments are performed on both LMQA and ODQA datasets. For LMQA, FlexRAG’s compressed contexts may still exceed Llama-2’s window size in some cases (unless <math alttext="8\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS1.p1.5.m5.1"><semantics id="S4.SS3.SSS1.p1.5.m5.1a"><mrow id="S4.SS3.SSS1.p1.5.m5.1b"><mn id="S4.SS3.SSS1.p1.5.m5.1.1">8</mn><mo id="S4.SS3.SSS1.p1.5.m5.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS1.p1.5.m5.1c">8\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS1.p1.5.m5.1d">8 ×</annotation></semantics></math>); as a result, truncation will be used when it has to. We utilize Llama (w/o retrieval) and Llama (w. retrieval) as the baselines for comparison. The experiment results are shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.T3" title="Table 3 ‣ 4.2.1. Primary results ‣ 4.2. Cost-Effectiveness Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">3</span></a>, where the following observations can be made.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS1.p2">
<p class="ltx_p" id="S4.SS3.SSS1.p2.1">First, FlexRAG consistently outperforms the baselines across all compression ratios. Even without selective compression, FlexRAG w/o SC already surpasses all baselines. When selective compression is enabled, FlexRAG w. SC further extends its empirical advantage. Such an observation indicates that the diverse compression ratios are effectively supported by FlexRAG across different use cases. Besides, it’s worth noting that when the compression ratio is <math alttext="1\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS1.p2.1.m1.1"><semantics id="S4.SS3.SSS1.p2.1.m1.1a"><mrow id="S4.SS3.SSS1.p2.1.m1.1b"><mn id="S4.SS3.SSS1.p2.1.m1.1.1">1</mn><mo id="S4.SS3.SSS1.p2.1.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS1.p2.1.m1.1c">1\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS1.p2.1.m1.1d">1 ×</annotation></semantics></math>, FlexRAG w/o SC receives the same truncated contexts as Llama (with retrieval). Therefore, any improvement it shows over Llama (with retrieval) provides a direct measure of FlexRAG’s enhancement on RAG performance.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS1.p3">
<p class="ltx_p" id="S4.SS3.SSS1.p3.2">Second, FlexRAG’s performance is consistently improved on LMQA datasets when the compression ratio grows. The optimal result is achieved when the highest compression ratio <math alttext="8\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS1.p3.1.m1.1"><semantics id="S4.SS3.SSS1.p3.1.m1.1a"><mrow id="S4.SS3.SSS1.p3.1.m1.1b"><mn id="S4.SS3.SSS1.p3.1.m1.1.1">8</mn><mo id="S4.SS3.SSS1.p3.1.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS1.p3.1.m1.1c">8\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS1.p3.1.m1.1d">8 ×</annotation></semantics></math> is used. In contrast, FlexRAG exhibits an opposite tendency on ODQA datasets, where the lowest compression ratio <math alttext="1\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS1.p3.2.m2.1"><semantics id="S4.SS3.SSS1.p3.2.m2.1a"><mrow id="S4.SS3.SSS1.p3.2.m2.1b"><mn id="S4.SS3.SSS1.p3.2.m2.1.1">1</mn><mo id="S4.SS3.SSS1.p3.2.m2.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS1.p3.2.m2.1c">1\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS1.p3.2.m2.1d">1 ×</annotation></semantics></math> presents the optimal result. As introduced, the retrieved contexts on LMQA exceed the window size of Llama-2; therefore, higher compression ratios help to bring in more information. However, the retrieved contexts on ODQA is concise; as a result, it will not introduce extra information with higher compression ratios, but only increase the information loss for the well-presented contexts.</p>
</div>
<figure class="ltx_table" id="S4.T5">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T5.1" style="width:346.9pt;height:43pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-44.6pt,5.5pt) scale(0.795584100693596,0.795584100693596) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T5.1.1">
<tr class="ltx_tr" id="S4.T5.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="S4.T5.1.1.1.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Retriever</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.1.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">BM25</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.1.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">LLM-Embedder</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.1.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">BGE-base</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.1.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">BGE-large</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T5.1.1.1.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">E5-large</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.1.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">Average</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.1.2">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T5.1.1.2.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Llama (w. retrieval)</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.1.2.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">31.20</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.1.2.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">39.22</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.1.2.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">35.88</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.1.2.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">37.25</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.1.1.2.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">39.82</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.1.2.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">36.67</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.1.3">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="S4.T5.1.1.3.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">FlexRAG</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.1.3.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">44.58</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.1.3.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">46.75</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.1.3.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">45.80</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.1.3.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">45.95</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S4.T5.1.1.3.6" style="padding-top:1.25pt;padding-bottom:1.25pt;">48.47</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.1.3.7" style="padding-top:1.25pt;padding-bottom:1.25pt;">46.31</td>
</tr>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 5. </span>Average performance on ODQA datasets with
various retrievers.</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S4.SS3.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.3.2. </span>Flexibility in compression method</h4>
<div class="ltx_para" id="S4.SS3.SSS2.p1">
<p class="ltx_p" id="S4.SS3.SSS2.p1.5">We make exploration of three alternative compression methods in our experiment. 1) Token w/o SC: this method is identical to FlexRAG w/o SC, operating at the token level with uniform down-sampling at an interval of 8 tokens. 2) Token w. SC: this method performs selective compression through token-level down-sampling, utilizing the likelihood-based importance estimator described in Eq. <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3.E4" title="In 3.4.1. Token-level estimation ‣ 3.4. Selective Compression Mechanism ‣ 3. Methodology ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">4</span></a>. 3) Sentence w. SC: this method performs selective compression via sentence-level down-sampling, employing the embedding-based importance estimator as outlined in Eq. <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S3.E5" title="In 3.4.2. Sentence-level estimation ‣ 3.4. Selective Compression Mechanism ‣ 3. Methodology ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">5</span></a>. We make further variation for the compression ratio: with an uniform overall compression ratio <math alttext="8\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS2.p1.1.m1.1"><semantics id="S4.SS3.SSS2.p1.1.m1.1a"><mrow id="S4.SS3.SSS2.p1.1.m1.1b"><mn id="S4.SS3.SSS2.p1.1.m1.1.1">8</mn><mo id="S4.SS3.SSS2.p1.1.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p1.1.m1.1c">8\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p1.1.m1.1d">8 ×</annotation></semantics></math> and high-priority proportion 1:16, we use two alternative sets of compression ratios for the high-priority (HP.) and low-priority (LP.) group. One is (HP: <math alttext="1\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS2.p1.2.m2.1"><semantics id="S4.SS3.SSS2.p1.2.m2.1a"><mrow id="S4.SS3.SSS2.p1.2.m2.1b"><mn id="S4.SS3.SSS2.p1.2.m2.1.1">1</mn><mo id="S4.SS3.SSS2.p1.2.m2.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p1.2.m2.1c">1\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p1.2.m2.1d">1 ×</annotation></semantics></math>, LP: <math alttext="16\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS2.p1.3.m3.1"><semantics id="S4.SS3.SSS2.p1.3.m3.1a"><mrow id="S4.SS3.SSS2.p1.3.m3.1b"><mn id="S4.SS3.SSS2.p1.3.m3.1.1">16</mn><mo id="S4.SS3.SSS2.p1.3.m3.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p1.3.m3.1c">16\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p1.3.m3.1d">16 ×</annotation></semantics></math>), also the default setting in our experiment; the other one is (HP: <math alttext="2\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS2.p1.4.m4.1"><semantics id="S4.SS3.SSS2.p1.4.m4.1a"><mrow id="S4.SS3.SSS2.p1.4.m4.1b"><mn id="S4.SS3.SSS2.p1.4.m4.1.1">2</mn><mo id="S4.SS3.SSS2.p1.4.m4.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p1.4.m4.1c">2\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p1.4.m4.1d">2 ×</annotation></semantics></math>, LP: <math alttext="11\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS2.p1.5.m5.1"><semantics id="S4.SS3.SSS2.p1.5.m5.1a"><mrow id="S4.SS3.SSS2.p1.5.m5.1b"><mn id="S4.SS3.SSS2.p1.5.m5.1.1">11</mn><mo id="S4.SS3.SSS2.p1.5.m5.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p1.5.m5.1c">11\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p1.5.m5.1d">11 ×</annotation></semantics></math>). The following observations can be made from the experiment results in Table <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.T4" title="Table 4 ‣ 4.2.1. Primary results ‣ 4.2. Cost-Effectiveness Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">4</span></a>.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS2.p2">
<p class="ltx_p" id="S4.SS3.SSS2.p2.1">First, FlexRAG consistently maintains competitive performance across various scenarios. Notably, Sentence w. SC delivers the best results in our experiments. In contrast, Token w. SC shows sub-optimal performance, only outperforming Token w/o SC in specific cases. As previously discussed, token-level down-sampling can lead to incoherence, which diminishes the effectiveness of selective compression, especially under higher compression ratios.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS2.p3">
<p class="ltx_p" id="S4.SS3.SSS2.p3.4">Second, FlexRAG exhibits varied performance given different allocation of compression ratios between the high-priority (HP) and low-priority (LP) groups. HotpotQA and Musique prefer the default allocation (HP: <math alttext="1\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS2.p3.1.m1.1"><semantics id="S4.SS3.SSS2.p3.1.m1.1a"><mrow id="S4.SS3.SSS2.p3.1.m1.1b"><mn id="S4.SS3.SSS2.p3.1.m1.1.1">1</mn><mo id="S4.SS3.SSS2.p3.1.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p3.1.m1.1c">1\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p3.1.m1.1d">1 ×</annotation></semantics></math>, LP: <math alttext="16\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS2.p3.2.m2.1"><semantics id="S4.SS3.SSS2.p3.2.m2.1a"><mrow id="S4.SS3.SSS2.p3.2.m2.1b"><mn id="S4.SS3.SSS2.p3.2.m2.1.1">16</mn><mo id="S4.SS3.SSS2.p3.2.m2.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p3.2.m2.1c">16\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p3.2.m2.1d">16 ×</annotation></semantics></math>), while 2WikiMQA benefits more from a different setup (HP: <math alttext="2\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS2.p3.3.m3.1"><semantics id="S4.SS3.SSS2.p3.3.m3.1a"><mrow id="S4.SS3.SSS2.p3.3.m3.1b"><mn id="S4.SS3.SSS2.p3.3.m3.1.1">2</mn><mo id="S4.SS3.SSS2.p3.3.m3.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p3.3.m3.1c">2\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p3.3.m3.1d">2 ×</annotation></semantics></math>, LP: <math alttext="11\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.SSS2.p3.4.m4.1"><semantics id="S4.SS3.SSS2.p3.4.m4.1a"><mrow id="S4.SS3.SSS2.p3.4.m4.1b"><mn id="S4.SS3.SSS2.p3.4.m4.1.1">11</mn><mo id="S4.SS3.SSS2.p3.4.m4.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.SSS2.p3.4.m4.1c">11\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS2.p3.4.m4.1d">11 ×</annotation></semantics></math>). With a constrained overall compression ratio, assigning lower compression ratios to the HP group helps to preserve crucial information. However, this approach can also lead to the omission of less salient but still important content. Thus, finding the optimal allocation of compression ratios is about striking a delicate balance between these competing factors.</p>
</div>
<figure class="ltx_figure" id="S4.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="351" id="S4.F3.g1" src="x3.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3. </span>Performance on NQ and TriviaQA with varied #Doc.</figcaption>
</figure>
</section>
</section>
<section class="ltx_subsection" id="S4.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.4. </span>Extended Analysis</h3>
<section class="ltx_subsubsection" id="S4.SS4.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.4.1. </span>Robustness to working conditions</h4>
<div class="ltx_para" id="S4.SS4.SSS1.p1">
<p class="ltx_p" id="S4.SS4.SSS1.p1.1">We first analyze the impact of using different retrievers. Beyond BGE-large, which was applied for both training and testing, we explore several alternative retrievers for testing, including BM25 <cite class="ltx_cite ltx_citemacro_citep">(Robertson et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib29" title="">2009</a>)</cite>, LLM-Embedder <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib47" title="">2023</a>)</cite>, BGE-base <cite class="ltx_cite ltx_citemacro_citep">(Xiao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib40" title="">2023</a>)</cite>, and E5-large <cite class="ltx_cite ltx_citemacro_citep">(Wang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib37" title="">2022</a>)</cite>. The results are presented in Table <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.T5" title="Table 5 ‣ 4.3.1. Flexibility in compression ratio ‣ 4.3. Flexibility Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">5</span></a>, leading to the following key observations. First, FlexRAG consistently outperforms llama (w. retrieval) across all retrievers tested. Notably, this includes not only BGE-large, but also other retrievers differ from the one employed during training, demonstrating the strong generalizability of FlexRAG. Second, FlexRAG already achieves a superior performance even with a relatively weaker retriever, e.g., BM25. Additionally, its performance improves further when paired with stronger retrievers, like LLM-Embedder and E5-large.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p2">
<p class="ltx_p" id="S4.SS4.SSS1.p2.1">We further investigate the effect of the number of retrieved documents. In our experiment, we vary the number of retrieved contexts from the top 1 to the top 10 documents returned by the retriever. The results, shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.F3" title="Figure 3 ‣ 4.3.2. Flexibility in compression method ‣ 4.3. Flexibility Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">3</span></a>, lead to the following observations. First, our method (FlexRAG) consistently outperforms the baseline (Llama w. retrieval), and it demonstrates a greater stability, indicating that FlexRAG effectively handles variations in the number of retrieved documents. Second, FlexRAG’s performance improves as the number of retrieved documents increases from 1 to 5, knowing that more useful information can be continually introduced. However, beyond this threshold, no further benefits are observed. According to previous studies <cite class="ltx_cite ltx_citemacro_citep">(Yoran et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#bib.bib46" title="">2023</a>)</cite>, this plateau can be attributed to increased noise from irrelevant documents. Notably, FlexRAG experiences a much smaller performance decline compared to the baseline, suggesting it is more robust to noise.</p>
</div>
<figure class="ltx_table" id="S4.T6">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T6.1" style="width:433.6pt;height:206.5pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(84.5pt,-40.2pt) scale(1.63870401212531,1.63870401212531) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T6.1.1">
<tr class="ltx_tr" id="S4.T6.1.1.1">
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T6.1.1.1.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Factor</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T6.1.1.1.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">Setting</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T6.1.1.1.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">LMQA</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T6.1.1.1.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">ODQA</td>
</tr>
<tr class="ltx_tr" id="S4.T6.1.1.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T6.1.1.2.1" rowspan="3" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T6.1.1.2.1.1">Training stage</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T6.1.1.2.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">w/o pre-training</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T6.1.1.2.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">22.32</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T6.1.1.2.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">39.91</td>
</tr>
<tr class="ltx_tr" id="S4.T6.1.1.3">
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T6.1.1.3.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">w/o rag fine-tuning</td>
<td class="ltx_td ltx_align_center" id="S4.T6.1.1.3.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">24.90</td>
<td class="ltx_td ltx_align_center" id="S4.T6.1.1.3.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">39.18</td>
</tr>
<tr class="ltx_tr" id="S4.T6.1.1.4">
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T6.1.1.4.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">default setting*</td>
<td class="ltx_td ltx_align_center" id="S4.T6.1.1.4.2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T6.1.1.4.2.1">29.93</span></td>
<td class="ltx_td ltx_align_center" id="S4.T6.1.1.4.3" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T6.1.1.4.3.1">45.37</span></td>
</tr>
<tr class="ltx_tr" id="S4.T6.1.1.5">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T6.1.1.5.1" rowspan="3" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text" id="S4.T6.1.1.5.1.1">Encoder Arch.</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T6.1.1.5.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">first 4 layer</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T6.1.1.5.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">25.07</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T6.1.1.5.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">39.85</td>
</tr>
<tr class="ltx_tr" id="S4.T6.1.1.6">
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T6.1.1.6.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">first 12 layer</td>
<td class="ltx_td ltx_align_center" id="S4.T6.1.1.6.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">26.28</td>
<td class="ltx_td ltx_align_center" id="S4.T6.1.1.6.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">40.46</td>
</tr>
<tr class="ltx_tr" id="S4.T6.1.1.7">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S4.T6.1.1.7.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">first 8 layer*</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T6.1.1.7.2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T6.1.1.7.2.1">29.93</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T6.1.1.7.3" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T6.1.1.7.3.1">45.37</span></td>
</tr>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 6. </span>Ablation studies of FlexRAG on LMQA and ODQA datasets. Default settings are marked with “*”.</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S4.SS4.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.4.2. </span>Ablation studies</h4>
<div class="ltx_para" id="S4.SS4.SSS2.p1">
<p class="ltx_p" id="S4.SS4.SSS2.p1.1">We first examine the significance of the two-stage training paradigm. In addition to the default method where both training stages are applied, we assess the impact of using only one of the stages: either w/o pre-training (i.e., RAG fine-tuning only) or w/o fine-tuning (i.e., pre-training only). The results, presented in Table <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.T6" title="Table 6 ‣ 4.4.1. Robustness to working conditions ‣ 4.4. Extended Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">6</span></a>, indicate that pre-training with unlabeled data (w/o fine-tuning) significantly boosts FlexRAG’s performance, as this stage alone already delivers competitive results. The subsequent RAG fine-tuning further enhances the performance, with the default two-stage method achieving the best results in the experiment.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS2.p2">
<p class="ltx_p" id="S4.SS4.SSS2.p2.1">Next, we evaluate the architecture of the compressive encoder, with three alternatives tested: the first 4 layers of Llama-2, the first 8 layers of Llama-2 (default), and the first 12 layers of Llama-2. As shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2409.15699v1#S4.T6" title="Table 6 ‣ 4.4.1. Robustness to working conditions ‣ 4.4. Extended Analysis ‣ 4. Experiments ‣ Lighter And Better: Towards Flexible Context Adaptation For Retrieval Augmented Generation"><span class="ltx_text ltx_ref_tag">6</span></a>, the best performance is achieved when the encoder uses the first 8 layers of Llama-2 as its backbone. In comparison, the smaller encoder (first 4 layers) is constrained by its limited expressiveness, while the larger encoder (first 12 layers) introduces greater disparity with the input layer of the downstream LLM. Therefore, selecting the appropriate encoder architecture requires balancing these considerations.</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5. </span>Conclusion And Future Work</h2>
<div class="ltx_para" id="S5.p1">
<p class="ltx_p" id="S5.p1.1">In this paper, we have presented FlexRAG which brings forth compressed and optimized contexts for RAG tasks. FlexRAG’s architecture allows for flexible production of compressed contexts across various compression ratios, while also supporting selective compression to preserve critical information. By leveraging a two-stage training workflow, FlexRAG effectively utilizes diverse training data, resulting in significant performance optimization. Our experiments across multiple QA datasets demonstrate FlexRAG’s cost-effectiveness, flexibility, and generalizability in different working conditions. Building on the progress of this preliminary work, future research will explore broader applications with more extensive LLM backbones and RAG tasks beyond question answering.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(1)</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Asai et al<span class="ltx_text" id="bib.bib2.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Akari Asai, Zeqiu Wu, Yizhong Wang, Avirup Sil, and Hannaneh Hajishirzi. 2023.

</span>
<span class="ltx_bibblock">Self-rag: Learning to retrieve, generate, and critique through self-reflection.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib2.3.1">arXiv preprint arXiv:2310.11511</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bai et al<span class="ltx_text" id="bib.bib3.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Yushi Bai, Xin Lv, Jiajie Zhang, Hongchang Lyu, Jiankai Tang, Zhidian Huang, Zhengxiao Du, Xiao Liu, Aohan Zeng, Lei Hou, Yuxiao Dong, Jie Tang, and Juanzi Li. 2023.

</span>
<span class="ltx_bibblock">LongBench: A Bilingual, Multitask Benchmark for Long Context Understanding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib3.3.1">arXiv preprint arXiv:2308.14508</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Borgeaud et al<span class="ltx_text" id="bib.bib4.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Sebastian Borgeaud, Arthur Mensch, Jordan Hoffmann, Trevor Cai, Eliza Rutherford, Katie Millican, George Bm Van Den Driessche, Jean-Baptiste Lespiau, Bogdan Damoc, Aidan Clark, et al<span class="ltx_text" id="bib.bib4.3.1">.</span> 2022.

</span>
<span class="ltx_bibblock">Improving language models by retrieving from trillions of tokens. In <em class="ltx_emph ltx_font_italic" id="bib.bib4.4.1">International conference on machine learning</em>. PMLR, 2206–2240.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al<span class="ltx_text" id="bib.bib5.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Yukang Chen, Shengju Qian, Haotian Tang, Xin Lai, Zhijian Liu, Song Han, and Jiaya Jia. 2023.

</span>
<span class="ltx_bibblock">Longlora: Efficient fine-tuning of long-context large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib5.3.1">arXiv preprint arXiv:2309.12307</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chevalier et al<span class="ltx_text" id="bib.bib6.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Alexis Chevalier, Alexander Wettig, Anirudh Ajith, and Danqi Chen. 2023.

</span>
<span class="ltx_bibblock">Adapting language models to compress contexts.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib6.3.1">arXiv preprint arXiv:2305.14788</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Computer (2023)</span>
<span class="ltx_bibblock">
Together Computer. 2023.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">RedPajama: an Open Dataset for Training Large Language Models</em>.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/togethercomputer/RedPajama-Data" title="">https://github.com/togethercomputer/RedPajama-Data</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ding et al<span class="ltx_text" id="bib.bib8.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Ning Ding, Yujia Qin, Guang Yang, Fuchao Wei, Zonghan Yang, Yusheng Su, Shengding Hu, Yulin Chen, Chi-Min Chan, Weize Chen, et al<span class="ltx_text" id="bib.bib8.3.1">.</span> 2023.

</span>
<span class="ltx_bibblock">Parameter-efficient fine-tuning of large-scale pre-trained language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib8.4.1">Nature Machine Intelligence</em> 5, 3 (2023), 220–235.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gao et al<span class="ltx_text" id="bib.bib9.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Yunfan Gao, Yun Xiong, Xinyu Gao, Kangxiang Jia, Jinliu Pan, Yuxi Bi, Yi Dai, Jiawei Sun, and Haofen Wang. 2023.

</span>
<span class="ltx_bibblock">Retrieval-augmented generation for large language models: A survey.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.3.1">arXiv preprint arXiv:2312.10997</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ge et al<span class="ltx_text" id="bib.bib10.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Tao Ge, Jing Hu, Lei Wang, Xun Wang, Si-Qing Chen, and Furu Wei. 2023.

</span>
<span class="ltx_bibblock">In-context autoencoder for context compression in a large language model.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib10.3.1">arXiv preprint arXiv:2307.06945</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ho et al<span class="ltx_text" id="bib.bib11.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Xanh Ho, Anh-Khoa Duong Nguyen, Saku Sugawara, and Akiko Aizawa. 2020.

</span>
<span class="ltx_bibblock">Constructing a multi-hop QA dataset for comprehensive evaluation of reasoning steps.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.3.1">arXiv preprint arXiv:2011.01060</em> (2020).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Izacard and Grave (2020)</span>
<span class="ltx_bibblock">
Gautier Izacard and Edouard Grave. 2020.

</span>
<span class="ltx_bibblock">Leveraging passage retrieval with generative models for open domain question answering.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">arXiv preprint arXiv:2007.01282</em> (2020).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Izacard et al<span class="ltx_text" id="bib.bib13.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Gautier Izacard, Patrick Lewis, Maria Lomeli, Lucas Hosseini, Fabio Petroni, Timo Schick, Jane Dwivedi-Yu, Armand Joulin, Sebastian Riedel, and Edouard Grave. 2023.

</span>
<span class="ltx_bibblock">Atlas: Few-shot learning with retrieval augmented language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.3.1">Journal of Machine Learning Research</em> 24, 251 (2023), 1–43.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ji et al<span class="ltx_text" id="bib.bib14.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Ziwei Ji, Nayeon Lee, Rita Frieske, Tiezheng Yu, Dan Su, Yan Xu, Etsuko Ishii, Ye Jin Bang, Andrea Madotto, and Pascale Fung. 2023.

</span>
<span class="ltx_bibblock">Survey of hallucination in natural language generation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib14.3.1">Comput. Surveys</em> 55, 12 (2023), 1–38.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et al<span class="ltx_text" id="bib.bib15.2.2.1">.</span> (2023a)</span>
<span class="ltx_bibblock">
Huiqiang Jiang, Qianhui Wu, Chin-Yew Lin, Yuqing Yang, and Lili Qiu. 2023a.

</span>
<span class="ltx_bibblock">LLMLingua: Compressing Prompts for Accelerated Inference of Large Language Models. In <em class="ltx_emph ltx_font_italic" id="bib.bib15.3.1">Proceedings of the 2023 Conference on Empirical Methods in Natural Language Processing</em>. 13358–13376.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et al<span class="ltx_text" id="bib.bib16.2.2.1">.</span> (2023b)</span>
<span class="ltx_bibblock">
Huiqiang Jiang, Qianhui Wu, Xufang Luo, Dongsheng Li, Chin-Yew Lin, Yuqing Yang, and Lili Qiu. 2023b.

</span>
<span class="ltx_bibblock">Longllmlingua: Accelerating and enhancing llms in long context scenarios via prompt compression.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib16.3.1">arXiv preprint arXiv:2310.06839</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et al<span class="ltx_text" id="bib.bib17.2.2.1">.</span> (2023c)</span>
<span class="ltx_bibblock">
Zhengbao Jiang, Frank F Xu, Luyu Gao, Zhiqing Sun, Qian Liu, Jane Dwivedi-Yu, Yiming Yang, Jamie Callan, and Graham Neubig. 2023c.

</span>
<span class="ltx_bibblock">Active retrieval augmented generation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib17.3.1">arXiv preprint arXiv:2305.06983</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kwiatkowski et al<span class="ltx_text" id="bib.bib18.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Tom Kwiatkowski, Jennimaria Palomaki, Olivia Redfield, Michael Collins, Ankur Parikh, Chris Alberti, Danielle Epstein, Illia Polosukhin, Jacob Devlin, Kenton Lee, et al<span class="ltx_text" id="bib.bib18.3.1">.</span> 2019.

</span>
<span class="ltx_bibblock">Natural questions: a benchmark for question answering research.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib18.4.1">Transactions of the Association for Computational Linguistics</em> 7 (2019), 453–466.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lester et al<span class="ltx_text" id="bib.bib19.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Brian Lester, Rami Al-Rfou, and Noah Constant. 2021.

</span>
<span class="ltx_bibblock">The power of scale for parameter-efficient prompt tuning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib19.3.1">arXiv preprint arXiv:2104.08691</em> (2021).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lewis et al<span class="ltx_text" id="bib.bib20.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Patrick Lewis, Ethan Perez, Aleksandra Piktus, Fabio Petroni, Vladimir Karpukhin, Naman Goyal, Heinrich Küttler, Mike Lewis, Wen-tau Yih, Tim Rocktäschel, et al<span class="ltx_text" id="bib.bib20.3.1">.</span> 2020.

</span>
<span class="ltx_bibblock">Retrieval-augmented generation for knowledge-intensive nlp tasks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.4.1">Advances in Neural Information Processing Systems</em> 33 (2020), 9459–9474.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span class="ltx_text" id="bib.bib21.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Xiao Liu, Kaixuan Ji, Yicheng Fu, Weng Lam Tam, Zhengxiao Du, Zhilin Yang, and Jie Tang. 2021.

</span>
<span class="ltx_bibblock">P-tuning v2: Prompt tuning can be comparable to fine-tuning universally across scales and tasks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.3.1">arXiv preprint arXiv:2110.07602</em> (2021).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al<span class="ltx_text" id="bib.bib22.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Yang Liu, Yuanshun Yao, Jean-Francois Ton, Xiaoying Zhang, Ruocheng Guo Hao Cheng, Yegor Klochkov, Muhammad Faaiz Taufiq, and Hang Li. 2023.

</span>
<span class="ltx_bibblock">Trustworthy LLMs: A survey and guideline for evaluating large language models’ alignment.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.3.1">arXiv preprint arXiv:2308.05374</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Luo et al<span class="ltx_text" id="bib.bib23.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Yun Luo, Zhen Yang, Fandong Meng, Yafu Li, Jie Zhou, and Yue Zhang. 2023.

</span>
<span class="ltx_bibblock">An empirical study of catastrophic forgetting in large language models during continual fine-tuning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib23.3.1">arXiv preprint arXiv:2308.08747</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mu et al<span class="ltx_text" id="bib.bib24.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Jesse Mu, Xiang Li, and Noah Goodman. 2024.

</span>
<span class="ltx_bibblock">Learning to compress prompts with gist tokens.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib24.3.1">Advances in Neural Information Processing Systems</em> 36 (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">OpenAI (2024)</span>
<span class="ltx_bibblock">
OpenAI. 2024.

</span>
<span class="ltx_bibblock">SearchGPT Prototype.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openai.com/index/searchgpt-prototype/" title="">https://openai.com/index/searchgpt-prototype/</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Pan et al<span class="ltx_text" id="bib.bib26.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Zhuoshi Pan, Qianhui Wu, Huiqiang Jiang, Menglin Xia, Xufang Luo, Jue Zhang, Qingwei Lin, Victor Rühle, Yuqing Yang, Chin-Yew Lin, et al<span class="ltx_text" id="bib.bib26.3.1">.</span> 2024.

</span>
<span class="ltx_bibblock">Llmlingua-2: Data distillation for efficient and faithful task-agnostic prompt compression.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib26.4.1">arXiv preprint arXiv:2403.12968</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Perplexity (2024)</span>
<span class="ltx_bibblock">
Perplexity. 2024.

</span>
<span class="ltx_bibblock">Perplexity.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.perplexity.ai/" title="">https://www.perplexity.ai/</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Petroni et al<span class="ltx_text" id="bib.bib28.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Fabio Petroni, Aleksandra Piktus, Angela Fan, Patrick Lewis, Majid Yazdani, Nicola De Cao, James Thorne, Yacine Jernite, Vladimir Karpukhin, Jean Maillard, et al<span class="ltx_text" id="bib.bib28.3.1">.</span> 2020.

</span>
<span class="ltx_bibblock">KILT: a benchmark for knowledge intensive language tasks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib28.4.1">arXiv preprint arXiv:2009.02252</em> (2020).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Robertson et al<span class="ltx_text" id="bib.bib29.2.2.1">.</span> (2009)</span>
<span class="ltx_bibblock">
Stephen Robertson, Hugo Zaragoza, et al<span class="ltx_text" id="bib.bib29.3.1">.</span> 2009.

</span>
<span class="ltx_bibblock">The probabilistic relevance framework: BM25 and beyond.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib29.4.1">Foundations and Trends® in Information Retrieval</em> 3, 4 (2009), 333–389.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Schick et al<span class="ltx_text" id="bib.bib30.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Timo Schick, Jane Dwivedi-Yu, Roberto Dessì, Roberta Raileanu, Maria Lomeli, Eric Hambro, Luke Zettlemoyer, Nicola Cancedda, and Thomas Scialom. 2024.

</span>
<span class="ltx_bibblock">Toolformer: Language models can teach themselves to use tools.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib30.3.1">Advances in Neural Information Processing Systems</em> 36 (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shi et al<span class="ltx_text" id="bib.bib31.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Weijia Shi, Sewon Min, Michihiro Yasunaga, Minjoon Seo, Rich James, Mike Lewis, Luke Zettlemoyer, and Wen-tau Yih. 2023.

</span>
<span class="ltx_bibblock">Replug: Retrieval-augmented black-box language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib31.3.1">arXiv preprint arXiv:2301.12652</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shinn et al<span class="ltx_text" id="bib.bib32.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Noah Shinn, Federico Cassano, Ashwin Gopinath, Karthik Narasimhan, and Shunyu Yao. 2024.

</span>
<span class="ltx_bibblock">Reflexion: Language agents with verbal reinforcement learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib32.3.1">Advances in Neural Information Processing Systems</em> 36 (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sun et al<span class="ltx_text" id="bib.bib33.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Lichao Sun, Yue Huang, Haoran Wang, Siyuan Wu, Qihui Zhang, Chujie Gao, Yixin Huang, Wenhan Lyu, Yixuan Zhang, Xiner Li, et al<span class="ltx_text" id="bib.bib33.3.1">.</span> 2024.

</span>
<span class="ltx_bibblock">Trustllm: Trustworthiness in large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib33.4.1">arXiv preprint arXiv:2401.05561</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Torch (2024)</span>
<span class="ltx_bibblock">
Torch. 2024.

</span>
<span class="ltx_bibblock">Torch Profiler.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://pytorch.org/docs/stable/profiler.html" title="">https://pytorch.org/docs/stable/profiler.html</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Touvron et al<span class="ltx_text" id="bib.bib35.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, et al<span class="ltx_text" id="bib.bib35.3.1">.</span> 2023.

</span>
<span class="ltx_bibblock">Llama 2: Open foundation and fine-tuned chat models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib35.4.1">arXiv preprint arXiv:2307.09288</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Trivedi et al<span class="ltx_text" id="bib.bib36.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Harsh Trivedi, Niranjan Balasubramanian, Tushar Khot, and Ashish Sabharwal. 2022.

</span>
<span class="ltx_bibblock">MuSiQue: Multihop Questions via Single-hop Question Composition.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib36.3.1">Transactions of the Association for Computational Linguistics</em> 10 (2022), 539–554.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al<span class="ltx_text" id="bib.bib37.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Liang Wang, Nan Yang, Xiaolong Huang, Binxing Jiao, Linjun Yang, Daxin Jiang, Rangan Majumder, and Furu Wei. 2022.

</span>
<span class="ltx_bibblock">Text Embeddings by Weakly-Supervised Contrastive Pre-training.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib37.3.1">arXiv preprint arXiv:2212.03533</em> (2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al<span class="ltx_text" id="bib.bib38.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Liang Wang, Nan Yang, and Furu Wei. 2023.

</span>
<span class="ltx_bibblock">Learning to retrieve in-context examples for large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib38.3.1">arXiv preprint arXiv:2307.07164</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al<span class="ltx_text" id="bib.bib39.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Zora Zhiruo Wang, Akari Asai, Xinyan Velocity Yu, Frank F Xu, Yiqing Xie, Graham Neubig, and Daniel Fried. 2024.

</span>
<span class="ltx_bibblock">CodeRAG-Bench: Can Retrieval Augment Code Generation?

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib39.3.1">arXiv preprint arXiv:2406.14497</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xiao et al<span class="ltx_text" id="bib.bib40.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Shitao Xiao, Zheng Liu, Peitian Zhang, and Niklas Muennighoff. 2023.

</span>
<span class="ltx_bibblock">C-Pack: Packaged Resources To Advance General Chinese Embedding.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2309.07597 [cs.CL]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xu et al<span class="ltx_text" id="bib.bib41.2.2.1">.</span> (2023b)</span>
<span class="ltx_bibblock">
Fangyuan Xu, Weijia Shi, and Eunsol Choi. 2023b.

</span>
<span class="ltx_bibblock">Recomp: Improving retrieval-augmented lms with compression and selective augmentation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib41.3.1">arXiv preprint arXiv:2310.04408</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xu et al<span class="ltx_text" id="bib.bib42.2.2.1">.</span> (2023a)</span>
<span class="ltx_bibblock">
Peng Xu, Wei Ping, Xianchao Wu, Lawrence McAfee, Chen Zhu, Zihan Liu, Sandeep Subramanian, Evelina Bakhturina, Mohammad Shoeybi, and Bryan Catanzaro. 2023a.

</span>
<span class="ltx_bibblock">Retrieval meets long context large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib42.3.1">arXiv preprint arXiv:2310.03025</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al<span class="ltx_text" id="bib.bib43.2.2.1">.</span> (2018)</span>
<span class="ltx_bibblock">
Zhilin Yang, Peng Qi, Saizheng Zhang, Yoshua Bengio, William W Cohen, Ruslan Salakhutdinov, and Christopher D Manning. 2018.

</span>
<span class="ltx_bibblock">HotpotQA: A dataset for diverse, explainable multi-hop question answering.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib43.3.1">arXiv preprint arXiv:1809.09600</em> (2018).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yao et al<span class="ltx_text" id="bib.bib44.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Shunyu Yao, Jeffrey Zhao, Dian Yu, Nan Du, Izhak Shafran, Karthik Narasimhan, and Yuan Cao. 2022.

</span>
<span class="ltx_bibblock">React: Synergizing reasoning and acting in language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib44.3.1">arXiv preprint arXiv:2210.03629</em> (2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yasunaga et al<span class="ltx_text" id="bib.bib45.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Michihiro Yasunaga, Armen Aghajanyan, Weijia Shi, Rich James, Jure Leskovec, Percy Liang, Mike Lewis, Luke Zettlemoyer, and Wen-tau Yih. 2022.

</span>
<span class="ltx_bibblock">Retrieval-augmented multimodal language modeling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib45.3.1">arXiv preprint arXiv:2211.12561</em> (2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yoran et al<span class="ltx_text" id="bib.bib46.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Ori Yoran, Tomer Wolfson, Ori Ram, and Jonathan Berant. 2023.

</span>
<span class="ltx_bibblock">Making retrieval-augmented language models robust to irrelevant context.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib46.3.1">arXiv preprint arXiv:2310.01558</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al<span class="ltx_text" id="bib.bib47.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Peitian Zhang, Shitao Xiao, Zheng Liu, Zhicheng Dou, and Jian-Yun Nie. 2023.

</span>
<span class="ltx_bibblock">Retrieve anything to augment large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib47.3.1">arXiv preprint arXiv:2310.07554</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al<span class="ltx_text" id="bib.bib48.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
Tianjun Zhang, Shishir G Patil, Naman Jain, Sheng Shen, Matei Zaharia, Ion Stoica, and Joseph E Gonzalez. 2024.

</span>
<span class="ltx_bibblock">Raft: Adapting language model to domain specific rag.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib48.3.1">arXiv preprint arXiv:2403.10131</em> (2024).

</span>
<span class="ltx_bibblock">
</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Tue Sep 24 03:23:02 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
