<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models</title>
<!--Generated on Tue Jul 23 19:39:13 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<meta content="LLM,  Retrieval-Augmented Generation,  Prompt attack,  Robustness" lang="en" name="keywords"/>
<base href="/html/2402.07179v3/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S1" title="In Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S2" title="In Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Work</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S2.SS1" title="In 2. Related Work â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>Factual error detection in transformers</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S2.SS2" title="In 2. Related Work â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Adversarial attacks on LLMs and RAG</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3" title="In Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Gradient Guided Prompt Perturbation</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.SS1" title="In 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>RAG workflow of GGPP</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.SS2" title="In 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>The GGPP algorithm</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.SS2.SSS1" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2.1 </span>Prefix initialization through token importance</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.SS2.SSS2" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2.2 </span>Prefix optimization with GGPP</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.SS3" title="In 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>GGPP for prompts with instructions</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S4" title="In Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Detection of adversarial prefixes</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S4.SS1" title="In 4. Detection of adversarial prefixes â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Impact of prefix on neuron activation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S4.SS2" title="In 4. Detection of adversarial prefixes â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Detection methods</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S5" title="In Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S5.SS1" title="In 5. Experiments â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>Setup</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S5.SS2" title="In 5. Experiments â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Results</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S5.SS2.SSS1" title="In 5.2. Results â€£ 5. Experiments â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2.1 </span>Prompt perturbation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S5.SS2.SSS2" title="In 5.2. Results â€£ 5. Experiments â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2.2 </span>Perturbation Detection</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S6" title="In Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Conclusion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1" title="In Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Appendix</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS1" title="In Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.1 </span>Impact of <math alttext="\lambda" class="ltx_Math" display="inline"><semantics><mi>Î»</mi><annotation-xml encoding="MathML-Content"><ci>ğœ†</ci></annotation-xml><annotation encoding="application/x-tex">\lambda</annotation><annotation encoding="application/x-llamapun">italic_Î»</annotation></semantics></math> on perturbation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS2" title="In Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.2 </span>GGPP perturbation detection efficiency</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS3" title="In Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.3 </span>Example prompts and passages</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS4" title="In Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.4 </span>Example GGPP prefixes</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS5" title="In Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.5 </span>Factual answer manipulation experiments</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS6" title="In Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.6 </span>GGPP for prompts with instructions</span></a></li>
</ol>
</li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line ltx_leqno">
<h1 class="ltx_title ltx_title_document">Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Zhibo Hu
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id1.1.id1">The University of New South Wales</span><span class="ltx_text ltx_affiliation_institution" id="id2.2.id2">CSIRO Data61</span><span class="ltx_text ltx_affiliation_country" id="id3.3.id3">Australia</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:zhibo.hu@student.unsw.edu.au">zhibo.hu@student.unsw.edu.au</a>
</span></span></span>
<span class="ltx_author_before">,Â </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Chen Wang
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id4.1.id1">CSIRO Data61</span><span class="ltx_text ltx_affiliation_institution" id="id5.2.id2">The University of New South Wales</span><span class="ltx_text ltx_affiliation_country" id="id6.3.id3">Australia</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:chen.wang@data61.csiro.au">chen.wang@data61.csiro.au</a>
</span></span></span>
<span class="ltx_author_before">,Â </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Yanfeng Shu
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id7.1.id1">CSIRO Data61</span><span class="ltx_text ltx_affiliation_country" id="id8.2.id2">Australia</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:yanfeng.shu@data61.csiro.au">yanfeng.shu@data61.csiro.au</a>
</span></span></span>
<span class="ltx_author_before">,Â </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Hye-young Paik
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id9.1.id1">The University of New South Wales</span><span class="ltx_text ltx_affiliation_country" id="id10.2.id2">Australia</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:h.paik@unsw.edu.au">h.paik@unsw.edu.au</a>
</span></span></span>
<span class="ltx_author_before">Â andÂ </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Liming Zhu
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id11.1.id1">CSIRO Data61</span><span class="ltx_text ltx_affiliation_institution" id="id12.2.id2">The University of New South Wales</span><span class="ltx_text ltx_affiliation_country" id="id13.3.id3">Australia</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:liming.zhu@data61.csiro.au">liming.zhu@data61.csiro.au</a>
</span></span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract.</h6>
<p class="ltx_p" id="id14.id1">The robustness of large language models (LLMs) becomes increasingly important as their use rapidly grows in a wide range of domains. Retrieval-Augmented Generation (RAG) is considered as a means to improve the trustworthiness of text generation from LLMs. However, how the outputs from RAG-based LLMs are affected by slightly different inputs is not well studied. In this work, we find that the insertion of even a short prefix to the prompt leads to the generation of outputs far away from factually correct answers.
We systematically evaluate the effect of such prefixes on RAG by introducing a novel optimization technique called Gradient Guided Prompt Perturbation (GGPP). GGPP achieves a high success rate in steering outputs of RAG-based LLMs to targeted wrong answers. It can also cope with instructions in the prompts requesting to ignore irrelevant context.
We also exploit LLMsâ€™ neuron activation difference between prompts with and without GGPP perturbations to give a method that improves the robustness of RAG-based LLMs through a highly effective detector trained on neuron activation triggered by GGPP generated prompts. Our evaluation on open-sourced LLMs demonstrates the effectiveness of our methods.</p>
</div>
<div class="ltx_keywords">LLM, Retrieval-Augmented Generation, Prompt attack, Robustness
</div>
<figure class="ltx_figure" id="S0.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="719" id="S0.F1.g1" src="x1.png" width="664"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1. </span>Cases of robustness in LLMs (Mistral-7B-v0.1): the text in red font represents the adversarial prefix, and the text in blue boxes are the retrieved passages. (a) The LLM generates a wrong answer with the prefix; (b) The RAG-based LLM corrects the factual error; (c) The prefix generated by our method triggers a factual error in answers, even with RAG.</figcaption>
</figure>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1. </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Large language models (LLMs) are known to have hallucination problemsÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib1" title="">welleck2019neural, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib2" title="">mialon2023augmented, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib3" title="">mallen2023not, </a>)</cite>. They are also shown to produce unsatisfactory answers to long-tailed factual knowledgeÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib4" title="">kandpal2023large, </a>)</cite> and have uneven distribution of accuracy on extracting information from long contextÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib5" title="">liu2023lost, </a>)</cite>. Adversarial attacks that alter inputs to trigger prediction or generation errors in deep learning modelsÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib6" title="">goodfellow2014explaining, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib7" title="">szegedy2013intriguing, </a>)</cite> are also seen being applied to attack LLMsÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib8" title="">wang2023robustness, </a>)</cite>. Automatically generated adversarial prompts are capable of breaking the guardrails of language modelsÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib9" title="">ebrahimi2017hotflip, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib10" title="">wallace2019universal, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib11" title="">zou2023universal, </a>)</cite>.
Retrieval-Augmented Generation (RAG)Â <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib12" title="">lewis2020retrieval, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib13" title="">borgeaud2022improving, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib14" title="">lin2023vector, </a>)</cite> is introduced to improve the trustworthiness of LLMs by enhancing LLMs with data retrieval functionality so that trusted data sources can be used as the context to generate text to reduce factual errors.
RAG has been shown effective on improving long-tail capturingÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib4" title="">kandpal2023large, </a>)</cite>. However, we observe that RAG-based LLMs suffer from similar robustness problem. As shown in Fig.Â <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S0.F1" title="Figure 1 â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">1</span></a>, our work demonstrates that a perturbed prompt may direct the RAG to retrieve a wrong text passage from the data repository and generate a factually wrong answer.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">There are many works towards understanding the vulnerabilities and improving the robustness of LLMs, such as prompt attacksÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib15" title="">zhu2023promptbench, </a>)</cite>, performance under distribution shiftÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib16" title="">lazaridou2021mind, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib8" title="">wang2023robustness, </a>)</cite>, but not many study the problem under the RAG setting. Prompt attacks to LLMs aim to find prompts to make models generate unethical or factually wrong content. With a RAG-based LLM, the initial retrieval process can be vulnerable as well. As relevant passages are retrieved often based on the distances between the query and the passages in the embedding space, how robust the embeddings are in terms of their relative coordinates in the space is important to the factual accuracy of the LLM. </p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">Compared to prompt perturbationÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib11" title="">zou2023universal, </a>)</cite> aimed to â€œjailbreakâ€ the guardrails of LLMsÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib17" title="">rebedea2023nemo, </a>)</cite>, perturbing prompts to make LLMs retrieve a targeted text passage from a trusted repository is more challenging. In addition to pushing the correct passage out of the retrieved passage list, it needs to include the targeted passage into the retrieved passage list. This additional constraint makes the search for suitable perturbations difficult in a large vector space.
</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">In this paper, we propose a method called Gradient Guided Prompt Perturbation (GGPP) to search for prefixes that prompt RAG-based LLMs to generate factually incorrect answers by identifying an embedding vector.
We introduce a prefix initialization algorithm that computes token importance of the target text passage for forming its corresponding embedding. The algorithm greatly reduces the prefix search cost for a given prompt. Our method demonstrates that minor changes in the prompt can lead to the retrieval of a targeted text passage with a high success rate. This text passage then prompts LLMs to produce factually wrong answers.
Our work shows that using RAG to improve the trustworthiness of LLMs bears its own risk. The robustness of RAG needs to be carefully evaluated in critical applications.
</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">Moreover, we investigate how GGPP prefixes affect LLMâ€™s neuron activation and introduce methods to improve the robustness of RAG-based LLMs by detecting perturbations and factual errors in LLM-generated text. Our first detection method, called SATe, is based on SAT probe<cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib18" title="">yuksekgonul2023attention, </a>)</cite>, leveraging the pattern difference of neuron activation between perturbed prompts and original prompts. SAT probe uses the internal states of LLMs -particularly attentions to constraint tokens - to identify factual errors. We adapt SAT probe to the embedding space to check if the GGPP-induced changes on retrieval results lead to factual errors.</p>
</div>
<div class="ltx_para" id="S1.p6">
<p class="ltx_p" id="S1.p6.1">We further discover a strong positive relation between the modelâ€™s multi-Layer perceptron (MLP) activation to the factual accuracy of its responses when GGPP prefix is added. We then propose a new probe called ACT (ACTivation) probe to detect GGPP-induced changes by only analyzing the neuron activation in the last layer of an LLM. Compared to SATe probe, ACT probe uses significantly fewer parameters while maintaining a high retrieval error detection rate.</p>
</div>
<div class="ltx_para" id="S1.p7">
<p class="ltx_p" id="S1.p7.1">We evaluate our method on open source LLMs, including GPT-J-6B<cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib19" title="">GPT_J_github_project, </a>)</cite>, Mistrial-7B<cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib20" title="">jiang2023mistral, </a>)</cite>, Qwen-7B<cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib21" title="">bai2023qwen, </a>)</cite> and SFR-Embedding-Mistral<cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib22" title="">SFRAIResearch2024, </a>)</cite>. We demonstrate GGPP is effective in changing the retrieval to targeted text passages and our ACT probe provides a cost-effective defence to perturbed prompts. Our code can be found in the link<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span><a class="ltx_ref ltx_href" href="https://github.com/Hadise-zb/Prompt-Perturbation-in-Retrieval-Augmented-Generation/tree/main" title="">https://github.com/Hadise-zb/Prompt-Perturbation-in-Retrieval-Augmented-Generation/tree/main</a></span></span></span>.</p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2. </span>Related Work</h2>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1. </span>Factual error detection in transformers</h3>
<div class="ltx_para" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.5">Transformers are the building blocks of LLMsÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib23" title="">vaswani2017attention, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib24" title="">meng2022locating, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib25" title="">geva2023dissecting, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib26" title="">ganguli2022predictability, </a>)</cite>. Recent studiesÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib24" title="">meng2022locating, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib27" title="">mitchell2022memory, </a>)</cite> have shown factual information can be located in the internal neuron structure of LLMs. In the transformer architecture, input tokens are converted into <math alttext="d" class="ltx_Math" display="inline" id="S2.SS1.p1.1.m1.1"><semantics id="S2.SS1.p1.1.m1.1a"><mi id="S2.SS1.p1.1.m1.1.1" xref="S2.SS1.p1.1.m1.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.1.m1.1b"><ci id="S2.SS1.p1.1.m1.1.1.cmml" xref="S2.SS1.p1.1.m1.1.1">ğ‘‘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.1.m1.1c">d</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.1.m1.1d">italic_d</annotation></semantics></math>-dimensional vectors through an embedding matrix. The transformerâ€™s core is composed of <math alttext="L" class="ltx_Math" display="inline" id="S2.SS1.p1.2.m2.1"><semantics id="S2.SS1.p1.2.m2.1a"><mi id="S2.SS1.p1.2.m2.1.1" xref="S2.SS1.p1.2.m2.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.2.m2.1b"><ci id="S2.SS1.p1.2.m2.1.1.cmml" xref="S2.SS1.p1.2.m2.1.1">ğ¿</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.2.m2.1c">L</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.2.m2.1d">italic_L</annotation></semantics></math> layers, each updating the tokenâ€™s state vectors through a combination of last layer hidden state <math alttext="\mathbf{h_{i}}^{l-1}" class="ltx_Math" display="inline" id="S2.SS1.p1.3.m3.1"><semantics id="S2.SS1.p1.3.m3.1a"><mmultiscripts id="S2.SS1.p1.3.m3.1.1" xref="S2.SS1.p1.3.m3.1.1.cmml"><mi id="S2.SS1.p1.3.m3.1.1.2.2" xref="S2.SS1.p1.3.m3.1.1.2.2.cmml">ğ¡</mi><mi id="S2.SS1.p1.3.m3.1.1.2.3" xref="S2.SS1.p1.3.m3.1.1.2.3.cmml">ğ¢</mi><mrow id="S2.SS1.p1.3.m3.1.1a" xref="S2.SS1.p1.3.m3.1.1.cmml"></mrow><mrow id="S2.SS1.p1.3.m3.1.1b" xref="S2.SS1.p1.3.m3.1.1.cmml"></mrow><mrow id="S2.SS1.p1.3.m3.1.1.3" xref="S2.SS1.p1.3.m3.1.1.3.cmml"><mi id="S2.SS1.p1.3.m3.1.1.3.2" xref="S2.SS1.p1.3.m3.1.1.3.2.cmml">l</mi><mo id="S2.SS1.p1.3.m3.1.1.3.1" xref="S2.SS1.p1.3.m3.1.1.3.1.cmml">âˆ’</mo><mn id="S2.SS1.p1.3.m3.1.1.3.3" xref="S2.SS1.p1.3.m3.1.1.3.3.cmml">1</mn></mrow></mmultiscripts><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.3.m3.1b"><apply id="S2.SS1.p1.3.m3.1.1.cmml" xref="S2.SS1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.1.1.1.cmml" xref="S2.SS1.p1.3.m3.1.1">superscript</csymbol><apply id="S2.SS1.p1.3.m3.1.1.2.cmml" xref="S2.SS1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.3.m3.1.1.2.1.cmml" xref="S2.SS1.p1.3.m3.1.1">subscript</csymbol><ci id="S2.SS1.p1.3.m3.1.1.2.2.cmml" xref="S2.SS1.p1.3.m3.1.1.2.2">ğ¡</ci><ci id="S2.SS1.p1.3.m3.1.1.2.3.cmml" xref="S2.SS1.p1.3.m3.1.1.2.3">ğ¢</ci></apply><apply id="S2.SS1.p1.3.m3.1.1.3.cmml" xref="S2.SS1.p1.3.m3.1.1.3"><minus id="S2.SS1.p1.3.m3.1.1.3.1.cmml" xref="S2.SS1.p1.3.m3.1.1.3.1"></minus><ci id="S2.SS1.p1.3.m3.1.1.3.2.cmml" xref="S2.SS1.p1.3.m3.1.1.3.2">ğ‘™</ci><cn id="S2.SS1.p1.3.m3.1.1.3.3.cmml" type="integer" xref="S2.SS1.p1.3.m3.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.3.m3.1c">\mathbf{h_{i}}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.3.m3.1d">bold_h start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math>, attention weights <math alttext="\mathbf{a_{i}}^{l}" class="ltx_Math" display="inline" id="S2.SS1.p1.4.m4.1"><semantics id="S2.SS1.p1.4.m4.1a"><mmultiscripts id="S2.SS1.p1.4.m4.1.1" xref="S2.SS1.p1.4.m4.1.1.cmml"><mi id="S2.SS1.p1.4.m4.1.1.2.2" xref="S2.SS1.p1.4.m4.1.1.2.2.cmml">ğš</mi><mi id="S2.SS1.p1.4.m4.1.1.2.3" xref="S2.SS1.p1.4.m4.1.1.2.3.cmml">ğ¢</mi><mrow id="S2.SS1.p1.4.m4.1.1a" xref="S2.SS1.p1.4.m4.1.1.cmml"></mrow><mrow id="S2.SS1.p1.4.m4.1.1b" xref="S2.SS1.p1.4.m4.1.1.cmml"></mrow><mi id="S2.SS1.p1.4.m4.1.1.3" xref="S2.SS1.p1.4.m4.1.1.3.cmml">l</mi></mmultiscripts><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.4.m4.1b"><apply id="S2.SS1.p1.4.m4.1.1.cmml" xref="S2.SS1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.4.m4.1.1.1.cmml" xref="S2.SS1.p1.4.m4.1.1">superscript</csymbol><apply id="S2.SS1.p1.4.m4.1.1.2.cmml" xref="S2.SS1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.4.m4.1.1.2.1.cmml" xref="S2.SS1.p1.4.m4.1.1">subscript</csymbol><ci id="S2.SS1.p1.4.m4.1.1.2.2.cmml" xref="S2.SS1.p1.4.m4.1.1.2.2">ğš</ci><ci id="S2.SS1.p1.4.m4.1.1.2.3.cmml" xref="S2.SS1.p1.4.m4.1.1.2.3">ğ¢</ci></apply><ci id="S2.SS1.p1.4.m4.1.1.3.cmml" xref="S2.SS1.p1.4.m4.1.1.3">ğ‘™</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.4.m4.1c">\mathbf{a_{i}}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.4.m4.1d">bold_a start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> and multi-layer perceptron (MLP) contributions <math alttext="\mathbf{m_{i}}^{l}" class="ltx_Math" display="inline" id="S2.SS1.p1.5.m5.1"><semantics id="S2.SS1.p1.5.m5.1a"><mmultiscripts id="S2.SS1.p1.5.m5.1.1" xref="S2.SS1.p1.5.m5.1.1.cmml"><mi id="S2.SS1.p1.5.m5.1.1.2.2" xref="S2.SS1.p1.5.m5.1.1.2.2.cmml">ğ¦</mi><mi id="S2.SS1.p1.5.m5.1.1.2.3" xref="S2.SS1.p1.5.m5.1.1.2.3.cmml">ğ¢</mi><mrow id="S2.SS1.p1.5.m5.1.1a" xref="S2.SS1.p1.5.m5.1.1.cmml"></mrow><mrow id="S2.SS1.p1.5.m5.1.1b" xref="S2.SS1.p1.5.m5.1.1.cmml"></mrow><mi id="S2.SS1.p1.5.m5.1.1.3" xref="S2.SS1.p1.5.m5.1.1.3.cmml">l</mi></mmultiscripts><annotation-xml encoding="MathML-Content" id="S2.SS1.p1.5.m5.1b"><apply id="S2.SS1.p1.5.m5.1.1.cmml" xref="S2.SS1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.5.m5.1.1.1.cmml" xref="S2.SS1.p1.5.m5.1.1">superscript</csymbol><apply id="S2.SS1.p1.5.m5.1.1.2.cmml" xref="S2.SS1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS1.p1.5.m5.1.1.2.1.cmml" xref="S2.SS1.p1.5.m5.1.1">subscript</csymbol><ci id="S2.SS1.p1.5.m5.1.1.2.2.cmml" xref="S2.SS1.p1.5.m5.1.1.2.2">ğ¦</ci><ci id="S2.SS1.p1.5.m5.1.1.2.3.cmml" xref="S2.SS1.p1.5.m5.1.1.2.3">ğ¢</ci></apply><ci id="S2.SS1.p1.5.m5.1.1.3.cmml" xref="S2.SS1.p1.5.m5.1.1.3">ğ‘™</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p1.5.m5.1c">\mathbf{m_{i}}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p1.5.m5.1d">bold_m start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.Ex1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathbf{h_{i}}^{l}=\mathbf{h_{i}}^{l-1}+\mathbf{a_{i}}^{l}+\mathbf{m_{i}}^{l}" class="ltx_Math" display="block" id="S2.Ex1.m1.1"><semantics id="S2.Ex1.m1.1a"><mrow id="S2.Ex1.m1.1.1" xref="S2.Ex1.m1.1.1.cmml"><mmultiscripts id="S2.Ex1.m1.1.1.2" xref="S2.Ex1.m1.1.1.2.cmml"><mi id="S2.Ex1.m1.1.1.2.2.2" xref="S2.Ex1.m1.1.1.2.2.2.cmml">ğ¡</mi><mi id="S2.Ex1.m1.1.1.2.2.3" xref="S2.Ex1.m1.1.1.2.2.3.cmml">ğ¢</mi><mrow id="S2.Ex1.m1.1.1.2a" xref="S2.Ex1.m1.1.1.2.cmml"></mrow><mrow id="S2.Ex1.m1.1.1.2b" xref="S2.Ex1.m1.1.1.2.cmml"></mrow><mi id="S2.Ex1.m1.1.1.2.3" xref="S2.Ex1.m1.1.1.2.3.cmml">l</mi></mmultiscripts><mo id="S2.Ex1.m1.1.1.1" xref="S2.Ex1.m1.1.1.1.cmml">=</mo><mrow id="S2.Ex1.m1.1.1.3" xref="S2.Ex1.m1.1.1.3.cmml"><mmultiscripts id="S2.Ex1.m1.1.1.3.2" xref="S2.Ex1.m1.1.1.3.2.cmml"><mi id="S2.Ex1.m1.1.1.3.2.2.2" xref="S2.Ex1.m1.1.1.3.2.2.2.cmml">ğ¡</mi><mi id="S2.Ex1.m1.1.1.3.2.2.3" xref="S2.Ex1.m1.1.1.3.2.2.3.cmml">ğ¢</mi><mrow id="S2.Ex1.m1.1.1.3.2a" xref="S2.Ex1.m1.1.1.3.2.cmml"></mrow><mrow id="S2.Ex1.m1.1.1.3.2b" xref="S2.Ex1.m1.1.1.3.2.cmml"></mrow><mrow id="S2.Ex1.m1.1.1.3.2.3" xref="S2.Ex1.m1.1.1.3.2.3.cmml"><mi id="S2.Ex1.m1.1.1.3.2.3.2" xref="S2.Ex1.m1.1.1.3.2.3.2.cmml">l</mi><mo id="S2.Ex1.m1.1.1.3.2.3.1" xref="S2.Ex1.m1.1.1.3.2.3.1.cmml">âˆ’</mo><mn id="S2.Ex1.m1.1.1.3.2.3.3" xref="S2.Ex1.m1.1.1.3.2.3.3.cmml">1</mn></mrow></mmultiscripts><mo id="S2.Ex1.m1.1.1.3.1" xref="S2.Ex1.m1.1.1.3.1.cmml">+</mo><mmultiscripts id="S2.Ex1.m1.1.1.3.3" xref="S2.Ex1.m1.1.1.3.3.cmml"><mi id="S2.Ex1.m1.1.1.3.3.2.2" xref="S2.Ex1.m1.1.1.3.3.2.2.cmml">ğš</mi><mi id="S2.Ex1.m1.1.1.3.3.2.3" xref="S2.Ex1.m1.1.1.3.3.2.3.cmml">ğ¢</mi><mrow id="S2.Ex1.m1.1.1.3.3a" xref="S2.Ex1.m1.1.1.3.3.cmml"></mrow><mrow id="S2.Ex1.m1.1.1.3.3b" xref="S2.Ex1.m1.1.1.3.3.cmml"></mrow><mi id="S2.Ex1.m1.1.1.3.3.3" xref="S2.Ex1.m1.1.1.3.3.3.cmml">l</mi></mmultiscripts><mo id="S2.Ex1.m1.1.1.3.1a" xref="S2.Ex1.m1.1.1.3.1.cmml">+</mo><mmultiscripts id="S2.Ex1.m1.1.1.3.4" xref="S2.Ex1.m1.1.1.3.4.cmml"><mi id="S2.Ex1.m1.1.1.3.4.2.2" xref="S2.Ex1.m1.1.1.3.4.2.2.cmml">ğ¦</mi><mi id="S2.Ex1.m1.1.1.3.4.2.3" xref="S2.Ex1.m1.1.1.3.4.2.3.cmml">ğ¢</mi><mrow id="S2.Ex1.m1.1.1.3.4a" xref="S2.Ex1.m1.1.1.3.4.cmml"></mrow><mrow id="S2.Ex1.m1.1.1.3.4b" xref="S2.Ex1.m1.1.1.3.4.cmml"></mrow><mi id="S2.Ex1.m1.1.1.3.4.3" xref="S2.Ex1.m1.1.1.3.4.3.cmml">l</mi></mmultiscripts></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex1.m1.1b"><apply id="S2.Ex1.m1.1.1.cmml" xref="S2.Ex1.m1.1.1"><eq id="S2.Ex1.m1.1.1.1.cmml" xref="S2.Ex1.m1.1.1.1"></eq><apply id="S2.Ex1.m1.1.1.2.cmml" xref="S2.Ex1.m1.1.1.2"><csymbol cd="ambiguous" id="S2.Ex1.m1.1.1.2.1.cmml" xref="S2.Ex1.m1.1.1.2">superscript</csymbol><apply id="S2.Ex1.m1.1.1.2.2.cmml" xref="S2.Ex1.m1.1.1.2"><csymbol cd="ambiguous" id="S2.Ex1.m1.1.1.2.2.1.cmml" xref="S2.Ex1.m1.1.1.2">subscript</csymbol><ci id="S2.Ex1.m1.1.1.2.2.2.cmml" xref="S2.Ex1.m1.1.1.2.2.2">ğ¡</ci><ci id="S2.Ex1.m1.1.1.2.2.3.cmml" xref="S2.Ex1.m1.1.1.2.2.3">ğ¢</ci></apply><ci id="S2.Ex1.m1.1.1.2.3.cmml" xref="S2.Ex1.m1.1.1.2.3">ğ‘™</ci></apply><apply id="S2.Ex1.m1.1.1.3.cmml" xref="S2.Ex1.m1.1.1.3"><plus id="S2.Ex1.m1.1.1.3.1.cmml" xref="S2.Ex1.m1.1.1.3.1"></plus><apply id="S2.Ex1.m1.1.1.3.2.cmml" xref="S2.Ex1.m1.1.1.3.2"><csymbol cd="ambiguous" id="S2.Ex1.m1.1.1.3.2.1.cmml" xref="S2.Ex1.m1.1.1.3.2">superscript</csymbol><apply id="S2.Ex1.m1.1.1.3.2.2.cmml" xref="S2.Ex1.m1.1.1.3.2"><csymbol cd="ambiguous" id="S2.Ex1.m1.1.1.3.2.2.1.cmml" xref="S2.Ex1.m1.1.1.3.2">subscript</csymbol><ci id="S2.Ex1.m1.1.1.3.2.2.2.cmml" xref="S2.Ex1.m1.1.1.3.2.2.2">ğ¡</ci><ci id="S2.Ex1.m1.1.1.3.2.2.3.cmml" xref="S2.Ex1.m1.1.1.3.2.2.3">ğ¢</ci></apply><apply id="S2.Ex1.m1.1.1.3.2.3.cmml" xref="S2.Ex1.m1.1.1.3.2.3"><minus id="S2.Ex1.m1.1.1.3.2.3.1.cmml" xref="S2.Ex1.m1.1.1.3.2.3.1"></minus><ci id="S2.Ex1.m1.1.1.3.2.3.2.cmml" xref="S2.Ex1.m1.1.1.3.2.3.2">ğ‘™</ci><cn id="S2.Ex1.m1.1.1.3.2.3.3.cmml" type="integer" xref="S2.Ex1.m1.1.1.3.2.3.3">1</cn></apply></apply><apply id="S2.Ex1.m1.1.1.3.3.cmml" xref="S2.Ex1.m1.1.1.3.3"><csymbol cd="ambiguous" id="S2.Ex1.m1.1.1.3.3.1.cmml" xref="S2.Ex1.m1.1.1.3.3">superscript</csymbol><apply id="S2.Ex1.m1.1.1.3.3.2.cmml" xref="S2.Ex1.m1.1.1.3.3"><csymbol cd="ambiguous" id="S2.Ex1.m1.1.1.3.3.2.1.cmml" xref="S2.Ex1.m1.1.1.3.3">subscript</csymbol><ci id="S2.Ex1.m1.1.1.3.3.2.2.cmml" xref="S2.Ex1.m1.1.1.3.3.2.2">ğš</ci><ci id="S2.Ex1.m1.1.1.3.3.2.3.cmml" xref="S2.Ex1.m1.1.1.3.3.2.3">ğ¢</ci></apply><ci id="S2.Ex1.m1.1.1.3.3.3.cmml" xref="S2.Ex1.m1.1.1.3.3.3">ğ‘™</ci></apply><apply id="S2.Ex1.m1.1.1.3.4.cmml" xref="S2.Ex1.m1.1.1.3.4"><csymbol cd="ambiguous" id="S2.Ex1.m1.1.1.3.4.1.cmml" xref="S2.Ex1.m1.1.1.3.4">superscript</csymbol><apply id="S2.Ex1.m1.1.1.3.4.2.cmml" xref="S2.Ex1.m1.1.1.3.4"><csymbol cd="ambiguous" id="S2.Ex1.m1.1.1.3.4.2.1.cmml" xref="S2.Ex1.m1.1.1.3.4">subscript</csymbol><ci id="S2.Ex1.m1.1.1.3.4.2.2.cmml" xref="S2.Ex1.m1.1.1.3.4.2.2">ğ¦</ci><ci id="S2.Ex1.m1.1.1.3.4.2.3.cmml" xref="S2.Ex1.m1.1.1.3.4.2.3">ğ¢</ci></apply><ci id="S2.Ex1.m1.1.1.3.4.3.cmml" xref="S2.Ex1.m1.1.1.3.4.3">ğ‘™</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex1.m1.1c">\mathbf{h_{i}}^{l}=\mathbf{h_{i}}^{l-1}+\mathbf{a_{i}}^{l}+\mathbf{m_{i}}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.Ex1.m1.1d">bold_h start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = bold_h start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT + bold_a start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT + bold_m start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS1.p1.6">The attention mechanism is pivotal, enabling each token to consider all previous tokens by applying the attention operation:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.Ex2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathbf{a_{i}}^{l}=\sum_{h=1}^{H}A_{ij}^{l,h}\left(\mathbf{x_{j}}^{l-1}W_{V}^{%
l,h}\right)W_{O}^{l,h}" class="ltx_Math" display="block" id="S2.Ex2.m1.7"><semantics id="S2.Ex2.m1.7a"><mrow id="S2.Ex2.m1.7.7" xref="S2.Ex2.m1.7.7.cmml"><mmultiscripts id="S2.Ex2.m1.7.7.3" xref="S2.Ex2.m1.7.7.3.cmml"><mi id="S2.Ex2.m1.7.7.3.2.2" xref="S2.Ex2.m1.7.7.3.2.2.cmml">ğš</mi><mi id="S2.Ex2.m1.7.7.3.2.3" xref="S2.Ex2.m1.7.7.3.2.3.cmml">ğ¢</mi><mrow id="S2.Ex2.m1.7.7.3a" xref="S2.Ex2.m1.7.7.3.cmml"></mrow><mrow id="S2.Ex2.m1.7.7.3b" xref="S2.Ex2.m1.7.7.3.cmml"></mrow><mi id="S2.Ex2.m1.7.7.3.3" xref="S2.Ex2.m1.7.7.3.3.cmml">l</mi></mmultiscripts><mo id="S2.Ex2.m1.7.7.2" rspace="0.111em" xref="S2.Ex2.m1.7.7.2.cmml">=</mo><mrow id="S2.Ex2.m1.7.7.1" xref="S2.Ex2.m1.7.7.1.cmml"><munderover id="S2.Ex2.m1.7.7.1.2" xref="S2.Ex2.m1.7.7.1.2.cmml"><mo id="S2.Ex2.m1.7.7.1.2.2.2" movablelimits="false" xref="S2.Ex2.m1.7.7.1.2.2.2.cmml">âˆ‘</mo><mrow id="S2.Ex2.m1.7.7.1.2.2.3" xref="S2.Ex2.m1.7.7.1.2.2.3.cmml"><mi id="S2.Ex2.m1.7.7.1.2.2.3.2" xref="S2.Ex2.m1.7.7.1.2.2.3.2.cmml">h</mi><mo id="S2.Ex2.m1.7.7.1.2.2.3.1" xref="S2.Ex2.m1.7.7.1.2.2.3.1.cmml">=</mo><mn id="S2.Ex2.m1.7.7.1.2.2.3.3" xref="S2.Ex2.m1.7.7.1.2.2.3.3.cmml">1</mn></mrow><mi id="S2.Ex2.m1.7.7.1.2.3" xref="S2.Ex2.m1.7.7.1.2.3.cmml">H</mi></munderover><mrow id="S2.Ex2.m1.7.7.1.1" xref="S2.Ex2.m1.7.7.1.1.cmml"><msubsup id="S2.Ex2.m1.7.7.1.1.3" xref="S2.Ex2.m1.7.7.1.1.3.cmml"><mi id="S2.Ex2.m1.7.7.1.1.3.2.2" xref="S2.Ex2.m1.7.7.1.1.3.2.2.cmml">A</mi><mrow id="S2.Ex2.m1.7.7.1.1.3.2.3" xref="S2.Ex2.m1.7.7.1.1.3.2.3.cmml"><mi id="S2.Ex2.m1.7.7.1.1.3.2.3.2" xref="S2.Ex2.m1.7.7.1.1.3.2.3.2.cmml">i</mi><mo id="S2.Ex2.m1.7.7.1.1.3.2.3.1" xref="S2.Ex2.m1.7.7.1.1.3.2.3.1.cmml">â¢</mo><mi id="S2.Ex2.m1.7.7.1.1.3.2.3.3" xref="S2.Ex2.m1.7.7.1.1.3.2.3.3.cmml">j</mi></mrow><mrow id="S2.Ex2.m1.2.2.2.4" xref="S2.Ex2.m1.2.2.2.3.cmml"><mi id="S2.Ex2.m1.1.1.1.1" xref="S2.Ex2.m1.1.1.1.1.cmml">l</mi><mo id="S2.Ex2.m1.2.2.2.4.1" xref="S2.Ex2.m1.2.2.2.3.cmml">,</mo><mi id="S2.Ex2.m1.2.2.2.2" xref="S2.Ex2.m1.2.2.2.2.cmml">h</mi></mrow></msubsup><mo id="S2.Ex2.m1.7.7.1.1.2" xref="S2.Ex2.m1.7.7.1.1.2.cmml">â¢</mo><mrow id="S2.Ex2.m1.7.7.1.1.1.1" xref="S2.Ex2.m1.7.7.1.1.1.1.1.cmml"><mo id="S2.Ex2.m1.7.7.1.1.1.1.2" xref="S2.Ex2.m1.7.7.1.1.1.1.1.cmml">(</mo><mrow id="S2.Ex2.m1.7.7.1.1.1.1.1" xref="S2.Ex2.m1.7.7.1.1.1.1.1.cmml"><mmultiscripts id="S2.Ex2.m1.7.7.1.1.1.1.1.2" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.cmml"><mi id="S2.Ex2.m1.7.7.1.1.1.1.1.2.2.2" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.2.2.cmml">ğ±</mi><mi id="S2.Ex2.m1.7.7.1.1.1.1.1.2.2.3" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.2.3.cmml">ğ£</mi><mrow id="S2.Ex2.m1.7.7.1.1.1.1.1.2a" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.cmml"></mrow><mrow id="S2.Ex2.m1.7.7.1.1.1.1.1.2b" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.cmml"></mrow><mrow id="S2.Ex2.m1.7.7.1.1.1.1.1.2.3" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.cmml"><mi id="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.2" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.2.cmml">l</mi><mo id="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.1" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.1.cmml">âˆ’</mo><mn id="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.3" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.3.cmml">1</mn></mrow></mmultiscripts><mo id="S2.Ex2.m1.7.7.1.1.1.1.1.1" xref="S2.Ex2.m1.7.7.1.1.1.1.1.1.cmml">â¢</mo><msubsup id="S2.Ex2.m1.7.7.1.1.1.1.1.3" xref="S2.Ex2.m1.7.7.1.1.1.1.1.3.cmml"><mi id="S2.Ex2.m1.7.7.1.1.1.1.1.3.2.2" xref="S2.Ex2.m1.7.7.1.1.1.1.1.3.2.2.cmml">W</mi><mi id="S2.Ex2.m1.7.7.1.1.1.1.1.3.2.3" xref="S2.Ex2.m1.7.7.1.1.1.1.1.3.2.3.cmml">V</mi><mrow id="S2.Ex2.m1.4.4.2.4" xref="S2.Ex2.m1.4.4.2.3.cmml"><mi id="S2.Ex2.m1.3.3.1.1" xref="S2.Ex2.m1.3.3.1.1.cmml">l</mi><mo id="S2.Ex2.m1.4.4.2.4.1" xref="S2.Ex2.m1.4.4.2.3.cmml">,</mo><mi id="S2.Ex2.m1.4.4.2.2" xref="S2.Ex2.m1.4.4.2.2.cmml">h</mi></mrow></msubsup></mrow><mo id="S2.Ex2.m1.7.7.1.1.1.1.3" xref="S2.Ex2.m1.7.7.1.1.1.1.1.cmml">)</mo></mrow><mo id="S2.Ex2.m1.7.7.1.1.2a" xref="S2.Ex2.m1.7.7.1.1.2.cmml">â¢</mo><msubsup id="S2.Ex2.m1.7.7.1.1.4" xref="S2.Ex2.m1.7.7.1.1.4.cmml"><mi id="S2.Ex2.m1.7.7.1.1.4.2.2" xref="S2.Ex2.m1.7.7.1.1.4.2.2.cmml">W</mi><mi id="S2.Ex2.m1.7.7.1.1.4.2.3" xref="S2.Ex2.m1.7.7.1.1.4.2.3.cmml">O</mi><mrow id="S2.Ex2.m1.6.6.2.4" xref="S2.Ex2.m1.6.6.2.3.cmml"><mi id="S2.Ex2.m1.5.5.1.1" xref="S2.Ex2.m1.5.5.1.1.cmml">l</mi><mo id="S2.Ex2.m1.6.6.2.4.1" xref="S2.Ex2.m1.6.6.2.3.cmml">,</mo><mi id="S2.Ex2.m1.6.6.2.2" xref="S2.Ex2.m1.6.6.2.2.cmml">h</mi></mrow></msubsup></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex2.m1.7b"><apply id="S2.Ex2.m1.7.7.cmml" xref="S2.Ex2.m1.7.7"><eq id="S2.Ex2.m1.7.7.2.cmml" xref="S2.Ex2.m1.7.7.2"></eq><apply id="S2.Ex2.m1.7.7.3.cmml" xref="S2.Ex2.m1.7.7.3"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.3.1.cmml" xref="S2.Ex2.m1.7.7.3">superscript</csymbol><apply id="S2.Ex2.m1.7.7.3.2.cmml" xref="S2.Ex2.m1.7.7.3"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.3.2.1.cmml" xref="S2.Ex2.m1.7.7.3">subscript</csymbol><ci id="S2.Ex2.m1.7.7.3.2.2.cmml" xref="S2.Ex2.m1.7.7.3.2.2">ğš</ci><ci id="S2.Ex2.m1.7.7.3.2.3.cmml" xref="S2.Ex2.m1.7.7.3.2.3">ğ¢</ci></apply><ci id="S2.Ex2.m1.7.7.3.3.cmml" xref="S2.Ex2.m1.7.7.3.3">ğ‘™</ci></apply><apply id="S2.Ex2.m1.7.7.1.cmml" xref="S2.Ex2.m1.7.7.1"><apply id="S2.Ex2.m1.7.7.1.2.cmml" xref="S2.Ex2.m1.7.7.1.2"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.1.2.1.cmml" xref="S2.Ex2.m1.7.7.1.2">superscript</csymbol><apply id="S2.Ex2.m1.7.7.1.2.2.cmml" xref="S2.Ex2.m1.7.7.1.2"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.1.2.2.1.cmml" xref="S2.Ex2.m1.7.7.1.2">subscript</csymbol><sum id="S2.Ex2.m1.7.7.1.2.2.2.cmml" xref="S2.Ex2.m1.7.7.1.2.2.2"></sum><apply id="S2.Ex2.m1.7.7.1.2.2.3.cmml" xref="S2.Ex2.m1.7.7.1.2.2.3"><eq id="S2.Ex2.m1.7.7.1.2.2.3.1.cmml" xref="S2.Ex2.m1.7.7.1.2.2.3.1"></eq><ci id="S2.Ex2.m1.7.7.1.2.2.3.2.cmml" xref="S2.Ex2.m1.7.7.1.2.2.3.2">â„</ci><cn id="S2.Ex2.m1.7.7.1.2.2.3.3.cmml" type="integer" xref="S2.Ex2.m1.7.7.1.2.2.3.3">1</cn></apply></apply><ci id="S2.Ex2.m1.7.7.1.2.3.cmml" xref="S2.Ex2.m1.7.7.1.2.3">ğ»</ci></apply><apply id="S2.Ex2.m1.7.7.1.1.cmml" xref="S2.Ex2.m1.7.7.1.1"><times id="S2.Ex2.m1.7.7.1.1.2.cmml" xref="S2.Ex2.m1.7.7.1.1.2"></times><apply id="S2.Ex2.m1.7.7.1.1.3.cmml" xref="S2.Ex2.m1.7.7.1.1.3"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.1.1.3.1.cmml" xref="S2.Ex2.m1.7.7.1.1.3">superscript</csymbol><apply id="S2.Ex2.m1.7.7.1.1.3.2.cmml" xref="S2.Ex2.m1.7.7.1.1.3"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.1.1.3.2.1.cmml" xref="S2.Ex2.m1.7.7.1.1.3">subscript</csymbol><ci id="S2.Ex2.m1.7.7.1.1.3.2.2.cmml" xref="S2.Ex2.m1.7.7.1.1.3.2.2">ğ´</ci><apply id="S2.Ex2.m1.7.7.1.1.3.2.3.cmml" xref="S2.Ex2.m1.7.7.1.1.3.2.3"><times id="S2.Ex2.m1.7.7.1.1.3.2.3.1.cmml" xref="S2.Ex2.m1.7.7.1.1.3.2.3.1"></times><ci id="S2.Ex2.m1.7.7.1.1.3.2.3.2.cmml" xref="S2.Ex2.m1.7.7.1.1.3.2.3.2">ğ‘–</ci><ci id="S2.Ex2.m1.7.7.1.1.3.2.3.3.cmml" xref="S2.Ex2.m1.7.7.1.1.3.2.3.3">ğ‘—</ci></apply></apply><list id="S2.Ex2.m1.2.2.2.3.cmml" xref="S2.Ex2.m1.2.2.2.4"><ci id="S2.Ex2.m1.1.1.1.1.cmml" xref="S2.Ex2.m1.1.1.1.1">ğ‘™</ci><ci id="S2.Ex2.m1.2.2.2.2.cmml" xref="S2.Ex2.m1.2.2.2.2">â„</ci></list></apply><apply id="S2.Ex2.m1.7.7.1.1.1.1.1.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1"><times id="S2.Ex2.m1.7.7.1.1.1.1.1.1.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.1"></times><apply id="S2.Ex2.m1.7.7.1.1.1.1.1.2.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.1.1.1.1.1.2.1.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2">superscript</csymbol><apply id="S2.Ex2.m1.7.7.1.1.1.1.1.2.2.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.1.1.1.1.1.2.2.1.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2">subscript</csymbol><ci id="S2.Ex2.m1.7.7.1.1.1.1.1.2.2.2.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.2.2">ğ±</ci><ci id="S2.Ex2.m1.7.7.1.1.1.1.1.2.2.3.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.2.3">ğ£</ci></apply><apply id="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.3"><minus id="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.1.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.1"></minus><ci id="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.2.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.2">ğ‘™</ci><cn id="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.3.cmml" type="integer" xref="S2.Ex2.m1.7.7.1.1.1.1.1.2.3.3">1</cn></apply></apply><apply id="S2.Ex2.m1.7.7.1.1.1.1.1.3.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.1.1.1.1.1.3.1.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.3">superscript</csymbol><apply id="S2.Ex2.m1.7.7.1.1.1.1.1.3.2.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.1.1.1.1.1.3.2.1.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.3">subscript</csymbol><ci id="S2.Ex2.m1.7.7.1.1.1.1.1.3.2.2.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.3.2.2">ğ‘Š</ci><ci id="S2.Ex2.m1.7.7.1.1.1.1.1.3.2.3.cmml" xref="S2.Ex2.m1.7.7.1.1.1.1.1.3.2.3">ğ‘‰</ci></apply><list id="S2.Ex2.m1.4.4.2.3.cmml" xref="S2.Ex2.m1.4.4.2.4"><ci id="S2.Ex2.m1.3.3.1.1.cmml" xref="S2.Ex2.m1.3.3.1.1">ğ‘™</ci><ci id="S2.Ex2.m1.4.4.2.2.cmml" xref="S2.Ex2.m1.4.4.2.2">â„</ci></list></apply></apply><apply id="S2.Ex2.m1.7.7.1.1.4.cmml" xref="S2.Ex2.m1.7.7.1.1.4"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.1.1.4.1.cmml" xref="S2.Ex2.m1.7.7.1.1.4">superscript</csymbol><apply id="S2.Ex2.m1.7.7.1.1.4.2.cmml" xref="S2.Ex2.m1.7.7.1.1.4"><csymbol cd="ambiguous" id="S2.Ex2.m1.7.7.1.1.4.2.1.cmml" xref="S2.Ex2.m1.7.7.1.1.4">subscript</csymbol><ci id="S2.Ex2.m1.7.7.1.1.4.2.2.cmml" xref="S2.Ex2.m1.7.7.1.1.4.2.2">ğ‘Š</ci><ci id="S2.Ex2.m1.7.7.1.1.4.2.3.cmml" xref="S2.Ex2.m1.7.7.1.1.4.2.3">ğ‘‚</ci></apply><list id="S2.Ex2.m1.6.6.2.3.cmml" xref="S2.Ex2.m1.6.6.2.4"><ci id="S2.Ex2.m1.5.5.1.1.cmml" xref="S2.Ex2.m1.5.5.1.1">ğ‘™</ci><ci id="S2.Ex2.m1.6.6.2.2.cmml" xref="S2.Ex2.m1.6.6.2.2">â„</ci></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex2.m1.7c">\mathbf{a_{i}}^{l}=\sum_{h=1}^{H}A_{ij}^{l,h}\left(\mathbf{x_{j}}^{l-1}W_{V}^{%
l,h}\right)W_{O}^{l,h}</annotation><annotation encoding="application/x-llamapun" id="S2.Ex2.m1.7d">bold_a start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = âˆ‘ start_POSTSUBSCRIPT italic_h = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_H end_POSTSUPERSCRIPT italic_A start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l , italic_h end_POSTSUPERSCRIPT ( bold_x start_POSTSUBSCRIPT bold_j end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT italic_W start_POSTSUBSCRIPT italic_V end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l , italic_h end_POSTSUPERSCRIPT ) italic_W start_POSTSUBSCRIPT italic_O end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l , italic_h end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS1.p1.7">which dynamically refines a tokenâ€™s state by aggregating information from others. This is quantified using the attention weightsderived from the softmax-normalized product of â€™queryâ€™ and â€™keyâ€™ projections, allowing for a contextual understanding of the sequence.</p>
</div>
<div class="ltx_para" id="S2.SS1.p2">
<p class="ltx_p" id="S2.SS1.p2.2">The MLPâ€™s role is to further transform the token states, ensuring the storage and transfer of factual knowledge from the query. The MLP layer <math alttext="\mathbf{m_{i}}^{l}" class="ltx_Math" display="inline" id="S2.SS1.p2.1.m1.1"><semantics id="S2.SS1.p2.1.m1.1a"><mmultiscripts id="S2.SS1.p2.1.m1.1.1" xref="S2.SS1.p2.1.m1.1.1.cmml"><mi id="S2.SS1.p2.1.m1.1.1.2.2" xref="S2.SS1.p2.1.m1.1.1.2.2.cmml">ğ¦</mi><mi id="S2.SS1.p2.1.m1.1.1.2.3" xref="S2.SS1.p2.1.m1.1.1.2.3.cmml">ğ¢</mi><mrow id="S2.SS1.p2.1.m1.1.1a" xref="S2.SS1.p2.1.m1.1.1.cmml"></mrow><mrow id="S2.SS1.p2.1.m1.1.1b" xref="S2.SS1.p2.1.m1.1.1.cmml"></mrow><mi id="S2.SS1.p2.1.m1.1.1.3" xref="S2.SS1.p2.1.m1.1.1.3.cmml">l</mi></mmultiscripts><annotation-xml encoding="MathML-Content" id="S2.SS1.p2.1.m1.1b"><apply id="S2.SS1.p2.1.m1.1.1.cmml" xref="S2.SS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS1.p2.1.m1.1.1.1.cmml" xref="S2.SS1.p2.1.m1.1.1">superscript</csymbol><apply id="S2.SS1.p2.1.m1.1.1.2.cmml" xref="S2.SS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS1.p2.1.m1.1.1.2.1.cmml" xref="S2.SS1.p2.1.m1.1.1">subscript</csymbol><ci id="S2.SS1.p2.1.m1.1.1.2.2.cmml" xref="S2.SS1.p2.1.m1.1.1.2.2">ğ¦</ci><ci id="S2.SS1.p2.1.m1.1.1.2.3.cmml" xref="S2.SS1.p2.1.m1.1.1.2.3">ğ¢</ci></apply><ci id="S2.SS1.p2.1.m1.1.1.3.cmml" xref="S2.SS1.p2.1.m1.1.1.3">ğ‘™</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p2.1.m1.1c">\mathbf{m_{i}}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p2.1.m1.1d">bold_m start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> is computed based on its previous layers where neuron <math alttext="i" class="ltx_Math" display="inline" id="S2.SS1.p2.2.m2.1"><semantics id="S2.SS1.p2.2.m2.1a"><mi id="S2.SS1.p2.2.m2.1.1" xref="S2.SS1.p2.2.m2.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p2.2.m2.1b"><ci id="S2.SS1.p2.2.m2.1.1.cmml" xref="S2.SS1.p2.2.m2.1.1">ğ‘–</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p2.2.m2.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p2.2.m2.1d">italic_i</annotation></semantics></math> attends to the previous states from other tokens, i.e. :</p>
<table class="ltx_equation ltx_eqn_table" id="S2.Ex3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathbf{m_{i}}^{l}=W_{proj}^{l}\sigma\left(W_{fc}^{l}\left(\mathbf{a_{i}}^{l}+%
\mathbf{h_{i}}^{l-1}\right)\right)" class="ltx_Math" display="block" id="S2.Ex3.m1.1"><semantics id="S2.Ex3.m1.1a"><mrow id="S2.Ex3.m1.1.1" xref="S2.Ex3.m1.1.1.cmml"><mmultiscripts id="S2.Ex3.m1.1.1.3" xref="S2.Ex3.m1.1.1.3.cmml"><mi id="S2.Ex3.m1.1.1.3.2.2" xref="S2.Ex3.m1.1.1.3.2.2.cmml">ğ¦</mi><mi id="S2.Ex3.m1.1.1.3.2.3" xref="S2.Ex3.m1.1.1.3.2.3.cmml">ğ¢</mi><mrow id="S2.Ex3.m1.1.1.3a" xref="S2.Ex3.m1.1.1.3.cmml"></mrow><mrow id="S2.Ex3.m1.1.1.3b" xref="S2.Ex3.m1.1.1.3.cmml"></mrow><mi id="S2.Ex3.m1.1.1.3.3" xref="S2.Ex3.m1.1.1.3.3.cmml">l</mi></mmultiscripts><mo id="S2.Ex3.m1.1.1.2" xref="S2.Ex3.m1.1.1.2.cmml">=</mo><mrow id="S2.Ex3.m1.1.1.1" xref="S2.Ex3.m1.1.1.1.cmml"><msubsup id="S2.Ex3.m1.1.1.1.3" xref="S2.Ex3.m1.1.1.1.3.cmml"><mi id="S2.Ex3.m1.1.1.1.3.2.2" xref="S2.Ex3.m1.1.1.1.3.2.2.cmml">W</mi><mrow id="S2.Ex3.m1.1.1.1.3.2.3" xref="S2.Ex3.m1.1.1.1.3.2.3.cmml"><mi id="S2.Ex3.m1.1.1.1.3.2.3.2" xref="S2.Ex3.m1.1.1.1.3.2.3.2.cmml">p</mi><mo id="S2.Ex3.m1.1.1.1.3.2.3.1" xref="S2.Ex3.m1.1.1.1.3.2.3.1.cmml">â¢</mo><mi id="S2.Ex3.m1.1.1.1.3.2.3.3" xref="S2.Ex3.m1.1.1.1.3.2.3.3.cmml">r</mi><mo id="S2.Ex3.m1.1.1.1.3.2.3.1a" xref="S2.Ex3.m1.1.1.1.3.2.3.1.cmml">â¢</mo><mi id="S2.Ex3.m1.1.1.1.3.2.3.4" xref="S2.Ex3.m1.1.1.1.3.2.3.4.cmml">o</mi><mo id="S2.Ex3.m1.1.1.1.3.2.3.1b" xref="S2.Ex3.m1.1.1.1.3.2.3.1.cmml">â¢</mo><mi id="S2.Ex3.m1.1.1.1.3.2.3.5" xref="S2.Ex3.m1.1.1.1.3.2.3.5.cmml">j</mi></mrow><mi id="S2.Ex3.m1.1.1.1.3.3" xref="S2.Ex3.m1.1.1.1.3.3.cmml">l</mi></msubsup><mo id="S2.Ex3.m1.1.1.1.2" xref="S2.Ex3.m1.1.1.1.2.cmml">â¢</mo><mi id="S2.Ex3.m1.1.1.1.4" xref="S2.Ex3.m1.1.1.1.4.cmml">Ïƒ</mi><mo id="S2.Ex3.m1.1.1.1.2a" xref="S2.Ex3.m1.1.1.1.2.cmml">â¢</mo><mrow id="S2.Ex3.m1.1.1.1.1.1" xref="S2.Ex3.m1.1.1.1.1.1.1.cmml"><mo id="S2.Ex3.m1.1.1.1.1.1.2" xref="S2.Ex3.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.Ex3.m1.1.1.1.1.1.1" xref="S2.Ex3.m1.1.1.1.1.1.1.cmml"><msubsup id="S2.Ex3.m1.1.1.1.1.1.1.3" xref="S2.Ex3.m1.1.1.1.1.1.1.3.cmml"><mi id="S2.Ex3.m1.1.1.1.1.1.1.3.2.2" xref="S2.Ex3.m1.1.1.1.1.1.1.3.2.2.cmml">W</mi><mrow id="S2.Ex3.m1.1.1.1.1.1.1.3.2.3" xref="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.cmml"><mi id="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.2" xref="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.2.cmml">f</mi><mo id="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.1" xref="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.1.cmml">â¢</mo><mi id="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.3" xref="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.3.cmml">c</mi></mrow><mi id="S2.Ex3.m1.1.1.1.1.1.1.3.3" xref="S2.Ex3.m1.1.1.1.1.1.1.3.3.cmml">l</mi></msubsup><mo id="S2.Ex3.m1.1.1.1.1.1.1.2" xref="S2.Ex3.m1.1.1.1.1.1.1.2.cmml">â¢</mo><mrow id="S2.Ex3.m1.1.1.1.1.1.1.1.1" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S2.Ex3.m1.1.1.1.1.1.1.1.1.2" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.cmml"><mmultiscripts id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.2.2" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.2.2.cmml">ğš</mi><mi id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.2.3" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.2.3.cmml">ğ¢</mi><mrow id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2a" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.cmml"></mrow><mrow id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2b" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.cmml"></mrow><mi id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.3" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.3.cmml">l</mi></mmultiscripts><mo id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.1" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.1.cmml">+</mo><mmultiscripts id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.2.2" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.2.2.cmml">ğ¡</mi><mi id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.2.3" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.2.3.cmml">ğ¢</mi><mrow id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3a" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.cmml"></mrow><mrow id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3b" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.cmml"></mrow><mrow id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.cmml"><mi id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.2" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.2.cmml">l</mi><mo id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.1" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.1.cmml">âˆ’</mo><mn id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.3" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.3.cmml">1</mn></mrow></mmultiscripts></mrow><mo id="S2.Ex3.m1.1.1.1.1.1.1.1.1.3" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.Ex3.m1.1.1.1.1.1.3" xref="S2.Ex3.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex3.m1.1b"><apply id="S2.Ex3.m1.1.1.cmml" xref="S2.Ex3.m1.1.1"><eq id="S2.Ex3.m1.1.1.2.cmml" xref="S2.Ex3.m1.1.1.2"></eq><apply id="S2.Ex3.m1.1.1.3.cmml" xref="S2.Ex3.m1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex3.m1.1.1.3.1.cmml" xref="S2.Ex3.m1.1.1.3">superscript</csymbol><apply id="S2.Ex3.m1.1.1.3.2.cmml" xref="S2.Ex3.m1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex3.m1.1.1.3.2.1.cmml" xref="S2.Ex3.m1.1.1.3">subscript</csymbol><ci id="S2.Ex3.m1.1.1.3.2.2.cmml" xref="S2.Ex3.m1.1.1.3.2.2">ğ¦</ci><ci id="S2.Ex3.m1.1.1.3.2.3.cmml" xref="S2.Ex3.m1.1.1.3.2.3">ğ¢</ci></apply><ci id="S2.Ex3.m1.1.1.3.3.cmml" xref="S2.Ex3.m1.1.1.3.3">ğ‘™</ci></apply><apply id="S2.Ex3.m1.1.1.1.cmml" xref="S2.Ex3.m1.1.1.1"><times id="S2.Ex3.m1.1.1.1.2.cmml" xref="S2.Ex3.m1.1.1.1.2"></times><apply id="S2.Ex3.m1.1.1.1.3.cmml" xref="S2.Ex3.m1.1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex3.m1.1.1.1.3.1.cmml" xref="S2.Ex3.m1.1.1.1.3">superscript</csymbol><apply id="S2.Ex3.m1.1.1.1.3.2.cmml" xref="S2.Ex3.m1.1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex3.m1.1.1.1.3.2.1.cmml" xref="S2.Ex3.m1.1.1.1.3">subscript</csymbol><ci id="S2.Ex3.m1.1.1.1.3.2.2.cmml" xref="S2.Ex3.m1.1.1.1.3.2.2">ğ‘Š</ci><apply id="S2.Ex3.m1.1.1.1.3.2.3.cmml" xref="S2.Ex3.m1.1.1.1.3.2.3"><times id="S2.Ex3.m1.1.1.1.3.2.3.1.cmml" xref="S2.Ex3.m1.1.1.1.3.2.3.1"></times><ci id="S2.Ex3.m1.1.1.1.3.2.3.2.cmml" xref="S2.Ex3.m1.1.1.1.3.2.3.2">ğ‘</ci><ci id="S2.Ex3.m1.1.1.1.3.2.3.3.cmml" xref="S2.Ex3.m1.1.1.1.3.2.3.3">ğ‘Ÿ</ci><ci id="S2.Ex3.m1.1.1.1.3.2.3.4.cmml" xref="S2.Ex3.m1.1.1.1.3.2.3.4">ğ‘œ</ci><ci id="S2.Ex3.m1.1.1.1.3.2.3.5.cmml" xref="S2.Ex3.m1.1.1.1.3.2.3.5">ğ‘—</ci></apply></apply><ci id="S2.Ex3.m1.1.1.1.3.3.cmml" xref="S2.Ex3.m1.1.1.1.3.3">ğ‘™</ci></apply><ci id="S2.Ex3.m1.1.1.1.4.cmml" xref="S2.Ex3.m1.1.1.1.4">ğœ</ci><apply id="S2.Ex3.m1.1.1.1.1.1.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1"><times id="S2.Ex3.m1.1.1.1.1.1.1.2.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.2"></times><apply id="S2.Ex3.m1.1.1.1.1.1.1.3.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex3.m1.1.1.1.1.1.1.3.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.3">superscript</csymbol><apply id="S2.Ex3.m1.1.1.1.1.1.1.3.2.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex3.m1.1.1.1.1.1.1.3.2.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S2.Ex3.m1.1.1.1.1.1.1.3.2.2.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.3.2.2">ğ‘Š</ci><apply id="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.3.2.3"><times id="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.1"></times><ci id="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.2.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.2">ğ‘“</ci><ci id="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.3.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.3.2.3.3">ğ‘</ci></apply></apply><ci id="S2.Ex3.m1.1.1.1.1.1.1.3.3.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.3.3">ğ‘™</ci></apply><apply id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1"><plus id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.1"></plus><apply id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2">superscript</csymbol><apply id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.2.2">ğš</ci><ci id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.2.3">ğ¢</ci></apply><ci id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.2.3">ğ‘™</ci></apply><apply id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3">superscript</csymbol><apply id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.2.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.2.2.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.2.2">ğ¡</ci><ci id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.2.3.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.2.3">ğ¢</ci></apply><apply id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3"><minus id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.1.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.1"></minus><ci id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.2.cmml" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.2">ğ‘™</ci><cn id="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.3.cmml" type="integer" xref="S2.Ex3.m1.1.1.1.1.1.1.1.1.1.3.3.3">1</cn></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex3.m1.1c">\mathbf{m_{i}}^{l}=W_{proj}^{l}\sigma\left(W_{fc}^{l}\left(\mathbf{a_{i}}^{l}+%
\mathbf{h_{i}}^{l-1}\right)\right)</annotation><annotation encoding="application/x-llamapun" id="S2.Ex3.m1.1d">bold_m start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = italic_W start_POSTSUBSCRIPT italic_p italic_r italic_o italic_j end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT italic_Ïƒ ( italic_W start_POSTSUBSCRIPT italic_f italic_c end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT ( bold_a start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT + bold_h start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS1.p2.3">Recent workÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib24" title="">meng2022locating, </a>)</cite> indicates that LLMs utilize MLP layers to store relationships and factual information. The factual information is located through input queries. Effectively, the MLP layersâ€™ activation patterns provide signals to where the information is stored inside.
SAT probeÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib18" title="">yuksekgonul2023attention, </a>)</cite> models factual queries as a constraint satisfaction problem. It exploits the attention on constrained tokens of LLMs to detect factually incorrect text they produce. We discover that the last layer of LLM provides sufficient information to reveal the pattern of factual inaccuracies in its output.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2. </span>Adversarial attacks on LLMs and RAG</h3>
<div class="ltx_para" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.1">LLMs are vulnerable to adversarial attacksÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib8" title="">wang2023robustness, </a>)</cite> applied to general deep neural networksÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib6" title="">goodfellow2014explaining, </a>)</cite>. Work likeÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib28" title="">morris2020textattack, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib29" title="">jin2020bert, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib30" title="">liu2023adversarial, </a>)</cite> show how to craft deceptive inputs that manipulate model outputs with such approaches.
Gradient-based attacks leverage model internals to orchestrate manipulations of token generationÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib31" title="">guo2021gradient, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib9" title="">ebrahimi2017hotflip, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib10" title="">wallace2019universal, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib11" title="">zou2023universal, </a>)</cite>. As an example, the Greedy Coordinate Gradient(GCG) algorithmÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib11" title="">zou2023universal, </a>)</cite> minimizes the loss of generating a text sequence deviating from the guardrails by using gradients to identify tokens that maximize the loss reduction and swap them. Our method uses GCG to achieve a different goal of finding tokens that satisfy distance constraints in the embedding space.</p>
</div>
<div class="ltx_para" id="S2.SS2.p2">
<p class="ltx_p" id="S2.SS2.p2.1">To deal with the problem that LLMs generate factually incorrect text, LLMs increasingly incorporate functionalities to retrieve extensive external information, thereby enhancing context relevance and reducing parameter countsÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib13" title="">borgeaud2022improving, </a>)</cite>. These enhanced models, capable of querying external databases, use reasoning strategies for context refinement, known as non-parametric modelsÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib32" title="">wei2022chain, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib33" title="">taylor2022galactica, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib34" title="">yang2022re3, </a>)</cite>. By incorporating the external data, the credibility and stability of LLMs are improved.</p>
</div>
<div class="ltx_para" id="S2.SS2.p3">
<p class="ltx_p" id="S2.SS2.p3.1">In addition, necessary external knowledge can be searched from
external documents by pre-trained neural retrievers. The Retrieval-Augmented Generation (RAG) approachÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib12" title="">lewis2020retrieval, </a>)</cite>, combines retrieval mechanisms with generative models, significantly advancing natural language processing by enabling access to detailed, factual information. The adoption of bi-encoder architectures for dense vector embeddings of queries and texts, as discussed byÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib2" title="">mialon2023augmented, </a>)</cite>, represents a shift in neural network applications, enhancing retrieval functions in LLMs. Lucene, an open-source search library, integrates LLM embeddings for vector search, challenging the necessity of dedicated vector stores and demonstrating the potential within the Lucene frameworkÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib14" title="">lin2023vector, </a>)</cite>. The inclusion of Hierarchical Navigable Small-World (HNSW) indexing in LuceneÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib35" title="">malkov2018efficient, </a>)</cite> exemplifies the assimilation of advanced capabilities into mainstream software, reflecting the rapid advancements and adaptability of the software ecosystem.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3. </span>Gradient Guided Prompt Perturbation</h2>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">Unlike previous work on adversarial prompts to attack aligned LLMsÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib11" title="">zou2023universal, </a>)</cite>, the focus of our work is to generate short prefixes to manipulate the retrieval results of RAG based LLMs. The flexibility of LLMs is both a boon and a vulnerabilityÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib36" title="">shi2023large, </a>)</cite>, a duality that becomes evident through the application of systematic prompt perturbation techniques. In this section, we describe the proposed Gradient Guided Prompt Perturbation(GGPP) technique in detail. We first formulate the RAG architecture, and then introduce how GGPP shifts the resultant embedding vector within the LLMâ€™s embedding space toward a targeted location in the representation space. GGPP not only makes the model generate an incorrect retrieval result, but also pushes the original factual retrieval results out of the top-K retrieved entries in the output.</p>
</div>
<figure class="ltx_figure" id="S3.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="460" id="S3.F2.g1" src="x2.png" width="623"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2. </span>The GGPP workflow: the top shows how the prefix affects the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.F2.2.m1.1"><semantics id="S3.F2.2.m1.1b"><mi id="S3.F2.2.m1.1.1" xref="S3.F2.2.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.F2.2.m1.1c"><ci id="S3.F2.2.m1.1.1.cmml" xref="S3.F2.2.m1.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F2.2.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="S3.F2.2.m1.1e">italic_k</annotation></semantics></math> retrieval result. The text and arrows in red indicate perturbation, altering the ranking of orginal correct and targeted incorrect passages. The bottom shows the prefix optimization process.</figcaption>
</figure>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1. </span>RAG workflow of GGPP</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.1">RAG extracts relevant passages from a collection, denoted by <math alttext="X=\{X_{1},...,X_{n}\}" class="ltx_Math" display="inline" id="S3.SS1.p1.1.m1.3"><semantics id="S3.SS1.p1.1.m1.3a"><mrow id="S3.SS1.p1.1.m1.3.3" xref="S3.SS1.p1.1.m1.3.3.cmml"><mi id="S3.SS1.p1.1.m1.3.3.4" xref="S3.SS1.p1.1.m1.3.3.4.cmml">X</mi><mo id="S3.SS1.p1.1.m1.3.3.3" xref="S3.SS1.p1.1.m1.3.3.3.cmml">=</mo><mrow id="S3.SS1.p1.1.m1.3.3.2.2" xref="S3.SS1.p1.1.m1.3.3.2.3.cmml"><mo id="S3.SS1.p1.1.m1.3.3.2.2.3" stretchy="false" xref="S3.SS1.p1.1.m1.3.3.2.3.cmml">{</mo><msub id="S3.SS1.p1.1.m1.2.2.1.1.1" xref="S3.SS1.p1.1.m1.2.2.1.1.1.cmml"><mi id="S3.SS1.p1.1.m1.2.2.1.1.1.2" xref="S3.SS1.p1.1.m1.2.2.1.1.1.2.cmml">X</mi><mn id="S3.SS1.p1.1.m1.2.2.1.1.1.3" xref="S3.SS1.p1.1.m1.2.2.1.1.1.3.cmml">1</mn></msub><mo id="S3.SS1.p1.1.m1.3.3.2.2.4" xref="S3.SS1.p1.1.m1.3.3.2.3.cmml">,</mo><mi id="S3.SS1.p1.1.m1.1.1" mathvariant="normal" xref="S3.SS1.p1.1.m1.1.1.cmml">â€¦</mi><mo id="S3.SS1.p1.1.m1.3.3.2.2.5" xref="S3.SS1.p1.1.m1.3.3.2.3.cmml">,</mo><msub id="S3.SS1.p1.1.m1.3.3.2.2.2" xref="S3.SS1.p1.1.m1.3.3.2.2.2.cmml"><mi id="S3.SS1.p1.1.m1.3.3.2.2.2.2" xref="S3.SS1.p1.1.m1.3.3.2.2.2.2.cmml">X</mi><mi id="S3.SS1.p1.1.m1.3.3.2.2.2.3" xref="S3.SS1.p1.1.m1.3.3.2.2.2.3.cmml">n</mi></msub><mo id="S3.SS1.p1.1.m1.3.3.2.2.6" stretchy="false" xref="S3.SS1.p1.1.m1.3.3.2.3.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.1.m1.3b"><apply id="S3.SS1.p1.1.m1.3.3.cmml" xref="S3.SS1.p1.1.m1.3.3"><eq id="S3.SS1.p1.1.m1.3.3.3.cmml" xref="S3.SS1.p1.1.m1.3.3.3"></eq><ci id="S3.SS1.p1.1.m1.3.3.4.cmml" xref="S3.SS1.p1.1.m1.3.3.4">ğ‘‹</ci><set id="S3.SS1.p1.1.m1.3.3.2.3.cmml" xref="S3.SS1.p1.1.m1.3.3.2.2"><apply id="S3.SS1.p1.1.m1.2.2.1.1.1.cmml" xref="S3.SS1.p1.1.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.1.m1.2.2.1.1.1.1.cmml" xref="S3.SS1.p1.1.m1.2.2.1.1.1">subscript</csymbol><ci id="S3.SS1.p1.1.m1.2.2.1.1.1.2.cmml" xref="S3.SS1.p1.1.m1.2.2.1.1.1.2">ğ‘‹</ci><cn id="S3.SS1.p1.1.m1.2.2.1.1.1.3.cmml" type="integer" xref="S3.SS1.p1.1.m1.2.2.1.1.1.3">1</cn></apply><ci id="S3.SS1.p1.1.m1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1">â€¦</ci><apply id="S3.SS1.p1.1.m1.3.3.2.2.2.cmml" xref="S3.SS1.p1.1.m1.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.1.m1.3.3.2.2.2.1.cmml" xref="S3.SS1.p1.1.m1.3.3.2.2.2">subscript</csymbol><ci id="S3.SS1.p1.1.m1.3.3.2.2.2.2.cmml" xref="S3.SS1.p1.1.m1.3.3.2.2.2.2">ğ‘‹</ci><ci id="S3.SS1.p1.1.m1.3.3.2.2.2.3.cmml" xref="S3.SS1.p1.1.m1.3.3.2.2.2.3">ğ‘›</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.1.m1.3c">X=\{X_{1},...,X_{n}\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.1.m1.3d">italic_X = { italic_X start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , â€¦ , italic_X start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT }</annotation></semantics></math> as the context for answering a user question. In our scenario, RAG contains the following components:</p>
<ul class="ltx_itemize" id="S3.I1">
<li class="ltx_item" id="S3.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">â€¢</span>
<div class="ltx_para" id="S3.I1.i1.p1">
<p class="ltx_p" id="S3.I1.i1.p1.3"><span class="ltx_text ltx_font_bold" id="S3.I1.i1.p1.3.1">Retriever:</span> assume a user question is <math alttext="u" class="ltx_Math" display="inline" id="S3.I1.i1.p1.1.m1.1"><semantics id="S3.I1.i1.p1.1.m1.1a"><mi id="S3.I1.i1.p1.1.m1.1.1" xref="S3.I1.i1.p1.1.m1.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.1.m1.1b"><ci id="S3.I1.i1.p1.1.m1.1.1.cmml" xref="S3.I1.i1.p1.1.m1.1.1">ğ‘¢</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.1.m1.1c">u</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i1.p1.1.m1.1d">italic_u</annotation></semantics></math>, the retriever is defined as a function that produces a conditional probability distribution of <math alttext="X" class="ltx_Math" display="inline" id="S3.I1.i1.p1.2.m2.1"><semantics id="S3.I1.i1.p1.2.m2.1a"><mi id="S3.I1.i1.p1.2.m2.1.1" xref="S3.I1.i1.p1.2.m2.1.1.cmml">X</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.2.m2.1b"><ci id="S3.I1.i1.p1.2.m2.1.1.cmml" xref="S3.I1.i1.p1.2.m2.1.1">ğ‘‹</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.2.m2.1c">X</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i1.p1.2.m2.1d">italic_X</annotation></semantics></math> given <math alttext="u" class="ltx_Math" display="inline" id="S3.I1.i1.p1.3.m3.1"><semantics id="S3.I1.i1.p1.3.m3.1a"><mi id="S3.I1.i1.p1.3.m3.1.1" xref="S3.I1.i1.p1.3.m3.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.3.m3.1b"><ci id="S3.I1.i1.p1.3.m3.1.1.cmml" xref="S3.I1.i1.p1.3.m3.1.1">ğ‘¢</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.3.m3.1c">u</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i1.p1.3.m3.1d">italic_u</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="X_{u}=\text{argmax}_{k}(P_{\theta}(X|u))" class="ltx_Math" display="block" id="S3.Ex4.m1.1"><semantics id="S3.Ex4.m1.1a"><mrow id="S3.Ex4.m1.1.1" xref="S3.Ex4.m1.1.1.cmml"><msub id="S3.Ex4.m1.1.1.3" xref="S3.Ex4.m1.1.1.3.cmml"><mi id="S3.Ex4.m1.1.1.3.2" xref="S3.Ex4.m1.1.1.3.2.cmml">X</mi><mi id="S3.Ex4.m1.1.1.3.3" xref="S3.Ex4.m1.1.1.3.3.cmml">u</mi></msub><mo id="S3.Ex4.m1.1.1.2" xref="S3.Ex4.m1.1.1.2.cmml">=</mo><mrow id="S3.Ex4.m1.1.1.1" xref="S3.Ex4.m1.1.1.1.cmml"><msub id="S3.Ex4.m1.1.1.1.3" xref="S3.Ex4.m1.1.1.1.3.cmml"><mtext id="S3.Ex4.m1.1.1.1.3.2" xref="S3.Ex4.m1.1.1.1.3.2a.cmml">argmax</mtext><mi id="S3.Ex4.m1.1.1.1.3.3" xref="S3.Ex4.m1.1.1.1.3.3.cmml">k</mi></msub><mo id="S3.Ex4.m1.1.1.1.2" xref="S3.Ex4.m1.1.1.1.2.cmml">â¢</mo><mrow id="S3.Ex4.m1.1.1.1.1.1" xref="S3.Ex4.m1.1.1.1.1.1.1.cmml"><mo id="S3.Ex4.m1.1.1.1.1.1.2" stretchy="false" xref="S3.Ex4.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.Ex4.m1.1.1.1.1.1.1" xref="S3.Ex4.m1.1.1.1.1.1.1.cmml"><msub id="S3.Ex4.m1.1.1.1.1.1.1.3" xref="S3.Ex4.m1.1.1.1.1.1.1.3.cmml"><mi id="S3.Ex4.m1.1.1.1.1.1.1.3.2" xref="S3.Ex4.m1.1.1.1.1.1.1.3.2.cmml">P</mi><mi id="S3.Ex4.m1.1.1.1.1.1.1.3.3" xref="S3.Ex4.m1.1.1.1.1.1.1.3.3.cmml">Î¸</mi></msub><mo id="S3.Ex4.m1.1.1.1.1.1.1.2" xref="S3.Ex4.m1.1.1.1.1.1.1.2.cmml">â¢</mo><mrow id="S3.Ex4.m1.1.1.1.1.1.1.1.1" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.Ex4.m1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.Ex4.m1.1.1.1.1.1.1.1.1.1" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.2" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mo fence="false" id="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.1" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.1.cmml">|</mo><mi id="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.3" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.3.cmml">u</mi></mrow><mo id="S3.Ex4.m1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.Ex4.m1.1.1.1.1.1.3" stretchy="false" xref="S3.Ex4.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex4.m1.1b"><apply id="S3.Ex4.m1.1.1.cmml" xref="S3.Ex4.m1.1.1"><eq id="S3.Ex4.m1.1.1.2.cmml" xref="S3.Ex4.m1.1.1.2"></eq><apply id="S3.Ex4.m1.1.1.3.cmml" xref="S3.Ex4.m1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex4.m1.1.1.3.1.cmml" xref="S3.Ex4.m1.1.1.3">subscript</csymbol><ci id="S3.Ex4.m1.1.1.3.2.cmml" xref="S3.Ex4.m1.1.1.3.2">ğ‘‹</ci><ci id="S3.Ex4.m1.1.1.3.3.cmml" xref="S3.Ex4.m1.1.1.3.3">ğ‘¢</ci></apply><apply id="S3.Ex4.m1.1.1.1.cmml" xref="S3.Ex4.m1.1.1.1"><times id="S3.Ex4.m1.1.1.1.2.cmml" xref="S3.Ex4.m1.1.1.1.2"></times><apply id="S3.Ex4.m1.1.1.1.3.cmml" xref="S3.Ex4.m1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex4.m1.1.1.1.3.1.cmml" xref="S3.Ex4.m1.1.1.1.3">subscript</csymbol><ci id="S3.Ex4.m1.1.1.1.3.2a.cmml" xref="S3.Ex4.m1.1.1.1.3.2"><mtext id="S3.Ex4.m1.1.1.1.3.2.cmml" xref="S3.Ex4.m1.1.1.1.3.2">argmax</mtext></ci><ci id="S3.Ex4.m1.1.1.1.3.3.cmml" xref="S3.Ex4.m1.1.1.1.3.3">ğ‘˜</ci></apply><apply id="S3.Ex4.m1.1.1.1.1.1.1.cmml" xref="S3.Ex4.m1.1.1.1.1.1"><times id="S3.Ex4.m1.1.1.1.1.1.1.2.cmml" xref="S3.Ex4.m1.1.1.1.1.1.1.2"></times><apply id="S3.Ex4.m1.1.1.1.1.1.1.3.cmml" xref="S3.Ex4.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex4.m1.1.1.1.1.1.1.3.1.cmml" xref="S3.Ex4.m1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.Ex4.m1.1.1.1.1.1.1.3.2.cmml" xref="S3.Ex4.m1.1.1.1.1.1.1.3.2">ğ‘ƒ</ci><ci id="S3.Ex4.m1.1.1.1.1.1.1.3.3.cmml" xref="S3.Ex4.m1.1.1.1.1.1.1.3.3">ğœƒ</ci></apply><apply id="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1"><csymbol cd="latexml" id="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.2">ğ‘‹</ci><ci id="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.Ex4.m1.1.1.1.1.1.1.1.1.1.3">ğ‘¢</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex4.m1.1c">X_{u}=\text{argmax}_{k}(P_{\theta}(X|u))</annotation><annotation encoding="application/x-llamapun" id="S3.Ex4.m1.1d">italic_X start_POSTSUBSCRIPT italic_u end_POSTSUBSCRIPT = argmax start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_P start_POSTSUBSCRIPT italic_Î¸ end_POSTSUBSCRIPT ( italic_X | italic_u ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.I1.i1.p1.7">The top-<math alttext="k" class="ltx_Math" display="inline" id="S3.I1.i1.p1.4.m1.1"><semantics id="S3.I1.i1.p1.4.m1.1a"><mi id="S3.I1.i1.p1.4.m1.1.1" xref="S3.I1.i1.p1.4.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.4.m1.1b"><ci id="S3.I1.i1.p1.4.m1.1.1.cmml" xref="S3.I1.i1.p1.4.m1.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.4.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i1.p1.4.m1.1d">italic_k</annotation></semantics></math> passages with the highest probability are returned as the context. The probability is often proportional to the distance between <math alttext="u" class="ltx_Math" display="inline" id="S3.I1.i1.p1.5.m2.1"><semantics id="S3.I1.i1.p1.5.m2.1a"><mi id="S3.I1.i1.p1.5.m2.1.1" xref="S3.I1.i1.p1.5.m2.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.5.m2.1b"><ci id="S3.I1.i1.p1.5.m2.1.1.cmml" xref="S3.I1.i1.p1.5.m2.1.1">ğ‘¢</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.5.m2.1c">u</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i1.p1.5.m2.1d">italic_u</annotation></semantics></math> and <math alttext="X_{i}" class="ltx_Math" display="inline" id="S3.I1.i1.p1.6.m3.1"><semantics id="S3.I1.i1.p1.6.m3.1a"><msub id="S3.I1.i1.p1.6.m3.1.1" xref="S3.I1.i1.p1.6.m3.1.1.cmml"><mi id="S3.I1.i1.p1.6.m3.1.1.2" xref="S3.I1.i1.p1.6.m3.1.1.2.cmml">X</mi><mi id="S3.I1.i1.p1.6.m3.1.1.3" xref="S3.I1.i1.p1.6.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.6.m3.1b"><apply id="S3.I1.i1.p1.6.m3.1.1.cmml" xref="S3.I1.i1.p1.6.m3.1.1"><csymbol cd="ambiguous" id="S3.I1.i1.p1.6.m3.1.1.1.cmml" xref="S3.I1.i1.p1.6.m3.1.1">subscript</csymbol><ci id="S3.I1.i1.p1.6.m3.1.1.2.cmml" xref="S3.I1.i1.p1.6.m3.1.1.2">ğ‘‹</ci><ci id="S3.I1.i1.p1.6.m3.1.1.3.cmml" xref="S3.I1.i1.p1.6.m3.1.1.3">ğ‘–</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.6.m3.1c">X_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i1.p1.6.m3.1d">italic_X start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> in a representation space formed by the embedding vectors of dataÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib37" title="">muennighoff2022mteb, </a>)</cite>. We denote such an embedding model <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S3.I1.i1.p1.7.m4.1"><semantics id="S3.I1.i1.p1.7.m4.1a"><mi class="ltx_font_mathcaligraphic" id="S3.I1.i1.p1.7.m4.1.1" xref="S3.I1.i1.p1.7.m4.1.1.cmml">â„³</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i1.p1.7.m4.1b"><ci id="S3.I1.i1.p1.7.m4.1.1.cmml" xref="S3.I1.i1.p1.7.m4.1.1">â„³</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i1.p1.7.m4.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i1.p1.7.m4.1d">caligraphic_M</annotation></semantics></math>.</p>
</div>
</li>
<li class="ltx_item" id="S3.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">â€¢</span>
<div class="ltx_para" id="S3.I1.i2.p1">
<p class="ltx_p" id="S3.I1.i2.p1.3"><span class="ltx_text ltx_font_bold" id="S3.I1.i2.p1.3.1">Generator:</span> assume a token dictionary for generation is <math alttext="D" class="ltx_Math" display="inline" id="S3.I1.i2.p1.1.m1.1"><semantics id="S3.I1.i2.p1.1.m1.1a"><mi id="S3.I1.i2.p1.1.m1.1.1" xref="S3.I1.i2.p1.1.m1.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.1.m1.1b"><ci id="S3.I1.i2.p1.1.m1.1.1.cmml" xref="S3.I1.i2.p1.1.m1.1.1">ğ·</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.1.m1.1c">D</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i2.p1.1.m1.1d">italic_D</annotation></semantics></math>, the generator produces a probability distribution on the tokens in the dictionary conditioned on <math alttext="u" class="ltx_Math" display="inline" id="S3.I1.i2.p1.2.m2.1"><semantics id="S3.I1.i2.p1.2.m2.1a"><mi id="S3.I1.i2.p1.2.m2.1.1" xref="S3.I1.i2.p1.2.m2.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.2.m2.1b"><ci id="S3.I1.i2.p1.2.m2.1.1.cmml" xref="S3.I1.i2.p1.2.m2.1.1">ğ‘¢</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.2.m2.1c">u</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i2.p1.2.m2.1d">italic_u</annotation></semantics></math>, <math alttext="X_{u}" class="ltx_Math" display="inline" id="S3.I1.i2.p1.3.m3.1"><semantics id="S3.I1.i2.p1.3.m3.1a"><msub id="S3.I1.i2.p1.3.m3.1.1" xref="S3.I1.i2.p1.3.m3.1.1.cmml"><mi id="S3.I1.i2.p1.3.m3.1.1.2" xref="S3.I1.i2.p1.3.m3.1.1.2.cmml">X</mi><mi id="S3.I1.i2.p1.3.m3.1.1.3" xref="S3.I1.i2.p1.3.m3.1.1.3.cmml">u</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.3.m3.1b"><apply id="S3.I1.i2.p1.3.m3.1.1.cmml" xref="S3.I1.i2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.3.m3.1.1.1.cmml" xref="S3.I1.i2.p1.3.m3.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.3.m3.1.1.2.cmml" xref="S3.I1.i2.p1.3.m3.1.1.2">ğ‘‹</ci><ci id="S3.I1.i2.p1.3.m3.1.1.3.cmml" xref="S3.I1.i2.p1.3.m3.1.1.3">ğ‘¢</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.3.m3.1c">X_{u}</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i2.p1.3.m3.1d">italic_X start_POSTSUBSCRIPT italic_u end_POSTSUBSCRIPT</annotation></semantics></math> and tokens already generated:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="t_{m}=\text{argmax}(P_{\phi}(D|u,X_{u},t_{1:m-1}))" class="ltx_Math" display="block" id="S3.Ex5.m1.2"><semantics id="S3.Ex5.m1.2a"><mrow id="S3.Ex5.m1.2.2" xref="S3.Ex5.m1.2.2.cmml"><msub id="S3.Ex5.m1.2.2.3" xref="S3.Ex5.m1.2.2.3.cmml"><mi id="S3.Ex5.m1.2.2.3.2" xref="S3.Ex5.m1.2.2.3.2.cmml">t</mi><mi id="S3.Ex5.m1.2.2.3.3" xref="S3.Ex5.m1.2.2.3.3.cmml">m</mi></msub><mo id="S3.Ex5.m1.2.2.2" xref="S3.Ex5.m1.2.2.2.cmml">=</mo><mrow id="S3.Ex5.m1.2.2.1" xref="S3.Ex5.m1.2.2.1.cmml"><mtext id="S3.Ex5.m1.2.2.1.3" xref="S3.Ex5.m1.2.2.1.3a.cmml">argmax</mtext><mo id="S3.Ex5.m1.2.2.1.2" xref="S3.Ex5.m1.2.2.1.2.cmml">â¢</mo><mrow id="S3.Ex5.m1.2.2.1.1.1" xref="S3.Ex5.m1.2.2.1.1.1.1.cmml"><mo id="S3.Ex5.m1.2.2.1.1.1.2" stretchy="false" xref="S3.Ex5.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.Ex5.m1.2.2.1.1.1.1" xref="S3.Ex5.m1.2.2.1.1.1.1.cmml"><msub id="S3.Ex5.m1.2.2.1.1.1.1.3" xref="S3.Ex5.m1.2.2.1.1.1.1.3.cmml"><mi id="S3.Ex5.m1.2.2.1.1.1.1.3.2" xref="S3.Ex5.m1.2.2.1.1.1.1.3.2.cmml">P</mi><mi id="S3.Ex5.m1.2.2.1.1.1.1.3.3" xref="S3.Ex5.m1.2.2.1.1.1.1.3.3.cmml">Ï•</mi></msub><mo id="S3.Ex5.m1.2.2.1.1.1.1.2" xref="S3.Ex5.m1.2.2.1.1.1.1.2.cmml">â¢</mo><mrow id="S3.Ex5.m1.2.2.1.1.1.1.1.1" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.cmml"><mo id="S3.Ex5.m1.2.2.1.1.1.1.1.1.2" stretchy="false" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.cmml"><mi id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.4" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.4.cmml">D</mi><mo fence="false" id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.3" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.3.cmml">|</mo><mrow id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.3.cmml"><mi id="S3.Ex5.m1.1.1" xref="S3.Ex5.m1.1.1.cmml">u</mi><mo id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.3" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.3.cmml">,</mo><msub id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.2" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.3" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml">u</mi></msub><mo id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.4" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.3.cmml">,</mo><msub id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.cmml"><mi id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.2" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.2.cmml">t</mi><mrow id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.cmml"><mn id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.2" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.2.cmml">1</mn><mo id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.1" lspace="0.278em" rspace="0.278em" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.1.cmml">:</mo><mrow id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.cmml"><mi id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.2" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.2.cmml">m</mi><mo id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.1" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.1.cmml">âˆ’</mo><mn id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.3" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.3.cmml">1</mn></mrow></mrow></msub></mrow></mrow><mo id="S3.Ex5.m1.2.2.1.1.1.1.1.1.3" stretchy="false" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.Ex5.m1.2.2.1.1.1.3" stretchy="false" xref="S3.Ex5.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex5.m1.2b"><apply id="S3.Ex5.m1.2.2.cmml" xref="S3.Ex5.m1.2.2"><eq id="S3.Ex5.m1.2.2.2.cmml" xref="S3.Ex5.m1.2.2.2"></eq><apply id="S3.Ex5.m1.2.2.3.cmml" xref="S3.Ex5.m1.2.2.3"><csymbol cd="ambiguous" id="S3.Ex5.m1.2.2.3.1.cmml" xref="S3.Ex5.m1.2.2.3">subscript</csymbol><ci id="S3.Ex5.m1.2.2.3.2.cmml" xref="S3.Ex5.m1.2.2.3.2">ğ‘¡</ci><ci id="S3.Ex5.m1.2.2.3.3.cmml" xref="S3.Ex5.m1.2.2.3.3">ğ‘š</ci></apply><apply id="S3.Ex5.m1.2.2.1.cmml" xref="S3.Ex5.m1.2.2.1"><times id="S3.Ex5.m1.2.2.1.2.cmml" xref="S3.Ex5.m1.2.2.1.2"></times><ci id="S3.Ex5.m1.2.2.1.3a.cmml" xref="S3.Ex5.m1.2.2.1.3"><mtext id="S3.Ex5.m1.2.2.1.3.cmml" xref="S3.Ex5.m1.2.2.1.3">argmax</mtext></ci><apply id="S3.Ex5.m1.2.2.1.1.1.1.cmml" xref="S3.Ex5.m1.2.2.1.1.1"><times id="S3.Ex5.m1.2.2.1.1.1.1.2.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.2"></times><apply id="S3.Ex5.m1.2.2.1.1.1.1.3.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex5.m1.2.2.1.1.1.1.3.1.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.3">subscript</csymbol><ci id="S3.Ex5.m1.2.2.1.1.1.1.3.2.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.3.2">ğ‘ƒ</ci><ci id="S3.Ex5.m1.2.2.1.1.1.1.3.3.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.3.3">italic-Ï•</ci></apply><apply id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1"><csymbol cd="latexml" id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.3">conditional</csymbol><ci id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.4.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.4">ğ·</ci><list id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.3.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2"><ci id="S3.Ex5.m1.1.1.cmml" xref="S3.Ex5.m1.1.1">ğ‘¢</ci><apply id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.2">ğ‘‹</ci><ci id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.1.1.1.3">ğ‘¢</ci></apply><apply id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.1.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.2.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.2">ğ‘¡</ci><apply id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3"><ci id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.1.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.1">:</ci><cn id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.2.cmml" type="integer" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.2">1</cn><apply id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3"><minus id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.1.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.1"></minus><ci id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.2.cmml" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.2">ğ‘š</ci><cn id="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.3.cmml" type="integer" xref="S3.Ex5.m1.2.2.1.1.1.1.1.1.1.2.2.2.3.3.3">1</cn></apply></apply></apply></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex5.m1.2c">t_{m}=\text{argmax}(P_{\phi}(D|u,X_{u},t_{1:m-1}))</annotation><annotation encoding="application/x-llamapun" id="S3.Ex5.m1.2d">italic_t start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT = argmax ( italic_P start_POSTSUBSCRIPT italic_Ï• end_POSTSUBSCRIPT ( italic_D | italic_u , italic_X start_POSTSUBSCRIPT italic_u end_POSTSUBSCRIPT , italic_t start_POSTSUBSCRIPT 1 : italic_m - 1 end_POSTSUBSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.I1.i2.p1.8">in which, <math alttext="t_{m}" class="ltx_Math" display="inline" id="S3.I1.i2.p1.4.m1.1"><semantics id="S3.I1.i2.p1.4.m1.1a"><msub id="S3.I1.i2.p1.4.m1.1.1" xref="S3.I1.i2.p1.4.m1.1.1.cmml"><mi id="S3.I1.i2.p1.4.m1.1.1.2" xref="S3.I1.i2.p1.4.m1.1.1.2.cmml">t</mi><mi id="S3.I1.i2.p1.4.m1.1.1.3" xref="S3.I1.i2.p1.4.m1.1.1.3.cmml">m</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.4.m1.1b"><apply id="S3.I1.i2.p1.4.m1.1.1.cmml" xref="S3.I1.i2.p1.4.m1.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.4.m1.1.1.1.cmml" xref="S3.I1.i2.p1.4.m1.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.4.m1.1.1.2.cmml" xref="S3.I1.i2.p1.4.m1.1.1.2">ğ‘¡</ci><ci id="S3.I1.i2.p1.4.m1.1.1.3.cmml" xref="S3.I1.i2.p1.4.m1.1.1.3">ğ‘š</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.4.m1.1c">t_{m}</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i2.p1.4.m1.1d">italic_t start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="t_{1:m-1}" class="ltx_Math" display="inline" id="S3.I1.i2.p1.5.m2.1"><semantics id="S3.I1.i2.p1.5.m2.1a"><msub id="S3.I1.i2.p1.5.m2.1.1" xref="S3.I1.i2.p1.5.m2.1.1.cmml"><mi id="S3.I1.i2.p1.5.m2.1.1.2" xref="S3.I1.i2.p1.5.m2.1.1.2.cmml">t</mi><mrow id="S3.I1.i2.p1.5.m2.1.1.3" xref="S3.I1.i2.p1.5.m2.1.1.3.cmml"><mn id="S3.I1.i2.p1.5.m2.1.1.3.2" xref="S3.I1.i2.p1.5.m2.1.1.3.2.cmml">1</mn><mo id="S3.I1.i2.p1.5.m2.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="S3.I1.i2.p1.5.m2.1.1.3.1.cmml">:</mo><mrow id="S3.I1.i2.p1.5.m2.1.1.3.3" xref="S3.I1.i2.p1.5.m2.1.1.3.3.cmml"><mi id="S3.I1.i2.p1.5.m2.1.1.3.3.2" xref="S3.I1.i2.p1.5.m2.1.1.3.3.2.cmml">m</mi><mo id="S3.I1.i2.p1.5.m2.1.1.3.3.1" xref="S3.I1.i2.p1.5.m2.1.1.3.3.1.cmml">âˆ’</mo><mn id="S3.I1.i2.p1.5.m2.1.1.3.3.3" xref="S3.I1.i2.p1.5.m2.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.5.m2.1b"><apply id="S3.I1.i2.p1.5.m2.1.1.cmml" xref="S3.I1.i2.p1.5.m2.1.1"><csymbol cd="ambiguous" id="S3.I1.i2.p1.5.m2.1.1.1.cmml" xref="S3.I1.i2.p1.5.m2.1.1">subscript</csymbol><ci id="S3.I1.i2.p1.5.m2.1.1.2.cmml" xref="S3.I1.i2.p1.5.m2.1.1.2">ğ‘¡</ci><apply id="S3.I1.i2.p1.5.m2.1.1.3.cmml" xref="S3.I1.i2.p1.5.m2.1.1.3"><ci id="S3.I1.i2.p1.5.m2.1.1.3.1.cmml" xref="S3.I1.i2.p1.5.m2.1.1.3.1">:</ci><cn id="S3.I1.i2.p1.5.m2.1.1.3.2.cmml" type="integer" xref="S3.I1.i2.p1.5.m2.1.1.3.2">1</cn><apply id="S3.I1.i2.p1.5.m2.1.1.3.3.cmml" xref="S3.I1.i2.p1.5.m2.1.1.3.3"><minus id="S3.I1.i2.p1.5.m2.1.1.3.3.1.cmml" xref="S3.I1.i2.p1.5.m2.1.1.3.3.1"></minus><ci id="S3.I1.i2.p1.5.m2.1.1.3.3.2.cmml" xref="S3.I1.i2.p1.5.m2.1.1.3.3.2">ğ‘š</ci><cn id="S3.I1.i2.p1.5.m2.1.1.3.3.3.cmml" type="integer" xref="S3.I1.i2.p1.5.m2.1.1.3.3.3">1</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.5.m2.1c">t_{1:m-1}</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i2.p1.5.m2.1d">italic_t start_POSTSUBSCRIPT 1 : italic_m - 1 end_POSTSUBSCRIPT</annotation></semantics></math> form the answer <math alttext="v" class="ltx_Math" display="inline" id="S3.I1.i2.p1.6.m3.1"><semantics id="S3.I1.i2.p1.6.m3.1a"><mi id="S3.I1.i2.p1.6.m3.1.1" xref="S3.I1.i2.p1.6.m3.1.1.cmml">v</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.6.m3.1b"><ci id="S3.I1.i2.p1.6.m3.1.1.cmml" xref="S3.I1.i2.p1.6.m3.1.1">ğ‘£</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.6.m3.1c">v</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i2.p1.6.m3.1d">italic_v</annotation></semantics></math> to question <math alttext="u" class="ltx_Math" display="inline" id="S3.I1.i2.p1.7.m4.1"><semantics id="S3.I1.i2.p1.7.m4.1a"><mi id="S3.I1.i2.p1.7.m4.1.1" xref="S3.I1.i2.p1.7.m4.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.7.m4.1b"><ci id="S3.I1.i2.p1.7.m4.1.1.cmml" xref="S3.I1.i2.p1.7.m4.1.1">ğ‘¢</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.7.m4.1c">u</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i2.p1.7.m4.1d">italic_u</annotation></semantics></math>, i.e., <math alttext="v=t_{1:m}" class="ltx_Math" display="inline" id="S3.I1.i2.p1.8.m5.1"><semantics id="S3.I1.i2.p1.8.m5.1a"><mrow id="S3.I1.i2.p1.8.m5.1.1" xref="S3.I1.i2.p1.8.m5.1.1.cmml"><mi id="S3.I1.i2.p1.8.m5.1.1.2" xref="S3.I1.i2.p1.8.m5.1.1.2.cmml">v</mi><mo id="S3.I1.i2.p1.8.m5.1.1.1" xref="S3.I1.i2.p1.8.m5.1.1.1.cmml">=</mo><msub id="S3.I1.i2.p1.8.m5.1.1.3" xref="S3.I1.i2.p1.8.m5.1.1.3.cmml"><mi id="S3.I1.i2.p1.8.m5.1.1.3.2" xref="S3.I1.i2.p1.8.m5.1.1.3.2.cmml">t</mi><mrow id="S3.I1.i2.p1.8.m5.1.1.3.3" xref="S3.I1.i2.p1.8.m5.1.1.3.3.cmml"><mn id="S3.I1.i2.p1.8.m5.1.1.3.3.2" xref="S3.I1.i2.p1.8.m5.1.1.3.3.2.cmml">1</mn><mo id="S3.I1.i2.p1.8.m5.1.1.3.3.1" lspace="0.278em" rspace="0.278em" xref="S3.I1.i2.p1.8.m5.1.1.3.3.1.cmml">:</mo><mi id="S3.I1.i2.p1.8.m5.1.1.3.3.3" xref="S3.I1.i2.p1.8.m5.1.1.3.3.3.cmml">m</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.8.m5.1b"><apply id="S3.I1.i2.p1.8.m5.1.1.cmml" xref="S3.I1.i2.p1.8.m5.1.1"><eq id="S3.I1.i2.p1.8.m5.1.1.1.cmml" xref="S3.I1.i2.p1.8.m5.1.1.1"></eq><ci id="S3.I1.i2.p1.8.m5.1.1.2.cmml" xref="S3.I1.i2.p1.8.m5.1.1.2">ğ‘£</ci><apply id="S3.I1.i2.p1.8.m5.1.1.3.cmml" xref="S3.I1.i2.p1.8.m5.1.1.3"><csymbol cd="ambiguous" id="S3.I1.i2.p1.8.m5.1.1.3.1.cmml" xref="S3.I1.i2.p1.8.m5.1.1.3">subscript</csymbol><ci id="S3.I1.i2.p1.8.m5.1.1.3.2.cmml" xref="S3.I1.i2.p1.8.m5.1.1.3.2">ğ‘¡</ci><apply id="S3.I1.i2.p1.8.m5.1.1.3.3.cmml" xref="S3.I1.i2.p1.8.m5.1.1.3.3"><ci id="S3.I1.i2.p1.8.m5.1.1.3.3.1.cmml" xref="S3.I1.i2.p1.8.m5.1.1.3.3.1">:</ci><cn id="S3.I1.i2.p1.8.m5.1.1.3.3.2.cmml" type="integer" xref="S3.I1.i2.p1.8.m5.1.1.3.3.2">1</cn><ci id="S3.I1.i2.p1.8.m5.1.1.3.3.3.cmml" xref="S3.I1.i2.p1.8.m5.1.1.3.3.3">ğ‘š</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.8.m5.1c">v=t_{1:m}</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i2.p1.8.m5.1d">italic_v = italic_t start_POSTSUBSCRIPT 1 : italic_m end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
</li>
</ul>
<p class="ltx_p" id="S3.SS1.p1.3">In above, parameters <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.p1.2.m1.1"><semantics id="S3.SS1.p1.2.m1.1a"><mi id="S3.SS1.p1.2.m1.1.1" xref="S3.SS1.p1.2.m1.1.1.cmml">Î¸</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.2.m1.1b"><ci id="S3.SS1.p1.2.m1.1.1.cmml" xref="S3.SS1.p1.2.m1.1.1">ğœƒ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.2.m1.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.2.m1.1d">italic_Î¸</annotation></semantics></math> and <math alttext="\phi" class="ltx_Math" display="inline" id="S3.SS1.p1.3.m2.1"><semantics id="S3.SS1.p1.3.m2.1a"><mi id="S3.SS1.p1.3.m2.1.1" xref="S3.SS1.p1.3.m2.1.1.cmml">Ï•</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.3.m2.1b"><ci id="S3.SS1.p1.3.m2.1.1.cmml" xref="S3.SS1.p1.3.m2.1.1">italic-Ï•</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.3.m2.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.3.m2.1d">italic_Ï•</annotation></semantics></math> can be from the same LLM model or different LLMs. We use the same LLM in our work as we focus on changing the output of the retriever.</p>
</div>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.3">The overall objective of the RAG model is to maximize the likelihood of generating the correct output <math alttext="v" class="ltx_Math" display="inline" id="S3.SS1.p2.1.m1.1"><semantics id="S3.SS1.p2.1.m1.1a"><mi id="S3.SS1.p2.1.m1.1.1" xref="S3.SS1.p2.1.m1.1.1.cmml">v</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.1.m1.1b"><ci id="S3.SS1.p2.1.m1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1">ğ‘£</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.1.m1.1c">v</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.1.m1.1d">italic_v</annotation></semantics></math> given the input <math alttext="u" class="ltx_Math" display="inline" id="S3.SS1.p2.2.m2.1"><semantics id="S3.SS1.p2.2.m2.1a"><mi id="S3.SS1.p2.2.m2.1.1" xref="S3.SS1.p2.2.m2.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.2.m2.1b"><ci id="S3.SS1.p2.2.m2.1.1.cmml" xref="S3.SS1.p2.2.m2.1.1">ğ‘¢</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.2.m2.1c">u</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.2.m2.1d">italic_u</annotation></semantics></math>, while considering the information contained in the retrieved documents <math alttext="X_{u}" class="ltx_Math" display="inline" id="S3.SS1.p2.3.m3.1"><semantics id="S3.SS1.p2.3.m3.1a"><msub id="S3.SS1.p2.3.m3.1.1" xref="S3.SS1.p2.3.m3.1.1.cmml"><mi id="S3.SS1.p2.3.m3.1.1.2" xref="S3.SS1.p2.3.m3.1.1.2.cmml">X</mi><mi id="S3.SS1.p2.3.m3.1.1.3" xref="S3.SS1.p2.3.m3.1.1.3.cmml">u</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.3.m3.1b"><apply id="S3.SS1.p2.3.m3.1.1.cmml" xref="S3.SS1.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS1.p2.3.m3.1.1.1.cmml" xref="S3.SS1.p2.3.m3.1.1">subscript</csymbol><ci id="S3.SS1.p2.3.m3.1.1.2.cmml" xref="S3.SS1.p2.3.m3.1.1.2">ğ‘‹</ci><ci id="S3.SS1.p2.3.m3.1.1.3.cmml" xref="S3.SS1.p2.3.m3.1.1.3">ğ‘¢</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.3.m3.1c">X_{u}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.3.m3.1d">italic_X start_POSTSUBSCRIPT italic_u end_POSTSUBSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(1)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="P(v|u)=\sum_{X}P(X|u)\cdot P(v|u,X)" class="ltx_Math" display="block" id="S3.E1.m1.5"><semantics id="S3.E1.m1.5a"><mrow id="S3.E1.m1.5.5" xref="S3.E1.m1.5.5.cmml"><mrow id="S3.E1.m1.3.3.1" xref="S3.E1.m1.3.3.1.cmml"><mi id="S3.E1.m1.3.3.1.3" xref="S3.E1.m1.3.3.1.3.cmml">P</mi><mo id="S3.E1.m1.3.3.1.2" xref="S3.E1.m1.3.3.1.2.cmml">â¢</mo><mrow id="S3.E1.m1.3.3.1.1.1" xref="S3.E1.m1.3.3.1.1.1.1.cmml"><mo id="S3.E1.m1.3.3.1.1.1.2" stretchy="false" xref="S3.E1.m1.3.3.1.1.1.1.cmml">(</mo><mrow id="S3.E1.m1.3.3.1.1.1.1" xref="S3.E1.m1.3.3.1.1.1.1.cmml"><mi id="S3.E1.m1.3.3.1.1.1.1.2" xref="S3.E1.m1.3.3.1.1.1.1.2.cmml">v</mi><mo fence="false" id="S3.E1.m1.3.3.1.1.1.1.1" xref="S3.E1.m1.3.3.1.1.1.1.1.cmml">|</mo><mi id="S3.E1.m1.3.3.1.1.1.1.3" xref="S3.E1.m1.3.3.1.1.1.1.3.cmml">u</mi></mrow><mo id="S3.E1.m1.3.3.1.1.1.3" stretchy="false" xref="S3.E1.m1.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.5.5.4" rspace="0.111em" xref="S3.E1.m1.5.5.4.cmml">=</mo><mrow id="S3.E1.m1.5.5.3" xref="S3.E1.m1.5.5.3.cmml"><munder id="S3.E1.m1.5.5.3.3" xref="S3.E1.m1.5.5.3.3.cmml"><mo id="S3.E1.m1.5.5.3.3.2" movablelimits="false" xref="S3.E1.m1.5.5.3.3.2.cmml">âˆ‘</mo><mi id="S3.E1.m1.5.5.3.3.3" xref="S3.E1.m1.5.5.3.3.3.cmml">X</mi></munder><mrow id="S3.E1.m1.5.5.3.2" xref="S3.E1.m1.5.5.3.2.cmml"><mrow id="S3.E1.m1.4.4.2.1.1" xref="S3.E1.m1.4.4.2.1.1.cmml"><mrow id="S3.E1.m1.4.4.2.1.1.1" xref="S3.E1.m1.4.4.2.1.1.1.cmml"><mi id="S3.E1.m1.4.4.2.1.1.1.3" xref="S3.E1.m1.4.4.2.1.1.1.3.cmml">P</mi><mo id="S3.E1.m1.4.4.2.1.1.1.2" xref="S3.E1.m1.4.4.2.1.1.1.2.cmml">â¢</mo><mrow id="S3.E1.m1.4.4.2.1.1.1.1.1" xref="S3.E1.m1.4.4.2.1.1.1.1.1.1.cmml"><mo id="S3.E1.m1.4.4.2.1.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.4.4.2.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E1.m1.4.4.2.1.1.1.1.1.1" xref="S3.E1.m1.4.4.2.1.1.1.1.1.1.cmml"><mi id="S3.E1.m1.4.4.2.1.1.1.1.1.1.2" xref="S3.E1.m1.4.4.2.1.1.1.1.1.1.2.cmml">X</mi><mo fence="false" id="S3.E1.m1.4.4.2.1.1.1.1.1.1.1" xref="S3.E1.m1.4.4.2.1.1.1.1.1.1.1.cmml">|</mo><mi id="S3.E1.m1.4.4.2.1.1.1.1.1.1.3" xref="S3.E1.m1.4.4.2.1.1.1.1.1.1.3.cmml">u</mi></mrow><mo id="S3.E1.m1.4.4.2.1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S3.E1.m1.4.4.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.4.4.2.1.1.2" rspace="0.222em" xref="S3.E1.m1.4.4.2.1.1.2.cmml">â‹…</mo><mi id="S3.E1.m1.4.4.2.1.1.3" xref="S3.E1.m1.4.4.2.1.1.3.cmml">P</mi></mrow><mo id="S3.E1.m1.5.5.3.2.3" xref="S3.E1.m1.5.5.3.2.3.cmml">â¢</mo><mrow id="S3.E1.m1.5.5.3.2.2.1" xref="S3.E1.m1.5.5.3.2.2.1.1.cmml"><mo id="S3.E1.m1.5.5.3.2.2.1.2" stretchy="false" xref="S3.E1.m1.5.5.3.2.2.1.1.cmml">(</mo><mrow id="S3.E1.m1.5.5.3.2.2.1.1" xref="S3.E1.m1.5.5.3.2.2.1.1.cmml"><mi id="S3.E1.m1.5.5.3.2.2.1.1.2" xref="S3.E1.m1.5.5.3.2.2.1.1.2.cmml">v</mi><mo fence="false" id="S3.E1.m1.5.5.3.2.2.1.1.1" xref="S3.E1.m1.5.5.3.2.2.1.1.1.cmml">|</mo><mrow id="S3.E1.m1.5.5.3.2.2.1.1.3.2" xref="S3.E1.m1.5.5.3.2.2.1.1.3.1.cmml"><mi id="S3.E1.m1.1.1" xref="S3.E1.m1.1.1.cmml">u</mi><mo id="S3.E1.m1.5.5.3.2.2.1.1.3.2.1" xref="S3.E1.m1.5.5.3.2.2.1.1.3.1.cmml">,</mo><mi id="S3.E1.m1.2.2" xref="S3.E1.m1.2.2.cmml">X</mi></mrow></mrow><mo id="S3.E1.m1.5.5.3.2.2.1.3" stretchy="false" xref="S3.E1.m1.5.5.3.2.2.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.5b"><apply id="S3.E1.m1.5.5.cmml" xref="S3.E1.m1.5.5"><eq id="S3.E1.m1.5.5.4.cmml" xref="S3.E1.m1.5.5.4"></eq><apply id="S3.E1.m1.3.3.1.cmml" xref="S3.E1.m1.3.3.1"><times id="S3.E1.m1.3.3.1.2.cmml" xref="S3.E1.m1.3.3.1.2"></times><ci id="S3.E1.m1.3.3.1.3.cmml" xref="S3.E1.m1.3.3.1.3">ğ‘ƒ</ci><apply id="S3.E1.m1.3.3.1.1.1.1.cmml" xref="S3.E1.m1.3.3.1.1.1"><csymbol cd="latexml" id="S3.E1.m1.3.3.1.1.1.1.1.cmml" xref="S3.E1.m1.3.3.1.1.1.1.1">conditional</csymbol><ci id="S3.E1.m1.3.3.1.1.1.1.2.cmml" xref="S3.E1.m1.3.3.1.1.1.1.2">ğ‘£</ci><ci id="S3.E1.m1.3.3.1.1.1.1.3.cmml" xref="S3.E1.m1.3.3.1.1.1.1.3">ğ‘¢</ci></apply></apply><apply id="S3.E1.m1.5.5.3.cmml" xref="S3.E1.m1.5.5.3"><apply id="S3.E1.m1.5.5.3.3.cmml" xref="S3.E1.m1.5.5.3.3"><csymbol cd="ambiguous" id="S3.E1.m1.5.5.3.3.1.cmml" xref="S3.E1.m1.5.5.3.3">subscript</csymbol><sum id="S3.E1.m1.5.5.3.3.2.cmml" xref="S3.E1.m1.5.5.3.3.2"></sum><ci id="S3.E1.m1.5.5.3.3.3.cmml" xref="S3.E1.m1.5.5.3.3.3">ğ‘‹</ci></apply><apply id="S3.E1.m1.5.5.3.2.cmml" xref="S3.E1.m1.5.5.3.2"><times id="S3.E1.m1.5.5.3.2.3.cmml" xref="S3.E1.m1.5.5.3.2.3"></times><apply id="S3.E1.m1.4.4.2.1.1.cmml" xref="S3.E1.m1.4.4.2.1.1"><ci id="S3.E1.m1.4.4.2.1.1.2.cmml" xref="S3.E1.m1.4.4.2.1.1.2">â‹…</ci><apply id="S3.E1.m1.4.4.2.1.1.1.cmml" xref="S3.E1.m1.4.4.2.1.1.1"><times id="S3.E1.m1.4.4.2.1.1.1.2.cmml" xref="S3.E1.m1.4.4.2.1.1.1.2"></times><ci id="S3.E1.m1.4.4.2.1.1.1.3.cmml" xref="S3.E1.m1.4.4.2.1.1.1.3">ğ‘ƒ</ci><apply id="S3.E1.m1.4.4.2.1.1.1.1.1.1.cmml" xref="S3.E1.m1.4.4.2.1.1.1.1.1"><csymbol cd="latexml" id="S3.E1.m1.4.4.2.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.4.4.2.1.1.1.1.1.1.1">conditional</csymbol><ci id="S3.E1.m1.4.4.2.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.4.4.2.1.1.1.1.1.1.2">ğ‘‹</ci><ci id="S3.E1.m1.4.4.2.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.4.4.2.1.1.1.1.1.1.3">ğ‘¢</ci></apply></apply><ci id="S3.E1.m1.4.4.2.1.1.3.cmml" xref="S3.E1.m1.4.4.2.1.1.3">ğ‘ƒ</ci></apply><apply id="S3.E1.m1.5.5.3.2.2.1.1.cmml" xref="S3.E1.m1.5.5.3.2.2.1"><csymbol cd="latexml" id="S3.E1.m1.5.5.3.2.2.1.1.1.cmml" xref="S3.E1.m1.5.5.3.2.2.1.1.1">conditional</csymbol><ci id="S3.E1.m1.5.5.3.2.2.1.1.2.cmml" xref="S3.E1.m1.5.5.3.2.2.1.1.2">ğ‘£</ci><list id="S3.E1.m1.5.5.3.2.2.1.1.3.1.cmml" xref="S3.E1.m1.5.5.3.2.2.1.1.3.2"><ci id="S3.E1.m1.1.1.cmml" xref="S3.E1.m1.1.1">ğ‘¢</ci><ci id="S3.E1.m1.2.2.cmml" xref="S3.E1.m1.2.2">ğ‘‹</ci></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.5c">P(v|u)=\sum_{X}P(X|u)\cdot P(v|u,X)</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.5d">italic_P ( italic_v | italic_u ) = âˆ‘ start_POSTSUBSCRIPT italic_X end_POSTSUBSCRIPT italic_P ( italic_X | italic_u ) â‹… italic_P ( italic_v | italic_u , italic_X )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.SS1.p3">
<p class="ltx_p" id="S3.SS1.p3.1">The accuracy of the generated answers heavily relies on the relevance of the retrieved passages. The performance and robustness of the retriever is often studied through empirical experiments such as those inÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib38" title="">pradeep-etal-2023-generative, </a>; <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib39" title="">gupta2024rag, </a>)</cite>.</p>
</div>
<div class="ltx_para" id="S3.SS1.p4">
<p class="ltx_p" id="S3.SS1.p4.1">FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.F2" title="Figure 2 â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">2</span></a> shows the workflow of GGPP on RAG-based LLMs. It has the following stages:</p>
</div>
<div class="ltx_para" id="S3.SS1.p5">
<ol class="ltx_enumerate" id="S3.I2">
<li class="ltx_item" id="S3.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(1)</span>
<div class="ltx_para" id="S3.I2.i1.p1">
<p class="ltx_p" id="S3.I2.i1.p1.2"><span class="ltx_text ltx_font_bold" id="S3.I2.i1.p1.2.1">Passage encoding:</span> passage <math alttext="X_{i}" class="ltx_Math" display="inline" id="S3.I2.i1.p1.1.m1.1"><semantics id="S3.I2.i1.p1.1.m1.1a"><msub id="S3.I2.i1.p1.1.m1.1.1" xref="S3.I2.i1.p1.1.m1.1.1.cmml"><mi id="S3.I2.i1.p1.1.m1.1.1.2" xref="S3.I2.i1.p1.1.m1.1.1.2.cmml">X</mi><mi id="S3.I2.i1.p1.1.m1.1.1.3" xref="S3.I2.i1.p1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I2.i1.p1.1.m1.1b"><apply id="S3.I2.i1.p1.1.m1.1.1.cmml" xref="S3.I2.i1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.I2.i1.p1.1.m1.1.1.1.cmml" xref="S3.I2.i1.p1.1.m1.1.1">subscript</csymbol><ci id="S3.I2.i1.p1.1.m1.1.1.2.cmml" xref="S3.I2.i1.p1.1.m1.1.1.2">ğ‘‹</ci><ci id="S3.I2.i1.p1.1.m1.1.1.3.cmml" xref="S3.I2.i1.p1.1.m1.1.1.3">ğ‘–</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I2.i1.p1.1.m1.1c">X_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.I2.i1.p1.1.m1.1d">italic_X start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is fed into the encoder and generate an embedding vector <math alttext="\mathbf{e}_{i}=\mathcal{M}(X_{i})" class="ltx_Math" display="inline" id="S3.I2.i1.p1.2.m2.1"><semantics id="S3.I2.i1.p1.2.m2.1a"><mrow id="S3.I2.i1.p1.2.m2.1.1" xref="S3.I2.i1.p1.2.m2.1.1.cmml"><msub id="S3.I2.i1.p1.2.m2.1.1.3" xref="S3.I2.i1.p1.2.m2.1.1.3.cmml"><mi id="S3.I2.i1.p1.2.m2.1.1.3.2" xref="S3.I2.i1.p1.2.m2.1.1.3.2.cmml">ğ</mi><mi id="S3.I2.i1.p1.2.m2.1.1.3.3" xref="S3.I2.i1.p1.2.m2.1.1.3.3.cmml">i</mi></msub><mo id="S3.I2.i1.p1.2.m2.1.1.2" xref="S3.I2.i1.p1.2.m2.1.1.2.cmml">=</mo><mrow id="S3.I2.i1.p1.2.m2.1.1.1" xref="S3.I2.i1.p1.2.m2.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I2.i1.p1.2.m2.1.1.1.3" xref="S3.I2.i1.p1.2.m2.1.1.1.3.cmml">â„³</mi><mo id="S3.I2.i1.p1.2.m2.1.1.1.2" xref="S3.I2.i1.p1.2.m2.1.1.1.2.cmml">â¢</mo><mrow id="S3.I2.i1.p1.2.m2.1.1.1.1.1" xref="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.cmml"><mo id="S3.I2.i1.p1.2.m2.1.1.1.1.1.2" stretchy="false" xref="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.cmml">(</mo><msub id="S3.I2.i1.p1.2.m2.1.1.1.1.1.1" xref="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.cmml"><mi id="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.2" xref="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.2.cmml">X</mi><mi id="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.3" xref="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.I2.i1.p1.2.m2.1.1.1.1.1.3" stretchy="false" xref="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.I2.i1.p1.2.m2.1b"><apply id="S3.I2.i1.p1.2.m2.1.1.cmml" xref="S3.I2.i1.p1.2.m2.1.1"><eq id="S3.I2.i1.p1.2.m2.1.1.2.cmml" xref="S3.I2.i1.p1.2.m2.1.1.2"></eq><apply id="S3.I2.i1.p1.2.m2.1.1.3.cmml" xref="S3.I2.i1.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.I2.i1.p1.2.m2.1.1.3.1.cmml" xref="S3.I2.i1.p1.2.m2.1.1.3">subscript</csymbol><ci id="S3.I2.i1.p1.2.m2.1.1.3.2.cmml" xref="S3.I2.i1.p1.2.m2.1.1.3.2">ğ</ci><ci id="S3.I2.i1.p1.2.m2.1.1.3.3.cmml" xref="S3.I2.i1.p1.2.m2.1.1.3.3">ğ‘–</ci></apply><apply id="S3.I2.i1.p1.2.m2.1.1.1.cmml" xref="S3.I2.i1.p1.2.m2.1.1.1"><times id="S3.I2.i1.p1.2.m2.1.1.1.2.cmml" xref="S3.I2.i1.p1.2.m2.1.1.1.2"></times><ci id="S3.I2.i1.p1.2.m2.1.1.1.3.cmml" xref="S3.I2.i1.p1.2.m2.1.1.1.3">â„³</ci><apply id="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.cmml" xref="S3.I2.i1.p1.2.m2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.1.cmml" xref="S3.I2.i1.p1.2.m2.1.1.1.1.1">subscript</csymbol><ci id="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.2.cmml" xref="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.2">ğ‘‹</ci><ci id="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.3.cmml" xref="S3.I2.i1.p1.2.m2.1.1.1.1.1.1.3">ğ‘–</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I2.i1.p1.2.m2.1c">\mathbf{e}_{i}=\mathcal{M}(X_{i})</annotation><annotation encoding="application/x-llamapun" id="S3.I2.i1.p1.2.m2.1d">bold_e start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = caligraphic_M ( italic_X start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math>.</p>
</div>
</li>
<li class="ltx_item" id="S3.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(2)</span>
<div class="ltx_para" id="S3.I2.i2.p1">
<p class="ltx_p" id="S3.I2.i2.p1.5"><span class="ltx_text ltx_font_bold" id="S3.I2.i2.p1.5.1">Query encoding:</span> similarly, a user-provided query <math alttext="u" class="ltx_Math" display="inline" id="S3.I2.i2.p1.1.m1.1"><semantics id="S3.I2.i2.p1.1.m1.1a"><mi id="S3.I2.i2.p1.1.m1.1.1" xref="S3.I2.i2.p1.1.m1.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S3.I2.i2.p1.1.m1.1b"><ci id="S3.I2.i2.p1.1.m1.1.1.cmml" xref="S3.I2.i2.p1.1.m1.1.1">ğ‘¢</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I2.i2.p1.1.m1.1c">u</annotation><annotation encoding="application/x-llamapun" id="S3.I2.i2.p1.1.m1.1d">italic_u</annotation></semantics></math> is transformed to an embedding vector by the same encoder, i.e., <math alttext="\mathbf{e}_{u}=\mathcal{M}(u)" class="ltx_Math" display="inline" id="S3.I2.i2.p1.2.m2.1"><semantics id="S3.I2.i2.p1.2.m2.1a"><mrow id="S3.I2.i2.p1.2.m2.1.2" xref="S3.I2.i2.p1.2.m2.1.2.cmml"><msub id="S3.I2.i2.p1.2.m2.1.2.2" xref="S3.I2.i2.p1.2.m2.1.2.2.cmml"><mi id="S3.I2.i2.p1.2.m2.1.2.2.2" xref="S3.I2.i2.p1.2.m2.1.2.2.2.cmml">ğ</mi><mi id="S3.I2.i2.p1.2.m2.1.2.2.3" xref="S3.I2.i2.p1.2.m2.1.2.2.3.cmml">u</mi></msub><mo id="S3.I2.i2.p1.2.m2.1.2.1" xref="S3.I2.i2.p1.2.m2.1.2.1.cmml">=</mo><mrow id="S3.I2.i2.p1.2.m2.1.2.3" xref="S3.I2.i2.p1.2.m2.1.2.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.I2.i2.p1.2.m2.1.2.3.2" xref="S3.I2.i2.p1.2.m2.1.2.3.2.cmml">â„³</mi><mo id="S3.I2.i2.p1.2.m2.1.2.3.1" xref="S3.I2.i2.p1.2.m2.1.2.3.1.cmml">â¢</mo><mrow id="S3.I2.i2.p1.2.m2.1.2.3.3.2" xref="S3.I2.i2.p1.2.m2.1.2.3.cmml"><mo id="S3.I2.i2.p1.2.m2.1.2.3.3.2.1" stretchy="false" xref="S3.I2.i2.p1.2.m2.1.2.3.cmml">(</mo><mi id="S3.I2.i2.p1.2.m2.1.1" xref="S3.I2.i2.p1.2.m2.1.1.cmml">u</mi><mo id="S3.I2.i2.p1.2.m2.1.2.3.3.2.2" stretchy="false" xref="S3.I2.i2.p1.2.m2.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.I2.i2.p1.2.m2.1b"><apply id="S3.I2.i2.p1.2.m2.1.2.cmml" xref="S3.I2.i2.p1.2.m2.1.2"><eq id="S3.I2.i2.p1.2.m2.1.2.1.cmml" xref="S3.I2.i2.p1.2.m2.1.2.1"></eq><apply id="S3.I2.i2.p1.2.m2.1.2.2.cmml" xref="S3.I2.i2.p1.2.m2.1.2.2"><csymbol cd="ambiguous" id="S3.I2.i2.p1.2.m2.1.2.2.1.cmml" xref="S3.I2.i2.p1.2.m2.1.2.2">subscript</csymbol><ci id="S3.I2.i2.p1.2.m2.1.2.2.2.cmml" xref="S3.I2.i2.p1.2.m2.1.2.2.2">ğ</ci><ci id="S3.I2.i2.p1.2.m2.1.2.2.3.cmml" xref="S3.I2.i2.p1.2.m2.1.2.2.3">ğ‘¢</ci></apply><apply id="S3.I2.i2.p1.2.m2.1.2.3.cmml" xref="S3.I2.i2.p1.2.m2.1.2.3"><times id="S3.I2.i2.p1.2.m2.1.2.3.1.cmml" xref="S3.I2.i2.p1.2.m2.1.2.3.1"></times><ci id="S3.I2.i2.p1.2.m2.1.2.3.2.cmml" xref="S3.I2.i2.p1.2.m2.1.2.3.2">â„³</ci><ci id="S3.I2.i2.p1.2.m2.1.1.cmml" xref="S3.I2.i2.p1.2.m2.1.1">ğ‘¢</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I2.i2.p1.2.m2.1c">\mathbf{e}_{u}=\mathcal{M}(u)</annotation><annotation encoding="application/x-llamapun" id="S3.I2.i2.p1.2.m2.1d">bold_e start_POSTSUBSCRIPT italic_u end_POSTSUBSCRIPT = caligraphic_M ( italic_u )</annotation></semantics></math>. GGPP computes a prefix <math alttext="a" class="ltx_Math" display="inline" id="S3.I2.i2.p1.3.m3.1"><semantics id="S3.I2.i2.p1.3.m3.1a"><mi id="S3.I2.i2.p1.3.m3.1.1" xref="S3.I2.i2.p1.3.m3.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="S3.I2.i2.p1.3.m3.1b"><ci id="S3.I2.i2.p1.3.m3.1.1.cmml" xref="S3.I2.i2.p1.3.m3.1.1">ğ‘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I2.i2.p1.3.m3.1c">a</annotation><annotation encoding="application/x-llamapun" id="S3.I2.i2.p1.3.m3.1d">italic_a</annotation></semantics></math> to add to <math alttext="u" class="ltx_Math" display="inline" id="S3.I2.i2.p1.4.m4.1"><semantics id="S3.I2.i2.p1.4.m4.1a"><mi id="S3.I2.i2.p1.4.m4.1.1" xref="S3.I2.i2.p1.4.m4.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S3.I2.i2.p1.4.m4.1b"><ci id="S3.I2.i2.p1.4.m4.1.1.cmml" xref="S3.I2.i2.p1.4.m4.1.1">ğ‘¢</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I2.i2.p1.4.m4.1c">u</annotation><annotation encoding="application/x-llamapun" id="S3.I2.i2.p1.4.m4.1d">italic_u</annotation></semantics></math> to obtain a different embedding vector, or <math alttext="\mathbf{e}_{u^{\prime}}=\mathcal{M}(a||u)" class="ltx_math_unparsed" display="inline" id="S3.I2.i2.p1.5.m5.1"><semantics id="S3.I2.i2.p1.5.m5.1a"><mrow id="S3.I2.i2.p1.5.m5.1b"><msub id="S3.I2.i2.p1.5.m5.1.1"><mi id="S3.I2.i2.p1.5.m5.1.1.2">ğ</mi><msup id="S3.I2.i2.p1.5.m5.1.1.3"><mi id="S3.I2.i2.p1.5.m5.1.1.3.2">u</mi><mo id="S3.I2.i2.p1.5.m5.1.1.3.3">â€²</mo></msup></msub><mo id="S3.I2.i2.p1.5.m5.1.2">=</mo><mi class="ltx_font_mathcaligraphic" id="S3.I2.i2.p1.5.m5.1.3">â„³</mi><mrow id="S3.I2.i2.p1.5.m5.1.4"><mo id="S3.I2.i2.p1.5.m5.1.4.1" stretchy="false">(</mo><mi id="S3.I2.i2.p1.5.m5.1.4.2">a</mi><mo fence="false" id="S3.I2.i2.p1.5.m5.1.4.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="S3.I2.i2.p1.5.m5.1.4.4" rspace="0.167em" stretchy="false">|</mo><mi id="S3.I2.i2.p1.5.m5.1.4.5">u</mi><mo id="S3.I2.i2.p1.5.m5.1.4.6" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S3.I2.i2.p1.5.m5.1c">\mathbf{e}_{u^{\prime}}=\mathcal{M}(a||u)</annotation><annotation encoding="application/x-llamapun" id="S3.I2.i2.p1.5.m5.1d">bold_e start_POSTSUBSCRIPT italic_u start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT end_POSTSUBSCRIPT = caligraphic_M ( italic_a | | italic_u )</annotation></semantics></math>, in which â€˜â€”â€”â€™ is concatenation.</p>
</div>
</li>
<li class="ltx_item" id="S3.I2.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(3)</span>
<div class="ltx_para" id="S3.I2.i3.p1">
<p class="ltx_p" id="S3.I2.i3.p1.2"><span class="ltx_text ltx_font_bold" id="S3.I2.i3.p1.2.1">Relevance retrieving:</span> The system retrieves the <math alttext="K" class="ltx_Math" display="inline" id="S3.I2.i3.p1.1.m1.1"><semantics id="S3.I2.i3.p1.1.m1.1a"><mi id="S3.I2.i3.p1.1.m1.1.1" xref="S3.I2.i3.p1.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S3.I2.i3.p1.1.m1.1b"><ci id="S3.I2.i3.p1.1.m1.1.1.cmml" xref="S3.I2.i3.p1.1.m1.1.1">ğ¾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I2.i3.p1.1.m1.1c">K</annotation><annotation encoding="application/x-llamapun" id="S3.I2.i3.p1.1.m1.1d">italic_K</annotation></semantics></math> nearest passages in the embedding space to <math alttext="\mathbf{e}_{u}" class="ltx_Math" display="inline" id="S3.I2.i3.p1.2.m2.1"><semantics id="S3.I2.i3.p1.2.m2.1a"><msub id="S3.I2.i3.p1.2.m2.1.1" xref="S3.I2.i3.p1.2.m2.1.1.cmml"><mi id="S3.I2.i3.p1.2.m2.1.1.2" xref="S3.I2.i3.p1.2.m2.1.1.2.cmml">ğ</mi><mi id="S3.I2.i3.p1.2.m2.1.1.3" xref="S3.I2.i3.p1.2.m2.1.1.3.cmml">u</mi></msub><annotation-xml encoding="MathML-Content" id="S3.I2.i3.p1.2.m2.1b"><apply id="S3.I2.i3.p1.2.m2.1.1.cmml" xref="S3.I2.i3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.I2.i3.p1.2.m2.1.1.1.cmml" xref="S3.I2.i3.p1.2.m2.1.1">subscript</csymbol><ci id="S3.I2.i3.p1.2.m2.1.1.2.cmml" xref="S3.I2.i3.p1.2.m2.1.1.2">ğ</ci><ci id="S3.I2.i3.p1.2.m2.1.1.3.cmml" xref="S3.I2.i3.p1.2.m2.1.1.3">ğ‘¢</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.I2.i3.p1.2.m2.1c">\mathbf{e}_{u}</annotation><annotation encoding="application/x-llamapun" id="S3.I2.i3.p1.2.m2.1d">bold_e start_POSTSUBSCRIPT italic_u end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
</li>
<li class="ltx_item" id="S3.I2.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(4)</span>
<div class="ltx_para" id="S3.I2.i4.p1">
<p class="ltx_p" id="S3.I2.i4.p1.1"><span class="ltx_text ltx_font_bold" id="S3.I2.i4.p1.1.1">Answer generating:</span> the answer is generated by the LLM by using the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.I2.i4.p1.1.m1.1"><semantics id="S3.I2.i4.p1.1.m1.1a"><mi id="S3.I2.i4.p1.1.m1.1.1" xref="S3.I2.i4.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.I2.i4.p1.1.m1.1b"><ci id="S3.I2.i4.p1.1.m1.1.1.cmml" xref="S3.I2.i4.p1.1.m1.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I2.i4.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.I2.i4.p1.1.m1.1d">italic_k</annotation></semantics></math> passages as the context in the prompt.</p>
</div>
</li>
</ol>
</div>
<div class="ltx_para" id="S3.SS1.p6">
<p class="ltx_p" id="S3.SS1.p6.4">The prefix <math alttext="a" class="ltx_Math" display="inline" id="S3.SS1.p6.1.m1.1"><semantics id="S3.SS1.p6.1.m1.1a"><mi id="S3.SS1.p6.1.m1.1.1" xref="S3.SS1.p6.1.m1.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p6.1.m1.1b"><ci id="S3.SS1.p6.1.m1.1.1.cmml" xref="S3.SS1.p6.1.m1.1.1">ğ‘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p6.1.m1.1c">a</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p6.1.m1.1d">italic_a</annotation></semantics></math> triggers the retriever to include a targeted passage in its return by effectively changing the ranking of passages in <math alttext="X" class="ltx_Math" display="inline" id="S3.SS1.p6.2.m2.1"><semantics id="S3.SS1.p6.2.m2.1a"><mi id="S3.SS1.p6.2.m2.1.1" xref="S3.SS1.p6.2.m2.1.1.cmml">X</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p6.2.m2.1b"><ci id="S3.SS1.p6.2.m2.1.1.cmml" xref="S3.SS1.p6.2.m2.1.1">ğ‘‹</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p6.2.m2.1c">X</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p6.2.m2.1d">italic_X</annotation></semantics></math>. In the following, we first describe the method to push the correct passage out of the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p6.3.m3.1"><semantics id="S3.SS1.p6.3.m3.1a"><mi id="S3.SS1.p6.3.m3.1.1" xref="S3.SS1.p6.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p6.3.m3.1b"><ci id="S3.SS1.p6.3.m3.1.1.cmml" xref="S3.SS1.p6.3.m3.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p6.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p6.3.m3.1d">italic_k</annotation></semantics></math> retrieved results while promoting the targeted passage to the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p6.4.m4.1"><semantics id="S3.SS1.p6.4.m4.1a"><mi id="S3.SS1.p6.4.m4.1.1" xref="S3.SS1.p6.4.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p6.4.m4.1b"><ci id="S3.SS1.p6.4.m4.1.1.cmml" xref="S3.SS1.p6.4.m4.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p6.4.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p6.4.m4.1d">italic_k</annotation></semantics></math> results, and then the techniques to optimize the computation in a large embedding space.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2. </span>The GGPP algorithm</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.2">GGPP intends to make LLM retrievers rank incorrect passages into the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS2.p1.1.m1.1"><semantics id="S3.SS2.p1.1.m1.1a"><mi id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b"><ci id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.1.m1.1d">italic_k</annotation></semantics></math> results with a minimal change to the user prompts. Ideally, a targeted wrong passage should return as the top-1 result, meanwhile, the correct one is dropped out of the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS2.p1.2.m2.1"><semantics id="S3.SS2.p1.2.m2.1a"><mi id="S3.SS2.p1.2.m2.1.1" xref="S3.SS2.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.2.m2.1b"><ci id="S3.SS2.p1.2.m2.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.2.m2.1d">italic_k</annotation></semantics></math> results as defined as following:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(2)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="X_{t}=\text{argmax}_{k}(P_{\theta}(X|(a||u)))\&gt;\&amp;\&amp;\&gt;X_{u}\notin\text{argmax}_%
{k}(P_{\theta}(X|(a||u)))" class="ltx_math_unparsed" display="block" id="S3.E2.m1.1"><semantics id="S3.E2.m1.1a"><mrow id="S3.E2.m1.1b"><msub id="S3.E2.m1.1.1"><mi id="S3.E2.m1.1.1.2">X</mi><mi id="S3.E2.m1.1.1.3">t</mi></msub><mo id="S3.E2.m1.1.2">=</mo><msub id="S3.E2.m1.1.3"><mtext id="S3.E2.m1.1.3.2">argmax</mtext><mi id="S3.E2.m1.1.3.3">k</mi></msub><mrow id="S3.E2.m1.1.4"><mo id="S3.E2.m1.1.4.1" stretchy="false">(</mo><msub id="S3.E2.m1.1.4.2"><mi id="S3.E2.m1.1.4.2.2">P</mi><mi id="S3.E2.m1.1.4.2.3">Î¸</mi></msub><mrow id="S3.E2.m1.1.4.3"><mo id="S3.E2.m1.1.4.3.1" stretchy="false">(</mo><mi id="S3.E2.m1.1.4.3.2">X</mi><mo fence="false" id="S3.E2.m1.1.4.3.3" rspace="0.167em" stretchy="false">|</mo><mrow id="S3.E2.m1.1.4.3.4"><mo id="S3.E2.m1.1.4.3.4.1" stretchy="false">(</mo><mi id="S3.E2.m1.1.4.3.4.2">a</mi><mo fence="false" id="S3.E2.m1.1.4.3.4.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="S3.E2.m1.1.4.3.4.4" rspace="0.167em" stretchy="false">|</mo><mi id="S3.E2.m1.1.4.3.4.5">u</mi><mo id="S3.E2.m1.1.4.3.4.6" stretchy="false">)</mo></mrow><mo id="S3.E2.m1.1.4.3.5" stretchy="false">)</mo></mrow><mo id="S3.E2.m1.1.4.4" rspace="0.164em" stretchy="false">)</mo></mrow><mo id="S3.E2.m1.1.5" rspace="0em">&amp;</mo><mo id="S3.E2.m1.1.6" lspace="0em" rspace="0.442em">&amp;</mo><msub id="S3.E2.m1.1.7"><mi id="S3.E2.m1.1.7.2">X</mi><mi id="S3.E2.m1.1.7.3">u</mi></msub><mo id="S3.E2.m1.1.8">âˆ‰</mo><msub id="S3.E2.m1.1.9"><mtext id="S3.E2.m1.1.9.2">argmax</mtext><mi id="S3.E2.m1.1.9.3">k</mi></msub><mrow id="S3.E2.m1.1.10"><mo id="S3.E2.m1.1.10.1" stretchy="false">(</mo><msub id="S3.E2.m1.1.10.2"><mi id="S3.E2.m1.1.10.2.2">P</mi><mi id="S3.E2.m1.1.10.2.3">Î¸</mi></msub><mrow id="S3.E2.m1.1.10.3"><mo id="S3.E2.m1.1.10.3.1" stretchy="false">(</mo><mi id="S3.E2.m1.1.10.3.2">X</mi><mo fence="false" id="S3.E2.m1.1.10.3.3" rspace="0.167em" stretchy="false">|</mo><mrow id="S3.E2.m1.1.10.3.4"><mo id="S3.E2.m1.1.10.3.4.1" stretchy="false">(</mo><mi id="S3.E2.m1.1.10.3.4.2">a</mi><mo fence="false" id="S3.E2.m1.1.10.3.4.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="S3.E2.m1.1.10.3.4.4" rspace="0.167em" stretchy="false">|</mo><mi id="S3.E2.m1.1.10.3.4.5">u</mi><mo id="S3.E2.m1.1.10.3.4.6" stretchy="false">)</mo></mrow><mo id="S3.E2.m1.1.10.3.5" stretchy="false">)</mo></mrow><mo id="S3.E2.m1.1.10.4" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S3.E2.m1.1c">X_{t}=\text{argmax}_{k}(P_{\theta}(X|(a||u)))\&gt;\&amp;\&amp;\&gt;X_{u}\notin\text{argmax}_%
{k}(P_{\theta}(X|(a||u)))</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.1d">italic_X start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT = argmax start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_P start_POSTSUBSCRIPT italic_Î¸ end_POSTSUBSCRIPT ( italic_X | ( italic_a | | italic_u ) ) ) &amp; &amp; italic_X start_POSTSUBSCRIPT italic_u end_POSTSUBSCRIPT âˆ‰ argmax start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_P start_POSTSUBSCRIPT italic_Î¸ end_POSTSUBSCRIPT ( italic_X | ( italic_a | | italic_u ) ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.1">The embedding of a passage or a query is the average of the hidden states <math alttext="\mathbf{h_{i}}" class="ltx_Math" display="inline" id="S3.SS2.p2.1.m1.1"><semantics id="S3.SS2.p2.1.m1.1a"><msub id="S3.SS2.p2.1.m1.1.1" xref="S3.SS2.p2.1.m1.1.1.cmml"><mi id="S3.SS2.p2.1.m1.1.1.2" xref="S3.SS2.p2.1.m1.1.1.2.cmml">ğ¡</mi><mi id="S3.SS2.p2.1.m1.1.1.3" xref="S3.SS2.p2.1.m1.1.1.3.cmml">ğ¢</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b"><apply id="S3.SS2.p2.1.m1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.1.m1.1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p2.1.m1.1.1.2.cmml" xref="S3.SS2.p2.1.m1.1.1.2">ğ¡</ci><ci id="S3.SS2.p2.1.m1.1.1.3.cmml" xref="S3.SS2.p2.1.m1.1.1.3">ğ¢</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">\mathbf{h_{i}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.1.m1.1d">bold_h start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT</annotation></semantics></math> of the last layer of the LLM as below.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(3)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathbf{e}=\frac{1}{L}\sum_{i=1}^{L}\mathbf{h_{i}}" class="ltx_Math" display="block" id="S3.E3.m1.1"><semantics id="S3.E3.m1.1a"><mrow id="S3.E3.m1.1.1" xref="S3.E3.m1.1.1.cmml"><mi id="S3.E3.m1.1.1.2" xref="S3.E3.m1.1.1.2.cmml">ğ</mi><mo id="S3.E3.m1.1.1.1" xref="S3.E3.m1.1.1.1.cmml">=</mo><mrow id="S3.E3.m1.1.1.3" xref="S3.E3.m1.1.1.3.cmml"><mfrac id="S3.E3.m1.1.1.3.2" xref="S3.E3.m1.1.1.3.2.cmml"><mn id="S3.E3.m1.1.1.3.2.2" xref="S3.E3.m1.1.1.3.2.2.cmml">1</mn><mi id="S3.E3.m1.1.1.3.2.3" xref="S3.E3.m1.1.1.3.2.3.cmml">L</mi></mfrac><mo id="S3.E3.m1.1.1.3.1" xref="S3.E3.m1.1.1.3.1.cmml">â¢</mo><mrow id="S3.E3.m1.1.1.3.3" xref="S3.E3.m1.1.1.3.3.cmml"><munderover id="S3.E3.m1.1.1.3.3.1" xref="S3.E3.m1.1.1.3.3.1.cmml"><mo id="S3.E3.m1.1.1.3.3.1.2.2" movablelimits="false" xref="S3.E3.m1.1.1.3.3.1.2.2.cmml">âˆ‘</mo><mrow id="S3.E3.m1.1.1.3.3.1.2.3" xref="S3.E3.m1.1.1.3.3.1.2.3.cmml"><mi id="S3.E3.m1.1.1.3.3.1.2.3.2" xref="S3.E3.m1.1.1.3.3.1.2.3.2.cmml">i</mi><mo id="S3.E3.m1.1.1.3.3.1.2.3.1" xref="S3.E3.m1.1.1.3.3.1.2.3.1.cmml">=</mo><mn id="S3.E3.m1.1.1.3.3.1.2.3.3" xref="S3.E3.m1.1.1.3.3.1.2.3.3.cmml">1</mn></mrow><mi id="S3.E3.m1.1.1.3.3.1.3" xref="S3.E3.m1.1.1.3.3.1.3.cmml">L</mi></munderover><msub id="S3.E3.m1.1.1.3.3.2" xref="S3.E3.m1.1.1.3.3.2.cmml"><mi id="S3.E3.m1.1.1.3.3.2.2" xref="S3.E3.m1.1.1.3.3.2.2.cmml">ğ¡</mi><mi id="S3.E3.m1.1.1.3.3.2.3" xref="S3.E3.m1.1.1.3.3.2.3.cmml">ğ¢</mi></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E3.m1.1b"><apply id="S3.E3.m1.1.1.cmml" xref="S3.E3.m1.1.1"><eq id="S3.E3.m1.1.1.1.cmml" xref="S3.E3.m1.1.1.1"></eq><ci id="S3.E3.m1.1.1.2.cmml" xref="S3.E3.m1.1.1.2">ğ</ci><apply id="S3.E3.m1.1.1.3.cmml" xref="S3.E3.m1.1.1.3"><times id="S3.E3.m1.1.1.3.1.cmml" xref="S3.E3.m1.1.1.3.1"></times><apply id="S3.E3.m1.1.1.3.2.cmml" xref="S3.E3.m1.1.1.3.2"><divide id="S3.E3.m1.1.1.3.2.1.cmml" xref="S3.E3.m1.1.1.3.2"></divide><cn id="S3.E3.m1.1.1.3.2.2.cmml" type="integer" xref="S3.E3.m1.1.1.3.2.2">1</cn><ci id="S3.E3.m1.1.1.3.2.3.cmml" xref="S3.E3.m1.1.1.3.2.3">ğ¿</ci></apply><apply id="S3.E3.m1.1.1.3.3.cmml" xref="S3.E3.m1.1.1.3.3"><apply id="S3.E3.m1.1.1.3.3.1.cmml" xref="S3.E3.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.3.1.1.cmml" xref="S3.E3.m1.1.1.3.3.1">superscript</csymbol><apply id="S3.E3.m1.1.1.3.3.1.2.cmml" xref="S3.E3.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.3.1.2.1.cmml" xref="S3.E3.m1.1.1.3.3.1">subscript</csymbol><sum id="S3.E3.m1.1.1.3.3.1.2.2.cmml" xref="S3.E3.m1.1.1.3.3.1.2.2"></sum><apply id="S3.E3.m1.1.1.3.3.1.2.3.cmml" xref="S3.E3.m1.1.1.3.3.1.2.3"><eq id="S3.E3.m1.1.1.3.3.1.2.3.1.cmml" xref="S3.E3.m1.1.1.3.3.1.2.3.1"></eq><ci id="S3.E3.m1.1.1.3.3.1.2.3.2.cmml" xref="S3.E3.m1.1.1.3.3.1.2.3.2">ğ‘–</ci><cn id="S3.E3.m1.1.1.3.3.1.2.3.3.cmml" type="integer" xref="S3.E3.m1.1.1.3.3.1.2.3.3">1</cn></apply></apply><ci id="S3.E3.m1.1.1.3.3.1.3.cmml" xref="S3.E3.m1.1.1.3.3.1.3">ğ¿</ci></apply><apply id="S3.E3.m1.1.1.3.3.2.cmml" xref="S3.E3.m1.1.1.3.3.2"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.3.2.1.cmml" xref="S3.E3.m1.1.1.3.3.2">subscript</csymbol><ci id="S3.E3.m1.1.1.3.3.2.2.cmml" xref="S3.E3.m1.1.1.3.3.2.2">ğ¡</ci><ci id="S3.E3.m1.1.1.3.3.2.3.cmml" xref="S3.E3.m1.1.1.3.3.2.3">ğ¢</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m1.1c">\mathbf{e}=\frac{1}{L}\sum_{i=1}^{L}\mathbf{h_{i}}</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.1d">bold_e = divide start_ARG 1 end_ARG start_ARG italic_L end_ARG âˆ‘ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT bold_h start_POSTSUBSCRIPT bold_i end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.SS2.p3">
<p class="ltx_p" id="S3.SS2.p3.4">To satisfy EquationÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.E2" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">2</span></a>, the optimization goal of GGPP is to minimize the distance between the target passage embedding vector <math alttext="\mathbf{e^{\prime}}" class="ltx_Math" display="inline" id="S3.SS2.p3.1.m1.1"><semantics id="S3.SS2.p3.1.m1.1a"><msup id="S3.SS2.p3.1.m1.1.1" xref="S3.SS2.p3.1.m1.1.1.cmml"><mi id="S3.SS2.p3.1.m1.1.1.2" xref="S3.SS2.p3.1.m1.1.1.2.cmml">ğ</mi><mo id="S3.SS2.p3.1.m1.1.1.3" xref="S3.SS2.p3.1.m1.1.1.3.cmml">â€²</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.1.m1.1b"><apply id="S3.SS2.p3.1.m1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.1.m1.1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1">superscript</csymbol><ci id="S3.SS2.p3.1.m1.1.1.2.cmml" xref="S3.SS2.p3.1.m1.1.1.2">ğ</ci><ci id="S3.SS2.p3.1.m1.1.1.3.cmml" xref="S3.SS2.p3.1.m1.1.1.3">â€²</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.1.m1.1c">\mathbf{e^{\prime}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.1.m1.1d">bold_e start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT</annotation></semantics></math> and the input query embedding <math alttext="\mathbf{e_{u}}" class="ltx_Math" display="inline" id="S3.SS2.p3.2.m2.1"><semantics id="S3.SS2.p3.2.m2.1a"><msub id="S3.SS2.p3.2.m2.1.1" xref="S3.SS2.p3.2.m2.1.1.cmml"><mi id="S3.SS2.p3.2.m2.1.1.2" xref="S3.SS2.p3.2.m2.1.1.2.cmml">ğ</mi><mi id="S3.SS2.p3.2.m2.1.1.3" xref="S3.SS2.p3.2.m2.1.1.3.cmml">ğ®</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.2.m2.1b"><apply id="S3.SS2.p3.2.m2.1.1.cmml" xref="S3.SS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.2.m2.1.1.1.cmml" xref="S3.SS2.p3.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p3.2.m2.1.1.2.cmml" xref="S3.SS2.p3.2.m2.1.1.2">ğ</ci><ci id="S3.SS2.p3.2.m2.1.1.3.cmml" xref="S3.SS2.p3.2.m2.1.1.3">ğ®</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.2.m2.1c">\mathbf{e_{u}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.2.m2.1d">bold_e start_POSTSUBSCRIPT bold_u end_POSTSUBSCRIPT</annotation></semantics></math>, meanwhile it maximizes the distance between the original passage embedding <math alttext="\mathbf{e}" class="ltx_Math" display="inline" id="S3.SS2.p3.3.m3.1"><semantics id="S3.SS2.p3.3.m3.1a"><mi id="S3.SS2.p3.3.m3.1.1" xref="S3.SS2.p3.3.m3.1.1.cmml">ğ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.3.m3.1b"><ci id="S3.SS2.p3.3.m3.1.1.cmml" xref="S3.SS2.p3.3.m3.1.1">ğ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.3.m3.1c">\mathbf{e}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.3.m3.1d">bold_e</annotation></semantics></math> and <math alttext="\mathbf{e_{u}}" class="ltx_Math" display="inline" id="S3.SS2.p3.4.m4.1"><semantics id="S3.SS2.p3.4.m4.1a"><msub id="S3.SS2.p3.4.m4.1.1" xref="S3.SS2.p3.4.m4.1.1.cmml"><mi id="S3.SS2.p3.4.m4.1.1.2" xref="S3.SS2.p3.4.m4.1.1.2.cmml">ğ</mi><mi id="S3.SS2.p3.4.m4.1.1.3" xref="S3.SS2.p3.4.m4.1.1.3.cmml">ğ®</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.4.m4.1b"><apply id="S3.SS2.p3.4.m4.1.1.cmml" xref="S3.SS2.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.4.m4.1.1.1.cmml" xref="S3.SS2.p3.4.m4.1.1">subscript</csymbol><ci id="S3.SS2.p3.4.m4.1.1.2.cmml" xref="S3.SS2.p3.4.m4.1.1.2">ğ</ci><ci id="S3.SS2.p3.4.m4.1.1.3.cmml" xref="S3.SS2.p3.4.m4.1.1.3">ğ®</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.4.m4.1c">\mathbf{e_{u}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.4.m4.1d">bold_e start_POSTSUBSCRIPT bold_u end_POSTSUBSCRIPT</annotation></semantics></math>. Depending on the embedding model being used, different distance or loss functions may be used. In our experiments, we use the following two loss functions.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(4)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}=\frac{1}{1+e^{-MSE(\mathbf{e^{\prime}},\mathcal{M}(a||u))}}+%
\lambda(1-\frac{1}{1+e^{-MSE(\mathbf{e},\mathcal{M}(a||u))}})" class="ltx_math_unparsed" display="block" id="S3.E4.m1.4"><semantics id="S3.E4.m1.4a"><mrow id="S3.E4.m1.4.4"><mi class="ltx_font_mathcaligraphic" id="S3.E4.m1.4.4.3">â„’</mi><mo id="S3.E4.m1.4.4.2">=</mo><mrow id="S3.E4.m1.4.4.1"><mfrac id="S3.E4.m1.1.1"><mn id="S3.E4.m1.1.1.3">1</mn><mrow id="S3.E4.m1.1.1.1"><mn id="S3.E4.m1.1.1.1.3">1</mn><mo id="S3.E4.m1.1.1.1.2">+</mo><msup id="S3.E4.m1.1.1.1.4"><mi id="S3.E4.m1.1.1.1.4.2">e</mi><mrow id="S3.E4.m1.1.1.1.1.1"><mo id="S3.E4.m1.1.1.1.1.1.2">âˆ’</mo><mi id="S3.E4.m1.1.1.1.1.1.3">M</mi><mi id="S3.E4.m1.1.1.1.1.1.4">S</mi><mi id="S3.E4.m1.1.1.1.1.1.5">E</mi><mrow id="S3.E4.m1.1.1.1.1.1.6"><mo id="S3.E4.m1.1.1.1.1.1.6.1" stretchy="false">(</mo><msup id="S3.E4.m1.1.1.1.1.1.6.2"><mi id="S3.E4.m1.1.1.1.1.1.6.2.2">ğ</mi><mo id="S3.E4.m1.1.1.1.1.1.6.2.3">â€²</mo></msup><mo id="S3.E4.m1.1.1.1.1.1.6.3">,</mo><mi class="ltx_font_mathcaligraphic" id="S3.E4.m1.1.1.1.1.1.1">â„³</mi><mrow id="S3.E4.m1.1.1.1.1.1.6.4"><mo id="S3.E4.m1.1.1.1.1.1.6.4.1" stretchy="false">(</mo><mi id="S3.E4.m1.1.1.1.1.1.6.4.2">a</mi><mo fence="false" id="S3.E4.m1.1.1.1.1.1.6.4.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="S3.E4.m1.1.1.1.1.1.6.4.4" rspace="0.167em" stretchy="false">|</mo><mi id="S3.E4.m1.1.1.1.1.1.6.4.5">u</mi><mo id="S3.E4.m1.1.1.1.1.1.6.4.6" stretchy="false">)</mo></mrow><mo id="S3.E4.m1.1.1.1.1.1.6.5" stretchy="false">)</mo></mrow></mrow></msup></mrow></mfrac><mo id="S3.E4.m1.4.4.1.2">+</mo><mrow id="S3.E4.m1.4.4.1.1"><mi id="S3.E4.m1.4.4.1.1.3">Î»</mi><mo id="S3.E4.m1.4.4.1.1.2">â¢</mo><mrow id="S3.E4.m1.4.4.1.1.1.1"><mo id="S3.E4.m1.4.4.1.1.1.1.2" stretchy="false">(</mo><mrow id="S3.E4.m1.4.4.1.1.1.1.1"><mn id="S3.E4.m1.4.4.1.1.1.1.1.2">1</mn><mo id="S3.E4.m1.4.4.1.1.1.1.1.1">âˆ’</mo><mfrac id="S3.E4.m1.3.3"><mn id="S3.E4.m1.3.3.4">1</mn><mrow id="S3.E4.m1.3.3.2"><mn id="S3.E4.m1.3.3.2.4">1</mn><mo id="S3.E4.m1.3.3.2.3">+</mo><msup id="S3.E4.m1.3.3.2.5"><mi id="S3.E4.m1.3.3.2.5.2">e</mi><mrow id="S3.E4.m1.3.3.2.2.2"><mo id="S3.E4.m1.3.3.2.2.2.3">âˆ’</mo><mi id="S3.E4.m1.3.3.2.2.2.4">M</mi><mi id="S3.E4.m1.3.3.2.2.2.5">S</mi><mi id="S3.E4.m1.3.3.2.2.2.6">E</mi><mrow id="S3.E4.m1.3.3.2.2.2.7"><mo id="S3.E4.m1.3.3.2.2.2.7.1" stretchy="false">(</mo><mi id="S3.E4.m1.2.2.1.1.1.1">ğ</mi><mo id="S3.E4.m1.3.3.2.2.2.7.2">,</mo><mi class="ltx_font_mathcaligraphic" id="S3.E4.m1.3.3.2.2.2.2">â„³</mi><mrow id="S3.E4.m1.3.3.2.2.2.7.3"><mo id="S3.E4.m1.3.3.2.2.2.7.3.1" stretchy="false">(</mo><mi id="S3.E4.m1.3.3.2.2.2.7.3.2">a</mi><mo fence="false" id="S3.E4.m1.3.3.2.2.2.7.3.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="S3.E4.m1.3.3.2.2.2.7.3.4" rspace="0.167em" stretchy="false">|</mo><mi id="S3.E4.m1.3.3.2.2.2.7.3.5">u</mi><mo id="S3.E4.m1.3.3.2.2.2.7.3.6" stretchy="false">)</mo></mrow><mo id="S3.E4.m1.3.3.2.2.2.7.4" stretchy="false">)</mo></mrow></mrow></msup></mrow></mfrac></mrow><mo id="S3.E4.m1.4.4.1.1.1.1.3" stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex" id="S3.E4.m1.4b">\mathcal{L}=\frac{1}{1+e^{-MSE(\mathbf{e^{\prime}},\mathcal{M}(a||u))}}+%
\lambda(1-\frac{1}{1+e^{-MSE(\mathbf{e},\mathcal{M}(a||u))}})</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.4c">caligraphic_L = divide start_ARG 1 end_ARG start_ARG 1 + italic_e start_POSTSUPERSCRIPT - italic_M italic_S italic_E ( bold_e start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT , caligraphic_M ( italic_a | | italic_u ) ) end_POSTSUPERSCRIPT end_ARG + italic_Î» ( 1 - divide start_ARG 1 end_ARG start_ARG 1 + italic_e start_POSTSUPERSCRIPT - italic_M italic_S italic_E ( bold_e , caligraphic_M ( italic_a | | italic_u ) ) end_POSTSUPERSCRIPT end_ARG )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p3.5">or</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(5)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}=1-cos(\mathbf{e^{\prime}},\mathcal{M}(a||u))+\lambda*cos(\mathbf{e%
},\mathcal{M}(a||u))" class="ltx_math_unparsed" display="block" id="S3.E5.m1.1"><semantics id="S3.E5.m1.1a"><mrow id="S3.E5.m1.1b"><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.1.2">â„’</mi><mo id="S3.E5.m1.1.3">=</mo><mn id="S3.E5.m1.1.4">1</mn><mo id="S3.E5.m1.1.5">âˆ’</mo><mi id="S3.E5.m1.1.6">c</mi><mi id="S3.E5.m1.1.7">o</mi><mi id="S3.E5.m1.1.8">s</mi><mrow id="S3.E5.m1.1.9"><mo id="S3.E5.m1.1.9.1" stretchy="false">(</mo><msup id="S3.E5.m1.1.9.2"><mi id="S3.E5.m1.1.9.2.2">ğ</mi><mo id="S3.E5.m1.1.9.2.3">â€²</mo></msup><mo id="S3.E5.m1.1.9.3">,</mo><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.1.1">â„³</mi><mrow id="S3.E5.m1.1.9.4"><mo id="S3.E5.m1.1.9.4.1" stretchy="false">(</mo><mi id="S3.E5.m1.1.9.4.2">a</mi><mo fence="false" id="S3.E5.m1.1.9.4.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="S3.E5.m1.1.9.4.4" rspace="0.167em" stretchy="false">|</mo><mi id="S3.E5.m1.1.9.4.5">u</mi><mo id="S3.E5.m1.1.9.4.6" stretchy="false">)</mo></mrow><mo id="S3.E5.m1.1.9.5" stretchy="false">)</mo></mrow><mo id="S3.E5.m1.1.10">+</mo><mi id="S3.E5.m1.1.11">Î»</mi><mo id="S3.E5.m1.1.12" lspace="0.222em" rspace="0.222em">âˆ—</mo><mi id="S3.E5.m1.1.13">c</mi><mi id="S3.E5.m1.1.14">o</mi><mi id="S3.E5.m1.1.15">s</mi><mrow id="S3.E5.m1.1.16"><mo id="S3.E5.m1.1.16.1" stretchy="false">(</mo><mi id="S3.E5.m1.1.16.2">ğ</mi><mo id="S3.E5.m1.1.16.3">,</mo><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.1.16.4">â„³</mi><mrow id="S3.E5.m1.1.16.5"><mo id="S3.E5.m1.1.16.5.1" stretchy="false">(</mo><mi id="S3.E5.m1.1.16.5.2">a</mi><mo fence="false" id="S3.E5.m1.1.16.5.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="S3.E5.m1.1.16.5.4" rspace="0.167em" stretchy="false">|</mo><mi id="S3.E5.m1.1.16.5.5">u</mi><mo id="S3.E5.m1.1.16.5.6" stretchy="false">)</mo></mrow><mo id="S3.E5.m1.1.16.6" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S3.E5.m1.1c">\mathcal{L}=1-cos(\mathbf{e^{\prime}},\mathcal{M}(a||u))+\lambda*cos(\mathbf{e%
},\mathcal{M}(a||u))</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.1d">caligraphic_L = 1 - italic_c italic_o italic_s ( bold_e start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT , caligraphic_M ( italic_a | | italic_u ) ) + italic_Î» âˆ— italic_c italic_o italic_s ( bold_e , caligraphic_M ( italic_a | | italic_u ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p4">
<p class="ltx_p" id="S3.SS2.p4.4">where <math alttext="a" class="ltx_Math" display="inline" id="S3.SS2.p4.1.m1.1"><semantics id="S3.SS2.p4.1.m1.1a"><mi id="S3.SS2.p4.1.m1.1.1" xref="S3.SS2.p4.1.m1.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.1.m1.1b"><ci id="S3.SS2.p4.1.m1.1.1.cmml" xref="S3.SS2.p4.1.m1.1.1">ğ‘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.1.m1.1c">a</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p4.1.m1.1d">italic_a</annotation></semantics></math> is the prefix to compute, <math alttext="\lambda" class="ltx_Math" display="inline" id="S3.SS2.p4.2.m2.1"><semantics id="S3.SS2.p4.2.m2.1a"><mi id="S3.SS2.p4.2.m2.1.1" xref="S3.SS2.p4.2.m2.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.2.m2.1b"><ci id="S3.SS2.p4.2.m2.1.1.cmml" xref="S3.SS2.p4.2.m2.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.2.m2.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p4.2.m2.1d">italic_Î»</annotation></semantics></math> configures the relative importance of these two optimization directions on different datasets. We set <math alttext="\lambda" class="ltx_Math" display="inline" id="S3.SS2.p4.3.m3.1"><semantics id="S3.SS2.p4.3.m3.1a"><mi id="S3.SS2.p4.3.m3.1.1" xref="S3.SS2.p4.3.m3.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.3.m3.1b"><ci id="S3.SS2.p4.3.m3.1.1.cmml" xref="S3.SS2.p4.3.m3.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.3.m3.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p4.3.m3.1d">italic_Î»</annotation></semantics></math> as 1 by default. The <math alttext="cos" class="ltx_Math" display="inline" id="S3.SS2.p4.4.m4.1"><semantics id="S3.SS2.p4.4.m4.1a"><mrow id="S3.SS2.p4.4.m4.1.1" xref="S3.SS2.p4.4.m4.1.1.cmml"><mi id="S3.SS2.p4.4.m4.1.1.2" xref="S3.SS2.p4.4.m4.1.1.2.cmml">c</mi><mo id="S3.SS2.p4.4.m4.1.1.1" xref="S3.SS2.p4.4.m4.1.1.1.cmml">â¢</mo><mi id="S3.SS2.p4.4.m4.1.1.3" xref="S3.SS2.p4.4.m4.1.1.3.cmml">o</mi><mo id="S3.SS2.p4.4.m4.1.1.1a" xref="S3.SS2.p4.4.m4.1.1.1.cmml">â¢</mo><mi id="S3.SS2.p4.4.m4.1.1.4" xref="S3.SS2.p4.4.m4.1.1.4.cmml">s</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p4.4.m4.1b"><apply id="S3.SS2.p4.4.m4.1.1.cmml" xref="S3.SS2.p4.4.m4.1.1"><times id="S3.SS2.p4.4.m4.1.1.1.cmml" xref="S3.SS2.p4.4.m4.1.1.1"></times><ci id="S3.SS2.p4.4.m4.1.1.2.cmml" xref="S3.SS2.p4.4.m4.1.1.2">ğ‘</ci><ci id="S3.SS2.p4.4.m4.1.1.3.cmml" xref="S3.SS2.p4.4.m4.1.1.3">ğ‘œ</ci><ci id="S3.SS2.p4.4.m4.1.1.4.cmml" xref="S3.SS2.p4.4.m4.1.1.4">ğ‘ </ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p4.4.m4.1c">cos</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p4.4.m4.1d">italic_c italic_o italic_s</annotation></semantics></math> is the cosine similarity. And the equation <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.E5" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">5</span></a> is designed for the encoder LLMs like SFR-Embedding-Mistral <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib22" title="">SFRAIResearch2024, </a>)</cite>.</p>
</div>
<div class="ltx_para" id="S3.SS2.p5">
<p class="ltx_p" id="S3.SS2.p5.7">Consider the generation is token by token in LLMs, the loss calculation involves selecting multiple tokens from the dictionary to minimize the overall loss, which is costly with such a large search space (<math alttext="|D|^{|a|}" class="ltx_Math" display="inline" id="S3.SS2.p5.1.m1.2"><semantics id="S3.SS2.p5.1.m1.2a"><msup id="S3.SS2.p5.1.m1.2.3" xref="S3.SS2.p5.1.m1.2.3.cmml"><mrow id="S3.SS2.p5.1.m1.2.3.2.2" xref="S3.SS2.p5.1.m1.2.3.2.1.cmml"><mo id="S3.SS2.p5.1.m1.2.3.2.2.1" stretchy="false" xref="S3.SS2.p5.1.m1.2.3.2.1.1.cmml">|</mo><mi id="S3.SS2.p5.1.m1.2.2" xref="S3.SS2.p5.1.m1.2.2.cmml">D</mi><mo id="S3.SS2.p5.1.m1.2.3.2.2.2" stretchy="false" xref="S3.SS2.p5.1.m1.2.3.2.1.1.cmml">|</mo></mrow><mrow id="S3.SS2.p5.1.m1.1.1.1.3" xref="S3.SS2.p5.1.m1.1.1.1.2.cmml"><mo id="S3.SS2.p5.1.m1.1.1.1.3.1" stretchy="false" xref="S3.SS2.p5.1.m1.1.1.1.2.1.cmml">|</mo><mi id="S3.SS2.p5.1.m1.1.1.1.1" xref="S3.SS2.p5.1.m1.1.1.1.1.cmml">a</mi><mo id="S3.SS2.p5.1.m1.1.1.1.3.2" stretchy="false" xref="S3.SS2.p5.1.m1.1.1.1.2.1.cmml">|</mo></mrow></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.1.m1.2b"><apply id="S3.SS2.p5.1.m1.2.3.cmml" xref="S3.SS2.p5.1.m1.2.3"><csymbol cd="ambiguous" id="S3.SS2.p5.1.m1.2.3.1.cmml" xref="S3.SS2.p5.1.m1.2.3">superscript</csymbol><apply id="S3.SS2.p5.1.m1.2.3.2.1.cmml" xref="S3.SS2.p5.1.m1.2.3.2.2"><abs id="S3.SS2.p5.1.m1.2.3.2.1.1.cmml" xref="S3.SS2.p5.1.m1.2.3.2.2.1"></abs><ci id="S3.SS2.p5.1.m1.2.2.cmml" xref="S3.SS2.p5.1.m1.2.2">ğ·</ci></apply><apply id="S3.SS2.p5.1.m1.1.1.1.2.cmml" xref="S3.SS2.p5.1.m1.1.1.1.3"><abs id="S3.SS2.p5.1.m1.1.1.1.2.1.cmml" xref="S3.SS2.p5.1.m1.1.1.1.3.1"></abs><ci id="S3.SS2.p5.1.m1.1.1.1.1.cmml" xref="S3.SS2.p5.1.m1.1.1.1.1">ğ‘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.1.m1.2c">|D|^{|a|}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.1.m1.2d">| italic_D | start_POSTSUPERSCRIPT | italic_a | end_POSTSUPERSCRIPT</annotation></semantics></math>, <math alttext="D" class="ltx_Math" display="inline" id="S3.SS2.p5.2.m2.1"><semantics id="S3.SS2.p5.2.m2.1a"><mi id="S3.SS2.p5.2.m2.1.1" xref="S3.SS2.p5.2.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.2.m2.1b"><ci id="S3.SS2.p5.2.m2.1.1.cmml" xref="S3.SS2.p5.2.m2.1.1">ğ·</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.2.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.2.m2.1d">italic_D</annotation></semantics></math> is the dictionary and â€˜<math alttext="|?|" class="ltx_Math" display="inline" id="S3.SS2.p5.3.m3.1"><semantics id="S3.SS2.p5.3.m3.1a"><mrow id="S3.SS2.p5.3.m3.1.2.2" xref="S3.SS2.p5.3.m3.1.2.1.cmml"><mo id="S3.SS2.p5.3.m3.1.2.2.1" stretchy="false" xref="S3.SS2.p5.3.m3.1.2.1.1.cmml">|</mo><mi id="S3.SS2.p5.3.m3.1.1" mathvariant="normal" xref="S3.SS2.p5.3.m3.1.1.cmml">?</mi><mo id="S3.SS2.p5.3.m3.1.2.2.2" stretchy="false" xref="S3.SS2.p5.3.m3.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.3.m3.1b"><apply id="S3.SS2.p5.3.m3.1.2.1.cmml" xref="S3.SS2.p5.3.m3.1.2.2"><abs id="S3.SS2.p5.3.m3.1.2.1.1.cmml" xref="S3.SS2.p5.3.m3.1.2.2.1"></abs><ci id="S3.SS2.p5.3.m3.1.1.cmml" xref="S3.SS2.p5.3.m3.1.1">?</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.3.m3.1c">|?|</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.3.m3.1d">| ? |</annotation></semantics></math>â€™ is the size of <math alttext="?" class="ltx_Math" display="inline" id="S3.SS2.p5.4.m4.1"><semantics id="S3.SS2.p5.4.m4.1a"><mi id="S3.SS2.p5.4.m4.1.1" mathvariant="normal" xref="S3.SS2.p5.4.m4.1.1.cmml">?</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.4.m4.1b"><ci id="S3.SS2.p5.4.m4.1.1.cmml" xref="S3.SS2.p5.4.m4.1.1">?</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.4.m4.1c">?</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.4.m4.1d">?</annotation></semantics></math>). We propose a method that initializes <math alttext="a" class="ltx_Math" display="inline" id="S3.SS2.p5.5.m5.1"><semantics id="S3.SS2.p5.5.m5.1a"><mi id="S3.SS2.p5.5.m5.1.1" xref="S3.SS2.p5.5.m5.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.5.m5.1b"><ci id="S3.SS2.p5.5.m5.1.1.cmml" xref="S3.SS2.p5.5.m5.1.1">ğ‘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.5.m5.1c">a</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.5.m5.1d">italic_a</annotation></semantics></math> through tokens in the target passage that are important to the distance to the embedding of <math alttext="u" class="ltx_Math" display="inline" id="S3.SS2.p5.6.m6.1"><semantics id="S3.SS2.p5.6.m6.1a"><mi id="S3.SS2.p5.6.m6.1.1" xref="S3.SS2.p5.6.m6.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.6.m6.1b"><ci id="S3.SS2.p5.6.m6.1.1.cmml" xref="S3.SS2.p5.6.m6.1.1">ğ‘¢</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.6.m6.1c">u</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.6.m6.1d">italic_u</annotation></semantics></math>. We show that such initialization can quickly find a prefix <math alttext="a" class="ltx_Math" display="inline" id="S3.SS2.p5.7.m7.1"><semantics id="S3.SS2.p5.7.m7.1a"><mi id="S3.SS2.p5.7.m7.1.1" xref="S3.SS2.p5.7.m7.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.7.m7.1b"><ci id="S3.SS2.p5.7.m7.1.1.cmml" xref="S3.SS2.p5.7.m7.1.1">ğ‘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.7.m7.1c">a</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.7.m7.1d">italic_a</annotation></semantics></math> that leads to the target passage being ranked highly.</p>
</div>
<figure class="ltx_float ltx_algorithm" id="alg1">
<div class="ltx_listing ltx_lst_numbers_left ltx_listing" id="alg1.29">
<div class="ltx_listingline" id="alg1.29.30">
<span class="ltx_tag ltx_tag_listingline">1</span>
</div>
<div class="ltx_listingline" id="alg1.29.31">
<span class="ltx_tag ltx_tag_listingline">2</span>
</div>
<div class="ltx_listingline" id="alg1.3.3">
<span class="ltx_text ltx_font_bold" id="alg1.3.3.1">Input :</span>Â Target passage <math alttext="X_{t}" class="ltx_Math" display="inline" id="alg1.1.1.m1.1"><semantics id="alg1.1.1.m1.1a"><msub id="alg1.1.1.m1.1.1" xref="alg1.1.1.m1.1.1.cmml"><mi id="alg1.1.1.m1.1.1.2" xref="alg1.1.1.m1.1.1.2.cmml">X</mi><mi id="alg1.1.1.m1.1.1.3" xref="alg1.1.1.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="alg1.1.1.m1.1b"><apply id="alg1.1.1.m1.1.1.cmml" xref="alg1.1.1.m1.1.1"><csymbol cd="ambiguous" id="alg1.1.1.m1.1.1.1.cmml" xref="alg1.1.1.m1.1.1">subscript</csymbol><ci id="alg1.1.1.m1.1.1.2.cmml" xref="alg1.1.1.m1.1.1.2">ğ‘‹</ci><ci id="alg1.1.1.m1.1.1.3.cmml" xref="alg1.1.1.m1.1.1.3">ğ‘¡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.1.1.m1.1c">X_{t}</annotation><annotation encoding="application/x-llamapun" id="alg1.1.1.m1.1d">italic_X start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math>, a pre-trained LLM <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="alg1.2.2.m2.1"><semantics id="alg1.2.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.2.2.m2.1.1" xref="alg1.2.2.m2.1.1.cmml">â„³</mi><annotation-xml encoding="MathML-Content" id="alg1.2.2.m2.1b"><ci id="alg1.2.2.m2.1.1.cmml" xref="alg1.2.2.m2.1.1">â„³</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.2.2.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="alg1.2.2.m2.1d">caligraphic_M</annotation></semantics></math>, prefix length <math alttext="\mathcal{N}" class="ltx_Math" display="inline" id="alg1.3.3.m3.1"><semantics id="alg1.3.3.m3.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.3.3.m3.1.1" xref="alg1.3.3.m3.1.1.cmml">ğ’©</mi><annotation-xml encoding="MathML-Content" id="alg1.3.3.m3.1b"><ci id="alg1.3.3.m3.1.1.cmml" xref="alg1.3.3.m3.1.1">ğ’©</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.3.3.m3.1c">\mathcal{N}</annotation><annotation encoding="application/x-llamapun" id="alg1.3.3.m3.1d">caligraphic_N</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.4.4">
<span class="ltx_text ltx_font_bold" id="alg1.4.4.1">Output :</span>Â Initial prefix <math alttext="p_{0}" class="ltx_Math" display="inline" id="alg1.4.4.m1.1"><semantics id="alg1.4.4.m1.1a"><msub id="alg1.4.4.m1.1.1" xref="alg1.4.4.m1.1.1.cmml"><mi id="alg1.4.4.m1.1.1.2" xref="alg1.4.4.m1.1.1.2.cmml">p</mi><mn id="alg1.4.4.m1.1.1.3" xref="alg1.4.4.m1.1.1.3.cmml">0</mn></msub><annotation-xml encoding="MathML-Content" id="alg1.4.4.m1.1b"><apply id="alg1.4.4.m1.1.1.cmml" xref="alg1.4.4.m1.1.1"><csymbol cd="ambiguous" id="alg1.4.4.m1.1.1.1.cmml" xref="alg1.4.4.m1.1.1">subscript</csymbol><ci id="alg1.4.4.m1.1.1.2.cmml" xref="alg1.4.4.m1.1.1.2">ğ‘</ci><cn id="alg1.4.4.m1.1.1.3.cmml" type="integer" xref="alg1.4.4.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.4.4.m1.1c">p_{0}</annotation><annotation encoding="application/x-llamapun" id="alg1.4.4.m1.1d">italic_p start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.29.32">
<span class="ltx_text ltx_font_typewriter" id="alg1.29.32.1">//</span><span class="ltx_text ltx_font_typewriter" id="alg1.29.32.2">Function to initialize prefix </span>
</div>
<div class="ltx_listingline" id="alg1.7.7">
<span class="ltx_tag ltx_tag_listingline">3</span>

original embedding <math alttext="e\leftarrow" class="ltx_Math" display="inline" id="alg1.5.5.m1.1"><semantics id="alg1.5.5.m1.1a"><mrow id="alg1.5.5.m1.1.1" xref="alg1.5.5.m1.1.1.cmml"><mi id="alg1.5.5.m1.1.1.2" xref="alg1.5.5.m1.1.1.2.cmml">e</mi><mo id="alg1.5.5.m1.1.1.1" stretchy="false" xref="alg1.5.5.m1.1.1.1.cmml">â†</mo><mi id="alg1.5.5.m1.1.1.3" xref="alg1.5.5.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.5.5.m1.1b"><apply id="alg1.5.5.m1.1.1.cmml" xref="alg1.5.5.m1.1.1"><ci id="alg1.5.5.m1.1.1.1.cmml" xref="alg1.5.5.m1.1.1.1">â†</ci><ci id="alg1.5.5.m1.1.1.2.cmml" xref="alg1.5.5.m1.1.1.2">ğ‘’</ci><csymbol cd="latexml" id="alg1.5.5.m1.1.1.3.cmml" xref="alg1.5.5.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.5.5.m1.1c">e\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg1.5.5.m1.1d">italic_e â†</annotation></semantics></math><math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="alg1.6.6.m2.1"><semantics id="alg1.6.6.m2.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.6.6.m2.1.1" xref="alg1.6.6.m2.1.1.cmml">â„³</mi><annotation-xml encoding="MathML-Content" id="alg1.6.6.m2.1b"><ci id="alg1.6.6.m2.1.1.cmml" xref="alg1.6.6.m2.1.1">â„³</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.6.6.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="alg1.6.6.m2.1d">caligraphic_M</annotation></semantics></math><span class="ltx_text ltx_font_typewriter" id="alg1.7.7.1">(<em class="ltx_emph ltx_font_serif ltx_font_italic" id="alg1.7.7.1.1"><math alttext="X_{t}" class="ltx_Math" display="inline" id="alg1.7.7.1.1.m1.1"><semantics id="alg1.7.7.1.1.m1.1a"><msub id="alg1.7.7.1.1.m1.1.1" xref="alg1.7.7.1.1.m1.1.1.cmml"><mi id="alg1.7.7.1.1.m1.1.1.2" xref="alg1.7.7.1.1.m1.1.1.2.cmml">X</mi><mi id="alg1.7.7.1.1.m1.1.1.3" xref="alg1.7.7.1.1.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="alg1.7.7.1.1.m1.1b"><apply id="alg1.7.7.1.1.m1.1.1.cmml" xref="alg1.7.7.1.1.m1.1.1"><csymbol cd="ambiguous" id="alg1.7.7.1.1.m1.1.1.1.cmml" xref="alg1.7.7.1.1.m1.1.1">subscript</csymbol><ci id="alg1.7.7.1.1.m1.1.1.2.cmml" xref="alg1.7.7.1.1.m1.1.1.2">ğ‘‹</ci><ci id="alg1.7.7.1.1.m1.1.1.3.cmml" xref="alg1.7.7.1.1.m1.1.1.3">ğ‘¡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.7.7.1.1.m1.1c">X_{t}</annotation><annotation encoding="application/x-llamapun" id="alg1.7.7.1.1.m1.1d">italic_X start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math></em>)</span>
</div>
<div class="ltx_listingline" id="alg1.8.8">
<span class="ltx_tag ltx_tag_listingline">4</span>
<math alttext="distances\leftarrow" class="ltx_Math" display="inline" id="alg1.8.8.m1.1"><semantics id="alg1.8.8.m1.1a"><mrow id="alg1.8.8.m1.1.1" xref="alg1.8.8.m1.1.1.cmml"><mrow id="alg1.8.8.m1.1.1.2" xref="alg1.8.8.m1.1.1.2.cmml"><mi id="alg1.8.8.m1.1.1.2.2" xref="alg1.8.8.m1.1.1.2.2.cmml">d</mi><mo id="alg1.8.8.m1.1.1.2.1" xref="alg1.8.8.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.8.8.m1.1.1.2.3" xref="alg1.8.8.m1.1.1.2.3.cmml">i</mi><mo id="alg1.8.8.m1.1.1.2.1a" xref="alg1.8.8.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.8.8.m1.1.1.2.4" xref="alg1.8.8.m1.1.1.2.4.cmml">s</mi><mo id="alg1.8.8.m1.1.1.2.1b" xref="alg1.8.8.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.8.8.m1.1.1.2.5" xref="alg1.8.8.m1.1.1.2.5.cmml">t</mi><mo id="alg1.8.8.m1.1.1.2.1c" xref="alg1.8.8.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.8.8.m1.1.1.2.6" xref="alg1.8.8.m1.1.1.2.6.cmml">a</mi><mo id="alg1.8.8.m1.1.1.2.1d" xref="alg1.8.8.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.8.8.m1.1.1.2.7" xref="alg1.8.8.m1.1.1.2.7.cmml">n</mi><mo id="alg1.8.8.m1.1.1.2.1e" xref="alg1.8.8.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.8.8.m1.1.1.2.8" xref="alg1.8.8.m1.1.1.2.8.cmml">c</mi><mo id="alg1.8.8.m1.1.1.2.1f" xref="alg1.8.8.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.8.8.m1.1.1.2.9" xref="alg1.8.8.m1.1.1.2.9.cmml">e</mi><mo id="alg1.8.8.m1.1.1.2.1g" xref="alg1.8.8.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.8.8.m1.1.1.2.10" xref="alg1.8.8.m1.1.1.2.10.cmml">s</mi></mrow><mo id="alg1.8.8.m1.1.1.1" stretchy="false" xref="alg1.8.8.m1.1.1.1.cmml">â†</mo><mi id="alg1.8.8.m1.1.1.3" xref="alg1.8.8.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.8.8.m1.1b"><apply id="alg1.8.8.m1.1.1.cmml" xref="alg1.8.8.m1.1.1"><ci id="alg1.8.8.m1.1.1.1.cmml" xref="alg1.8.8.m1.1.1.1">â†</ci><apply id="alg1.8.8.m1.1.1.2.cmml" xref="alg1.8.8.m1.1.1.2"><times id="alg1.8.8.m1.1.1.2.1.cmml" xref="alg1.8.8.m1.1.1.2.1"></times><ci id="alg1.8.8.m1.1.1.2.2.cmml" xref="alg1.8.8.m1.1.1.2.2">ğ‘‘</ci><ci id="alg1.8.8.m1.1.1.2.3.cmml" xref="alg1.8.8.m1.1.1.2.3">ğ‘–</ci><ci id="alg1.8.8.m1.1.1.2.4.cmml" xref="alg1.8.8.m1.1.1.2.4">ğ‘ </ci><ci id="alg1.8.8.m1.1.1.2.5.cmml" xref="alg1.8.8.m1.1.1.2.5">ğ‘¡</ci><ci id="alg1.8.8.m1.1.1.2.6.cmml" xref="alg1.8.8.m1.1.1.2.6">ğ‘</ci><ci id="alg1.8.8.m1.1.1.2.7.cmml" xref="alg1.8.8.m1.1.1.2.7">ğ‘›</ci><ci id="alg1.8.8.m1.1.1.2.8.cmml" xref="alg1.8.8.m1.1.1.2.8">ğ‘</ci><ci id="alg1.8.8.m1.1.1.2.9.cmml" xref="alg1.8.8.m1.1.1.2.9">ğ‘’</ci><ci id="alg1.8.8.m1.1.1.2.10.cmml" xref="alg1.8.8.m1.1.1.2.10">ğ‘ </ci></apply><csymbol cd="latexml" id="alg1.8.8.m1.1.1.3.cmml" xref="alg1.8.8.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.8.8.m1.1c">distances\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg1.8.8.m1.1d">italic_d italic_i italic_s italic_t italic_a italic_n italic_c italic_e italic_s â†</annotation></semantics></math> empty list
</div>
<div class="ltx_listingline" id="alg1.9.9">
<span class="ltx_tag ltx_tag_listingline">5</span>
<math alttext="tokens\leftarrow\mathrm{split}(X_{t})" class="ltx_Math" display="inline" id="alg1.9.9.m1.1"><semantics id="alg1.9.9.m1.1a"><mrow id="alg1.9.9.m1.1.1" xref="alg1.9.9.m1.1.1.cmml"><mrow id="alg1.9.9.m1.1.1.3" xref="alg1.9.9.m1.1.1.3.cmml"><mi id="alg1.9.9.m1.1.1.3.2" xref="alg1.9.9.m1.1.1.3.2.cmml">t</mi><mo id="alg1.9.9.m1.1.1.3.1" xref="alg1.9.9.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.9.9.m1.1.1.3.3" xref="alg1.9.9.m1.1.1.3.3.cmml">o</mi><mo id="alg1.9.9.m1.1.1.3.1a" xref="alg1.9.9.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.9.9.m1.1.1.3.4" xref="alg1.9.9.m1.1.1.3.4.cmml">k</mi><mo id="alg1.9.9.m1.1.1.3.1b" xref="alg1.9.9.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.9.9.m1.1.1.3.5" xref="alg1.9.9.m1.1.1.3.5.cmml">e</mi><mo id="alg1.9.9.m1.1.1.3.1c" xref="alg1.9.9.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.9.9.m1.1.1.3.6" xref="alg1.9.9.m1.1.1.3.6.cmml">n</mi><mo id="alg1.9.9.m1.1.1.3.1d" xref="alg1.9.9.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.9.9.m1.1.1.3.7" xref="alg1.9.9.m1.1.1.3.7.cmml">s</mi></mrow><mo id="alg1.9.9.m1.1.1.2" stretchy="false" xref="alg1.9.9.m1.1.1.2.cmml">â†</mo><mrow id="alg1.9.9.m1.1.1.1" xref="alg1.9.9.m1.1.1.1.cmml"><mi id="alg1.9.9.m1.1.1.1.3" xref="alg1.9.9.m1.1.1.1.3.cmml">split</mi><mo id="alg1.9.9.m1.1.1.1.2" xref="alg1.9.9.m1.1.1.1.2.cmml">â¢</mo><mrow id="alg1.9.9.m1.1.1.1.1.1" xref="alg1.9.9.m1.1.1.1.1.1.1.cmml"><mo id="alg1.9.9.m1.1.1.1.1.1.2" stretchy="false" xref="alg1.9.9.m1.1.1.1.1.1.1.cmml">(</mo><msub id="alg1.9.9.m1.1.1.1.1.1.1" xref="alg1.9.9.m1.1.1.1.1.1.1.cmml"><mi id="alg1.9.9.m1.1.1.1.1.1.1.2" xref="alg1.9.9.m1.1.1.1.1.1.1.2.cmml">X</mi><mi id="alg1.9.9.m1.1.1.1.1.1.1.3" xref="alg1.9.9.m1.1.1.1.1.1.1.3.cmml">t</mi></msub><mo id="alg1.9.9.m1.1.1.1.1.1.3" stretchy="false" xref="alg1.9.9.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.9.9.m1.1b"><apply id="alg1.9.9.m1.1.1.cmml" xref="alg1.9.9.m1.1.1"><ci id="alg1.9.9.m1.1.1.2.cmml" xref="alg1.9.9.m1.1.1.2">â†</ci><apply id="alg1.9.9.m1.1.1.3.cmml" xref="alg1.9.9.m1.1.1.3"><times id="alg1.9.9.m1.1.1.3.1.cmml" xref="alg1.9.9.m1.1.1.3.1"></times><ci id="alg1.9.9.m1.1.1.3.2.cmml" xref="alg1.9.9.m1.1.1.3.2">ğ‘¡</ci><ci id="alg1.9.9.m1.1.1.3.3.cmml" xref="alg1.9.9.m1.1.1.3.3">ğ‘œ</ci><ci id="alg1.9.9.m1.1.1.3.4.cmml" xref="alg1.9.9.m1.1.1.3.4">ğ‘˜</ci><ci id="alg1.9.9.m1.1.1.3.5.cmml" xref="alg1.9.9.m1.1.1.3.5">ğ‘’</ci><ci id="alg1.9.9.m1.1.1.3.6.cmml" xref="alg1.9.9.m1.1.1.3.6">ğ‘›</ci><ci id="alg1.9.9.m1.1.1.3.7.cmml" xref="alg1.9.9.m1.1.1.3.7">ğ‘ </ci></apply><apply id="alg1.9.9.m1.1.1.1.cmml" xref="alg1.9.9.m1.1.1.1"><times id="alg1.9.9.m1.1.1.1.2.cmml" xref="alg1.9.9.m1.1.1.1.2"></times><ci id="alg1.9.9.m1.1.1.1.3.cmml" xref="alg1.9.9.m1.1.1.1.3">split</ci><apply id="alg1.9.9.m1.1.1.1.1.1.1.cmml" xref="alg1.9.9.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.9.9.m1.1.1.1.1.1.1.1.cmml" xref="alg1.9.9.m1.1.1.1.1.1">subscript</csymbol><ci id="alg1.9.9.m1.1.1.1.1.1.1.2.cmml" xref="alg1.9.9.m1.1.1.1.1.1.1.2">ğ‘‹</ci><ci id="alg1.9.9.m1.1.1.1.1.1.1.3.cmml" xref="alg1.9.9.m1.1.1.1.1.1.1.3">ğ‘¡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.9.9.m1.1c">tokens\leftarrow\mathrm{split}(X_{t})</annotation><annotation encoding="application/x-llamapun" id="alg1.9.9.m1.1d">italic_t italic_o italic_k italic_e italic_n italic_s â† roman_split ( italic_X start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.11.11">
<span class="ltx_tag ltx_tag_listingline">6</span>
<span class="ltx_text ltx_font_bold" id="alg1.11.11.3">for</span>Â <em class="ltx_emph ltx_font_italic" id="alg1.11.11.2"><math alttext="index\leftarrow 0" class="ltx_Math" display="inline" id="alg1.10.10.1.m1.1"><semantics id="alg1.10.10.1.m1.1a"><mrow id="alg1.10.10.1.m1.1.1" xref="alg1.10.10.1.m1.1.1.cmml"><mrow id="alg1.10.10.1.m1.1.1.2" xref="alg1.10.10.1.m1.1.1.2.cmml"><mi id="alg1.10.10.1.m1.1.1.2.2" xref="alg1.10.10.1.m1.1.1.2.2.cmml">i</mi><mo id="alg1.10.10.1.m1.1.1.2.1" xref="alg1.10.10.1.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.10.10.1.m1.1.1.2.3" xref="alg1.10.10.1.m1.1.1.2.3.cmml">n</mi><mo id="alg1.10.10.1.m1.1.1.2.1a" xref="alg1.10.10.1.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.10.10.1.m1.1.1.2.4" xref="alg1.10.10.1.m1.1.1.2.4.cmml">d</mi><mo id="alg1.10.10.1.m1.1.1.2.1b" xref="alg1.10.10.1.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.10.10.1.m1.1.1.2.5" xref="alg1.10.10.1.m1.1.1.2.5.cmml">e</mi><mo id="alg1.10.10.1.m1.1.1.2.1c" xref="alg1.10.10.1.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.10.10.1.m1.1.1.2.6" xref="alg1.10.10.1.m1.1.1.2.6.cmml">x</mi></mrow><mo id="alg1.10.10.1.m1.1.1.1" stretchy="false" xref="alg1.10.10.1.m1.1.1.1.cmml">â†</mo><mn id="alg1.10.10.1.m1.1.1.3" xref="alg1.10.10.1.m1.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="alg1.10.10.1.m1.1b"><apply id="alg1.10.10.1.m1.1.1.cmml" xref="alg1.10.10.1.m1.1.1"><ci id="alg1.10.10.1.m1.1.1.1.cmml" xref="alg1.10.10.1.m1.1.1.1">â†</ci><apply id="alg1.10.10.1.m1.1.1.2.cmml" xref="alg1.10.10.1.m1.1.1.2"><times id="alg1.10.10.1.m1.1.1.2.1.cmml" xref="alg1.10.10.1.m1.1.1.2.1"></times><ci id="alg1.10.10.1.m1.1.1.2.2.cmml" xref="alg1.10.10.1.m1.1.1.2.2">ğ‘–</ci><ci id="alg1.10.10.1.m1.1.1.2.3.cmml" xref="alg1.10.10.1.m1.1.1.2.3">ğ‘›</ci><ci id="alg1.10.10.1.m1.1.1.2.4.cmml" xref="alg1.10.10.1.m1.1.1.2.4">ğ‘‘</ci><ci id="alg1.10.10.1.m1.1.1.2.5.cmml" xref="alg1.10.10.1.m1.1.1.2.5">ğ‘’</ci><ci id="alg1.10.10.1.m1.1.1.2.6.cmml" xref="alg1.10.10.1.m1.1.1.2.6">ğ‘¥</ci></apply><cn id="alg1.10.10.1.m1.1.1.3.cmml" type="integer" xref="alg1.10.10.1.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.10.10.1.m1.1c">index\leftarrow 0</annotation><annotation encoding="application/x-llamapun" id="alg1.10.10.1.m1.1d">italic_i italic_n italic_d italic_e italic_x â† 0</annotation></semantics></math> <span class="ltx_text ltx_font_bold ltx_font_upright" id="alg1.11.11.2.1">to</span> <math alttext="\mathrm{length}(tokens)-1" class="ltx_Math" display="inline" id="alg1.11.11.2.m2.1"><semantics id="alg1.11.11.2.m2.1a"><mrow id="alg1.11.11.2.m2.1.1" xref="alg1.11.11.2.m2.1.1.cmml"><mrow id="alg1.11.11.2.m2.1.1.1" xref="alg1.11.11.2.m2.1.1.1.cmml"><mi id="alg1.11.11.2.m2.1.1.1.3" xref="alg1.11.11.2.m2.1.1.1.3.cmml">length</mi><mo id="alg1.11.11.2.m2.1.1.1.2" xref="alg1.11.11.2.m2.1.1.1.2.cmml">â¢</mo><mrow id="alg1.11.11.2.m2.1.1.1.1.1" xref="alg1.11.11.2.m2.1.1.1.1.1.1.cmml"><mo id="alg1.11.11.2.m2.1.1.1.1.1.2" stretchy="false" xref="alg1.11.11.2.m2.1.1.1.1.1.1.cmml">(</mo><mrow id="alg1.11.11.2.m2.1.1.1.1.1.1" xref="alg1.11.11.2.m2.1.1.1.1.1.1.cmml"><mi id="alg1.11.11.2.m2.1.1.1.1.1.1.2" xref="alg1.11.11.2.m2.1.1.1.1.1.1.2.cmml">t</mi><mo id="alg1.11.11.2.m2.1.1.1.1.1.1.1" xref="alg1.11.11.2.m2.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.11.11.2.m2.1.1.1.1.1.1.3" xref="alg1.11.11.2.m2.1.1.1.1.1.1.3.cmml">o</mi><mo id="alg1.11.11.2.m2.1.1.1.1.1.1.1a" xref="alg1.11.11.2.m2.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.11.11.2.m2.1.1.1.1.1.1.4" xref="alg1.11.11.2.m2.1.1.1.1.1.1.4.cmml">k</mi><mo id="alg1.11.11.2.m2.1.1.1.1.1.1.1b" xref="alg1.11.11.2.m2.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.11.11.2.m2.1.1.1.1.1.1.5" xref="alg1.11.11.2.m2.1.1.1.1.1.1.5.cmml">e</mi><mo id="alg1.11.11.2.m2.1.1.1.1.1.1.1c" xref="alg1.11.11.2.m2.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.11.11.2.m2.1.1.1.1.1.1.6" xref="alg1.11.11.2.m2.1.1.1.1.1.1.6.cmml">n</mi><mo id="alg1.11.11.2.m2.1.1.1.1.1.1.1d" xref="alg1.11.11.2.m2.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.11.11.2.m2.1.1.1.1.1.1.7" xref="alg1.11.11.2.m2.1.1.1.1.1.1.7.cmml">s</mi></mrow><mo id="alg1.11.11.2.m2.1.1.1.1.1.3" stretchy="false" xref="alg1.11.11.2.m2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="alg1.11.11.2.m2.1.1.2" xref="alg1.11.11.2.m2.1.1.2.cmml">âˆ’</mo><mn id="alg1.11.11.2.m2.1.1.3" xref="alg1.11.11.2.m2.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="alg1.11.11.2.m2.1b"><apply id="alg1.11.11.2.m2.1.1.cmml" xref="alg1.11.11.2.m2.1.1"><minus id="alg1.11.11.2.m2.1.1.2.cmml" xref="alg1.11.11.2.m2.1.1.2"></minus><apply id="alg1.11.11.2.m2.1.1.1.cmml" xref="alg1.11.11.2.m2.1.1.1"><times id="alg1.11.11.2.m2.1.1.1.2.cmml" xref="alg1.11.11.2.m2.1.1.1.2"></times><ci id="alg1.11.11.2.m2.1.1.1.3.cmml" xref="alg1.11.11.2.m2.1.1.1.3">length</ci><apply id="alg1.11.11.2.m2.1.1.1.1.1.1.cmml" xref="alg1.11.11.2.m2.1.1.1.1.1"><times id="alg1.11.11.2.m2.1.1.1.1.1.1.1.cmml" xref="alg1.11.11.2.m2.1.1.1.1.1.1.1"></times><ci id="alg1.11.11.2.m2.1.1.1.1.1.1.2.cmml" xref="alg1.11.11.2.m2.1.1.1.1.1.1.2">ğ‘¡</ci><ci id="alg1.11.11.2.m2.1.1.1.1.1.1.3.cmml" xref="alg1.11.11.2.m2.1.1.1.1.1.1.3">ğ‘œ</ci><ci id="alg1.11.11.2.m2.1.1.1.1.1.1.4.cmml" xref="alg1.11.11.2.m2.1.1.1.1.1.1.4">ğ‘˜</ci><ci id="alg1.11.11.2.m2.1.1.1.1.1.1.5.cmml" xref="alg1.11.11.2.m2.1.1.1.1.1.1.5">ğ‘’</ci><ci id="alg1.11.11.2.m2.1.1.1.1.1.1.6.cmml" xref="alg1.11.11.2.m2.1.1.1.1.1.1.6">ğ‘›</ci><ci id="alg1.11.11.2.m2.1.1.1.1.1.1.7.cmml" xref="alg1.11.11.2.m2.1.1.1.1.1.1.7">ğ‘ </ci></apply></apply><cn id="alg1.11.11.2.m2.1.1.3.cmml" type="integer" xref="alg1.11.11.2.m2.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.11.11.2.m2.1c">\mathrm{length}(tokens)-1</annotation><annotation encoding="application/x-llamapun" id="alg1.11.11.2.m2.1d">roman_length ( italic_t italic_o italic_k italic_e italic_n italic_s ) - 1</annotation></semantics></math></em>Â <span class="ltx_text ltx_font_bold" id="alg1.11.11.4">do</span>
</div>
<div class="ltx_listingline" id="alg1.29.33">Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<span class="ltx_text ltx_font_typewriter" id="alg1.29.33.1">//</span><span class="ltx_text ltx_font_typewriter" id="alg1.29.33.2">get perturbed sentence </span>
</div>
<div class="ltx_listingline" id="alg1.12.12">
<span class="ltx_tag ltx_tag_listingline">7</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<math alttext="words\leftarrow\mathrm{split}(X_{t})" class="ltx_Math" display="inline" id="alg1.12.12.m1.1"><semantics id="alg1.12.12.m1.1a"><mrow id="alg1.12.12.m1.1.1" xref="alg1.12.12.m1.1.1.cmml"><mrow id="alg1.12.12.m1.1.1.3" xref="alg1.12.12.m1.1.1.3.cmml"><mi id="alg1.12.12.m1.1.1.3.2" xref="alg1.12.12.m1.1.1.3.2.cmml">w</mi><mo id="alg1.12.12.m1.1.1.3.1" xref="alg1.12.12.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.12.12.m1.1.1.3.3" xref="alg1.12.12.m1.1.1.3.3.cmml">o</mi><mo id="alg1.12.12.m1.1.1.3.1a" xref="alg1.12.12.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.12.12.m1.1.1.3.4" xref="alg1.12.12.m1.1.1.3.4.cmml">r</mi><mo id="alg1.12.12.m1.1.1.3.1b" xref="alg1.12.12.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.12.12.m1.1.1.3.5" xref="alg1.12.12.m1.1.1.3.5.cmml">d</mi><mo id="alg1.12.12.m1.1.1.3.1c" xref="alg1.12.12.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.12.12.m1.1.1.3.6" xref="alg1.12.12.m1.1.1.3.6.cmml">s</mi></mrow><mo id="alg1.12.12.m1.1.1.2" stretchy="false" xref="alg1.12.12.m1.1.1.2.cmml">â†</mo><mrow id="alg1.12.12.m1.1.1.1" xref="alg1.12.12.m1.1.1.1.cmml"><mi id="alg1.12.12.m1.1.1.1.3" xref="alg1.12.12.m1.1.1.1.3.cmml">split</mi><mo id="alg1.12.12.m1.1.1.1.2" xref="alg1.12.12.m1.1.1.1.2.cmml">â¢</mo><mrow id="alg1.12.12.m1.1.1.1.1.1" xref="alg1.12.12.m1.1.1.1.1.1.1.cmml"><mo id="alg1.12.12.m1.1.1.1.1.1.2" stretchy="false" xref="alg1.12.12.m1.1.1.1.1.1.1.cmml">(</mo><msub id="alg1.12.12.m1.1.1.1.1.1.1" xref="alg1.12.12.m1.1.1.1.1.1.1.cmml"><mi id="alg1.12.12.m1.1.1.1.1.1.1.2" xref="alg1.12.12.m1.1.1.1.1.1.1.2.cmml">X</mi><mi id="alg1.12.12.m1.1.1.1.1.1.1.3" xref="alg1.12.12.m1.1.1.1.1.1.1.3.cmml">t</mi></msub><mo id="alg1.12.12.m1.1.1.1.1.1.3" stretchy="false" xref="alg1.12.12.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.12.12.m1.1b"><apply id="alg1.12.12.m1.1.1.cmml" xref="alg1.12.12.m1.1.1"><ci id="alg1.12.12.m1.1.1.2.cmml" xref="alg1.12.12.m1.1.1.2">â†</ci><apply id="alg1.12.12.m1.1.1.3.cmml" xref="alg1.12.12.m1.1.1.3"><times id="alg1.12.12.m1.1.1.3.1.cmml" xref="alg1.12.12.m1.1.1.3.1"></times><ci id="alg1.12.12.m1.1.1.3.2.cmml" xref="alg1.12.12.m1.1.1.3.2">ğ‘¤</ci><ci id="alg1.12.12.m1.1.1.3.3.cmml" xref="alg1.12.12.m1.1.1.3.3">ğ‘œ</ci><ci id="alg1.12.12.m1.1.1.3.4.cmml" xref="alg1.12.12.m1.1.1.3.4">ğ‘Ÿ</ci><ci id="alg1.12.12.m1.1.1.3.5.cmml" xref="alg1.12.12.m1.1.1.3.5">ğ‘‘</ci><ci id="alg1.12.12.m1.1.1.3.6.cmml" xref="alg1.12.12.m1.1.1.3.6">ğ‘ </ci></apply><apply id="alg1.12.12.m1.1.1.1.cmml" xref="alg1.12.12.m1.1.1.1"><times id="alg1.12.12.m1.1.1.1.2.cmml" xref="alg1.12.12.m1.1.1.1.2"></times><ci id="alg1.12.12.m1.1.1.1.3.cmml" xref="alg1.12.12.m1.1.1.1.3">split</ci><apply id="alg1.12.12.m1.1.1.1.1.1.1.cmml" xref="alg1.12.12.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.12.12.m1.1.1.1.1.1.1.1.cmml" xref="alg1.12.12.m1.1.1.1.1.1">subscript</csymbol><ci id="alg1.12.12.m1.1.1.1.1.1.1.2.cmml" xref="alg1.12.12.m1.1.1.1.1.1.1.2">ğ‘‹</ci><ci id="alg1.12.12.m1.1.1.1.1.1.1.3.cmml" xref="alg1.12.12.m1.1.1.1.1.1.1.3">ğ‘¡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.12.12.m1.1c">words\leftarrow\mathrm{split}(X_{t})</annotation><annotation encoding="application/x-llamapun" id="alg1.12.12.m1.1d">italic_w italic_o italic_r italic_d italic_s â† roman_split ( italic_X start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.13.13">
<span class="ltx_tag ltx_tag_listingline">8</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<span class="ltx_text ltx_font_bold" id="alg1.13.13.2">if</span>Â <em class="ltx_emph ltx_font_italic" id="alg1.13.13.1"><math alttext="0\leq index&lt;\mathrm{length}(words)" class="ltx_Math" display="inline" id="alg1.13.13.1.m1.1"><semantics id="alg1.13.13.1.m1.1a"><mrow id="alg1.13.13.1.m1.1.1" xref="alg1.13.13.1.m1.1.1.cmml"><mn id="alg1.13.13.1.m1.1.1.3" xref="alg1.13.13.1.m1.1.1.3.cmml">0</mn><mo id="alg1.13.13.1.m1.1.1.4" xref="alg1.13.13.1.m1.1.1.4.cmml">â‰¤</mo><mrow id="alg1.13.13.1.m1.1.1.5" xref="alg1.13.13.1.m1.1.1.5.cmml"><mi id="alg1.13.13.1.m1.1.1.5.2" xref="alg1.13.13.1.m1.1.1.5.2.cmml">i</mi><mo id="alg1.13.13.1.m1.1.1.5.1" xref="alg1.13.13.1.m1.1.1.5.1.cmml">â¢</mo><mi id="alg1.13.13.1.m1.1.1.5.3" xref="alg1.13.13.1.m1.1.1.5.3.cmml">n</mi><mo id="alg1.13.13.1.m1.1.1.5.1a" xref="alg1.13.13.1.m1.1.1.5.1.cmml">â¢</mo><mi id="alg1.13.13.1.m1.1.1.5.4" xref="alg1.13.13.1.m1.1.1.5.4.cmml">d</mi><mo id="alg1.13.13.1.m1.1.1.5.1b" xref="alg1.13.13.1.m1.1.1.5.1.cmml">â¢</mo><mi id="alg1.13.13.1.m1.1.1.5.5" xref="alg1.13.13.1.m1.1.1.5.5.cmml">e</mi><mo id="alg1.13.13.1.m1.1.1.5.1c" xref="alg1.13.13.1.m1.1.1.5.1.cmml">â¢</mo><mi id="alg1.13.13.1.m1.1.1.5.6" xref="alg1.13.13.1.m1.1.1.5.6.cmml">x</mi></mrow><mo id="alg1.13.13.1.m1.1.1.6" xref="alg1.13.13.1.m1.1.1.6.cmml">&lt;</mo><mrow id="alg1.13.13.1.m1.1.1.1" xref="alg1.13.13.1.m1.1.1.1.cmml"><mi id="alg1.13.13.1.m1.1.1.1.3" xref="alg1.13.13.1.m1.1.1.1.3.cmml">length</mi><mo id="alg1.13.13.1.m1.1.1.1.2" xref="alg1.13.13.1.m1.1.1.1.2.cmml">â¢</mo><mrow id="alg1.13.13.1.m1.1.1.1.1.1" xref="alg1.13.13.1.m1.1.1.1.1.1.1.cmml"><mo id="alg1.13.13.1.m1.1.1.1.1.1.2" stretchy="false" xref="alg1.13.13.1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="alg1.13.13.1.m1.1.1.1.1.1.1" xref="alg1.13.13.1.m1.1.1.1.1.1.1.cmml"><mi id="alg1.13.13.1.m1.1.1.1.1.1.1.2" xref="alg1.13.13.1.m1.1.1.1.1.1.1.2.cmml">w</mi><mo id="alg1.13.13.1.m1.1.1.1.1.1.1.1" xref="alg1.13.13.1.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.13.13.1.m1.1.1.1.1.1.1.3" xref="alg1.13.13.1.m1.1.1.1.1.1.1.3.cmml">o</mi><mo id="alg1.13.13.1.m1.1.1.1.1.1.1.1a" xref="alg1.13.13.1.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.13.13.1.m1.1.1.1.1.1.1.4" xref="alg1.13.13.1.m1.1.1.1.1.1.1.4.cmml">r</mi><mo id="alg1.13.13.1.m1.1.1.1.1.1.1.1b" xref="alg1.13.13.1.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.13.13.1.m1.1.1.1.1.1.1.5" xref="alg1.13.13.1.m1.1.1.1.1.1.1.5.cmml">d</mi><mo id="alg1.13.13.1.m1.1.1.1.1.1.1.1c" xref="alg1.13.13.1.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.13.13.1.m1.1.1.1.1.1.1.6" xref="alg1.13.13.1.m1.1.1.1.1.1.1.6.cmml">s</mi></mrow><mo id="alg1.13.13.1.m1.1.1.1.1.1.3" stretchy="false" xref="alg1.13.13.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.13.13.1.m1.1b"><apply id="alg1.13.13.1.m1.1.1.cmml" xref="alg1.13.13.1.m1.1.1"><and id="alg1.13.13.1.m1.1.1a.cmml" xref="alg1.13.13.1.m1.1.1"></and><apply id="alg1.13.13.1.m1.1.1b.cmml" xref="alg1.13.13.1.m1.1.1"><leq id="alg1.13.13.1.m1.1.1.4.cmml" xref="alg1.13.13.1.m1.1.1.4"></leq><cn id="alg1.13.13.1.m1.1.1.3.cmml" type="integer" xref="alg1.13.13.1.m1.1.1.3">0</cn><apply id="alg1.13.13.1.m1.1.1.5.cmml" xref="alg1.13.13.1.m1.1.1.5"><times id="alg1.13.13.1.m1.1.1.5.1.cmml" xref="alg1.13.13.1.m1.1.1.5.1"></times><ci id="alg1.13.13.1.m1.1.1.5.2.cmml" xref="alg1.13.13.1.m1.1.1.5.2">ğ‘–</ci><ci id="alg1.13.13.1.m1.1.1.5.3.cmml" xref="alg1.13.13.1.m1.1.1.5.3">ğ‘›</ci><ci id="alg1.13.13.1.m1.1.1.5.4.cmml" xref="alg1.13.13.1.m1.1.1.5.4">ğ‘‘</ci><ci id="alg1.13.13.1.m1.1.1.5.5.cmml" xref="alg1.13.13.1.m1.1.1.5.5">ğ‘’</ci><ci id="alg1.13.13.1.m1.1.1.5.6.cmml" xref="alg1.13.13.1.m1.1.1.5.6">ğ‘¥</ci></apply></apply><apply id="alg1.13.13.1.m1.1.1c.cmml" xref="alg1.13.13.1.m1.1.1"><lt id="alg1.13.13.1.m1.1.1.6.cmml" xref="alg1.13.13.1.m1.1.1.6"></lt><share href="https://arxiv.org/html/2402.07179v3#alg1.13.13.1.m1.1.1.5.cmml" id="alg1.13.13.1.m1.1.1d.cmml" xref="alg1.13.13.1.m1.1.1"></share><apply id="alg1.13.13.1.m1.1.1.1.cmml" xref="alg1.13.13.1.m1.1.1.1"><times id="alg1.13.13.1.m1.1.1.1.2.cmml" xref="alg1.13.13.1.m1.1.1.1.2"></times><ci id="alg1.13.13.1.m1.1.1.1.3.cmml" xref="alg1.13.13.1.m1.1.1.1.3">length</ci><apply id="alg1.13.13.1.m1.1.1.1.1.1.1.cmml" xref="alg1.13.13.1.m1.1.1.1.1.1"><times id="alg1.13.13.1.m1.1.1.1.1.1.1.1.cmml" xref="alg1.13.13.1.m1.1.1.1.1.1.1.1"></times><ci id="alg1.13.13.1.m1.1.1.1.1.1.1.2.cmml" xref="alg1.13.13.1.m1.1.1.1.1.1.1.2">ğ‘¤</ci><ci id="alg1.13.13.1.m1.1.1.1.1.1.1.3.cmml" xref="alg1.13.13.1.m1.1.1.1.1.1.1.3">ğ‘œ</ci><ci id="alg1.13.13.1.m1.1.1.1.1.1.1.4.cmml" xref="alg1.13.13.1.m1.1.1.1.1.1.1.4">ğ‘Ÿ</ci><ci id="alg1.13.13.1.m1.1.1.1.1.1.1.5.cmml" xref="alg1.13.13.1.m1.1.1.1.1.1.1.5">ğ‘‘</ci><ci id="alg1.13.13.1.m1.1.1.1.1.1.1.6.cmml" xref="alg1.13.13.1.m1.1.1.1.1.1.1.6">ğ‘ </ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.13.13.1.m1.1c">0\leq index&lt;\mathrm{length}(words)</annotation><annotation encoding="application/x-llamapun" id="alg1.13.13.1.m1.1d">0 â‰¤ italic_i italic_n italic_d italic_e italic_x &lt; roman_length ( italic_w italic_o italic_r italic_d italic_s )</annotation></semantics></math></em>Â <span class="ltx_text ltx_font_bold" id="alg1.13.13.3">then</span>
</div>
<div class="ltx_listingline" id="alg1.14.14">
<span class="ltx_tag ltx_tag_listingline">9</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<math alttext="words[index]\leftarrow\mathrm{`[MASK]^{\prime}}" class="ltx_Math" display="inline" id="alg1.14.14.m1.2"><semantics id="alg1.14.14.m1.2a"><mrow id="alg1.14.14.m1.2.2" xref="alg1.14.14.m1.2.2.cmml"><mrow id="alg1.14.14.m1.2.2.1" xref="alg1.14.14.m1.2.2.1.cmml"><mi id="alg1.14.14.m1.2.2.1.3" xref="alg1.14.14.m1.2.2.1.3.cmml">w</mi><mo id="alg1.14.14.m1.2.2.1.2" xref="alg1.14.14.m1.2.2.1.2.cmml">â¢</mo><mi id="alg1.14.14.m1.2.2.1.4" xref="alg1.14.14.m1.2.2.1.4.cmml">o</mi><mo id="alg1.14.14.m1.2.2.1.2a" xref="alg1.14.14.m1.2.2.1.2.cmml">â¢</mo><mi id="alg1.14.14.m1.2.2.1.5" xref="alg1.14.14.m1.2.2.1.5.cmml">r</mi><mo id="alg1.14.14.m1.2.2.1.2b" xref="alg1.14.14.m1.2.2.1.2.cmml">â¢</mo><mi id="alg1.14.14.m1.2.2.1.6" xref="alg1.14.14.m1.2.2.1.6.cmml">d</mi><mo id="alg1.14.14.m1.2.2.1.2c" xref="alg1.14.14.m1.2.2.1.2.cmml">â¢</mo><mi id="alg1.14.14.m1.2.2.1.7" xref="alg1.14.14.m1.2.2.1.7.cmml">s</mi><mo id="alg1.14.14.m1.2.2.1.2d" xref="alg1.14.14.m1.2.2.1.2.cmml">â¢</mo><mrow id="alg1.14.14.m1.2.2.1.1.1" xref="alg1.14.14.m1.2.2.1.1.2.cmml"><mo id="alg1.14.14.m1.2.2.1.1.1.2" stretchy="false" xref="alg1.14.14.m1.2.2.1.1.2.1.cmml">[</mo><mrow id="alg1.14.14.m1.2.2.1.1.1.1" xref="alg1.14.14.m1.2.2.1.1.1.1.cmml"><mi id="alg1.14.14.m1.2.2.1.1.1.1.2" xref="alg1.14.14.m1.2.2.1.1.1.1.2.cmml">i</mi><mo id="alg1.14.14.m1.2.2.1.1.1.1.1" xref="alg1.14.14.m1.2.2.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.14.14.m1.2.2.1.1.1.1.3" xref="alg1.14.14.m1.2.2.1.1.1.1.3.cmml">n</mi><mo id="alg1.14.14.m1.2.2.1.1.1.1.1a" xref="alg1.14.14.m1.2.2.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.14.14.m1.2.2.1.1.1.1.4" xref="alg1.14.14.m1.2.2.1.1.1.1.4.cmml">d</mi><mo id="alg1.14.14.m1.2.2.1.1.1.1.1b" xref="alg1.14.14.m1.2.2.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.14.14.m1.2.2.1.1.1.1.5" xref="alg1.14.14.m1.2.2.1.1.1.1.5.cmml">e</mi><mo id="alg1.14.14.m1.2.2.1.1.1.1.1c" xref="alg1.14.14.m1.2.2.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.14.14.m1.2.2.1.1.1.1.6" xref="alg1.14.14.m1.2.2.1.1.1.1.6.cmml">x</mi></mrow><mo id="alg1.14.14.m1.2.2.1.1.1.3" stretchy="false" xref="alg1.14.14.m1.2.2.1.1.2.1.cmml">]</mo></mrow></mrow><mo id="alg1.14.14.m1.2.2.2" stretchy="false" xref="alg1.14.14.m1.2.2.2.cmml">â†</mo><mrow id="alg1.14.14.m1.2.2.3" xref="alg1.14.14.m1.2.2.3.cmml"><mi id="alg1.14.14.m1.2.2.3.2" mathvariant="normal" xref="alg1.14.14.m1.2.2.3.2.cmml">`</mi><mo id="alg1.14.14.m1.2.2.3.1" xref="alg1.14.14.m1.2.2.3.1.cmml">â¢</mo><msup id="alg1.14.14.m1.2.2.3.3" xref="alg1.14.14.m1.2.2.3.3.cmml"><mrow id="alg1.14.14.m1.2.2.3.3.2.2" xref="alg1.14.14.m1.2.2.3.3.2.1.cmml"><mo id="alg1.14.14.m1.2.2.3.3.2.2.1" stretchy="false" xref="alg1.14.14.m1.2.2.3.3.2.1.1.cmml">[</mo><mi id="alg1.14.14.m1.1.1" xref="alg1.14.14.m1.1.1.cmml">MASK</mi><mo id="alg1.14.14.m1.2.2.3.3.2.2.2" stretchy="false" xref="alg1.14.14.m1.2.2.3.3.2.1.1.cmml">]</mo></mrow><mo id="alg1.14.14.m1.2.2.3.3.3" xref="alg1.14.14.m1.2.2.3.3.3.cmml">â€²</mo></msup></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.14.14.m1.2b"><apply id="alg1.14.14.m1.2.2.cmml" xref="alg1.14.14.m1.2.2"><ci id="alg1.14.14.m1.2.2.2.cmml" xref="alg1.14.14.m1.2.2.2">â†</ci><apply id="alg1.14.14.m1.2.2.1.cmml" xref="alg1.14.14.m1.2.2.1"><times id="alg1.14.14.m1.2.2.1.2.cmml" xref="alg1.14.14.m1.2.2.1.2"></times><ci id="alg1.14.14.m1.2.2.1.3.cmml" xref="alg1.14.14.m1.2.2.1.3">ğ‘¤</ci><ci id="alg1.14.14.m1.2.2.1.4.cmml" xref="alg1.14.14.m1.2.2.1.4">ğ‘œ</ci><ci id="alg1.14.14.m1.2.2.1.5.cmml" xref="alg1.14.14.m1.2.2.1.5">ğ‘Ÿ</ci><ci id="alg1.14.14.m1.2.2.1.6.cmml" xref="alg1.14.14.m1.2.2.1.6">ğ‘‘</ci><ci id="alg1.14.14.m1.2.2.1.7.cmml" xref="alg1.14.14.m1.2.2.1.7">ğ‘ </ci><apply id="alg1.14.14.m1.2.2.1.1.2.cmml" xref="alg1.14.14.m1.2.2.1.1.1"><csymbol cd="latexml" id="alg1.14.14.m1.2.2.1.1.2.1.cmml" xref="alg1.14.14.m1.2.2.1.1.1.2">delimited-[]</csymbol><apply id="alg1.14.14.m1.2.2.1.1.1.1.cmml" xref="alg1.14.14.m1.2.2.1.1.1.1"><times id="alg1.14.14.m1.2.2.1.1.1.1.1.cmml" xref="alg1.14.14.m1.2.2.1.1.1.1.1"></times><ci id="alg1.14.14.m1.2.2.1.1.1.1.2.cmml" xref="alg1.14.14.m1.2.2.1.1.1.1.2">ğ‘–</ci><ci id="alg1.14.14.m1.2.2.1.1.1.1.3.cmml" xref="alg1.14.14.m1.2.2.1.1.1.1.3">ğ‘›</ci><ci id="alg1.14.14.m1.2.2.1.1.1.1.4.cmml" xref="alg1.14.14.m1.2.2.1.1.1.1.4">ğ‘‘</ci><ci id="alg1.14.14.m1.2.2.1.1.1.1.5.cmml" xref="alg1.14.14.m1.2.2.1.1.1.1.5">ğ‘’</ci><ci id="alg1.14.14.m1.2.2.1.1.1.1.6.cmml" xref="alg1.14.14.m1.2.2.1.1.1.1.6">ğ‘¥</ci></apply></apply></apply><apply id="alg1.14.14.m1.2.2.3.cmml" xref="alg1.14.14.m1.2.2.3"><times id="alg1.14.14.m1.2.2.3.1.cmml" xref="alg1.14.14.m1.2.2.3.1"></times><ci id="alg1.14.14.m1.2.2.3.2.cmml" xref="alg1.14.14.m1.2.2.3.2">`</ci><apply id="alg1.14.14.m1.2.2.3.3.cmml" xref="alg1.14.14.m1.2.2.3.3"><csymbol cd="ambiguous" id="alg1.14.14.m1.2.2.3.3.1.cmml" xref="alg1.14.14.m1.2.2.3.3">superscript</csymbol><apply id="alg1.14.14.m1.2.2.3.3.2.1.cmml" xref="alg1.14.14.m1.2.2.3.3.2.2"><csymbol cd="latexml" id="alg1.14.14.m1.2.2.3.3.2.1.1.cmml" xref="alg1.14.14.m1.2.2.3.3.2.2.1">delimited-[]</csymbol><ci id="alg1.14.14.m1.1.1.cmml" xref="alg1.14.14.m1.1.1">MASK</ci></apply><ci id="alg1.14.14.m1.2.2.3.3.3.cmml" xref="alg1.14.14.m1.2.2.3.3.3">â€²</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.14.14.m1.2c">words[index]\leftarrow\mathrm{`[MASK]^{\prime}}</annotation><annotation encoding="application/x-llamapun" id="alg1.14.14.m1.2d">italic_w italic_o italic_r italic_d italic_s [ italic_i italic_n italic_d italic_e italic_x ] â† ` [ roman_MASK ] start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.29.34">
<span class="ltx_tag ltx_tag_listingline">10</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 

</div>
<div class="ltx_listingline" id="alg1.29.35">
<span class="ltx_tag ltx_tag_listingline">11</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â  end if
</div>
<div class="ltx_listingline" id="alg1.29.36">
<span class="ltx_tag ltx_tag_listingline">12</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
</div>
<div class="ltx_listingline" id="alg1.16.16">
<span class="ltx_tag ltx_tag_listingline">13</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â perturbed <math alttext="X^{\prime}_{t}" class="ltx_Math" display="inline" id="alg1.15.15.m1.1"><semantics id="alg1.15.15.m1.1a"><msubsup id="alg1.15.15.m1.1.1" xref="alg1.15.15.m1.1.1.cmml"><mi id="alg1.15.15.m1.1.1.2.2" xref="alg1.15.15.m1.1.1.2.2.cmml">X</mi><mi id="alg1.15.15.m1.1.1.3" xref="alg1.15.15.m1.1.1.3.cmml">t</mi><mo id="alg1.15.15.m1.1.1.2.3" xref="alg1.15.15.m1.1.1.2.3.cmml">â€²</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg1.15.15.m1.1b"><apply id="alg1.15.15.m1.1.1.cmml" xref="alg1.15.15.m1.1.1"><csymbol cd="ambiguous" id="alg1.15.15.m1.1.1.1.cmml" xref="alg1.15.15.m1.1.1">subscript</csymbol><apply id="alg1.15.15.m1.1.1.2.cmml" xref="alg1.15.15.m1.1.1"><csymbol cd="ambiguous" id="alg1.15.15.m1.1.1.2.1.cmml" xref="alg1.15.15.m1.1.1">superscript</csymbol><ci id="alg1.15.15.m1.1.1.2.2.cmml" xref="alg1.15.15.m1.1.1.2.2">ğ‘‹</ci><ci id="alg1.15.15.m1.1.1.2.3.cmml" xref="alg1.15.15.m1.1.1.2.3">â€²</ci></apply><ci id="alg1.15.15.m1.1.1.3.cmml" xref="alg1.15.15.m1.1.1.3">ğ‘¡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.15.15.m1.1c">X^{\prime}_{t}</annotation><annotation encoding="application/x-llamapun" id="alg1.15.15.m1.1d">italic_X start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> <math alttext="\leftarrow\mathrm{join}(words)" class="ltx_Math" display="inline" id="alg1.16.16.m2.1"><semantics id="alg1.16.16.m2.1a"><mrow id="alg1.16.16.m2.1.1" xref="alg1.16.16.m2.1.1.cmml"><mi id="alg1.16.16.m2.1.1.3" xref="alg1.16.16.m2.1.1.3.cmml"></mi><mo id="alg1.16.16.m2.1.1.2" stretchy="false" xref="alg1.16.16.m2.1.1.2.cmml">â†</mo><mrow id="alg1.16.16.m2.1.1.1" xref="alg1.16.16.m2.1.1.1.cmml"><mi id="alg1.16.16.m2.1.1.1.3" xref="alg1.16.16.m2.1.1.1.3.cmml">join</mi><mo id="alg1.16.16.m2.1.1.1.2" xref="alg1.16.16.m2.1.1.1.2.cmml">â¢</mo><mrow id="alg1.16.16.m2.1.1.1.1.1" xref="alg1.16.16.m2.1.1.1.1.1.1.cmml"><mo id="alg1.16.16.m2.1.1.1.1.1.2" stretchy="false" xref="alg1.16.16.m2.1.1.1.1.1.1.cmml">(</mo><mrow id="alg1.16.16.m2.1.1.1.1.1.1" xref="alg1.16.16.m2.1.1.1.1.1.1.cmml"><mi id="alg1.16.16.m2.1.1.1.1.1.1.2" xref="alg1.16.16.m2.1.1.1.1.1.1.2.cmml">w</mi><mo id="alg1.16.16.m2.1.1.1.1.1.1.1" xref="alg1.16.16.m2.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.16.16.m2.1.1.1.1.1.1.3" xref="alg1.16.16.m2.1.1.1.1.1.1.3.cmml">o</mi><mo id="alg1.16.16.m2.1.1.1.1.1.1.1a" xref="alg1.16.16.m2.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.16.16.m2.1.1.1.1.1.1.4" xref="alg1.16.16.m2.1.1.1.1.1.1.4.cmml">r</mi><mo id="alg1.16.16.m2.1.1.1.1.1.1.1b" xref="alg1.16.16.m2.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.16.16.m2.1.1.1.1.1.1.5" xref="alg1.16.16.m2.1.1.1.1.1.1.5.cmml">d</mi><mo id="alg1.16.16.m2.1.1.1.1.1.1.1c" xref="alg1.16.16.m2.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.16.16.m2.1.1.1.1.1.1.6" xref="alg1.16.16.m2.1.1.1.1.1.1.6.cmml">s</mi></mrow><mo id="alg1.16.16.m2.1.1.1.1.1.3" stretchy="false" xref="alg1.16.16.m2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.16.16.m2.1b"><apply id="alg1.16.16.m2.1.1.cmml" xref="alg1.16.16.m2.1.1"><ci id="alg1.16.16.m2.1.1.2.cmml" xref="alg1.16.16.m2.1.1.2">â†</ci><csymbol cd="latexml" id="alg1.16.16.m2.1.1.3.cmml" xref="alg1.16.16.m2.1.1.3">absent</csymbol><apply id="alg1.16.16.m2.1.1.1.cmml" xref="alg1.16.16.m2.1.1.1"><times id="alg1.16.16.m2.1.1.1.2.cmml" xref="alg1.16.16.m2.1.1.1.2"></times><ci id="alg1.16.16.m2.1.1.1.3.cmml" xref="alg1.16.16.m2.1.1.1.3">join</ci><apply id="alg1.16.16.m2.1.1.1.1.1.1.cmml" xref="alg1.16.16.m2.1.1.1.1.1"><times id="alg1.16.16.m2.1.1.1.1.1.1.1.cmml" xref="alg1.16.16.m2.1.1.1.1.1.1.1"></times><ci id="alg1.16.16.m2.1.1.1.1.1.1.2.cmml" xref="alg1.16.16.m2.1.1.1.1.1.1.2">ğ‘¤</ci><ci id="alg1.16.16.m2.1.1.1.1.1.1.3.cmml" xref="alg1.16.16.m2.1.1.1.1.1.1.3">ğ‘œ</ci><ci id="alg1.16.16.m2.1.1.1.1.1.1.4.cmml" xref="alg1.16.16.m2.1.1.1.1.1.1.4">ğ‘Ÿ</ci><ci id="alg1.16.16.m2.1.1.1.1.1.1.5.cmml" xref="alg1.16.16.m2.1.1.1.1.1.1.5">ğ‘‘</ci><ci id="alg1.16.16.m2.1.1.1.1.1.1.6.cmml" xref="alg1.16.16.m2.1.1.1.1.1.1.6">ğ‘ </ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.16.16.m2.1c">\leftarrow\mathrm{join}(words)</annotation><annotation encoding="application/x-llamapun" id="alg1.16.16.m2.1d">â† roman_join ( italic_w italic_o italic_r italic_d italic_s )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.19.19">
<span class="ltx_tag ltx_tag_listingline">14</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
perturbed embedding <math alttext="\mathbf{e^{\prime}}\leftarrow" class="ltx_Math" display="inline" id="alg1.17.17.m1.1"><semantics id="alg1.17.17.m1.1a"><mrow id="alg1.17.17.m1.1.1" xref="alg1.17.17.m1.1.1.cmml"><msup id="alg1.17.17.m1.1.1.2" xref="alg1.17.17.m1.1.1.2.cmml"><mi id="alg1.17.17.m1.1.1.2.2" xref="alg1.17.17.m1.1.1.2.2.cmml">ğ</mi><mo id="alg1.17.17.m1.1.1.2.3" xref="alg1.17.17.m1.1.1.2.3.cmml">â€²</mo></msup><mo id="alg1.17.17.m1.1.1.1" stretchy="false" xref="alg1.17.17.m1.1.1.1.cmml">â†</mo><mi id="alg1.17.17.m1.1.1.3" xref="alg1.17.17.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.17.17.m1.1b"><apply id="alg1.17.17.m1.1.1.cmml" xref="alg1.17.17.m1.1.1"><ci id="alg1.17.17.m1.1.1.1.cmml" xref="alg1.17.17.m1.1.1.1">â†</ci><apply id="alg1.17.17.m1.1.1.2.cmml" xref="alg1.17.17.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.17.17.m1.1.1.2.1.cmml" xref="alg1.17.17.m1.1.1.2">superscript</csymbol><ci id="alg1.17.17.m1.1.1.2.2.cmml" xref="alg1.17.17.m1.1.1.2.2">ğ</ci><ci id="alg1.17.17.m1.1.1.2.3.cmml" xref="alg1.17.17.m1.1.1.2.3">â€²</ci></apply><csymbol cd="latexml" id="alg1.17.17.m1.1.1.3.cmml" xref="alg1.17.17.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.17.17.m1.1c">\mathbf{e^{\prime}}\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg1.17.17.m1.1d">bold_e start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT â†</annotation></semantics></math> <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="alg1.18.18.m2.1"><semantics id="alg1.18.18.m2.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.18.18.m2.1.1" xref="alg1.18.18.m2.1.1.cmml">â„³</mi><annotation-xml encoding="MathML-Content" id="alg1.18.18.m2.1b"><ci id="alg1.18.18.m2.1.1.cmml" xref="alg1.18.18.m2.1.1">â„³</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.18.18.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="alg1.18.18.m2.1d">caligraphic_M</annotation></semantics></math><span class="ltx_text ltx_font_typewriter" id="alg1.19.19.1">(<em class="ltx_emph ltx_font_serif ltx_font_italic" id="alg1.19.19.1.1"><math alttext="X^{\prime}_{t}" class="ltx_Math" display="inline" id="alg1.19.19.1.1.m1.1"><semantics id="alg1.19.19.1.1.m1.1a"><msubsup id="alg1.19.19.1.1.m1.1.1" xref="alg1.19.19.1.1.m1.1.1.cmml"><mi id="alg1.19.19.1.1.m1.1.1.2.2" xref="alg1.19.19.1.1.m1.1.1.2.2.cmml">X</mi><mi id="alg1.19.19.1.1.m1.1.1.3" xref="alg1.19.19.1.1.m1.1.1.3.cmml">t</mi><mo id="alg1.19.19.1.1.m1.1.1.2.3" xref="alg1.19.19.1.1.m1.1.1.2.3.cmml">â€²</mo></msubsup><annotation-xml encoding="MathML-Content" id="alg1.19.19.1.1.m1.1b"><apply id="alg1.19.19.1.1.m1.1.1.cmml" xref="alg1.19.19.1.1.m1.1.1"><csymbol cd="ambiguous" id="alg1.19.19.1.1.m1.1.1.1.cmml" xref="alg1.19.19.1.1.m1.1.1">subscript</csymbol><apply id="alg1.19.19.1.1.m1.1.1.2.cmml" xref="alg1.19.19.1.1.m1.1.1"><csymbol cd="ambiguous" id="alg1.19.19.1.1.m1.1.1.2.1.cmml" xref="alg1.19.19.1.1.m1.1.1">superscript</csymbol><ci id="alg1.19.19.1.1.m1.1.1.2.2.cmml" xref="alg1.19.19.1.1.m1.1.1.2.2">ğ‘‹</ci><ci id="alg1.19.19.1.1.m1.1.1.2.3.cmml" xref="alg1.19.19.1.1.m1.1.1.2.3">â€²</ci></apply><ci id="alg1.19.19.1.1.m1.1.1.3.cmml" xref="alg1.19.19.1.1.m1.1.1.3">ğ‘¡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.19.19.1.1.m1.1c">X^{\prime}_{t}</annotation><annotation encoding="application/x-llamapun" id="alg1.19.19.1.1.m1.1d">italic_X start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math></em>)</span>
</div>
<div class="ltx_listingline" id="alg1.20.20">
<span class="ltx_tag ltx_tag_listingline">15</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<math alttext="distance\leftarrow 1-\mathrm{cos}(\mathbf{e},\mathbf{e^{\prime}})" class="ltx_Math" display="inline" id="alg1.20.20.m1.2"><semantics id="alg1.20.20.m1.2a"><mrow id="alg1.20.20.m1.2.2" xref="alg1.20.20.m1.2.2.cmml"><mrow id="alg1.20.20.m1.2.2.3" xref="alg1.20.20.m1.2.2.3.cmml"><mi id="alg1.20.20.m1.2.2.3.2" xref="alg1.20.20.m1.2.2.3.2.cmml">d</mi><mo id="alg1.20.20.m1.2.2.3.1" xref="alg1.20.20.m1.2.2.3.1.cmml">â¢</mo><mi id="alg1.20.20.m1.2.2.3.3" xref="alg1.20.20.m1.2.2.3.3.cmml">i</mi><mo id="alg1.20.20.m1.2.2.3.1a" xref="alg1.20.20.m1.2.2.3.1.cmml">â¢</mo><mi id="alg1.20.20.m1.2.2.3.4" xref="alg1.20.20.m1.2.2.3.4.cmml">s</mi><mo id="alg1.20.20.m1.2.2.3.1b" xref="alg1.20.20.m1.2.2.3.1.cmml">â¢</mo><mi id="alg1.20.20.m1.2.2.3.5" xref="alg1.20.20.m1.2.2.3.5.cmml">t</mi><mo id="alg1.20.20.m1.2.2.3.1c" xref="alg1.20.20.m1.2.2.3.1.cmml">â¢</mo><mi id="alg1.20.20.m1.2.2.3.6" xref="alg1.20.20.m1.2.2.3.6.cmml">a</mi><mo id="alg1.20.20.m1.2.2.3.1d" xref="alg1.20.20.m1.2.2.3.1.cmml">â¢</mo><mi id="alg1.20.20.m1.2.2.3.7" xref="alg1.20.20.m1.2.2.3.7.cmml">n</mi><mo id="alg1.20.20.m1.2.2.3.1e" xref="alg1.20.20.m1.2.2.3.1.cmml">â¢</mo><mi id="alg1.20.20.m1.2.2.3.8" xref="alg1.20.20.m1.2.2.3.8.cmml">c</mi><mo id="alg1.20.20.m1.2.2.3.1f" xref="alg1.20.20.m1.2.2.3.1.cmml">â¢</mo><mi id="alg1.20.20.m1.2.2.3.9" xref="alg1.20.20.m1.2.2.3.9.cmml">e</mi></mrow><mo id="alg1.20.20.m1.2.2.2" stretchy="false" xref="alg1.20.20.m1.2.2.2.cmml">â†</mo><mrow id="alg1.20.20.m1.2.2.1" xref="alg1.20.20.m1.2.2.1.cmml"><mn id="alg1.20.20.m1.2.2.1.3" xref="alg1.20.20.m1.2.2.1.3.cmml">1</mn><mo id="alg1.20.20.m1.2.2.1.2" xref="alg1.20.20.m1.2.2.1.2.cmml">âˆ’</mo><mrow id="alg1.20.20.m1.2.2.1.1" xref="alg1.20.20.m1.2.2.1.1.cmml"><mi id="alg1.20.20.m1.2.2.1.1.3" xref="alg1.20.20.m1.2.2.1.1.3.cmml">cos</mi><mo id="alg1.20.20.m1.2.2.1.1.2" xref="alg1.20.20.m1.2.2.1.1.2.cmml">â¢</mo><mrow id="alg1.20.20.m1.2.2.1.1.1.1" xref="alg1.20.20.m1.2.2.1.1.1.2.cmml"><mo id="alg1.20.20.m1.2.2.1.1.1.1.2" stretchy="false" xref="alg1.20.20.m1.2.2.1.1.1.2.cmml">(</mo><mi id="alg1.20.20.m1.1.1" xref="alg1.20.20.m1.1.1.cmml">ğ</mi><mo id="alg1.20.20.m1.2.2.1.1.1.1.3" xref="alg1.20.20.m1.2.2.1.1.1.2.cmml">,</mo><msup id="alg1.20.20.m1.2.2.1.1.1.1.1" xref="alg1.20.20.m1.2.2.1.1.1.1.1.cmml"><mi id="alg1.20.20.m1.2.2.1.1.1.1.1.2" xref="alg1.20.20.m1.2.2.1.1.1.1.1.2.cmml">ğ</mi><mo id="alg1.20.20.m1.2.2.1.1.1.1.1.3" xref="alg1.20.20.m1.2.2.1.1.1.1.1.3.cmml">â€²</mo></msup><mo id="alg1.20.20.m1.2.2.1.1.1.1.4" stretchy="false" xref="alg1.20.20.m1.2.2.1.1.1.2.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.20.20.m1.2b"><apply id="alg1.20.20.m1.2.2.cmml" xref="alg1.20.20.m1.2.2"><ci id="alg1.20.20.m1.2.2.2.cmml" xref="alg1.20.20.m1.2.2.2">â†</ci><apply id="alg1.20.20.m1.2.2.3.cmml" xref="alg1.20.20.m1.2.2.3"><times id="alg1.20.20.m1.2.2.3.1.cmml" xref="alg1.20.20.m1.2.2.3.1"></times><ci id="alg1.20.20.m1.2.2.3.2.cmml" xref="alg1.20.20.m1.2.2.3.2">ğ‘‘</ci><ci id="alg1.20.20.m1.2.2.3.3.cmml" xref="alg1.20.20.m1.2.2.3.3">ğ‘–</ci><ci id="alg1.20.20.m1.2.2.3.4.cmml" xref="alg1.20.20.m1.2.2.3.4">ğ‘ </ci><ci id="alg1.20.20.m1.2.2.3.5.cmml" xref="alg1.20.20.m1.2.2.3.5">ğ‘¡</ci><ci id="alg1.20.20.m1.2.2.3.6.cmml" xref="alg1.20.20.m1.2.2.3.6">ğ‘</ci><ci id="alg1.20.20.m1.2.2.3.7.cmml" xref="alg1.20.20.m1.2.2.3.7">ğ‘›</ci><ci id="alg1.20.20.m1.2.2.3.8.cmml" xref="alg1.20.20.m1.2.2.3.8">ğ‘</ci><ci id="alg1.20.20.m1.2.2.3.9.cmml" xref="alg1.20.20.m1.2.2.3.9">ğ‘’</ci></apply><apply id="alg1.20.20.m1.2.2.1.cmml" xref="alg1.20.20.m1.2.2.1"><minus id="alg1.20.20.m1.2.2.1.2.cmml" xref="alg1.20.20.m1.2.2.1.2"></minus><cn id="alg1.20.20.m1.2.2.1.3.cmml" type="integer" xref="alg1.20.20.m1.2.2.1.3">1</cn><apply id="alg1.20.20.m1.2.2.1.1.cmml" xref="alg1.20.20.m1.2.2.1.1"><times id="alg1.20.20.m1.2.2.1.1.2.cmml" xref="alg1.20.20.m1.2.2.1.1.2"></times><ci id="alg1.20.20.m1.2.2.1.1.3.cmml" xref="alg1.20.20.m1.2.2.1.1.3">cos</ci><interval closure="open" id="alg1.20.20.m1.2.2.1.1.1.2.cmml" xref="alg1.20.20.m1.2.2.1.1.1.1"><ci id="alg1.20.20.m1.1.1.cmml" xref="alg1.20.20.m1.1.1">ğ</ci><apply id="alg1.20.20.m1.2.2.1.1.1.1.1.cmml" xref="alg1.20.20.m1.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.20.20.m1.2.2.1.1.1.1.1.1.cmml" xref="alg1.20.20.m1.2.2.1.1.1.1.1">superscript</csymbol><ci id="alg1.20.20.m1.2.2.1.1.1.1.1.2.cmml" xref="alg1.20.20.m1.2.2.1.1.1.1.1.2">ğ</ci><ci id="alg1.20.20.m1.2.2.1.1.1.1.1.3.cmml" xref="alg1.20.20.m1.2.2.1.1.1.1.1.3">â€²</ci></apply></interval></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.20.20.m1.2c">distance\leftarrow 1-\mathrm{cos}(\mathbf{e},\mathbf{e^{\prime}})</annotation><annotation encoding="application/x-llamapun" id="alg1.20.20.m1.2d">italic_d italic_i italic_s italic_t italic_a italic_n italic_c italic_e â† 1 - roman_cos ( bold_e , bold_e start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.22.22">
<span class="ltx_tag ltx_tag_listingline">16</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
Append <math alttext="distance" class="ltx_Math" display="inline" id="alg1.21.21.m1.1"><semantics id="alg1.21.21.m1.1a"><mrow id="alg1.21.21.m1.1.1" xref="alg1.21.21.m1.1.1.cmml"><mi id="alg1.21.21.m1.1.1.2" xref="alg1.21.21.m1.1.1.2.cmml">d</mi><mo id="alg1.21.21.m1.1.1.1" xref="alg1.21.21.m1.1.1.1.cmml">â¢</mo><mi id="alg1.21.21.m1.1.1.3" xref="alg1.21.21.m1.1.1.3.cmml">i</mi><mo id="alg1.21.21.m1.1.1.1a" xref="alg1.21.21.m1.1.1.1.cmml">â¢</mo><mi id="alg1.21.21.m1.1.1.4" xref="alg1.21.21.m1.1.1.4.cmml">s</mi><mo id="alg1.21.21.m1.1.1.1b" xref="alg1.21.21.m1.1.1.1.cmml">â¢</mo><mi id="alg1.21.21.m1.1.1.5" xref="alg1.21.21.m1.1.1.5.cmml">t</mi><mo id="alg1.21.21.m1.1.1.1c" xref="alg1.21.21.m1.1.1.1.cmml">â¢</mo><mi id="alg1.21.21.m1.1.1.6" xref="alg1.21.21.m1.1.1.6.cmml">a</mi><mo id="alg1.21.21.m1.1.1.1d" xref="alg1.21.21.m1.1.1.1.cmml">â¢</mo><mi id="alg1.21.21.m1.1.1.7" xref="alg1.21.21.m1.1.1.7.cmml">n</mi><mo id="alg1.21.21.m1.1.1.1e" xref="alg1.21.21.m1.1.1.1.cmml">â¢</mo><mi id="alg1.21.21.m1.1.1.8" xref="alg1.21.21.m1.1.1.8.cmml">c</mi><mo id="alg1.21.21.m1.1.1.1f" xref="alg1.21.21.m1.1.1.1.cmml">â¢</mo><mi id="alg1.21.21.m1.1.1.9" xref="alg1.21.21.m1.1.1.9.cmml">e</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.21.21.m1.1b"><apply id="alg1.21.21.m1.1.1.cmml" xref="alg1.21.21.m1.1.1"><times id="alg1.21.21.m1.1.1.1.cmml" xref="alg1.21.21.m1.1.1.1"></times><ci id="alg1.21.21.m1.1.1.2.cmml" xref="alg1.21.21.m1.1.1.2">ğ‘‘</ci><ci id="alg1.21.21.m1.1.1.3.cmml" xref="alg1.21.21.m1.1.1.3">ğ‘–</ci><ci id="alg1.21.21.m1.1.1.4.cmml" xref="alg1.21.21.m1.1.1.4">ğ‘ </ci><ci id="alg1.21.21.m1.1.1.5.cmml" xref="alg1.21.21.m1.1.1.5">ğ‘¡</ci><ci id="alg1.21.21.m1.1.1.6.cmml" xref="alg1.21.21.m1.1.1.6">ğ‘</ci><ci id="alg1.21.21.m1.1.1.7.cmml" xref="alg1.21.21.m1.1.1.7">ğ‘›</ci><ci id="alg1.21.21.m1.1.1.8.cmml" xref="alg1.21.21.m1.1.1.8">ğ‘</ci><ci id="alg1.21.21.m1.1.1.9.cmml" xref="alg1.21.21.m1.1.1.9">ğ‘’</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.21.21.m1.1c">distance</annotation><annotation encoding="application/x-llamapun" id="alg1.21.21.m1.1d">italic_d italic_i italic_s italic_t italic_a italic_n italic_c italic_e</annotation></semantics></math> to <math alttext="distances" class="ltx_Math" display="inline" id="alg1.22.22.m2.1"><semantics id="alg1.22.22.m2.1a"><mrow id="alg1.22.22.m2.1.1" xref="alg1.22.22.m2.1.1.cmml"><mi id="alg1.22.22.m2.1.1.2" xref="alg1.22.22.m2.1.1.2.cmml">d</mi><mo id="alg1.22.22.m2.1.1.1" xref="alg1.22.22.m2.1.1.1.cmml">â¢</mo><mi id="alg1.22.22.m2.1.1.3" xref="alg1.22.22.m2.1.1.3.cmml">i</mi><mo id="alg1.22.22.m2.1.1.1a" xref="alg1.22.22.m2.1.1.1.cmml">â¢</mo><mi id="alg1.22.22.m2.1.1.4" xref="alg1.22.22.m2.1.1.4.cmml">s</mi><mo id="alg1.22.22.m2.1.1.1b" xref="alg1.22.22.m2.1.1.1.cmml">â¢</mo><mi id="alg1.22.22.m2.1.1.5" xref="alg1.22.22.m2.1.1.5.cmml">t</mi><mo id="alg1.22.22.m2.1.1.1c" xref="alg1.22.22.m2.1.1.1.cmml">â¢</mo><mi id="alg1.22.22.m2.1.1.6" xref="alg1.22.22.m2.1.1.6.cmml">a</mi><mo id="alg1.22.22.m2.1.1.1d" xref="alg1.22.22.m2.1.1.1.cmml">â¢</mo><mi id="alg1.22.22.m2.1.1.7" xref="alg1.22.22.m2.1.1.7.cmml">n</mi><mo id="alg1.22.22.m2.1.1.1e" xref="alg1.22.22.m2.1.1.1.cmml">â¢</mo><mi id="alg1.22.22.m2.1.1.8" xref="alg1.22.22.m2.1.1.8.cmml">c</mi><mo id="alg1.22.22.m2.1.1.1f" xref="alg1.22.22.m2.1.1.1.cmml">â¢</mo><mi id="alg1.22.22.m2.1.1.9" xref="alg1.22.22.m2.1.1.9.cmml">e</mi><mo id="alg1.22.22.m2.1.1.1g" xref="alg1.22.22.m2.1.1.1.cmml">â¢</mo><mi id="alg1.22.22.m2.1.1.10" xref="alg1.22.22.m2.1.1.10.cmml">s</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.22.22.m2.1b"><apply id="alg1.22.22.m2.1.1.cmml" xref="alg1.22.22.m2.1.1"><times id="alg1.22.22.m2.1.1.1.cmml" xref="alg1.22.22.m2.1.1.1"></times><ci id="alg1.22.22.m2.1.1.2.cmml" xref="alg1.22.22.m2.1.1.2">ğ‘‘</ci><ci id="alg1.22.22.m2.1.1.3.cmml" xref="alg1.22.22.m2.1.1.3">ğ‘–</ci><ci id="alg1.22.22.m2.1.1.4.cmml" xref="alg1.22.22.m2.1.1.4">ğ‘ </ci><ci id="alg1.22.22.m2.1.1.5.cmml" xref="alg1.22.22.m2.1.1.5">ğ‘¡</ci><ci id="alg1.22.22.m2.1.1.6.cmml" xref="alg1.22.22.m2.1.1.6">ğ‘</ci><ci id="alg1.22.22.m2.1.1.7.cmml" xref="alg1.22.22.m2.1.1.7">ğ‘›</ci><ci id="alg1.22.22.m2.1.1.8.cmml" xref="alg1.22.22.m2.1.1.8">ğ‘</ci><ci id="alg1.22.22.m2.1.1.9.cmml" xref="alg1.22.22.m2.1.1.9">ğ‘’</ci><ci id="alg1.22.22.m2.1.1.10.cmml" xref="alg1.22.22.m2.1.1.10">ğ‘ </ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.22.22.m2.1c">distances</annotation><annotation encoding="application/x-llamapun" id="alg1.22.22.m2.1d">italic_d italic_i italic_s italic_t italic_a italic_n italic_c italic_e italic_s</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.29.37">
<span class="ltx_tag ltx_tag_listingline">17</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 

</div>
<div class="ltx_listingline" id="alg1.29.38">
<span class="ltx_tag ltx_tag_listingline">18</span> end for
</div>
<div class="ltx_listingline" id="alg1.23.23">
<span class="ltx_tag ltx_tag_listingline">19</span>ranked <math alttext="Indices\leftarrow\mathrm{argsort\_descending}(distances)" class="ltx_Math" display="inline" id="alg1.23.23.m1.1"><semantics id="alg1.23.23.m1.1a"><mrow id="alg1.23.23.m1.1.1" xref="alg1.23.23.m1.1.1.cmml"><mrow id="alg1.23.23.m1.1.1.3" xref="alg1.23.23.m1.1.1.3.cmml"><mi id="alg1.23.23.m1.1.1.3.2" xref="alg1.23.23.m1.1.1.3.2.cmml">I</mi><mo id="alg1.23.23.m1.1.1.3.1" xref="alg1.23.23.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.3.3" xref="alg1.23.23.m1.1.1.3.3.cmml">n</mi><mo id="alg1.23.23.m1.1.1.3.1a" xref="alg1.23.23.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.3.4" xref="alg1.23.23.m1.1.1.3.4.cmml">d</mi><mo id="alg1.23.23.m1.1.1.3.1b" xref="alg1.23.23.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.3.5" xref="alg1.23.23.m1.1.1.3.5.cmml">i</mi><mo id="alg1.23.23.m1.1.1.3.1c" xref="alg1.23.23.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.3.6" xref="alg1.23.23.m1.1.1.3.6.cmml">c</mi><mo id="alg1.23.23.m1.1.1.3.1d" xref="alg1.23.23.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.3.7" xref="alg1.23.23.m1.1.1.3.7.cmml">e</mi><mo id="alg1.23.23.m1.1.1.3.1e" xref="alg1.23.23.m1.1.1.3.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.3.8" xref="alg1.23.23.m1.1.1.3.8.cmml">s</mi></mrow><mo id="alg1.23.23.m1.1.1.2" stretchy="false" xref="alg1.23.23.m1.1.1.2.cmml">â†</mo><mrow id="alg1.23.23.m1.1.1.1" xref="alg1.23.23.m1.1.1.1.cmml"><mi id="alg1.23.23.m1.1.1.1.3" xref="alg1.23.23.m1.1.1.1.3.cmml">argsort</mi><mo id="alg1.23.23.m1.1.1.1.2" xref="alg1.23.23.m1.1.1.1.2.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.1.4" mathvariant="normal" xref="alg1.23.23.m1.1.1.1.4.cmml">_</mi><mo id="alg1.23.23.m1.1.1.1.2a" xref="alg1.23.23.m1.1.1.1.2.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.1.5" xref="alg1.23.23.m1.1.1.1.5.cmml">descending</mi><mo id="alg1.23.23.m1.1.1.1.2b" xref="alg1.23.23.m1.1.1.1.2.cmml">â¢</mo><mrow id="alg1.23.23.m1.1.1.1.1.1" xref="alg1.23.23.m1.1.1.1.1.1.1.cmml"><mo id="alg1.23.23.m1.1.1.1.1.1.2" stretchy="false" xref="alg1.23.23.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="alg1.23.23.m1.1.1.1.1.1.1" xref="alg1.23.23.m1.1.1.1.1.1.1.cmml"><mi id="alg1.23.23.m1.1.1.1.1.1.1.2" xref="alg1.23.23.m1.1.1.1.1.1.1.2.cmml">d</mi><mo id="alg1.23.23.m1.1.1.1.1.1.1.1" xref="alg1.23.23.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.1.1.1.1.3" xref="alg1.23.23.m1.1.1.1.1.1.1.3.cmml">i</mi><mo id="alg1.23.23.m1.1.1.1.1.1.1.1a" xref="alg1.23.23.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.1.1.1.1.4" xref="alg1.23.23.m1.1.1.1.1.1.1.4.cmml">s</mi><mo id="alg1.23.23.m1.1.1.1.1.1.1.1b" xref="alg1.23.23.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.1.1.1.1.5" xref="alg1.23.23.m1.1.1.1.1.1.1.5.cmml">t</mi><mo id="alg1.23.23.m1.1.1.1.1.1.1.1c" xref="alg1.23.23.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.1.1.1.1.6" xref="alg1.23.23.m1.1.1.1.1.1.1.6.cmml">a</mi><mo id="alg1.23.23.m1.1.1.1.1.1.1.1d" xref="alg1.23.23.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.1.1.1.1.7" xref="alg1.23.23.m1.1.1.1.1.1.1.7.cmml">n</mi><mo id="alg1.23.23.m1.1.1.1.1.1.1.1e" xref="alg1.23.23.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.1.1.1.1.8" xref="alg1.23.23.m1.1.1.1.1.1.1.8.cmml">c</mi><mo id="alg1.23.23.m1.1.1.1.1.1.1.1f" xref="alg1.23.23.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.1.1.1.1.9" xref="alg1.23.23.m1.1.1.1.1.1.1.9.cmml">e</mi><mo id="alg1.23.23.m1.1.1.1.1.1.1.1g" xref="alg1.23.23.m1.1.1.1.1.1.1.1.cmml">â¢</mo><mi id="alg1.23.23.m1.1.1.1.1.1.1.10" xref="alg1.23.23.m1.1.1.1.1.1.1.10.cmml">s</mi></mrow><mo id="alg1.23.23.m1.1.1.1.1.1.3" stretchy="false" xref="alg1.23.23.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.23.23.m1.1b"><apply id="alg1.23.23.m1.1.1.cmml" xref="alg1.23.23.m1.1.1"><ci id="alg1.23.23.m1.1.1.2.cmml" xref="alg1.23.23.m1.1.1.2">â†</ci><apply id="alg1.23.23.m1.1.1.3.cmml" xref="alg1.23.23.m1.1.1.3"><times id="alg1.23.23.m1.1.1.3.1.cmml" xref="alg1.23.23.m1.1.1.3.1"></times><ci id="alg1.23.23.m1.1.1.3.2.cmml" xref="alg1.23.23.m1.1.1.3.2">ğ¼</ci><ci id="alg1.23.23.m1.1.1.3.3.cmml" xref="alg1.23.23.m1.1.1.3.3">ğ‘›</ci><ci id="alg1.23.23.m1.1.1.3.4.cmml" xref="alg1.23.23.m1.1.1.3.4">ğ‘‘</ci><ci id="alg1.23.23.m1.1.1.3.5.cmml" xref="alg1.23.23.m1.1.1.3.5">ğ‘–</ci><ci id="alg1.23.23.m1.1.1.3.6.cmml" xref="alg1.23.23.m1.1.1.3.6">ğ‘</ci><ci id="alg1.23.23.m1.1.1.3.7.cmml" xref="alg1.23.23.m1.1.1.3.7">ğ‘’</ci><ci id="alg1.23.23.m1.1.1.3.8.cmml" xref="alg1.23.23.m1.1.1.3.8">ğ‘ </ci></apply><apply id="alg1.23.23.m1.1.1.1.cmml" xref="alg1.23.23.m1.1.1.1"><times id="alg1.23.23.m1.1.1.1.2.cmml" xref="alg1.23.23.m1.1.1.1.2"></times><ci id="alg1.23.23.m1.1.1.1.3.cmml" xref="alg1.23.23.m1.1.1.1.3">argsort</ci><ci id="alg1.23.23.m1.1.1.1.4.cmml" xref="alg1.23.23.m1.1.1.1.4">_</ci><ci id="alg1.23.23.m1.1.1.1.5.cmml" xref="alg1.23.23.m1.1.1.1.5">descending</ci><apply id="alg1.23.23.m1.1.1.1.1.1.1.cmml" xref="alg1.23.23.m1.1.1.1.1.1"><times id="alg1.23.23.m1.1.1.1.1.1.1.1.cmml" xref="alg1.23.23.m1.1.1.1.1.1.1.1"></times><ci id="alg1.23.23.m1.1.1.1.1.1.1.2.cmml" xref="alg1.23.23.m1.1.1.1.1.1.1.2">ğ‘‘</ci><ci id="alg1.23.23.m1.1.1.1.1.1.1.3.cmml" xref="alg1.23.23.m1.1.1.1.1.1.1.3">ğ‘–</ci><ci id="alg1.23.23.m1.1.1.1.1.1.1.4.cmml" xref="alg1.23.23.m1.1.1.1.1.1.1.4">ğ‘ </ci><ci id="alg1.23.23.m1.1.1.1.1.1.1.5.cmml" xref="alg1.23.23.m1.1.1.1.1.1.1.5">ğ‘¡</ci><ci id="alg1.23.23.m1.1.1.1.1.1.1.6.cmml" xref="alg1.23.23.m1.1.1.1.1.1.1.6">ğ‘</ci><ci id="alg1.23.23.m1.1.1.1.1.1.1.7.cmml" xref="alg1.23.23.m1.1.1.1.1.1.1.7">ğ‘›</ci><ci id="alg1.23.23.m1.1.1.1.1.1.1.8.cmml" xref="alg1.23.23.m1.1.1.1.1.1.1.8">ğ‘</ci><ci id="alg1.23.23.m1.1.1.1.1.1.1.9.cmml" xref="alg1.23.23.m1.1.1.1.1.1.1.9">ğ‘’</ci><ci id="alg1.23.23.m1.1.1.1.1.1.1.10.cmml" xref="alg1.23.23.m1.1.1.1.1.1.1.10">ğ‘ </ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.23.23.m1.1c">Indices\leftarrow\mathrm{argsort\_descending}(distances)</annotation><annotation encoding="application/x-llamapun" id="alg1.23.23.m1.1d">italic_I italic_n italic_d italic_i italic_c italic_e italic_s â† roman_argsort _ roman_descending ( italic_d italic_i italic_s italic_t italic_a italic_n italic_c italic_e italic_s )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.25.25">
<span class="ltx_tag ltx_tag_listingline">20</span>
ranked <math alttext="Words\leftarrow" class="ltx_Math" display="inline" id="alg1.24.24.m1.1"><semantics id="alg1.24.24.m1.1a"><mrow id="alg1.24.24.m1.1.1" xref="alg1.24.24.m1.1.1.cmml"><mrow id="alg1.24.24.m1.1.1.2" xref="alg1.24.24.m1.1.1.2.cmml"><mi id="alg1.24.24.m1.1.1.2.2" xref="alg1.24.24.m1.1.1.2.2.cmml">W</mi><mo id="alg1.24.24.m1.1.1.2.1" xref="alg1.24.24.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.24.24.m1.1.1.2.3" xref="alg1.24.24.m1.1.1.2.3.cmml">o</mi><mo id="alg1.24.24.m1.1.1.2.1a" xref="alg1.24.24.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.24.24.m1.1.1.2.4" xref="alg1.24.24.m1.1.1.2.4.cmml">r</mi><mo id="alg1.24.24.m1.1.1.2.1b" xref="alg1.24.24.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.24.24.m1.1.1.2.5" xref="alg1.24.24.m1.1.1.2.5.cmml">d</mi><mo id="alg1.24.24.m1.1.1.2.1c" xref="alg1.24.24.m1.1.1.2.1.cmml">â¢</mo><mi id="alg1.24.24.m1.1.1.2.6" xref="alg1.24.24.m1.1.1.2.6.cmml">s</mi></mrow><mo id="alg1.24.24.m1.1.1.1" stretchy="false" xref="alg1.24.24.m1.1.1.1.cmml">â†</mo><mi id="alg1.24.24.m1.1.1.3" xref="alg1.24.24.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.24.24.m1.1b"><apply id="alg1.24.24.m1.1.1.cmml" xref="alg1.24.24.m1.1.1"><ci id="alg1.24.24.m1.1.1.1.cmml" xref="alg1.24.24.m1.1.1.1">â†</ci><apply id="alg1.24.24.m1.1.1.2.cmml" xref="alg1.24.24.m1.1.1.2"><times id="alg1.24.24.m1.1.1.2.1.cmml" xref="alg1.24.24.m1.1.1.2.1"></times><ci id="alg1.24.24.m1.1.1.2.2.cmml" xref="alg1.24.24.m1.1.1.2.2">ğ‘Š</ci><ci id="alg1.24.24.m1.1.1.2.3.cmml" xref="alg1.24.24.m1.1.1.2.3">ğ‘œ</ci><ci id="alg1.24.24.m1.1.1.2.4.cmml" xref="alg1.24.24.m1.1.1.2.4">ğ‘Ÿ</ci><ci id="alg1.24.24.m1.1.1.2.5.cmml" xref="alg1.24.24.m1.1.1.2.5">ğ‘‘</ci><ci id="alg1.24.24.m1.1.1.2.6.cmml" xref="alg1.24.24.m1.1.1.2.6">ğ‘ </ci></apply><csymbol cd="latexml" id="alg1.24.24.m1.1.1.3.cmml" xref="alg1.24.24.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.24.24.m1.1c">Words\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg1.24.24.m1.1d">italic_W italic_o italic_r italic_d italic_s â†</annotation></semantics></math> list of tokens indexed by ranked <math alttext="Indices" class="ltx_Math" display="inline" id="alg1.25.25.m2.1"><semantics id="alg1.25.25.m2.1a"><mrow id="alg1.25.25.m2.1.1" xref="alg1.25.25.m2.1.1.cmml"><mi id="alg1.25.25.m2.1.1.2" xref="alg1.25.25.m2.1.1.2.cmml">I</mi><mo id="alg1.25.25.m2.1.1.1" xref="alg1.25.25.m2.1.1.1.cmml">â¢</mo><mi id="alg1.25.25.m2.1.1.3" xref="alg1.25.25.m2.1.1.3.cmml">n</mi><mo id="alg1.25.25.m2.1.1.1a" xref="alg1.25.25.m2.1.1.1.cmml">â¢</mo><mi id="alg1.25.25.m2.1.1.4" xref="alg1.25.25.m2.1.1.4.cmml">d</mi><mo id="alg1.25.25.m2.1.1.1b" xref="alg1.25.25.m2.1.1.1.cmml">â¢</mo><mi id="alg1.25.25.m2.1.1.5" xref="alg1.25.25.m2.1.1.5.cmml">i</mi><mo id="alg1.25.25.m2.1.1.1c" xref="alg1.25.25.m2.1.1.1.cmml">â¢</mo><mi id="alg1.25.25.m2.1.1.6" xref="alg1.25.25.m2.1.1.6.cmml">c</mi><mo id="alg1.25.25.m2.1.1.1d" xref="alg1.25.25.m2.1.1.1.cmml">â¢</mo><mi id="alg1.25.25.m2.1.1.7" xref="alg1.25.25.m2.1.1.7.cmml">e</mi><mo id="alg1.25.25.m2.1.1.1e" xref="alg1.25.25.m2.1.1.1.cmml">â¢</mo><mi id="alg1.25.25.m2.1.1.8" xref="alg1.25.25.m2.1.1.8.cmml">s</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.25.25.m2.1b"><apply id="alg1.25.25.m2.1.1.cmml" xref="alg1.25.25.m2.1.1"><times id="alg1.25.25.m2.1.1.1.cmml" xref="alg1.25.25.m2.1.1.1"></times><ci id="alg1.25.25.m2.1.1.2.cmml" xref="alg1.25.25.m2.1.1.2">ğ¼</ci><ci id="alg1.25.25.m2.1.1.3.cmml" xref="alg1.25.25.m2.1.1.3">ğ‘›</ci><ci id="alg1.25.25.m2.1.1.4.cmml" xref="alg1.25.25.m2.1.1.4">ğ‘‘</ci><ci id="alg1.25.25.m2.1.1.5.cmml" xref="alg1.25.25.m2.1.1.5">ğ‘–</ci><ci id="alg1.25.25.m2.1.1.6.cmml" xref="alg1.25.25.m2.1.1.6">ğ‘</ci><ci id="alg1.25.25.m2.1.1.7.cmml" xref="alg1.25.25.m2.1.1.7">ğ‘’</ci><ci id="alg1.25.25.m2.1.1.8.cmml" xref="alg1.25.25.m2.1.1.8">ğ‘ </ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.25.25.m2.1c">Indices</annotation><annotation encoding="application/x-llamapun" id="alg1.25.25.m2.1d">italic_I italic_n italic_d italic_i italic_c italic_e italic_s</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.28.28">
<span class="ltx_tag ltx_tag_listingline">21</span>
<math alttext="p_{0}\leftarrow" class="ltx_Math" display="inline" id="alg1.26.26.m1.1"><semantics id="alg1.26.26.m1.1a"><mrow id="alg1.26.26.m1.1.1" xref="alg1.26.26.m1.1.1.cmml"><msub id="alg1.26.26.m1.1.1.2" xref="alg1.26.26.m1.1.1.2.cmml"><mi id="alg1.26.26.m1.1.1.2.2" xref="alg1.26.26.m1.1.1.2.2.cmml">p</mi><mn id="alg1.26.26.m1.1.1.2.3" xref="alg1.26.26.m1.1.1.2.3.cmml">0</mn></msub><mo id="alg1.26.26.m1.1.1.1" stretchy="false" xref="alg1.26.26.m1.1.1.1.cmml">â†</mo><mi id="alg1.26.26.m1.1.1.3" xref="alg1.26.26.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.26.26.m1.1b"><apply id="alg1.26.26.m1.1.1.cmml" xref="alg1.26.26.m1.1.1"><ci id="alg1.26.26.m1.1.1.1.cmml" xref="alg1.26.26.m1.1.1.1">â†</ci><apply id="alg1.26.26.m1.1.1.2.cmml" xref="alg1.26.26.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.26.26.m1.1.1.2.1.cmml" xref="alg1.26.26.m1.1.1.2">subscript</csymbol><ci id="alg1.26.26.m1.1.1.2.2.cmml" xref="alg1.26.26.m1.1.1.2.2">ğ‘</ci><cn id="alg1.26.26.m1.1.1.2.3.cmml" type="integer" xref="alg1.26.26.m1.1.1.2.3">0</cn></apply><csymbol cd="latexml" id="alg1.26.26.m1.1.1.3.cmml" xref="alg1.26.26.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.26.26.m1.1c">p_{0}\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg1.26.26.m1.1d">italic_p start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT â†</annotation></semantics></math> top <math alttext="\mathcal{N}" class="ltx_Math" display="inline" id="alg1.27.27.m2.1"><semantics id="alg1.27.27.m2.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.27.27.m2.1.1" xref="alg1.27.27.m2.1.1.cmml">ğ’©</mi><annotation-xml encoding="MathML-Content" id="alg1.27.27.m2.1b"><ci id="alg1.27.27.m2.1.1.cmml" xref="alg1.27.27.m2.1.1">ğ’©</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.27.27.m2.1c">\mathcal{N}</annotation><annotation encoding="application/x-llamapun" id="alg1.27.27.m2.1d">caligraphic_N</annotation></semantics></math> tokens from ranked <math alttext="Words" class="ltx_Math" display="inline" id="alg1.28.28.m3.1"><semantics id="alg1.28.28.m3.1a"><mrow id="alg1.28.28.m3.1.1" xref="alg1.28.28.m3.1.1.cmml"><mi id="alg1.28.28.m3.1.1.2" xref="alg1.28.28.m3.1.1.2.cmml">W</mi><mo id="alg1.28.28.m3.1.1.1" xref="alg1.28.28.m3.1.1.1.cmml">â¢</mo><mi id="alg1.28.28.m3.1.1.3" xref="alg1.28.28.m3.1.1.3.cmml">o</mi><mo id="alg1.28.28.m3.1.1.1a" xref="alg1.28.28.m3.1.1.1.cmml">â¢</mo><mi id="alg1.28.28.m3.1.1.4" xref="alg1.28.28.m3.1.1.4.cmml">r</mi><mo id="alg1.28.28.m3.1.1.1b" xref="alg1.28.28.m3.1.1.1.cmml">â¢</mo><mi id="alg1.28.28.m3.1.1.5" xref="alg1.28.28.m3.1.1.5.cmml">d</mi><mo id="alg1.28.28.m3.1.1.1c" xref="alg1.28.28.m3.1.1.1.cmml">â¢</mo><mi id="alg1.28.28.m3.1.1.6" xref="alg1.28.28.m3.1.1.6.cmml">s</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.28.28.m3.1b"><apply id="alg1.28.28.m3.1.1.cmml" xref="alg1.28.28.m3.1.1"><times id="alg1.28.28.m3.1.1.1.cmml" xref="alg1.28.28.m3.1.1.1"></times><ci id="alg1.28.28.m3.1.1.2.cmml" xref="alg1.28.28.m3.1.1.2">ğ‘Š</ci><ci id="alg1.28.28.m3.1.1.3.cmml" xref="alg1.28.28.m3.1.1.3">ğ‘œ</ci><ci id="alg1.28.28.m3.1.1.4.cmml" xref="alg1.28.28.m3.1.1.4">ğ‘Ÿ</ci><ci id="alg1.28.28.m3.1.1.5.cmml" xref="alg1.28.28.m3.1.1.5">ğ‘‘</ci><ci id="alg1.28.28.m3.1.1.6.cmml" xref="alg1.28.28.m3.1.1.6">ğ‘ </ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.28.28.m3.1c">Words</annotation><annotation encoding="application/x-llamapun" id="alg1.28.28.m3.1d">italic_W italic_o italic_r italic_d italic_s</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.29.29">
<span class="ltx_tag ltx_tag_listingline">22</span>
<span class="ltx_text ltx_font_bold" id="alg1.29.29.1">return</span> <math alttext="p_{0}" class="ltx_Math" display="inline" id="alg1.29.29.m1.1"><semantics id="alg1.29.29.m1.1a"><msub id="alg1.29.29.m1.1.1" xref="alg1.29.29.m1.1.1.cmml"><mi id="alg1.29.29.m1.1.1.2" xref="alg1.29.29.m1.1.1.2.cmml">p</mi><mn id="alg1.29.29.m1.1.1.3" xref="alg1.29.29.m1.1.1.3.cmml">0</mn></msub><annotation-xml encoding="MathML-Content" id="alg1.29.29.m1.1b"><apply id="alg1.29.29.m1.1.1.cmml" xref="alg1.29.29.m1.1.1"><csymbol cd="ambiguous" id="alg1.29.29.m1.1.1.1.cmml" xref="alg1.29.29.m1.1.1">subscript</csymbol><ci id="alg1.29.29.m1.1.1.2.cmml" xref="alg1.29.29.m1.1.1.2">ğ‘</ci><cn id="alg1.29.29.m1.1.1.3.cmml" type="integer" xref="alg1.29.29.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.29.29.m1.1c">p_{0}</annotation><annotation encoding="application/x-llamapun" id="alg1.29.29.m1.1d">italic_p start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.29.39">
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.31.1.1">AlgorithmÂ 1</span> </span>Initialize prefix by token importance</figcaption>
</figure>
<figure class="ltx_float ltx_algorithm" id="alg2">
<div class="ltx_listing ltx_lst_numbers_left ltx_listing" id="alg2.32">
<div class="ltx_listingline" id="alg2.32.33">
<span class="ltx_tag ltx_tag_listingline">1</span>
</div>
<div class="ltx_listingline" id="alg2.6.6">
<span class="ltx_text ltx_font_bold" id="alg2.6.6.1">Input :</span>Â Pretrained LLM <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="alg2.1.1.m1.1"><semantics id="alg2.1.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="alg2.1.1.m1.1.1" xref="alg2.1.1.m1.1.1.cmml">â„³</mi><annotation-xml encoding="MathML-Content" id="alg2.1.1.m1.1b"><ci id="alg2.1.1.m1.1.1.cmml" xref="alg2.1.1.m1.1.1">â„³</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.1.1.m1.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="alg2.1.1.m1.1d">caligraphic_M</annotation></semantics></math>, Prefix <math alttext="p_{0}=a_{1:n}" class="ltx_Math" display="inline" id="alg2.2.2.m2.1"><semantics id="alg2.2.2.m2.1a"><mrow id="alg2.2.2.m2.1.1" xref="alg2.2.2.m2.1.1.cmml"><msub id="alg2.2.2.m2.1.1.2" xref="alg2.2.2.m2.1.1.2.cmml"><mi id="alg2.2.2.m2.1.1.2.2" xref="alg2.2.2.m2.1.1.2.2.cmml">p</mi><mn id="alg2.2.2.m2.1.1.2.3" xref="alg2.2.2.m2.1.1.2.3.cmml">0</mn></msub><mo id="alg2.2.2.m2.1.1.1" xref="alg2.2.2.m2.1.1.1.cmml">=</mo><msub id="alg2.2.2.m2.1.1.3" xref="alg2.2.2.m2.1.1.3.cmml"><mi id="alg2.2.2.m2.1.1.3.2" xref="alg2.2.2.m2.1.1.3.2.cmml">a</mi><mrow id="alg2.2.2.m2.1.1.3.3" xref="alg2.2.2.m2.1.1.3.3.cmml"><mn id="alg2.2.2.m2.1.1.3.3.2" xref="alg2.2.2.m2.1.1.3.3.2.cmml">1</mn><mo id="alg2.2.2.m2.1.1.3.3.1" lspace="0.278em" rspace="0.278em" xref="alg2.2.2.m2.1.1.3.3.1.cmml">:</mo><mi id="alg2.2.2.m2.1.1.3.3.3" xref="alg2.2.2.m2.1.1.3.3.3.cmml">n</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg2.2.2.m2.1b"><apply id="alg2.2.2.m2.1.1.cmml" xref="alg2.2.2.m2.1.1"><eq id="alg2.2.2.m2.1.1.1.cmml" xref="alg2.2.2.m2.1.1.1"></eq><apply id="alg2.2.2.m2.1.1.2.cmml" xref="alg2.2.2.m2.1.1.2"><csymbol cd="ambiguous" id="alg2.2.2.m2.1.1.2.1.cmml" xref="alg2.2.2.m2.1.1.2">subscript</csymbol><ci id="alg2.2.2.m2.1.1.2.2.cmml" xref="alg2.2.2.m2.1.1.2.2">ğ‘</ci><cn id="alg2.2.2.m2.1.1.2.3.cmml" type="integer" xref="alg2.2.2.m2.1.1.2.3">0</cn></apply><apply id="alg2.2.2.m2.1.1.3.cmml" xref="alg2.2.2.m2.1.1.3"><csymbol cd="ambiguous" id="alg2.2.2.m2.1.1.3.1.cmml" xref="alg2.2.2.m2.1.1.3">subscript</csymbol><ci id="alg2.2.2.m2.1.1.3.2.cmml" xref="alg2.2.2.m2.1.1.3.2">ğ‘</ci><apply id="alg2.2.2.m2.1.1.3.3.cmml" xref="alg2.2.2.m2.1.1.3.3"><ci id="alg2.2.2.m2.1.1.3.3.1.cmml" xref="alg2.2.2.m2.1.1.3.3.1">:</ci><cn id="alg2.2.2.m2.1.1.3.3.2.cmml" type="integer" xref="alg2.2.2.m2.1.1.3.3.2">1</cn><ci id="alg2.2.2.m2.1.1.3.3.3.cmml" xref="alg2.2.2.m2.1.1.3.3.3">ğ‘›</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.2.2.m2.1c">p_{0}=a_{1:n}</annotation><annotation encoding="application/x-llamapun" id="alg2.2.2.m2.1d">italic_p start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT = italic_a start_POSTSUBSCRIPT 1 : italic_n end_POSTSUBSCRIPT</annotation></semantics></math>, Query <math alttext="u" class="ltx_Math" display="inline" id="alg2.3.3.m3.1"><semantics id="alg2.3.3.m3.1a"><mi id="alg2.3.3.m3.1.1" xref="alg2.3.3.m3.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="alg2.3.3.m3.1b"><ci id="alg2.3.3.m3.1.1.cmml" xref="alg2.3.3.m3.1.1">ğ‘¢</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.3.3.m3.1c">u</annotation><annotation encoding="application/x-llamapun" id="alg2.3.3.m3.1d">italic_u</annotation></semantics></math>, Target passage <math alttext="X_{t}" class="ltx_Math" display="inline" id="alg2.4.4.m4.1"><semantics id="alg2.4.4.m4.1a"><msub id="alg2.4.4.m4.1.1" xref="alg2.4.4.m4.1.1.cmml"><mi id="alg2.4.4.m4.1.1.2" xref="alg2.4.4.m4.1.1.2.cmml">X</mi><mi id="alg2.4.4.m4.1.1.3" xref="alg2.4.4.m4.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="alg2.4.4.m4.1b"><apply id="alg2.4.4.m4.1.1.cmml" xref="alg2.4.4.m4.1.1"><csymbol cd="ambiguous" id="alg2.4.4.m4.1.1.1.cmml" xref="alg2.4.4.m4.1.1">subscript</csymbol><ci id="alg2.4.4.m4.1.1.2.cmml" xref="alg2.4.4.m4.1.1.2">ğ‘‹</ci><ci id="alg2.4.4.m4.1.1.3.cmml" xref="alg2.4.4.m4.1.1.3">ğ‘¡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.4.4.m4.1c">X_{t}</annotation><annotation encoding="application/x-llamapun" id="alg2.4.4.m4.1d">italic_X start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math>, Original passage <math alttext="X_{u}" class="ltx_Math" display="inline" id="alg2.5.5.m5.1"><semantics id="alg2.5.5.m5.1a"><msub id="alg2.5.5.m5.1.1" xref="alg2.5.5.m5.1.1.cmml"><mi id="alg2.5.5.m5.1.1.2" xref="alg2.5.5.m5.1.1.2.cmml">X</mi><mi id="alg2.5.5.m5.1.1.3" xref="alg2.5.5.m5.1.1.3.cmml">u</mi></msub><annotation-xml encoding="MathML-Content" id="alg2.5.5.m5.1b"><apply id="alg2.5.5.m5.1.1.cmml" xref="alg2.5.5.m5.1.1"><csymbol cd="ambiguous" id="alg2.5.5.m5.1.1.1.cmml" xref="alg2.5.5.m5.1.1">subscript</csymbol><ci id="alg2.5.5.m5.1.1.2.cmml" xref="alg2.5.5.m5.1.1.2">ğ‘‹</ci><ci id="alg2.5.5.m5.1.1.3.cmml" xref="alg2.5.5.m5.1.1.3">ğ‘¢</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.5.5.m5.1c">X_{u}</annotation><annotation encoding="application/x-llamapun" id="alg2.5.5.m5.1d">italic_X start_POSTSUBSCRIPT italic_u end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="k" class="ltx_Math" display="inline" id="alg2.6.6.m6.1"><semantics id="alg2.6.6.m6.1a"><mi id="alg2.6.6.m6.1.1" xref="alg2.6.6.m6.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="alg2.6.6.m6.1b"><ci id="alg2.6.6.m6.1.1.cmml" xref="alg2.6.6.m6.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.6.6.m6.1c">k</annotation><annotation encoding="application/x-llamapun" id="alg2.6.6.m6.1d">italic_k</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.7.7">
<span class="ltx_text ltx_font_bold" id="alg2.7.7.1">Output :</span>Â Optimized prefix <math alttext="a^{*}" class="ltx_Math" display="inline" id="alg2.7.7.m1.1"><semantics id="alg2.7.7.m1.1a"><msup id="alg2.7.7.m1.1.1" xref="alg2.7.7.m1.1.1.cmml"><mi id="alg2.7.7.m1.1.1.2" xref="alg2.7.7.m1.1.1.2.cmml">a</mi><mo id="alg2.7.7.m1.1.1.3" xref="alg2.7.7.m1.1.1.3.cmml">âˆ—</mo></msup><annotation-xml encoding="MathML-Content" id="alg2.7.7.m1.1b"><apply id="alg2.7.7.m1.1.1.cmml" xref="alg2.7.7.m1.1.1"><csymbol cd="ambiguous" id="alg2.7.7.m1.1.1.1.cmml" xref="alg2.7.7.m1.1.1">superscript</csymbol><ci id="alg2.7.7.m1.1.1.2.cmml" xref="alg2.7.7.m1.1.1.2">ğ‘</ci><times id="alg2.7.7.m1.1.1.3.cmml" xref="alg2.7.7.m1.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.7.7.m1.1c">a^{*}</annotation><annotation encoding="application/x-llamapun" id="alg2.7.7.m1.1d">italic_a start_POSTSUPERSCRIPT âˆ— end_POSTSUPERSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.32.34">
<span class="ltx_tag ltx_tag_listingline">2</span>
</div>
<div class="ltx_listingline" id="alg2.10.10">
<span class="ltx_tag ltx_tag_listingline">3</span><math alttext="\mathbf{e^{\prime}}\leftarrow" class="ltx_Math" display="inline" id="alg2.8.8.m1.1"><semantics id="alg2.8.8.m1.1a"><mrow id="alg2.8.8.m1.1.1" xref="alg2.8.8.m1.1.1.cmml"><msup id="alg2.8.8.m1.1.1.2" xref="alg2.8.8.m1.1.1.2.cmml"><mi id="alg2.8.8.m1.1.1.2.2" xref="alg2.8.8.m1.1.1.2.2.cmml">ğ</mi><mo id="alg2.8.8.m1.1.1.2.3" xref="alg2.8.8.m1.1.1.2.3.cmml">â€²</mo></msup><mo id="alg2.8.8.m1.1.1.1" stretchy="false" xref="alg2.8.8.m1.1.1.1.cmml">â†</mo><mi id="alg2.8.8.m1.1.1.3" xref="alg2.8.8.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.8.8.m1.1b"><apply id="alg2.8.8.m1.1.1.cmml" xref="alg2.8.8.m1.1.1"><ci id="alg2.8.8.m1.1.1.1.cmml" xref="alg2.8.8.m1.1.1.1">â†</ci><apply id="alg2.8.8.m1.1.1.2.cmml" xref="alg2.8.8.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.8.8.m1.1.1.2.1.cmml" xref="alg2.8.8.m1.1.1.2">superscript</csymbol><ci id="alg2.8.8.m1.1.1.2.2.cmml" xref="alg2.8.8.m1.1.1.2.2">ğ</ci><ci id="alg2.8.8.m1.1.1.2.3.cmml" xref="alg2.8.8.m1.1.1.2.3">â€²</ci></apply><csymbol cd="latexml" id="alg2.8.8.m1.1.1.3.cmml" xref="alg2.8.8.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.8.8.m1.1c">\mathbf{e^{\prime}}\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg2.8.8.m1.1d">bold_e start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT â†</annotation></semantics></math><math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="alg2.9.9.m2.1"><semantics id="alg2.9.9.m2.1a"><mi class="ltx_font_mathcaligraphic" id="alg2.9.9.m2.1.1" xref="alg2.9.9.m2.1.1.cmml">â„³</mi><annotation-xml encoding="MathML-Content" id="alg2.9.9.m2.1b"><ci id="alg2.9.9.m2.1.1.cmml" xref="alg2.9.9.m2.1.1">â„³</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.9.9.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="alg2.9.9.m2.1d">caligraphic_M</annotation></semantics></math><span class="ltx_text ltx_font_typewriter" id="alg2.10.10.1">(<em class="ltx_emph ltx_font_serif ltx_font_italic" id="alg2.10.10.1.1"><math alttext="X_{t}" class="ltx_Math" display="inline" id="alg2.10.10.1.1.m1.1"><semantics id="alg2.10.10.1.1.m1.1a"><msub id="alg2.10.10.1.1.m1.1.1" xref="alg2.10.10.1.1.m1.1.1.cmml"><mi id="alg2.10.10.1.1.m1.1.1.2" xref="alg2.10.10.1.1.m1.1.1.2.cmml">X</mi><mi id="alg2.10.10.1.1.m1.1.1.3" xref="alg2.10.10.1.1.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="alg2.10.10.1.1.m1.1b"><apply id="alg2.10.10.1.1.m1.1.1.cmml" xref="alg2.10.10.1.1.m1.1.1"><csymbol cd="ambiguous" id="alg2.10.10.1.1.m1.1.1.1.cmml" xref="alg2.10.10.1.1.m1.1.1">subscript</csymbol><ci id="alg2.10.10.1.1.m1.1.1.2.cmml" xref="alg2.10.10.1.1.m1.1.1.2">ğ‘‹</ci><ci id="alg2.10.10.1.1.m1.1.1.3.cmml" xref="alg2.10.10.1.1.m1.1.1.3">ğ‘¡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.10.10.1.1.m1.1c">X_{t}</annotation><annotation encoding="application/x-llamapun" id="alg2.10.10.1.1.m1.1d">italic_X start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math></em>)</span>
</div>
<div class="ltx_listingline" id="alg2.13.13">
<span class="ltx_tag ltx_tag_listingline">4</span>
<math alttext="\mathbf{e}\leftarrow" class="ltx_Math" display="inline" id="alg2.11.11.m1.1"><semantics id="alg2.11.11.m1.1a"><mrow id="alg2.11.11.m1.1.1" xref="alg2.11.11.m1.1.1.cmml"><mi id="alg2.11.11.m1.1.1.2" xref="alg2.11.11.m1.1.1.2.cmml">ğ</mi><mo id="alg2.11.11.m1.1.1.1" stretchy="false" xref="alg2.11.11.m1.1.1.1.cmml">â†</mo><mi id="alg2.11.11.m1.1.1.3" xref="alg2.11.11.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.11.11.m1.1b"><apply id="alg2.11.11.m1.1.1.cmml" xref="alg2.11.11.m1.1.1"><ci id="alg2.11.11.m1.1.1.1.cmml" xref="alg2.11.11.m1.1.1.1">â†</ci><ci id="alg2.11.11.m1.1.1.2.cmml" xref="alg2.11.11.m1.1.1.2">ğ</ci><csymbol cd="latexml" id="alg2.11.11.m1.1.1.3.cmml" xref="alg2.11.11.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.11.11.m1.1c">\mathbf{e}\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg2.11.11.m1.1d">bold_e â†</annotation></semantics></math><math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="alg2.12.12.m2.1"><semantics id="alg2.12.12.m2.1a"><mi class="ltx_font_mathcaligraphic" id="alg2.12.12.m2.1.1" xref="alg2.12.12.m2.1.1.cmml">â„³</mi><annotation-xml encoding="MathML-Content" id="alg2.12.12.m2.1b"><ci id="alg2.12.12.m2.1.1.cmml" xref="alg2.12.12.m2.1.1">â„³</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.12.12.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="alg2.12.12.m2.1d">caligraphic_M</annotation></semantics></math><span class="ltx_text ltx_font_typewriter" id="alg2.13.13.1">(<em class="ltx_emph ltx_font_serif ltx_font_italic" id="alg2.13.13.1.1"><math alttext="X_{u}" class="ltx_Math" display="inline" id="alg2.13.13.1.1.m1.1"><semantics id="alg2.13.13.1.1.m1.1a"><msub id="alg2.13.13.1.1.m1.1.1" xref="alg2.13.13.1.1.m1.1.1.cmml"><mi id="alg2.13.13.1.1.m1.1.1.2" xref="alg2.13.13.1.1.m1.1.1.2.cmml">X</mi><mi id="alg2.13.13.1.1.m1.1.1.3" xref="alg2.13.13.1.1.m1.1.1.3.cmml">u</mi></msub><annotation-xml encoding="MathML-Content" id="alg2.13.13.1.1.m1.1b"><apply id="alg2.13.13.1.1.m1.1.1.cmml" xref="alg2.13.13.1.1.m1.1.1"><csymbol cd="ambiguous" id="alg2.13.13.1.1.m1.1.1.1.cmml" xref="alg2.13.13.1.1.m1.1.1">subscript</csymbol><ci id="alg2.13.13.1.1.m1.1.1.2.cmml" xref="alg2.13.13.1.1.m1.1.1.2">ğ‘‹</ci><ci id="alg2.13.13.1.1.m1.1.1.3.cmml" xref="alg2.13.13.1.1.m1.1.1.3">ğ‘¢</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.13.13.1.1.m1.1c">X_{u}</annotation><annotation encoding="application/x-llamapun" id="alg2.13.13.1.1.m1.1d">italic_X start_POSTSUBSCRIPT italic_u end_POSTSUBSCRIPT</annotation></semantics></math></em>)</span>
</div>
<div class="ltx_listingline" id="alg2.32.35">
<span class="ltx_tag ltx_tag_listingline">5</span>
<span class="ltx_text ltx_font_bold" id="alg2.32.35.1">for</span>Â <em class="ltx_emph ltx_font_italic" id="alg2.32.35.2">each epoch in iterations</em>Â <span class="ltx_text ltx_font_bold" id="alg2.32.35.3">do</span>
</div>
<div class="ltx_listingline" id="alg2.16.16">
<span class="ltx_tag ltx_tag_listingline">6</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<math alttext="\mathbf{e_{u}}\leftarrow" class="ltx_Math" display="inline" id="alg2.14.14.m1.1"><semantics id="alg2.14.14.m1.1a"><mrow id="alg2.14.14.m1.1.1" xref="alg2.14.14.m1.1.1.cmml"><msub id="alg2.14.14.m1.1.1.2" xref="alg2.14.14.m1.1.1.2.cmml"><mi id="alg2.14.14.m1.1.1.2.2" xref="alg2.14.14.m1.1.1.2.2.cmml">ğ</mi><mi id="alg2.14.14.m1.1.1.2.3" xref="alg2.14.14.m1.1.1.2.3.cmml">ğ®</mi></msub><mo id="alg2.14.14.m1.1.1.1" stretchy="false" xref="alg2.14.14.m1.1.1.1.cmml">â†</mo><mi id="alg2.14.14.m1.1.1.3" xref="alg2.14.14.m1.1.1.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.14.14.m1.1b"><apply id="alg2.14.14.m1.1.1.cmml" xref="alg2.14.14.m1.1.1"><ci id="alg2.14.14.m1.1.1.1.cmml" xref="alg2.14.14.m1.1.1.1">â†</ci><apply id="alg2.14.14.m1.1.1.2.cmml" xref="alg2.14.14.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.14.14.m1.1.1.2.1.cmml" xref="alg2.14.14.m1.1.1.2">subscript</csymbol><ci id="alg2.14.14.m1.1.1.2.2.cmml" xref="alg2.14.14.m1.1.1.2.2">ğ</ci><ci id="alg2.14.14.m1.1.1.2.3.cmml" xref="alg2.14.14.m1.1.1.2.3">ğ®</ci></apply><csymbol cd="latexml" id="alg2.14.14.m1.1.1.3.cmml" xref="alg2.14.14.m1.1.1.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.14.14.m1.1c">\mathbf{e_{u}}\leftarrow</annotation><annotation encoding="application/x-llamapun" id="alg2.14.14.m1.1d">bold_e start_POSTSUBSCRIPT bold_u end_POSTSUBSCRIPT â†</annotation></semantics></math><math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="alg2.15.15.m2.1"><semantics id="alg2.15.15.m2.1a"><mi class="ltx_font_mathcaligraphic" id="alg2.15.15.m2.1.1" xref="alg2.15.15.m2.1.1.cmml">â„³</mi><annotation-xml encoding="MathML-Content" id="alg2.15.15.m2.1b"><ci id="alg2.15.15.m2.1.1.cmml" xref="alg2.15.15.m2.1.1">â„³</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.15.15.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="alg2.15.15.m2.1d">caligraphic_M</annotation></semantics></math><span class="ltx_text ltx_font_typewriter" id="alg2.16.16.1">(<em class="ltx_emph ltx_font_serif ltx_font_italic" id="alg2.16.16.1.1"><math alttext="a_{1:n}||u" class="ltx_math_unparsed" display="inline" id="alg2.16.16.1.1.m1.1"><semantics id="alg2.16.16.1.1.m1.1a"><mrow id="alg2.16.16.1.1.m1.1b"><msub id="alg2.16.16.1.1.m1.1.1"><mi id="alg2.16.16.1.1.m1.1.1.2">a</mi><mrow id="alg2.16.16.1.1.m1.1.1.3"><mn id="alg2.16.16.1.1.m1.1.1.3.2">1</mn><mo id="alg2.16.16.1.1.m1.1.1.3.1" lspace="0.278em" rspace="0.278em">:</mo><mi id="alg2.16.16.1.1.m1.1.1.3.3">n</mi></mrow></msub><mo fence="false" id="alg2.16.16.1.1.m1.1.2" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="alg2.16.16.1.1.m1.1.3" rspace="0.167em" stretchy="false">|</mo><mi id="alg2.16.16.1.1.m1.1.4">u</mi></mrow><annotation encoding="application/x-tex" id="alg2.16.16.1.1.m1.1c">a_{1:n}||u</annotation><annotation encoding="application/x-llamapun" id="alg2.16.16.1.1.m1.1d">italic_a start_POSTSUBSCRIPT 1 : italic_n end_POSTSUBSCRIPT | | italic_u</annotation></semantics></math></em>)</span>
</div>
<div class="ltx_listingline" id="alg2.17.17">
<span class="ltx_tag ltx_tag_listingline">7</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
Calculate <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="alg2.17.17.m1.1"><semantics id="alg2.17.17.m1.1a"><mi class="ltx_font_mathcaligraphic" id="alg2.17.17.m1.1.1" xref="alg2.17.17.m1.1.1.cmml">â„’</mi><annotation-xml encoding="MathML-Content" id="alg2.17.17.m1.1b"><ci id="alg2.17.17.m1.1.1.cmml" xref="alg2.17.17.m1.1.1">â„’</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.17.17.m1.1c">\mathcal{L}</annotation><annotation encoding="application/x-llamapun" id="alg2.17.17.m1.1d">caligraphic_L</annotation></semantics></math> based on EquationÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.E4" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">4</span></a> or <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.E5" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">5</span></a>
</div>
<div class="ltx_listingline" id="alg2.18.18">Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<span class="ltx_text ltx_font_typewriter" id="alg2.18.18.2">//</span><span class="ltx_text ltx_font_typewriter" id="alg2.18.18.1" style="font-size:90%;">Compute top-<math alttext="k" class="ltx_Math" display="inline" id="alg2.18.18.1.m1.1"><semantics id="alg2.18.18.1.m1.1a"><mi id="alg2.18.18.1.m1.1.1" xref="alg2.18.18.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="alg2.18.18.1.m1.1b"><ci id="alg2.18.18.1.m1.1.1.cmml" xref="alg2.18.18.1.m1.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.18.18.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="alg2.18.18.1.m1.1d">italic_k</annotation></semantics></math> promising token substitutions </span>
</div>
<div class="ltx_listingline" id="alg2.20.20">
<span class="ltx_tag ltx_tag_listingline">8</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<math alttext="a^{\prime}_{i}\leftarrow\text{top-}" class="ltx_Math" display="inline" id="alg2.19.19.m1.1"><semantics id="alg2.19.19.m1.1a"><mrow id="alg2.19.19.m1.1.1" xref="alg2.19.19.m1.1.1.cmml"><msubsup id="alg2.19.19.m1.1.1.2" xref="alg2.19.19.m1.1.1.2.cmml"><mi id="alg2.19.19.m1.1.1.2.2.2" xref="alg2.19.19.m1.1.1.2.2.2.cmml">a</mi><mi id="alg2.19.19.m1.1.1.2.3" xref="alg2.19.19.m1.1.1.2.3.cmml">i</mi><mo id="alg2.19.19.m1.1.1.2.2.3" xref="alg2.19.19.m1.1.1.2.2.3.cmml">â€²</mo></msubsup><mo id="alg2.19.19.m1.1.1.1" stretchy="false" xref="alg2.19.19.m1.1.1.1.cmml">â†</mo><mtext id="alg2.19.19.m1.1.1.3" xref="alg2.19.19.m1.1.1.3a.cmml">top-</mtext></mrow><annotation-xml encoding="MathML-Content" id="alg2.19.19.m1.1b"><apply id="alg2.19.19.m1.1.1.cmml" xref="alg2.19.19.m1.1.1"><ci id="alg2.19.19.m1.1.1.1.cmml" xref="alg2.19.19.m1.1.1.1">â†</ci><apply id="alg2.19.19.m1.1.1.2.cmml" xref="alg2.19.19.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.19.19.m1.1.1.2.1.cmml" xref="alg2.19.19.m1.1.1.2">subscript</csymbol><apply id="alg2.19.19.m1.1.1.2.2.cmml" xref="alg2.19.19.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.19.19.m1.1.1.2.2.1.cmml" xref="alg2.19.19.m1.1.1.2">superscript</csymbol><ci id="alg2.19.19.m1.1.1.2.2.2.cmml" xref="alg2.19.19.m1.1.1.2.2.2">ğ‘</ci><ci id="alg2.19.19.m1.1.1.2.2.3.cmml" xref="alg2.19.19.m1.1.1.2.2.3">â€²</ci></apply><ci id="alg2.19.19.m1.1.1.2.3.cmml" xref="alg2.19.19.m1.1.1.2.3">ğ‘–</ci></apply><ci id="alg2.19.19.m1.1.1.3a.cmml" xref="alg2.19.19.m1.1.1.3"><mtext id="alg2.19.19.m1.1.1.3.cmml" xref="alg2.19.19.m1.1.1.3">top-</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.19.19.m1.1c">a^{\prime}_{i}\leftarrow\text{top-}</annotation><annotation encoding="application/x-llamapun" id="alg2.19.19.m1.1d">italic_a start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT â† top-</annotation></semantics></math>k<math alttext="(-\nabla_{a_{i}}\mathcal{L})" class="ltx_Math" display="inline" id="alg2.20.20.m2.1"><semantics id="alg2.20.20.m2.1a"><mrow id="alg2.20.20.m2.1.1.1" xref="alg2.20.20.m2.1.1.1.1.cmml"><mo id="alg2.20.20.m2.1.1.1.2" stretchy="false" xref="alg2.20.20.m2.1.1.1.1.cmml">(</mo><mrow id="alg2.20.20.m2.1.1.1.1" xref="alg2.20.20.m2.1.1.1.1.cmml"><mo id="alg2.20.20.m2.1.1.1.1a" rspace="0.167em" xref="alg2.20.20.m2.1.1.1.1.cmml">âˆ’</mo><mrow id="alg2.20.20.m2.1.1.1.1.2" xref="alg2.20.20.m2.1.1.1.1.2.cmml"><msub id="alg2.20.20.m2.1.1.1.1.2.1" xref="alg2.20.20.m2.1.1.1.1.2.1.cmml"><mo id="alg2.20.20.m2.1.1.1.1.2.1.2" rspace="0.167em" xref="alg2.20.20.m2.1.1.1.1.2.1.2.cmml">âˆ‡</mo><msub id="alg2.20.20.m2.1.1.1.1.2.1.3" xref="alg2.20.20.m2.1.1.1.1.2.1.3.cmml"><mi id="alg2.20.20.m2.1.1.1.1.2.1.3.2" xref="alg2.20.20.m2.1.1.1.1.2.1.3.2.cmml">a</mi><mi id="alg2.20.20.m2.1.1.1.1.2.1.3.3" xref="alg2.20.20.m2.1.1.1.1.2.1.3.3.cmml">i</mi></msub></msub><mi class="ltx_font_mathcaligraphic" id="alg2.20.20.m2.1.1.1.1.2.2" xref="alg2.20.20.m2.1.1.1.1.2.2.cmml">â„’</mi></mrow></mrow><mo id="alg2.20.20.m2.1.1.1.3" stretchy="false" xref="alg2.20.20.m2.1.1.1.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="alg2.20.20.m2.1b"><apply id="alg2.20.20.m2.1.1.1.1.cmml" xref="alg2.20.20.m2.1.1.1"><minus id="alg2.20.20.m2.1.1.1.1.1.cmml" xref="alg2.20.20.m2.1.1.1"></minus><apply id="alg2.20.20.m2.1.1.1.1.2.cmml" xref="alg2.20.20.m2.1.1.1.1.2"><apply id="alg2.20.20.m2.1.1.1.1.2.1.cmml" xref="alg2.20.20.m2.1.1.1.1.2.1"><csymbol cd="ambiguous" id="alg2.20.20.m2.1.1.1.1.2.1.1.cmml" xref="alg2.20.20.m2.1.1.1.1.2.1">subscript</csymbol><ci id="alg2.20.20.m2.1.1.1.1.2.1.2.cmml" xref="alg2.20.20.m2.1.1.1.1.2.1.2">âˆ‡</ci><apply id="alg2.20.20.m2.1.1.1.1.2.1.3.cmml" xref="alg2.20.20.m2.1.1.1.1.2.1.3"><csymbol cd="ambiguous" id="alg2.20.20.m2.1.1.1.1.2.1.3.1.cmml" xref="alg2.20.20.m2.1.1.1.1.2.1.3">subscript</csymbol><ci id="alg2.20.20.m2.1.1.1.1.2.1.3.2.cmml" xref="alg2.20.20.m2.1.1.1.1.2.1.3.2">ğ‘</ci><ci id="alg2.20.20.m2.1.1.1.1.2.1.3.3.cmml" xref="alg2.20.20.m2.1.1.1.1.2.1.3.3">ğ‘–</ci></apply></apply><ci id="alg2.20.20.m2.1.1.1.1.2.2.cmml" xref="alg2.20.20.m2.1.1.1.1.2.2">â„’</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.20.20.m2.1c">(-\nabla_{a_{i}}\mathcal{L})</annotation><annotation encoding="application/x-llamapun" id="alg2.20.20.m2.1d">( - âˆ‡ start_POSTSUBSCRIPT italic_a start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT caligraphic_L )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.21.21">
<span class="ltx_tag ltx_tag_listingline">9</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â <span class="ltx_text ltx_font_bold" id="alg2.21.21.2">forall</span>Â <em class="ltx_emph ltx_font_italic" id="alg2.21.21.1">subset <math alttext="s\subseteq\{1,...,n\}" class="ltx_Math" display="inline" id="alg2.21.21.1.m1.3"><semantics id="alg2.21.21.1.m1.3a"><mrow id="alg2.21.21.1.m1.3.4" xref="alg2.21.21.1.m1.3.4.cmml"><mi id="alg2.21.21.1.m1.3.4.2" xref="alg2.21.21.1.m1.3.4.2.cmml">s</mi><mo id="alg2.21.21.1.m1.3.4.1" xref="alg2.21.21.1.m1.3.4.1.cmml">âŠ†</mo><mrow id="alg2.21.21.1.m1.3.4.3.2" xref="alg2.21.21.1.m1.3.4.3.1.cmml"><mo id="alg2.21.21.1.m1.3.4.3.2.1" stretchy="false" xref="alg2.21.21.1.m1.3.4.3.1.cmml">{</mo><mn id="alg2.21.21.1.m1.1.1" xref="alg2.21.21.1.m1.1.1.cmml">1</mn><mo id="alg2.21.21.1.m1.3.4.3.2.2" xref="alg2.21.21.1.m1.3.4.3.1.cmml">,</mo><mi id="alg2.21.21.1.m1.2.2" mathvariant="normal" xref="alg2.21.21.1.m1.2.2.cmml">â€¦</mi><mo id="alg2.21.21.1.m1.3.4.3.2.3" xref="alg2.21.21.1.m1.3.4.3.1.cmml">,</mo><mi id="alg2.21.21.1.m1.3.3" xref="alg2.21.21.1.m1.3.3.cmml">n</mi><mo id="alg2.21.21.1.m1.3.4.3.2.4" stretchy="false" xref="alg2.21.21.1.m1.3.4.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.21.21.1.m1.3b"><apply id="alg2.21.21.1.m1.3.4.cmml" xref="alg2.21.21.1.m1.3.4"><subset id="alg2.21.21.1.m1.3.4.1.cmml" xref="alg2.21.21.1.m1.3.4.1"></subset><ci id="alg2.21.21.1.m1.3.4.2.cmml" xref="alg2.21.21.1.m1.3.4.2">ğ‘ </ci><set id="alg2.21.21.1.m1.3.4.3.1.cmml" xref="alg2.21.21.1.m1.3.4.3.2"><cn id="alg2.21.21.1.m1.1.1.cmml" type="integer" xref="alg2.21.21.1.m1.1.1">1</cn><ci id="alg2.21.21.1.m1.2.2.cmml" xref="alg2.21.21.1.m1.2.2">â€¦</ci><ci id="alg2.21.21.1.m1.3.3.cmml" xref="alg2.21.21.1.m1.3.3">ğ‘›</ci></set></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.21.21.1.m1.3c">s\subseteq\{1,...,n\}</annotation><annotation encoding="application/x-llamapun" id="alg2.21.21.1.m1.3d">italic_s âŠ† { 1 , â€¦ , italic_n }</annotation></semantics></math></em>Â <span class="ltx_text ltx_font_bold" id="alg2.21.21.3">do</span>
</div>
<div class="ltx_listingline" id="alg2.22.22">
<span class="ltx_tag ltx_tag_listingline">10</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<span class="ltx_text ltx_font_bold" id="alg2.22.22.2">for</span>Â <em class="ltx_emph ltx_font_italic" id="alg2.22.22.1"><math alttext="s_{i}\in s" class="ltx_Math" display="inline" id="alg2.22.22.1.m1.1"><semantics id="alg2.22.22.1.m1.1a"><mrow id="alg2.22.22.1.m1.1.1" xref="alg2.22.22.1.m1.1.1.cmml"><msub id="alg2.22.22.1.m1.1.1.2" xref="alg2.22.22.1.m1.1.1.2.cmml"><mi id="alg2.22.22.1.m1.1.1.2.2" xref="alg2.22.22.1.m1.1.1.2.2.cmml">s</mi><mi id="alg2.22.22.1.m1.1.1.2.3" xref="alg2.22.22.1.m1.1.1.2.3.cmml">i</mi></msub><mo id="alg2.22.22.1.m1.1.1.1" xref="alg2.22.22.1.m1.1.1.1.cmml">âˆˆ</mo><mi id="alg2.22.22.1.m1.1.1.3" xref="alg2.22.22.1.m1.1.1.3.cmml">s</mi></mrow><annotation-xml encoding="MathML-Content" id="alg2.22.22.1.m1.1b"><apply id="alg2.22.22.1.m1.1.1.cmml" xref="alg2.22.22.1.m1.1.1"><in id="alg2.22.22.1.m1.1.1.1.cmml" xref="alg2.22.22.1.m1.1.1.1"></in><apply id="alg2.22.22.1.m1.1.1.2.cmml" xref="alg2.22.22.1.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.22.22.1.m1.1.1.2.1.cmml" xref="alg2.22.22.1.m1.1.1.2">subscript</csymbol><ci id="alg2.22.22.1.m1.1.1.2.2.cmml" xref="alg2.22.22.1.m1.1.1.2.2">ğ‘ </ci><ci id="alg2.22.22.1.m1.1.1.2.3.cmml" xref="alg2.22.22.1.m1.1.1.2.3">ğ‘–</ci></apply><ci id="alg2.22.22.1.m1.1.1.3.cmml" xref="alg2.22.22.1.m1.1.1.3">ğ‘ </ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.22.22.1.m1.1c">s_{i}\in s</annotation><annotation encoding="application/x-llamapun" id="alg2.22.22.1.m1.1d">italic_s start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT âˆˆ italic_s</annotation></semantics></math></em>Â <span class="ltx_text ltx_font_bold" id="alg2.22.22.3">do</span>
</div>
<div class="ltx_listingline" id="alg2.24.24">Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<span class="ltx_text ltx_font_typewriter" id="alg2.24.24.3">//</span><span class="ltx_text ltx_font_typewriter" id="alg2.24.24.2" style="font-size:90%;">Replace the prefix tokens at position <math alttext="s_{i}" class="ltx_Math" display="inline" id="alg2.23.23.1.m1.1"><semantics id="alg2.23.23.1.m1.1a"><msub id="alg2.23.23.1.m1.1.1" xref="alg2.23.23.1.m1.1.1.cmml"><mi id="alg2.23.23.1.m1.1.1.2" xref="alg2.23.23.1.m1.1.1.2.cmml">s</mi><mi id="alg2.23.23.1.m1.1.1.3" xref="alg2.23.23.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="alg2.23.23.1.m1.1b"><apply id="alg2.23.23.1.m1.1.1.cmml" xref="alg2.23.23.1.m1.1.1"><csymbol cd="ambiguous" id="alg2.23.23.1.m1.1.1.1.cmml" xref="alg2.23.23.1.m1.1.1">subscript</csymbol><ci id="alg2.23.23.1.m1.1.1.2.cmml" xref="alg2.23.23.1.m1.1.1.2">ğ‘ </ci><ci id="alg2.23.23.1.m1.1.1.3.cmml" xref="alg2.23.23.1.m1.1.1.3">ğ‘–</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.23.23.1.m1.1c">s_{i}</annotation><annotation encoding="application/x-llamapun" id="alg2.23.23.1.m1.1d">italic_s start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> to one from a random position in <math alttext="a^{\prime}" class="ltx_Math" display="inline" id="alg2.24.24.2.m2.1"><semantics id="alg2.24.24.2.m2.1a"><msup id="alg2.24.24.2.m2.1.1" xref="alg2.24.24.2.m2.1.1.cmml"><mi id="alg2.24.24.2.m2.1.1.2" xref="alg2.24.24.2.m2.1.1.2.cmml">a</mi><mo id="alg2.24.24.2.m2.1.1.3" xref="alg2.24.24.2.m2.1.1.3.cmml">â€²</mo></msup><annotation-xml encoding="MathML-Content" id="alg2.24.24.2.m2.1b"><apply id="alg2.24.24.2.m2.1.1.cmml" xref="alg2.24.24.2.m2.1.1"><csymbol cd="ambiguous" id="alg2.24.24.2.m2.1.1.1.cmml" xref="alg2.24.24.2.m2.1.1">superscript</csymbol><ci id="alg2.24.24.2.m2.1.1.2.cmml" xref="alg2.24.24.2.m2.1.1.2">ğ‘</ci><ci id="alg2.24.24.2.m2.1.1.3.cmml" xref="alg2.24.24.2.m2.1.1.3">â€²</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.24.24.2.m2.1c">a^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg2.24.24.2.m2.1d">italic_a start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT</annotation></semantics></math> </span>
</div>
<div class="ltx_listingline" id="alg2.25.25">
<span class="ltx_tag ltx_tag_listingline">11</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<math alttext="a_{s_{i}}\leftarrow\pi_{\text{rand}(n)}{(a^{\prime}_{i})}" class="ltx_Math" display="inline" id="alg2.25.25.m1.2"><semantics id="alg2.25.25.m1.2a"><mrow id="alg2.25.25.m1.2.2" xref="alg2.25.25.m1.2.2.cmml"><msub id="alg2.25.25.m1.2.2.3" xref="alg2.25.25.m1.2.2.3.cmml"><mi id="alg2.25.25.m1.2.2.3.2" xref="alg2.25.25.m1.2.2.3.2.cmml">a</mi><msub id="alg2.25.25.m1.2.2.3.3" xref="alg2.25.25.m1.2.2.3.3.cmml"><mi id="alg2.25.25.m1.2.2.3.3.2" xref="alg2.25.25.m1.2.2.3.3.2.cmml">s</mi><mi id="alg2.25.25.m1.2.2.3.3.3" xref="alg2.25.25.m1.2.2.3.3.3.cmml">i</mi></msub></msub><mo id="alg2.25.25.m1.2.2.2" stretchy="false" xref="alg2.25.25.m1.2.2.2.cmml">â†</mo><mrow id="alg2.25.25.m1.2.2.1" xref="alg2.25.25.m1.2.2.1.cmml"><msub id="alg2.25.25.m1.2.2.1.3" xref="alg2.25.25.m1.2.2.1.3.cmml"><mi id="alg2.25.25.m1.2.2.1.3.2" xref="alg2.25.25.m1.2.2.1.3.2.cmml">Ï€</mi><mrow id="alg2.25.25.m1.1.1.1" xref="alg2.25.25.m1.1.1.1.cmml"><mtext id="alg2.25.25.m1.1.1.1.3" xref="alg2.25.25.m1.1.1.1.3a.cmml">rand</mtext><mo id="alg2.25.25.m1.1.1.1.2" xref="alg2.25.25.m1.1.1.1.2.cmml">â¢</mo><mrow id="alg2.25.25.m1.1.1.1.4.2" xref="alg2.25.25.m1.1.1.1.cmml"><mo id="alg2.25.25.m1.1.1.1.4.2.1" stretchy="false" xref="alg2.25.25.m1.1.1.1.cmml">(</mo><mi id="alg2.25.25.m1.1.1.1.1" xref="alg2.25.25.m1.1.1.1.1.cmml">n</mi><mo id="alg2.25.25.m1.1.1.1.4.2.2" stretchy="false" xref="alg2.25.25.m1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo id="alg2.25.25.m1.2.2.1.2" xref="alg2.25.25.m1.2.2.1.2.cmml">â¢</mo><mrow id="alg2.25.25.m1.2.2.1.1.1" xref="alg2.25.25.m1.2.2.1.1.1.1.cmml"><mo id="alg2.25.25.m1.2.2.1.1.1.2" stretchy="false" xref="alg2.25.25.m1.2.2.1.1.1.1.cmml">(</mo><msubsup id="alg2.25.25.m1.2.2.1.1.1.1" xref="alg2.25.25.m1.2.2.1.1.1.1.cmml"><mi id="alg2.25.25.m1.2.2.1.1.1.1.2.2" xref="alg2.25.25.m1.2.2.1.1.1.1.2.2.cmml">a</mi><mi id="alg2.25.25.m1.2.2.1.1.1.1.3" xref="alg2.25.25.m1.2.2.1.1.1.1.3.cmml">i</mi><mo id="alg2.25.25.m1.2.2.1.1.1.1.2.3" xref="alg2.25.25.m1.2.2.1.1.1.1.2.3.cmml">â€²</mo></msubsup><mo id="alg2.25.25.m1.2.2.1.1.1.3" stretchy="false" xref="alg2.25.25.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.25.25.m1.2b"><apply id="alg2.25.25.m1.2.2.cmml" xref="alg2.25.25.m1.2.2"><ci id="alg2.25.25.m1.2.2.2.cmml" xref="alg2.25.25.m1.2.2.2">â†</ci><apply id="alg2.25.25.m1.2.2.3.cmml" xref="alg2.25.25.m1.2.2.3"><csymbol cd="ambiguous" id="alg2.25.25.m1.2.2.3.1.cmml" xref="alg2.25.25.m1.2.2.3">subscript</csymbol><ci id="alg2.25.25.m1.2.2.3.2.cmml" xref="alg2.25.25.m1.2.2.3.2">ğ‘</ci><apply id="alg2.25.25.m1.2.2.3.3.cmml" xref="alg2.25.25.m1.2.2.3.3"><csymbol cd="ambiguous" id="alg2.25.25.m1.2.2.3.3.1.cmml" xref="alg2.25.25.m1.2.2.3.3">subscript</csymbol><ci id="alg2.25.25.m1.2.2.3.3.2.cmml" xref="alg2.25.25.m1.2.2.3.3.2">ğ‘ </ci><ci id="alg2.25.25.m1.2.2.3.3.3.cmml" xref="alg2.25.25.m1.2.2.3.3.3">ğ‘–</ci></apply></apply><apply id="alg2.25.25.m1.2.2.1.cmml" xref="alg2.25.25.m1.2.2.1"><times id="alg2.25.25.m1.2.2.1.2.cmml" xref="alg2.25.25.m1.2.2.1.2"></times><apply id="alg2.25.25.m1.2.2.1.3.cmml" xref="alg2.25.25.m1.2.2.1.3"><csymbol cd="ambiguous" id="alg2.25.25.m1.2.2.1.3.1.cmml" xref="alg2.25.25.m1.2.2.1.3">subscript</csymbol><ci id="alg2.25.25.m1.2.2.1.3.2.cmml" xref="alg2.25.25.m1.2.2.1.3.2">ğœ‹</ci><apply id="alg2.25.25.m1.1.1.1.cmml" xref="alg2.25.25.m1.1.1.1"><times id="alg2.25.25.m1.1.1.1.2.cmml" xref="alg2.25.25.m1.1.1.1.2"></times><ci id="alg2.25.25.m1.1.1.1.3a.cmml" xref="alg2.25.25.m1.1.1.1.3"><mtext id="alg2.25.25.m1.1.1.1.3.cmml" mathsize="70%" xref="alg2.25.25.m1.1.1.1.3">rand</mtext></ci><ci id="alg2.25.25.m1.1.1.1.1.cmml" xref="alg2.25.25.m1.1.1.1.1">ğ‘›</ci></apply></apply><apply id="alg2.25.25.m1.2.2.1.1.1.1.cmml" xref="alg2.25.25.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="alg2.25.25.m1.2.2.1.1.1.1.1.cmml" xref="alg2.25.25.m1.2.2.1.1.1">subscript</csymbol><apply id="alg2.25.25.m1.2.2.1.1.1.1.2.cmml" xref="alg2.25.25.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="alg2.25.25.m1.2.2.1.1.1.1.2.1.cmml" xref="alg2.25.25.m1.2.2.1.1.1">superscript</csymbol><ci id="alg2.25.25.m1.2.2.1.1.1.1.2.2.cmml" xref="alg2.25.25.m1.2.2.1.1.1.1.2.2">ğ‘</ci><ci id="alg2.25.25.m1.2.2.1.1.1.1.2.3.cmml" xref="alg2.25.25.m1.2.2.1.1.1.1.2.3">â€²</ci></apply><ci id="alg2.25.25.m1.2.2.1.1.1.1.3.cmml" xref="alg2.25.25.m1.2.2.1.1.1.1.3">ğ‘–</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.25.25.m1.2c">a_{s_{i}}\leftarrow\pi_{\text{rand}(n)}{(a^{\prime}_{i})}</annotation><annotation encoding="application/x-llamapun" id="alg2.25.25.m1.2d">italic_a start_POSTSUBSCRIPT italic_s start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT â† italic_Ï€ start_POSTSUBSCRIPT rand ( italic_n ) end_POSTSUBSCRIPT ( italic_a start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.32.36">
<span class="ltx_tag ltx_tag_listingline">12</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â  end for
</div>
<div class="ltx_listingline" id="alg2.32.37">Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â <span class="ltx_text ltx_font_typewriter" id="alg2.32.37.1">//</span><span class="ltx_text ltx_font_typewriter" id="alg2.32.37.2" style="font-size:90%;">Update the best loss and best prefix if the current loss is lower </span>
</div>
<div class="ltx_listingline" id="alg2.27.27">
<span class="ltx_tag ltx_tag_listingline">13</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<span class="ltx_text ltx_font_bold" id="alg2.27.27.3">if</span>Â <em class="ltx_emph ltx_font_italic" id="alg2.27.27.2"><math alttext="\mathcal{L}(a_{s_{i}}||u)" class="ltx_math_unparsed" display="inline" id="alg2.26.26.1.m1.1"><semantics id="alg2.26.26.1.m1.1a"><mrow id="alg2.26.26.1.m1.1b"><mi class="ltx_font_mathcaligraphic" id="alg2.26.26.1.m1.1.1">â„’</mi><mrow id="alg2.26.26.1.m1.1.2"><mo id="alg2.26.26.1.m1.1.2.1" stretchy="false">(</mo><msub id="alg2.26.26.1.m1.1.2.2"><mi id="alg2.26.26.1.m1.1.2.2.2">a</mi><msub id="alg2.26.26.1.m1.1.2.2.3"><mi id="alg2.26.26.1.m1.1.2.2.3.2">s</mi><mi id="alg2.26.26.1.m1.1.2.2.3.3">i</mi></msub></msub><mo fence="false" id="alg2.26.26.1.m1.1.2.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="alg2.26.26.1.m1.1.2.4" rspace="0.167em" stretchy="false">|</mo><mi id="alg2.26.26.1.m1.1.2.5">u</mi><mo id="alg2.26.26.1.m1.1.2.6" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="alg2.26.26.1.m1.1c">\mathcal{L}(a_{s_{i}}||u)</annotation><annotation encoding="application/x-llamapun" id="alg2.26.26.1.m1.1d">caligraphic_L ( italic_a start_POSTSUBSCRIPT italic_s start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT | | italic_u )</annotation></semantics></math> Â¡ <math alttext="\mathcal{L}_{best}" class="ltx_Math" display="inline" id="alg2.27.27.2.m2.1"><semantics id="alg2.27.27.2.m2.1a"><msub id="alg2.27.27.2.m2.1.1" xref="alg2.27.27.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="alg2.27.27.2.m2.1.1.2" xref="alg2.27.27.2.m2.1.1.2.cmml">â„’</mi><mrow id="alg2.27.27.2.m2.1.1.3" xref="alg2.27.27.2.m2.1.1.3.cmml"><mi id="alg2.27.27.2.m2.1.1.3.2" xref="alg2.27.27.2.m2.1.1.3.2.cmml">b</mi><mo id="alg2.27.27.2.m2.1.1.3.1" xref="alg2.27.27.2.m2.1.1.3.1.cmml">â¢</mo><mi id="alg2.27.27.2.m2.1.1.3.3" xref="alg2.27.27.2.m2.1.1.3.3.cmml">e</mi><mo id="alg2.27.27.2.m2.1.1.3.1a" xref="alg2.27.27.2.m2.1.1.3.1.cmml">â¢</mo><mi id="alg2.27.27.2.m2.1.1.3.4" xref="alg2.27.27.2.m2.1.1.3.4.cmml">s</mi><mo id="alg2.27.27.2.m2.1.1.3.1b" xref="alg2.27.27.2.m2.1.1.3.1.cmml">â¢</mo><mi id="alg2.27.27.2.m2.1.1.3.5" xref="alg2.27.27.2.m2.1.1.3.5.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg2.27.27.2.m2.1b"><apply id="alg2.27.27.2.m2.1.1.cmml" xref="alg2.27.27.2.m2.1.1"><csymbol cd="ambiguous" id="alg2.27.27.2.m2.1.1.1.cmml" xref="alg2.27.27.2.m2.1.1">subscript</csymbol><ci id="alg2.27.27.2.m2.1.1.2.cmml" xref="alg2.27.27.2.m2.1.1.2">â„’</ci><apply id="alg2.27.27.2.m2.1.1.3.cmml" xref="alg2.27.27.2.m2.1.1.3"><times id="alg2.27.27.2.m2.1.1.3.1.cmml" xref="alg2.27.27.2.m2.1.1.3.1"></times><ci id="alg2.27.27.2.m2.1.1.3.2.cmml" xref="alg2.27.27.2.m2.1.1.3.2">ğ‘</ci><ci id="alg2.27.27.2.m2.1.1.3.3.cmml" xref="alg2.27.27.2.m2.1.1.3.3">ğ‘’</ci><ci id="alg2.27.27.2.m2.1.1.3.4.cmml" xref="alg2.27.27.2.m2.1.1.3.4">ğ‘ </ci><ci id="alg2.27.27.2.m2.1.1.3.5.cmml" xref="alg2.27.27.2.m2.1.1.3.5">ğ‘¡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.27.27.2.m2.1c">\mathcal{L}_{best}</annotation><annotation encoding="application/x-llamapun" id="alg2.27.27.2.m2.1d">caligraphic_L start_POSTSUBSCRIPT italic_b italic_e italic_s italic_t end_POSTSUBSCRIPT</annotation></semantics></math></em>Â <span class="ltx_text ltx_font_bold" id="alg2.27.27.4">then</span>
</div>
<div class="ltx_listingline" id="alg2.29.29">
<span class="ltx_tag ltx_tag_listingline">14</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<math alttext="a_{1:n}" class="ltx_Math" display="inline" id="alg2.28.28.m1.1"><semantics id="alg2.28.28.m1.1a"><msub id="alg2.28.28.m1.1.1" xref="alg2.28.28.m1.1.1.cmml"><mi id="alg2.28.28.m1.1.1.2" xref="alg2.28.28.m1.1.1.2.cmml">a</mi><mrow id="alg2.28.28.m1.1.1.3" xref="alg2.28.28.m1.1.1.3.cmml"><mn id="alg2.28.28.m1.1.1.3.2" xref="alg2.28.28.m1.1.1.3.2.cmml">1</mn><mo id="alg2.28.28.m1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="alg2.28.28.m1.1.1.3.1.cmml">:</mo><mi id="alg2.28.28.m1.1.1.3.3" xref="alg2.28.28.m1.1.1.3.3.cmml">n</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg2.28.28.m1.1b"><apply id="alg2.28.28.m1.1.1.cmml" xref="alg2.28.28.m1.1.1"><csymbol cd="ambiguous" id="alg2.28.28.m1.1.1.1.cmml" xref="alg2.28.28.m1.1.1">subscript</csymbol><ci id="alg2.28.28.m1.1.1.2.cmml" xref="alg2.28.28.m1.1.1.2">ğ‘</ci><apply id="alg2.28.28.m1.1.1.3.cmml" xref="alg2.28.28.m1.1.1.3"><ci id="alg2.28.28.m1.1.1.3.1.cmml" xref="alg2.28.28.m1.1.1.3.1">:</ci><cn id="alg2.28.28.m1.1.1.3.2.cmml" type="integer" xref="alg2.28.28.m1.1.1.3.2">1</cn><ci id="alg2.28.28.m1.1.1.3.3.cmml" xref="alg2.28.28.m1.1.1.3.3">ğ‘›</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.28.28.m1.1c">a_{1:n}</annotation><annotation encoding="application/x-llamapun" id="alg2.28.28.m1.1d">italic_a start_POSTSUBSCRIPT 1 : italic_n end_POSTSUBSCRIPT</annotation></semantics></math> = <math alttext="a_{s_{i}}" class="ltx_Math" display="inline" id="alg2.29.29.m2.1"><semantics id="alg2.29.29.m2.1a"><msub id="alg2.29.29.m2.1.1" xref="alg2.29.29.m2.1.1.cmml"><mi id="alg2.29.29.m2.1.1.2" xref="alg2.29.29.m2.1.1.2.cmml">a</mi><msub id="alg2.29.29.m2.1.1.3" xref="alg2.29.29.m2.1.1.3.cmml"><mi id="alg2.29.29.m2.1.1.3.2" xref="alg2.29.29.m2.1.1.3.2.cmml">s</mi><mi id="alg2.29.29.m2.1.1.3.3" xref="alg2.29.29.m2.1.1.3.3.cmml">i</mi></msub></msub><annotation-xml encoding="MathML-Content" id="alg2.29.29.m2.1b"><apply id="alg2.29.29.m2.1.1.cmml" xref="alg2.29.29.m2.1.1"><csymbol cd="ambiguous" id="alg2.29.29.m2.1.1.1.cmml" xref="alg2.29.29.m2.1.1">subscript</csymbol><ci id="alg2.29.29.m2.1.1.2.cmml" xref="alg2.29.29.m2.1.1.2">ğ‘</ci><apply id="alg2.29.29.m2.1.1.3.cmml" xref="alg2.29.29.m2.1.1.3"><csymbol cd="ambiguous" id="alg2.29.29.m2.1.1.3.1.cmml" xref="alg2.29.29.m2.1.1.3">subscript</csymbol><ci id="alg2.29.29.m2.1.1.3.2.cmml" xref="alg2.29.29.m2.1.1.3.2">ğ‘ </ci><ci id="alg2.29.29.m2.1.1.3.3.cmml" xref="alg2.29.29.m2.1.1.3.3">ğ‘–</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.29.29.m2.1c">a_{s_{i}}</annotation><annotation encoding="application/x-llamapun" id="alg2.29.29.m2.1d">italic_a start_POSTSUBSCRIPT italic_s start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.31.31">
<span class="ltx_tag ltx_tag_listingline">15</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
<math alttext="\mathcal{L}_{best}" class="ltx_Math" display="inline" id="alg2.30.30.m1.1"><semantics id="alg2.30.30.m1.1a"><msub id="alg2.30.30.m1.1.1" xref="alg2.30.30.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="alg2.30.30.m1.1.1.2" xref="alg2.30.30.m1.1.1.2.cmml">â„’</mi><mrow id="alg2.30.30.m1.1.1.3" xref="alg2.30.30.m1.1.1.3.cmml"><mi id="alg2.30.30.m1.1.1.3.2" xref="alg2.30.30.m1.1.1.3.2.cmml">b</mi><mo id="alg2.30.30.m1.1.1.3.1" xref="alg2.30.30.m1.1.1.3.1.cmml">â¢</mo><mi id="alg2.30.30.m1.1.1.3.3" xref="alg2.30.30.m1.1.1.3.3.cmml">e</mi><mo id="alg2.30.30.m1.1.1.3.1a" xref="alg2.30.30.m1.1.1.3.1.cmml">â¢</mo><mi id="alg2.30.30.m1.1.1.3.4" xref="alg2.30.30.m1.1.1.3.4.cmml">s</mi><mo id="alg2.30.30.m1.1.1.3.1b" xref="alg2.30.30.m1.1.1.3.1.cmml">â¢</mo><mi id="alg2.30.30.m1.1.1.3.5" xref="alg2.30.30.m1.1.1.3.5.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="alg2.30.30.m1.1b"><apply id="alg2.30.30.m1.1.1.cmml" xref="alg2.30.30.m1.1.1"><csymbol cd="ambiguous" id="alg2.30.30.m1.1.1.1.cmml" xref="alg2.30.30.m1.1.1">subscript</csymbol><ci id="alg2.30.30.m1.1.1.2.cmml" xref="alg2.30.30.m1.1.1.2">â„’</ci><apply id="alg2.30.30.m1.1.1.3.cmml" xref="alg2.30.30.m1.1.1.3"><times id="alg2.30.30.m1.1.1.3.1.cmml" xref="alg2.30.30.m1.1.1.3.1"></times><ci id="alg2.30.30.m1.1.1.3.2.cmml" xref="alg2.30.30.m1.1.1.3.2">ğ‘</ci><ci id="alg2.30.30.m1.1.1.3.3.cmml" xref="alg2.30.30.m1.1.1.3.3">ğ‘’</ci><ci id="alg2.30.30.m1.1.1.3.4.cmml" xref="alg2.30.30.m1.1.1.3.4">ğ‘ </ci><ci id="alg2.30.30.m1.1.1.3.5.cmml" xref="alg2.30.30.m1.1.1.3.5">ğ‘¡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.30.30.m1.1c">\mathcal{L}_{best}</annotation><annotation encoding="application/x-llamapun" id="alg2.30.30.m1.1d">caligraphic_L start_POSTSUBSCRIPT italic_b italic_e italic_s italic_t end_POSTSUBSCRIPT</annotation></semantics></math> = <math alttext="\mathcal{L}(a_{s_{i}}||u)" class="ltx_math_unparsed" display="inline" id="alg2.31.31.m2.1"><semantics id="alg2.31.31.m2.1a"><mrow id="alg2.31.31.m2.1b"><mi class="ltx_font_mathcaligraphic" id="alg2.31.31.m2.1.1">â„’</mi><mrow id="alg2.31.31.m2.1.2"><mo id="alg2.31.31.m2.1.2.1" stretchy="false">(</mo><msub id="alg2.31.31.m2.1.2.2"><mi id="alg2.31.31.m2.1.2.2.2">a</mi><msub id="alg2.31.31.m2.1.2.2.3"><mi id="alg2.31.31.m2.1.2.2.3.2">s</mi><mi id="alg2.31.31.m2.1.2.2.3.3">i</mi></msub></msub><mo fence="false" id="alg2.31.31.m2.1.2.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="alg2.31.31.m2.1.2.4" rspace="0.167em" stretchy="false">|</mo><mi id="alg2.31.31.m2.1.2.5">u</mi><mo id="alg2.31.31.m2.1.2.6" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="alg2.31.31.m2.1c">\mathcal{L}(a_{s_{i}}||u)</annotation><annotation encoding="application/x-llamapun" id="alg2.31.31.m2.1d">caligraphic_L ( italic_a start_POSTSUBSCRIPT italic_s start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT | | italic_u )</annotation></semantics></math>;

</div>
<div class="ltx_listingline" id="alg2.32.38">
<span class="ltx_tag ltx_tag_listingline">16</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â  end if
</div>
<div class="ltx_listingline" id="alg2.32.39">
<span class="ltx_tag ltx_tag_listingline">17</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
</div>
<div class="ltx_listingline" id="alg2.32.40">
<span class="ltx_tag ltx_tag_listingline">18</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â  end forall
</div>
<div class="ltx_listingline" id="alg2.32.41">
<span class="ltx_tag ltx_tag_listingline">19</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 
</div>
<div class="ltx_listingline" id="alg2.32.32">
<span class="ltx_tag ltx_tag_listingline">20</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â Return <math alttext="a^{*}=a_{1:n}" class="ltx_Math" display="inline" id="alg2.32.32.m1.1"><semantics id="alg2.32.32.m1.1a"><mrow id="alg2.32.32.m1.1.1" xref="alg2.32.32.m1.1.1.cmml"><msup id="alg2.32.32.m1.1.1.2" xref="alg2.32.32.m1.1.1.2.cmml"><mi id="alg2.32.32.m1.1.1.2.2" xref="alg2.32.32.m1.1.1.2.2.cmml">a</mi><mo id="alg2.32.32.m1.1.1.2.3" xref="alg2.32.32.m1.1.1.2.3.cmml">âˆ—</mo></msup><mo id="alg2.32.32.m1.1.1.1" xref="alg2.32.32.m1.1.1.1.cmml">=</mo><msub id="alg2.32.32.m1.1.1.3" xref="alg2.32.32.m1.1.1.3.cmml"><mi id="alg2.32.32.m1.1.1.3.2" xref="alg2.32.32.m1.1.1.3.2.cmml">a</mi><mrow id="alg2.32.32.m1.1.1.3.3" xref="alg2.32.32.m1.1.1.3.3.cmml"><mn id="alg2.32.32.m1.1.1.3.3.2" xref="alg2.32.32.m1.1.1.3.3.2.cmml">1</mn><mo id="alg2.32.32.m1.1.1.3.3.1" lspace="0.278em" rspace="0.278em" xref="alg2.32.32.m1.1.1.3.3.1.cmml">:</mo><mi id="alg2.32.32.m1.1.1.3.3.3" xref="alg2.32.32.m1.1.1.3.3.3.cmml">n</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="alg2.32.32.m1.1b"><apply id="alg2.32.32.m1.1.1.cmml" xref="alg2.32.32.m1.1.1"><eq id="alg2.32.32.m1.1.1.1.cmml" xref="alg2.32.32.m1.1.1.1"></eq><apply id="alg2.32.32.m1.1.1.2.cmml" xref="alg2.32.32.m1.1.1.2"><csymbol cd="ambiguous" id="alg2.32.32.m1.1.1.2.1.cmml" xref="alg2.32.32.m1.1.1.2">superscript</csymbol><ci id="alg2.32.32.m1.1.1.2.2.cmml" xref="alg2.32.32.m1.1.1.2.2">ğ‘</ci><times id="alg2.32.32.m1.1.1.2.3.cmml" xref="alg2.32.32.m1.1.1.2.3"></times></apply><apply id="alg2.32.32.m1.1.1.3.cmml" xref="alg2.32.32.m1.1.1.3"><csymbol cd="ambiguous" id="alg2.32.32.m1.1.1.3.1.cmml" xref="alg2.32.32.m1.1.1.3">subscript</csymbol><ci id="alg2.32.32.m1.1.1.3.2.cmml" xref="alg2.32.32.m1.1.1.3.2">ğ‘</ci><apply id="alg2.32.32.m1.1.1.3.3.cmml" xref="alg2.32.32.m1.1.1.3.3"><ci id="alg2.32.32.m1.1.1.3.3.1.cmml" xref="alg2.32.32.m1.1.1.3.3.1">:</ci><cn id="alg2.32.32.m1.1.1.3.3.2.cmml" type="integer" xref="alg2.32.32.m1.1.1.3.3.2">1</cn><ci id="alg2.32.32.m1.1.1.3.3.3.cmml" xref="alg2.32.32.m1.1.1.3.3.3">ğ‘›</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.32.32.m1.1c">a^{*}=a_{1:n}</annotation><annotation encoding="application/x-llamapun" id="alg2.32.32.m1.1d">italic_a start_POSTSUPERSCRIPT âˆ— end_POSTSUPERSCRIPT = italic_a start_POSTSUBSCRIPT 1 : italic_n end_POSTSUBSCRIPT</annotation></semantics></math> if Equation <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.E2" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">2</span></a> satisfied
</div>
<div class="ltx_listingline" id="alg2.32.42">
<span class="ltx_tag ltx_tag_listingline">21</span>Â Â <span class="ltx_rule" style="width:1px;height:100%;background:black;display:inline-block;">Â </span>Â Â Â 

</div>
<div class="ltx_listingline" id="alg2.32.43">
<span class="ltx_tag ltx_tag_listingline">22</span> end for
</div>
<div class="ltx_listingline" id="alg2.32.44">
<span class="ltx_tag ltx_tag_listingline">23</span>
</div>
<div class="ltx_listingline" id="alg2.32.45">
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg2.34.1.1">AlgorithmÂ 2</span> </span>Prefix optimization with GGPP</figcaption>
</figure>
<section class="ltx_subsubsection" id="S3.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.2.1. </span>Prefix initialization through token importance</h4>
<div class="ltx_para" id="S3.SS2.SSS1.p1">
<p class="ltx_p" id="S3.SS2.SSS1.p1.1">Directly applying gradient-based attacks such as GCGÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib11" title="">zou2023universal, </a>)</cite> faces challenges of finding the prefix in a huge search space. Most of the time, the search ends up with a prefix that fails to move the embedding of the prompt close to that of the target passage. We address the problem by initially determining the tokens within the target passage that are important to its embedding vector. If a token is important to the coordinates of the passage in the embedding space, including the token in the prefix is likely to bring the embedding of the user query closer. We measure the distance change to the embedding of the original target passage as below:
</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(6)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="d\left(\mathcal{M}(X_{i}),\mathcal{M}\left(\text{[MASK]}\odot X_{i}\right)%
\right)," class="ltx_Math" display="block" id="S3.E6.m1.1"><semantics id="S3.E6.m1.1a"><mrow id="S3.E6.m1.1.1.1" xref="S3.E6.m1.1.1.1.1.cmml"><mrow id="S3.E6.m1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.cmml"><mi id="S3.E6.m1.1.1.1.1.4" xref="S3.E6.m1.1.1.1.1.4.cmml">d</mi><mo id="S3.E6.m1.1.1.1.1.3" xref="S3.E6.m1.1.1.1.1.3.cmml">â¢</mo><mrow id="S3.E6.m1.1.1.1.1.2.2" xref="S3.E6.m1.1.1.1.1.2.3.cmml"><mo id="S3.E6.m1.1.1.1.1.2.2.3" xref="S3.E6.m1.1.1.1.1.2.3.cmml">(</mo><mrow id="S3.E6.m1.1.1.1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E6.m1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.1.1.1.1.1.1.1.3.cmml">â„³</mi><mo id="S3.E6.m1.1.1.1.1.1.1.1.2" xref="S3.E6.m1.1.1.1.1.1.1.1.2.cmml">â¢</mo><mrow id="S3.E6.m1.1.1.1.1.1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E6.m1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S3.E6.m1.1.1.1.1.1.1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E6.m1.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E6.m1.1.1.1.1.2.2.4" xref="S3.E6.m1.1.1.1.1.2.3.cmml">,</mo><mrow id="S3.E6.m1.1.1.1.1.2.2.2" xref="S3.E6.m1.1.1.1.1.2.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E6.m1.1.1.1.1.2.2.2.3" xref="S3.E6.m1.1.1.1.1.2.2.2.3.cmml">â„³</mi><mo id="S3.E6.m1.1.1.1.1.2.2.2.2" xref="S3.E6.m1.1.1.1.1.2.2.2.2.cmml">â¢</mo><mrow id="S3.E6.m1.1.1.1.1.2.2.2.1.1" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.cmml"><mo id="S3.E6.m1.1.1.1.1.2.2.2.1.1.2" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.cmml">(</mo><mrow id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.cmml"><mtext id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.2" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.2a.cmml">[MASK]</mtext><mo id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.1.cmml">âŠ™</mo><msub id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.cmml"><mi id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.2" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.2.cmml">X</mi><mi id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.3" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.3.cmml">i</mi></msub></mrow><mo id="S3.E6.m1.1.1.1.1.2.2.2.1.1.3" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E6.m1.1.1.1.1.2.2.5" xref="S3.E6.m1.1.1.1.1.2.3.cmml">)</mo></mrow></mrow><mo id="S3.E6.m1.1.1.1.2" xref="S3.E6.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E6.m1.1b"><apply id="S3.E6.m1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1"><times id="S3.E6.m1.1.1.1.1.3.cmml" xref="S3.E6.m1.1.1.1.1.3"></times><ci id="S3.E6.m1.1.1.1.1.4.cmml" xref="S3.E6.m1.1.1.1.1.4">ğ‘‘</ci><interval closure="open" id="S3.E6.m1.1.1.1.1.2.3.cmml" xref="S3.E6.m1.1.1.1.1.2.2"><apply id="S3.E6.m1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1"><times id="S3.E6.m1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1.2"></times><ci id="S3.E6.m1.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1.3">â„³</ci><apply id="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.2">ğ‘‹</ci><ci id="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.1.1.1.1.1.1.1.1.1.1.3">ğ‘–</ci></apply></apply><apply id="S3.E6.m1.1.1.1.1.2.2.2.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2"><times id="S3.E6.m1.1.1.1.1.2.2.2.2.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.2"></times><ci id="S3.E6.m1.1.1.1.1.2.2.2.3.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.3">â„³</ci><apply id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1"><csymbol cd="latexml" id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.1">direct-product</csymbol><ci id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.2a.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.2"><mtext id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.2.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.2">[MASK]</mtext></ci><apply id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.1.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3">subscript</csymbol><ci id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.2.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.2">ğ‘‹</ci><ci id="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.3.cmml" xref="S3.E6.m1.1.1.1.1.2.2.2.1.1.1.3.3">ğ‘–</ci></apply></apply></apply></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E6.m1.1c">d\left(\mathcal{M}(X_{i}),\mathcal{M}\left(\text{[MASK]}\odot X_{i}\right)%
\right),</annotation><annotation encoding="application/x-llamapun" id="S3.E6.m1.1d">italic_d ( caligraphic_M ( italic_X start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) , caligraphic_M ( [MASK] âŠ™ italic_X start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.SSS1.p2">
<p class="ltx_p" id="S3.SS2.SSS1.p2.2">and then concatenate these tokens to form the initial adversarial prefix which will be further optimized later on.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(7)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p_{0}=\bigoplus_{i=1}^{n}t_{\text{mask}}" class="ltx_Math" display="block" id="S3.E7.m1.1"><semantics id="S3.E7.m1.1a"><mrow id="S3.E7.m1.1.1" xref="S3.E7.m1.1.1.cmml"><msub id="S3.E7.m1.1.1.2" xref="S3.E7.m1.1.1.2.cmml"><mi id="S3.E7.m1.1.1.2.2" xref="S3.E7.m1.1.1.2.2.cmml">p</mi><mn id="S3.E7.m1.1.1.2.3" xref="S3.E7.m1.1.1.2.3.cmml">0</mn></msub><mo id="S3.E7.m1.1.1.1" rspace="0.111em" xref="S3.E7.m1.1.1.1.cmml">=</mo><mrow id="S3.E7.m1.1.1.3" xref="S3.E7.m1.1.1.3.cmml"><munderover id="S3.E7.m1.1.1.3.1" xref="S3.E7.m1.1.1.3.1.cmml"><mo id="S3.E7.m1.1.1.3.1.2.2" movablelimits="false" xref="S3.E7.m1.1.1.3.1.2.2.cmml">â¨</mo><mrow id="S3.E7.m1.1.1.3.1.2.3" xref="S3.E7.m1.1.1.3.1.2.3.cmml"><mi id="S3.E7.m1.1.1.3.1.2.3.2" xref="S3.E7.m1.1.1.3.1.2.3.2.cmml">i</mi><mo id="S3.E7.m1.1.1.3.1.2.3.1" xref="S3.E7.m1.1.1.3.1.2.3.1.cmml">=</mo><mn id="S3.E7.m1.1.1.3.1.2.3.3" xref="S3.E7.m1.1.1.3.1.2.3.3.cmml">1</mn></mrow><mi id="S3.E7.m1.1.1.3.1.3" xref="S3.E7.m1.1.1.3.1.3.cmml">n</mi></munderover><msub id="S3.E7.m1.1.1.3.2" xref="S3.E7.m1.1.1.3.2.cmml"><mi id="S3.E7.m1.1.1.3.2.2" xref="S3.E7.m1.1.1.3.2.2.cmml">t</mi><mtext id="S3.E7.m1.1.1.3.2.3" xref="S3.E7.m1.1.1.3.2.3a.cmml">mask</mtext></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E7.m1.1b"><apply id="S3.E7.m1.1.1.cmml" xref="S3.E7.m1.1.1"><eq id="S3.E7.m1.1.1.1.cmml" xref="S3.E7.m1.1.1.1"></eq><apply id="S3.E7.m1.1.1.2.cmml" xref="S3.E7.m1.1.1.2"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.2.1.cmml" xref="S3.E7.m1.1.1.2">subscript</csymbol><ci id="S3.E7.m1.1.1.2.2.cmml" xref="S3.E7.m1.1.1.2.2">ğ‘</ci><cn id="S3.E7.m1.1.1.2.3.cmml" type="integer" xref="S3.E7.m1.1.1.2.3">0</cn></apply><apply id="S3.E7.m1.1.1.3.cmml" xref="S3.E7.m1.1.1.3"><apply id="S3.E7.m1.1.1.3.1.cmml" xref="S3.E7.m1.1.1.3.1"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.3.1.1.cmml" xref="S3.E7.m1.1.1.3.1">superscript</csymbol><apply id="S3.E7.m1.1.1.3.1.2.cmml" xref="S3.E7.m1.1.1.3.1"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.3.1.2.1.cmml" xref="S3.E7.m1.1.1.3.1">subscript</csymbol><csymbol cd="latexml" id="S3.E7.m1.1.1.3.1.2.2.cmml" xref="S3.E7.m1.1.1.3.1.2.2">direct-sum</csymbol><apply id="S3.E7.m1.1.1.3.1.2.3.cmml" xref="S3.E7.m1.1.1.3.1.2.3"><eq id="S3.E7.m1.1.1.3.1.2.3.1.cmml" xref="S3.E7.m1.1.1.3.1.2.3.1"></eq><ci id="S3.E7.m1.1.1.3.1.2.3.2.cmml" xref="S3.E7.m1.1.1.3.1.2.3.2">ğ‘–</ci><cn id="S3.E7.m1.1.1.3.1.2.3.3.cmml" type="integer" xref="S3.E7.m1.1.1.3.1.2.3.3">1</cn></apply></apply><ci id="S3.E7.m1.1.1.3.1.3.cmml" xref="S3.E7.m1.1.1.3.1.3">ğ‘›</ci></apply><apply id="S3.E7.m1.1.1.3.2.cmml" xref="S3.E7.m1.1.1.3.2"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.3.2.1.cmml" xref="S3.E7.m1.1.1.3.2">subscript</csymbol><ci id="S3.E7.m1.1.1.3.2.2.cmml" xref="S3.E7.m1.1.1.3.2.2">ğ‘¡</ci><ci id="S3.E7.m1.1.1.3.2.3a.cmml" xref="S3.E7.m1.1.1.3.2.3"><mtext id="S3.E7.m1.1.1.3.2.3.cmml" mathsize="70%" xref="S3.E7.m1.1.1.3.2.3">mask</mtext></ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E7.m1.1c">p_{0}=\bigoplus_{i=1}^{n}t_{\text{mask}}</annotation><annotation encoding="application/x-llamapun" id="S3.E7.m1.1d">italic_p start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT = â¨ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT italic_t start_POSTSUBSCRIPT mask end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.SSS1.p2.1">in which, <math alttext="t_{\text{mask}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p2.1.m1.1"><semantics id="S3.SS2.SSS1.p2.1.m1.1a"><msub id="S3.SS2.SSS1.p2.1.m1.1.1" xref="S3.SS2.SSS1.p2.1.m1.1.1.cmml"><mi id="S3.SS2.SSS1.p2.1.m1.1.1.2" xref="S3.SS2.SSS1.p2.1.m1.1.1.2.cmml">t</mi><mtext id="S3.SS2.SSS1.p2.1.m1.1.1.3" xref="S3.SS2.SSS1.p2.1.m1.1.1.3a.cmml">mask</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p2.1.m1.1b"><apply id="S3.SS2.SSS1.p2.1.m1.1.1.cmml" xref="S3.SS2.SSS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p2.1.m1.1.1.1.cmml" xref="S3.SS2.SSS1.p2.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.SSS1.p2.1.m1.1.1.2.cmml" xref="S3.SS2.SSS1.p2.1.m1.1.1.2">ğ‘¡</ci><ci id="S3.SS2.SSS1.p2.1.m1.1.1.3a.cmml" xref="S3.SS2.SSS1.p2.1.m1.1.1.3"><mtext id="S3.SS2.SSS1.p2.1.m1.1.1.3.cmml" mathsize="70%" xref="S3.SS2.SSS1.p2.1.m1.1.1.3">mask</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p2.1.m1.1c">t_{\text{mask}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p2.1.m1.1d">italic_t start_POSTSUBSCRIPT mask end_POSTSUBSCRIPT</annotation></semantics></math> denotes the tokens ranked most important.</p>
</div>
<div class="ltx_para" id="S3.SS2.SSS1.p3">
<p class="ltx_p" id="S3.SS2.SSS1.p3.1">The process for initializing prefix by token importance is illustrated in AlgorithmÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#alg1" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">1</span></a>. It serves as the basis of GGPP. By ranking tokens based on their importance to the embedding vector of the passage in the embedding space, we increase the probability a prefix is found in a smaller search space.</p>
</div>
<div class="ltx_para" id="S3.SS2.SSS1.p4">
<p class="ltx_p" id="S3.SS2.SSS1.p4.1">In Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#alg1" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">1</span></a>, we first compute the embedding of the target passage using the LLM model. Each token in the passage is then masked to compute a changed embedding of the passage. Sorting the distances of masked passages to the unmasked one in the embedding space, we obtain a list of tokens based on their importance to the coordinate change. Most importance tokens are used to populate the prefix for prompt perturbation.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S3.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.2.2. </span>Prefix optimization with GGPP</h4>
<div class="ltx_para" id="S3.SS2.SSS2.p1">
<p class="ltx_p" id="S3.SS2.SSS2.p1.1">The prefix optimization algorithm, as shown in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#alg2" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">2</span></a> further optimizes the initial prefix to alter the ranking of passages in RAG-based LLMs.
The key steps can be summarised in the following steps:</p>
</div>
<div class="ltx_para" id="S3.SS2.SSS2.p2">
<ol class="ltx_enumerate" id="S3.I3">
<li class="ltx_item" id="S3.I3.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(1)</span>
<div class="ltx_para" id="S3.I3.i1.p1">
<p class="ltx_p" id="S3.I3.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S3.I3.i1.p1.1.1">Initialization:</span> Provide a targeted passage and compute its embedding; concatenate the initialized short prefix with a user provided query.</p>
</div>
</li>
<li class="ltx_item" id="S3.I3.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(2)</span>
<div class="ltx_para" id="S3.I3.i2.p1">
<p class="ltx_p" id="S3.I3.i2.p1.1"><span class="ltx_text ltx_font_bold" id="S3.I3.i2.p1.1.1">Gradient-based coordinate search:</span> For each dimension of the query embedding:</p>
<ol class="ltx_enumerate" id="S3.I3.i2.I1">
<li class="ltx_item" id="S3.I3.i2.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(a)</span>
<div class="ltx_para" id="S3.I3.i2.I1.i1.p1">
<p class="ltx_p" id="S3.I3.i2.I1.i1.p1.1">Calculate the gradient of the retriever (<math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S3.I3.i2.I1.i1.p1.1.m1.1"><semantics id="S3.I3.i2.I1.i1.p1.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S3.I3.i2.I1.i1.p1.1.m1.1.1" xref="S3.I3.i2.I1.i1.p1.1.m1.1.1.cmml">â„³</mi><annotation-xml encoding="MathML-Content" id="S3.I3.i2.I1.i1.p1.1.m1.1b"><ci id="S3.I3.i2.I1.i1.p1.1.m1.1.1.cmml" xref="S3.I3.i2.I1.i1.p1.1.m1.1.1">â„³</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I3.i2.I1.i1.p1.1.m1.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S3.I3.i2.I1.i1.p1.1.m1.1d">caligraphic_M</annotation></semantics></math>) with respect to that dimension.</p>
</div>
</li>
<li class="ltx_item" id="S3.I3.i2.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(b)</span>
<div class="ltx_para" id="S3.I3.i2.I1.i2.p1">
<p class="ltx_p" id="S3.I3.i2.I1.i2.p1.1">Adjust the promptâ€™s embedding coordinate in the direction that increases the similarity with the targetâ€™s coordinate, following a greedy selection process.</p>
</div>
</li>
</ol>
</div>
</li>
<li class="ltx_item" id="S3.I3.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(3)</span>
<div class="ltx_para" id="S3.I3.i3.p1">
<p class="ltx_p" id="S3.I3.i3.p1.1"><span class="ltx_text ltx_font_bold" id="S3.I3.i3.p1.1.1">Evaluation and Iteration:</span> After each adjustment, compute the loss and evaluate the effect on the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.I3.i3.p1.1.m1.1"><semantics id="S3.I3.i3.p1.1.m1.1a"><mi id="S3.I3.i3.p1.1.m1.1.1" xref="S3.I3.i3.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.I3.i3.p1.1.m1.1b"><ci id="S3.I3.i3.p1.1.m1.1.1.cmml" xref="S3.I3.i3.p1.1.m1.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I3.i3.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.I3.i3.p1.1.m1.1d">italic_k</annotation></semantics></math> retrieval results.</p>
<ol class="ltx_enumerate" id="S3.I3.i3.I1">
<li class="ltx_item" id="S3.I3.i3.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(a)</span>
<div class="ltx_para" id="S3.I3.i3.I1.i1.p1">
<p class="ltx_p" id="S3.I3.i3.I1.i1.p1.1">If the adjustment brings the query embedding closer to the target-specific point, retain the change.</p>
</div>
</li>
<li class="ltx_item" id="S3.I3.i3.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(b)</span>
<div class="ltx_para" id="S3.I3.i3.I1.i2.p1">
<p class="ltx_p" id="S3.I3.i3.I1.i2.p1.1">If not, revert the adjustment.</p>
</div>
</li>
</ol>
</div>
</li>
<li class="ltx_item" id="S3.I3.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">(4)</span>
<div class="ltx_para" id="S3.I3.i4.p1">
<p class="ltx_p" id="S3.I3.i4.p1.2"><span class="ltx_text ltx_font_bold" id="S3.I3.i4.p1.2.1">Convergence Criteria:</span> We define the convergence criteria as when the original result is no longer among the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.I3.i4.p1.1.m1.1"><semantics id="S3.I3.i4.p1.1.m1.1a"><mi id="S3.I3.i4.p1.1.m1.1.1" xref="S3.I3.i4.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.I3.i4.p1.1.m1.1b"><ci id="S3.I3.i4.p1.1.m1.1.1.cmml" xref="S3.I3.i4.p1.1.m1.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I3.i4.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.I3.i4.p1.1.m1.1d">italic_k</annotation></semantics></math> results and the target is in the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.I3.i4.p1.2.m2.1"><semantics id="S3.I3.i4.p1.2.m2.1a"><mi id="S3.I3.i4.p1.2.m2.1.1" xref="S3.I3.i4.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.I3.i4.p1.2.m2.1b"><ci id="S3.I3.i4.p1.2.m2.1.1.cmml" xref="S3.I3.i4.p1.2.m2.1.1">ğ‘˜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I3.i4.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.I3.i4.p1.2.m2.1d">italic_k</annotation></semantics></math> result. Repeat the process until the convergence criteria are met.</p>
</div>
</li>
</ol>
</div>
<div class="ltx_para" id="S3.SS2.SSS2.p3">
<p class="ltx_p" id="S3.SS2.SSS2.p3.1">The algorithm selects tokens from the modelâ€™s vocabulary that move the perturbed query to the direction of the target the furthest and replace the corresponding tokens in prefix with these tokens.</p>
</div>
<div class="ltx_para" id="S3.SS2.SSS2.p4">
<p class="ltx_p" id="S3.SS2.SSS2.p4.1">With prefix initialization, GGPP can automate the prefix searching to perturb the text generation of RAG-based LLMs. GGPP does not assume that the whole data repository storing text passages for retrieval is known. It only needs to know the target passage and the original passage to exploit the vulnerability in RAG, which makes the attack practical.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3. </span>GGPP for prompts with instructions</h3>
<div class="ltx_para" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.1">We also investigate if instructions in a prompt can eliminate the impact of a prefix generated by GGPP. We find that while GGPP suffers success rate drop when prompts contain instructions, e.g.,Â <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib36" title="">shi2023large, </a>)</cite>, which instruct LLMs to ignore and bypass irrelevant information, it can be easily adapted to deal with such instructions by including the instruction in the training. See AppendixÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS6" title="A.6. GGPP for prompts with instructions â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">A.6</span></a> for details.</p>
</div>
<figure class="ltx_figure" id="S3.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="289" id="S3.F3.g1" src="x3.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3. </span> Casual trace of GPT-J â€“ attentions only: left â€“ w/o GGPP; right â€“ w/ GGPP.</figcaption>
</figure>
<figure class="ltx_figure" id="S3.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="289" id="S3.F4.g1" src="x4.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4. </span> Casual trace of GPT-J â€“ MLP states only: left â€“ w/o GGPP; right â€“ w/ GGPP.</figcaption>
</figure>
<figure class="ltx_figure" id="S3.F5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="289" id="S3.F5.g1" src="x5.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 5. </span> Casual trace of GPT-J â€“ all hidden states: left â€“ w/o GGPP; right â€“ w/ GGPP.</figcaption>
</figure>
<figure class="ltx_figure" id="S3.F6"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="358" id="S3.F6.g1" src="x6.png" width="614"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 6. </span>ACT Probe for detecting the GGPP prefix on transformers.</figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4. </span>Detection of adversarial prefixes</h2>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1. </span>Impact of prefix on neuron activation</h3>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1">In this section, we investigate the relationship between prefix and neuron activation to understand how factual errors occurs in RAG. Early workÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib24" title="">meng2022locating, </a>)</cite> uses causal intervention to show that neuron activations correlate to a modelâ€™s factual predictions. We further study how GGPP generated prefixes affect neuron activations of an LLM using causal tracesÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib24" title="">meng2022locating, </a>)</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS1.p2">
<p class="ltx_p" id="S4.SS1.p2.4">Casual trace runs the model multiple times. It deliberately corrupts the model states and then restores individual states to see what information has been recovered by the states. We track attention activations, MLP activations and each hidden states on GPT-J-6B for the user query with and without GGPP prefixes. The result is shown in FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.F3" title="Figure 3 â€£ 3.3. GGPP for prompts with instructions â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">3</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.F4" title="Figure 4 â€£ 3.3. GGPP for prompts with instructions â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">4</span></a>, and <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.F5" title="Figure 5 â€£ 3.3. GGPP for prompts with instructions â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">5</span></a>. In the user query, the constraints are nobel winnersâ€™ names (<math alttext="C_{1}" class="ltx_Math" display="inline" id="S4.SS1.p2.1.m1.1"><semantics id="S4.SS1.p2.1.m1.1a"><msub id="S4.SS1.p2.1.m1.1.1" xref="S4.SS1.p2.1.m1.1.1.cmml"><mi id="S4.SS1.p2.1.m1.1.1.2" xref="S4.SS1.p2.1.m1.1.1.2.cmml">C</mi><mn id="S4.SS1.p2.1.m1.1.1.3" xref="S4.SS1.p2.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.1.m1.1b"><apply id="S4.SS1.p2.1.m1.1.1.cmml" xref="S4.SS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.1.m1.1.1.1.cmml" xref="S4.SS1.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS1.p2.1.m1.1.1.2.cmml" xref="S4.SS1.p2.1.m1.1.1.2">ğ¶</ci><cn id="S4.SS1.p2.1.m1.1.1.3.cmml" type="integer" xref="S4.SS1.p2.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.1.m1.1c">C_{1}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.1.m1.1d">italic_C start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>), born dates (<math alttext="C_{2}" class="ltx_Math" display="inline" id="S4.SS1.p2.2.m2.1"><semantics id="S4.SS1.p2.2.m2.1a"><msub id="S4.SS1.p2.2.m2.1.1" xref="S4.SS1.p2.2.m2.1.1.cmml"><mi id="S4.SS1.p2.2.m2.1.1.2" xref="S4.SS1.p2.2.m2.1.1.2.cmml">C</mi><mn id="S4.SS1.p2.2.m2.1.1.3" xref="S4.SS1.p2.2.m2.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.2.m2.1b"><apply id="S4.SS1.p2.2.m2.1.1.cmml" xref="S4.SS1.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.2.m2.1.1.1.cmml" xref="S4.SS1.p2.2.m2.1.1">subscript</csymbol><ci id="S4.SS1.p2.2.m2.1.1.2.cmml" xref="S4.SS1.p2.2.m2.1.1.2">ğ¶</ci><cn id="S4.SS1.p2.2.m2.1.1.3.cmml" type="integer" xref="S4.SS1.p2.2.m2.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.2.m2.1c">C_{2}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.2.m2.1d">italic_C start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>), Nobel prizes (<math alttext="C_{3}" class="ltx_Math" display="inline" id="S4.SS1.p2.3.m3.1"><semantics id="S4.SS1.p2.3.m3.1a"><msub id="S4.SS1.p2.3.m3.1.1" xref="S4.SS1.p2.3.m3.1.1.cmml"><mi id="S4.SS1.p2.3.m3.1.1.2" xref="S4.SS1.p2.3.m3.1.1.2.cmml">C</mi><mn id="S4.SS1.p2.3.m3.1.1.3" xref="S4.SS1.p2.3.m3.1.1.3.cmml">3</mn></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.3.m3.1b"><apply id="S4.SS1.p2.3.m3.1.1.cmml" xref="S4.SS1.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.3.m3.1.1.1.cmml" xref="S4.SS1.p2.3.m3.1.1">subscript</csymbol><ci id="S4.SS1.p2.3.m3.1.1.2.cmml" xref="S4.SS1.p2.3.m3.1.1.2">ğ¶</ci><cn id="S4.SS1.p2.3.m3.1.1.3.cmml" type="integer" xref="S4.SS1.p2.3.m3.1.1.3">3</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.3.m3.1c">C_{3}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.3.m3.1d">italic_C start_POSTSUBSCRIPT 3 end_POSTSUBSCRIPT</annotation></semantics></math>). When the GGPP prefix is added, the attention activation and MLP activation on <math alttext="C_{1}" class="ltx_Math" display="inline" id="S4.SS1.p2.4.m4.1"><semantics id="S4.SS1.p2.4.m4.1a"><msub id="S4.SS1.p2.4.m4.1.1" xref="S4.SS1.p2.4.m4.1.1.cmml"><mi id="S4.SS1.p2.4.m4.1.1.2" xref="S4.SS1.p2.4.m4.1.1.2.cmml">C</mi><mn id="S4.SS1.p2.4.m4.1.1.3" xref="S4.SS1.p2.4.m4.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.4.m4.1b"><apply id="S4.SS1.p2.4.m4.1.1.cmml" xref="S4.SS1.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.4.m4.1.1.1.cmml" xref="S4.SS1.p2.4.m4.1.1">subscript</csymbol><ci id="S4.SS1.p2.4.m4.1.1.2.cmml" xref="S4.SS1.p2.4.m4.1.1.2">ğ¶</ci><cn id="S4.SS1.p2.4.m4.1.1.3.cmml" type="integer" xref="S4.SS1.p2.4.m4.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.4.m4.1c">C_{1}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.4.m4.1d">italic_C start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> disappear from the green boxes while the hidden states drift away. It is clear that the prefix affects the neuron activations of LLMs, which triggers the generation of factually incorrect text.</p>
</div>
<div class="ltx_para" id="S4.SS1.p3">
<p class="ltx_p" id="S4.SS1.p3.1">In RAG, the embedding vector is the mean of the last hidden layer of an LLM (Equation Â <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.E3" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">3</span></a>). The causal trace indicates a strong correlation between embedding vectors and MLP activations. Based on this observation, we can train a classifier to detect perturbations on prompts.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2. </span>Detection methods</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.1">Drawing from our observations on the prefixâ€™s impact on neuron activations, we first introduce SATe probe as an adaption of SAT probeÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib18" title="">yuksekgonul2023attention, </a>)</cite> to detect the GGPP prefix. SAT probe uses the internal states of LLMs, particularly attentions to constraint tokens to identify factual errors. It is a type of mechanistic white-box approaches that correlate self-attention patterns in an LLM to the factual information of queries. By checking if the correlation constraint is satisfied, factual errors can be identified. We adapt SAT to the embedding space and train it on neuron activation patterns that represent embeddings with and without GGPP perturbations.
</p>
</div>
<div class="ltx_para" id="S4.SS2.p2">
<p class="ltx_p" id="S4.SS2.p2.6">Although SATe shows good performance in detecting the GGPP prefix in our experiments, it
needs to probe all the attention weights (<math alttext="L\times N_{h}\times n^{2}" class="ltx_Math" display="inline" id="S4.SS2.p2.1.m1.1"><semantics id="S4.SS2.p2.1.m1.1a"><mrow id="S4.SS2.p2.1.m1.1.1" xref="S4.SS2.p2.1.m1.1.1.cmml"><mi id="S4.SS2.p2.1.m1.1.1.2" xref="S4.SS2.p2.1.m1.1.1.2.cmml">L</mi><mo id="S4.SS2.p2.1.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.SS2.p2.1.m1.1.1.1.cmml">Ã—</mo><msub id="S4.SS2.p2.1.m1.1.1.3" xref="S4.SS2.p2.1.m1.1.1.3.cmml"><mi id="S4.SS2.p2.1.m1.1.1.3.2" xref="S4.SS2.p2.1.m1.1.1.3.2.cmml">N</mi><mi id="S4.SS2.p2.1.m1.1.1.3.3" xref="S4.SS2.p2.1.m1.1.1.3.3.cmml">h</mi></msub><mo id="S4.SS2.p2.1.m1.1.1.1a" lspace="0.222em" rspace="0.222em" xref="S4.SS2.p2.1.m1.1.1.1.cmml">Ã—</mo><msup id="S4.SS2.p2.1.m1.1.1.4" xref="S4.SS2.p2.1.m1.1.1.4.cmml"><mi id="S4.SS2.p2.1.m1.1.1.4.2" xref="S4.SS2.p2.1.m1.1.1.4.2.cmml">n</mi><mn id="S4.SS2.p2.1.m1.1.1.4.3" xref="S4.SS2.p2.1.m1.1.1.4.3.cmml">2</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.1.m1.1b"><apply id="S4.SS2.p2.1.m1.1.1.cmml" xref="S4.SS2.p2.1.m1.1.1"><times id="S4.SS2.p2.1.m1.1.1.1.cmml" xref="S4.SS2.p2.1.m1.1.1.1"></times><ci id="S4.SS2.p2.1.m1.1.1.2.cmml" xref="S4.SS2.p2.1.m1.1.1.2">ğ¿</ci><apply id="S4.SS2.p2.1.m1.1.1.3.cmml" xref="S4.SS2.p2.1.m1.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.p2.1.m1.1.1.3.1.cmml" xref="S4.SS2.p2.1.m1.1.1.3">subscript</csymbol><ci id="S4.SS2.p2.1.m1.1.1.3.2.cmml" xref="S4.SS2.p2.1.m1.1.1.3.2">ğ‘</ci><ci id="S4.SS2.p2.1.m1.1.1.3.3.cmml" xref="S4.SS2.p2.1.m1.1.1.3.3">â„</ci></apply><apply id="S4.SS2.p2.1.m1.1.1.4.cmml" xref="S4.SS2.p2.1.m1.1.1.4"><csymbol cd="ambiguous" id="S4.SS2.p2.1.m1.1.1.4.1.cmml" xref="S4.SS2.p2.1.m1.1.1.4">superscript</csymbol><ci id="S4.SS2.p2.1.m1.1.1.4.2.cmml" xref="S4.SS2.p2.1.m1.1.1.4.2">ğ‘›</ci><cn id="S4.SS2.p2.1.m1.1.1.4.3.cmml" type="integer" xref="S4.SS2.p2.1.m1.1.1.4.3">2</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.1.m1.1c">L\times N_{h}\times n^{2}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.1.m1.1d">italic_L Ã— italic_N start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT Ã— italic_n start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math> parameters in total, where <math alttext="L" class="ltx_Math" display="inline" id="S4.SS2.p2.2.m2.1"><semantics id="S4.SS2.p2.2.m2.1a"><mi id="S4.SS2.p2.2.m2.1.1" xref="S4.SS2.p2.2.m2.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.2.m2.1b"><ci id="S4.SS2.p2.2.m2.1.1.cmml" xref="S4.SS2.p2.2.m2.1.1">ğ¿</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.2.m2.1c">L</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.2.m2.1d">italic_L</annotation></semantics></math>: Number of layers in the Transformer; <math alttext="N_{h}" class="ltx_Math" display="inline" id="S4.SS2.p2.3.m3.1"><semantics id="S4.SS2.p2.3.m3.1a"><msub id="S4.SS2.p2.3.m3.1.1" xref="S4.SS2.p2.3.m3.1.1.cmml"><mi id="S4.SS2.p2.3.m3.1.1.2" xref="S4.SS2.p2.3.m3.1.1.2.cmml">N</mi><mi id="S4.SS2.p2.3.m3.1.1.3" xref="S4.SS2.p2.3.m3.1.1.3.cmml">h</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.3.m3.1b"><apply id="S4.SS2.p2.3.m3.1.1.cmml" xref="S4.SS2.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.3.m3.1.1.1.cmml" xref="S4.SS2.p2.3.m3.1.1">subscript</csymbol><ci id="S4.SS2.p2.3.m3.1.1.2.cmml" xref="S4.SS2.p2.3.m3.1.1.2">ğ‘</ci><ci id="S4.SS2.p2.3.m3.1.1.3.cmml" xref="S4.SS2.p2.3.m3.1.1.3">â„</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.3.m3.1c">N_{h}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.3.m3.1d">italic_N start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT</annotation></semantics></math>: Number of attention heads per layer; <math alttext="n" class="ltx_Math" display="inline" id="S4.SS2.p2.4.m4.1"><semantics id="S4.SS2.p2.4.m4.1a"><mi id="S4.SS2.p2.4.m4.1.1" xref="S4.SS2.p2.4.m4.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.4.m4.1b"><ci id="S4.SS2.p2.4.m4.1.1.cmml" xref="S4.SS2.p2.4.m4.1.1">ğ‘›</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.4.m4.1c">n</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.4.m4.1d">italic_n</annotation></semantics></math>: number of tokens in query), which cost too much resource. We therefore propose a new probe (ACT probe) that analyzes the neuron activations in the last layer of an LLM. This probe serves for two purposes: 1) detecting whether the prefix forces the resultant embedding vectors of LLM retrievers to shift towards a different point in the embedding space; 2) detecting whether the prefix will force the model to generate factually errors. Same as SATe probe, ACT probe is also
trained on neuron activations with or without perturbations in the prompts. Figure <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.F6" title="Figure 6 â€£ 3.3. GGPP for prompts with instructions â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">6</span></a> shows the detection workflow. ACT probes the neuron activations only in the last layer of LLMs by training a Logistic Regression Classifier. Compared to SAT probe, ACT probe uses significantly fewer parameters (<math alttext="d_{\text{model}}\times n" class="ltx_Math" display="inline" id="S4.SS2.p2.5.m5.1"><semantics id="S4.SS2.p2.5.m5.1a"><mrow id="S4.SS2.p2.5.m5.1.1" xref="S4.SS2.p2.5.m5.1.1.cmml"><msub id="S4.SS2.p2.5.m5.1.1.2" xref="S4.SS2.p2.5.m5.1.1.2.cmml"><mi id="S4.SS2.p2.5.m5.1.1.2.2" xref="S4.SS2.p2.5.m5.1.1.2.2.cmml">d</mi><mtext id="S4.SS2.p2.5.m5.1.1.2.3" xref="S4.SS2.p2.5.m5.1.1.2.3a.cmml">model</mtext></msub><mo id="S4.SS2.p2.5.m5.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.SS2.p2.5.m5.1.1.1.cmml">Ã—</mo><mi id="S4.SS2.p2.5.m5.1.1.3" xref="S4.SS2.p2.5.m5.1.1.3.cmml">n</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.5.m5.1b"><apply id="S4.SS2.p2.5.m5.1.1.cmml" xref="S4.SS2.p2.5.m5.1.1"><times id="S4.SS2.p2.5.m5.1.1.1.cmml" xref="S4.SS2.p2.5.m5.1.1.1"></times><apply id="S4.SS2.p2.5.m5.1.1.2.cmml" xref="S4.SS2.p2.5.m5.1.1.2"><csymbol cd="ambiguous" id="S4.SS2.p2.5.m5.1.1.2.1.cmml" xref="S4.SS2.p2.5.m5.1.1.2">subscript</csymbol><ci id="S4.SS2.p2.5.m5.1.1.2.2.cmml" xref="S4.SS2.p2.5.m5.1.1.2.2">ğ‘‘</ci><ci id="S4.SS2.p2.5.m5.1.1.2.3a.cmml" xref="S4.SS2.p2.5.m5.1.1.2.3"><mtext id="S4.SS2.p2.5.m5.1.1.2.3.cmml" mathsize="70%" xref="S4.SS2.p2.5.m5.1.1.2.3">model</mtext></ci></apply><ci id="S4.SS2.p2.5.m5.1.1.3.cmml" xref="S4.SS2.p2.5.m5.1.1.3">ğ‘›</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.5.m5.1c">d_{\text{model}}\times n</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.5.m5.1d">italic_d start_POSTSUBSCRIPT model end_POSTSUBSCRIPT Ã— italic_n</annotation></semantics></math> parameters in total, where <math alttext="d_{\text{model}}" class="ltx_Math" display="inline" id="S4.SS2.p2.6.m6.1"><semantics id="S4.SS2.p2.6.m6.1a"><msub id="S4.SS2.p2.6.m6.1.1" xref="S4.SS2.p2.6.m6.1.1.cmml"><mi id="S4.SS2.p2.6.m6.1.1.2" xref="S4.SS2.p2.6.m6.1.1.2.cmml">d</mi><mtext id="S4.SS2.p2.6.m6.1.1.3" xref="S4.SS2.p2.6.m6.1.1.3a.cmml">model</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.6.m6.1b"><apply id="S4.SS2.p2.6.m6.1.1.cmml" xref="S4.SS2.p2.6.m6.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.6.m6.1.1.1.cmml" xref="S4.SS2.p2.6.m6.1.1">subscript</csymbol><ci id="S4.SS2.p2.6.m6.1.1.2.cmml" xref="S4.SS2.p2.6.m6.1.1.2">ğ‘‘</ci><ci id="S4.SS2.p2.6.m6.1.1.3a.cmml" xref="S4.SS2.p2.6.m6.1.1.3"><mtext id="S4.SS2.p2.6.m6.1.1.3.cmml" mathsize="70%" xref="S4.SS2.p2.6.m6.1.1.3">model</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.6.m6.1c">d_{\text{model}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.6.m6.1d">italic_d start_POSTSUBSCRIPT model end_POSTSUBSCRIPT</annotation></semantics></math>: Dimension of the hidden states) while maintaining a comparable retrieval error detection rate.</p>
</div>
<div class="ltx_para" id="S4.SS2.p3">
<p class="ltx_p" id="S4.SS2.p3.1">It is worth pointing out that both SATe and ACT can detect perturbation on both the retrieval and generation sides. In our work, we focus on detection on the retrieval side.</p>
</div>
<figure class="ltx_table" id="S4.T1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 1. </span>Datasets used in retrieval manipulation experiments.</figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T1.1" style="width:545.4pt;height:245.6pt;vertical-align:-0.8pt;"><span class="ltx_transformed_inner" style="transform:translate(-68.2pt,30.6pt) scale(0.8,0.8) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S4.T1.1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S4.T1.1.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_l ltx_border_rr ltx_border_t" id="S4.T1.1.1.1.1.1">Dataset</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_r ltx_border_t" id="S4.T1.1.1.1.1.2">Constraint type</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_t" id="S4.T1.1.1.1.1.3">N</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_r ltx_border_t" id="S4.T1.1.1.1.1.4">Source</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_r ltx_border_t" id="S4.T1.1.1.1.1.5">Example prompts and passages</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T1.1.1.1.1.6">Models</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_t" id="S4.T1.1.1.1.1.7">Hit rates (top-10)</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T1.1.1.2.1">
<td class="ltx_td ltx_align_left ltx_border_l ltx_border_rr ltx_border_t" id="S4.T1.1.1.2.1.1" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.2.1.1.1">IMDB</span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.1.1.2.1.2" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.2.1.2.1">own the professions</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.2.1.3" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.2.1.3.1">1000</span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.1.1.2.1.4" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.2.1.4.1">IMDB Developer</span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.1.1.2.1.5" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.2.1.5.1">FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F8" title="Figure 8 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">8</span></a> (AppendixÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS3" title="A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">A.3</span></a>)</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.2.1.6">GPT-J-6B</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.2.1.7">51.5%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.3.2">
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.3.2.1">Mistral-7B</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.1.1.3.2.2">81.6%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.4.3">
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.4.3.1">Qwen-7B</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.1.1.4.3.2">75.5%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.5.4">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.5.4.1">SFR-Embedding-Mistral</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.5.4.2">100%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.6.5">
<td class="ltx_td ltx_align_left ltx_border_l ltx_border_rr ltx_border_t" id="S4.T1.1.1.6.5.1" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.6.5.1.1">Basketball Players</span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.1.1.6.5.2" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.6.5.2.1">get the honors</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.6.5.3" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.6.5.3.1">1000</span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.1.1.6.5.4" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.6.5.4.1">Wiki Data</span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.1.1.6.5.5" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.6.5.5.1">FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F9" title="Figure 9 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">9</span></a> (AppendixÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS3" title="A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">A.3</span></a>)</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.6.5.6">GPT-J-6B</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.6.5.7">76.1%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.7.6">
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.7.6.1">Mistral-7B</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.1.1.7.6.2">82.7%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.8.7">
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.8.7.1">Qwen-7B</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.1.1.8.7.2">77.9%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.9.8">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.9.8.1">SFR-Embedding-Mistral</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.9.8.2">100%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.10.9">
<td class="ltx_td ltx_align_left ltx_border_l ltx_border_rr ltx_border_t" id="S4.T1.1.1.10.9.1" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.10.9.1.1">Books</span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.1.1.10.9.2" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.10.9.2.1">writen by</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.10.9.3" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.10.9.3.1">1000</span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.1.1.10.9.4" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.10.9.4.1">Wiki Data</span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T1.1.1.10.9.5" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.10.9.5.1">Figure <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F10" title="Figure 10 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">10</span></a> (AppendixÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS3" title="A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">A.3</span></a>)</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.10.9.6">GPT-J-6B</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.10.9.7">81.7%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.11.10">
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.11.10.1">Mistral-7B</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.1.1.11.10.2">90.1%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.12.11">
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.12.11.1">Qwen-7B</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.1.1.12.11.2">80.4%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.13.12">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.13.12.1">SFR-Embedding-Mistral</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.13.12.2">96.9%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.14.13">
<td class="ltx_td ltx_align_left ltx_border_b ltx_border_l ltx_border_rr ltx_border_t" id="S4.T1.1.1.14.13.1" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.14.13.1.1">Nobel Winners</span></td>
<td class="ltx_td ltx_align_left ltx_border_b ltx_border_r ltx_border_t" id="S4.T1.1.1.14.13.2" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.14.13.2.1">reasons of winnings</span></td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T1.1.1.14.13.3" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.14.13.3.1">1000</span></td>
<td class="ltx_td ltx_align_left ltx_border_b ltx_border_r ltx_border_t" id="S4.T1.1.1.14.13.4" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.14.13.4.1">Opendatasoft(2023)</span></td>
<td class="ltx_td ltx_align_left ltx_border_b ltx_border_r ltx_border_t" id="S4.T1.1.1.14.13.5" rowspan="4"><span class="ltx_text" id="S4.T1.1.1.14.13.5.1">Figure <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F11" title="Figure 11 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">11</span></a> (AppendixÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS3" title="A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">A.3</span></a>)</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.14.13.6">GPT-J-6B</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.14.13.7">72.8%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.15.14">
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.15.14.1">Mistral-7B</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.1.1.15.14.2">93.8%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.16.15">
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.16.15.1">Qwen-7B</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T1.1.1.16.15.2">72.2%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.17.16">
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_t" id="S4.T1.1.1.17.16.1">SFR-Embedding-Mistral</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T1.1.1.17.16.2">100%</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5. </span>Experiments</h2>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1. </span>Setup</h3>
<div class="ltx_para" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.1">We evaluate our methodâ€™s performance using a benchmark comprising four datasets, detailed in Table <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S4.T1" title="Table 1 â€£ 4.2. Detection methods â€£ 4. Detection of adversarial prefixes â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">1</span></a>, sourced from three different repositories: IMDBÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib40" title="">imdb_datasets, </a>)</cite>, WikiData (Books and Movies)Â <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib41" title="">WikiData, </a>)</cite>, and Opendatasoft (2023) (Nobel Winners)Â <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib42" title="">Opendatasoft, </a>)</cite>. For each dataset, we extract the first 1000 entries. We choose a constraint type for each dataset and generate prompts and passages based on the basic features of the entries and their corresponding constraint types. For example, by using basic features like â€primary nameâ€, â€birth yearâ€, â€death yearâ€, â€primary professionâ€, and â€known for titlesâ€ of the actress/actor, along with the constraint type â€own the professionsâ€, we generate example prompts and passages for the IMDB dataset showcased in FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F8" title="Figure 8 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">8</span></a>. Similarly, FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F9" title="Figure 9 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">9</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F10" title="Figure 10 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">10</span></a> and <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F11" title="Figure 11 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">11</span></a> show example prompts and passages for Basketball, Books and Nobel winners datasets, respectively. AppendixÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS4" title="A.4. Example GGPP prefixes â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">A.4</span></a> ( FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F12" title="Figure 12 â€£ A.4. Example GGPP prefixes â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">12</span></a>-<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F15" title="Figure 15 â€£ A.4. Example GGPP prefixes â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">15</span></a>) provides more examples.</p>
</div>
<div class="ltx_para" id="S5.SS1.p2">
<p class="ltx_p" id="S5.SS1.p2.1">To obtain embeddings for prompts and passages, we employ three pre-trained LLMs for decoder-based embeddings: GPT-J-6BÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib19" title="">GPT_J_github_project, </a>)</cite>, Mistrial-7BÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib20" title="">jiang2023mistral, </a>)</cite> and Qwen-7BÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib21" title="">bai2023qwen, </a>)</cite>, and one encoder-based LLM embedding model, SFR-Embedding-MistralÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib22" title="">SFRAIResearch2024, </a>)</cite>. These models have vocabulary sizes of 50,400, 32,000, 151,936, and 32,000 respectively. All passage embeddings are stored within our HNSWÂ <span class="ltx_note ltx_role_footnote" id="footnote2"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_tag ltx_tag_note">2</span>https://www.pinecone.io/learn/series/faiss/hnsw/.</span></span></span> index system. We set up four stores corresponding to the four datasets. Following this, we evaluate the index systemâ€™s performance across individual stores and measure their hit rates corresponding to prompts. The â€hit rateâ€ refers to the proportion of correctly identified entries for all queries. As illustrated in TableÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S4.T1" title="Table 1 â€£ 4.2. Detection methods â€£ 4. Detection of adversarial prefixes â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">1</span></a>, it is not guaranteed that the RAG system always retrieves correct passages through these embedding models. For example, when GPT-J-6B is employed for embedding, the hit rate for IMDB is only 51.5% when the top 10 results are returned. For each embedding model, we filter out prompts that do not return correct passages in the top-k retrieval results to evaluate GGPP so that GGPPâ€™s performance can be fairly compared among these models.</p>
</div>
<div class="ltx_para" id="S5.SS1.p3">
<p class="ltx_p" id="S5.SS1.p3.1">Additionally, we also construct the Celebrity dataset sourced from Wikidata to assess GGPPâ€™s efficacy in manipulating factual answers solely with LLMs (i.e., non retrieval-based). See AppendixÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS5" title="A.5. Factual answer manipulation experiments â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">A.5</span></a> for details.</p>
</div>
<figure class="ltx_table" id="S5.T2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 2. </span>Perturbation performance of GGPP across datasets and models. (top-1 and top-10 success rate)</figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T2.1" style="width:273.7pt;height:229.5pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-45.6pt,38.3pt) scale(0.75,0.75) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S5.T2.1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S5.T2.1.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T2.1.1.1.1.1">Datasets</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_t" id="S5.T2.1.1.1.1.2">Prefix length</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T2.1.1.1.1.3">Models</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T2.1.1.1.1.4">top-1</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_t" id="S5.T2.1.1.1.1.5">top-10</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T2.1.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T2.1.1.2.1.1" rowspan="4"><span class="ltx_text" id="S5.T2.1.1.2.1.1.1">IMDB</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.1.1.2.1.2" rowspan="3"><span class="ltx_text" id="S5.T2.1.1.2.1.2.1">5 tokens</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.2.1.3">GPT-J-6B</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.2.1.4">68.4%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T2.1.1.2.1.5">88.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.3.2">
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.3.2.1">Mistral-7B</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.3.2.2">30.6%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.1.3.2.3">41.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.4.3">
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.4.3.1">Qwen-7B</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.4.3.2">29.8%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.1.4.3.3">45.7%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.5.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.1.1.5.4.1">10 tokens</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.5.4.2">SFR-Embedding-Mistral</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.5.4.3">22.5%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T2.1.1.5.4.4">22.5%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.6.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T2.1.1.6.5.1" rowspan="4"><span class="ltx_text" id="S5.T2.1.1.6.5.1.1">Basketball Players</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.1.1.6.5.2" rowspan="3"><span class="ltx_text" id="S5.T2.1.1.6.5.2.1">5 tokens</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.6.5.3">GPT-J-6B</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.6.5.4">31.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T2.1.1.6.5.5">59.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.7.6">
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.7.6.1">Mistral-7B</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.7.6.2">11.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.1.7.6.3">29.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.8.7">
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.8.7.1">Qwen-7B</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.8.7.2">25.5%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.1.8.7.3">52.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.9.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.1.1.9.8.1">10 tokens</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.9.8.2">SFR-Embedding-Mistral</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.9.8.3">28.5%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T2.1.1.9.8.4">28.9%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.10.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T2.1.1.10.9.1" rowspan="4"><span class="ltx_text" id="S5.T2.1.1.10.9.1.1">Books</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.1.1.10.9.2" rowspan="3"><span class="ltx_text" id="S5.T2.1.1.10.9.2.1">5 tokens</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.10.9.3">GPT-J-6B</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.10.9.4">43.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T2.1.1.10.9.5">63.8%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.11.10">
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.11.10.1">Mistral-7B</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.11.10.2">38.1%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.1.11.10.3">58.8%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.12.11">
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.12.11.1">Qwen-7B</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.12.11.2">25.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.1.12.11.3">61.8%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.13.12">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.1.1.13.12.1">10 tokens</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.13.12.2">SFR-Embedding-Mistral</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.13.12.3">18.7%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T2.1.1.13.12.4">19.8%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.14.13">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b ltx_border_l ltx_border_r ltx_border_t" id="S5.T2.1.1.14.13.1" rowspan="4"><span class="ltx_text" id="S5.T2.1.1.14.13.1.1">Nobel winners</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T2.1.1.14.13.2" rowspan="3"><span class="ltx_text" id="S5.T2.1.1.14.13.2.1">5 tokens</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.14.13.3">GPT-J-6B</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T2.1.1.14.13.4">60.2%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T2.1.1.14.13.5">77.9%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.15.14">
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.15.14.1">Mistral-7B</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.15.14.2">28.8%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.1.15.14.3">50.0%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.16.15">
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.16.15.1">Qwen-7B</td>
<td class="ltx_td ltx_align_center" id="S5.T2.1.1.16.15.2">29.6%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T2.1.1.16.15.3">65.0%</td>
</tr>
<tr class="ltx_tr" id="S5.T2.1.1.17.16">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b ltx_border_t" id="S5.T2.1.1.17.16.1">10 tokens</th>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_t" id="S5.T2.1.1.17.16.2">SFR-Embedding-Mistral</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_t" id="S5.T2.1.1.17.16.3">71.6%</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S5.T2.1.1.17.16.4">71.6%</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2. </span>Results</h3>
<div class="ltx_para" id="S5.SS2.p1">
<p class="ltx_p" id="S5.SS2.p1.1">We begin by assessing the impact of prompt perturbation on retrieval results, followed by evaluating the effectiveness and efficiency of detecting perturbations using both SATe and ACT probes.</p>
</div>
<section class="ltx_subsubsection" id="S5.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.2.1. </span>Prompt perturbation</h4>
<figure class="ltx_figure" id="S5.F7"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="461" id="S5.F7.g1" src="x7.png" width="581"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 7. </span>L2 distances between target embedding vectors and currently generated vectors over training epochs.</figcaption>
</figure>
<div class="ltx_para" id="S5.SS2.SSS1.p1">
<p class="ltx_p" id="S5.SS2.SSS1.p1.1">To understand GGPPâ€™s perturbation capabilities, we investigate three main aspects. First, we assess GGPPâ€™s perturbation performance across different datasets and embedding models. Second, we adapt methods originally designed to â€œjailbreakâ€ LLMs, and compare GGPP with them in terms of perturbation effectiveness. Finally, we analyze the impact of prefix initialization and <math alttext="\lambda" class="ltx_Math" display="inline" id="S5.SS2.SSS1.p1.1.m1.1"><semantics id="S5.SS2.SSS1.p1.1.m1.1a"><mi id="S5.SS2.SSS1.p1.1.m1.1.1" xref="S5.SS2.SSS1.p1.1.m1.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS1.p1.1.m1.1b"><ci id="S5.SS2.SSS1.p1.1.m1.1.1.cmml" xref="S5.SS2.SSS1.p1.1.m1.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS1.p1.1.m1.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS1.p1.1.m1.1d">italic_Î»</annotation></semantics></math> parameter on the performance of GGPP.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS2.SSS1.p2">
<p class="ltx_p" id="S5.SS2.SSS1.p2.1"><span class="ltx_text ltx_font_bold" id="S5.SS2.SSS1.p2.1.1">GGPPâ€™s overall performance.</span> TableÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S5.T2" title="Table 2 â€£ 5.1. Setup â€£ 5. Experiments â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">2</span></a> presents the performance of GGPP across the four datasets, using three decoder-based models, GPT-J-6B, Mistrial-7B and Qwen-7B, and one encoder-based SFR-Embedding-Mistral, for embedding. We apply loss function <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.E4" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">4</span></a> on three decoder-based models and the function <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S3.E5" title="In 3.2. The GGPP algorithm â€£ 3. Gradient Guided Prompt Perturbation â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">5</span></a> on SFR-Embedding-Mistral. We use a fixed prefix size of 5 for the decoder-based models and 10 for the encoder-based SFR-Embedding-Mistral model. The longer prefix is needed for SFR-Embedding-Mistral because its encoder-based nature makes it more context-sensitive, making it harder to shift its embeddings closer to a target compared to decoder-based embedding models. AppendixÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS4" title="A.4. Example GGPP prefixes â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">A.4</span></a> provides some prefix examples. We assess the success rate of perturbation. Within TableÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S5.T2" title="Table 2 â€£ 5.1. Setup â€£ 5. Experiments â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">2</span></a>, â€top-1 success rateâ€ represents the proportion of targeted passages appearing first in the retrieval results, while â€top-10 success rateâ€ represents the proportion of targeted passages among the top 10 results. Among the three decoder-based models, GPT-J-6B yields the highest top-1 and top-10 success rates for GGPP, regardless of the dataset used in the experiments. Additionally, GGPP achieves better performance when using Qwen-7B compared to Mistrial-7B. The difference in performance can be attributed to GPT-J-6B having the fewest parameters among the three models, while Qwen-7B has the largest vocabulary size, resulting in a larger optimization space for perturbation. Consequently, GPT-J-6B and Qwen-7B are more susceptible to manipulation compared to Mistrial-7B.</p>
</div>
<div class="ltx_para" id="S5.SS2.SSS1.p3">
<p class="ltx_p" id="S5.SS2.SSS1.p3.1">The encoder-based SFR-Embedding-Mistral model is considered as one of the top-performing models in text embeddingÂ <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib37" title="">muennighoff2022mteb, </a>)</cite>; however, it remains vulnerable to manipulation by GGPP. We notice that SFR-Embedding-Mistral even leads to higher top-1 success rates than GPT-J-6B on Basketball players and Nobel winners datasets. On the other hand, its use results in top-10 success rates that either remain unchanged or show only marginal improvement compared to the top-1 rates, which is unexpected and contrasts with the results with the decoder-based models. We suspect that this discrepancy is due to the high context-sensitivity of the embeddings generated by SFR-Embedding-Mistral, making it challenging for GGPP to push targeted passages into the top 10 results if they are not already in the top-1 results.</p>
</div>
<figure class="ltx_table" id="S5.T3">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 3. </span>Comparison with â€œJailbreakâ€ methods.</figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T3.1" style="width:246.6pt;height:175.5pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-41.1pt,29.3pt) scale(0.75,0.75) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S5.T3.1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S5.T3.1.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T3.1.1.1.1.1">Dataset</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_t" id="S5.T3.1.1.1.1.2">Method</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T3.1.1.1.1.3">top-1 success rate</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_t" id="S5.T3.1.1.1.1.4">top-10 success rate</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T3.1.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T3.1.1.2.1.1" rowspan="2"><span class="ltx_text" id="S5.T3.1.1.2.1.1.1">IMDB</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T3.1.1.2.1.2">GGPP</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.1.2.1.3">30.6%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T3.1.1.2.1.4">41.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T3.1.1.3.2.1">GCG</th>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.3.2.2">2.0%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.1.1.3.2.3">7.0%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.4.3">
<th class="ltx_td ltx_th ltx_th_row ltx_border_l ltx_border_r" id="S5.T3.1.1.4.3.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T3.1.1.4.3.2">UAT</th>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.4.3.3">0.8%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.1.1.4.3.4">3.2%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.5.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T3.1.1.5.4.1" rowspan="2"><span class="ltx_text" id="S5.T3.1.1.5.4.1.1">Basketball Players</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T3.1.1.5.4.2">GGPP</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.1.5.4.3">11.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T3.1.1.5.4.4">29.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.6.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T3.1.1.6.5.1">GCG</th>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.6.5.2">0.0%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.1.1.6.5.3">5.4%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.7.6">
<th class="ltx_td ltx_th ltx_th_row ltx_border_l ltx_border_r" id="S5.T3.1.1.7.6.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T3.1.1.7.6.2">UAT</th>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.7.6.3">0.0%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.1.1.7.6.4">7.3%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.8.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T3.1.1.8.7.1" rowspan="2"><span class="ltx_text" id="S5.T3.1.1.8.7.1.1">Books</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T3.1.1.8.7.2">GGPP</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.1.8.7.3">38.1%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T3.1.1.8.7.4">58.8%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.9.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T3.1.1.9.8.1">GCG</th>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.9.8.2">1.2%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.1.1.9.8.3">2.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.10.9">
<th class="ltx_td ltx_th ltx_th_row ltx_border_l ltx_border_r" id="S5.T3.1.1.10.9.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T3.1.1.10.9.2">UAT</th>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.10.9.3">0.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.1.1.10.9.4">4.7%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.11.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T3.1.1.11.10.1" rowspan="2"><span class="ltx_text" id="S5.T3.1.1.11.10.1.1">Nobel winners</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T3.1.1.11.10.2">GGPP</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T3.1.1.11.10.3">28.8%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T3.1.1.11.10.4">50.0%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.12.11">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.T3.1.1.12.11.1">GCG</th>
<td class="ltx_td ltx_align_center" id="S5.T3.1.1.12.11.2">1.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T3.1.1.12.11.3">6.0%</td>
</tr>
<tr class="ltx_tr" id="S5.T3.1.1.13.12">
<th class="ltx_td ltx_th ltx_th_row ltx_border_b ltx_border_l ltx_border_r" id="S5.T3.1.1.13.12.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b" id="S5.T3.1.1.13.12.2">UAT</th>
<td class="ltx_td ltx_align_center ltx_border_b" id="S5.T3.1.1.13.12.3">0.0%</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r" id="S5.T3.1.1.13.12.4">4.0%</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
<figure class="ltx_table" id="S5.T4">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 4. </span>GGPP perturbation detection effectiveness.</figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S5.T4.1" style="width:364.5pt;height:434.3pt;vertical-align:-0.7pt;"><span class="ltx_transformed_inner" style="transform:translate(-67.4pt,80.2pt) scale(0.73,0.73) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S5.T4.1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S5.T4.1.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T4.1.1.1.1.1">Dataset</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.1.1.2">Models</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.1.1.3">Probe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.1.1.4">N Parameters</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T4.1.1.1.1.5">AUROC</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T4.1.1.1.1.6">Precision</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S5.T4.1.1.1.1.7">Recall</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_t" id="S5.T4.1.1.1.1.8">F1-score</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T4.1.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T4.1.1.2.1.1" rowspan="6"><span class="ltx_text" id="S5.T4.1.1.2.1.1.1">IMDB</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.2.1.2" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.2.1.2.1">GPT-J-6B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.2.1.3">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.2.1.4">4939200</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.2.1.5">99.9%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.2.1.6">96.7%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.2.1.7">100.0%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.2.1.8">98.3%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.3.2.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.3.2.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.3.2.3">98.3%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.3.2.4">94.4%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.3.2.5">94.6%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.3.2.6">94.4%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.4.3.1" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.4.3.1.1">Mistral-7B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.4.3.2">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.4.3.3">11289600</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.4.3.4">98.1%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.4.3.5">93.2%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.4.3.6">93.2%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.4.3.7">93.0%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.5.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.5.4.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.5.4.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.5.4.3">99.6%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.5.4.4">97.6%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.5.4.5">96.2%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.5.4.6">96.9%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.6.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.6.5.1" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.6.5.1.1">Qwen-7B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.6.5.2">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.6.5.3">11289600</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.6.5.4">97.1%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.6.5.5">94.5%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.6.5.6">90.2%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.6.5.7">92.1%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.7.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.7.6.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.7.6.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.7.6.3">91.0%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.7.6.4">85.5%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.7.6.5">83.5%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.7.6.6">84.2%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.8.7">
<th class="ltx_td ltx_th ltx_th_row ltx_border_l ltx_border_r" id="S5.T4.1.1.8.7.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.8.7.2" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.8.7.2.1">SFR-Embedding-Mistral</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.8.7.3">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.8.7.4">12390400</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.8.7.5">100%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.8.7.6">100%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.8.7.7">99.5%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.8.7.8">99.7%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.9.8">
<th class="ltx_td ltx_th ltx_th_row ltx_border_l ltx_border_r" id="S5.T4.1.1.9.8.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.9.8.2">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.9.8.3">450560</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.9.8.4">100%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.9.8.5">100%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.9.8.6">98.8%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.9.8.7">99.4%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.10.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T4.1.1.10.9.1" rowspan="6"><span class="ltx_text" id="S5.T4.1.1.10.9.1.1">Basketball</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.10.9.2" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.10.9.2.1">GPT-J-6B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.10.9.3">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.10.9.4">4939200</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.10.9.5">98.6%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.10.9.6">94.6%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.10.9.7">93.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.10.9.8">93.9%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.11.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.11.10.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.11.10.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.11.10.3">87.9%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.11.10.4">81.5%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.11.10.5">79.9%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.11.10.6">80.1%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.12.11">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.12.11.1" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.12.11.1.1">Mistral-7B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.12.11.2">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.12.11.3">11289600</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.12.11.4">96.6%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.12.11.5">93.2%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.12.11.6">87.6%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.12.11.7">90.2%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.13.12">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.13.12.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.13.12.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.13.12.3">96.2%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.13.12.4">96.3%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.13.12.5">88.0%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.13.12.6">91.8%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.14.13">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.14.13.1" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.14.13.1.1">Qwen-7B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.14.13.2">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.14.13.3">11289600</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.14.13.4">96.3%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.14.13.5">93.3%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.14.13.6">87.8%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.14.13.7">90.4%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.15.14">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.15.14.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.15.14.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.15.14.3">94.3%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.15.14.4">89.7%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.15.14.5">85.1%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.15.14.6">87.1%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.16.15">
<th class="ltx_td ltx_th ltx_th_row ltx_border_l ltx_border_r" id="S5.T4.1.1.16.15.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.16.15.2" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.16.15.2.1">SFR-Embedding-Mistral</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.16.15.3">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.16.15.4">12390400</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.16.15.5">100.0%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.16.15.6">99.8%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.16.15.7">99.5%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.16.15.8">99.1%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.17.16">
<th class="ltx_td ltx_th ltx_th_row ltx_border_l ltx_border_r" id="S5.T4.1.1.17.16.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.17.16.2">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.17.16.3">450560</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.17.16.4">99.9%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.17.16.5">100%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.17.16.6">98.8%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.17.16.7">99.4%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.18.17">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T4.1.1.18.17.1" rowspan="6"><span class="ltx_text" id="S5.T4.1.1.18.17.1.1">Book</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.18.17.2" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.18.17.2.1">GPT-J-6B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.18.17.3">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.18.17.4">4939200</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.18.17.5">98.6%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.18.17.6">97.1%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.18.17.7">89.9%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.18.17.8">93.3%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.19.18">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.19.18.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.19.18.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.19.18.3">92.5%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.19.18.4">94.5%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.19.18.5">83.8%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.19.18.6">88.8%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.20.19">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.20.19.1" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.20.19.1.1">Mistral-7B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.20.19.2">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.20.19.3">11289600</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.20.19.4">96.6%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.20.19.5">87.2%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.20.19.6">95.0%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.20.19.7">90.8%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.21.20">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.21.20.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.21.20.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.21.20.3">97.8%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.21.20.4">91.5%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.21.20.5">91.7%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.21.20.6">91.4%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.22.21">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.22.21.1" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.22.21.1.1">Qwen-7B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.22.21.2">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.22.21.3">11289600</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.22.21.4">91.3%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.22.21.5">85.2%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.22.21.6">82.5%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.22.21.7">83.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.23.22">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.23.22.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.23.22.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.23.22.3">86.4%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.23.22.4">81.8%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.23.22.5">78.6%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.23.22.6">79.9%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.24.23">
<th class="ltx_td ltx_th ltx_th_row ltx_border_l ltx_border_r" id="S5.T4.1.1.24.23.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.24.23.2" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.24.23.2.1">SFR-Embedding-Mistral</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.24.23.3">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.24.23.4">12390400</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.24.23.5">100%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.24.23.6">100%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.24.23.7">99.4%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.24.23.8">99.7%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.25.24">
<th class="ltx_td ltx_th ltx_th_row ltx_border_l ltx_border_r" id="S5.T4.1.1.25.24.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.25.24.2">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.25.24.3">450560</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.25.24.4">99.9%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.25.24.5">99.4%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.25.24.6">98.9%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.25.24.7">99.1%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.26.25">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S5.T4.1.1.26.25.1" rowspan="6"><span class="ltx_text" id="S5.T4.1.1.26.25.1.1">Nobel winners</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.26.25.2" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.26.25.2.1">GPT-J-6B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.26.25.3">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.26.25.4">4939200</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.26.25.5">99.9%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.26.25.6">97.9%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.26.25.7">99.4%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.26.25.8">98.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.27.26">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.27.26.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.27.26.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.27.26.3">95.8%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.27.26.4">92.2%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.27.26.5">85.8%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.27.26.6">88.8%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.28.27">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.28.27.1" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.28.27.1.1">Mistral-7B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.28.27.2">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.28.27.3">11289600</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.28.27.4">96.6%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.28.27.5">93.9%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.28.27.6">89.4%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.28.27.7">91.6%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.29.28">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.29.28.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.29.28.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.29.28.3">99.2%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.29.28.4">94.9%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.29.28.5">96.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.29.28.6">95.5%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.30.29">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.30.29.1" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.30.29.1.1">Qwen-7B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.30.29.2">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.30.29.3">11289600</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.30.29.4">98.7%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.30.29.5">94.8%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.30.29.6">94.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.30.29.7">94.5%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.31.30">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.31.30.1">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T4.1.1.31.30.2">430080</th>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.31.30.3">94.1%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.31.30.4">88.5%</td>
<td class="ltx_td ltx_align_center" id="S5.T4.1.1.31.30.5">82.3%</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S5.T4.1.1.31.30.6">85.1%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.32.31">
<th class="ltx_td ltx_th ltx_th_row ltx_border_l ltx_border_r" id="S5.T4.1.1.32.31.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b ltx_border_r ltx_border_t" id="S5.T4.1.1.32.31.2" rowspan="2"><span class="ltx_text" id="S5.T4.1.1.32.31.2.1">SFR-Embedding-Mistral</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.32.31.3">SATe</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T4.1.1.32.31.4">12390400</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.32.31.5">99.9%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.32.31.6">99.2%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T4.1.1.32.31.7">96.7%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T4.1.1.32.31.8">97.9%</td>
</tr>
<tr class="ltx_tr" id="S5.T4.1.1.33.32">
<th class="ltx_td ltx_th ltx_th_row ltx_border_b ltx_border_l ltx_border_r" id="S5.T4.1.1.33.32.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b ltx_border_r" id="S5.T4.1.1.33.32.2">ACT</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b ltx_border_r" id="S5.T4.1.1.33.32.3">450560</th>
<td class="ltx_td ltx_align_center ltx_border_b" id="S5.T4.1.1.33.32.4">99.9%</td>
<td class="ltx_td ltx_align_center ltx_border_b" id="S5.T4.1.1.33.32.5">100%</td>
<td class="ltx_td ltx_align_center ltx_border_b" id="S5.T4.1.1.33.32.6">97.7%</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r" id="S5.T4.1.1.33.32.7">98.8%</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS2.SSS1.p4">
<p class="ltx_p" id="S5.SS2.SSS1.p4.1"><span class="ltx_text ltx_font_bold" id="S5.SS2.SSS1.p4.1.1">GGPP vs â€œjailbreakâ€ methods.</span> We also adapt two methods originally developed to â€œjailbreakâ€ LLMs to the RAG setting and compare them with GGPP: Greedy Coordinate Gradient (GCG)Â <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib11" title="">zou2023universal, </a>)</cite> (with MSE loss between query and target passage embeddings being used) and Universal Adversarial Trigger (UAT)Â <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#bib.bib10" title="">wallace2019universal, </a>)</cite>. Table <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S5.T3" title="Table 3 â€£ 5.2.1. Prompt perturbation â€£ 5.2. Results â€£ 5. Experiments â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">3</span></a> shows the results obtained with Mistrial-7B, highlighting GGPPâ€™s superior perturbation performance in terms of both top-1 and top-10 success rates. Similar results are observed with other embedding models.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS2.SSS1.p5">
<p class="ltx_p" id="S5.SS2.SSS1.p5.8"><span class="ltx_text ltx_font_bold" id="S5.SS2.SSS1.p5.1.1">Effect of prefix Initialization and <math alttext="\lambda" class="ltx_Math" display="inline" id="S5.SS2.SSS1.p5.1.1.m1.1"><semantics id="S5.SS2.SSS1.p5.1.1.m1.1a"><mi id="S5.SS2.SSS1.p5.1.1.m1.1.1" xref="S5.SS2.SSS1.p5.1.1.m1.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS1.p5.1.1.m1.1b"><ci id="S5.SS2.SSS1.p5.1.1.m1.1.1.cmml" xref="S5.SS2.SSS1.p5.1.1.m1.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS1.p5.1.1.m1.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS1.p5.1.1.m1.1d">italic_Î»</annotation></semantics></math>.</span> To validate the effectiveness of our prefix initialization method during prompt perturbation, we track the L2 distance between the currently generated vector and the target vector (corresponding to the target passage) throughout the optimization process. We then compare the descent curves of the distances with and without the prefix initialization operation. We set <math alttext="\lambda" class="ltx_Math" display="inline" id="S5.SS2.SSS1.p5.2.m1.1"><semantics id="S5.SS2.SSS1.p5.2.m1.1a"><mi id="S5.SS2.SSS1.p5.2.m1.1.1" xref="S5.SS2.SSS1.p5.2.m1.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS1.p5.2.m1.1b"><ci id="S5.SS2.SSS1.p5.2.m1.1.1.cmml" xref="S5.SS2.SSS1.p5.2.m1.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS1.p5.2.m1.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS1.p5.2.m1.1d">italic_Î»</annotation></semantics></math> in the loss function to 0 in this experiment to show how fast the vector moves to the target. FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S5.F7" title="Figure 7 â€£ 5.2.1. Prompt perturbation â€£ 5.2. Results â€£ 5. Experiments â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">7</span></a> shows the distance change over the iteration process for a single query (with Mistral-7B on the Nobel winners dataset). With the prefix initialization, the distance drops more quickly. This suggests that the initialization strategy successfully shortens the search paths and the training time required to generate an adversarial prefix. We also examine the impact of <math alttext="\lambda" class="ltx_Math" display="inline" id="S5.SS2.SSS1.p5.3.m2.1"><semantics id="S5.SS2.SSS1.p5.3.m2.1a"><mi id="S5.SS2.SSS1.p5.3.m2.1.1" xref="S5.SS2.SSS1.p5.3.m2.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS1.p5.3.m2.1b"><ci id="S5.SS2.SSS1.p5.3.m2.1.1.cmml" xref="S5.SS2.SSS1.p5.3.m2.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS1.p5.3.m2.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS1.p5.3.m2.1d">italic_Î»</annotation></semantics></math> on perturbation. TableÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.T5" title="Table 5 â€£ A.1. Impact of ğœ† on perturbation â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">5</span></a> in AppendixÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS1" title="A.1. Impact of ğœ† on perturbation â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">A.1</span></a> shows the results obtained with Mistral-7B on the IMDB dataset. The success rates reach their peak at a <math alttext="\lambda" class="ltx_Math" display="inline" id="S5.SS2.SSS1.p5.4.m3.1"><semantics id="S5.SS2.SSS1.p5.4.m3.1a"><mi id="S5.SS2.SSS1.p5.4.m3.1.1" xref="S5.SS2.SSS1.p5.4.m3.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS1.p5.4.m3.1b"><ci id="S5.SS2.SSS1.p5.4.m3.1.1.cmml" xref="S5.SS2.SSS1.p5.4.m3.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS1.p5.4.m3.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS1.p5.4.m3.1d">italic_Î»</annotation></semantics></math> of 0.5 and decline as <math alttext="\lambda" class="ltx_Math" display="inline" id="S5.SS2.SSS1.p5.5.m4.1"><semantics id="S5.SS2.SSS1.p5.5.m4.1a"><mi id="S5.SS2.SSS1.p5.5.m4.1.1" xref="S5.SS2.SSS1.p5.5.m4.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS1.p5.5.m4.1b"><ci id="S5.SS2.SSS1.p5.5.m4.1.1.cmml" xref="S5.SS2.SSS1.p5.5.m4.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS1.p5.5.m4.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS1.p5.5.m4.1d">italic_Î»</annotation></semantics></math> increases due to an imbalance in distance differences between <math alttext="\mathbf{e}" class="ltx_Math" display="inline" id="S5.SS2.SSS1.p5.6.m5.1"><semantics id="S5.SS2.SSS1.p5.6.m5.1a"><mi id="S5.SS2.SSS1.p5.6.m5.1.1" xref="S5.SS2.SSS1.p5.6.m5.1.1.cmml">ğ</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS1.p5.6.m5.1b"><ci id="S5.SS2.SSS1.p5.6.m5.1.1.cmml" xref="S5.SS2.SSS1.p5.6.m5.1.1">ğ</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS1.p5.6.m5.1c">\mathbf{e}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS1.p5.6.m5.1d">bold_e</annotation></semantics></math> and <math alttext="\mathbf{e^{\prime}}" class="ltx_Math" display="inline" id="S5.SS2.SSS1.p5.7.m6.1"><semantics id="S5.SS2.SSS1.p5.7.m6.1a"><msup id="S5.SS2.SSS1.p5.7.m6.1.1" xref="S5.SS2.SSS1.p5.7.m6.1.1.cmml"><mi id="S5.SS2.SSS1.p5.7.m6.1.1.2" xref="S5.SS2.SSS1.p5.7.m6.1.1.2.cmml">ğ</mi><mo id="S5.SS2.SSS1.p5.7.m6.1.1.3" xref="S5.SS2.SSS1.p5.7.m6.1.1.3.cmml">â€²</mo></msup><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS1.p5.7.m6.1b"><apply id="S5.SS2.SSS1.p5.7.m6.1.1.cmml" xref="S5.SS2.SSS1.p5.7.m6.1.1"><csymbol cd="ambiguous" id="S5.SS2.SSS1.p5.7.m6.1.1.1.cmml" xref="S5.SS2.SSS1.p5.7.m6.1.1">superscript</csymbol><ci id="S5.SS2.SSS1.p5.7.m6.1.1.2.cmml" xref="S5.SS2.SSS1.p5.7.m6.1.1.2">ğ</ci><ci id="S5.SS2.SSS1.p5.7.m6.1.1.3.cmml" xref="S5.SS2.SSS1.p5.7.m6.1.1.3">â€²</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS1.p5.7.m6.1c">\mathbf{e^{\prime}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS1.p5.7.m6.1d">bold_e start_POSTSUPERSCRIPT â€² end_POSTSUPERSCRIPT</annotation></semantics></math>. Conversely, a very small <math alttext="\lambda" class="ltx_Math" display="inline" id="S5.SS2.SSS1.p5.8.m7.1"><semantics id="S5.SS2.SSS1.p5.8.m7.1a"><mi id="S5.SS2.SSS1.p5.8.m7.1.1" xref="S5.SS2.SSS1.p5.8.m7.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS1.p5.8.m7.1b"><ci id="S5.SS2.SSS1.p5.8.m7.1.1.cmml" xref="S5.SS2.SSS1.p5.8.m7.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS1.p5.8.m7.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS1.p5.8.m7.1d">italic_Î»</annotation></semantics></math> (e.g., 0.1) diminishes the influence of the second part of the loss function and fails to maintain distance balance.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S5.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.2.2. </span>Perturbation Detection</h4>
<div class="ltx_para" id="S5.SS2.SSS2.p1">
<p class="ltx_p" id="S5.SS2.SSS2.p1.1">To evaluate the detection performance, we randomly choose 100 queries along with their associated GGPP prefixes from the previous prompt perturbation experiment for each dataset. These queries and their respective prefixes are designed to retrieve target passages. Meanwhile, we randomly extract tokens from the key tokens of each queryâ€™s corresponding original passages to form prefixes of equivalent length for the control group. This ensures that the prefix in the control group does not affect the retrieval result for original passages. Therefore, for each dataset, we have a total of 200 entries. Among them, those linked with GGPP prefixes are labeled as â€1â€ while those in the control group are labeled as â€0â€. In the experiment, 60% of the entries are used for training, with the remaining 40% reserved for testing. Before training the classifier, we padding the queries to 100 tokens to maintain dimensional consistency of features. We report the performance based on the average of 10 independent runs.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS2.SSS2.p2">
<p class="ltx_p" id="S5.SS2.SSS2.p2.1"><span class="ltx_text ltx_font_bold" id="S5.SS2.SSS2.p2.1.1">Detection effectiveness.</span> TableÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#S5.T4" title="Table 4 â€£ 5.2.1. Prompt perturbation â€£ 5.2. Results â€£ 5. Experiments â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">4</span></a> shows the results, including the detection AUROC, Recall, Precision, and F1-score of both SATe and ACT probes across the four datasets and the four models. Both SATe and ACT probes demonstrate strong detection performance, with SATe probe yielding better results than ACT probe, especially when GPT-J-6B and Qwen-7B are used for embedding. On the other hand, ACT probe maintains significantly fewer parameters, making it a preferable choice when resource efficiency is a primary concern.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS2.SSS2.p3">
<p class="ltx_p" id="S5.SS2.SSS2.p3.1"><span class="ltx_text ltx_font_bold" id="S5.SS2.SSS2.p3.1.1">Detection efficiency.</span> We also conduct experiments to assess the detection efficiency of both SATe and ACT probes. The results of these experiments, conducted on an Intel(R) Xeon(R) Gold 6242 CPU, including training time and average response time (i.e., inference time), are presented in TableÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.T6" title="Table 6 â€£ A.2. GGPP perturbation detection efficiency â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">6</span></a> (AppendixÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.SS2" title="A.2. GGPP perturbation detection efficiency â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">A.2</span></a>). It is evident from the table that the ACT probe not only requires considerably less training time compared to SATe but also significantly reduces the response time for detection.</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6. </span>Conclusion</h2>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">This paper initiated the study of the robustness problem in RAG-based LLMs under prompt perturbations. We gave a gradient guided method to perturb user prompts, which resulted in the retrieval of targeted text passages containing factual errors to user queries. As RAG is considered more trustworthy than LLMs alone because the data can be curated from reliable sources, our work revealed that RAG-based LLMs can be vulnerable to perturbations in practice without much knowledge needed about the data store. Our perturbation method showed capability of bypassing instructions in prompts designed to block prompt attacks through trivial training. Moreover, the GGPP method we proposed could be used to generate prompts to enhance LLMs. We introduced two methods to detect such perturbations based on the internal states of LLMs triggered by these prompts. The detection methods can be used for guardrail construction in LLM-based services.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(1)</span>
<span class="ltx_bibblock">
S.Â Welleck, I.Â Kulikov, S.Â Roller, E.Â Dinan, K.Â Cho, and J.Â Weston, â€œNeural text generation with unlikelihood training,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">arXiv preprint arXiv:1908.04319</em>, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(2)</span>
<span class="ltx_bibblock">
G.Â Mialon, R.Â DessÃ¬, M.Â Lomeli, C.Â Nalmpantis, R.Â Pasunuru, R.Â Raileanu, B.Â RoziÃ¨re, T.Â Schick, J.Â Dwivedi-Yu, A.Â Celikyilmaz <em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">etÂ al.</em>, â€œAugmented language models: a survey,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib2.2.2">arXiv preprint arXiv:2302.07842</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(3)</span>
<span class="ltx_bibblock">
A.Â Mallen, A.Â Asai, V.Â Zhong, R.Â Das, D.Â Khashabi, and H.Â Hajishirzi, â€œWhen not to trust language models: Investigating effectiveness of parametric and non-parametric memories,â€ in <em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">Proceedings of the 61st Annual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers)</em>, 2023, pp. 9802â€“9822.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(4)</span>
<span class="ltx_bibblock">
N.Â Kandpal, H.Â Deng, A.Â Roberts, E.Â Wallace, and C.Â Raffel, â€œLarge language models struggle to learn long-tail knowledge,â€ in <em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">International Conference on Machine Learning</em>.Â Â Â PMLR, 2023, pp. 15â€‰696â€“15â€‰707.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(5)</span>
<span class="ltx_bibblock">
N.Â F. Liu, K.Â Lin, J.Â Hewitt, A.Â Paranjape, M.Â Bevilacqua, F.Â Petroni, and P.Â Liang, â€œLost in the middle: How language models use long contexts,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">arXiv preprint arXiv:2307.03172</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(6)</span>
<span class="ltx_bibblock">
I.Â J. Goodfellow, J.Â Shlens, and C.Â Szegedy, â€œExplaining and harnessing adversarial examples,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">arXiv preprint arXiv:1412.6572</em>, 2014.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(7)</span>
<span class="ltx_bibblock">
C.Â Szegedy, W.Â Zaremba, I.Â Sutskever, J.Â Bruna, D.Â Erhan, I.Â Goodfellow, and R.Â Fergus, â€œIntriguing properties of neural networks,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">arXiv preprint arXiv:1312.6199</em>, 2013.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(8)</span>
<span class="ltx_bibblock">
J.Â Wang, X.Â Hu, W.Â Hou, H.Â Chen, R.Â Zheng, Y.Â Wang, L.Â Yang, H.Â Huang, W.Â Ye, X.Â Geng <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">etÂ al.</em>, â€œOn the robustness of chatgpt: An adversarial and out-of-distribution perspective,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib8.2.2">arXiv preprint arXiv:2302.12095</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(9)</span>
<span class="ltx_bibblock">
J.Â Ebrahimi, A.Â Rao, D.Â Lowd, and D.Â Dou, â€œHotflip: White-box adversarial examples for text classification,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">arXiv preprint arXiv:1712.06751</em>, 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(10)</span>
<span class="ltx_bibblock">
E.Â Wallace, S.Â Feng, N.Â Kandpal, M.Â Gardner, and S.Â Singh, â€œUniversal adversarial triggers for attacking and analyzing nlp,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">arXiv preprint arXiv:1908.07125</em>, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(11)</span>
<span class="ltx_bibblock">
A.Â Zou, Z.Â Wang, J.Â Z. Kolter, and M.Â Fredrikson, â€œUniversal and transferable adversarial attacks on aligned language models,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">arXiv preprint arXiv:2307.15043</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(12)</span>
<span class="ltx_bibblock">
P.Â Lewis, E.Â Perez, A.Â Piktus, F.Â Petroni, V.Â Karpukhin, N.Â Goyal, H.Â KÃ¼ttler, M.Â Lewis, W.-t. Yih, T.Â RocktÃ¤schel <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">etÂ al.</em>, â€œRetrieval-augmented generation for knowledge-intensive nlp tasks,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib12.2.2">Advances in Neural Information Processing Systems</em>, vol.Â 33, pp. 9459â€“9474, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(13)</span>
<span class="ltx_bibblock">
S.Â Borgeaud, A.Â Mensch, J.Â Hoffmann, T.Â Cai, E.Â Rutherford, K.Â Millican, G.Â B. Van DenÂ Driessche, J.-B. Lespiau, B.Â Damoc, A.Â Clark <em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">etÂ al.</em>, â€œImproving language models by retrieving from trillions of tokens,â€ in <em class="ltx_emph ltx_font_italic" id="bib.bib13.2.2">International conference on machine learning</em>.Â Â Â PMLR, 2022, pp. 2206â€“2240.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(14)</span>
<span class="ltx_bibblock">
J.Â Lin, R.Â Pradeep, T.Â Teofili, and J.Â Xian, â€œVector search with openai embeddings: Lucene is all you need,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">arXiv preprint arXiv:2308.14963</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(15)</span>
<span class="ltx_bibblock">
K.Â Zhu, J.Â Wang, J.Â Zhou, Z.Â Wang, H.Â Chen, Y.Â Wang, L.Â Yang, W.Â Ye, N.Â Z. Gong, Y.Â Zhang <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">etÂ al.</em>, â€œPromptbench: Towards evaluating the robustness of large language models on adversarial prompts,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib15.2.2">arXiv preprint arXiv:2306.04528</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(16)</span>
<span class="ltx_bibblock">
A.Â Lazaridou, A.Â Kuncoro, E.Â Gribovskaya, D.Â Agrawal, A.Â Liska, T.Â Terzi, M.Â Gimenez, C.Â deÂ MassonÂ dâ€™Autume, T.Â Kocisky, S.Â Ruder <em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">etÂ al.</em>, â€œMind the gap: Assessing temporal generalization in neural language models,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib16.2.2">Advances in Neural Information Processing Systems</em>, vol.Â 34, pp. 29â€‰348â€“29â€‰363, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(17)</span>
<span class="ltx_bibblock">
T.Â Rebedea, R.Â Dinu, M.Â Sreedhar, C.Â Parisien, and J.Â Cohen, â€œNemo guardrails: A toolkit for controllable and safe llm applications with programmable rails,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">arXiv preprint arXiv:2310.10501</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(18)</span>
<span class="ltx_bibblock">
M.Â Yuksekgonul, V.Â Chandrasekaran, E.Â Jones, S.Â Gunasekar, R.Â Naik, H.Â Palangi, E.Â Kamar, and B.Â Nushi, â€œAttention satisfies: A constraint-satisfaction lens on factual errors of language models,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">arXiv preprint arXiv:2309.15098</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(19)</span>
<span class="ltx_bibblock">
B.Â Wang and A.Â Komatsuzaki, â€œGpt-j-6b: A 6 billion parameter autoregressive language model.â€ <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/kingoflolz/mesh-transformer-jax" title="">https://github.com/kingoflolz/mesh-transformer-jax</a>, May 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(20)</span>
<span class="ltx_bibblock">
A.Â Q. Jiang, A.Â Sablayrolles, A.Â Mensch, C.Â Bamford, D.Â S. Chaplot, D.Â d.Â l. Casas, F.Â Bressand, G.Â Lengyel, G.Â Lample, L.Â Saulnier <em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">etÂ al.</em>, â€œMistral 7b,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib20.2.2">arXiv preprint arXiv:2310.06825</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(21)</span>
<span class="ltx_bibblock">
J.Â Bai, S.Â Bai, Y.Â Chu, Z.Â Cui, K.Â Dang, X.Â Deng, Y.Â Fan, W.Â Ge, Y.Â Han, F.Â Huang <em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">etÂ al.</em>, â€œQwen technical report,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib21.2.2">arXiv preprint arXiv:2309.16609</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(22)</span>
<span class="ltx_bibblock">
Rui Meng, Ye Liu, Shafiq Rayhan Joty, Caiming Xiong, Yingbo Zhou, Semih Yavuz, â€œSfr-embedding-mistral:enhance text retrieval with transfer learning,â€ Salesforce AI Research Blog, 2024. [Online]. Available: <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://blog.salesforceairesearch.com/sfr-embedded-mistral/" title="">https://blog.salesforceairesearch.com/sfr-embedded-mistral/</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(23)</span>
<span class="ltx_bibblock">
A.Â Vaswani, N.Â Shazeer, N.Â Parmar, J.Â Uszkoreit, L.Â Jones, A.Â N. Gomez, Å.Â Kaiser, and I.Â Polosukhin, â€œAttention is all you need,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">Advances in neural information processing systems</em>, vol.Â 30, 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(24)</span>
<span class="ltx_bibblock">
K.Â Meng, D.Â Bau, A.Â Andonian, and Y.Â Belinkov, â€œLocating and editing factual associations in gpt,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">Advances in Neural Information Processing Systems</em>, vol.Â 35, pp. 17â€‰359â€“17â€‰372, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(25)</span>
<span class="ltx_bibblock">
M.Â Geva, J.Â Bastings, K.Â Filippova, and A.Â Globerson, â€œDissecting recall of factual associations in auto-regressive language models,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">arXiv preprint arXiv:2304.14767</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(26)</span>
<span class="ltx_bibblock">
D.Â Ganguli, D.Â Hernandez, L.Â Lovitt, A.Â Askell, Y.Â Bai, A.Â Chen, T.Â Conerly, N.Â Dassarma, D.Â Drain, N.Â Elhage <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">etÂ al.</em>, â€œPredictability and surprise in large generative models,â€ in <em class="ltx_emph ltx_font_italic" id="bib.bib26.2.2">Proceedings of the 2022 ACM Conference on Fairness, Accountability, and Transparency</em>, 2022, pp. 1747â€“1764.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(27)</span>
<span class="ltx_bibblock">
E.Â Mitchell, C.Â Lin, A.Â Bosselut, C.Â D. Manning, and C.Â Finn, â€œMemory-based model editing at scale,â€ in <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">International Conference on Machine Learning</em>.Â Â Â PMLR, 2022, pp. 15â€‰817â€“15â€‰831.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(28)</span>
<span class="ltx_bibblock">
J.Â X. Morris, E.Â Lifland, J.Â Y. Yoo, and Y.Â Qi, â€œTextattack: A framework for adversarial attacks in natural language processing,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">Proceedings of the 2020 EMNLP, Arvix</em>, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(29)</span>
<span class="ltx_bibblock">
D.Â Jin, Z.Â Jin, J.Â T. Zhou, and P.Â Szolovits, â€œIs bert really robust? a strong baseline for natural language attack on text classification and entailment,â€ in <em class="ltx_emph ltx_font_italic" id="bib.bib29.1.1">Proceedings of the AAAI conference on artificial intelligence</em>, vol.Â 34, no.Â 05, 2020, pp. 8018â€“8025.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(30)</span>
<span class="ltx_bibblock">
B.Â Liu, B.Â Xiao, X.Â Jiang, S.Â Cen, X.Â He, W.Â Dou <em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">etÂ al.</em>, â€œAdversarial attacks on large language model-based system and mitigating strategies: A case study on chatgpt,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib30.2.2">Security and Communication Networks</em>, vol. 2023, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(31)</span>
<span class="ltx_bibblock">
C.Â Guo, A.Â Sablayrolles, H.Â JÃ©gou, and D.Â Kiela, â€œGradient-based adversarial attacks against text transformers,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib31.1.1">arXiv preprint arXiv:2104.13733</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(32)</span>
<span class="ltx_bibblock">
J.Â Wei, X.Â Wang, D.Â Schuurmans, M.Â Bosma, F.Â Xia, E.Â Chi, Q.Â V. Le, D.Â Zhou <em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">etÂ al.</em>, â€œChain-of-thought prompting elicits reasoning in large language models,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib32.2.2">Advances in Neural Information Processing Systems</em>, vol.Â 35, pp. 24â€‰824â€“24â€‰837, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(33)</span>
<span class="ltx_bibblock">
R.Â Taylor, M.Â Kardas, G.Â Cucurull, T.Â Scialom, A.Â Hartshorn, E.Â Saravia, A.Â Poulton, V.Â Kerkez, and R.Â Stojnic, â€œGalactica: A large language model for science,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib33.1.1">arXiv preprint arXiv:2211.09085</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(34)</span>
<span class="ltx_bibblock">
K.Â Yang, Y.Â Tian, N.Â Peng, and D.Â Klein, â€œRe3: Generating longer stories with recursive reprompting and revision,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">arXiv preprint arXiv:2210.06774</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(35)</span>
<span class="ltx_bibblock">
Y.Â A. Malkov and D.Â A. Yashunin, â€œEfficient and robust approximate nearest neighbor search using hierarchical navigable small world graphs,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">IEEE transactions on pattern analysis and machine intelligence</em>, vol.Â 42, no.Â 4, pp. 824â€“836, 2018.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(36)</span>
<span class="ltx_bibblock">
F.Â Shi, X.Â Chen, K.Â Misra, N.Â Scales, D.Â Dohan, E.Â H. Chi, N.Â SchÃ¤rli, and D.Â Zhou, â€œLarge language models can be easily distracted by irrelevant context,â€ in <em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">International Conference on Machine Learning</em>.Â Â Â PMLR, 2023, pp. 31â€‰210â€“31â€‰227.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(37)</span>
<span class="ltx_bibblock">
N.Â Muennighoff, N.Â Tazi, L.Â Magne, and N.Â Reimers, â€œMteb: Massive text embedding benchmark,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib37.1.1">arXiv preprint arXiv:2210.07316</em>, 2022. [Online]. Available: <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2210.07316" title="">https://arxiv.org/abs/2210.07316</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(38)</span>
<span class="ltx_bibblock">
R.Â Pradeep, K.Â Hui, J.Â Gupta, A.Â Lelkes, H.Â Zhuang, J.Â Lin, D.Â Metzler, and V.Â Tran, â€œHow does generative retrieval scale to millions of passages?â€ in <em class="ltx_emph ltx_font_italic" id="bib.bib38.1.1">Proceedings of the 2023 Conference on Empirical Methods in Natural Language Processing</em>, H.Â Bouamor, J.Â Pino, and K.Â Bali, Eds.Â Â Â Singapore: Association for Computational Linguistics, Dec. 2023, pp. 1305â€“1321. [Online]. Available: <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2023.emnlp-main.83" title="">https://aclanthology.org/2023.emnlp-main.83</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(39)</span>
<span class="ltx_bibblock">
A.Â Gupta, A.Â Shirgaonkar, A.Â d.Â L. Balaguer, B.Â Silva, D.Â Holstein, D.Â Li, J.Â Marsman, L.Â O. Nunes, M.Â Rouzbahman, M.Â Sharp <em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">etÂ al.</em>, â€œRag vs fine-tuning: Pipelines, tradeoffs, and a case study on agriculture,â€ <em class="ltx_emph ltx_font_italic" id="bib.bib39.2.2">arXiv preprint arXiv:2401.08406</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(40)</span>
<span class="ltx_bibblock">
IMDb, â€œImdb datasets,â€ 2023, accessed: 2023-11-20. [Online]. Available: <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://developer.imdb.com/non-commercial-datasets/" title="">https://developer.imdb.com/non-commercial-datasets/</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(41)</span>
<span class="ltx_bibblock">
Wikipedia Contributors, â€œWikipedia, the free encyclopedia,â€ 2023, accessed: 2023-11-20. [Online]. Available: <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.wikipedia.org" title="">https://www.wikipedia.org</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(42)</span>
<span class="ltx_bibblock">
Opendatasoft, â€œnobel prize,â€ <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://public.opendatasoft.com/explore/dataset/nobel-prize-laureates" title="">https://public.opendatasoft.com/explore/dataset/nobel-prize-laureates</a>, 2023, accessed: 2023-11-20.

</span>
</li>
</ul>
</section>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Appendix</h2>
<section class="ltx_subsection" id="A1.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.1. </span>Impact of <math alttext="\lambda" class="ltx_Math" display="inline" id="A1.SS1.1.m1.1"><semantics id="A1.SS1.1.m1.1b"><mi id="A1.SS1.1.m1.1.1" xref="A1.SS1.1.m1.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.1.m1.1c"><ci id="A1.SS1.1.m1.1.1.cmml" xref="A1.SS1.1.m1.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.1.m1.1d">\lambda</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.1.m1.1e">italic_Î»</annotation></semantics></math> on perturbation</h3>
<figure class="ltx_table" id="A1.T5">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 5. </span>Impact of <math alttext="\lambda" class="ltx_Math" display="inline" id="A1.T5.2.m1.1"><semantics id="A1.T5.2.m1.1b"><mi id="A1.T5.2.m1.1.1" xref="A1.T5.2.m1.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="A1.T5.2.m1.1c"><ci id="A1.T5.2.m1.1.1.cmml" xref="A1.T5.2.m1.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T5.2.m1.1d">\lambda</annotation><annotation encoding="application/x-llamapun" id="A1.T5.2.m1.1e">italic_Î»</annotation></semantics></math> on perturbation (results were obtained with Mistral-7B on IMDB).</figcaption>
<div class="ltx_inline-block ltx_align_left ltx_transformed_outer" id="A1.T5.3" style="width:288.4pt;height:79.2pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(13.1pt,-3.6pt) scale(1.1,1.1) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="A1.T5.3.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A1.T5.3.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="A1.T5.3.1.1.2" rowspan="2"><span class="ltx_text" id="A1.T5.3.1.1.2.1">Success rate</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_t" colspan="5" id="A1.T5.3.1.1.1"><math alttext="\lambda" class="ltx_Math" display="inline" id="A1.T5.3.1.1.1.m1.1"><semantics id="A1.T5.3.1.1.1.m1.1a"><mi id="A1.T5.3.1.1.1.m1.1.1" xref="A1.T5.3.1.1.1.m1.1.1.cmml">Î»</mi><annotation-xml encoding="MathML-Content" id="A1.T5.3.1.1.1.m1.1b"><ci id="A1.T5.3.1.1.1.m1.1.1.cmml" xref="A1.T5.3.1.1.1.m1.1.1">ğœ†</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T5.3.1.1.1.m1.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="A1.T5.3.1.1.1.m1.1d">italic_Î»</annotation></semantics></math></th>
</tr>
<tr class="ltx_tr" id="A1.T5.3.1.2.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="A1.T5.3.1.2.1.1">0.1</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="A1.T5.3.1.2.1.2">0.5</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="A1.T5.3.1.2.1.3">1.0</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="A1.T5.3.1.2.1.4">1.5</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_t" id="A1.T5.3.1.2.1.5">2.0</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A1.T5.3.1.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="A1.T5.3.1.3.1.1">top-1</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T5.3.1.3.1.2">37.4%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T5.3.1.3.1.3">40.1%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T5.3.1.3.1.4">30.6%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T5.3.1.3.1.5">21.9%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A1.T5.3.1.3.1.6">16.6%</td>
</tr>
<tr class="ltx_tr" id="A1.T5.3.1.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b ltx_border_l ltx_border_r" id="A1.T5.3.1.4.2.1">top-10</th>
<td class="ltx_td ltx_align_center ltx_border_b" id="A1.T5.3.1.4.2.2">43.2%</td>
<td class="ltx_td ltx_align_center ltx_border_b" id="A1.T5.3.1.4.2.3">51.5%</td>
<td class="ltx_td ltx_align_center ltx_border_b" id="A1.T5.3.1.4.2.4">41.6%</td>
<td class="ltx_td ltx_align_center ltx_border_b" id="A1.T5.3.1.4.2.5">27.1%</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r" id="A1.T5.3.1.4.2.6">20.7%</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section class="ltx_subsection" id="A1.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.2. </span>GGPP perturbation detection efficiency</h3>
<div class="ltx_para" id="A1.SS2.p1">
<p class="ltx_p" id="A1.SS2.p1.1">We run the probes SATe and ACT 10 times and average their training and response time (in ms). Comparing to SATe, ACT significantly reduces
the training and response time for detection.</p>
</div>
<figure class="ltx_table" id="A1.T6">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 6. </span>GGPP perturbation detection efficiency.</figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="A1.T6.1" style="width:281.6pt;height:145.8pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-15.6pt,8.1pt) scale(0.9,0.9) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="A1.T6.1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A1.T6.1.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="A1.T6.1.1.1.1.1">Model</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_t" id="A1.T6.1.1.1.1.2">Method</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="A1.T6.1.1.1.1.3">response time</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_t" id="A1.T6.1.1.1.1.4">training time</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A1.T6.1.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="A1.T6.1.1.2.1.1" rowspan="2"><span class="ltx_text" id="A1.T6.1.1.2.1.1.1">Mistral-7B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A1.T6.1.1.2.1.2">SATe</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T6.1.1.2.1.3">58.5 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A1.T6.1.1.2.1.4">182004.1 ms</td>
</tr>
<tr class="ltx_tr" id="A1.T6.1.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A1.T6.1.1.3.2.1">ACT</th>
<td class="ltx_td ltx_align_center" id="A1.T6.1.1.3.2.2">2.4 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A1.T6.1.1.3.2.3">4438.3 ms</td>
</tr>
<tr class="ltx_tr" id="A1.T6.1.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="A1.T6.1.1.4.3.1" rowspan="2"><span class="ltx_text" id="A1.T6.1.1.4.3.1.1">GPT-J-6B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A1.T6.1.1.4.3.2">SATe</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T6.1.1.4.3.3">19.0 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A1.T6.1.1.4.3.4">81120.5 ms</td>
</tr>
<tr class="ltx_tr" id="A1.T6.1.1.5.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A1.T6.1.1.5.4.1">ACT</th>
<td class="ltx_td ltx_align_center" id="A1.T6.1.1.5.4.2">0.9 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A1.T6.1.1.5.4.3">4006.1 ms</td>
</tr>
<tr class="ltx_tr" id="A1.T6.1.1.6.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="A1.T6.1.1.6.5.1" rowspan="2"><span class="ltx_text" id="A1.T6.1.1.6.5.1.1">Qwen-7B</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A1.T6.1.1.6.5.2">SATe</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T6.1.1.6.5.3">61.1 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A1.T6.1.1.6.5.4">186402.1 ms</td>
</tr>
<tr class="ltx_tr" id="A1.T6.1.1.7.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A1.T6.1.1.7.6.1">ACT</th>
<td class="ltx_td ltx_align_center" id="A1.T6.1.1.7.6.2">2.4 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A1.T6.1.1.7.6.3">5693.1 ms</td>
</tr>
<tr class="ltx_tr" id="A1.T6.1.1.8.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b ltx_border_l ltx_border_r ltx_border_t" id="A1.T6.1.1.8.7.1" rowspan="2"><span class="ltx_text" id="A1.T6.1.1.8.7.1.1">SFR-Embedding-Mistral</span></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A1.T6.1.1.8.7.2">SATe</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T6.1.1.8.7.3">71.1 ms</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A1.T6.1.1.8.7.4">213578.1 ms</td>
</tr>
<tr class="ltx_tr" id="A1.T6.1.1.9.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b" id="A1.T6.1.1.9.8.1">ACT</th>
<td class="ltx_td ltx_align_center ltx_border_b" id="A1.T6.1.1.9.8.2">3.2 ms</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r" id="A1.T6.1.1.9.8.3">5447.2 ms</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section class="ltx_subsection" id="A1.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.3. </span>Example prompts and passages</h3>
<div class="ltx_para" id="A1.SS3.p1">
<p class="ltx_p" id="A1.SS3.p1.1">FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F8" title="Figure 8 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">8</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F9" title="Figure 9 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">9</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F10" title="Figure 10 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">10</span></a>, and <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F11" title="Figure 11 â€£ A.3. Example prompts and passages â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">11</span></a> list example prompts and passages for IMDB, Basketball, Books, and Nobel winners datasets, respectively. In addition, GGPP prefixes for these examples are provided when using Mistral-7B for embedding.</p>
<div class="ltx_pagination ltx_role_newpage"></div>
</div>
<figure class="ltx_figure" id="A1.F8"><img alt="Refer to caption" class="ltx_graphics ltx_align_right ltx_img_landscape" height="193" id="A1.F8.g1" src="x8.png" width="830"/>
<figcaption class="ltx_caption ltx_align_right"><span class="ltx_tag ltx_tag_figure">Figure 8. </span>Example GGPP prefix (on Mistral-7b-v0.1), user query and passages (incl. both original and targeted passages) for the IMDB (primary professions) dataset.</figcaption>
</figure>
<figure class="ltx_figure" id="A1.F9"><img alt="Refer to caption" class="ltx_graphics ltx_align_right ltx_img_landscape" height="193" id="A1.F9.g1" src="x9.png" width="830"/>
<figcaption class="ltx_caption ltx_align_right"><span class="ltx_tag ltx_tag_figure">Figure 9. </span>Example GGPP prefix (on Mistral-7b-v0.1), user query and passages (incl. both original and targeted passages) for the Basketball Players (honors the players get) dataset.</figcaption>
</figure>
<figure class="ltx_figure" id="A1.F10"><img alt="Refer to caption" class="ltx_graphics ltx_align_right ltx_img_landscape" height="193" id="A1.F10.g1" src="x10.png" width="830"/>
<figcaption class="ltx_caption ltx_align_right"><span class="ltx_tag ltx_tag_figure">Figure 10. </span>Example GGPP prefix (on Mistral-7b-v0.1), user query and passages (incl. both original and targeted passages) for the Books (written by) dataset.</figcaption>
</figure>
<figure class="ltx_figure" id="A1.F11"><img alt="Refer to caption" class="ltx_graphics ltx_align_right ltx_img_landscape" height="213" id="A1.F11.g1" src="x11.png" width="830"/>
<figcaption class="ltx_caption ltx_align_right"><span class="ltx_tag ltx_tag_figure">Figure 11. </span>Example GGPP prefix (on Mistral-7b-v0.1), user query and passages (incl. both original and targeted passages) for the Nobel winners (reasons of winnings) dataset.</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="A1.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.4. </span>Example GGPP prefixes</h3>
<div class="ltx_para" id="A1.SS4.p1">
<p class="ltx_p" id="A1.SS4.p1.1">FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F12" title="Figure 12 â€£ A.4. Example GGPP prefixes â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">12</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F13" title="Figure 13 â€£ A.4. Example GGPP prefixes â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">13</span></a>, <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F14" title="Figure 14 â€£ A.4. Example GGPP prefixes â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">14</span></a>, and <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F15" title="Figure 15 â€£ A.4. Example GGPP prefixes â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">15</span></a> provide example GGPP prefixes when using SFR-Embedding-Mistral for embedding, along with the corresponding prompts and passages.</p>
</div>
<figure class="ltx_figure" id="A1.F12"><img alt="Refer to caption" class="ltx_graphics ltx_align_right ltx_img_landscape" height="194" id="A1.F12.g1" src="x12.png" width="830"/>
<figcaption class="ltx_caption ltx_align_right"><span class="ltx_tag ltx_tag_figure">Figure 12. </span>Example GGPP prefix (on SFR-Embedding-Mistral), user query and passages (incl. both original and targeted passages) for the IMDB (primary professions) dataset.</figcaption>
</figure>
<figure class="ltx_figure" id="A1.F13"><img alt="Refer to caption" class="ltx_graphics ltx_align_right ltx_img_landscape" height="194" id="A1.F13.g1" src="x13.png" width="830"/>
<figcaption class="ltx_caption ltx_align_right"><span class="ltx_tag ltx_tag_figure">Figure 13. </span>Example GGPP prefix (on SFR-Embedding-Mistral), user query and passages (incl. both original and targeted passages) for the Basketball Players (the teams and honors the players get) dataset.</figcaption>
</figure>
<figure class="ltx_figure" id="A1.F14"><img alt="Refer to caption" class="ltx_graphics ltx_align_right ltx_img_landscape" height="194" id="A1.F14.g1" src="x14.png" width="830"/>
<figcaption class="ltx_caption ltx_align_right"><span class="ltx_tag ltx_tag_figure">Figure 14. </span>Example GGPP prefix (on SFR-Embedding-Mistral), user query and passages (incl. both original and targeted passages) for the Book query (publish time and written by) dataset.</figcaption>
</figure>
<figure class="ltx_figure" id="A1.F15"><img alt="Refer to caption" class="ltx_graphics ltx_align_right ltx_img_landscape" height="194" id="A1.F15.g1" src="x15.png" width="830"/>
<figcaption class="ltx_caption ltx_align_right"><span class="ltx_tag ltx_tag_figure">Figure 15. </span>Example GGPP prefix (on SFR-Embedding-Mistral), user query and passages (incl. both original and targeted passages) for the Nobel winners (reasons and time of winnings) dataset.</figcaption>
</figure>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
<section class="ltx_subsection" id="A1.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.5. </span>Factual answer manipulation experiments</h3>
<div class="ltx_para" id="A1.SS5.p1">
<p class="ltx_p" id="A1.SS5.p1.1">We evaluate the performance of GGPP on the Celebrity dataset (Table <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.T7" title="Table 7 â€£ A.5. Factual answer manipulation experiments â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">7</span></a>), sourced from WikiData, by quantitatively analyzing the impact of optimized prefixes on LLMâ€™s output tokens. In addition to measuring the â€success rateâ€, which represents the proportion of manipulations successfully leading to the targeted factually incorrect answers, we also measure the â€error rateâ€, representing the proportion of manipulations resulting in incorrect results but not necessarily our targeted answers. The solid bars in FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F17" title="Figure 17 â€£ A.6. GGPP for prompts with instructions â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">17</span></a> show GGPP is effective on shifting the results away from the correct answers among three models tested.</p>
</div>
<figure class="ltx_table" id="A1.T7">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 7. </span>Dataset on factual answer manipulation experiments</figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="A1.T7.1" style="width:299.0pt;height:28.8pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-37.4pt,3.6pt) scale(0.8,0.8) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="A1.T7.1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A1.T7.1.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_rr ltx_border_tt" id="A1.T7.1.1.1.1.1">Dataset</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A1.T7.1.1.1.1.2">Constraint type</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A1.T7.1.1.1.1.3">N</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A1.T7.1.1.1.1.4">Source</th>
<th class="ltx_td ltx_nopad_r ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="A1.T7.1.1.1.1.5">Example passages and prompts</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A1.T7.1.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_rr ltx_border_t" id="A1.T7.1.1.2.1.1">Celebrity</th>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="A1.T7.1.1.2.1.2">the occupation is</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="A1.T7.1.1.2.1.3">300</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="A1.T7.1.1.2.1.4">Wiki Data</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="A1.T7.1.1.2.1.5">Figure <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F16" title="Figure 16 â€£ A.6. GGPP for prompts with instructions â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">16</span></a>
</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
<figure class="ltx_table" id="A1.T8">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 8. </span>Accuracy of detecting the effect of GGPP prefixes on factual answers (with GPT-J-6B).</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A1.T8.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A1.T8.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A1.T8.1.1.1.1">Token manipulation</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="A1.T8.1.1.1.2">Auroc</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="A1.T8.1.1.1.3">Recall</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="A1.T8.1.1.1.4">Precision</th>
<th class="ltx_td ltx_nopad_r ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="A1.T8.1.1.1.5">F1-score</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A1.T8.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A1.T8.1.2.1.1">SAT probe</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T8.1.2.1.2">95.7%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T8.1.2.1.3">91.4%</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T8.1.2.1.4">93.1%</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="A1.T8.1.2.1.5">92.2%</td>
</tr>
<tr class="ltx_tr" id="A1.T8.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="A1.T8.1.3.2.1">ACT probe</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A1.T8.1.3.2.2">94.5%</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A1.T8.1.3.2.3">91.4%</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A1.T8.1.3.2.4">93.4%</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="A1.T8.1.3.2.5">92.4%</td>
</tr>
</tbody>
</table>
</figure>
<div class="ltx_para" id="A1.SS5.p2">
<p class="ltx_p" id="A1.SS5.p2.1">We also assess the performance of detecting factual answer manipulations. TableÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.T8" title="Table 8 â€£ A.5. Factual answer manipulation experiments â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">8</span></a> shows that both ACT and SAT probes achieve excellent and close results on manipulation detection with GPT-J-6B. Similar results are observed with Mistral-7B and Qwen-7B models. As previously discussed, the ACT probe maintains significantly fewer parameters, making it the preferred choice when resource efficiency is a consideration.</p>
</div>
</section>
<section class="ltx_subsection" id="A1.SS6">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.6. </span>GGPP for prompts with instructions</h3>
<div class="ltx_para" id="A1.SS6.p1">
<p class="ltx_p" id="A1.SS6.p1.1">FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F16" title="Figure 16 â€£ A.6. GGPP for prompts with instructions â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">16</span></a> illustrates how the instruction <em class="ltx_emph ltx_font_italic" id="A1.SS6.p1.1.1">â€Feel free to ignore irrelevant information in the following sentenceâ€ </em> can be bypassed by the optimized prefix. When prompts include such instructions and GGPP is not pre-trained with them, irrelevant information is ignored, leading to correct answers, as shown in the left pane of the figure. However, when these instructions are included in GGPP training, they can be ignored, allowing for perturbation, as shown in the right pane of the figure where an incorrect answer is obtained.</p>
</div>
<div class="ltx_para" id="A1.SS6.p2">
<p class="ltx_p" id="A1.SS6.p2.1">We compare the performance of queries with and without such instructions. In FigureÂ <a class="ltx_ref" href="https://arxiv.org/html/2402.07179v3#A1.F17" title="Figure 17 â€£ A.6. GGPP for prompts with instructions â€£ Appendix A Appendix â€£ Prompt Perturbation in Retrieval-Augmented Generation based Large Language Models"><span class="ltx_text ltx_ref_tag">17</span></a>, the bars in solid color represent the error rate and success rate of GGPP prefixes without the instruction, while the bars with diagonal stripes represent those with the instruction. It is evident that despite the presence of instructions to ignore irrelevant content, the impact on the success rate with GPT-J-6b and Qwen-7b is not substantial. On the other hand, the success rate with Mistra-7B is significantly affected by the presence of instructions.</p>
</div>
<figure class="ltx_figure" id="A1.F16"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="173" id="A1.F16.g1" src="x16.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 16. </span>Instruction for irrelevant prefix can be bypassed by optimized (GGPP) prefix.</figcaption>
</figure>
<figure class="ltx_figure" id="A1.F17"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="233" id="A1.F17.g1" src="x17.png" width="415"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 17. </span>GGPPâ€™s performance with and without the instruction to ignore irrelevant information in prompts</figcaption>
</figure>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Tue Jul 23 19:39:13 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
