<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization</title>
<!--Generated on Sun May  5 05:39:13 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<meta content="Retrieval augmentation; retrieval-enhanced machine learning; ranking optimization" lang="en" name="keywords"/>
<base href="/html/2405.02816v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S1" title="In Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2" title="In Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Expected Utility Maximization for Stochastic RAG</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S3" title="In Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S3.SS1" title="In 3. Experiments ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Data</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S3.SS2" title="In 3. Experiments ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Experimental Setup</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S3.SS3" title="In 3. Experiments ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>Results</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S4" title="In Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Conclusions and Future Work</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line ltx_leqno">
<h1 class="ltx_title ltx_title_document">Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Hamed Zamani
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id1.1.id1">University of Massachusetts Amherst</span><span class="ltx_text ltx_affiliation_city" id="id2.2.id2">Amherst</span><span class="ltx_text ltx_affiliation_state" id="id3.3.id3">MA</span><span class="ltx_text ltx_affiliation_country" id="id4.4.id4">United States</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:zamani@cs.umass.edu">zamani@cs.umass.edu</a>
</span></span></span>
<span class="ltx_author_before"> and </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Michael Bendersky
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation"><span class="ltx_text ltx_affiliation_institution" id="id5.1.id1">Google</span><span class="ltx_text ltx_affiliation_city" id="id6.2.id2">Mountain View</span><span class="ltx_text ltx_affiliation_state" id="id7.3.id3">CA</span><span class="ltx_text ltx_affiliation_country" id="id8.4.id4">United States</span>
</span>
<span class="ltx_contact ltx_role_email"><a href="mailto:bemike@google.com">bemike@google.com</a>
</span></span></span>
</div>
<div class="ltx_dates">(2024)</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract.</h6>
<p class="ltx_p" id="id9.id1">This paper introduces <span class="ltx_text ltx_font_smallcaps" id="id9.id1.1">Stochastic RAG</span>–a novel approach for end-to-end optimization of retrieval-augmented generation (RAG) models that relaxes the simplifying assumptions of marginalization and document independence, made in most prior work. <span class="ltx_text ltx_font_smallcaps" id="id9.id1.2">Stochastic RAG</span> casts the retrieval process in RAG as a stochastic sampling without replacement process. Through this formulation, we employ straight-through Gumbel-top-k that provides a differentiable approximation for sampling without replacement and enables effective end-to-end optimization for RAG. We conduct extensive experiments on seven diverse datasets on a wide range of tasks, from open-domain question answering to fact verification to slot-filling for relation extraction and to dialogue systems. By applying this optimization method to a recent and effective RAG model, we advance state-of-the-art results on six out of seven datasets.</p>
</div>
<div class="ltx_keywords">Retrieval augmentation; retrieval-enhanced machine learning; ranking optimization
</div>
<span class="ltx_note ltx_note_frontmatter ltx_role_journalyear" id="id1"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">journalyear: </span>2024</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_copyright" id="id2"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">copyright: </span>rightsretained</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_conference" id="id3"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">conference: </span>Proceedings of the 47th International ACM SIGIR Conference on Research and Development in Information Retrieval; July 14–18, 2024; Washington, DC, USA</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_booktitle" id="id4"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">booktitle: </span>Proceedings of the 47th International ACM SIGIR Conference on Research and Development in Information Retrieval (SIGIR ’24), July 14–18, 2024, Washington, DC, USA</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_doi" id="id5"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">doi: </span>10.1145/3626772.3657923</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_isbn" id="id6"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">isbn: </span>979-8-4007-0431-4/24/07</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_ccs" id="id7"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Computing methodologies Natural language generation</span></span></span><span class="ltx_note ltx_note_frontmatter ltx_role_ccs" id="id8"><sup class="ltx_note_mark">†</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">†</sup><span class="ltx_note_type">ccs: </span>Information systems Retrieval models and ranking</span></span></span>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1. </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Most machine learning systems, including large generative models, are self-contained systems, with both knowledge and reasoning encoded in model parameters.
However, these models do not work effectively for tasks that require knowledge grounding <cite class="ltx_cite ltx_citemacro_citep">(Valmeekam et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib47" title="">2023</a>)</cite>, especially in case of non-stationary data where new information is actively being produced <cite class="ltx_cite ltx_citemacro_citep">(Zamani et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib53" title="">2022b</a>; Vu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib48" title="">2023</a>)</cite>.
As suggested by <cite class="ltx_cite ltx_citemacro_citet">Zamani et al<span class="ltx_text">.</span> (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib53" title="">2022b</a>)</cite>, this issue can be addressed when machine learning systems are being <em class="ltx_emph ltx_font_italic" id="S1.p1.1.1">enhanced with the capability of retrieving stored content</em>. For example, in retrieval-augmented generation (RAG), as a special case of retrieval-enhanced machine learning (REML) <cite class="ltx_cite ltx_citemacro_citep">(Zamani et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib53" title="">2022b</a>)</cite>, systems consume the responses provided by one or more retrieval models for the purpose of (text) generation <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib22" title="">2020</a>; Li et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib23" title="">2022</a>)</cite>.
RAG models demonstrate substantial promise across various applications, including open-domain question answering <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib22" title="">2020</a>; Zhu et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib54" title="">2021</a>; Karpukhin et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib17" title="">2020</a>)</cite>, fact verification <cite class="ltx_cite ltx_citemacro_citep">(Thorne et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib45" title="">2018a</a>)</cite>, dialogue systems <cite class="ltx_cite ltx_citemacro_citep">(Weston et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib49" title="">2018</a>; Dinan et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib6" title="">2018</a>; Song et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib43" title="">2018</a>)</cite>, and personalized generation <cite class="ltx_cite ltx_citemacro_citep">(Salemi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib38" title="">2024b</a>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib37" title="">a</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.2">Many prior studies on RAG use off-the-shelf retrieval models. For instance, <cite class="ltx_cite ltx_citemacro_citet">Nakano et al<span class="ltx_text">.</span> (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib26" title="">2022</a>)</cite> used APIs from a commercial search engine for text generation. <cite class="ltx_cite ltx_citemacro_citet">Glass et al<span class="ltx_text">.</span> (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib10" title="">2022a</a>)</cite>, on the other hand, used a term matching retrieval model. Neural ranking models trained based on human annotated data have also been used in the literature <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib22" title="">2020</a>; Hofstätter et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib13" title="">2023</a>)</cite>. There also exist methods that only optimize the retrieval model and keep the language model parameters frozen <cite class="ltx_cite ltx_citemacro_citep">(Shi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib41" title="">2023</a>)</cite>.
A research direction in this area argues that optimizing retrieval models in RAG should depend on the downstream language model that consumes the retrieval results. This is also motivated by the findings presented by <cite class="ltx_cite ltx_citemacro_citet">Salemi and Zamani (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib39" title="">2024</a>)</cite> on evaluating retrieval quality in RAG systems. There exist solutions based on knowledge distillation <cite class="ltx_cite ltx_citemacro_citep">(Izacard and Grave, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib14" title="">2020</a>)</cite> or end-to-end optimization based on some simplifying assumptions <cite class="ltx_cite ltx_citemacro_citep">(Sachan et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib36" title="">2021</a>)</cite>. One of these assumptions is <em class="ltx_emph ltx_font_italic" id="S1.p2.1.1">marginalization via top <math alttext="k" class="ltx_Math" display="inline" id="S1.p2.1.1.m1.1"><semantics id="S1.p2.1.1.m1.1a"><mi id="S1.p2.1.1.m1.1.1" xref="S1.p2.1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p2.1.1.m1.1b"><ci id="S1.p2.1.1.m1.1.1.cmml" xref="S1.p2.1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p2.1.1.m1.1d">italic_k</annotation></semantics></math> approximation</em> <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib22" title="">2020</a>; Glass et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib11" title="">2022b</a>)</cite>. In more details, they first retrieve the top <math alttext="k" class="ltx_Math" display="inline" id="S1.p2.2.m1.1"><semantics id="S1.p2.2.m1.1a"><mi id="S1.p2.2.m1.1.1" xref="S1.p2.2.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p2.2.m1.1b"><ci id="S1.p2.2.m1.1.1.cmml" xref="S1.p2.2.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.2.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p2.2.m1.1d">italic_k</annotation></semantics></math> documents using off-the-shelf retrieval models, e.g., BM25 <cite class="ltx_cite ltx_citemacro_citep">(Robertson et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib35" title="">1994</a>)</cite>, and optimize retrieval models by <em class="ltx_emph ltx_font_italic" id="S1.p2.2.2">re-scoring</em> them, i.e., re-ranking, and feeding the documents to the downstream language model one-by-one independently <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib22" title="">2020</a>)</cite>. This is far from reality as RAG models often consume multiple documents.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">This paper introduces <span class="ltx_text ltx_font_smallcaps" id="S1.p3.1.1">Expected Utility Maximization for RAG</span>–a novel framework for end-to-end RAG optimization by relaxing these simplifying assumptions. This approach takes a utility function, which can be any arbitrary evaluation metric for the downstream generation task, such as exact match, BLEU <cite class="ltx_cite ltx_citemacro_citep">(Papineni et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib27" title="">2002</a>)</cite>, and ROUGE <cite class="ltx_cite ltx_citemacro_citep">(Lin, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib24" title="">2004</a>)</cite>. A major challenge in end-to-end optimization of RAG systems is that ranking and top <math alttext="k" class="ltx_Math" display="inline" id="S1.p3.1.m1.1"><semantics id="S1.p3.1.m1.1a"><mi id="S1.p3.1.m1.1.1" xref="S1.p3.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p3.1.m1.1b"><ci id="S1.p3.1.m1.1.1.cmml" xref="S1.p3.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p3.1.m1.1d">italic_k</annotation></semantics></math> selection is a non-differentiable process. Hence, this prevents us from using gradient descent-based methods for optimization. We address this issue by casting retrieval as a <em class="ltx_emph ltx_font_italic" id="S1.p3.1.2">sampling without replacement</em> process from the retrieval score distribution, which is approximated using the straight-through Gumbel-top-k approach. This stochastic approach—called <span class="ltx_text ltx_font_smallcaps" id="S1.p3.1.3">Stochastic RAG</span>—adds a Gumbel noise to the unnormalized retrieval scores and uses softmax to approximate argmax <cite class="ltx_cite ltx_citemacro_citep">(Kool et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib18" title="">2019</a>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib19" title="">2020</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1"><span class="ltx_text ltx_font_smallcaps" id="S1.p4.1.1">Stochastic RAG</span> can be applied to any RAG application. We evaluate our models using seven datasets from a wide range of applications, ranging from open-domain question answering to fact verification to slot-filling for relation extraction as well as dialogue systems. We apply our optimization method to FiD-Light <cite class="ltx_cite ltx_citemacro_citep">(Hofstätter et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib13" title="">2023</a>)</cite>, which is the best performing system on six out of these seven datasets, according to the knowledge-intensive language tasks (KILT) leaderboard as of Feb. 1, 2024.<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://eval.ai/web/challenges/challenge-page/689/leaderboard" title="">https://eval.ai/web/challenges/challenge-page/689/leaderboard</a>.</span></span></span> Our results demonstrate significant improvements on all these datasets.</p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2. </span>Expected Utility Maximization for Stochastic RAG</h2>
<div class="ltx_para" id="S2.p1">
<p class="ltx_p" id="S2.p1.6">Each RAG system consists of two main components: a text generation model <math alttext="G_{\theta}" class="ltx_Math" display="inline" id="S2.p1.1.m1.1"><semantics id="S2.p1.1.m1.1a"><msub id="S2.p1.1.m1.1.1" xref="S2.p1.1.m1.1.1.cmml"><mi id="S2.p1.1.m1.1.1.2" xref="S2.p1.1.m1.1.1.2.cmml">G</mi><mi id="S2.p1.1.m1.1.1.3" xref="S2.p1.1.m1.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p1.1.m1.1b"><apply id="S2.p1.1.m1.1.1.cmml" xref="S2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S2.p1.1.m1.1.1.1.cmml" xref="S2.p1.1.m1.1.1">subscript</csymbol><ci id="S2.p1.1.m1.1.1.2.cmml" xref="S2.p1.1.m1.1.1.2">𝐺</ci><ci id="S2.p1.1.m1.1.1.3.cmml" xref="S2.p1.1.m1.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.1.m1.1c">G_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S2.p1.1.m1.1d">italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math> parameterized by <math alttext="\theta" class="ltx_Math" display="inline" id="S2.p1.2.m2.1"><semantics id="S2.p1.2.m2.1a"><mi id="S2.p1.2.m2.1.1" xref="S2.p1.2.m2.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S2.p1.2.m2.1b"><ci id="S2.p1.2.m2.1.1.cmml" xref="S2.p1.2.m2.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.2.m2.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S2.p1.2.m2.1d">italic_θ</annotation></semantics></math> and a retrieval model <math alttext="R_{\phi}" class="ltx_Math" display="inline" id="S2.p1.3.m3.1"><semantics id="S2.p1.3.m3.1a"><msub id="S2.p1.3.m3.1.1" xref="S2.p1.3.m3.1.1.cmml"><mi id="S2.p1.3.m3.1.1.2" xref="S2.p1.3.m3.1.1.2.cmml">R</mi><mi id="S2.p1.3.m3.1.1.3" xref="S2.p1.3.m3.1.1.3.cmml">ϕ</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p1.3.m3.1b"><apply id="S2.p1.3.m3.1.1.cmml" xref="S2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S2.p1.3.m3.1.1.1.cmml" xref="S2.p1.3.m3.1.1">subscript</csymbol><ci id="S2.p1.3.m3.1.1.2.cmml" xref="S2.p1.3.m3.1.1.2">𝑅</ci><ci id="S2.p1.3.m3.1.1.3.cmml" xref="S2.p1.3.m3.1.1.3">italic-ϕ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.3.m3.1c">R_{\phi}</annotation><annotation encoding="application/x-llamapun" id="S2.p1.3.m3.1d">italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT</annotation></semantics></math> parameterized by <math alttext="\phi" class="ltx_Math" display="inline" id="S2.p1.4.m4.1"><semantics id="S2.p1.4.m4.1a"><mi id="S2.p1.4.m4.1.1" xref="S2.p1.4.m4.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S2.p1.4.m4.1b"><ci id="S2.p1.4.m4.1.1.cmml" xref="S2.p1.4.m4.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.4.m4.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S2.p1.4.m4.1d">italic_ϕ</annotation></semantics></math> that retrieves documents from a large document collection <math alttext="C" class="ltx_Math" display="inline" id="S2.p1.5.m5.1"><semantics id="S2.p1.5.m5.1a"><mi id="S2.p1.5.m5.1.1" xref="S2.p1.5.m5.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S2.p1.5.m5.1b"><ci id="S2.p1.5.m5.1.1.cmml" xref="S2.p1.5.m5.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.5.m5.1c">C</annotation><annotation encoding="application/x-llamapun" id="S2.p1.5.m5.1d">italic_C</annotation></semantics></math>. The text generation model consumes the retrieval results returned by the retrieval model. End-to-end optimization of RAG systems is challenging. This is mainly because retrieving top <math alttext="k" class="ltx_Math" display="inline" id="S2.p1.6.m6.1"><semantics id="S2.p1.6.m6.1a"><mi id="S2.p1.6.m6.1.1" xref="S2.p1.6.m6.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.p1.6.m6.1b"><ci id="S2.p1.6.m6.1.1.cmml" xref="S2.p1.6.m6.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.6.m6.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.p1.6.m6.1d">italic_k</annotation></semantics></math> documents and feeding them to the generation model is not a differentiable process <cite class="ltx_cite ltx_citemacro_citep">(Zamani et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib53" title="">2022b</a>)</cite>, thus one cannot simply employ gradient-based optimization algorithms for end-to-end optimization of these models. In this section, we introduce stochastic expected utility maximization for end-to-end optimization of retrieval-augmented models.</p>
</div>
<div class="ltx_para" id="S2.p2">
<p class="ltx_p" id="S2.p2.9">Let <math alttext="T=\{(x_{1},y_{1}),(x_{2},y_{2}),\cdots,(x_{n},y_{n})\}" class="ltx_Math" display="inline" id="S2.p2.1.m1.4"><semantics id="S2.p2.1.m1.4a"><mrow id="S2.p2.1.m1.4.4" xref="S2.p2.1.m1.4.4.cmml"><mi id="S2.p2.1.m1.4.4.5" xref="S2.p2.1.m1.4.4.5.cmml">T</mi><mo id="S2.p2.1.m1.4.4.4" xref="S2.p2.1.m1.4.4.4.cmml">=</mo><mrow id="S2.p2.1.m1.4.4.3.3" xref="S2.p2.1.m1.4.4.3.4.cmml"><mo id="S2.p2.1.m1.4.4.3.3.4" stretchy="false" xref="S2.p2.1.m1.4.4.3.4.cmml">{</mo><mrow id="S2.p2.1.m1.2.2.1.1.1.2" xref="S2.p2.1.m1.2.2.1.1.1.3.cmml"><mo id="S2.p2.1.m1.2.2.1.1.1.2.3" stretchy="false" xref="S2.p2.1.m1.2.2.1.1.1.3.cmml">(</mo><msub id="S2.p2.1.m1.2.2.1.1.1.1.1" xref="S2.p2.1.m1.2.2.1.1.1.1.1.cmml"><mi id="S2.p2.1.m1.2.2.1.1.1.1.1.2" xref="S2.p2.1.m1.2.2.1.1.1.1.1.2.cmml">x</mi><mn id="S2.p2.1.m1.2.2.1.1.1.1.1.3" xref="S2.p2.1.m1.2.2.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S2.p2.1.m1.2.2.1.1.1.2.4" xref="S2.p2.1.m1.2.2.1.1.1.3.cmml">,</mo><msub id="S2.p2.1.m1.2.2.1.1.1.2.2" xref="S2.p2.1.m1.2.2.1.1.1.2.2.cmml"><mi id="S2.p2.1.m1.2.2.1.1.1.2.2.2" xref="S2.p2.1.m1.2.2.1.1.1.2.2.2.cmml">y</mi><mn id="S2.p2.1.m1.2.2.1.1.1.2.2.3" xref="S2.p2.1.m1.2.2.1.1.1.2.2.3.cmml">1</mn></msub><mo id="S2.p2.1.m1.2.2.1.1.1.2.5" stretchy="false" xref="S2.p2.1.m1.2.2.1.1.1.3.cmml">)</mo></mrow><mo id="S2.p2.1.m1.4.4.3.3.5" xref="S2.p2.1.m1.4.4.3.4.cmml">,</mo><mrow id="S2.p2.1.m1.3.3.2.2.2.2" xref="S2.p2.1.m1.3.3.2.2.2.3.cmml"><mo id="S2.p2.1.m1.3.3.2.2.2.2.3" stretchy="false" xref="S2.p2.1.m1.3.3.2.2.2.3.cmml">(</mo><msub id="S2.p2.1.m1.3.3.2.2.2.1.1" xref="S2.p2.1.m1.3.3.2.2.2.1.1.cmml"><mi id="S2.p2.1.m1.3.3.2.2.2.1.1.2" xref="S2.p2.1.m1.3.3.2.2.2.1.1.2.cmml">x</mi><mn id="S2.p2.1.m1.3.3.2.2.2.1.1.3" xref="S2.p2.1.m1.3.3.2.2.2.1.1.3.cmml">2</mn></msub><mo id="S2.p2.1.m1.3.3.2.2.2.2.4" xref="S2.p2.1.m1.3.3.2.2.2.3.cmml">,</mo><msub id="S2.p2.1.m1.3.3.2.2.2.2.2" xref="S2.p2.1.m1.3.3.2.2.2.2.2.cmml"><mi id="S2.p2.1.m1.3.3.2.2.2.2.2.2" xref="S2.p2.1.m1.3.3.2.2.2.2.2.2.cmml">y</mi><mn id="S2.p2.1.m1.3.3.2.2.2.2.2.3" xref="S2.p2.1.m1.3.3.2.2.2.2.2.3.cmml">2</mn></msub><mo id="S2.p2.1.m1.3.3.2.2.2.2.5" stretchy="false" xref="S2.p2.1.m1.3.3.2.2.2.3.cmml">)</mo></mrow><mo id="S2.p2.1.m1.4.4.3.3.6" xref="S2.p2.1.m1.4.4.3.4.cmml">,</mo><mi id="S2.p2.1.m1.1.1" mathvariant="normal" xref="S2.p2.1.m1.1.1.cmml">⋯</mi><mo id="S2.p2.1.m1.4.4.3.3.7" xref="S2.p2.1.m1.4.4.3.4.cmml">,</mo><mrow id="S2.p2.1.m1.4.4.3.3.3.2" xref="S2.p2.1.m1.4.4.3.3.3.3.cmml"><mo id="S2.p2.1.m1.4.4.3.3.3.2.3" stretchy="false" xref="S2.p2.1.m1.4.4.3.3.3.3.cmml">(</mo><msub id="S2.p2.1.m1.4.4.3.3.3.1.1" xref="S2.p2.1.m1.4.4.3.3.3.1.1.cmml"><mi id="S2.p2.1.m1.4.4.3.3.3.1.1.2" xref="S2.p2.1.m1.4.4.3.3.3.1.1.2.cmml">x</mi><mi id="S2.p2.1.m1.4.4.3.3.3.1.1.3" xref="S2.p2.1.m1.4.4.3.3.3.1.1.3.cmml">n</mi></msub><mo id="S2.p2.1.m1.4.4.3.3.3.2.4" xref="S2.p2.1.m1.4.4.3.3.3.3.cmml">,</mo><msub id="S2.p2.1.m1.4.4.3.3.3.2.2" xref="S2.p2.1.m1.4.4.3.3.3.2.2.cmml"><mi id="S2.p2.1.m1.4.4.3.3.3.2.2.2" xref="S2.p2.1.m1.4.4.3.3.3.2.2.2.cmml">y</mi><mi id="S2.p2.1.m1.4.4.3.3.3.2.2.3" xref="S2.p2.1.m1.4.4.3.3.3.2.2.3.cmml">n</mi></msub><mo id="S2.p2.1.m1.4.4.3.3.3.2.5" stretchy="false" xref="S2.p2.1.m1.4.4.3.3.3.3.cmml">)</mo></mrow><mo id="S2.p2.1.m1.4.4.3.3.8" stretchy="false" xref="S2.p2.1.m1.4.4.3.4.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p2.1.m1.4b"><apply id="S2.p2.1.m1.4.4.cmml" xref="S2.p2.1.m1.4.4"><eq id="S2.p2.1.m1.4.4.4.cmml" xref="S2.p2.1.m1.4.4.4"></eq><ci id="S2.p2.1.m1.4.4.5.cmml" xref="S2.p2.1.m1.4.4.5">𝑇</ci><set id="S2.p2.1.m1.4.4.3.4.cmml" xref="S2.p2.1.m1.4.4.3.3"><interval closure="open" id="S2.p2.1.m1.2.2.1.1.1.3.cmml" xref="S2.p2.1.m1.2.2.1.1.1.2"><apply id="S2.p2.1.m1.2.2.1.1.1.1.1.cmml" xref="S2.p2.1.m1.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.p2.1.m1.2.2.1.1.1.1.1.1.cmml" xref="S2.p2.1.m1.2.2.1.1.1.1.1">subscript</csymbol><ci id="S2.p2.1.m1.2.2.1.1.1.1.1.2.cmml" xref="S2.p2.1.m1.2.2.1.1.1.1.1.2">𝑥</ci><cn id="S2.p2.1.m1.2.2.1.1.1.1.1.3.cmml" type="integer" xref="S2.p2.1.m1.2.2.1.1.1.1.1.3">1</cn></apply><apply id="S2.p2.1.m1.2.2.1.1.1.2.2.cmml" xref="S2.p2.1.m1.2.2.1.1.1.2.2"><csymbol cd="ambiguous" id="S2.p2.1.m1.2.2.1.1.1.2.2.1.cmml" xref="S2.p2.1.m1.2.2.1.1.1.2.2">subscript</csymbol><ci id="S2.p2.1.m1.2.2.1.1.1.2.2.2.cmml" xref="S2.p2.1.m1.2.2.1.1.1.2.2.2">𝑦</ci><cn id="S2.p2.1.m1.2.2.1.1.1.2.2.3.cmml" type="integer" xref="S2.p2.1.m1.2.2.1.1.1.2.2.3">1</cn></apply></interval><interval closure="open" id="S2.p2.1.m1.3.3.2.2.2.3.cmml" xref="S2.p2.1.m1.3.3.2.2.2.2"><apply id="S2.p2.1.m1.3.3.2.2.2.1.1.cmml" xref="S2.p2.1.m1.3.3.2.2.2.1.1"><csymbol cd="ambiguous" id="S2.p2.1.m1.3.3.2.2.2.1.1.1.cmml" xref="S2.p2.1.m1.3.3.2.2.2.1.1">subscript</csymbol><ci id="S2.p2.1.m1.3.3.2.2.2.1.1.2.cmml" xref="S2.p2.1.m1.3.3.2.2.2.1.1.2">𝑥</ci><cn id="S2.p2.1.m1.3.3.2.2.2.1.1.3.cmml" type="integer" xref="S2.p2.1.m1.3.3.2.2.2.1.1.3">2</cn></apply><apply id="S2.p2.1.m1.3.3.2.2.2.2.2.cmml" xref="S2.p2.1.m1.3.3.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.p2.1.m1.3.3.2.2.2.2.2.1.cmml" xref="S2.p2.1.m1.3.3.2.2.2.2.2">subscript</csymbol><ci id="S2.p2.1.m1.3.3.2.2.2.2.2.2.cmml" xref="S2.p2.1.m1.3.3.2.2.2.2.2.2">𝑦</ci><cn id="S2.p2.1.m1.3.3.2.2.2.2.2.3.cmml" type="integer" xref="S2.p2.1.m1.3.3.2.2.2.2.2.3">2</cn></apply></interval><ci id="S2.p2.1.m1.1.1.cmml" xref="S2.p2.1.m1.1.1">⋯</ci><interval closure="open" id="S2.p2.1.m1.4.4.3.3.3.3.cmml" xref="S2.p2.1.m1.4.4.3.3.3.2"><apply id="S2.p2.1.m1.4.4.3.3.3.1.1.cmml" xref="S2.p2.1.m1.4.4.3.3.3.1.1"><csymbol cd="ambiguous" id="S2.p2.1.m1.4.4.3.3.3.1.1.1.cmml" xref="S2.p2.1.m1.4.4.3.3.3.1.1">subscript</csymbol><ci id="S2.p2.1.m1.4.4.3.3.3.1.1.2.cmml" xref="S2.p2.1.m1.4.4.3.3.3.1.1.2">𝑥</ci><ci id="S2.p2.1.m1.4.4.3.3.3.1.1.3.cmml" xref="S2.p2.1.m1.4.4.3.3.3.1.1.3">𝑛</ci></apply><apply id="S2.p2.1.m1.4.4.3.3.3.2.2.cmml" xref="S2.p2.1.m1.4.4.3.3.3.2.2"><csymbol cd="ambiguous" id="S2.p2.1.m1.4.4.3.3.3.2.2.1.cmml" xref="S2.p2.1.m1.4.4.3.3.3.2.2">subscript</csymbol><ci id="S2.p2.1.m1.4.4.3.3.3.2.2.2.cmml" xref="S2.p2.1.m1.4.4.3.3.3.2.2.2">𝑦</ci><ci id="S2.p2.1.m1.4.4.3.3.3.2.2.3.cmml" xref="S2.p2.1.m1.4.4.3.3.3.2.2.3">𝑛</ci></apply></interval></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.1.m1.4c">T=\{(x_{1},y_{1}),(x_{2},y_{2}),\cdots,(x_{n},y_{n})\}</annotation><annotation encoding="application/x-llamapun" id="S2.p2.1.m1.4d">italic_T = { ( italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) , ( italic_x start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) , ⋯ , ( italic_x start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT ) }</annotation></semantics></math> be a training set containing <math alttext="n" class="ltx_Math" display="inline" id="S2.p2.2.m2.1"><semantics id="S2.p2.2.m2.1a"><mi id="S2.p2.2.m2.1.1" xref="S2.p2.2.m2.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S2.p2.2.m2.1b"><ci id="S2.p2.2.m2.1.1.cmml" xref="S2.p2.2.m2.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.2.m2.1c">n</annotation><annotation encoding="application/x-llamapun" id="S2.p2.2.m2.1d">italic_n</annotation></semantics></math> pairs of <math alttext="x_{i}" class="ltx_Math" display="inline" id="S2.p2.3.m3.1"><semantics id="S2.p2.3.m3.1a"><msub id="S2.p2.3.m3.1.1" xref="S2.p2.3.m3.1.1.cmml"><mi id="S2.p2.3.m3.1.1.2" xref="S2.p2.3.m3.1.1.2.cmml">x</mi><mi id="S2.p2.3.m3.1.1.3" xref="S2.p2.3.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p2.3.m3.1b"><apply id="S2.p2.3.m3.1.1.cmml" xref="S2.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S2.p2.3.m3.1.1.1.cmml" xref="S2.p2.3.m3.1.1">subscript</csymbol><ci id="S2.p2.3.m3.1.1.2.cmml" xref="S2.p2.3.m3.1.1.2">𝑥</ci><ci id="S2.p2.3.m3.1.1.3.cmml" xref="S2.p2.3.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.3.m3.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.p2.3.m3.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> (an input text) and <math alttext="y_{i}" class="ltx_Math" display="inline" id="S2.p2.4.m4.1"><semantics id="S2.p2.4.m4.1a"><msub id="S2.p2.4.m4.1.1" xref="S2.p2.4.m4.1.1.cmml"><mi id="S2.p2.4.m4.1.1.2" xref="S2.p2.4.m4.1.1.2.cmml">y</mi><mi id="S2.p2.4.m4.1.1.3" xref="S2.p2.4.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p2.4.m4.1b"><apply id="S2.p2.4.m4.1.1.cmml" xref="S2.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S2.p2.4.m4.1.1.1.cmml" xref="S2.p2.4.m4.1.1">subscript</csymbol><ci id="S2.p2.4.m4.1.1.2.cmml" xref="S2.p2.4.m4.1.1.2">𝑦</ci><ci id="S2.p2.4.m4.1.1.3.cmml" xref="S2.p2.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.4.m4.1c">y_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.p2.4.m4.1d">italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> (the ground truth output text). Let <math alttext="U" class="ltx_Math" display="inline" id="S2.p2.5.m5.1"><semantics id="S2.p2.5.m5.1a"><mi id="S2.p2.5.m5.1.1" xref="S2.p2.5.m5.1.1.cmml">U</mi><annotation-xml encoding="MathML-Content" id="S2.p2.5.m5.1b"><ci id="S2.p2.5.m5.1.1.cmml" xref="S2.p2.5.m5.1.1">𝑈</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.5.m5.1c">U</annotation><annotation encoding="application/x-llamapun" id="S2.p2.5.m5.1d">italic_U</annotation></semantics></math> denote a utility function that takes the output generated by the RAG system <math alttext="\hat{y}" class="ltx_Math" display="inline" id="S2.p2.6.m6.1"><semantics id="S2.p2.6.m6.1a"><mover accent="true" id="S2.p2.6.m6.1.1" xref="S2.p2.6.m6.1.1.cmml"><mi id="S2.p2.6.m6.1.1.2" xref="S2.p2.6.m6.1.1.2.cmml">y</mi><mo id="S2.p2.6.m6.1.1.1" xref="S2.p2.6.m6.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S2.p2.6.m6.1b"><apply id="S2.p2.6.m6.1.1.cmml" xref="S2.p2.6.m6.1.1"><ci id="S2.p2.6.m6.1.1.1.cmml" xref="S2.p2.6.m6.1.1.1">^</ci><ci id="S2.p2.6.m6.1.1.2.cmml" xref="S2.p2.6.m6.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.6.m6.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="S2.p2.6.m6.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math> and the ground truth output <math alttext="y" class="ltx_Math" display="inline" id="S2.p2.7.m7.1"><semantics id="S2.p2.7.m7.1a"><mi id="S2.p2.7.m7.1.1" xref="S2.p2.7.m7.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S2.p2.7.m7.1b"><ci id="S2.p2.7.m7.1.1.cmml" xref="S2.p2.7.m7.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.7.m7.1c">y</annotation><annotation encoding="application/x-llamapun" id="S2.p2.7.m7.1d">italic_y</annotation></semantics></math> and generates a scalar value. The utility function can be any arbitrary metric, including but is not limited to, exact match, term overlap F1, BLEU, and ROUGE. We assume (1) the higher the utility value, the better, (2) the utility function is bounded within the <math alttext="[0,1]" class="ltx_Math" display="inline" id="S2.p2.8.m8.2"><semantics id="S2.p2.8.m8.2a"><mrow id="S2.p2.8.m8.2.3.2" xref="S2.p2.8.m8.2.3.1.cmml"><mo id="S2.p2.8.m8.2.3.2.1" stretchy="false" xref="S2.p2.8.m8.2.3.1.cmml">[</mo><mn id="S2.p2.8.m8.1.1" xref="S2.p2.8.m8.1.1.cmml">0</mn><mo id="S2.p2.8.m8.2.3.2.2" xref="S2.p2.8.m8.2.3.1.cmml">,</mo><mn id="S2.p2.8.m8.2.2" xref="S2.p2.8.m8.2.2.cmml">1</mn><mo id="S2.p2.8.m8.2.3.2.3" stretchy="false" xref="S2.p2.8.m8.2.3.1.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.p2.8.m8.2b"><interval closure="closed" id="S2.p2.8.m8.2.3.1.cmml" xref="S2.p2.8.m8.2.3.2"><cn id="S2.p2.8.m8.1.1.cmml" type="integer" xref="S2.p2.8.m8.1.1">0</cn><cn id="S2.p2.8.m8.2.2.cmml" type="integer" xref="S2.p2.8.m8.2.2">1</cn></interval></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.8.m8.2c">[0,1]</annotation><annotation encoding="application/x-llamapun" id="S2.p2.8.m8.2d">[ 0 , 1 ]</annotation></semantics></math> range, and (3) <math alttext="U(y,y)=1" class="ltx_Math" display="inline" id="S2.p2.9.m9.2"><semantics id="S2.p2.9.m9.2a"><mrow id="S2.p2.9.m9.2.3" xref="S2.p2.9.m9.2.3.cmml"><mrow id="S2.p2.9.m9.2.3.2" xref="S2.p2.9.m9.2.3.2.cmml"><mi id="S2.p2.9.m9.2.3.2.2" xref="S2.p2.9.m9.2.3.2.2.cmml">U</mi><mo id="S2.p2.9.m9.2.3.2.1" xref="S2.p2.9.m9.2.3.2.1.cmml">⁢</mo><mrow id="S2.p2.9.m9.2.3.2.3.2" xref="S2.p2.9.m9.2.3.2.3.1.cmml"><mo id="S2.p2.9.m9.2.3.2.3.2.1" stretchy="false" xref="S2.p2.9.m9.2.3.2.3.1.cmml">(</mo><mi id="S2.p2.9.m9.1.1" xref="S2.p2.9.m9.1.1.cmml">y</mi><mo id="S2.p2.9.m9.2.3.2.3.2.2" xref="S2.p2.9.m9.2.3.2.3.1.cmml">,</mo><mi id="S2.p2.9.m9.2.2" xref="S2.p2.9.m9.2.2.cmml">y</mi><mo id="S2.p2.9.m9.2.3.2.3.2.3" stretchy="false" xref="S2.p2.9.m9.2.3.2.3.1.cmml">)</mo></mrow></mrow><mo id="S2.p2.9.m9.2.3.1" xref="S2.p2.9.m9.2.3.1.cmml">=</mo><mn id="S2.p2.9.m9.2.3.3" xref="S2.p2.9.m9.2.3.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.p2.9.m9.2b"><apply id="S2.p2.9.m9.2.3.cmml" xref="S2.p2.9.m9.2.3"><eq id="S2.p2.9.m9.2.3.1.cmml" xref="S2.p2.9.m9.2.3.1"></eq><apply id="S2.p2.9.m9.2.3.2.cmml" xref="S2.p2.9.m9.2.3.2"><times id="S2.p2.9.m9.2.3.2.1.cmml" xref="S2.p2.9.m9.2.3.2.1"></times><ci id="S2.p2.9.m9.2.3.2.2.cmml" xref="S2.p2.9.m9.2.3.2.2">𝑈</ci><interval closure="open" id="S2.p2.9.m9.2.3.2.3.1.cmml" xref="S2.p2.9.m9.2.3.2.3.2"><ci id="S2.p2.9.m9.1.1.cmml" xref="S2.p2.9.m9.1.1">𝑦</ci><ci id="S2.p2.9.m9.2.2.cmml" xref="S2.p2.9.m9.2.2">𝑦</ci></interval></apply><cn id="S2.p2.9.m9.2.3.3.cmml" type="integer" xref="S2.p2.9.m9.2.3.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.9.m9.2c">U(y,y)=1</annotation><annotation encoding="application/x-llamapun" id="S2.p2.9.m9.2d">italic_U ( italic_y , italic_y ) = 1</annotation></semantics></math>. We define RAG Expected Utility as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(1)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\textsc{RAG Expected Utility}=\frac{1}{n}\sum_{(x,y)\in T}\sum_{\hat{y}\in%
\mathcal{Y}}{U(y,\hat{y})p(\hat{y}|x;G_{\theta},R_{\phi})}" class="ltx_Math" display="block" id="S2.E1.m1.6"><semantics id="S2.E1.m1.6a"><mrow id="S2.E1.m1.6.6" xref="S2.E1.m1.6.6.cmml"><mtext class="ltx_font_smallcaps" id="S2.E1.m1.6.6.3" xref="S2.E1.m1.6.6.3a.cmml">RAG Expected Utility</mtext><mo id="S2.E1.m1.6.6.2" xref="S2.E1.m1.6.6.2.cmml">=</mo><mrow id="S2.E1.m1.6.6.1" xref="S2.E1.m1.6.6.1.cmml"><mfrac id="S2.E1.m1.6.6.1.3" xref="S2.E1.m1.6.6.1.3.cmml"><mn id="S2.E1.m1.6.6.1.3.2" xref="S2.E1.m1.6.6.1.3.2.cmml">1</mn><mi id="S2.E1.m1.6.6.1.3.3" xref="S2.E1.m1.6.6.1.3.3.cmml">n</mi></mfrac><mo id="S2.E1.m1.6.6.1.2" xref="S2.E1.m1.6.6.1.2.cmml">⁢</mo><mrow id="S2.E1.m1.6.6.1.1" xref="S2.E1.m1.6.6.1.1.cmml"><munder id="S2.E1.m1.6.6.1.1.2" xref="S2.E1.m1.6.6.1.1.2.cmml"><mo id="S2.E1.m1.6.6.1.1.2.2" movablelimits="false" rspace="0em" xref="S2.E1.m1.6.6.1.1.2.2.cmml">∑</mo><mrow id="S2.E1.m1.2.2.2" xref="S2.E1.m1.2.2.2.cmml"><mrow id="S2.E1.m1.2.2.2.4.2" xref="S2.E1.m1.2.2.2.4.1.cmml"><mo id="S2.E1.m1.2.2.2.4.2.1" stretchy="false" xref="S2.E1.m1.2.2.2.4.1.cmml">(</mo><mi id="S2.E1.m1.1.1.1.1" xref="S2.E1.m1.1.1.1.1.cmml">x</mi><mo id="S2.E1.m1.2.2.2.4.2.2" xref="S2.E1.m1.2.2.2.4.1.cmml">,</mo><mi id="S2.E1.m1.2.2.2.2" xref="S2.E1.m1.2.2.2.2.cmml">y</mi><mo id="S2.E1.m1.2.2.2.4.2.3" stretchy="false" xref="S2.E1.m1.2.2.2.4.1.cmml">)</mo></mrow><mo id="S2.E1.m1.2.2.2.3" xref="S2.E1.m1.2.2.2.3.cmml">∈</mo><mi id="S2.E1.m1.2.2.2.5" xref="S2.E1.m1.2.2.2.5.cmml">T</mi></mrow></munder><mrow id="S2.E1.m1.6.6.1.1.1" xref="S2.E1.m1.6.6.1.1.1.cmml"><munder id="S2.E1.m1.6.6.1.1.1.2" xref="S2.E1.m1.6.6.1.1.1.2.cmml"><mo id="S2.E1.m1.6.6.1.1.1.2.2" movablelimits="false" xref="S2.E1.m1.6.6.1.1.1.2.2.cmml">∑</mo><mrow id="S2.E1.m1.6.6.1.1.1.2.3" xref="S2.E1.m1.6.6.1.1.1.2.3.cmml"><mover accent="true" id="S2.E1.m1.6.6.1.1.1.2.3.2" xref="S2.E1.m1.6.6.1.1.1.2.3.2.cmml"><mi id="S2.E1.m1.6.6.1.1.1.2.3.2.2" xref="S2.E1.m1.6.6.1.1.1.2.3.2.2.cmml">y</mi><mo id="S2.E1.m1.6.6.1.1.1.2.3.2.1" xref="S2.E1.m1.6.6.1.1.1.2.3.2.1.cmml">^</mo></mover><mo id="S2.E1.m1.6.6.1.1.1.2.3.1" xref="S2.E1.m1.6.6.1.1.1.2.3.1.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="S2.E1.m1.6.6.1.1.1.2.3.3" xref="S2.E1.m1.6.6.1.1.1.2.3.3.cmml">𝒴</mi></mrow></munder><mrow id="S2.E1.m1.6.6.1.1.1.1" xref="S2.E1.m1.6.6.1.1.1.1.cmml"><mi id="S2.E1.m1.6.6.1.1.1.1.3" xref="S2.E1.m1.6.6.1.1.1.1.3.cmml">U</mi><mo id="S2.E1.m1.6.6.1.1.1.1.2" xref="S2.E1.m1.6.6.1.1.1.1.2.cmml">⁢</mo><mrow id="S2.E1.m1.6.6.1.1.1.1.4.2" xref="S2.E1.m1.6.6.1.1.1.1.4.1.cmml"><mo id="S2.E1.m1.6.6.1.1.1.1.4.2.1" stretchy="false" xref="S2.E1.m1.6.6.1.1.1.1.4.1.cmml">(</mo><mi id="S2.E1.m1.3.3" xref="S2.E1.m1.3.3.cmml">y</mi><mo id="S2.E1.m1.6.6.1.1.1.1.4.2.2" xref="S2.E1.m1.6.6.1.1.1.1.4.1.cmml">,</mo><mover accent="true" id="S2.E1.m1.4.4" xref="S2.E1.m1.4.4.cmml"><mi id="S2.E1.m1.4.4.2" xref="S2.E1.m1.4.4.2.cmml">y</mi><mo id="S2.E1.m1.4.4.1" xref="S2.E1.m1.4.4.1.cmml">^</mo></mover><mo id="S2.E1.m1.6.6.1.1.1.1.4.2.3" stretchy="false" xref="S2.E1.m1.6.6.1.1.1.1.4.1.cmml">)</mo></mrow><mo id="S2.E1.m1.6.6.1.1.1.1.2a" xref="S2.E1.m1.6.6.1.1.1.1.2.cmml">⁢</mo><mi id="S2.E1.m1.6.6.1.1.1.1.5" xref="S2.E1.m1.6.6.1.1.1.1.5.cmml">p</mi><mo id="S2.E1.m1.6.6.1.1.1.1.2b" xref="S2.E1.m1.6.6.1.1.1.1.2.cmml">⁢</mo><mrow id="S2.E1.m1.6.6.1.1.1.1.1.1" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.cmml"><mo id="S2.E1.m1.6.6.1.1.1.1.1.1.2" stretchy="false" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.E1.m1.6.6.1.1.1.1.1.1.1" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S2.E1.m1.6.6.1.1.1.1.1.1.1.4" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.4.cmml"><mi id="S2.E1.m1.6.6.1.1.1.1.1.1.1.4.2" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.4.2.cmml">y</mi><mo id="S2.E1.m1.6.6.1.1.1.1.1.1.1.4.1" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.4.1.cmml">^</mo></mover><mo fence="false" id="S2.E1.m1.6.6.1.1.1.1.1.1.1.3" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.3.cmml">|</mo><mrow id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.3.cmml"><mi id="S2.E1.m1.5.5" xref="S2.E1.m1.5.5.cmml">x</mi><mo id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.3" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.3.cmml">;</mo><msub id="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.2" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.2.cmml">G</mi><mi id="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.3" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.3.cmml">θ</mi></msub><mo id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.4" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.3.cmml">,</mo><msub id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.cmml"><mi id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.2" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.2.cmml">R</mi><mi id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.3" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.E1.m1.6.6.1.1.1.1.1.1.3" stretchy="false" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E1.m1.6b"><apply id="S2.E1.m1.6.6.cmml" xref="S2.E1.m1.6.6"><eq id="S2.E1.m1.6.6.2.cmml" xref="S2.E1.m1.6.6.2"></eq><ci id="S2.E1.m1.6.6.3a.cmml" xref="S2.E1.m1.6.6.3"><mtext class="ltx_font_smallcaps" id="S2.E1.m1.6.6.3.cmml" xref="S2.E1.m1.6.6.3">RAG Expected Utility</mtext></ci><apply id="S2.E1.m1.6.6.1.cmml" xref="S2.E1.m1.6.6.1"><times id="S2.E1.m1.6.6.1.2.cmml" xref="S2.E1.m1.6.6.1.2"></times><apply id="S2.E1.m1.6.6.1.3.cmml" xref="S2.E1.m1.6.6.1.3"><divide id="S2.E1.m1.6.6.1.3.1.cmml" xref="S2.E1.m1.6.6.1.3"></divide><cn id="S2.E1.m1.6.6.1.3.2.cmml" type="integer" xref="S2.E1.m1.6.6.1.3.2">1</cn><ci id="S2.E1.m1.6.6.1.3.3.cmml" xref="S2.E1.m1.6.6.1.3.3">𝑛</ci></apply><apply id="S2.E1.m1.6.6.1.1.cmml" xref="S2.E1.m1.6.6.1.1"><apply id="S2.E1.m1.6.6.1.1.2.cmml" xref="S2.E1.m1.6.6.1.1.2"><csymbol cd="ambiguous" id="S2.E1.m1.6.6.1.1.2.1.cmml" xref="S2.E1.m1.6.6.1.1.2">subscript</csymbol><sum id="S2.E1.m1.6.6.1.1.2.2.cmml" xref="S2.E1.m1.6.6.1.1.2.2"></sum><apply id="S2.E1.m1.2.2.2.cmml" xref="S2.E1.m1.2.2.2"><in id="S2.E1.m1.2.2.2.3.cmml" xref="S2.E1.m1.2.2.2.3"></in><interval closure="open" id="S2.E1.m1.2.2.2.4.1.cmml" xref="S2.E1.m1.2.2.2.4.2"><ci id="S2.E1.m1.1.1.1.1.cmml" xref="S2.E1.m1.1.1.1.1">𝑥</ci><ci id="S2.E1.m1.2.2.2.2.cmml" xref="S2.E1.m1.2.2.2.2">𝑦</ci></interval><ci id="S2.E1.m1.2.2.2.5.cmml" xref="S2.E1.m1.2.2.2.5">𝑇</ci></apply></apply><apply id="S2.E1.m1.6.6.1.1.1.cmml" xref="S2.E1.m1.6.6.1.1.1"><apply id="S2.E1.m1.6.6.1.1.1.2.cmml" xref="S2.E1.m1.6.6.1.1.1.2"><csymbol cd="ambiguous" id="S2.E1.m1.6.6.1.1.1.2.1.cmml" xref="S2.E1.m1.6.6.1.1.1.2">subscript</csymbol><sum id="S2.E1.m1.6.6.1.1.1.2.2.cmml" xref="S2.E1.m1.6.6.1.1.1.2.2"></sum><apply id="S2.E1.m1.6.6.1.1.1.2.3.cmml" xref="S2.E1.m1.6.6.1.1.1.2.3"><in id="S2.E1.m1.6.6.1.1.1.2.3.1.cmml" xref="S2.E1.m1.6.6.1.1.1.2.3.1"></in><apply id="S2.E1.m1.6.6.1.1.1.2.3.2.cmml" xref="S2.E1.m1.6.6.1.1.1.2.3.2"><ci id="S2.E1.m1.6.6.1.1.1.2.3.2.1.cmml" xref="S2.E1.m1.6.6.1.1.1.2.3.2.1">^</ci><ci id="S2.E1.m1.6.6.1.1.1.2.3.2.2.cmml" xref="S2.E1.m1.6.6.1.1.1.2.3.2.2">𝑦</ci></apply><ci id="S2.E1.m1.6.6.1.1.1.2.3.3.cmml" xref="S2.E1.m1.6.6.1.1.1.2.3.3">𝒴</ci></apply></apply><apply id="S2.E1.m1.6.6.1.1.1.1.cmml" xref="S2.E1.m1.6.6.1.1.1.1"><times id="S2.E1.m1.6.6.1.1.1.1.2.cmml" xref="S2.E1.m1.6.6.1.1.1.1.2"></times><ci id="S2.E1.m1.6.6.1.1.1.1.3.cmml" xref="S2.E1.m1.6.6.1.1.1.1.3">𝑈</ci><interval closure="open" id="S2.E1.m1.6.6.1.1.1.1.4.1.cmml" xref="S2.E1.m1.6.6.1.1.1.1.4.2"><ci id="S2.E1.m1.3.3.cmml" xref="S2.E1.m1.3.3">𝑦</ci><apply id="S2.E1.m1.4.4.cmml" xref="S2.E1.m1.4.4"><ci id="S2.E1.m1.4.4.1.cmml" xref="S2.E1.m1.4.4.1">^</ci><ci id="S2.E1.m1.4.4.2.cmml" xref="S2.E1.m1.4.4.2">𝑦</ci></apply></interval><ci id="S2.E1.m1.6.6.1.1.1.1.5.cmml" xref="S2.E1.m1.6.6.1.1.1.1.5">𝑝</ci><apply id="S2.E1.m1.6.6.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1"><csymbol cd="latexml" id="S2.E1.m1.6.6.1.1.1.1.1.1.1.3.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.3">conditional</csymbol><apply id="S2.E1.m1.6.6.1.1.1.1.1.1.1.4.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.4"><ci id="S2.E1.m1.6.6.1.1.1.1.1.1.1.4.1.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.4.1">^</ci><ci id="S2.E1.m1.6.6.1.1.1.1.1.1.1.4.2.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.4.2">𝑦</ci></apply><list id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.3.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2"><ci id="S2.E1.m1.5.5.cmml" xref="S2.E1.m1.5.5">𝑥</ci><apply id="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.2">𝐺</ci><ci id="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.1.1.1.3">𝜃</ci></apply><apply id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.1.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.2.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.2">𝑅</ci><ci id="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.3.cmml" xref="S2.E1.m1.6.6.1.1.1.1.1.1.1.2.2.2.3">italic-ϕ</ci></apply></list></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E1.m1.6c">\textsc{RAG Expected Utility}=\frac{1}{n}\sum_{(x,y)\in T}\sum_{\hat{y}\in%
\mathcal{Y}}{U(y,\hat{y})p(\hat{y}|x;G_{\theta},R_{\phi})}</annotation><annotation encoding="application/x-llamapun" id="S2.E1.m1.6d">RAG Expected Utility = divide start_ARG 1 end_ARG start_ARG italic_n end_ARG ∑ start_POSTSUBSCRIPT ( italic_x , italic_y ) ∈ italic_T end_POSTSUBSCRIPT ∑ start_POSTSUBSCRIPT over^ start_ARG italic_y end_ARG ∈ caligraphic_Y end_POSTSUBSCRIPT italic_U ( italic_y , over^ start_ARG italic_y end_ARG ) italic_p ( over^ start_ARG italic_y end_ARG | italic_x ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT , italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.p2.11">where <math alttext="\mathcal{Y}" class="ltx_Math" display="inline" id="S2.p2.10.m1.1"><semantics id="S2.p2.10.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S2.p2.10.m1.1.1" xref="S2.p2.10.m1.1.1.cmml">𝒴</mi><annotation-xml encoding="MathML-Content" id="S2.p2.10.m1.1b"><ci id="S2.p2.10.m1.1.1.cmml" xref="S2.p2.10.m1.1.1">𝒴</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.10.m1.1c">\mathcal{Y}</annotation><annotation encoding="application/x-llamapun" id="S2.p2.10.m1.1d">caligraphic_Y</annotation></semantics></math> the output space, i.e., all possible output texts. In some models, the output space is limited, for instance in fact verification, the output space is often binary: the given candidate fact is often true or false. In other situations, such as free-form text generation, the output space is unlimited. To make sure that expected utility calculation is tractable, we would need to approximate the above equation by sampling from the unlimited space <math alttext="\mathcal{Y}" class="ltx_Math" display="inline" id="S2.p2.11.m2.1"><semantics id="S2.p2.11.m2.1a"><mi class="ltx_font_mathcaligraphic" id="S2.p2.11.m2.1.1" xref="S2.p2.11.m2.1.1.cmml">𝒴</mi><annotation-xml encoding="MathML-Content" id="S2.p2.11.m2.1b"><ci id="S2.p2.11.m2.1.1.cmml" xref="S2.p2.11.m2.1.1">𝒴</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.11.m2.1c">\mathcal{Y}</annotation><annotation encoding="application/x-llamapun" id="S2.p2.11.m2.1d">caligraphic_Y</annotation></semantics></math>. We will explain how such samples can be obtained at the end of this section.</p>
</div>
<div class="ltx_para" id="S2.p3">
<p class="ltx_p" id="S2.p3.1">The probability of generating any given output <math alttext="\hat{y}" class="ltx_Math" display="inline" id="S2.p3.1.m1.1"><semantics id="S2.p3.1.m1.1a"><mover accent="true" id="S2.p3.1.m1.1.1" xref="S2.p3.1.m1.1.1.cmml"><mi id="S2.p3.1.m1.1.1.2" xref="S2.p3.1.m1.1.1.2.cmml">y</mi><mo id="S2.p3.1.m1.1.1.1" xref="S2.p3.1.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S2.p3.1.m1.1b"><apply id="S2.p3.1.m1.1.1.cmml" xref="S2.p3.1.m1.1.1"><ci id="S2.p3.1.m1.1.1.1.cmml" xref="S2.p3.1.m1.1.1.1">^</ci><ci id="S2.p3.1.m1.1.1.2.cmml" xref="S2.p3.1.m1.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p3.1.m1.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="S2.p3.1.m1.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math> in a RAG system can be modeled as:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="Sx1.EGx1">
<tbody id="S2.Ex1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle p(\hat{y}|x;G_{\theta},R_{\phi})" class="ltx_Math" display="inline" id="S2.Ex1.m1.2"><semantics id="S2.Ex1.m1.2a"><mrow id="S2.Ex1.m1.2.2" xref="S2.Ex1.m1.2.2.cmml"><mi id="S2.Ex1.m1.2.2.3" xref="S2.Ex1.m1.2.2.3.cmml">p</mi><mo id="S2.Ex1.m1.2.2.2" xref="S2.Ex1.m1.2.2.2.cmml">⁢</mo><mrow id="S2.Ex1.m1.2.2.1.1" xref="S2.Ex1.m1.2.2.1.1.1.cmml"><mo id="S2.Ex1.m1.2.2.1.1.2" stretchy="false" xref="S2.Ex1.m1.2.2.1.1.1.cmml">(</mo><mrow id="S2.Ex1.m1.2.2.1.1.1" xref="S2.Ex1.m1.2.2.1.1.1.cmml"><mover accent="true" id="S2.Ex1.m1.2.2.1.1.1.4" xref="S2.Ex1.m1.2.2.1.1.1.4.cmml"><mi id="S2.Ex1.m1.2.2.1.1.1.4.2" xref="S2.Ex1.m1.2.2.1.1.1.4.2.cmml">y</mi><mo id="S2.Ex1.m1.2.2.1.1.1.4.1" xref="S2.Ex1.m1.2.2.1.1.1.4.1.cmml">^</mo></mover><mo fence="false" id="S2.Ex1.m1.2.2.1.1.1.3" xref="S2.Ex1.m1.2.2.1.1.1.3.cmml">|</mo><mrow id="S2.Ex1.m1.2.2.1.1.1.2.2" xref="S2.Ex1.m1.2.2.1.1.1.2.3.cmml"><mi id="S2.Ex1.m1.1.1" xref="S2.Ex1.m1.1.1.cmml">x</mi><mo id="S2.Ex1.m1.2.2.1.1.1.2.2.3" xref="S2.Ex1.m1.2.2.1.1.1.2.3.cmml">;</mo><msub id="S2.Ex1.m1.2.2.1.1.1.1.1.1" xref="S2.Ex1.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S2.Ex1.m1.2.2.1.1.1.1.1.1.2" xref="S2.Ex1.m1.2.2.1.1.1.1.1.1.2.cmml">G</mi><mi id="S2.Ex1.m1.2.2.1.1.1.1.1.1.3" xref="S2.Ex1.m1.2.2.1.1.1.1.1.1.3.cmml">θ</mi></msub><mo id="S2.Ex1.m1.2.2.1.1.1.2.2.4" xref="S2.Ex1.m1.2.2.1.1.1.2.3.cmml">,</mo><msub id="S2.Ex1.m1.2.2.1.1.1.2.2.2" xref="S2.Ex1.m1.2.2.1.1.1.2.2.2.cmml"><mi id="S2.Ex1.m1.2.2.1.1.1.2.2.2.2" xref="S2.Ex1.m1.2.2.1.1.1.2.2.2.2.cmml">R</mi><mi id="S2.Ex1.m1.2.2.1.1.1.2.2.2.3" xref="S2.Ex1.m1.2.2.1.1.1.2.2.2.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.Ex1.m1.2.2.1.1.3" stretchy="false" xref="S2.Ex1.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex1.m1.2b"><apply id="S2.Ex1.m1.2.2.cmml" xref="S2.Ex1.m1.2.2"><times id="S2.Ex1.m1.2.2.2.cmml" xref="S2.Ex1.m1.2.2.2"></times><ci id="S2.Ex1.m1.2.2.3.cmml" xref="S2.Ex1.m1.2.2.3">𝑝</ci><apply id="S2.Ex1.m1.2.2.1.1.1.cmml" xref="S2.Ex1.m1.2.2.1.1"><csymbol cd="latexml" id="S2.Ex1.m1.2.2.1.1.1.3.cmml" xref="S2.Ex1.m1.2.2.1.1.1.3">conditional</csymbol><apply id="S2.Ex1.m1.2.2.1.1.1.4.cmml" xref="S2.Ex1.m1.2.2.1.1.1.4"><ci id="S2.Ex1.m1.2.2.1.1.1.4.1.cmml" xref="S2.Ex1.m1.2.2.1.1.1.4.1">^</ci><ci id="S2.Ex1.m1.2.2.1.1.1.4.2.cmml" xref="S2.Ex1.m1.2.2.1.1.1.4.2">𝑦</ci></apply><list id="S2.Ex1.m1.2.2.1.1.1.2.3.cmml" xref="S2.Ex1.m1.2.2.1.1.1.2.2"><ci id="S2.Ex1.m1.1.1.cmml" xref="S2.Ex1.m1.1.1">𝑥</ci><apply id="S2.Ex1.m1.2.2.1.1.1.1.1.1.cmml" xref="S2.Ex1.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.Ex1.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S2.Ex1.m1.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S2.Ex1.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S2.Ex1.m1.2.2.1.1.1.1.1.1.2">𝐺</ci><ci id="S2.Ex1.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S2.Ex1.m1.2.2.1.1.1.1.1.1.3">𝜃</ci></apply><apply id="S2.Ex1.m1.2.2.1.1.1.2.2.2.cmml" xref="S2.Ex1.m1.2.2.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.Ex1.m1.2.2.1.1.1.2.2.2.1.cmml" xref="S2.Ex1.m1.2.2.1.1.1.2.2.2">subscript</csymbol><ci id="S2.Ex1.m1.2.2.1.1.1.2.2.2.2.cmml" xref="S2.Ex1.m1.2.2.1.1.1.2.2.2.2">𝑅</ci><ci id="S2.Ex1.m1.2.2.1.1.1.2.2.2.3.cmml" xref="S2.Ex1.m1.2.2.1.1.1.2.2.2.3">italic-ϕ</ci></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex1.m1.2c">\displaystyle p(\hat{y}|x;G_{\theta},R_{\phi})</annotation><annotation encoding="application/x-llamapun" id="S2.Ex1.m1.2d">italic_p ( over^ start_ARG italic_y end_ARG | italic_x ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT , italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\sum_{\mathbf{d}\in\pi_{k}(C)}{p(\hat{y},\mathbf{d}|x;G_{\theta}%
,R_{\phi})}" class="ltx_Math" display="inline" id="S2.Ex1.m2.4"><semantics id="S2.Ex1.m2.4a"><mrow id="S2.Ex1.m2.4.4" xref="S2.Ex1.m2.4.4.cmml"><mi id="S2.Ex1.m2.4.4.3" xref="S2.Ex1.m2.4.4.3.cmml"></mi><mo id="S2.Ex1.m2.4.4.2" xref="S2.Ex1.m2.4.4.2.cmml">=</mo><mrow id="S2.Ex1.m2.4.4.1" xref="S2.Ex1.m2.4.4.1.cmml"><mstyle displaystyle="true" id="S2.Ex1.m2.4.4.1.2" xref="S2.Ex1.m2.4.4.1.2.cmml"><munder id="S2.Ex1.m2.4.4.1.2a" xref="S2.Ex1.m2.4.4.1.2.cmml"><mo id="S2.Ex1.m2.4.4.1.2.2" movablelimits="false" xref="S2.Ex1.m2.4.4.1.2.2.cmml">∑</mo><mrow id="S2.Ex1.m2.1.1.1" xref="S2.Ex1.m2.1.1.1.cmml"><mi id="S2.Ex1.m2.1.1.1.3" xref="S2.Ex1.m2.1.1.1.3.cmml">𝐝</mi><mo id="S2.Ex1.m2.1.1.1.2" xref="S2.Ex1.m2.1.1.1.2.cmml">∈</mo><mrow id="S2.Ex1.m2.1.1.1.4" xref="S2.Ex1.m2.1.1.1.4.cmml"><msub id="S2.Ex1.m2.1.1.1.4.2" xref="S2.Ex1.m2.1.1.1.4.2.cmml"><mi id="S2.Ex1.m2.1.1.1.4.2.2" xref="S2.Ex1.m2.1.1.1.4.2.2.cmml">π</mi><mi id="S2.Ex1.m2.1.1.1.4.2.3" xref="S2.Ex1.m2.1.1.1.4.2.3.cmml">k</mi></msub><mo id="S2.Ex1.m2.1.1.1.4.1" xref="S2.Ex1.m2.1.1.1.4.1.cmml">⁢</mo><mrow id="S2.Ex1.m2.1.1.1.4.3.2" xref="S2.Ex1.m2.1.1.1.4.cmml"><mo id="S2.Ex1.m2.1.1.1.4.3.2.1" stretchy="false" xref="S2.Ex1.m2.1.1.1.4.cmml">(</mo><mi id="S2.Ex1.m2.1.1.1.1" xref="S2.Ex1.m2.1.1.1.1.cmml">C</mi><mo id="S2.Ex1.m2.1.1.1.4.3.2.2" stretchy="false" xref="S2.Ex1.m2.1.1.1.4.cmml">)</mo></mrow></mrow></mrow></munder></mstyle><mrow id="S2.Ex1.m2.4.4.1.1" xref="S2.Ex1.m2.4.4.1.1.cmml"><mi id="S2.Ex1.m2.4.4.1.1.3" xref="S2.Ex1.m2.4.4.1.1.3.cmml">p</mi><mo id="S2.Ex1.m2.4.4.1.1.2" xref="S2.Ex1.m2.4.4.1.1.2.cmml">⁢</mo><mrow id="S2.Ex1.m2.4.4.1.1.1.1" xref="S2.Ex1.m2.4.4.1.1.1.2.cmml"><mo id="S2.Ex1.m2.4.4.1.1.1.1.2" stretchy="false" xref="S2.Ex1.m2.4.4.1.1.1.2.cmml">(</mo><mover accent="true" id="S2.Ex1.m2.3.3" xref="S2.Ex1.m2.3.3.cmml"><mi id="S2.Ex1.m2.3.3.2" xref="S2.Ex1.m2.3.3.2.cmml">y</mi><mo id="S2.Ex1.m2.3.3.1" xref="S2.Ex1.m2.3.3.1.cmml">^</mo></mover><mo id="S2.Ex1.m2.4.4.1.1.1.1.3" xref="S2.Ex1.m2.4.4.1.1.1.2.cmml">,</mo><mrow id="S2.Ex1.m2.4.4.1.1.1.1.1" xref="S2.Ex1.m2.4.4.1.1.1.1.1.cmml"><mi id="S2.Ex1.m2.4.4.1.1.1.1.1.4" xref="S2.Ex1.m2.4.4.1.1.1.1.1.4.cmml">𝐝</mi><mo fence="false" id="S2.Ex1.m2.4.4.1.1.1.1.1.3" xref="S2.Ex1.m2.4.4.1.1.1.1.1.3.cmml">|</mo><mrow id="S2.Ex1.m2.4.4.1.1.1.1.1.2.2" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.3.cmml"><mi id="S2.Ex1.m2.2.2" xref="S2.Ex1.m2.2.2.cmml">x</mi><mo id="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.3" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.3.cmml">;</mo><msub id="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1" xref="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.cmml"><mi id="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.2" xref="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.2.cmml">G</mi><mi id="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.3" xref="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.3.cmml">θ</mi></msub><mo id="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.4" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.3.cmml">,</mo><msub id="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.cmml"><mi id="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.2" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.2.cmml">R</mi><mi id="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.3" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.Ex1.m2.4.4.1.1.1.1.4" stretchy="false" xref="S2.Ex1.m2.4.4.1.1.1.2.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex1.m2.4b"><apply id="S2.Ex1.m2.4.4.cmml" xref="S2.Ex1.m2.4.4"><eq id="S2.Ex1.m2.4.4.2.cmml" xref="S2.Ex1.m2.4.4.2"></eq><csymbol cd="latexml" id="S2.Ex1.m2.4.4.3.cmml" xref="S2.Ex1.m2.4.4.3">absent</csymbol><apply id="S2.Ex1.m2.4.4.1.cmml" xref="S2.Ex1.m2.4.4.1"><apply id="S2.Ex1.m2.4.4.1.2.cmml" xref="S2.Ex1.m2.4.4.1.2"><csymbol cd="ambiguous" id="S2.Ex1.m2.4.4.1.2.1.cmml" xref="S2.Ex1.m2.4.4.1.2">subscript</csymbol><sum id="S2.Ex1.m2.4.4.1.2.2.cmml" xref="S2.Ex1.m2.4.4.1.2.2"></sum><apply id="S2.Ex1.m2.1.1.1.cmml" xref="S2.Ex1.m2.1.1.1"><in id="S2.Ex1.m2.1.1.1.2.cmml" xref="S2.Ex1.m2.1.1.1.2"></in><ci id="S2.Ex1.m2.1.1.1.3.cmml" xref="S2.Ex1.m2.1.1.1.3">𝐝</ci><apply id="S2.Ex1.m2.1.1.1.4.cmml" xref="S2.Ex1.m2.1.1.1.4"><times id="S2.Ex1.m2.1.1.1.4.1.cmml" xref="S2.Ex1.m2.1.1.1.4.1"></times><apply id="S2.Ex1.m2.1.1.1.4.2.cmml" xref="S2.Ex1.m2.1.1.1.4.2"><csymbol cd="ambiguous" id="S2.Ex1.m2.1.1.1.4.2.1.cmml" xref="S2.Ex1.m2.1.1.1.4.2">subscript</csymbol><ci id="S2.Ex1.m2.1.1.1.4.2.2.cmml" xref="S2.Ex1.m2.1.1.1.4.2.2">𝜋</ci><ci id="S2.Ex1.m2.1.1.1.4.2.3.cmml" xref="S2.Ex1.m2.1.1.1.4.2.3">𝑘</ci></apply><ci id="S2.Ex1.m2.1.1.1.1.cmml" xref="S2.Ex1.m2.1.1.1.1">𝐶</ci></apply></apply></apply><apply id="S2.Ex1.m2.4.4.1.1.cmml" xref="S2.Ex1.m2.4.4.1.1"><times id="S2.Ex1.m2.4.4.1.1.2.cmml" xref="S2.Ex1.m2.4.4.1.1.2"></times><ci id="S2.Ex1.m2.4.4.1.1.3.cmml" xref="S2.Ex1.m2.4.4.1.1.3">𝑝</ci><interval closure="open" id="S2.Ex1.m2.4.4.1.1.1.2.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1"><apply id="S2.Ex1.m2.3.3.cmml" xref="S2.Ex1.m2.3.3"><ci id="S2.Ex1.m2.3.3.1.cmml" xref="S2.Ex1.m2.3.3.1">^</ci><ci id="S2.Ex1.m2.3.3.2.cmml" xref="S2.Ex1.m2.3.3.2">𝑦</ci></apply><apply id="S2.Ex1.m2.4.4.1.1.1.1.1.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1"><csymbol cd="latexml" id="S2.Ex1.m2.4.4.1.1.1.1.1.3.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.3">conditional</csymbol><ci id="S2.Ex1.m2.4.4.1.1.1.1.1.4.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.4">𝐝</ci><list id="S2.Ex1.m2.4.4.1.1.1.1.1.2.3.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.2"><ci id="S2.Ex1.m2.2.2.cmml" xref="S2.Ex1.m2.2.2">𝑥</ci><apply id="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.1.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.2.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.2">𝐺</ci><ci id="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.3.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.1.1.1.3">𝜃</ci></apply><apply id="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.1.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.2.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.2">𝑅</ci><ci id="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.3.cmml" xref="S2.Ex1.m2.4.4.1.1.1.1.1.2.2.2.3">italic-ϕ</ci></apply></list></apply></interval></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex1.m2.4c">\displaystyle=\sum_{\mathbf{d}\in\pi_{k}(C)}{p(\hat{y},\mathbf{d}|x;G_{\theta}%
,R_{\phi})}</annotation><annotation encoding="application/x-llamapun" id="S2.Ex1.m2.4d">= ∑ start_POSTSUBSCRIPT bold_d ∈ italic_π start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_C ) end_POSTSUBSCRIPT italic_p ( over^ start_ARG italic_y end_ARG , bold_d | italic_x ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT , italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S2.Ex2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\sum_{\mathbf{d}\in\pi_{k}(C)}{p(\hat{y}|x,\mathbf{d};G_{\theta}%
)p(\mathbf{d}|x;G_{\theta},R_{\phi})}" class="ltx_Math" display="inline" id="S2.Ex2.m1.6"><semantics id="S2.Ex2.m1.6a"><mrow id="S2.Ex2.m1.6.6" xref="S2.Ex2.m1.6.6.cmml"><mi id="S2.Ex2.m1.6.6.4" xref="S2.Ex2.m1.6.6.4.cmml"></mi><mo id="S2.Ex2.m1.6.6.3" xref="S2.Ex2.m1.6.6.3.cmml">=</mo><mrow id="S2.Ex2.m1.6.6.2" xref="S2.Ex2.m1.6.6.2.cmml"><mstyle displaystyle="true" id="S2.Ex2.m1.6.6.2.3" xref="S2.Ex2.m1.6.6.2.3.cmml"><munder id="S2.Ex2.m1.6.6.2.3a" xref="S2.Ex2.m1.6.6.2.3.cmml"><mo id="S2.Ex2.m1.6.6.2.3.2" movablelimits="false" xref="S2.Ex2.m1.6.6.2.3.2.cmml">∑</mo><mrow id="S2.Ex2.m1.1.1.1" xref="S2.Ex2.m1.1.1.1.cmml"><mi id="S2.Ex2.m1.1.1.1.3" xref="S2.Ex2.m1.1.1.1.3.cmml">𝐝</mi><mo id="S2.Ex2.m1.1.1.1.2" xref="S2.Ex2.m1.1.1.1.2.cmml">∈</mo><mrow id="S2.Ex2.m1.1.1.1.4" xref="S2.Ex2.m1.1.1.1.4.cmml"><msub id="S2.Ex2.m1.1.1.1.4.2" xref="S2.Ex2.m1.1.1.1.4.2.cmml"><mi id="S2.Ex2.m1.1.1.1.4.2.2" xref="S2.Ex2.m1.1.1.1.4.2.2.cmml">π</mi><mi id="S2.Ex2.m1.1.1.1.4.2.3" xref="S2.Ex2.m1.1.1.1.4.2.3.cmml">k</mi></msub><mo id="S2.Ex2.m1.1.1.1.4.1" xref="S2.Ex2.m1.1.1.1.4.1.cmml">⁢</mo><mrow id="S2.Ex2.m1.1.1.1.4.3.2" xref="S2.Ex2.m1.1.1.1.4.cmml"><mo id="S2.Ex2.m1.1.1.1.4.3.2.1" stretchy="false" xref="S2.Ex2.m1.1.1.1.4.cmml">(</mo><mi id="S2.Ex2.m1.1.1.1.1" xref="S2.Ex2.m1.1.1.1.1.cmml">C</mi><mo id="S2.Ex2.m1.1.1.1.4.3.2.2" stretchy="false" xref="S2.Ex2.m1.1.1.1.4.cmml">)</mo></mrow></mrow></mrow></munder></mstyle><mrow id="S2.Ex2.m1.6.6.2.2" xref="S2.Ex2.m1.6.6.2.2.cmml"><mi id="S2.Ex2.m1.6.6.2.2.4" xref="S2.Ex2.m1.6.6.2.2.4.cmml">p</mi><mo id="S2.Ex2.m1.6.6.2.2.3" xref="S2.Ex2.m1.6.6.2.2.3.cmml">⁢</mo><mrow id="S2.Ex2.m1.5.5.1.1.1.1" xref="S2.Ex2.m1.5.5.1.1.1.1.1.cmml"><mo id="S2.Ex2.m1.5.5.1.1.1.1.2" stretchy="false" xref="S2.Ex2.m1.5.5.1.1.1.1.1.cmml">(</mo><mrow id="S2.Ex2.m1.5.5.1.1.1.1.1" xref="S2.Ex2.m1.5.5.1.1.1.1.1.cmml"><mover accent="true" id="S2.Ex2.m1.5.5.1.1.1.1.1.3" xref="S2.Ex2.m1.5.5.1.1.1.1.1.3.cmml"><mi id="S2.Ex2.m1.5.5.1.1.1.1.1.3.2" xref="S2.Ex2.m1.5.5.1.1.1.1.1.3.2.cmml">y</mi><mo id="S2.Ex2.m1.5.5.1.1.1.1.1.3.1" xref="S2.Ex2.m1.5.5.1.1.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="S2.Ex2.m1.5.5.1.1.1.1.1.2" xref="S2.Ex2.m1.5.5.1.1.1.1.1.2.cmml">|</mo><mrow id="S2.Ex2.m1.5.5.1.1.1.1.1.1.1" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.2.cmml"><mi id="S2.Ex2.m1.2.2" xref="S2.Ex2.m1.2.2.cmml">x</mi><mo id="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.2" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.2.cmml">,</mo><mi id="S2.Ex2.m1.3.3" xref="S2.Ex2.m1.3.3.cmml">𝐝</mi><mo id="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.3" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.2.cmml">;</mo><msub id="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.cmml"><mi id="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.2" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.2.cmml">G</mi><mi id="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.3" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.3.cmml">θ</mi></msub></mrow></mrow><mo id="S2.Ex2.m1.5.5.1.1.1.1.3" stretchy="false" xref="S2.Ex2.m1.5.5.1.1.1.1.1.cmml">)</mo></mrow><mo id="S2.Ex2.m1.6.6.2.2.3a" xref="S2.Ex2.m1.6.6.2.2.3.cmml">⁢</mo><mi id="S2.Ex2.m1.6.6.2.2.5" xref="S2.Ex2.m1.6.6.2.2.5.cmml">p</mi><mo id="S2.Ex2.m1.6.6.2.2.3b" xref="S2.Ex2.m1.6.6.2.2.3.cmml">⁢</mo><mrow id="S2.Ex2.m1.6.6.2.2.2.1" xref="S2.Ex2.m1.6.6.2.2.2.1.1.cmml"><mo id="S2.Ex2.m1.6.6.2.2.2.1.2" stretchy="false" xref="S2.Ex2.m1.6.6.2.2.2.1.1.cmml">(</mo><mrow id="S2.Ex2.m1.6.6.2.2.2.1.1" xref="S2.Ex2.m1.6.6.2.2.2.1.1.cmml"><mi id="S2.Ex2.m1.6.6.2.2.2.1.1.4" xref="S2.Ex2.m1.6.6.2.2.2.1.1.4.cmml">𝐝</mi><mo fence="false" id="S2.Ex2.m1.6.6.2.2.2.1.1.3" xref="S2.Ex2.m1.6.6.2.2.2.1.1.3.cmml">|</mo><mrow id="S2.Ex2.m1.6.6.2.2.2.1.1.2.2" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.3.cmml"><mi id="S2.Ex2.m1.4.4" xref="S2.Ex2.m1.4.4.cmml">x</mi><mo id="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.3" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.3.cmml">;</mo><msub id="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1" xref="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.cmml"><mi id="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.2" xref="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.2.cmml">G</mi><mi id="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.3" xref="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.3.cmml">θ</mi></msub><mo id="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.4" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.3.cmml">,</mo><msub id="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.cmml"><mi id="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.2" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.2.cmml">R</mi><mi id="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.3" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.Ex2.m1.6.6.2.2.2.1.3" stretchy="false" xref="S2.Ex2.m1.6.6.2.2.2.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex2.m1.6b"><apply id="S2.Ex2.m1.6.6.cmml" xref="S2.Ex2.m1.6.6"><eq id="S2.Ex2.m1.6.6.3.cmml" xref="S2.Ex2.m1.6.6.3"></eq><csymbol cd="latexml" id="S2.Ex2.m1.6.6.4.cmml" xref="S2.Ex2.m1.6.6.4">absent</csymbol><apply id="S2.Ex2.m1.6.6.2.cmml" xref="S2.Ex2.m1.6.6.2"><apply id="S2.Ex2.m1.6.6.2.3.cmml" xref="S2.Ex2.m1.6.6.2.3"><csymbol cd="ambiguous" id="S2.Ex2.m1.6.6.2.3.1.cmml" xref="S2.Ex2.m1.6.6.2.3">subscript</csymbol><sum id="S2.Ex2.m1.6.6.2.3.2.cmml" xref="S2.Ex2.m1.6.6.2.3.2"></sum><apply id="S2.Ex2.m1.1.1.1.cmml" xref="S2.Ex2.m1.1.1.1"><in id="S2.Ex2.m1.1.1.1.2.cmml" xref="S2.Ex2.m1.1.1.1.2"></in><ci id="S2.Ex2.m1.1.1.1.3.cmml" xref="S2.Ex2.m1.1.1.1.3">𝐝</ci><apply id="S2.Ex2.m1.1.1.1.4.cmml" xref="S2.Ex2.m1.1.1.1.4"><times id="S2.Ex2.m1.1.1.1.4.1.cmml" xref="S2.Ex2.m1.1.1.1.4.1"></times><apply id="S2.Ex2.m1.1.1.1.4.2.cmml" xref="S2.Ex2.m1.1.1.1.4.2"><csymbol cd="ambiguous" id="S2.Ex2.m1.1.1.1.4.2.1.cmml" xref="S2.Ex2.m1.1.1.1.4.2">subscript</csymbol><ci id="S2.Ex2.m1.1.1.1.4.2.2.cmml" xref="S2.Ex2.m1.1.1.1.4.2.2">𝜋</ci><ci id="S2.Ex2.m1.1.1.1.4.2.3.cmml" xref="S2.Ex2.m1.1.1.1.4.2.3">𝑘</ci></apply><ci id="S2.Ex2.m1.1.1.1.1.cmml" xref="S2.Ex2.m1.1.1.1.1">𝐶</ci></apply></apply></apply><apply id="S2.Ex2.m1.6.6.2.2.cmml" xref="S2.Ex2.m1.6.6.2.2"><times id="S2.Ex2.m1.6.6.2.2.3.cmml" xref="S2.Ex2.m1.6.6.2.2.3"></times><ci id="S2.Ex2.m1.6.6.2.2.4.cmml" xref="S2.Ex2.m1.6.6.2.2.4">𝑝</ci><apply id="S2.Ex2.m1.5.5.1.1.1.1.1.cmml" xref="S2.Ex2.m1.5.5.1.1.1.1"><csymbol cd="latexml" id="S2.Ex2.m1.5.5.1.1.1.1.1.2.cmml" xref="S2.Ex2.m1.5.5.1.1.1.1.1.2">conditional</csymbol><apply id="S2.Ex2.m1.5.5.1.1.1.1.1.3.cmml" xref="S2.Ex2.m1.5.5.1.1.1.1.1.3"><ci id="S2.Ex2.m1.5.5.1.1.1.1.1.3.1.cmml" xref="S2.Ex2.m1.5.5.1.1.1.1.1.3.1">^</ci><ci id="S2.Ex2.m1.5.5.1.1.1.1.1.3.2.cmml" xref="S2.Ex2.m1.5.5.1.1.1.1.1.3.2">𝑦</ci></apply><list id="S2.Ex2.m1.5.5.1.1.1.1.1.1.2.cmml" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.1"><ci id="S2.Ex2.m1.2.2.cmml" xref="S2.Ex2.m1.2.2">𝑥</ci><ci id="S2.Ex2.m1.3.3.cmml" xref="S2.Ex2.m1.3.3">𝐝</ci><apply id="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.cmml" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.1.cmml" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.2.cmml" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.2">𝐺</ci><ci id="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.3.cmml" xref="S2.Ex2.m1.5.5.1.1.1.1.1.1.1.1.3">𝜃</ci></apply></list></apply><ci id="S2.Ex2.m1.6.6.2.2.5.cmml" xref="S2.Ex2.m1.6.6.2.2.5">𝑝</ci><apply id="S2.Ex2.m1.6.6.2.2.2.1.1.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1"><csymbol cd="latexml" id="S2.Ex2.m1.6.6.2.2.2.1.1.3.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.3">conditional</csymbol><ci id="S2.Ex2.m1.6.6.2.2.2.1.1.4.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.4">𝐝</ci><list id="S2.Ex2.m1.6.6.2.2.2.1.1.2.3.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.2"><ci id="S2.Ex2.m1.4.4.cmml" xref="S2.Ex2.m1.4.4">𝑥</ci><apply id="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.1.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1">subscript</csymbol><ci id="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.2.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.2">𝐺</ci><ci id="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.3.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.1.1.1.3">𝜃</ci></apply><apply id="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.1.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2">subscript</csymbol><ci id="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.2.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.2">𝑅</ci><ci id="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.3.cmml" xref="S2.Ex2.m1.6.6.2.2.2.1.1.2.2.2.3">italic-ϕ</ci></apply></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex2.m1.6c">\displaystyle=\sum_{\mathbf{d}\in\pi_{k}(C)}{p(\hat{y}|x,\mathbf{d};G_{\theta}%
)p(\mathbf{d}|x;G_{\theta},R_{\phi})}</annotation><annotation encoding="application/x-llamapun" id="S2.Ex2.m1.6d">= ∑ start_POSTSUBSCRIPT bold_d ∈ italic_π start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_C ) end_POSTSUBSCRIPT italic_p ( over^ start_ARG italic_y end_ARG | italic_x , bold_d ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ) italic_p ( bold_d | italic_x ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT , italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S2.E2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(2)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\sum_{\mathbf{d}\in\pi_{k}(C)}{p(\hat{y}|x,\mathbf{d};G_{\theta}%
)p(\mathbf{d}|x;R_{\phi})}" class="ltx_Math" display="inline" id="S2.E2.m1.6"><semantics id="S2.E2.m1.6a"><mrow id="S2.E2.m1.6.6" xref="S2.E2.m1.6.6.cmml"><mi id="S2.E2.m1.6.6.4" xref="S2.E2.m1.6.6.4.cmml"></mi><mo id="S2.E2.m1.6.6.3" xref="S2.E2.m1.6.6.3.cmml">=</mo><mrow id="S2.E2.m1.6.6.2" xref="S2.E2.m1.6.6.2.cmml"><mstyle displaystyle="true" id="S2.E2.m1.6.6.2.3" xref="S2.E2.m1.6.6.2.3.cmml"><munder id="S2.E2.m1.6.6.2.3a" xref="S2.E2.m1.6.6.2.3.cmml"><mo id="S2.E2.m1.6.6.2.3.2" movablelimits="false" xref="S2.E2.m1.6.6.2.3.2.cmml">∑</mo><mrow id="S2.E2.m1.1.1.1" xref="S2.E2.m1.1.1.1.cmml"><mi id="S2.E2.m1.1.1.1.3" xref="S2.E2.m1.1.1.1.3.cmml">𝐝</mi><mo id="S2.E2.m1.1.1.1.2" xref="S2.E2.m1.1.1.1.2.cmml">∈</mo><mrow id="S2.E2.m1.1.1.1.4" xref="S2.E2.m1.1.1.1.4.cmml"><msub id="S2.E2.m1.1.1.1.4.2" xref="S2.E2.m1.1.1.1.4.2.cmml"><mi id="S2.E2.m1.1.1.1.4.2.2" xref="S2.E2.m1.1.1.1.4.2.2.cmml">π</mi><mi id="S2.E2.m1.1.1.1.4.2.3" xref="S2.E2.m1.1.1.1.4.2.3.cmml">k</mi></msub><mo id="S2.E2.m1.1.1.1.4.1" xref="S2.E2.m1.1.1.1.4.1.cmml">⁢</mo><mrow id="S2.E2.m1.1.1.1.4.3.2" xref="S2.E2.m1.1.1.1.4.cmml"><mo id="S2.E2.m1.1.1.1.4.3.2.1" stretchy="false" xref="S2.E2.m1.1.1.1.4.cmml">(</mo><mi id="S2.E2.m1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.cmml">C</mi><mo id="S2.E2.m1.1.1.1.4.3.2.2" stretchy="false" xref="S2.E2.m1.1.1.1.4.cmml">)</mo></mrow></mrow></mrow></munder></mstyle><mrow id="S2.E2.m1.6.6.2.2" xref="S2.E2.m1.6.6.2.2.cmml"><mi id="S2.E2.m1.6.6.2.2.4" xref="S2.E2.m1.6.6.2.2.4.cmml">p</mi><mo id="S2.E2.m1.6.6.2.2.3" xref="S2.E2.m1.6.6.2.2.3.cmml">⁢</mo><mrow id="S2.E2.m1.5.5.1.1.1.1" xref="S2.E2.m1.5.5.1.1.1.1.1.cmml"><mo id="S2.E2.m1.5.5.1.1.1.1.2" stretchy="false" xref="S2.E2.m1.5.5.1.1.1.1.1.cmml">(</mo><mrow id="S2.E2.m1.5.5.1.1.1.1.1" xref="S2.E2.m1.5.5.1.1.1.1.1.cmml"><mover accent="true" id="S2.E2.m1.5.5.1.1.1.1.1.3" xref="S2.E2.m1.5.5.1.1.1.1.1.3.cmml"><mi id="S2.E2.m1.5.5.1.1.1.1.1.3.2" xref="S2.E2.m1.5.5.1.1.1.1.1.3.2.cmml">y</mi><mo id="S2.E2.m1.5.5.1.1.1.1.1.3.1" xref="S2.E2.m1.5.5.1.1.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="S2.E2.m1.5.5.1.1.1.1.1.2" xref="S2.E2.m1.5.5.1.1.1.1.1.2.cmml">|</mo><mrow id="S2.E2.m1.5.5.1.1.1.1.1.1.1" xref="S2.E2.m1.5.5.1.1.1.1.1.1.2.cmml"><mi id="S2.E2.m1.2.2" xref="S2.E2.m1.2.2.cmml">x</mi><mo id="S2.E2.m1.5.5.1.1.1.1.1.1.1.2" xref="S2.E2.m1.5.5.1.1.1.1.1.1.2.cmml">,</mo><mi id="S2.E2.m1.3.3" xref="S2.E2.m1.3.3.cmml">𝐝</mi><mo id="S2.E2.m1.5.5.1.1.1.1.1.1.1.3" xref="S2.E2.m1.5.5.1.1.1.1.1.1.2.cmml">;</mo><msub id="S2.E2.m1.5.5.1.1.1.1.1.1.1.1" xref="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.cmml"><mi id="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.2" xref="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.2.cmml">G</mi><mi id="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.3" xref="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.3.cmml">θ</mi></msub></mrow></mrow><mo id="S2.E2.m1.5.5.1.1.1.1.3" stretchy="false" xref="S2.E2.m1.5.5.1.1.1.1.1.cmml">)</mo></mrow><mo id="S2.E2.m1.6.6.2.2.3a" xref="S2.E2.m1.6.6.2.2.3.cmml">⁢</mo><mi id="S2.E2.m1.6.6.2.2.5" xref="S2.E2.m1.6.6.2.2.5.cmml">p</mi><mo id="S2.E2.m1.6.6.2.2.3b" xref="S2.E2.m1.6.6.2.2.3.cmml">⁢</mo><mrow id="S2.E2.m1.6.6.2.2.2.1" xref="S2.E2.m1.6.6.2.2.2.1.1.cmml"><mo id="S2.E2.m1.6.6.2.2.2.1.2" stretchy="false" xref="S2.E2.m1.6.6.2.2.2.1.1.cmml">(</mo><mrow id="S2.E2.m1.6.6.2.2.2.1.1" xref="S2.E2.m1.6.6.2.2.2.1.1.cmml"><mi id="S2.E2.m1.6.6.2.2.2.1.1.3" xref="S2.E2.m1.6.6.2.2.2.1.1.3.cmml">𝐝</mi><mo fence="false" id="S2.E2.m1.6.6.2.2.2.1.1.2" xref="S2.E2.m1.6.6.2.2.2.1.1.2.cmml">|</mo><mrow id="S2.E2.m1.6.6.2.2.2.1.1.1.1" xref="S2.E2.m1.6.6.2.2.2.1.1.1.2.cmml"><mi id="S2.E2.m1.4.4" xref="S2.E2.m1.4.4.cmml">x</mi><mo id="S2.E2.m1.6.6.2.2.2.1.1.1.1.2" xref="S2.E2.m1.6.6.2.2.2.1.1.1.2.cmml">;</mo><msub id="S2.E2.m1.6.6.2.2.2.1.1.1.1.1" xref="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.cmml"><mi id="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.2" xref="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.2.cmml">R</mi><mi id="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.3" xref="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.E2.m1.6.6.2.2.2.1.3" stretchy="false" xref="S2.E2.m1.6.6.2.2.2.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E2.m1.6b"><apply id="S2.E2.m1.6.6.cmml" xref="S2.E2.m1.6.6"><eq id="S2.E2.m1.6.6.3.cmml" xref="S2.E2.m1.6.6.3"></eq><csymbol cd="latexml" id="S2.E2.m1.6.6.4.cmml" xref="S2.E2.m1.6.6.4">absent</csymbol><apply id="S2.E2.m1.6.6.2.cmml" xref="S2.E2.m1.6.6.2"><apply id="S2.E2.m1.6.6.2.3.cmml" xref="S2.E2.m1.6.6.2.3"><csymbol cd="ambiguous" id="S2.E2.m1.6.6.2.3.1.cmml" xref="S2.E2.m1.6.6.2.3">subscript</csymbol><sum id="S2.E2.m1.6.6.2.3.2.cmml" xref="S2.E2.m1.6.6.2.3.2"></sum><apply id="S2.E2.m1.1.1.1.cmml" xref="S2.E2.m1.1.1.1"><in id="S2.E2.m1.1.1.1.2.cmml" xref="S2.E2.m1.1.1.1.2"></in><ci id="S2.E2.m1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.3">𝐝</ci><apply id="S2.E2.m1.1.1.1.4.cmml" xref="S2.E2.m1.1.1.1.4"><times id="S2.E2.m1.1.1.1.4.1.cmml" xref="S2.E2.m1.1.1.1.4.1"></times><apply id="S2.E2.m1.1.1.1.4.2.cmml" xref="S2.E2.m1.1.1.1.4.2"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.4.2.1.cmml" xref="S2.E2.m1.1.1.1.4.2">subscript</csymbol><ci id="S2.E2.m1.1.1.1.4.2.2.cmml" xref="S2.E2.m1.1.1.1.4.2.2">𝜋</ci><ci id="S2.E2.m1.1.1.1.4.2.3.cmml" xref="S2.E2.m1.1.1.1.4.2.3">𝑘</ci></apply><ci id="S2.E2.m1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1">𝐶</ci></apply></apply></apply><apply id="S2.E2.m1.6.6.2.2.cmml" xref="S2.E2.m1.6.6.2.2"><times id="S2.E2.m1.6.6.2.2.3.cmml" xref="S2.E2.m1.6.6.2.2.3"></times><ci id="S2.E2.m1.6.6.2.2.4.cmml" xref="S2.E2.m1.6.6.2.2.4">𝑝</ci><apply id="S2.E2.m1.5.5.1.1.1.1.1.cmml" xref="S2.E2.m1.5.5.1.1.1.1"><csymbol cd="latexml" id="S2.E2.m1.5.5.1.1.1.1.1.2.cmml" xref="S2.E2.m1.5.5.1.1.1.1.1.2">conditional</csymbol><apply id="S2.E2.m1.5.5.1.1.1.1.1.3.cmml" xref="S2.E2.m1.5.5.1.1.1.1.1.3"><ci id="S2.E2.m1.5.5.1.1.1.1.1.3.1.cmml" xref="S2.E2.m1.5.5.1.1.1.1.1.3.1">^</ci><ci id="S2.E2.m1.5.5.1.1.1.1.1.3.2.cmml" xref="S2.E2.m1.5.5.1.1.1.1.1.3.2">𝑦</ci></apply><list id="S2.E2.m1.5.5.1.1.1.1.1.1.2.cmml" xref="S2.E2.m1.5.5.1.1.1.1.1.1.1"><ci id="S2.E2.m1.2.2.cmml" xref="S2.E2.m1.2.2">𝑥</ci><ci id="S2.E2.m1.3.3.cmml" xref="S2.E2.m1.3.3">𝐝</ci><apply id="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.cmml" xref="S2.E2.m1.5.5.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E2.m1.5.5.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.2">𝐺</ci><ci id="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E2.m1.5.5.1.1.1.1.1.1.1.1.3">𝜃</ci></apply></list></apply><ci id="S2.E2.m1.6.6.2.2.5.cmml" xref="S2.E2.m1.6.6.2.2.5">𝑝</ci><apply id="S2.E2.m1.6.6.2.2.2.1.1.cmml" xref="S2.E2.m1.6.6.2.2.2.1"><csymbol cd="latexml" id="S2.E2.m1.6.6.2.2.2.1.1.2.cmml" xref="S2.E2.m1.6.6.2.2.2.1.1.2">conditional</csymbol><ci id="S2.E2.m1.6.6.2.2.2.1.1.3.cmml" xref="S2.E2.m1.6.6.2.2.2.1.1.3">𝐝</ci><list id="S2.E2.m1.6.6.2.2.2.1.1.1.2.cmml" xref="S2.E2.m1.6.6.2.2.2.1.1.1.1"><ci id="S2.E2.m1.4.4.cmml" xref="S2.E2.m1.4.4">𝑥</ci><apply id="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.cmml" xref="S2.E2.m1.6.6.2.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.1.cmml" xref="S2.E2.m1.6.6.2.2.2.1.1.1.1.1">subscript</csymbol><ci id="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.2.cmml" xref="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.2">𝑅</ci><ci id="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.3.cmml" xref="S2.E2.m1.6.6.2.2.2.1.1.1.1.1.3">italic-ϕ</ci></apply></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E2.m1.6c">\displaystyle=\sum_{\mathbf{d}\in\pi_{k}(C)}{p(\hat{y}|x,\mathbf{d};G_{\theta}%
)p(\mathbf{d}|x;R_{\phi})}</annotation><annotation encoding="application/x-llamapun" id="S2.E2.m1.6d">= ∑ start_POSTSUBSCRIPT bold_d ∈ italic_π start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_C ) end_POSTSUBSCRIPT italic_p ( over^ start_ARG italic_y end_ARG | italic_x , bold_d ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ) italic_p ( bold_d | italic_x ; italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.p3.6">where <math alttext="\pi_{k}(C)" class="ltx_Math" display="inline" id="S2.p3.2.m1.1"><semantics id="S2.p3.2.m1.1a"><mrow id="S2.p3.2.m1.1.2" xref="S2.p3.2.m1.1.2.cmml"><msub id="S2.p3.2.m1.1.2.2" xref="S2.p3.2.m1.1.2.2.cmml"><mi id="S2.p3.2.m1.1.2.2.2" xref="S2.p3.2.m1.1.2.2.2.cmml">π</mi><mi id="S2.p3.2.m1.1.2.2.3" xref="S2.p3.2.m1.1.2.2.3.cmml">k</mi></msub><mo id="S2.p3.2.m1.1.2.1" xref="S2.p3.2.m1.1.2.1.cmml">⁢</mo><mrow id="S2.p3.2.m1.1.2.3.2" xref="S2.p3.2.m1.1.2.cmml"><mo id="S2.p3.2.m1.1.2.3.2.1" stretchy="false" xref="S2.p3.2.m1.1.2.cmml">(</mo><mi id="S2.p3.2.m1.1.1" xref="S2.p3.2.m1.1.1.cmml">C</mi><mo id="S2.p3.2.m1.1.2.3.2.2" stretchy="false" xref="S2.p3.2.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p3.2.m1.1b"><apply id="S2.p3.2.m1.1.2.cmml" xref="S2.p3.2.m1.1.2"><times id="S2.p3.2.m1.1.2.1.cmml" xref="S2.p3.2.m1.1.2.1"></times><apply id="S2.p3.2.m1.1.2.2.cmml" xref="S2.p3.2.m1.1.2.2"><csymbol cd="ambiguous" id="S2.p3.2.m1.1.2.2.1.cmml" xref="S2.p3.2.m1.1.2.2">subscript</csymbol><ci id="S2.p3.2.m1.1.2.2.2.cmml" xref="S2.p3.2.m1.1.2.2.2">𝜋</ci><ci id="S2.p3.2.m1.1.2.2.3.cmml" xref="S2.p3.2.m1.1.2.2.3">𝑘</ci></apply><ci id="S2.p3.2.m1.1.1.cmml" xref="S2.p3.2.m1.1.1">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p3.2.m1.1c">\pi_{k}(C)</annotation><annotation encoding="application/x-llamapun" id="S2.p3.2.m1.1d">italic_π start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_C )</annotation></semantics></math> denotes all permutations of <math alttext="k" class="ltx_Math" display="inline" id="S2.p3.3.m2.1"><semantics id="S2.p3.3.m2.1a"><mi id="S2.p3.3.m2.1.1" xref="S2.p3.3.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.p3.3.m2.1b"><ci id="S2.p3.3.m2.1.1.cmml" xref="S2.p3.3.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p3.3.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.p3.3.m2.1d">italic_k</annotation></semantics></math> documents being selected from the retrieval collection <math alttext="C" class="ltx_Math" display="inline" id="S2.p3.4.m3.1"><semantics id="S2.p3.4.m3.1a"><mi id="S2.p3.4.m3.1.1" xref="S2.p3.4.m3.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S2.p3.4.m3.1b"><ci id="S2.p3.4.m3.1.1.cmml" xref="S2.p3.4.m3.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p3.4.m3.1c">C</annotation><annotation encoding="application/x-llamapun" id="S2.p3.4.m3.1d">italic_C</annotation></semantics></math>. The first step in the above equation is obtained using the law of total probability, the second step is obtained using the chain rule, and the third step is obtained due to the fact that the probability of a result list <math alttext="\mathbf{d}" class="ltx_Math" display="inline" id="S2.p3.5.m4.1"><semantics id="S2.p3.5.m4.1a"><mi id="S2.p3.5.m4.1.1" xref="S2.p3.5.m4.1.1.cmml">𝐝</mi><annotation-xml encoding="MathML-Content" id="S2.p3.5.m4.1b"><ci id="S2.p3.5.m4.1.1.cmml" xref="S2.p3.5.m4.1.1">𝐝</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p3.5.m4.1c">\mathbf{d}</annotation><annotation encoding="application/x-llamapun" id="S2.p3.5.m4.1d">bold_d</annotation></semantics></math> being retrieved is independent of the text generation model <math alttext="G_{\theta}" class="ltx_Math" display="inline" id="S2.p3.6.m5.1"><semantics id="S2.p3.6.m5.1a"><msub id="S2.p3.6.m5.1.1" xref="S2.p3.6.m5.1.1.cmml"><mi id="S2.p3.6.m5.1.1.2" xref="S2.p3.6.m5.1.1.2.cmml">G</mi><mi id="S2.p3.6.m5.1.1.3" xref="S2.p3.6.m5.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p3.6.m5.1b"><apply id="S2.p3.6.m5.1.1.cmml" xref="S2.p3.6.m5.1.1"><csymbol cd="ambiguous" id="S2.p3.6.m5.1.1.1.cmml" xref="S2.p3.6.m5.1.1">subscript</csymbol><ci id="S2.p3.6.m5.1.1.2.cmml" xref="S2.p3.6.m5.1.1.2">𝐺</ci><ci id="S2.p3.6.m5.1.1.3.cmml" xref="S2.p3.6.m5.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p3.6.m5.1c">G_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S2.p3.6.m5.1d">italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S2.p4">
<p class="ltx_p" id="S2.p4.1">Note that considering all permutations in <math alttext="\pi_{k}(C)" class="ltx_Math" display="inline" id="S2.p4.1.m1.1"><semantics id="S2.p4.1.m1.1a"><mrow id="S2.p4.1.m1.1.2" xref="S2.p4.1.m1.1.2.cmml"><msub id="S2.p4.1.m1.1.2.2" xref="S2.p4.1.m1.1.2.2.cmml"><mi id="S2.p4.1.m1.1.2.2.2" xref="S2.p4.1.m1.1.2.2.2.cmml">π</mi><mi id="S2.p4.1.m1.1.2.2.3" xref="S2.p4.1.m1.1.2.2.3.cmml">k</mi></msub><mo id="S2.p4.1.m1.1.2.1" xref="S2.p4.1.m1.1.2.1.cmml">⁢</mo><mrow id="S2.p4.1.m1.1.2.3.2" xref="S2.p4.1.m1.1.2.cmml"><mo id="S2.p4.1.m1.1.2.3.2.1" stretchy="false" xref="S2.p4.1.m1.1.2.cmml">(</mo><mi id="S2.p4.1.m1.1.1" xref="S2.p4.1.m1.1.1.cmml">C</mi><mo id="S2.p4.1.m1.1.2.3.2.2" stretchy="false" xref="S2.p4.1.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p4.1.m1.1b"><apply id="S2.p4.1.m1.1.2.cmml" xref="S2.p4.1.m1.1.2"><times id="S2.p4.1.m1.1.2.1.cmml" xref="S2.p4.1.m1.1.2.1"></times><apply id="S2.p4.1.m1.1.2.2.cmml" xref="S2.p4.1.m1.1.2.2"><csymbol cd="ambiguous" id="S2.p4.1.m1.1.2.2.1.cmml" xref="S2.p4.1.m1.1.2.2">subscript</csymbol><ci id="S2.p4.1.m1.1.2.2.2.cmml" xref="S2.p4.1.m1.1.2.2.2">𝜋</ci><ci id="S2.p4.1.m1.1.2.2.3.cmml" xref="S2.p4.1.m1.1.2.2.3">𝑘</ci></apply><ci id="S2.p4.1.m1.1.1.cmml" xref="S2.p4.1.m1.1.1">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.1.m1.1c">\pi_{k}(C)</annotation><annotation encoding="application/x-llamapun" id="S2.p4.1.m1.1d">italic_π start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_C )</annotation></semantics></math> is expensive and impractical for large collections, thus we can compute an approximation of this equation. We do such approximation through a stochastic process. We rewrite Equation (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.E2" title="In 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">2</span></a>) as follows:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="Sx1.EGx2">
<tbody id="S2.E3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(3)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle p(\hat{y}|x;G_{\theta},R_{\phi})" class="ltx_Math" display="inline" id="S2.E3.m1.2"><semantics id="S2.E3.m1.2a"><mrow id="S2.E3.m1.2.2" xref="S2.E3.m1.2.2.cmml"><mi id="S2.E3.m1.2.2.3" xref="S2.E3.m1.2.2.3.cmml">p</mi><mo id="S2.E3.m1.2.2.2" xref="S2.E3.m1.2.2.2.cmml">⁢</mo><mrow id="S2.E3.m1.2.2.1.1" xref="S2.E3.m1.2.2.1.1.1.cmml"><mo id="S2.E3.m1.2.2.1.1.2" stretchy="false" xref="S2.E3.m1.2.2.1.1.1.cmml">(</mo><mrow id="S2.E3.m1.2.2.1.1.1" xref="S2.E3.m1.2.2.1.1.1.cmml"><mover accent="true" id="S2.E3.m1.2.2.1.1.1.4" xref="S2.E3.m1.2.2.1.1.1.4.cmml"><mi id="S2.E3.m1.2.2.1.1.1.4.2" xref="S2.E3.m1.2.2.1.1.1.4.2.cmml">y</mi><mo id="S2.E3.m1.2.2.1.1.1.4.1" xref="S2.E3.m1.2.2.1.1.1.4.1.cmml">^</mo></mover><mo fence="false" id="S2.E3.m1.2.2.1.1.1.3" xref="S2.E3.m1.2.2.1.1.1.3.cmml">|</mo><mrow id="S2.E3.m1.2.2.1.1.1.2.2" xref="S2.E3.m1.2.2.1.1.1.2.3.cmml"><mi id="S2.E3.m1.1.1" xref="S2.E3.m1.1.1.cmml">x</mi><mo id="S2.E3.m1.2.2.1.1.1.2.2.3" xref="S2.E3.m1.2.2.1.1.1.2.3.cmml">;</mo><msub id="S2.E3.m1.2.2.1.1.1.1.1.1" xref="S2.E3.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S2.E3.m1.2.2.1.1.1.1.1.1.2" xref="S2.E3.m1.2.2.1.1.1.1.1.1.2.cmml">G</mi><mi id="S2.E3.m1.2.2.1.1.1.1.1.1.3" xref="S2.E3.m1.2.2.1.1.1.1.1.1.3.cmml">θ</mi></msub><mo id="S2.E3.m1.2.2.1.1.1.2.2.4" xref="S2.E3.m1.2.2.1.1.1.2.3.cmml">,</mo><msub id="S2.E3.m1.2.2.1.1.1.2.2.2" xref="S2.E3.m1.2.2.1.1.1.2.2.2.cmml"><mi id="S2.E3.m1.2.2.1.1.1.2.2.2.2" xref="S2.E3.m1.2.2.1.1.1.2.2.2.2.cmml">R</mi><mi id="S2.E3.m1.2.2.1.1.1.2.2.2.3" xref="S2.E3.m1.2.2.1.1.1.2.2.2.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.E3.m1.2.2.1.1.3" stretchy="false" xref="S2.E3.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E3.m1.2b"><apply id="S2.E3.m1.2.2.cmml" xref="S2.E3.m1.2.2"><times id="S2.E3.m1.2.2.2.cmml" xref="S2.E3.m1.2.2.2"></times><ci id="S2.E3.m1.2.2.3.cmml" xref="S2.E3.m1.2.2.3">𝑝</ci><apply id="S2.E3.m1.2.2.1.1.1.cmml" xref="S2.E3.m1.2.2.1.1"><csymbol cd="latexml" id="S2.E3.m1.2.2.1.1.1.3.cmml" xref="S2.E3.m1.2.2.1.1.1.3">conditional</csymbol><apply id="S2.E3.m1.2.2.1.1.1.4.cmml" xref="S2.E3.m1.2.2.1.1.1.4"><ci id="S2.E3.m1.2.2.1.1.1.4.1.cmml" xref="S2.E3.m1.2.2.1.1.1.4.1">^</ci><ci id="S2.E3.m1.2.2.1.1.1.4.2.cmml" xref="S2.E3.m1.2.2.1.1.1.4.2">𝑦</ci></apply><list id="S2.E3.m1.2.2.1.1.1.2.3.cmml" xref="S2.E3.m1.2.2.1.1.1.2.2"><ci id="S2.E3.m1.1.1.cmml" xref="S2.E3.m1.1.1">𝑥</ci><apply id="S2.E3.m1.2.2.1.1.1.1.1.1.cmml" xref="S2.E3.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E3.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S2.E3.m1.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E3.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S2.E3.m1.2.2.1.1.1.1.1.1.2">𝐺</ci><ci id="S2.E3.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S2.E3.m1.2.2.1.1.1.1.1.1.3">𝜃</ci></apply><apply id="S2.E3.m1.2.2.1.1.1.2.2.2.cmml" xref="S2.E3.m1.2.2.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E3.m1.2.2.1.1.1.2.2.2.1.cmml" xref="S2.E3.m1.2.2.1.1.1.2.2.2">subscript</csymbol><ci id="S2.E3.m1.2.2.1.1.1.2.2.2.2.cmml" xref="S2.E3.m1.2.2.1.1.1.2.2.2.2">𝑅</ci><ci id="S2.E3.m1.2.2.1.1.1.2.2.2.3.cmml" xref="S2.E3.m1.2.2.1.1.1.2.2.2.3">italic-ϕ</ci></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E3.m1.2c">\displaystyle p(\hat{y}|x;G_{\theta},R_{\phi})</annotation><annotation encoding="application/x-llamapun" id="S2.E3.m1.2d">italic_p ( over^ start_ARG italic_y end_ARG | italic_x ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT , italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\mathbb{E}_{\mathbf{d}\sim p(\mathbf{d}|x;R_{\phi})}\left[p(\hat%
{y}|x,\mathbf{d};G_{\theta})\right]" class="ltx_Math" display="inline" id="S2.E3.m2.5"><semantics id="S2.E3.m2.5a"><mrow id="S2.E3.m2.5.5" xref="S2.E3.m2.5.5.cmml"><mi id="S2.E3.m2.5.5.3" xref="S2.E3.m2.5.5.3.cmml"></mi><mo id="S2.E3.m2.5.5.2" xref="S2.E3.m2.5.5.2.cmml">=</mo><mrow id="S2.E3.m2.5.5.1" xref="S2.E3.m2.5.5.1.cmml"><msub id="S2.E3.m2.5.5.1.3" xref="S2.E3.m2.5.5.1.3.cmml"><mi id="S2.E3.m2.5.5.1.3.2" xref="S2.E3.m2.5.5.1.3.2.cmml">𝔼</mi><mrow id="S2.E3.m2.2.2.2" xref="S2.E3.m2.2.2.2.cmml"><mi id="S2.E3.m2.2.2.2.4" xref="S2.E3.m2.2.2.2.4.cmml">𝐝</mi><mo id="S2.E3.m2.2.2.2.3" xref="S2.E3.m2.2.2.2.3.cmml">∼</mo><mrow id="S2.E3.m2.2.2.2.2" xref="S2.E3.m2.2.2.2.2.cmml"><mi id="S2.E3.m2.2.2.2.2.3" xref="S2.E3.m2.2.2.2.2.3.cmml">p</mi><mo id="S2.E3.m2.2.2.2.2.2" xref="S2.E3.m2.2.2.2.2.2.cmml">⁢</mo><mrow id="S2.E3.m2.2.2.2.2.1.1" xref="S2.E3.m2.2.2.2.2.1.1.1.cmml"><mo id="S2.E3.m2.2.2.2.2.1.1.2" stretchy="false" xref="S2.E3.m2.2.2.2.2.1.1.1.cmml">(</mo><mrow id="S2.E3.m2.2.2.2.2.1.1.1" xref="S2.E3.m2.2.2.2.2.1.1.1.cmml"><mi id="S2.E3.m2.2.2.2.2.1.1.1.3" xref="S2.E3.m2.2.2.2.2.1.1.1.3.cmml">𝐝</mi><mo fence="false" id="S2.E3.m2.2.2.2.2.1.1.1.2" xref="S2.E3.m2.2.2.2.2.1.1.1.2.cmml">|</mo><mrow id="S2.E3.m2.2.2.2.2.1.1.1.1.1" xref="S2.E3.m2.2.2.2.2.1.1.1.1.2.cmml"><mi id="S2.E3.m2.1.1.1.1" xref="S2.E3.m2.1.1.1.1.cmml">x</mi><mo id="S2.E3.m2.2.2.2.2.1.1.1.1.1.2" xref="S2.E3.m2.2.2.2.2.1.1.1.1.2.cmml">;</mo><msub id="S2.E3.m2.2.2.2.2.1.1.1.1.1.1" xref="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.cmml"><mi id="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.2" xref="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.2.cmml">R</mi><mi id="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.3" xref="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.E3.m2.2.2.2.2.1.1.3" stretchy="false" xref="S2.E3.m2.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mrow></msub><mo id="S2.E3.m2.5.5.1.2" xref="S2.E3.m2.5.5.1.2.cmml">⁢</mo><mrow id="S2.E3.m2.5.5.1.1.1" xref="S2.E3.m2.5.5.1.1.2.cmml"><mo id="S2.E3.m2.5.5.1.1.1.2" xref="S2.E3.m2.5.5.1.1.2.1.cmml">[</mo><mrow id="S2.E3.m2.5.5.1.1.1.1" xref="S2.E3.m2.5.5.1.1.1.1.cmml"><mi id="S2.E3.m2.5.5.1.1.1.1.3" xref="S2.E3.m2.5.5.1.1.1.1.3.cmml">p</mi><mo id="S2.E3.m2.5.5.1.1.1.1.2" xref="S2.E3.m2.5.5.1.1.1.1.2.cmml">⁢</mo><mrow id="S2.E3.m2.5.5.1.1.1.1.1.1" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.cmml"><mo id="S2.E3.m2.5.5.1.1.1.1.1.1.2" stretchy="false" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.E3.m2.5.5.1.1.1.1.1.1.1" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S2.E3.m2.5.5.1.1.1.1.1.1.1.3" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.3.cmml"><mi id="S2.E3.m2.5.5.1.1.1.1.1.1.1.3.2" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.3.2.cmml">y</mi><mo id="S2.E3.m2.5.5.1.1.1.1.1.1.1.3.1" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="S2.E3.m2.5.5.1.1.1.1.1.1.1.2" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.2.cmml">|</mo><mrow id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.2.cmml"><mi id="S2.E3.m2.3.3" xref="S2.E3.m2.3.3.cmml">x</mi><mo id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.2" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.2.cmml">,</mo><mi id="S2.E3.m2.4.4" xref="S2.E3.m2.4.4.cmml">𝐝</mi><mo id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.3" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.2.cmml">;</mo><msub id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.2" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.2.cmml">G</mi><mi id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.3" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.3.cmml">θ</mi></msub></mrow></mrow><mo id="S2.E3.m2.5.5.1.1.1.1.1.1.3" stretchy="false" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.E3.m2.5.5.1.1.1.3" xref="S2.E3.m2.5.5.1.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E3.m2.5b"><apply id="S2.E3.m2.5.5.cmml" xref="S2.E3.m2.5.5"><eq id="S2.E3.m2.5.5.2.cmml" xref="S2.E3.m2.5.5.2"></eq><csymbol cd="latexml" id="S2.E3.m2.5.5.3.cmml" xref="S2.E3.m2.5.5.3">absent</csymbol><apply id="S2.E3.m2.5.5.1.cmml" xref="S2.E3.m2.5.5.1"><times id="S2.E3.m2.5.5.1.2.cmml" xref="S2.E3.m2.5.5.1.2"></times><apply id="S2.E3.m2.5.5.1.3.cmml" xref="S2.E3.m2.5.5.1.3"><csymbol cd="ambiguous" id="S2.E3.m2.5.5.1.3.1.cmml" xref="S2.E3.m2.5.5.1.3">subscript</csymbol><ci id="S2.E3.m2.5.5.1.3.2.cmml" xref="S2.E3.m2.5.5.1.3.2">𝔼</ci><apply id="S2.E3.m2.2.2.2.cmml" xref="S2.E3.m2.2.2.2"><csymbol cd="latexml" id="S2.E3.m2.2.2.2.3.cmml" xref="S2.E3.m2.2.2.2.3">similar-to</csymbol><ci id="S2.E3.m2.2.2.2.4.cmml" xref="S2.E3.m2.2.2.2.4">𝐝</ci><apply id="S2.E3.m2.2.2.2.2.cmml" xref="S2.E3.m2.2.2.2.2"><times id="S2.E3.m2.2.2.2.2.2.cmml" xref="S2.E3.m2.2.2.2.2.2"></times><ci id="S2.E3.m2.2.2.2.2.3.cmml" xref="S2.E3.m2.2.2.2.2.3">𝑝</ci><apply id="S2.E3.m2.2.2.2.2.1.1.1.cmml" xref="S2.E3.m2.2.2.2.2.1.1"><csymbol cd="latexml" id="S2.E3.m2.2.2.2.2.1.1.1.2.cmml" xref="S2.E3.m2.2.2.2.2.1.1.1.2">conditional</csymbol><ci id="S2.E3.m2.2.2.2.2.1.1.1.3.cmml" xref="S2.E3.m2.2.2.2.2.1.1.1.3">𝐝</ci><list id="S2.E3.m2.2.2.2.2.1.1.1.1.2.cmml" xref="S2.E3.m2.2.2.2.2.1.1.1.1.1"><ci id="S2.E3.m2.1.1.1.1.cmml" xref="S2.E3.m2.1.1.1.1">𝑥</ci><apply id="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.cmml" xref="S2.E3.m2.2.2.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.1.cmml" xref="S2.E3.m2.2.2.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.2.cmml" xref="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.2">𝑅</ci><ci id="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.3.cmml" xref="S2.E3.m2.2.2.2.2.1.1.1.1.1.1.3">italic-ϕ</ci></apply></list></apply></apply></apply></apply><apply id="S2.E3.m2.5.5.1.1.2.cmml" xref="S2.E3.m2.5.5.1.1.1"><csymbol cd="latexml" id="S2.E3.m2.5.5.1.1.2.1.cmml" xref="S2.E3.m2.5.5.1.1.1.2">delimited-[]</csymbol><apply id="S2.E3.m2.5.5.1.1.1.1.cmml" xref="S2.E3.m2.5.5.1.1.1.1"><times id="S2.E3.m2.5.5.1.1.1.1.2.cmml" xref="S2.E3.m2.5.5.1.1.1.1.2"></times><ci id="S2.E3.m2.5.5.1.1.1.1.3.cmml" xref="S2.E3.m2.5.5.1.1.1.1.3">𝑝</ci><apply id="S2.E3.m2.5.5.1.1.1.1.1.1.1.cmml" xref="S2.E3.m2.5.5.1.1.1.1.1.1"><csymbol cd="latexml" id="S2.E3.m2.5.5.1.1.1.1.1.1.1.2.cmml" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.2">conditional</csymbol><apply id="S2.E3.m2.5.5.1.1.1.1.1.1.1.3.cmml" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.3"><ci id="S2.E3.m2.5.5.1.1.1.1.1.1.1.3.1.cmml" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.3.1">^</ci><ci id="S2.E3.m2.5.5.1.1.1.1.1.1.1.3.2.cmml" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.3.2">𝑦</ci></apply><list id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1"><ci id="S2.E3.m2.3.3.cmml" xref="S2.E3.m2.3.3">𝑥</ci><ci id="S2.E3.m2.4.4.cmml" xref="S2.E3.m2.4.4">𝐝</ci><apply id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.2">𝐺</ci><ci id="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E3.m2.5.5.1.1.1.1.1.1.1.1.1.1.3">𝜃</ci></apply></list></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E3.m2.5c">\displaystyle=\mathbb{E}_{\mathbf{d}\sim p(\mathbf{d}|x;R_{\phi})}\left[p(\hat%
{y}|x,\mathbf{d};G_{\theta})\right]</annotation><annotation encoding="application/x-llamapun" id="S2.E3.m2.5d">= blackboard_E start_POSTSUBSCRIPT bold_d ∼ italic_p ( bold_d | italic_x ; italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ) end_POSTSUBSCRIPT [ italic_p ( over^ start_ARG italic_y end_ARG | italic_x , bold_d ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.p4.3">where <math alttext="|\mathbf{d}|=k" class="ltx_Math" display="inline" id="S2.p4.2.m1.1"><semantics id="S2.p4.2.m1.1a"><mrow id="S2.p4.2.m1.1.2" xref="S2.p4.2.m1.1.2.cmml"><mrow id="S2.p4.2.m1.1.2.2.2" xref="S2.p4.2.m1.1.2.2.1.cmml"><mo id="S2.p4.2.m1.1.2.2.2.1" stretchy="false" xref="S2.p4.2.m1.1.2.2.1.1.cmml">|</mo><mi id="S2.p4.2.m1.1.1" xref="S2.p4.2.m1.1.1.cmml">𝐝</mi><mo id="S2.p4.2.m1.1.2.2.2.2" stretchy="false" xref="S2.p4.2.m1.1.2.2.1.1.cmml">|</mo></mrow><mo id="S2.p4.2.m1.1.2.1" xref="S2.p4.2.m1.1.2.1.cmml">=</mo><mi id="S2.p4.2.m1.1.2.3" xref="S2.p4.2.m1.1.2.3.cmml">k</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.p4.2.m1.1b"><apply id="S2.p4.2.m1.1.2.cmml" xref="S2.p4.2.m1.1.2"><eq id="S2.p4.2.m1.1.2.1.cmml" xref="S2.p4.2.m1.1.2.1"></eq><apply id="S2.p4.2.m1.1.2.2.1.cmml" xref="S2.p4.2.m1.1.2.2.2"><abs id="S2.p4.2.m1.1.2.2.1.1.cmml" xref="S2.p4.2.m1.1.2.2.2.1"></abs><ci id="S2.p4.2.m1.1.1.cmml" xref="S2.p4.2.m1.1.1">𝐝</ci></apply><ci id="S2.p4.2.m1.1.2.3.cmml" xref="S2.p4.2.m1.1.2.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.2.m1.1c">|\mathbf{d}|=k</annotation><annotation encoding="application/x-llamapun" id="S2.p4.2.m1.1d">| bold_d | = italic_k</annotation></semantics></math>.
Inspired by the seq2seq models <cite class="ltx_cite ltx_citemacro_citep">(Sutskever et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib44" title="">2014</a>)</cite>, we compute <math alttext="p(\hat{y}|x,\mathbf{d};G_{\theta})" class="ltx_Math" display="inline" id="S2.p4.3.m2.3"><semantics id="S2.p4.3.m2.3a"><mrow id="S2.p4.3.m2.3.3" xref="S2.p4.3.m2.3.3.cmml"><mi id="S2.p4.3.m2.3.3.3" xref="S2.p4.3.m2.3.3.3.cmml">p</mi><mo id="S2.p4.3.m2.3.3.2" xref="S2.p4.3.m2.3.3.2.cmml">⁢</mo><mrow id="S2.p4.3.m2.3.3.1.1" xref="S2.p4.3.m2.3.3.1.1.1.cmml"><mo id="S2.p4.3.m2.3.3.1.1.2" stretchy="false" xref="S2.p4.3.m2.3.3.1.1.1.cmml">(</mo><mrow id="S2.p4.3.m2.3.3.1.1.1" xref="S2.p4.3.m2.3.3.1.1.1.cmml"><mover accent="true" id="S2.p4.3.m2.3.3.1.1.1.3" xref="S2.p4.3.m2.3.3.1.1.1.3.cmml"><mi id="S2.p4.3.m2.3.3.1.1.1.3.2" xref="S2.p4.3.m2.3.3.1.1.1.3.2.cmml">y</mi><mo id="S2.p4.3.m2.3.3.1.1.1.3.1" xref="S2.p4.3.m2.3.3.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="S2.p4.3.m2.3.3.1.1.1.2" xref="S2.p4.3.m2.3.3.1.1.1.2.cmml">|</mo><mrow id="S2.p4.3.m2.3.3.1.1.1.1.1" xref="S2.p4.3.m2.3.3.1.1.1.1.2.cmml"><mi id="S2.p4.3.m2.1.1" xref="S2.p4.3.m2.1.1.cmml">x</mi><mo id="S2.p4.3.m2.3.3.1.1.1.1.1.2" xref="S2.p4.3.m2.3.3.1.1.1.1.2.cmml">,</mo><mi id="S2.p4.3.m2.2.2" xref="S2.p4.3.m2.2.2.cmml">𝐝</mi><mo id="S2.p4.3.m2.3.3.1.1.1.1.1.3" xref="S2.p4.3.m2.3.3.1.1.1.1.2.cmml">;</mo><msub id="S2.p4.3.m2.3.3.1.1.1.1.1.1" xref="S2.p4.3.m2.3.3.1.1.1.1.1.1.cmml"><mi id="S2.p4.3.m2.3.3.1.1.1.1.1.1.2" xref="S2.p4.3.m2.3.3.1.1.1.1.1.1.2.cmml">G</mi><mi id="S2.p4.3.m2.3.3.1.1.1.1.1.1.3" xref="S2.p4.3.m2.3.3.1.1.1.1.1.1.3.cmml">θ</mi></msub></mrow></mrow><mo id="S2.p4.3.m2.3.3.1.1.3" stretchy="false" xref="S2.p4.3.m2.3.3.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p4.3.m2.3b"><apply id="S2.p4.3.m2.3.3.cmml" xref="S2.p4.3.m2.3.3"><times id="S2.p4.3.m2.3.3.2.cmml" xref="S2.p4.3.m2.3.3.2"></times><ci id="S2.p4.3.m2.3.3.3.cmml" xref="S2.p4.3.m2.3.3.3">𝑝</ci><apply id="S2.p4.3.m2.3.3.1.1.1.cmml" xref="S2.p4.3.m2.3.3.1.1"><csymbol cd="latexml" id="S2.p4.3.m2.3.3.1.1.1.2.cmml" xref="S2.p4.3.m2.3.3.1.1.1.2">conditional</csymbol><apply id="S2.p4.3.m2.3.3.1.1.1.3.cmml" xref="S2.p4.3.m2.3.3.1.1.1.3"><ci id="S2.p4.3.m2.3.3.1.1.1.3.1.cmml" xref="S2.p4.3.m2.3.3.1.1.1.3.1">^</ci><ci id="S2.p4.3.m2.3.3.1.1.1.3.2.cmml" xref="S2.p4.3.m2.3.3.1.1.1.3.2">𝑦</ci></apply><list id="S2.p4.3.m2.3.3.1.1.1.1.2.cmml" xref="S2.p4.3.m2.3.3.1.1.1.1.1"><ci id="S2.p4.3.m2.1.1.cmml" xref="S2.p4.3.m2.1.1">𝑥</ci><ci id="S2.p4.3.m2.2.2.cmml" xref="S2.p4.3.m2.2.2">𝐝</ci><apply id="S2.p4.3.m2.3.3.1.1.1.1.1.1.cmml" xref="S2.p4.3.m2.3.3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.p4.3.m2.3.3.1.1.1.1.1.1.1.cmml" xref="S2.p4.3.m2.3.3.1.1.1.1.1.1">subscript</csymbol><ci id="S2.p4.3.m2.3.3.1.1.1.1.1.1.2.cmml" xref="S2.p4.3.m2.3.3.1.1.1.1.1.1.2">𝐺</ci><ci id="S2.p4.3.m2.3.3.1.1.1.1.1.1.3.cmml" xref="S2.p4.3.m2.3.3.1.1.1.1.1.1.3">𝜃</ci></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.3.m2.3c">p(\hat{y}|x,\mathbf{d};G_{\theta})</annotation><annotation encoding="application/x-llamapun" id="S2.p4.3.m2.3d">italic_p ( over^ start_ARG italic_y end_ARG | italic_x , bold_d ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT )</annotation></semantics></math>—the component in Equation (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.E2" title="In 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">2</span></a>)—as follows:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="Sx1.EGx3">
<tbody id="S2.Ex3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle p(\hat{y}|x,\mathbf{d};G_{\theta})" class="ltx_Math" display="inline" id="S2.Ex3.m1.3"><semantics id="S2.Ex3.m1.3a"><mrow id="S2.Ex3.m1.3.3" xref="S2.Ex3.m1.3.3.cmml"><mi id="S2.Ex3.m1.3.3.3" xref="S2.Ex3.m1.3.3.3.cmml">p</mi><mo id="S2.Ex3.m1.3.3.2" xref="S2.Ex3.m1.3.3.2.cmml">⁢</mo><mrow id="S2.Ex3.m1.3.3.1.1" xref="S2.Ex3.m1.3.3.1.1.1.cmml"><mo id="S2.Ex3.m1.3.3.1.1.2" stretchy="false" xref="S2.Ex3.m1.3.3.1.1.1.cmml">(</mo><mrow id="S2.Ex3.m1.3.3.1.1.1" xref="S2.Ex3.m1.3.3.1.1.1.cmml"><mover accent="true" id="S2.Ex3.m1.3.3.1.1.1.3" xref="S2.Ex3.m1.3.3.1.1.1.3.cmml"><mi id="S2.Ex3.m1.3.3.1.1.1.3.2" xref="S2.Ex3.m1.3.3.1.1.1.3.2.cmml">y</mi><mo id="S2.Ex3.m1.3.3.1.1.1.3.1" xref="S2.Ex3.m1.3.3.1.1.1.3.1.cmml">^</mo></mover><mo fence="false" id="S2.Ex3.m1.3.3.1.1.1.2" xref="S2.Ex3.m1.3.3.1.1.1.2.cmml">|</mo><mrow id="S2.Ex3.m1.3.3.1.1.1.1.1" xref="S2.Ex3.m1.3.3.1.1.1.1.2.cmml"><mi id="S2.Ex3.m1.1.1" xref="S2.Ex3.m1.1.1.cmml">x</mi><mo id="S2.Ex3.m1.3.3.1.1.1.1.1.2" xref="S2.Ex3.m1.3.3.1.1.1.1.2.cmml">,</mo><mi id="S2.Ex3.m1.2.2" xref="S2.Ex3.m1.2.2.cmml">𝐝</mi><mo id="S2.Ex3.m1.3.3.1.1.1.1.1.3" xref="S2.Ex3.m1.3.3.1.1.1.1.2.cmml">;</mo><msub id="S2.Ex3.m1.3.3.1.1.1.1.1.1" xref="S2.Ex3.m1.3.3.1.1.1.1.1.1.cmml"><mi id="S2.Ex3.m1.3.3.1.1.1.1.1.1.2" xref="S2.Ex3.m1.3.3.1.1.1.1.1.1.2.cmml">G</mi><mi id="S2.Ex3.m1.3.3.1.1.1.1.1.1.3" xref="S2.Ex3.m1.3.3.1.1.1.1.1.1.3.cmml">θ</mi></msub></mrow></mrow><mo id="S2.Ex3.m1.3.3.1.1.3" stretchy="false" xref="S2.Ex3.m1.3.3.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex3.m1.3b"><apply id="S2.Ex3.m1.3.3.cmml" xref="S2.Ex3.m1.3.3"><times id="S2.Ex3.m1.3.3.2.cmml" xref="S2.Ex3.m1.3.3.2"></times><ci id="S2.Ex3.m1.3.3.3.cmml" xref="S2.Ex3.m1.3.3.3">𝑝</ci><apply id="S2.Ex3.m1.3.3.1.1.1.cmml" xref="S2.Ex3.m1.3.3.1.1"><csymbol cd="latexml" id="S2.Ex3.m1.3.3.1.1.1.2.cmml" xref="S2.Ex3.m1.3.3.1.1.1.2">conditional</csymbol><apply id="S2.Ex3.m1.3.3.1.1.1.3.cmml" xref="S2.Ex3.m1.3.3.1.1.1.3"><ci id="S2.Ex3.m1.3.3.1.1.1.3.1.cmml" xref="S2.Ex3.m1.3.3.1.1.1.3.1">^</ci><ci id="S2.Ex3.m1.3.3.1.1.1.3.2.cmml" xref="S2.Ex3.m1.3.3.1.1.1.3.2">𝑦</ci></apply><list id="S2.Ex3.m1.3.3.1.1.1.1.2.cmml" xref="S2.Ex3.m1.3.3.1.1.1.1.1"><ci id="S2.Ex3.m1.1.1.cmml" xref="S2.Ex3.m1.1.1">𝑥</ci><ci id="S2.Ex3.m1.2.2.cmml" xref="S2.Ex3.m1.2.2">𝐝</ci><apply id="S2.Ex3.m1.3.3.1.1.1.1.1.1.cmml" xref="S2.Ex3.m1.3.3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.Ex3.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S2.Ex3.m1.3.3.1.1.1.1.1.1">subscript</csymbol><ci id="S2.Ex3.m1.3.3.1.1.1.1.1.1.2.cmml" xref="S2.Ex3.m1.3.3.1.1.1.1.1.1.2">𝐺</ci><ci id="S2.Ex3.m1.3.3.1.1.1.1.1.1.3.cmml" xref="S2.Ex3.m1.3.3.1.1.1.1.1.1.3">𝜃</ci></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex3.m1.3c">\displaystyle p(\hat{y}|x,\mathbf{d};G_{\theta})</annotation><annotation encoding="application/x-llamapun" id="S2.Ex3.m1.3d">italic_p ( over^ start_ARG italic_y end_ARG | italic_x , bold_d ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\prod_{i=1}^{|\hat{y}|}p(\hat{y}_{i}|\hat{y}_{&lt;i},x,\mathbf{d};G%
_{\theta})" class="ltx_Math" display="inline" id="S2.Ex3.m2.4"><semantics id="S2.Ex3.m2.4a"><mrow id="S2.Ex3.m2.4.4" xref="S2.Ex3.m2.4.4.cmml"><mi id="S2.Ex3.m2.4.4.3" xref="S2.Ex3.m2.4.4.3.cmml"></mi><mo id="S2.Ex3.m2.4.4.2" xref="S2.Ex3.m2.4.4.2.cmml">=</mo><mrow id="S2.Ex3.m2.4.4.1" xref="S2.Ex3.m2.4.4.1.cmml"><mstyle displaystyle="true" id="S2.Ex3.m2.4.4.1.2" xref="S2.Ex3.m2.4.4.1.2.cmml"><munderover id="S2.Ex3.m2.4.4.1.2a" xref="S2.Ex3.m2.4.4.1.2.cmml"><mo id="S2.Ex3.m2.4.4.1.2.2.2" movablelimits="false" xref="S2.Ex3.m2.4.4.1.2.2.2.cmml">∏</mo><mrow id="S2.Ex3.m2.4.4.1.2.2.3" xref="S2.Ex3.m2.4.4.1.2.2.3.cmml"><mi id="S2.Ex3.m2.4.4.1.2.2.3.2" xref="S2.Ex3.m2.4.4.1.2.2.3.2.cmml">i</mi><mo id="S2.Ex3.m2.4.4.1.2.2.3.1" xref="S2.Ex3.m2.4.4.1.2.2.3.1.cmml">=</mo><mn id="S2.Ex3.m2.4.4.1.2.2.3.3" xref="S2.Ex3.m2.4.4.1.2.2.3.3.cmml">1</mn></mrow><mrow id="S2.Ex3.m2.1.1.1.3" xref="S2.Ex3.m2.1.1.1.2.cmml"><mo id="S2.Ex3.m2.1.1.1.3.1" stretchy="false" xref="S2.Ex3.m2.1.1.1.2.1.cmml">|</mo><mover accent="true" id="S2.Ex3.m2.1.1.1.1" xref="S2.Ex3.m2.1.1.1.1.cmml"><mi id="S2.Ex3.m2.1.1.1.1.2" xref="S2.Ex3.m2.1.1.1.1.2.cmml">y</mi><mo id="S2.Ex3.m2.1.1.1.1.1" xref="S2.Ex3.m2.1.1.1.1.1.cmml">^</mo></mover><mo id="S2.Ex3.m2.1.1.1.3.2" stretchy="false" xref="S2.Ex3.m2.1.1.1.2.1.cmml">|</mo></mrow></munderover></mstyle><mrow id="S2.Ex3.m2.4.4.1.1" xref="S2.Ex3.m2.4.4.1.1.cmml"><mi id="S2.Ex3.m2.4.4.1.1.3" xref="S2.Ex3.m2.4.4.1.1.3.cmml">p</mi><mo id="S2.Ex3.m2.4.4.1.1.2" xref="S2.Ex3.m2.4.4.1.1.2.cmml">⁢</mo><mrow id="S2.Ex3.m2.4.4.1.1.1.1" xref="S2.Ex3.m2.4.4.1.1.1.1.1.cmml"><mo id="S2.Ex3.m2.4.4.1.1.1.1.2" stretchy="false" xref="S2.Ex3.m2.4.4.1.1.1.1.1.cmml">(</mo><mrow id="S2.Ex3.m2.4.4.1.1.1.1.1" xref="S2.Ex3.m2.4.4.1.1.1.1.1.cmml"><msub id="S2.Ex3.m2.4.4.1.1.1.1.1.4" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4.cmml"><mover accent="true" id="S2.Ex3.m2.4.4.1.1.1.1.1.4.2" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4.2.cmml"><mi id="S2.Ex3.m2.4.4.1.1.1.1.1.4.2.2" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4.2.2.cmml">y</mi><mo id="S2.Ex3.m2.4.4.1.1.1.1.1.4.2.1" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4.2.1.cmml">^</mo></mover><mi id="S2.Ex3.m2.4.4.1.1.1.1.1.4.3" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4.3.cmml">i</mi></msub><mo fence="false" id="S2.Ex3.m2.4.4.1.1.1.1.1.3" xref="S2.Ex3.m2.4.4.1.1.1.1.1.3.cmml">|</mo><mrow id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.3.cmml"><msub id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2.cmml"><mi id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2.2" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2.2.cmml">y</mi><mo id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2.1" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.cmml"><mi id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.2" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.1" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.1.cmml">&lt;</mo><mi id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.3" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.3.cmml">i</mi></mrow></msub><mo id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.3" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.3.cmml">,</mo><mi id="S2.Ex3.m2.2.2" xref="S2.Ex3.m2.2.2.cmml">x</mi><mo id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.4" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.3.cmml">,</mo><mi id="S2.Ex3.m2.3.3" xref="S2.Ex3.m2.3.3.cmml">𝐝</mi><mo id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.5" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.3.cmml">;</mo><msub id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.cmml"><mi id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.2" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.2.cmml">G</mi><mi id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.3" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.3.cmml">θ</mi></msub></mrow></mrow><mo id="S2.Ex3.m2.4.4.1.1.1.1.3" stretchy="false" xref="S2.Ex3.m2.4.4.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.Ex3.m2.4b"><apply id="S2.Ex3.m2.4.4.cmml" xref="S2.Ex3.m2.4.4"><eq id="S2.Ex3.m2.4.4.2.cmml" xref="S2.Ex3.m2.4.4.2"></eq><csymbol cd="latexml" id="S2.Ex3.m2.4.4.3.cmml" xref="S2.Ex3.m2.4.4.3">absent</csymbol><apply id="S2.Ex3.m2.4.4.1.cmml" xref="S2.Ex3.m2.4.4.1"><apply id="S2.Ex3.m2.4.4.1.2.cmml" xref="S2.Ex3.m2.4.4.1.2"><csymbol cd="ambiguous" id="S2.Ex3.m2.4.4.1.2.1.cmml" xref="S2.Ex3.m2.4.4.1.2">superscript</csymbol><apply id="S2.Ex3.m2.4.4.1.2.2.cmml" xref="S2.Ex3.m2.4.4.1.2"><csymbol cd="ambiguous" id="S2.Ex3.m2.4.4.1.2.2.1.cmml" xref="S2.Ex3.m2.4.4.1.2">subscript</csymbol><csymbol cd="latexml" id="S2.Ex3.m2.4.4.1.2.2.2.cmml" xref="S2.Ex3.m2.4.4.1.2.2.2">product</csymbol><apply id="S2.Ex3.m2.4.4.1.2.2.3.cmml" xref="S2.Ex3.m2.4.4.1.2.2.3"><eq id="S2.Ex3.m2.4.4.1.2.2.3.1.cmml" xref="S2.Ex3.m2.4.4.1.2.2.3.1"></eq><ci id="S2.Ex3.m2.4.4.1.2.2.3.2.cmml" xref="S2.Ex3.m2.4.4.1.2.2.3.2">𝑖</ci><cn id="S2.Ex3.m2.4.4.1.2.2.3.3.cmml" type="integer" xref="S2.Ex3.m2.4.4.1.2.2.3.3">1</cn></apply></apply><apply id="S2.Ex3.m2.1.1.1.2.cmml" xref="S2.Ex3.m2.1.1.1.3"><abs id="S2.Ex3.m2.1.1.1.2.1.cmml" xref="S2.Ex3.m2.1.1.1.3.1"></abs><apply id="S2.Ex3.m2.1.1.1.1.cmml" xref="S2.Ex3.m2.1.1.1.1"><ci id="S2.Ex3.m2.1.1.1.1.1.cmml" xref="S2.Ex3.m2.1.1.1.1.1">^</ci><ci id="S2.Ex3.m2.1.1.1.1.2.cmml" xref="S2.Ex3.m2.1.1.1.1.2">𝑦</ci></apply></apply></apply><apply id="S2.Ex3.m2.4.4.1.1.cmml" xref="S2.Ex3.m2.4.4.1.1"><times id="S2.Ex3.m2.4.4.1.1.2.cmml" xref="S2.Ex3.m2.4.4.1.1.2"></times><ci id="S2.Ex3.m2.4.4.1.1.3.cmml" xref="S2.Ex3.m2.4.4.1.1.3">𝑝</ci><apply id="S2.Ex3.m2.4.4.1.1.1.1.1.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1"><csymbol cd="latexml" id="S2.Ex3.m2.4.4.1.1.1.1.1.3.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.3">conditional</csymbol><apply id="S2.Ex3.m2.4.4.1.1.1.1.1.4.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.Ex3.m2.4.4.1.1.1.1.1.4.1.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4">subscript</csymbol><apply id="S2.Ex3.m2.4.4.1.1.1.1.1.4.2.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4.2"><ci id="S2.Ex3.m2.4.4.1.1.1.1.1.4.2.1.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4.2.1">^</ci><ci id="S2.Ex3.m2.4.4.1.1.1.1.1.4.2.2.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4.2.2">𝑦</ci></apply><ci id="S2.Ex3.m2.4.4.1.1.1.1.1.4.3.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.4.3">𝑖</ci></apply><list id="S2.Ex3.m2.4.4.1.1.1.1.1.2.3.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.2"><apply id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.1.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2"><ci id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2.1">^</ci><ci id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.2.2">𝑦</ci></apply><apply id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3"><lt id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.1.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.2.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.2">absent</csymbol><ci id="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.3.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.1.1.1.3.3">𝑖</ci></apply></apply><ci id="S2.Ex3.m2.2.2.cmml" xref="S2.Ex3.m2.2.2">𝑥</ci><ci id="S2.Ex3.m2.3.3.cmml" xref="S2.Ex3.m2.3.3">𝐝</ci><apply id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.1.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.2.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.2">𝐺</ci><ci id="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.3.cmml" xref="S2.Ex3.m2.4.4.1.1.1.1.1.2.2.2.3">𝜃</ci></apply></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.Ex3.m2.4c">\displaystyle=\prod_{i=1}^{|\hat{y}|}p(\hat{y}_{i}|\hat{y}_{&lt;i},x,\mathbf{d};G%
_{\theta})</annotation><annotation encoding="application/x-llamapun" id="S2.Ex3.m2.4d">= ∏ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT | over^ start_ARG italic_y end_ARG | end_POSTSUPERSCRIPT italic_p ( over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT &lt; italic_i end_POSTSUBSCRIPT , italic_x , bold_d ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S2.E4"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(4)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\exp\left(\sum_{i=1}^{|\hat{y}|}\log p(\hat{y}_{i}|\hat{y}_{&lt;i},%
x,\mathbf{d};G_{\theta})\right)" class="ltx_Math" display="inline" id="S2.E4.m1.5"><semantics id="S2.E4.m1.5a"><mrow id="S2.E4.m1.5.5" xref="S2.E4.m1.5.5.cmml"><mi id="S2.E4.m1.5.5.3" xref="S2.E4.m1.5.5.3.cmml"></mi><mo id="S2.E4.m1.5.5.2" xref="S2.E4.m1.5.5.2.cmml">=</mo><mrow id="S2.E4.m1.5.5.1.1" xref="S2.E4.m1.5.5.1.2.cmml"><mi id="S2.E4.m1.4.4" xref="S2.E4.m1.4.4.cmml">exp</mi><mo id="S2.E4.m1.5.5.1.1a" xref="S2.E4.m1.5.5.1.2.cmml">⁡</mo><mrow id="S2.E4.m1.5.5.1.1.1" xref="S2.E4.m1.5.5.1.2.cmml"><mo id="S2.E4.m1.5.5.1.1.1.2" xref="S2.E4.m1.5.5.1.2.cmml">(</mo><mrow id="S2.E4.m1.5.5.1.1.1.1" xref="S2.E4.m1.5.5.1.1.1.1.cmml"><mstyle displaystyle="true" id="S2.E4.m1.5.5.1.1.1.1.2" xref="S2.E4.m1.5.5.1.1.1.1.2.cmml"><munderover id="S2.E4.m1.5.5.1.1.1.1.2a" xref="S2.E4.m1.5.5.1.1.1.1.2.cmml"><mo id="S2.E4.m1.5.5.1.1.1.1.2.2.2" movablelimits="false" xref="S2.E4.m1.5.5.1.1.1.1.2.2.2.cmml">∑</mo><mrow id="S2.E4.m1.5.5.1.1.1.1.2.2.3" xref="S2.E4.m1.5.5.1.1.1.1.2.2.3.cmml"><mi id="S2.E4.m1.5.5.1.1.1.1.2.2.3.2" xref="S2.E4.m1.5.5.1.1.1.1.2.2.3.2.cmml">i</mi><mo id="S2.E4.m1.5.5.1.1.1.1.2.2.3.1" xref="S2.E4.m1.5.5.1.1.1.1.2.2.3.1.cmml">=</mo><mn id="S2.E4.m1.5.5.1.1.1.1.2.2.3.3" xref="S2.E4.m1.5.5.1.1.1.1.2.2.3.3.cmml">1</mn></mrow><mrow id="S2.E4.m1.1.1.1.3" xref="S2.E4.m1.1.1.1.2.cmml"><mo id="S2.E4.m1.1.1.1.3.1" stretchy="false" xref="S2.E4.m1.1.1.1.2.1.cmml">|</mo><mover accent="true" id="S2.E4.m1.1.1.1.1" xref="S2.E4.m1.1.1.1.1.cmml"><mi id="S2.E4.m1.1.1.1.1.2" xref="S2.E4.m1.1.1.1.1.2.cmml">y</mi><mo id="S2.E4.m1.1.1.1.1.1" xref="S2.E4.m1.1.1.1.1.1.cmml">^</mo></mover><mo id="S2.E4.m1.1.1.1.3.2" stretchy="false" xref="S2.E4.m1.1.1.1.2.1.cmml">|</mo></mrow></munderover></mstyle><mrow id="S2.E4.m1.5.5.1.1.1.1.1" xref="S2.E4.m1.5.5.1.1.1.1.1.cmml"><mrow id="S2.E4.m1.5.5.1.1.1.1.1.3" xref="S2.E4.m1.5.5.1.1.1.1.1.3.cmml"><mi id="S2.E4.m1.5.5.1.1.1.1.1.3.1" xref="S2.E4.m1.5.5.1.1.1.1.1.3.1.cmml">log</mi><mo id="S2.E4.m1.5.5.1.1.1.1.1.3a" lspace="0.167em" xref="S2.E4.m1.5.5.1.1.1.1.1.3.cmml">⁡</mo><mi id="S2.E4.m1.5.5.1.1.1.1.1.3.2" xref="S2.E4.m1.5.5.1.1.1.1.1.3.2.cmml">p</mi></mrow><mo id="S2.E4.m1.5.5.1.1.1.1.1.2" xref="S2.E4.m1.5.5.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S2.E4.m1.5.5.1.1.1.1.1.1.1" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.cmml"><mo id="S2.E4.m1.5.5.1.1.1.1.1.1.1.2" stretchy="false" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.cmml"><msub id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.cmml"><mover accent="true" id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2.cmml"><mi id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2.2" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2.2.cmml">y</mi><mo id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2.1" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2.1.cmml">^</mo></mover><mi id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.3" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.3.cmml">i</mi></msub><mo fence="false" id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.3" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.3.cmml">|</mo><mrow id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.3.cmml"><msub id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2.2" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml">y</mi><mo id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2.1" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2.1.cmml">^</mo></mover><mrow id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.2" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.2.cmml"></mi><mo id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.1" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.1.cmml">&lt;</mo><mi id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.3" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.3.cmml">i</mi></mrow></msub><mo id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.3" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.3.cmml">,</mo><mi id="S2.E4.m1.2.2" xref="S2.E4.m1.2.2.cmml">x</mi><mo id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.4" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.3.cmml">,</mo><mi id="S2.E4.m1.3.3" xref="S2.E4.m1.3.3.cmml">𝐝</mi><mo id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.5" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.3.cmml">;</mo><msub id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.cmml"><mi id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.2" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.2.cmml">G</mi><mi id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.3" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.3.cmml">θ</mi></msub></mrow></mrow><mo id="S2.E4.m1.5.5.1.1.1.1.1.1.1.3" stretchy="false" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E4.m1.5.5.1.1.1.3" xref="S2.E4.m1.5.5.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E4.m1.5b"><apply id="S2.E4.m1.5.5.cmml" xref="S2.E4.m1.5.5"><eq id="S2.E4.m1.5.5.2.cmml" xref="S2.E4.m1.5.5.2"></eq><csymbol cd="latexml" id="S2.E4.m1.5.5.3.cmml" xref="S2.E4.m1.5.5.3">absent</csymbol><apply id="S2.E4.m1.5.5.1.2.cmml" xref="S2.E4.m1.5.5.1.1"><exp id="S2.E4.m1.4.4.cmml" xref="S2.E4.m1.4.4"></exp><apply id="S2.E4.m1.5.5.1.1.1.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1"><apply id="S2.E4.m1.5.5.1.1.1.1.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E4.m1.5.5.1.1.1.1.2.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.2">superscript</csymbol><apply id="S2.E4.m1.5.5.1.1.1.1.2.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E4.m1.5.5.1.1.1.1.2.2.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.2">subscript</csymbol><sum id="S2.E4.m1.5.5.1.1.1.1.2.2.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.2.2.2"></sum><apply id="S2.E4.m1.5.5.1.1.1.1.2.2.3.cmml" xref="S2.E4.m1.5.5.1.1.1.1.2.2.3"><eq id="S2.E4.m1.5.5.1.1.1.1.2.2.3.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.2.2.3.1"></eq><ci id="S2.E4.m1.5.5.1.1.1.1.2.2.3.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.2.2.3.2">𝑖</ci><cn id="S2.E4.m1.5.5.1.1.1.1.2.2.3.3.cmml" type="integer" xref="S2.E4.m1.5.5.1.1.1.1.2.2.3.3">1</cn></apply></apply><apply id="S2.E4.m1.1.1.1.2.cmml" xref="S2.E4.m1.1.1.1.3"><abs id="S2.E4.m1.1.1.1.2.1.cmml" xref="S2.E4.m1.1.1.1.3.1"></abs><apply id="S2.E4.m1.1.1.1.1.cmml" xref="S2.E4.m1.1.1.1.1"><ci id="S2.E4.m1.1.1.1.1.1.cmml" xref="S2.E4.m1.1.1.1.1.1">^</ci><ci id="S2.E4.m1.1.1.1.1.2.cmml" xref="S2.E4.m1.1.1.1.1.2">𝑦</ci></apply></apply></apply><apply id="S2.E4.m1.5.5.1.1.1.1.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1"><times id="S2.E4.m1.5.5.1.1.1.1.1.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.2"></times><apply id="S2.E4.m1.5.5.1.1.1.1.1.3.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.3"><log id="S2.E4.m1.5.5.1.1.1.1.1.3.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.3.1"></log><ci id="S2.E4.m1.5.5.1.1.1.1.1.3.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.3.2">𝑝</ci></apply><apply id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1"><csymbol cd="latexml" id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.3">conditional</csymbol><apply id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4">subscript</csymbol><apply id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2"><ci id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2.1">^</ci><ci id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.2.2">𝑦</ci></apply><ci id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.3.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.4.3">𝑖</ci></apply><list id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.3.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2"><apply id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2"><ci id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2.1">^</ci><ci id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.2.2">𝑦</ci></apply><apply id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3"><lt id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.1"></lt><csymbol cd="latexml" id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.2">absent</csymbol><ci id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.3.3">𝑖</ci></apply></apply><ci id="S2.E4.m1.2.2.cmml" xref="S2.E4.m1.2.2">𝑥</ci><ci id="S2.E4.m1.3.3.cmml" xref="S2.E4.m1.3.3">𝐝</ci><apply id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.1.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.2.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.2">𝐺</ci><ci id="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.3.cmml" xref="S2.E4.m1.5.5.1.1.1.1.1.1.1.1.2.2.2.3">𝜃</ci></apply></list></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E4.m1.5c">\displaystyle=\exp\left(\sum_{i=1}^{|\hat{y}|}\log p(\hat{y}_{i}|\hat{y}_{&lt;i},%
x,\mathbf{d};G_{\theta})\right)</annotation><annotation encoding="application/x-llamapun" id="S2.E4.m1.5d">= roman_exp ( ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT | over^ start_ARG italic_y end_ARG | end_POSTSUPERSCRIPT roman_log italic_p ( over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT &lt; italic_i end_POSTSUBSCRIPT , italic_x , bold_d ; italic_G start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.p4.8">where <math alttext="\hat{y}_{i}" class="ltx_Math" display="inline" id="S2.p4.4.m1.1"><semantics id="S2.p4.4.m1.1a"><msub id="S2.p4.4.m1.1.1" xref="S2.p4.4.m1.1.1.cmml"><mover accent="true" id="S2.p4.4.m1.1.1.2" xref="S2.p4.4.m1.1.1.2.cmml"><mi id="S2.p4.4.m1.1.1.2.2" xref="S2.p4.4.m1.1.1.2.2.cmml">y</mi><mo id="S2.p4.4.m1.1.1.2.1" xref="S2.p4.4.m1.1.1.2.1.cmml">^</mo></mover><mi id="S2.p4.4.m1.1.1.3" xref="S2.p4.4.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p4.4.m1.1b"><apply id="S2.p4.4.m1.1.1.cmml" xref="S2.p4.4.m1.1.1"><csymbol cd="ambiguous" id="S2.p4.4.m1.1.1.1.cmml" xref="S2.p4.4.m1.1.1">subscript</csymbol><apply id="S2.p4.4.m1.1.1.2.cmml" xref="S2.p4.4.m1.1.1.2"><ci id="S2.p4.4.m1.1.1.2.1.cmml" xref="S2.p4.4.m1.1.1.2.1">^</ci><ci id="S2.p4.4.m1.1.1.2.2.cmml" xref="S2.p4.4.m1.1.1.2.2">𝑦</ci></apply><ci id="S2.p4.4.m1.1.1.3.cmml" xref="S2.p4.4.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.4.m1.1c">\hat{y}_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.p4.4.m1.1d">over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> denotes the <math alttext="i" class="ltx_Math" display="inline" id="S2.p4.5.m2.1"><semantics id="S2.p4.5.m2.1a"><mi id="S2.p4.5.m2.1.1" xref="S2.p4.5.m2.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.p4.5.m2.1b"><ci id="S2.p4.5.m2.1.1.cmml" xref="S2.p4.5.m2.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.5.m2.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.p4.5.m2.1d">italic_i</annotation></semantics></math><sup class="ltx_sup" id="S2.p4.8.1">th</sup> token in <math alttext="\hat{y}" class="ltx_Math" display="inline" id="S2.p4.6.m3.1"><semantics id="S2.p4.6.m3.1a"><mover accent="true" id="S2.p4.6.m3.1.1" xref="S2.p4.6.m3.1.1.cmml"><mi id="S2.p4.6.m3.1.1.2" xref="S2.p4.6.m3.1.1.2.cmml">y</mi><mo id="S2.p4.6.m3.1.1.1" xref="S2.p4.6.m3.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S2.p4.6.m3.1b"><apply id="S2.p4.6.m3.1.1.cmml" xref="S2.p4.6.m3.1.1"><ci id="S2.p4.6.m3.1.1.1.cmml" xref="S2.p4.6.m3.1.1.1">^</ci><ci id="S2.p4.6.m3.1.1.2.cmml" xref="S2.p4.6.m3.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.6.m3.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="S2.p4.6.m3.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math> and <math alttext="\hat{y}_{&lt;i}" class="ltx_Math" display="inline" id="S2.p4.7.m4.1"><semantics id="S2.p4.7.m4.1a"><msub id="S2.p4.7.m4.1.1" xref="S2.p4.7.m4.1.1.cmml"><mover accent="true" id="S2.p4.7.m4.1.1.2" xref="S2.p4.7.m4.1.1.2.cmml"><mi id="S2.p4.7.m4.1.1.2.2" xref="S2.p4.7.m4.1.1.2.2.cmml">y</mi><mo id="S2.p4.7.m4.1.1.2.1" xref="S2.p4.7.m4.1.1.2.1.cmml">^</mo></mover><mrow id="S2.p4.7.m4.1.1.3" xref="S2.p4.7.m4.1.1.3.cmml"><mi id="S2.p4.7.m4.1.1.3.2" xref="S2.p4.7.m4.1.1.3.2.cmml"></mi><mo id="S2.p4.7.m4.1.1.3.1" xref="S2.p4.7.m4.1.1.3.1.cmml">&lt;</mo><mi id="S2.p4.7.m4.1.1.3.3" xref="S2.p4.7.m4.1.1.3.3.cmml">i</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.p4.7.m4.1b"><apply id="S2.p4.7.m4.1.1.cmml" xref="S2.p4.7.m4.1.1"><csymbol cd="ambiguous" id="S2.p4.7.m4.1.1.1.cmml" xref="S2.p4.7.m4.1.1">subscript</csymbol><apply id="S2.p4.7.m4.1.1.2.cmml" xref="S2.p4.7.m4.1.1.2"><ci id="S2.p4.7.m4.1.1.2.1.cmml" xref="S2.p4.7.m4.1.1.2.1">^</ci><ci id="S2.p4.7.m4.1.1.2.2.cmml" xref="S2.p4.7.m4.1.1.2.2">𝑦</ci></apply><apply id="S2.p4.7.m4.1.1.3.cmml" xref="S2.p4.7.m4.1.1.3"><lt id="S2.p4.7.m4.1.1.3.1.cmml" xref="S2.p4.7.m4.1.1.3.1"></lt><csymbol cd="latexml" id="S2.p4.7.m4.1.1.3.2.cmml" xref="S2.p4.7.m4.1.1.3.2">absent</csymbol><ci id="S2.p4.7.m4.1.1.3.3.cmml" xref="S2.p4.7.m4.1.1.3.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.7.m4.1c">\hat{y}_{&lt;i}</annotation><annotation encoding="application/x-llamapun" id="S2.p4.7.m4.1d">over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT &lt; italic_i end_POSTSUBSCRIPT</annotation></semantics></math> denotes all tokens <math alttext="\hat{y}_{1},\hat{y}_{2},\cdots,\hat{y}_{i-1}" class="ltx_Math" display="inline" id="S2.p4.8.m5.4"><semantics id="S2.p4.8.m5.4a"><mrow id="S2.p4.8.m5.4.4.3" xref="S2.p4.8.m5.4.4.4.cmml"><msub id="S2.p4.8.m5.2.2.1.1" xref="S2.p4.8.m5.2.2.1.1.cmml"><mover accent="true" id="S2.p4.8.m5.2.2.1.1.2" xref="S2.p4.8.m5.2.2.1.1.2.cmml"><mi id="S2.p4.8.m5.2.2.1.1.2.2" xref="S2.p4.8.m5.2.2.1.1.2.2.cmml">y</mi><mo id="S2.p4.8.m5.2.2.1.1.2.1" xref="S2.p4.8.m5.2.2.1.1.2.1.cmml">^</mo></mover><mn id="S2.p4.8.m5.2.2.1.1.3" xref="S2.p4.8.m5.2.2.1.1.3.cmml">1</mn></msub><mo id="S2.p4.8.m5.4.4.3.4" xref="S2.p4.8.m5.4.4.4.cmml">,</mo><msub id="S2.p4.8.m5.3.3.2.2" xref="S2.p4.8.m5.3.3.2.2.cmml"><mover accent="true" id="S2.p4.8.m5.3.3.2.2.2" xref="S2.p4.8.m5.3.3.2.2.2.cmml"><mi id="S2.p4.8.m5.3.3.2.2.2.2" xref="S2.p4.8.m5.3.3.2.2.2.2.cmml">y</mi><mo id="S2.p4.8.m5.3.3.2.2.2.1" xref="S2.p4.8.m5.3.3.2.2.2.1.cmml">^</mo></mover><mn id="S2.p4.8.m5.3.3.2.2.3" xref="S2.p4.8.m5.3.3.2.2.3.cmml">2</mn></msub><mo id="S2.p4.8.m5.4.4.3.5" xref="S2.p4.8.m5.4.4.4.cmml">,</mo><mi id="S2.p4.8.m5.1.1" mathvariant="normal" xref="S2.p4.8.m5.1.1.cmml">⋯</mi><mo id="S2.p4.8.m5.4.4.3.6" xref="S2.p4.8.m5.4.4.4.cmml">,</mo><msub id="S2.p4.8.m5.4.4.3.3" xref="S2.p4.8.m5.4.4.3.3.cmml"><mover accent="true" id="S2.p4.8.m5.4.4.3.3.2" xref="S2.p4.8.m5.4.4.3.3.2.cmml"><mi id="S2.p4.8.m5.4.4.3.3.2.2" xref="S2.p4.8.m5.4.4.3.3.2.2.cmml">y</mi><mo id="S2.p4.8.m5.4.4.3.3.2.1" xref="S2.p4.8.m5.4.4.3.3.2.1.cmml">^</mo></mover><mrow id="S2.p4.8.m5.4.4.3.3.3" xref="S2.p4.8.m5.4.4.3.3.3.cmml"><mi id="S2.p4.8.m5.4.4.3.3.3.2" xref="S2.p4.8.m5.4.4.3.3.3.2.cmml">i</mi><mo id="S2.p4.8.m5.4.4.3.3.3.1" xref="S2.p4.8.m5.4.4.3.3.3.1.cmml">−</mo><mn id="S2.p4.8.m5.4.4.3.3.3.3" xref="S2.p4.8.m5.4.4.3.3.3.3.cmml">1</mn></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S2.p4.8.m5.4b"><list id="S2.p4.8.m5.4.4.4.cmml" xref="S2.p4.8.m5.4.4.3"><apply id="S2.p4.8.m5.2.2.1.1.cmml" xref="S2.p4.8.m5.2.2.1.1"><csymbol cd="ambiguous" id="S2.p4.8.m5.2.2.1.1.1.cmml" xref="S2.p4.8.m5.2.2.1.1">subscript</csymbol><apply id="S2.p4.8.m5.2.2.1.1.2.cmml" xref="S2.p4.8.m5.2.2.1.1.2"><ci id="S2.p4.8.m5.2.2.1.1.2.1.cmml" xref="S2.p4.8.m5.2.2.1.1.2.1">^</ci><ci id="S2.p4.8.m5.2.2.1.1.2.2.cmml" xref="S2.p4.8.m5.2.2.1.1.2.2">𝑦</ci></apply><cn id="S2.p4.8.m5.2.2.1.1.3.cmml" type="integer" xref="S2.p4.8.m5.2.2.1.1.3">1</cn></apply><apply id="S2.p4.8.m5.3.3.2.2.cmml" xref="S2.p4.8.m5.3.3.2.2"><csymbol cd="ambiguous" id="S2.p4.8.m5.3.3.2.2.1.cmml" xref="S2.p4.8.m5.3.3.2.2">subscript</csymbol><apply id="S2.p4.8.m5.3.3.2.2.2.cmml" xref="S2.p4.8.m5.3.3.2.2.2"><ci id="S2.p4.8.m5.3.3.2.2.2.1.cmml" xref="S2.p4.8.m5.3.3.2.2.2.1">^</ci><ci id="S2.p4.8.m5.3.3.2.2.2.2.cmml" xref="S2.p4.8.m5.3.3.2.2.2.2">𝑦</ci></apply><cn id="S2.p4.8.m5.3.3.2.2.3.cmml" type="integer" xref="S2.p4.8.m5.3.3.2.2.3">2</cn></apply><ci id="S2.p4.8.m5.1.1.cmml" xref="S2.p4.8.m5.1.1">⋯</ci><apply id="S2.p4.8.m5.4.4.3.3.cmml" xref="S2.p4.8.m5.4.4.3.3"><csymbol cd="ambiguous" id="S2.p4.8.m5.4.4.3.3.1.cmml" xref="S2.p4.8.m5.4.4.3.3">subscript</csymbol><apply id="S2.p4.8.m5.4.4.3.3.2.cmml" xref="S2.p4.8.m5.4.4.3.3.2"><ci id="S2.p4.8.m5.4.4.3.3.2.1.cmml" xref="S2.p4.8.m5.4.4.3.3.2.1">^</ci><ci id="S2.p4.8.m5.4.4.3.3.2.2.cmml" xref="S2.p4.8.m5.4.4.3.3.2.2">𝑦</ci></apply><apply id="S2.p4.8.m5.4.4.3.3.3.cmml" xref="S2.p4.8.m5.4.4.3.3.3"><minus id="S2.p4.8.m5.4.4.3.3.3.1.cmml" xref="S2.p4.8.m5.4.4.3.3.3.1"></minus><ci id="S2.p4.8.m5.4.4.3.3.3.2.cmml" xref="S2.p4.8.m5.4.4.3.3.3.2">𝑖</ci><cn id="S2.p4.8.m5.4.4.3.3.3.3.cmml" type="integer" xref="S2.p4.8.m5.4.4.3.3.3.3">1</cn></apply></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.8.m5.4c">\hat{y}_{1},\hat{y}_{2},\cdots,\hat{y}_{i-1}</annotation><annotation encoding="application/x-llamapun" id="S2.p4.8.m5.4d">over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , ⋯ , over^ start_ARG italic_y end_ARG start_POSTSUBSCRIPT italic_i - 1 end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S2.p5">
<p class="ltx_p" id="S2.p5.8">The next step is to estimate <math alttext="p(\mathbf{d}|x;R_{\phi})" class="ltx_Math" display="inline" id="S2.p5.1.m1.2"><semantics id="S2.p5.1.m1.2a"><mrow id="S2.p5.1.m1.2.2" xref="S2.p5.1.m1.2.2.cmml"><mi id="S2.p5.1.m1.2.2.3" xref="S2.p5.1.m1.2.2.3.cmml">p</mi><mo id="S2.p5.1.m1.2.2.2" xref="S2.p5.1.m1.2.2.2.cmml">⁢</mo><mrow id="S2.p5.1.m1.2.2.1.1" xref="S2.p5.1.m1.2.2.1.1.1.cmml"><mo id="S2.p5.1.m1.2.2.1.1.2" stretchy="false" xref="S2.p5.1.m1.2.2.1.1.1.cmml">(</mo><mrow id="S2.p5.1.m1.2.2.1.1.1" xref="S2.p5.1.m1.2.2.1.1.1.cmml"><mi id="S2.p5.1.m1.2.2.1.1.1.3" xref="S2.p5.1.m1.2.2.1.1.1.3.cmml">𝐝</mi><mo fence="false" id="S2.p5.1.m1.2.2.1.1.1.2" xref="S2.p5.1.m1.2.2.1.1.1.2.cmml">|</mo><mrow id="S2.p5.1.m1.2.2.1.1.1.1.1" xref="S2.p5.1.m1.2.2.1.1.1.1.2.cmml"><mi id="S2.p5.1.m1.1.1" xref="S2.p5.1.m1.1.1.cmml">x</mi><mo id="S2.p5.1.m1.2.2.1.1.1.1.1.2" xref="S2.p5.1.m1.2.2.1.1.1.1.2.cmml">;</mo><msub id="S2.p5.1.m1.2.2.1.1.1.1.1.1" xref="S2.p5.1.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S2.p5.1.m1.2.2.1.1.1.1.1.1.2" xref="S2.p5.1.m1.2.2.1.1.1.1.1.1.2.cmml">R</mi><mi id="S2.p5.1.m1.2.2.1.1.1.1.1.1.3" xref="S2.p5.1.m1.2.2.1.1.1.1.1.1.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.p5.1.m1.2.2.1.1.3" stretchy="false" xref="S2.p5.1.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p5.1.m1.2b"><apply id="S2.p5.1.m1.2.2.cmml" xref="S2.p5.1.m1.2.2"><times id="S2.p5.1.m1.2.2.2.cmml" xref="S2.p5.1.m1.2.2.2"></times><ci id="S2.p5.1.m1.2.2.3.cmml" xref="S2.p5.1.m1.2.2.3">𝑝</ci><apply id="S2.p5.1.m1.2.2.1.1.1.cmml" xref="S2.p5.1.m1.2.2.1.1"><csymbol cd="latexml" id="S2.p5.1.m1.2.2.1.1.1.2.cmml" xref="S2.p5.1.m1.2.2.1.1.1.2">conditional</csymbol><ci id="S2.p5.1.m1.2.2.1.1.1.3.cmml" xref="S2.p5.1.m1.2.2.1.1.1.3">𝐝</ci><list id="S2.p5.1.m1.2.2.1.1.1.1.2.cmml" xref="S2.p5.1.m1.2.2.1.1.1.1.1"><ci id="S2.p5.1.m1.1.1.cmml" xref="S2.p5.1.m1.1.1">𝑥</ci><apply id="S2.p5.1.m1.2.2.1.1.1.1.1.1.cmml" xref="S2.p5.1.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.p5.1.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S2.p5.1.m1.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S2.p5.1.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S2.p5.1.m1.2.2.1.1.1.1.1.1.2">𝑅</ci><ci id="S2.p5.1.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S2.p5.1.m1.2.2.1.1.1.1.1.1.3">italic-ϕ</ci></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.1.m1.2c">p(\mathbf{d}|x;R_{\phi})</annotation><annotation encoding="application/x-llamapun" id="S2.p5.1.m1.2d">italic_p ( bold_d | italic_x ; italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT )</annotation></semantics></math> in Equation (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.E3" title="In 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">3</span></a>), which represents the probability of retrieving the result list <math alttext="\mathbf{d}" class="ltx_Math" display="inline" id="S2.p5.2.m2.1"><semantics id="S2.p5.2.m2.1a"><mi id="S2.p5.2.m2.1.1" xref="S2.p5.2.m2.1.1.cmml">𝐝</mi><annotation-xml encoding="MathML-Content" id="S2.p5.2.m2.1b"><ci id="S2.p5.2.m2.1.1.cmml" xref="S2.p5.2.m2.1.1">𝐝</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.2.m2.1c">\mathbf{d}</annotation><annotation encoding="application/x-llamapun" id="S2.p5.2.m2.1d">bold_d</annotation></semantics></math> in response to input <math alttext="x" class="ltx_Math" display="inline" id="S2.p5.3.m3.1"><semantics id="S2.p5.3.m3.1a"><mi id="S2.p5.3.m3.1.1" xref="S2.p5.3.m3.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S2.p5.3.m3.1b"><ci id="S2.p5.3.m3.1.1.cmml" xref="S2.p5.3.m3.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.3.m3.1c">x</annotation><annotation encoding="application/x-llamapun" id="S2.p5.3.m3.1d">italic_x</annotation></semantics></math> using the retrieval model <math alttext="R_{\phi}" class="ltx_Math" display="inline" id="S2.p5.4.m4.1"><semantics id="S2.p5.4.m4.1a"><msub id="S2.p5.4.m4.1.1" xref="S2.p5.4.m4.1.1.cmml"><mi id="S2.p5.4.m4.1.1.2" xref="S2.p5.4.m4.1.1.2.cmml">R</mi><mi id="S2.p5.4.m4.1.1.3" xref="S2.p5.4.m4.1.1.3.cmml">ϕ</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p5.4.m4.1b"><apply id="S2.p5.4.m4.1.1.cmml" xref="S2.p5.4.m4.1.1"><csymbol cd="ambiguous" id="S2.p5.4.m4.1.1.1.cmml" xref="S2.p5.4.m4.1.1">subscript</csymbol><ci id="S2.p5.4.m4.1.1.2.cmml" xref="S2.p5.4.m4.1.1.2">𝑅</ci><ci id="S2.p5.4.m4.1.1.3.cmml" xref="S2.p5.4.m4.1.1.3">italic-ϕ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.4.m4.1c">R_{\phi}</annotation><annotation encoding="application/x-llamapun" id="S2.p5.4.m4.1d">italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT</annotation></semantics></math>. Most retrieval models score each query-document pair independently and then sort them with respect to their relevance score in descending order. Therefore, the probability of a document list being produced by <math alttext="R_{\phi}" class="ltx_Math" display="inline" id="S2.p5.5.m5.1"><semantics id="S2.p5.5.m5.1a"><msub id="S2.p5.5.m5.1.1" xref="S2.p5.5.m5.1.1.cmml"><mi id="S2.p5.5.m5.1.1.2" xref="S2.p5.5.m5.1.1.2.cmml">R</mi><mi id="S2.p5.5.m5.1.1.3" xref="S2.p5.5.m5.1.1.3.cmml">ϕ</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p5.5.m5.1b"><apply id="S2.p5.5.m5.1.1.cmml" xref="S2.p5.5.m5.1.1"><csymbol cd="ambiguous" id="S2.p5.5.m5.1.1.1.cmml" xref="S2.p5.5.m5.1.1">subscript</csymbol><ci id="S2.p5.5.m5.1.1.2.cmml" xref="S2.p5.5.m5.1.1.2">𝑅</ci><ci id="S2.p5.5.m5.1.1.3.cmml" xref="S2.p5.5.m5.1.1.3">italic-ϕ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.5.m5.1c">R_{\phi}</annotation><annotation encoding="application/x-llamapun" id="S2.p5.5.m5.1d">italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT</annotation></semantics></math> can be modeled as a <em class="ltx_emph ltx_font_italic" id="S2.p5.8.1">sampling without replacement</em> process. In other words, assume that the retrieval model <math alttext="R_{\phi}" class="ltx_Math" display="inline" id="S2.p5.6.m6.1"><semantics id="S2.p5.6.m6.1a"><msub id="S2.p5.6.m6.1.1" xref="S2.p5.6.m6.1.1.cmml"><mi id="S2.p5.6.m6.1.1.2" xref="S2.p5.6.m6.1.1.2.cmml">R</mi><mi id="S2.p5.6.m6.1.1.3" xref="S2.p5.6.m6.1.1.3.cmml">ϕ</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p5.6.m6.1b"><apply id="S2.p5.6.m6.1.1.cmml" xref="S2.p5.6.m6.1.1"><csymbol cd="ambiguous" id="S2.p5.6.m6.1.1.1.cmml" xref="S2.p5.6.m6.1.1">subscript</csymbol><ci id="S2.p5.6.m6.1.1.2.cmml" xref="S2.p5.6.m6.1.1.2">𝑅</ci><ci id="S2.p5.6.m6.1.1.3.cmml" xref="S2.p5.6.m6.1.1.3">italic-ϕ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.6.m6.1c">R_{\phi}</annotation><annotation encoding="application/x-llamapun" id="S2.p5.6.m6.1d">italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT</annotation></semantics></math> produces a retrieval score <math alttext="s^{\phi}_{xd}\in\mathbb{R}" class="ltx_Math" display="inline" id="S2.p5.7.m7.1"><semantics id="S2.p5.7.m7.1a"><mrow id="S2.p5.7.m7.1.1" xref="S2.p5.7.m7.1.1.cmml"><msubsup id="S2.p5.7.m7.1.1.2" xref="S2.p5.7.m7.1.1.2.cmml"><mi id="S2.p5.7.m7.1.1.2.2.2" xref="S2.p5.7.m7.1.1.2.2.2.cmml">s</mi><mrow id="S2.p5.7.m7.1.1.2.3" xref="S2.p5.7.m7.1.1.2.3.cmml"><mi id="S2.p5.7.m7.1.1.2.3.2" xref="S2.p5.7.m7.1.1.2.3.2.cmml">x</mi><mo id="S2.p5.7.m7.1.1.2.3.1" xref="S2.p5.7.m7.1.1.2.3.1.cmml">⁢</mo><mi id="S2.p5.7.m7.1.1.2.3.3" xref="S2.p5.7.m7.1.1.2.3.3.cmml">d</mi></mrow><mi id="S2.p5.7.m7.1.1.2.2.3" xref="S2.p5.7.m7.1.1.2.2.3.cmml">ϕ</mi></msubsup><mo id="S2.p5.7.m7.1.1.1" xref="S2.p5.7.m7.1.1.1.cmml">∈</mo><mi id="S2.p5.7.m7.1.1.3" xref="S2.p5.7.m7.1.1.3.cmml">ℝ</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.p5.7.m7.1b"><apply id="S2.p5.7.m7.1.1.cmml" xref="S2.p5.7.m7.1.1"><in id="S2.p5.7.m7.1.1.1.cmml" xref="S2.p5.7.m7.1.1.1"></in><apply id="S2.p5.7.m7.1.1.2.cmml" xref="S2.p5.7.m7.1.1.2"><csymbol cd="ambiguous" id="S2.p5.7.m7.1.1.2.1.cmml" xref="S2.p5.7.m7.1.1.2">subscript</csymbol><apply id="S2.p5.7.m7.1.1.2.2.cmml" xref="S2.p5.7.m7.1.1.2"><csymbol cd="ambiguous" id="S2.p5.7.m7.1.1.2.2.1.cmml" xref="S2.p5.7.m7.1.1.2">superscript</csymbol><ci id="S2.p5.7.m7.1.1.2.2.2.cmml" xref="S2.p5.7.m7.1.1.2.2.2">𝑠</ci><ci id="S2.p5.7.m7.1.1.2.2.3.cmml" xref="S2.p5.7.m7.1.1.2.2.3">italic-ϕ</ci></apply><apply id="S2.p5.7.m7.1.1.2.3.cmml" xref="S2.p5.7.m7.1.1.2.3"><times id="S2.p5.7.m7.1.1.2.3.1.cmml" xref="S2.p5.7.m7.1.1.2.3.1"></times><ci id="S2.p5.7.m7.1.1.2.3.2.cmml" xref="S2.p5.7.m7.1.1.2.3.2">𝑥</ci><ci id="S2.p5.7.m7.1.1.2.3.3.cmml" xref="S2.p5.7.m7.1.1.2.3.3">𝑑</ci></apply></apply><ci id="S2.p5.7.m7.1.1.3.cmml" xref="S2.p5.7.m7.1.1.3">ℝ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.7.m7.1c">s^{\phi}_{xd}\in\mathbb{R}</annotation><annotation encoding="application/x-llamapun" id="S2.p5.7.m7.1d">italic_s start_POSTSUPERSCRIPT italic_ϕ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_x italic_d end_POSTSUBSCRIPT ∈ blackboard_R</annotation></semantics></math> for any document <math alttext="d\in C" class="ltx_Math" display="inline" id="S2.p5.8.m8.1"><semantics id="S2.p5.8.m8.1a"><mrow id="S2.p5.8.m8.1.1" xref="S2.p5.8.m8.1.1.cmml"><mi id="S2.p5.8.m8.1.1.2" xref="S2.p5.8.m8.1.1.2.cmml">d</mi><mo id="S2.p5.8.m8.1.1.1" xref="S2.p5.8.m8.1.1.1.cmml">∈</mo><mi id="S2.p5.8.m8.1.1.3" xref="S2.p5.8.m8.1.1.3.cmml">C</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.p5.8.m8.1b"><apply id="S2.p5.8.m8.1.1.cmml" xref="S2.p5.8.m8.1.1"><in id="S2.p5.8.m8.1.1.1.cmml" xref="S2.p5.8.m8.1.1.1"></in><ci id="S2.p5.8.m8.1.1.2.cmml" xref="S2.p5.8.m8.1.1.2">𝑑</ci><ci id="S2.p5.8.m8.1.1.3.cmml" xref="S2.p5.8.m8.1.1.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.8.m8.1c">d\in C</annotation><annotation encoding="application/x-llamapun" id="S2.p5.8.m8.1d">italic_d ∈ italic_C</annotation></semantics></math>. Sampling without replacement probability of a document
list is then computed as:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(5)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p(\mathbf{d}|x;R_{\phi})=\prod_{i=1}^{|\mathbf{d}|}\frac{p(d_{i}|x;R_{\phi})}{%
1-\sum_{j=1}^{i-1}{p(d_{j}|x;R_{\phi})}}" class="ltx_Math" display="block" id="S2.E5.m1.7"><semantics id="S2.E5.m1.7a"><mrow id="S2.E5.m1.7.7" xref="S2.E5.m1.7.7.cmml"><mrow id="S2.E5.m1.7.7.1" xref="S2.E5.m1.7.7.1.cmml"><mi id="S2.E5.m1.7.7.1.3" xref="S2.E5.m1.7.7.1.3.cmml">p</mi><mo id="S2.E5.m1.7.7.1.2" xref="S2.E5.m1.7.7.1.2.cmml">⁢</mo><mrow id="S2.E5.m1.7.7.1.1.1" xref="S2.E5.m1.7.7.1.1.1.1.cmml"><mo id="S2.E5.m1.7.7.1.1.1.2" stretchy="false" xref="S2.E5.m1.7.7.1.1.1.1.cmml">(</mo><mrow id="S2.E5.m1.7.7.1.1.1.1" xref="S2.E5.m1.7.7.1.1.1.1.cmml"><mi id="S2.E5.m1.7.7.1.1.1.1.3" xref="S2.E5.m1.7.7.1.1.1.1.3.cmml">𝐝</mi><mo fence="false" id="S2.E5.m1.7.7.1.1.1.1.2" xref="S2.E5.m1.7.7.1.1.1.1.2.cmml">|</mo><mrow id="S2.E5.m1.7.7.1.1.1.1.1.1" xref="S2.E5.m1.7.7.1.1.1.1.1.2.cmml"><mi id="S2.E5.m1.6.6" xref="S2.E5.m1.6.6.cmml">x</mi><mo id="S2.E5.m1.7.7.1.1.1.1.1.1.2" xref="S2.E5.m1.7.7.1.1.1.1.1.2.cmml">;</mo><msub id="S2.E5.m1.7.7.1.1.1.1.1.1.1" xref="S2.E5.m1.7.7.1.1.1.1.1.1.1.cmml"><mi id="S2.E5.m1.7.7.1.1.1.1.1.1.1.2" xref="S2.E5.m1.7.7.1.1.1.1.1.1.1.2.cmml">R</mi><mi id="S2.E5.m1.7.7.1.1.1.1.1.1.1.3" xref="S2.E5.m1.7.7.1.1.1.1.1.1.1.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.E5.m1.7.7.1.1.1.3" stretchy="false" xref="S2.E5.m1.7.7.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.E5.m1.7.7.2" rspace="0.111em" xref="S2.E5.m1.7.7.2.cmml">=</mo><mrow id="S2.E5.m1.7.7.3" xref="S2.E5.m1.7.7.3.cmml"><munderover id="S2.E5.m1.7.7.3.1" xref="S2.E5.m1.7.7.3.1.cmml"><mo id="S2.E5.m1.7.7.3.1.2.2" movablelimits="false" xref="S2.E5.m1.7.7.3.1.2.2.cmml">∏</mo><mrow id="S2.E5.m1.7.7.3.1.2.3" xref="S2.E5.m1.7.7.3.1.2.3.cmml"><mi id="S2.E5.m1.7.7.3.1.2.3.2" xref="S2.E5.m1.7.7.3.1.2.3.2.cmml">i</mi><mo id="S2.E5.m1.7.7.3.1.2.3.1" xref="S2.E5.m1.7.7.3.1.2.3.1.cmml">=</mo><mn id="S2.E5.m1.7.7.3.1.2.3.3" xref="S2.E5.m1.7.7.3.1.2.3.3.cmml">1</mn></mrow><mrow id="S2.E5.m1.1.1.1.3" xref="S2.E5.m1.1.1.1.2.cmml"><mo id="S2.E5.m1.1.1.1.3.1" stretchy="false" xref="S2.E5.m1.1.1.1.2.1.cmml">|</mo><mi id="S2.E5.m1.1.1.1.1" xref="S2.E5.m1.1.1.1.1.cmml">𝐝</mi><mo id="S2.E5.m1.1.1.1.3.2" stretchy="false" xref="S2.E5.m1.1.1.1.2.1.cmml">|</mo></mrow></munderover><mfrac id="S2.E5.m1.5.5" xref="S2.E5.m1.5.5.cmml"><mrow id="S2.E5.m1.3.3.2" xref="S2.E5.m1.3.3.2.cmml"><mi id="S2.E5.m1.3.3.2.4" xref="S2.E5.m1.3.3.2.4.cmml">p</mi><mo id="S2.E5.m1.3.3.2.3" xref="S2.E5.m1.3.3.2.3.cmml">⁢</mo><mrow id="S2.E5.m1.3.3.2.2.1" xref="S2.E5.m1.3.3.2.2.1.1.cmml"><mo id="S2.E5.m1.3.3.2.2.1.2" stretchy="false" xref="S2.E5.m1.3.3.2.2.1.1.cmml">(</mo><mrow id="S2.E5.m1.3.3.2.2.1.1" xref="S2.E5.m1.3.3.2.2.1.1.cmml"><msub id="S2.E5.m1.3.3.2.2.1.1.3" xref="S2.E5.m1.3.3.2.2.1.1.3.cmml"><mi id="S2.E5.m1.3.3.2.2.1.1.3.2" xref="S2.E5.m1.3.3.2.2.1.1.3.2.cmml">d</mi><mi id="S2.E5.m1.3.3.2.2.1.1.3.3" xref="S2.E5.m1.3.3.2.2.1.1.3.3.cmml">i</mi></msub><mo fence="false" id="S2.E5.m1.3.3.2.2.1.1.2" xref="S2.E5.m1.3.3.2.2.1.1.2.cmml">|</mo><mrow id="S2.E5.m1.3.3.2.2.1.1.1.1" xref="S2.E5.m1.3.3.2.2.1.1.1.2.cmml"><mi id="S2.E5.m1.2.2.1.1" xref="S2.E5.m1.2.2.1.1.cmml">x</mi><mo id="S2.E5.m1.3.3.2.2.1.1.1.1.2" xref="S2.E5.m1.3.3.2.2.1.1.1.2.cmml">;</mo><msub id="S2.E5.m1.3.3.2.2.1.1.1.1.1" xref="S2.E5.m1.3.3.2.2.1.1.1.1.1.cmml"><mi id="S2.E5.m1.3.3.2.2.1.1.1.1.1.2" xref="S2.E5.m1.3.3.2.2.1.1.1.1.1.2.cmml">R</mi><mi id="S2.E5.m1.3.3.2.2.1.1.1.1.1.3" xref="S2.E5.m1.3.3.2.2.1.1.1.1.1.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.E5.m1.3.3.2.2.1.3" stretchy="false" xref="S2.E5.m1.3.3.2.2.1.1.cmml">)</mo></mrow></mrow><mrow id="S2.E5.m1.5.5.4" xref="S2.E5.m1.5.5.4.cmml"><mn id="S2.E5.m1.5.5.4.4" xref="S2.E5.m1.5.5.4.4.cmml">1</mn><mo id="S2.E5.m1.5.5.4.3" rspace="0.055em" xref="S2.E5.m1.5.5.4.3.cmml">−</mo><mrow id="S2.E5.m1.5.5.4.2" xref="S2.E5.m1.5.5.4.2.cmml"><msubsup id="S2.E5.m1.5.5.4.2.2" xref="S2.E5.m1.5.5.4.2.2.cmml"><mo id="S2.E5.m1.5.5.4.2.2.2.2" xref="S2.E5.m1.5.5.4.2.2.2.2.cmml">∑</mo><mrow id="S2.E5.m1.5.5.4.2.2.2.3" xref="S2.E5.m1.5.5.4.2.2.2.3.cmml"><mi id="S2.E5.m1.5.5.4.2.2.2.3.2" xref="S2.E5.m1.5.5.4.2.2.2.3.2.cmml">j</mi><mo id="S2.E5.m1.5.5.4.2.2.2.3.1" xref="S2.E5.m1.5.5.4.2.2.2.3.1.cmml">=</mo><mn id="S2.E5.m1.5.5.4.2.2.2.3.3" xref="S2.E5.m1.5.5.4.2.2.2.3.3.cmml">1</mn></mrow><mrow id="S2.E5.m1.5.5.4.2.2.3" xref="S2.E5.m1.5.5.4.2.2.3.cmml"><mi id="S2.E5.m1.5.5.4.2.2.3.2" xref="S2.E5.m1.5.5.4.2.2.3.2.cmml">i</mi><mo id="S2.E5.m1.5.5.4.2.2.3.1" xref="S2.E5.m1.5.5.4.2.2.3.1.cmml">−</mo><mn id="S2.E5.m1.5.5.4.2.2.3.3" xref="S2.E5.m1.5.5.4.2.2.3.3.cmml">1</mn></mrow></msubsup><mrow id="S2.E5.m1.5.5.4.2.1" xref="S2.E5.m1.5.5.4.2.1.cmml"><mi id="S2.E5.m1.5.5.4.2.1.3" xref="S2.E5.m1.5.5.4.2.1.3.cmml">p</mi><mo id="S2.E5.m1.5.5.4.2.1.2" xref="S2.E5.m1.5.5.4.2.1.2.cmml">⁢</mo><mrow id="S2.E5.m1.5.5.4.2.1.1.1" xref="S2.E5.m1.5.5.4.2.1.1.1.1.cmml"><mo id="S2.E5.m1.5.5.4.2.1.1.1.2" stretchy="false" xref="S2.E5.m1.5.5.4.2.1.1.1.1.cmml">(</mo><mrow id="S2.E5.m1.5.5.4.2.1.1.1.1" xref="S2.E5.m1.5.5.4.2.1.1.1.1.cmml"><msub id="S2.E5.m1.5.5.4.2.1.1.1.1.3" xref="S2.E5.m1.5.5.4.2.1.1.1.1.3.cmml"><mi id="S2.E5.m1.5.5.4.2.1.1.1.1.3.2" xref="S2.E5.m1.5.5.4.2.1.1.1.1.3.2.cmml">d</mi><mi id="S2.E5.m1.5.5.4.2.1.1.1.1.3.3" xref="S2.E5.m1.5.5.4.2.1.1.1.1.3.3.cmml">j</mi></msub><mo fence="false" id="S2.E5.m1.5.5.4.2.1.1.1.1.2" xref="S2.E5.m1.5.5.4.2.1.1.1.1.2.cmml">|</mo><mrow id="S2.E5.m1.5.5.4.2.1.1.1.1.1.1" xref="S2.E5.m1.5.5.4.2.1.1.1.1.1.2.cmml"><mi id="S2.E5.m1.4.4.3.1" xref="S2.E5.m1.4.4.3.1.cmml">x</mi><mo id="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.2" xref="S2.E5.m1.5.5.4.2.1.1.1.1.1.2.cmml">;</mo><msub id="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1" xref="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.cmml"><mi id="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.2" xref="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.2.cmml">R</mi><mi id="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.3" xref="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.E5.m1.5.5.4.2.1.1.1.3" stretchy="false" xref="S2.E5.m1.5.5.4.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow></mfrac></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E5.m1.7b"><apply id="S2.E5.m1.7.7.cmml" xref="S2.E5.m1.7.7"><eq id="S2.E5.m1.7.7.2.cmml" xref="S2.E5.m1.7.7.2"></eq><apply id="S2.E5.m1.7.7.1.cmml" xref="S2.E5.m1.7.7.1"><times id="S2.E5.m1.7.7.1.2.cmml" xref="S2.E5.m1.7.7.1.2"></times><ci id="S2.E5.m1.7.7.1.3.cmml" xref="S2.E5.m1.7.7.1.3">𝑝</ci><apply id="S2.E5.m1.7.7.1.1.1.1.cmml" xref="S2.E5.m1.7.7.1.1.1"><csymbol cd="latexml" id="S2.E5.m1.7.7.1.1.1.1.2.cmml" xref="S2.E5.m1.7.7.1.1.1.1.2">conditional</csymbol><ci id="S2.E5.m1.7.7.1.1.1.1.3.cmml" xref="S2.E5.m1.7.7.1.1.1.1.3">𝐝</ci><list id="S2.E5.m1.7.7.1.1.1.1.1.2.cmml" xref="S2.E5.m1.7.7.1.1.1.1.1.1"><ci id="S2.E5.m1.6.6.cmml" xref="S2.E5.m1.6.6">𝑥</ci><apply id="S2.E5.m1.7.7.1.1.1.1.1.1.1.cmml" xref="S2.E5.m1.7.7.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E5.m1.7.7.1.1.1.1.1.1.1.1.cmml" xref="S2.E5.m1.7.7.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E5.m1.7.7.1.1.1.1.1.1.1.2.cmml" xref="S2.E5.m1.7.7.1.1.1.1.1.1.1.2">𝑅</ci><ci id="S2.E5.m1.7.7.1.1.1.1.1.1.1.3.cmml" xref="S2.E5.m1.7.7.1.1.1.1.1.1.1.3">italic-ϕ</ci></apply></list></apply></apply><apply id="S2.E5.m1.7.7.3.cmml" xref="S2.E5.m1.7.7.3"><apply id="S2.E5.m1.7.7.3.1.cmml" xref="S2.E5.m1.7.7.3.1"><csymbol cd="ambiguous" id="S2.E5.m1.7.7.3.1.1.cmml" xref="S2.E5.m1.7.7.3.1">superscript</csymbol><apply id="S2.E5.m1.7.7.3.1.2.cmml" xref="S2.E5.m1.7.7.3.1"><csymbol cd="ambiguous" id="S2.E5.m1.7.7.3.1.2.1.cmml" xref="S2.E5.m1.7.7.3.1">subscript</csymbol><csymbol cd="latexml" id="S2.E5.m1.7.7.3.1.2.2.cmml" xref="S2.E5.m1.7.7.3.1.2.2">product</csymbol><apply id="S2.E5.m1.7.7.3.1.2.3.cmml" xref="S2.E5.m1.7.7.3.1.2.3"><eq id="S2.E5.m1.7.7.3.1.2.3.1.cmml" xref="S2.E5.m1.7.7.3.1.2.3.1"></eq><ci id="S2.E5.m1.7.7.3.1.2.3.2.cmml" xref="S2.E5.m1.7.7.3.1.2.3.2">𝑖</ci><cn id="S2.E5.m1.7.7.3.1.2.3.3.cmml" type="integer" xref="S2.E5.m1.7.7.3.1.2.3.3">1</cn></apply></apply><apply id="S2.E5.m1.1.1.1.2.cmml" xref="S2.E5.m1.1.1.1.3"><abs id="S2.E5.m1.1.1.1.2.1.cmml" xref="S2.E5.m1.1.1.1.3.1"></abs><ci id="S2.E5.m1.1.1.1.1.cmml" xref="S2.E5.m1.1.1.1.1">𝐝</ci></apply></apply><apply id="S2.E5.m1.5.5.cmml" xref="S2.E5.m1.5.5"><divide id="S2.E5.m1.5.5.5.cmml" xref="S2.E5.m1.5.5"></divide><apply id="S2.E5.m1.3.3.2.cmml" xref="S2.E5.m1.3.3.2"><times id="S2.E5.m1.3.3.2.3.cmml" xref="S2.E5.m1.3.3.2.3"></times><ci id="S2.E5.m1.3.3.2.4.cmml" xref="S2.E5.m1.3.3.2.4">𝑝</ci><apply id="S2.E5.m1.3.3.2.2.1.1.cmml" xref="S2.E5.m1.3.3.2.2.1"><csymbol cd="latexml" id="S2.E5.m1.3.3.2.2.1.1.2.cmml" xref="S2.E5.m1.3.3.2.2.1.1.2">conditional</csymbol><apply id="S2.E5.m1.3.3.2.2.1.1.3.cmml" xref="S2.E5.m1.3.3.2.2.1.1.3"><csymbol cd="ambiguous" id="S2.E5.m1.3.3.2.2.1.1.3.1.cmml" xref="S2.E5.m1.3.3.2.2.1.1.3">subscript</csymbol><ci id="S2.E5.m1.3.3.2.2.1.1.3.2.cmml" xref="S2.E5.m1.3.3.2.2.1.1.3.2">𝑑</ci><ci id="S2.E5.m1.3.3.2.2.1.1.3.3.cmml" xref="S2.E5.m1.3.3.2.2.1.1.3.3">𝑖</ci></apply><list id="S2.E5.m1.3.3.2.2.1.1.1.2.cmml" xref="S2.E5.m1.3.3.2.2.1.1.1.1"><ci id="S2.E5.m1.2.2.1.1.cmml" xref="S2.E5.m1.2.2.1.1">𝑥</ci><apply id="S2.E5.m1.3.3.2.2.1.1.1.1.1.cmml" xref="S2.E5.m1.3.3.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E5.m1.3.3.2.2.1.1.1.1.1.1.cmml" xref="S2.E5.m1.3.3.2.2.1.1.1.1.1">subscript</csymbol><ci id="S2.E5.m1.3.3.2.2.1.1.1.1.1.2.cmml" xref="S2.E5.m1.3.3.2.2.1.1.1.1.1.2">𝑅</ci><ci id="S2.E5.m1.3.3.2.2.1.1.1.1.1.3.cmml" xref="S2.E5.m1.3.3.2.2.1.1.1.1.1.3">italic-ϕ</ci></apply></list></apply></apply><apply id="S2.E5.m1.5.5.4.cmml" xref="S2.E5.m1.5.5.4"><minus id="S2.E5.m1.5.5.4.3.cmml" xref="S2.E5.m1.5.5.4.3"></minus><cn id="S2.E5.m1.5.5.4.4.cmml" type="integer" xref="S2.E5.m1.5.5.4.4">1</cn><apply id="S2.E5.m1.5.5.4.2.cmml" xref="S2.E5.m1.5.5.4.2"><apply id="S2.E5.m1.5.5.4.2.2.cmml" xref="S2.E5.m1.5.5.4.2.2"><csymbol cd="ambiguous" id="S2.E5.m1.5.5.4.2.2.1.cmml" xref="S2.E5.m1.5.5.4.2.2">superscript</csymbol><apply id="S2.E5.m1.5.5.4.2.2.2.cmml" xref="S2.E5.m1.5.5.4.2.2"><csymbol cd="ambiguous" id="S2.E5.m1.5.5.4.2.2.2.1.cmml" xref="S2.E5.m1.5.5.4.2.2">subscript</csymbol><sum id="S2.E5.m1.5.5.4.2.2.2.2.cmml" xref="S2.E5.m1.5.5.4.2.2.2.2"></sum><apply id="S2.E5.m1.5.5.4.2.2.2.3.cmml" xref="S2.E5.m1.5.5.4.2.2.2.3"><eq id="S2.E5.m1.5.5.4.2.2.2.3.1.cmml" xref="S2.E5.m1.5.5.4.2.2.2.3.1"></eq><ci id="S2.E5.m1.5.5.4.2.2.2.3.2.cmml" xref="S2.E5.m1.5.5.4.2.2.2.3.2">𝑗</ci><cn id="S2.E5.m1.5.5.4.2.2.2.3.3.cmml" type="integer" xref="S2.E5.m1.5.5.4.2.2.2.3.3">1</cn></apply></apply><apply id="S2.E5.m1.5.5.4.2.2.3.cmml" xref="S2.E5.m1.5.5.4.2.2.3"><minus id="S2.E5.m1.5.5.4.2.2.3.1.cmml" xref="S2.E5.m1.5.5.4.2.2.3.1"></minus><ci id="S2.E5.m1.5.5.4.2.2.3.2.cmml" xref="S2.E5.m1.5.5.4.2.2.3.2">𝑖</ci><cn id="S2.E5.m1.5.5.4.2.2.3.3.cmml" type="integer" xref="S2.E5.m1.5.5.4.2.2.3.3">1</cn></apply></apply><apply id="S2.E5.m1.5.5.4.2.1.cmml" xref="S2.E5.m1.5.5.4.2.1"><times id="S2.E5.m1.5.5.4.2.1.2.cmml" xref="S2.E5.m1.5.5.4.2.1.2"></times><ci id="S2.E5.m1.5.5.4.2.1.3.cmml" xref="S2.E5.m1.5.5.4.2.1.3">𝑝</ci><apply id="S2.E5.m1.5.5.4.2.1.1.1.1.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1"><csymbol cd="latexml" id="S2.E5.m1.5.5.4.2.1.1.1.1.2.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1.1.2">conditional</csymbol><apply id="S2.E5.m1.5.5.4.2.1.1.1.1.3.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E5.m1.5.5.4.2.1.1.1.1.3.1.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1.1.3">subscript</csymbol><ci id="S2.E5.m1.5.5.4.2.1.1.1.1.3.2.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1.1.3.2">𝑑</ci><ci id="S2.E5.m1.5.5.4.2.1.1.1.1.3.3.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1.1.3.3">𝑗</ci></apply><list id="S2.E5.m1.5.5.4.2.1.1.1.1.1.2.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1.1.1.1"><ci id="S2.E5.m1.4.4.3.1.cmml" xref="S2.E5.m1.4.4.3.1">𝑥</ci><apply id="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.1.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.2.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.2">𝑅</ci><ci id="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.3.cmml" xref="S2.E5.m1.5.5.4.2.1.1.1.1.1.1.1.3">italic-ϕ</ci></apply></list></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E5.m1.7c">p(\mathbf{d}|x;R_{\phi})=\prod_{i=1}^{|\mathbf{d}|}\frac{p(d_{i}|x;R_{\phi})}{%
1-\sum_{j=1}^{i-1}{p(d_{j}|x;R_{\phi})}}</annotation><annotation encoding="application/x-llamapun" id="S2.E5.m1.7d">italic_p ( bold_d | italic_x ; italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ) = ∏ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT | bold_d | end_POSTSUPERSCRIPT divide start_ARG italic_p ( italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_x ; italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ) end_ARG start_ARG 1 - ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_i - 1 end_POSTSUPERSCRIPT italic_p ( italic_d start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT | italic_x ; italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.p5.9">where document-level probabilities <math alttext="p(d_{i}|x;R_{\phi})" class="ltx_Math" display="inline" id="S2.p5.9.m1.2"><semantics id="S2.p5.9.m1.2a"><mrow id="S2.p5.9.m1.2.2" xref="S2.p5.9.m1.2.2.cmml"><mi id="S2.p5.9.m1.2.2.3" xref="S2.p5.9.m1.2.2.3.cmml">p</mi><mo id="S2.p5.9.m1.2.2.2" xref="S2.p5.9.m1.2.2.2.cmml">⁢</mo><mrow id="S2.p5.9.m1.2.2.1.1" xref="S2.p5.9.m1.2.2.1.1.1.cmml"><mo id="S2.p5.9.m1.2.2.1.1.2" stretchy="false" xref="S2.p5.9.m1.2.2.1.1.1.cmml">(</mo><mrow id="S2.p5.9.m1.2.2.1.1.1" xref="S2.p5.9.m1.2.2.1.1.1.cmml"><msub id="S2.p5.9.m1.2.2.1.1.1.3" xref="S2.p5.9.m1.2.2.1.1.1.3.cmml"><mi id="S2.p5.9.m1.2.2.1.1.1.3.2" xref="S2.p5.9.m1.2.2.1.1.1.3.2.cmml">d</mi><mi id="S2.p5.9.m1.2.2.1.1.1.3.3" xref="S2.p5.9.m1.2.2.1.1.1.3.3.cmml">i</mi></msub><mo fence="false" id="S2.p5.9.m1.2.2.1.1.1.2" xref="S2.p5.9.m1.2.2.1.1.1.2.cmml">|</mo><mrow id="S2.p5.9.m1.2.2.1.1.1.1.1" xref="S2.p5.9.m1.2.2.1.1.1.1.2.cmml"><mi id="S2.p5.9.m1.1.1" xref="S2.p5.9.m1.1.1.cmml">x</mi><mo id="S2.p5.9.m1.2.2.1.1.1.1.1.2" xref="S2.p5.9.m1.2.2.1.1.1.1.2.cmml">;</mo><msub id="S2.p5.9.m1.2.2.1.1.1.1.1.1" xref="S2.p5.9.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S2.p5.9.m1.2.2.1.1.1.1.1.1.2" xref="S2.p5.9.m1.2.2.1.1.1.1.1.1.2.cmml">R</mi><mi id="S2.p5.9.m1.2.2.1.1.1.1.1.1.3" xref="S2.p5.9.m1.2.2.1.1.1.1.1.1.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.p5.9.m1.2.2.1.1.3" stretchy="false" xref="S2.p5.9.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p5.9.m1.2b"><apply id="S2.p5.9.m1.2.2.cmml" xref="S2.p5.9.m1.2.2"><times id="S2.p5.9.m1.2.2.2.cmml" xref="S2.p5.9.m1.2.2.2"></times><ci id="S2.p5.9.m1.2.2.3.cmml" xref="S2.p5.9.m1.2.2.3">𝑝</ci><apply id="S2.p5.9.m1.2.2.1.1.1.cmml" xref="S2.p5.9.m1.2.2.1.1"><csymbol cd="latexml" id="S2.p5.9.m1.2.2.1.1.1.2.cmml" xref="S2.p5.9.m1.2.2.1.1.1.2">conditional</csymbol><apply id="S2.p5.9.m1.2.2.1.1.1.3.cmml" xref="S2.p5.9.m1.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S2.p5.9.m1.2.2.1.1.1.3.1.cmml" xref="S2.p5.9.m1.2.2.1.1.1.3">subscript</csymbol><ci id="S2.p5.9.m1.2.2.1.1.1.3.2.cmml" xref="S2.p5.9.m1.2.2.1.1.1.3.2">𝑑</ci><ci id="S2.p5.9.m1.2.2.1.1.1.3.3.cmml" xref="S2.p5.9.m1.2.2.1.1.1.3.3">𝑖</ci></apply><list id="S2.p5.9.m1.2.2.1.1.1.1.2.cmml" xref="S2.p5.9.m1.2.2.1.1.1.1.1"><ci id="S2.p5.9.m1.1.1.cmml" xref="S2.p5.9.m1.1.1">𝑥</ci><apply id="S2.p5.9.m1.2.2.1.1.1.1.1.1.cmml" xref="S2.p5.9.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.p5.9.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S2.p5.9.m1.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S2.p5.9.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S2.p5.9.m1.2.2.1.1.1.1.1.1.2">𝑅</ci><ci id="S2.p5.9.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S2.p5.9.m1.2.2.1.1.1.1.1.1.3">italic-ϕ</ci></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.9.m1.2c">p(d_{i}|x;R_{\phi})</annotation><annotation encoding="application/x-llamapun" id="S2.p5.9.m1.2d">italic_p ( italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_x ; italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT )</annotation></semantics></math> can be computed using the softmax operation:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(6)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p(d_{i}|x;R_{\phi})=\frac{\exp{(s^{\phi}_{xd_{i}})}}{\sum_{d\in C}{\exp{(s^{%
\phi}_{xd})}}}" class="ltx_Math" display="block" id="S2.E6.m1.6"><semantics id="S2.E6.m1.6a"><mrow id="S2.E6.m1.6.6" xref="S2.E6.m1.6.6.cmml"><mrow id="S2.E6.m1.6.6.1" xref="S2.E6.m1.6.6.1.cmml"><mi id="S2.E6.m1.6.6.1.3" xref="S2.E6.m1.6.6.1.3.cmml">p</mi><mo id="S2.E6.m1.6.6.1.2" xref="S2.E6.m1.6.6.1.2.cmml">⁢</mo><mrow id="S2.E6.m1.6.6.1.1.1" xref="S2.E6.m1.6.6.1.1.1.1.cmml"><mo id="S2.E6.m1.6.6.1.1.1.2" stretchy="false" xref="S2.E6.m1.6.6.1.1.1.1.cmml">(</mo><mrow id="S2.E6.m1.6.6.1.1.1.1" xref="S2.E6.m1.6.6.1.1.1.1.cmml"><msub id="S2.E6.m1.6.6.1.1.1.1.3" xref="S2.E6.m1.6.6.1.1.1.1.3.cmml"><mi id="S2.E6.m1.6.6.1.1.1.1.3.2" xref="S2.E6.m1.6.6.1.1.1.1.3.2.cmml">d</mi><mi id="S2.E6.m1.6.6.1.1.1.1.3.3" xref="S2.E6.m1.6.6.1.1.1.1.3.3.cmml">i</mi></msub><mo fence="false" id="S2.E6.m1.6.6.1.1.1.1.2" xref="S2.E6.m1.6.6.1.1.1.1.2.cmml">|</mo><mrow id="S2.E6.m1.6.6.1.1.1.1.1.1" xref="S2.E6.m1.6.6.1.1.1.1.1.2.cmml"><mi id="S2.E6.m1.5.5" xref="S2.E6.m1.5.5.cmml">x</mi><mo id="S2.E6.m1.6.6.1.1.1.1.1.1.2" xref="S2.E6.m1.6.6.1.1.1.1.1.2.cmml">;</mo><msub id="S2.E6.m1.6.6.1.1.1.1.1.1.1" xref="S2.E6.m1.6.6.1.1.1.1.1.1.1.cmml"><mi id="S2.E6.m1.6.6.1.1.1.1.1.1.1.2" xref="S2.E6.m1.6.6.1.1.1.1.1.1.1.2.cmml">R</mi><mi id="S2.E6.m1.6.6.1.1.1.1.1.1.1.3" xref="S2.E6.m1.6.6.1.1.1.1.1.1.1.3.cmml">ϕ</mi></msub></mrow></mrow><mo id="S2.E6.m1.6.6.1.1.1.3" stretchy="false" xref="S2.E6.m1.6.6.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.E6.m1.6.6.2" xref="S2.E6.m1.6.6.2.cmml">=</mo><mfrac id="S2.E6.m1.4.4" xref="S2.E6.m1.4.4.cmml"><mrow id="S2.E6.m1.2.2.2.2" xref="S2.E6.m1.2.2.2.3.cmml"><mi id="S2.E6.m1.1.1.1.1" xref="S2.E6.m1.1.1.1.1.cmml">exp</mi><mo id="S2.E6.m1.2.2.2.2a" xref="S2.E6.m1.2.2.2.3.cmml">⁡</mo><mrow id="S2.E6.m1.2.2.2.2.1" xref="S2.E6.m1.2.2.2.3.cmml"><mo id="S2.E6.m1.2.2.2.2.1.2" stretchy="false" xref="S2.E6.m1.2.2.2.3.cmml">(</mo><msubsup id="S2.E6.m1.2.2.2.2.1.1" xref="S2.E6.m1.2.2.2.2.1.1.cmml"><mi id="S2.E6.m1.2.2.2.2.1.1.2.2" xref="S2.E6.m1.2.2.2.2.1.1.2.2.cmml">s</mi><mrow id="S2.E6.m1.2.2.2.2.1.1.3" xref="S2.E6.m1.2.2.2.2.1.1.3.cmml"><mi id="S2.E6.m1.2.2.2.2.1.1.3.2" xref="S2.E6.m1.2.2.2.2.1.1.3.2.cmml">x</mi><mo id="S2.E6.m1.2.2.2.2.1.1.3.1" xref="S2.E6.m1.2.2.2.2.1.1.3.1.cmml">⁢</mo><msub id="S2.E6.m1.2.2.2.2.1.1.3.3" xref="S2.E6.m1.2.2.2.2.1.1.3.3.cmml"><mi id="S2.E6.m1.2.2.2.2.1.1.3.3.2" xref="S2.E6.m1.2.2.2.2.1.1.3.3.2.cmml">d</mi><mi id="S2.E6.m1.2.2.2.2.1.1.3.3.3" xref="S2.E6.m1.2.2.2.2.1.1.3.3.3.cmml">i</mi></msub></mrow><mi id="S2.E6.m1.2.2.2.2.1.1.2.3" xref="S2.E6.m1.2.2.2.2.1.1.2.3.cmml">ϕ</mi></msubsup><mo id="S2.E6.m1.2.2.2.2.1.3" stretchy="false" xref="S2.E6.m1.2.2.2.3.cmml">)</mo></mrow></mrow><mrow id="S2.E6.m1.4.4.4" xref="S2.E6.m1.4.4.4.cmml"><msub id="S2.E6.m1.4.4.4.3" xref="S2.E6.m1.4.4.4.3.cmml"><mo id="S2.E6.m1.4.4.4.3.2" xref="S2.E6.m1.4.4.4.3.2.cmml">∑</mo><mrow id="S2.E6.m1.4.4.4.3.3" xref="S2.E6.m1.4.4.4.3.3.cmml"><mi id="S2.E6.m1.4.4.4.3.3.2" xref="S2.E6.m1.4.4.4.3.3.2.cmml">d</mi><mo id="S2.E6.m1.4.4.4.3.3.1" xref="S2.E6.m1.4.4.4.3.3.1.cmml">∈</mo><mi id="S2.E6.m1.4.4.4.3.3.3" xref="S2.E6.m1.4.4.4.3.3.3.cmml">C</mi></mrow></msub><mrow id="S2.E6.m1.4.4.4.2.1" xref="S2.E6.m1.4.4.4.2.2.cmml"><mi id="S2.E6.m1.3.3.3.1" xref="S2.E6.m1.3.3.3.1.cmml">exp</mi><mo id="S2.E6.m1.4.4.4.2.1a" xref="S2.E6.m1.4.4.4.2.2.cmml">⁡</mo><mrow id="S2.E6.m1.4.4.4.2.1.1" xref="S2.E6.m1.4.4.4.2.2.cmml"><mo id="S2.E6.m1.4.4.4.2.1.1.2" stretchy="false" xref="S2.E6.m1.4.4.4.2.2.cmml">(</mo><msubsup id="S2.E6.m1.4.4.4.2.1.1.1" xref="S2.E6.m1.4.4.4.2.1.1.1.cmml"><mi id="S2.E6.m1.4.4.4.2.1.1.1.2.2" xref="S2.E6.m1.4.4.4.2.1.1.1.2.2.cmml">s</mi><mrow id="S2.E6.m1.4.4.4.2.1.1.1.3" xref="S2.E6.m1.4.4.4.2.1.1.1.3.cmml"><mi id="S2.E6.m1.4.4.4.2.1.1.1.3.2" xref="S2.E6.m1.4.4.4.2.1.1.1.3.2.cmml">x</mi><mo id="S2.E6.m1.4.4.4.2.1.1.1.3.1" xref="S2.E6.m1.4.4.4.2.1.1.1.3.1.cmml">⁢</mo><mi id="S2.E6.m1.4.4.4.2.1.1.1.3.3" xref="S2.E6.m1.4.4.4.2.1.1.1.3.3.cmml">d</mi></mrow><mi id="S2.E6.m1.4.4.4.2.1.1.1.2.3" xref="S2.E6.m1.4.4.4.2.1.1.1.2.3.cmml">ϕ</mi></msubsup><mo id="S2.E6.m1.4.4.4.2.1.1.3" stretchy="false" xref="S2.E6.m1.4.4.4.2.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S2.E6.m1.6b"><apply id="S2.E6.m1.6.6.cmml" xref="S2.E6.m1.6.6"><eq id="S2.E6.m1.6.6.2.cmml" xref="S2.E6.m1.6.6.2"></eq><apply id="S2.E6.m1.6.6.1.cmml" xref="S2.E6.m1.6.6.1"><times id="S2.E6.m1.6.6.1.2.cmml" xref="S2.E6.m1.6.6.1.2"></times><ci id="S2.E6.m1.6.6.1.3.cmml" xref="S2.E6.m1.6.6.1.3">𝑝</ci><apply id="S2.E6.m1.6.6.1.1.1.1.cmml" xref="S2.E6.m1.6.6.1.1.1"><csymbol cd="latexml" id="S2.E6.m1.6.6.1.1.1.1.2.cmml" xref="S2.E6.m1.6.6.1.1.1.1.2">conditional</csymbol><apply id="S2.E6.m1.6.6.1.1.1.1.3.cmml" xref="S2.E6.m1.6.6.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E6.m1.6.6.1.1.1.1.3.1.cmml" xref="S2.E6.m1.6.6.1.1.1.1.3">subscript</csymbol><ci id="S2.E6.m1.6.6.1.1.1.1.3.2.cmml" xref="S2.E6.m1.6.6.1.1.1.1.3.2">𝑑</ci><ci id="S2.E6.m1.6.6.1.1.1.1.3.3.cmml" xref="S2.E6.m1.6.6.1.1.1.1.3.3">𝑖</ci></apply><list id="S2.E6.m1.6.6.1.1.1.1.1.2.cmml" xref="S2.E6.m1.6.6.1.1.1.1.1.1"><ci id="S2.E6.m1.5.5.cmml" xref="S2.E6.m1.5.5">𝑥</ci><apply id="S2.E6.m1.6.6.1.1.1.1.1.1.1.cmml" xref="S2.E6.m1.6.6.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E6.m1.6.6.1.1.1.1.1.1.1.1.cmml" xref="S2.E6.m1.6.6.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E6.m1.6.6.1.1.1.1.1.1.1.2.cmml" xref="S2.E6.m1.6.6.1.1.1.1.1.1.1.2">𝑅</ci><ci id="S2.E6.m1.6.6.1.1.1.1.1.1.1.3.cmml" xref="S2.E6.m1.6.6.1.1.1.1.1.1.1.3">italic-ϕ</ci></apply></list></apply></apply><apply id="S2.E6.m1.4.4.cmml" xref="S2.E6.m1.4.4"><divide id="S2.E6.m1.4.4.5.cmml" xref="S2.E6.m1.4.4"></divide><apply id="S2.E6.m1.2.2.2.3.cmml" xref="S2.E6.m1.2.2.2.2"><exp id="S2.E6.m1.1.1.1.1.cmml" xref="S2.E6.m1.1.1.1.1"></exp><apply id="S2.E6.m1.2.2.2.2.1.1.cmml" xref="S2.E6.m1.2.2.2.2.1.1"><csymbol cd="ambiguous" id="S2.E6.m1.2.2.2.2.1.1.1.cmml" xref="S2.E6.m1.2.2.2.2.1.1">subscript</csymbol><apply id="S2.E6.m1.2.2.2.2.1.1.2.cmml" xref="S2.E6.m1.2.2.2.2.1.1"><csymbol cd="ambiguous" id="S2.E6.m1.2.2.2.2.1.1.2.1.cmml" xref="S2.E6.m1.2.2.2.2.1.1">superscript</csymbol><ci id="S2.E6.m1.2.2.2.2.1.1.2.2.cmml" xref="S2.E6.m1.2.2.2.2.1.1.2.2">𝑠</ci><ci id="S2.E6.m1.2.2.2.2.1.1.2.3.cmml" xref="S2.E6.m1.2.2.2.2.1.1.2.3">italic-ϕ</ci></apply><apply id="S2.E6.m1.2.2.2.2.1.1.3.cmml" xref="S2.E6.m1.2.2.2.2.1.1.3"><times id="S2.E6.m1.2.2.2.2.1.1.3.1.cmml" xref="S2.E6.m1.2.2.2.2.1.1.3.1"></times><ci id="S2.E6.m1.2.2.2.2.1.1.3.2.cmml" xref="S2.E6.m1.2.2.2.2.1.1.3.2">𝑥</ci><apply id="S2.E6.m1.2.2.2.2.1.1.3.3.cmml" xref="S2.E6.m1.2.2.2.2.1.1.3.3"><csymbol cd="ambiguous" id="S2.E6.m1.2.2.2.2.1.1.3.3.1.cmml" xref="S2.E6.m1.2.2.2.2.1.1.3.3">subscript</csymbol><ci id="S2.E6.m1.2.2.2.2.1.1.3.3.2.cmml" xref="S2.E6.m1.2.2.2.2.1.1.3.3.2">𝑑</ci><ci id="S2.E6.m1.2.2.2.2.1.1.3.3.3.cmml" xref="S2.E6.m1.2.2.2.2.1.1.3.3.3">𝑖</ci></apply></apply></apply></apply><apply id="S2.E6.m1.4.4.4.cmml" xref="S2.E6.m1.4.4.4"><apply id="S2.E6.m1.4.4.4.3.cmml" xref="S2.E6.m1.4.4.4.3"><csymbol cd="ambiguous" id="S2.E6.m1.4.4.4.3.1.cmml" xref="S2.E6.m1.4.4.4.3">subscript</csymbol><sum id="S2.E6.m1.4.4.4.3.2.cmml" xref="S2.E6.m1.4.4.4.3.2"></sum><apply id="S2.E6.m1.4.4.4.3.3.cmml" xref="S2.E6.m1.4.4.4.3.3"><in id="S2.E6.m1.4.4.4.3.3.1.cmml" xref="S2.E6.m1.4.4.4.3.3.1"></in><ci id="S2.E6.m1.4.4.4.3.3.2.cmml" xref="S2.E6.m1.4.4.4.3.3.2">𝑑</ci><ci id="S2.E6.m1.4.4.4.3.3.3.cmml" xref="S2.E6.m1.4.4.4.3.3.3">𝐶</ci></apply></apply><apply id="S2.E6.m1.4.4.4.2.2.cmml" xref="S2.E6.m1.4.4.4.2.1"><exp id="S2.E6.m1.3.3.3.1.cmml" xref="S2.E6.m1.3.3.3.1"></exp><apply id="S2.E6.m1.4.4.4.2.1.1.1.cmml" xref="S2.E6.m1.4.4.4.2.1.1.1"><csymbol cd="ambiguous" id="S2.E6.m1.4.4.4.2.1.1.1.1.cmml" xref="S2.E6.m1.4.4.4.2.1.1.1">subscript</csymbol><apply id="S2.E6.m1.4.4.4.2.1.1.1.2.cmml" xref="S2.E6.m1.4.4.4.2.1.1.1"><csymbol cd="ambiguous" id="S2.E6.m1.4.4.4.2.1.1.1.2.1.cmml" xref="S2.E6.m1.4.4.4.2.1.1.1">superscript</csymbol><ci id="S2.E6.m1.4.4.4.2.1.1.1.2.2.cmml" xref="S2.E6.m1.4.4.4.2.1.1.1.2.2">𝑠</ci><ci id="S2.E6.m1.4.4.4.2.1.1.1.2.3.cmml" xref="S2.E6.m1.4.4.4.2.1.1.1.2.3">italic-ϕ</ci></apply><apply id="S2.E6.m1.4.4.4.2.1.1.1.3.cmml" xref="S2.E6.m1.4.4.4.2.1.1.1.3"><times id="S2.E6.m1.4.4.4.2.1.1.1.3.1.cmml" xref="S2.E6.m1.4.4.4.2.1.1.1.3.1"></times><ci id="S2.E6.m1.4.4.4.2.1.1.1.3.2.cmml" xref="S2.E6.m1.4.4.4.2.1.1.1.3.2">𝑥</ci><ci id="S2.E6.m1.4.4.4.2.1.1.1.3.3.cmml" xref="S2.E6.m1.4.4.4.2.1.1.1.3.3">𝑑</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E6.m1.6c">p(d_{i}|x;R_{\phi})=\frac{\exp{(s^{\phi}_{xd_{i}})}}{\sum_{d\in C}{\exp{(s^{%
\phi}_{xd})}}}</annotation><annotation encoding="application/x-llamapun" id="S2.E6.m1.6d">italic_p ( italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_x ; italic_R start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ) = divide start_ARG roman_exp ( italic_s start_POSTSUPERSCRIPT italic_ϕ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_x italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT ) end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_d ∈ italic_C end_POSTSUBSCRIPT roman_exp ( italic_s start_POSTSUPERSCRIPT italic_ϕ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_x italic_d end_POSTSUBSCRIPT ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S2.p6">
<p class="ltx_p" id="S2.p6.4">This iterative process of document sampling is non-differentiable, and thus cannot be simply used in gradient descent-based optimization approaches. To address both of these problems, <cite class="ltx_cite ltx_citemacro_citet">Kool et al<span class="ltx_text">.</span> (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib18" title="">2019</a>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib19" title="">2020</a>)</cite> recently introduced Ancestral Gumbel-Top-<math alttext="k" class="ltx_Math" display="inline" id="S2.p6.1.m1.1"><semantics id="S2.p6.1.m1.1a"><mi id="S2.p6.1.m1.1.1" xref="S2.p6.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.p6.1.m1.1b"><ci id="S2.p6.1.m1.1.1.cmml" xref="S2.p6.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p6.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.p6.1.m1.1d">italic_k</annotation></semantics></math> sampling. This approach creates a tree over all items in the sampling set and extends the Gumbel-Softmax sampling approach <cite class="ltx_cite ltx_citemacro_citep">(Maddison et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib25" title="">2017</a>)</cite> to sampling without replacement. According to <cite class="ltx_cite ltx_citemacro_citep">(Kool et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib18" title="">2019</a>)</cite>, independently perturbing each individual document score with Gumbel noise and picking the top <math alttext="k" class="ltx_Math" display="inline" id="S2.p6.2.m2.1"><semantics id="S2.p6.2.m2.1a"><mi id="S2.p6.2.m2.1.1" xref="S2.p6.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.p6.2.m2.1b"><ci id="S2.p6.2.m2.1.1.cmml" xref="S2.p6.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p6.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.p6.2.m2.1d">italic_k</annotation></semantics></math> documents with the largest perturbed values will generate a valid sample from the Plackett-Luce distribution. Gumbel perturbation itself can be done efficiently by simply drawing a sample <math alttext="U\sim\text{Uniform}(0,1)" class="ltx_Math" display="inline" id="S2.p6.3.m3.2"><semantics id="S2.p6.3.m3.2a"><mrow id="S2.p6.3.m3.2.3" xref="S2.p6.3.m3.2.3.cmml"><mi id="S2.p6.3.m3.2.3.2" xref="S2.p6.3.m3.2.3.2.cmml">U</mi><mo id="S2.p6.3.m3.2.3.1" xref="S2.p6.3.m3.2.3.1.cmml">∼</mo><mrow id="S2.p6.3.m3.2.3.3" xref="S2.p6.3.m3.2.3.3.cmml"><mtext id="S2.p6.3.m3.2.3.3.2" xref="S2.p6.3.m3.2.3.3.2a.cmml">Uniform</mtext><mo id="S2.p6.3.m3.2.3.3.1" xref="S2.p6.3.m3.2.3.3.1.cmml">⁢</mo><mrow id="S2.p6.3.m3.2.3.3.3.2" xref="S2.p6.3.m3.2.3.3.3.1.cmml"><mo id="S2.p6.3.m3.2.3.3.3.2.1" stretchy="false" xref="S2.p6.3.m3.2.3.3.3.1.cmml">(</mo><mn id="S2.p6.3.m3.1.1" xref="S2.p6.3.m3.1.1.cmml">0</mn><mo id="S2.p6.3.m3.2.3.3.3.2.2" xref="S2.p6.3.m3.2.3.3.3.1.cmml">,</mo><mn id="S2.p6.3.m3.2.2" xref="S2.p6.3.m3.2.2.cmml">1</mn><mo id="S2.p6.3.m3.2.3.3.3.2.3" stretchy="false" xref="S2.p6.3.m3.2.3.3.3.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p6.3.m3.2b"><apply id="S2.p6.3.m3.2.3.cmml" xref="S2.p6.3.m3.2.3"><csymbol cd="latexml" id="S2.p6.3.m3.2.3.1.cmml" xref="S2.p6.3.m3.2.3.1">similar-to</csymbol><ci id="S2.p6.3.m3.2.3.2.cmml" xref="S2.p6.3.m3.2.3.2">𝑈</ci><apply id="S2.p6.3.m3.2.3.3.cmml" xref="S2.p6.3.m3.2.3.3"><times id="S2.p6.3.m3.2.3.3.1.cmml" xref="S2.p6.3.m3.2.3.3.1"></times><ci id="S2.p6.3.m3.2.3.3.2a.cmml" xref="S2.p6.3.m3.2.3.3.2"><mtext id="S2.p6.3.m3.2.3.3.2.cmml" xref="S2.p6.3.m3.2.3.3.2">Uniform</mtext></ci><interval closure="open" id="S2.p6.3.m3.2.3.3.3.1.cmml" xref="S2.p6.3.m3.2.3.3.3.2"><cn id="S2.p6.3.m3.1.1.cmml" type="integer" xref="S2.p6.3.m3.1.1">0</cn><cn id="S2.p6.3.m3.2.2.cmml" type="integer" xref="S2.p6.3.m3.2.2">1</cn></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p6.3.m3.2c">U\sim\text{Uniform}(0,1)</annotation><annotation encoding="application/x-llamapun" id="S2.p6.3.m3.2d">italic_U ∼ Uniform ( 0 , 1 )</annotation></semantics></math>, as <math alttext="\text{Gumbel}(0,\beta)\sim-\beta\log(-\log(U))" class="ltx_Math" display="inline" id="S2.p6.4.m4.6"><semantics id="S2.p6.4.m4.6a"><mrow id="S2.p6.4.m4.6.6" xref="S2.p6.4.m4.6.6.cmml"><mrow id="S2.p6.4.m4.6.6.3" xref="S2.p6.4.m4.6.6.3.cmml"><mtext id="S2.p6.4.m4.6.6.3.2" xref="S2.p6.4.m4.6.6.3.2a.cmml">Gumbel</mtext><mo id="S2.p6.4.m4.6.6.3.1" xref="S2.p6.4.m4.6.6.3.1.cmml">⁢</mo><mrow id="S2.p6.4.m4.6.6.3.3.2" xref="S2.p6.4.m4.6.6.3.3.1.cmml"><mo id="S2.p6.4.m4.6.6.3.3.2.1" stretchy="false" xref="S2.p6.4.m4.6.6.3.3.1.cmml">(</mo><mn id="S2.p6.4.m4.1.1" xref="S2.p6.4.m4.1.1.cmml">0</mn><mo id="S2.p6.4.m4.6.6.3.3.2.2" xref="S2.p6.4.m4.6.6.3.3.1.cmml">,</mo><mi id="S2.p6.4.m4.2.2" xref="S2.p6.4.m4.2.2.cmml">β</mi><mo id="S2.p6.4.m4.6.6.3.3.2.3" stretchy="false" xref="S2.p6.4.m4.6.6.3.3.1.cmml">)</mo></mrow></mrow><mo id="S2.p6.4.m4.6.6.2" xref="S2.p6.4.m4.6.6.2.cmml">∼</mo><mrow id="S2.p6.4.m4.6.6.1" xref="S2.p6.4.m4.6.6.1.cmml"><mo id="S2.p6.4.m4.6.6.1a" xref="S2.p6.4.m4.6.6.1.cmml">−</mo><mrow id="S2.p6.4.m4.6.6.1.1" xref="S2.p6.4.m4.6.6.1.1.cmml"><mi id="S2.p6.4.m4.6.6.1.1.3" xref="S2.p6.4.m4.6.6.1.1.3.cmml">β</mi><mo id="S2.p6.4.m4.6.6.1.1.2" lspace="0.167em" xref="S2.p6.4.m4.6.6.1.1.2.cmml">⁢</mo><mrow id="S2.p6.4.m4.6.6.1.1.1.1" xref="S2.p6.4.m4.6.6.1.1.1.2.cmml"><mi id="S2.p6.4.m4.5.5" xref="S2.p6.4.m4.5.5.cmml">log</mi><mo id="S2.p6.4.m4.6.6.1.1.1.1a" xref="S2.p6.4.m4.6.6.1.1.1.2.cmml">⁡</mo><mrow id="S2.p6.4.m4.6.6.1.1.1.1.1" xref="S2.p6.4.m4.6.6.1.1.1.2.cmml"><mo id="S2.p6.4.m4.6.6.1.1.1.1.1.2" stretchy="false" xref="S2.p6.4.m4.6.6.1.1.1.2.cmml">(</mo><mrow id="S2.p6.4.m4.6.6.1.1.1.1.1.1" xref="S2.p6.4.m4.6.6.1.1.1.1.1.1.cmml"><mo id="S2.p6.4.m4.6.6.1.1.1.1.1.1a" rspace="0.167em" xref="S2.p6.4.m4.6.6.1.1.1.1.1.1.cmml">−</mo><mrow id="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.2" xref="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.1.cmml"><mi id="S2.p6.4.m4.3.3" xref="S2.p6.4.m4.3.3.cmml">log</mi><mo id="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.2a" xref="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.1.cmml">⁡</mo><mrow id="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.2.1" xref="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.1.cmml"><mo id="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.2.1.1" stretchy="false" xref="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.1.cmml">(</mo><mi id="S2.p6.4.m4.4.4" xref="S2.p6.4.m4.4.4.cmml">U</mi><mo id="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.2.1.2" stretchy="false" xref="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.1.cmml">)</mo></mrow></mrow></mrow><mo id="S2.p6.4.m4.6.6.1.1.1.1.1.3" stretchy="false" xref="S2.p6.4.m4.6.6.1.1.1.2.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p6.4.m4.6b"><apply id="S2.p6.4.m4.6.6.cmml" xref="S2.p6.4.m4.6.6"><csymbol cd="latexml" id="S2.p6.4.m4.6.6.2.cmml" xref="S2.p6.4.m4.6.6.2">similar-to</csymbol><apply id="S2.p6.4.m4.6.6.3.cmml" xref="S2.p6.4.m4.6.6.3"><times id="S2.p6.4.m4.6.6.3.1.cmml" xref="S2.p6.4.m4.6.6.3.1"></times><ci id="S2.p6.4.m4.6.6.3.2a.cmml" xref="S2.p6.4.m4.6.6.3.2"><mtext id="S2.p6.4.m4.6.6.3.2.cmml" xref="S2.p6.4.m4.6.6.3.2">Gumbel</mtext></ci><interval closure="open" id="S2.p6.4.m4.6.6.3.3.1.cmml" xref="S2.p6.4.m4.6.6.3.3.2"><cn id="S2.p6.4.m4.1.1.cmml" type="integer" xref="S2.p6.4.m4.1.1">0</cn><ci id="S2.p6.4.m4.2.2.cmml" xref="S2.p6.4.m4.2.2">𝛽</ci></interval></apply><apply id="S2.p6.4.m4.6.6.1.cmml" xref="S2.p6.4.m4.6.6.1"><minus id="S2.p6.4.m4.6.6.1.2.cmml" xref="S2.p6.4.m4.6.6.1"></minus><apply id="S2.p6.4.m4.6.6.1.1.cmml" xref="S2.p6.4.m4.6.6.1.1"><times id="S2.p6.4.m4.6.6.1.1.2.cmml" xref="S2.p6.4.m4.6.6.1.1.2"></times><ci id="S2.p6.4.m4.6.6.1.1.3.cmml" xref="S2.p6.4.m4.6.6.1.1.3">𝛽</ci><apply id="S2.p6.4.m4.6.6.1.1.1.2.cmml" xref="S2.p6.4.m4.6.6.1.1.1.1"><log id="S2.p6.4.m4.5.5.cmml" xref="S2.p6.4.m4.5.5"></log><apply id="S2.p6.4.m4.6.6.1.1.1.1.1.1.cmml" xref="S2.p6.4.m4.6.6.1.1.1.1.1.1"><minus id="S2.p6.4.m4.6.6.1.1.1.1.1.1.1.cmml" xref="S2.p6.4.m4.6.6.1.1.1.1.1.1"></minus><apply id="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.1.cmml" xref="S2.p6.4.m4.6.6.1.1.1.1.1.1.2.2"><log id="S2.p6.4.m4.3.3.cmml" xref="S2.p6.4.m4.3.3"></log><ci id="S2.p6.4.m4.4.4.cmml" xref="S2.p6.4.m4.4.4">𝑈</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p6.4.m4.6c">\text{Gumbel}(0,\beta)\sim-\beta\log(-\log(U))</annotation><annotation encoding="application/x-llamapun" id="S2.p6.4.m4.6d">Gumbel ( 0 , italic_β ) ∼ - italic_β roman_log ( - roman_log ( italic_U ) )</annotation></semantics></math> <cite class="ltx_cite ltx_citemacro_citep">(Maddison et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib25" title="">2017</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S2.p7">
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="Sx1.EGx4">
<tbody id="S2.E7"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(7)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\tilde{p}(d_{i}|\phi,\theta)=\frac{\exp(s^{\phi}_{xd_{i}}+G_{d_{i%
}})}{\sum_{d\in C}\exp(s^{\phi}_{xd}+G_{d})}" class="ltx_Math" display="inline" id="S2.E7.m1.7"><semantics id="S2.E7.m1.7a"><mrow id="S2.E7.m1.7.7" xref="S2.E7.m1.7.7.cmml"><mrow id="S2.E7.m1.7.7.1" xref="S2.E7.m1.7.7.1.cmml"><mover accent="true" id="S2.E7.m1.7.7.1.3" xref="S2.E7.m1.7.7.1.3.cmml"><mi id="S2.E7.m1.7.7.1.3.2" xref="S2.E7.m1.7.7.1.3.2.cmml">p</mi><mo id="S2.E7.m1.7.7.1.3.1" xref="S2.E7.m1.7.7.1.3.1.cmml">~</mo></mover><mo id="S2.E7.m1.7.7.1.2" xref="S2.E7.m1.7.7.1.2.cmml">⁢</mo><mrow id="S2.E7.m1.7.7.1.1.1" xref="S2.E7.m1.7.7.1.1.1.1.cmml"><mo id="S2.E7.m1.7.7.1.1.1.2" stretchy="false" xref="S2.E7.m1.7.7.1.1.1.1.cmml">(</mo><mrow id="S2.E7.m1.7.7.1.1.1.1" xref="S2.E7.m1.7.7.1.1.1.1.cmml"><msub id="S2.E7.m1.7.7.1.1.1.1.2" xref="S2.E7.m1.7.7.1.1.1.1.2.cmml"><mi id="S2.E7.m1.7.7.1.1.1.1.2.2" xref="S2.E7.m1.7.7.1.1.1.1.2.2.cmml">d</mi><mi id="S2.E7.m1.7.7.1.1.1.1.2.3" xref="S2.E7.m1.7.7.1.1.1.1.2.3.cmml">i</mi></msub><mo fence="false" id="S2.E7.m1.7.7.1.1.1.1.1" xref="S2.E7.m1.7.7.1.1.1.1.1.cmml">|</mo><mrow id="S2.E7.m1.7.7.1.1.1.1.3.2" xref="S2.E7.m1.7.7.1.1.1.1.3.1.cmml"><mi id="S2.E7.m1.5.5" xref="S2.E7.m1.5.5.cmml">ϕ</mi><mo id="S2.E7.m1.7.7.1.1.1.1.3.2.1" xref="S2.E7.m1.7.7.1.1.1.1.3.1.cmml">,</mo><mi id="S2.E7.m1.6.6" xref="S2.E7.m1.6.6.cmml">θ</mi></mrow></mrow><mo id="S2.E7.m1.7.7.1.1.1.3" stretchy="false" xref="S2.E7.m1.7.7.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.E7.m1.7.7.2" xref="S2.E7.m1.7.7.2.cmml">=</mo><mstyle displaystyle="true" id="S2.E7.m1.4.4" xref="S2.E7.m1.4.4.cmml"><mfrac id="S2.E7.m1.4.4a" xref="S2.E7.m1.4.4.cmml"><mrow id="S2.E7.m1.2.2.2.2" xref="S2.E7.m1.2.2.2.3.cmml"><mi id="S2.E7.m1.1.1.1.1" xref="S2.E7.m1.1.1.1.1.cmml">exp</mi><mo id="S2.E7.m1.2.2.2.2a" xref="S2.E7.m1.2.2.2.3.cmml">⁡</mo><mrow id="S2.E7.m1.2.2.2.2.1" xref="S2.E7.m1.2.2.2.3.cmml"><mo id="S2.E7.m1.2.2.2.2.1.2" stretchy="false" xref="S2.E7.m1.2.2.2.3.cmml">(</mo><mrow id="S2.E7.m1.2.2.2.2.1.1" xref="S2.E7.m1.2.2.2.2.1.1.cmml"><msubsup id="S2.E7.m1.2.2.2.2.1.1.2" xref="S2.E7.m1.2.2.2.2.1.1.2.cmml"><mi id="S2.E7.m1.2.2.2.2.1.1.2.2.2" xref="S2.E7.m1.2.2.2.2.1.1.2.2.2.cmml">s</mi><mrow id="S2.E7.m1.2.2.2.2.1.1.2.3" xref="S2.E7.m1.2.2.2.2.1.1.2.3.cmml"><mi id="S2.E7.m1.2.2.2.2.1.1.2.3.2" xref="S2.E7.m1.2.2.2.2.1.1.2.3.2.cmml">x</mi><mo id="S2.E7.m1.2.2.2.2.1.1.2.3.1" xref="S2.E7.m1.2.2.2.2.1.1.2.3.1.cmml">⁢</mo><msub id="S2.E7.m1.2.2.2.2.1.1.2.3.3" xref="S2.E7.m1.2.2.2.2.1.1.2.3.3.cmml"><mi id="S2.E7.m1.2.2.2.2.1.1.2.3.3.2" xref="S2.E7.m1.2.2.2.2.1.1.2.3.3.2.cmml">d</mi><mi id="S2.E7.m1.2.2.2.2.1.1.2.3.3.3" xref="S2.E7.m1.2.2.2.2.1.1.2.3.3.3.cmml">i</mi></msub></mrow><mi id="S2.E7.m1.2.2.2.2.1.1.2.2.3" xref="S2.E7.m1.2.2.2.2.1.1.2.2.3.cmml">ϕ</mi></msubsup><mo id="S2.E7.m1.2.2.2.2.1.1.1" xref="S2.E7.m1.2.2.2.2.1.1.1.cmml">+</mo><msub id="S2.E7.m1.2.2.2.2.1.1.3" xref="S2.E7.m1.2.2.2.2.1.1.3.cmml"><mi id="S2.E7.m1.2.2.2.2.1.1.3.2" xref="S2.E7.m1.2.2.2.2.1.1.3.2.cmml">G</mi><msub id="S2.E7.m1.2.2.2.2.1.1.3.3" xref="S2.E7.m1.2.2.2.2.1.1.3.3.cmml"><mi id="S2.E7.m1.2.2.2.2.1.1.3.3.2" xref="S2.E7.m1.2.2.2.2.1.1.3.3.2.cmml">d</mi><mi id="S2.E7.m1.2.2.2.2.1.1.3.3.3" xref="S2.E7.m1.2.2.2.2.1.1.3.3.3.cmml">i</mi></msub></msub></mrow><mo id="S2.E7.m1.2.2.2.2.1.3" stretchy="false" xref="S2.E7.m1.2.2.2.3.cmml">)</mo></mrow></mrow><mrow id="S2.E7.m1.4.4.4" xref="S2.E7.m1.4.4.4.cmml"><msub id="S2.E7.m1.4.4.4.3" xref="S2.E7.m1.4.4.4.3.cmml"><mo id="S2.E7.m1.4.4.4.3.2" xref="S2.E7.m1.4.4.4.3.2.cmml">∑</mo><mrow id="S2.E7.m1.4.4.4.3.3" xref="S2.E7.m1.4.4.4.3.3.cmml"><mi id="S2.E7.m1.4.4.4.3.3.2" xref="S2.E7.m1.4.4.4.3.3.2.cmml">d</mi><mo id="S2.E7.m1.4.4.4.3.3.1" xref="S2.E7.m1.4.4.4.3.3.1.cmml">∈</mo><mi id="S2.E7.m1.4.4.4.3.3.3" xref="S2.E7.m1.4.4.4.3.3.3.cmml">C</mi></mrow></msub><mrow id="S2.E7.m1.4.4.4.2.1" xref="S2.E7.m1.4.4.4.2.2.cmml"><mi id="S2.E7.m1.3.3.3.1" xref="S2.E7.m1.3.3.3.1.cmml">exp</mi><mo id="S2.E7.m1.4.4.4.2.1a" xref="S2.E7.m1.4.4.4.2.2.cmml">⁡</mo><mrow id="S2.E7.m1.4.4.4.2.1.1" xref="S2.E7.m1.4.4.4.2.2.cmml"><mo id="S2.E7.m1.4.4.4.2.1.1.2" stretchy="false" xref="S2.E7.m1.4.4.4.2.2.cmml">(</mo><mrow id="S2.E7.m1.4.4.4.2.1.1.1" xref="S2.E7.m1.4.4.4.2.1.1.1.cmml"><msubsup id="S2.E7.m1.4.4.4.2.1.1.1.2" xref="S2.E7.m1.4.4.4.2.1.1.1.2.cmml"><mi id="S2.E7.m1.4.4.4.2.1.1.1.2.2.2" xref="S2.E7.m1.4.4.4.2.1.1.1.2.2.2.cmml">s</mi><mrow id="S2.E7.m1.4.4.4.2.1.1.1.2.3" xref="S2.E7.m1.4.4.4.2.1.1.1.2.3.cmml"><mi id="S2.E7.m1.4.4.4.2.1.1.1.2.3.2" xref="S2.E7.m1.4.4.4.2.1.1.1.2.3.2.cmml">x</mi><mo id="S2.E7.m1.4.4.4.2.1.1.1.2.3.1" xref="S2.E7.m1.4.4.4.2.1.1.1.2.3.1.cmml">⁢</mo><mi id="S2.E7.m1.4.4.4.2.1.1.1.2.3.3" xref="S2.E7.m1.4.4.4.2.1.1.1.2.3.3.cmml">d</mi></mrow><mi id="S2.E7.m1.4.4.4.2.1.1.1.2.2.3" xref="S2.E7.m1.4.4.4.2.1.1.1.2.2.3.cmml">ϕ</mi></msubsup><mo id="S2.E7.m1.4.4.4.2.1.1.1.1" xref="S2.E7.m1.4.4.4.2.1.1.1.1.cmml">+</mo><msub id="S2.E7.m1.4.4.4.2.1.1.1.3" xref="S2.E7.m1.4.4.4.2.1.1.1.3.cmml"><mi id="S2.E7.m1.4.4.4.2.1.1.1.3.2" xref="S2.E7.m1.4.4.4.2.1.1.1.3.2.cmml">G</mi><mi id="S2.E7.m1.4.4.4.2.1.1.1.3.3" xref="S2.E7.m1.4.4.4.2.1.1.1.3.3.cmml">d</mi></msub></mrow><mo id="S2.E7.m1.4.4.4.2.1.1.3" stretchy="false" xref="S2.E7.m1.4.4.4.2.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mstyle></mrow><annotation-xml encoding="MathML-Content" id="S2.E7.m1.7b"><apply id="S2.E7.m1.7.7.cmml" xref="S2.E7.m1.7.7"><eq id="S2.E7.m1.7.7.2.cmml" xref="S2.E7.m1.7.7.2"></eq><apply id="S2.E7.m1.7.7.1.cmml" xref="S2.E7.m1.7.7.1"><times id="S2.E7.m1.7.7.1.2.cmml" xref="S2.E7.m1.7.7.1.2"></times><apply id="S2.E7.m1.7.7.1.3.cmml" xref="S2.E7.m1.7.7.1.3"><ci id="S2.E7.m1.7.7.1.3.1.cmml" xref="S2.E7.m1.7.7.1.3.1">~</ci><ci id="S2.E7.m1.7.7.1.3.2.cmml" xref="S2.E7.m1.7.7.1.3.2">𝑝</ci></apply><apply id="S2.E7.m1.7.7.1.1.1.1.cmml" xref="S2.E7.m1.7.7.1.1.1"><csymbol cd="latexml" id="S2.E7.m1.7.7.1.1.1.1.1.cmml" xref="S2.E7.m1.7.7.1.1.1.1.1">conditional</csymbol><apply id="S2.E7.m1.7.7.1.1.1.1.2.cmml" xref="S2.E7.m1.7.7.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E7.m1.7.7.1.1.1.1.2.1.cmml" xref="S2.E7.m1.7.7.1.1.1.1.2">subscript</csymbol><ci id="S2.E7.m1.7.7.1.1.1.1.2.2.cmml" xref="S2.E7.m1.7.7.1.1.1.1.2.2">𝑑</ci><ci id="S2.E7.m1.7.7.1.1.1.1.2.3.cmml" xref="S2.E7.m1.7.7.1.1.1.1.2.3">𝑖</ci></apply><list id="S2.E7.m1.7.7.1.1.1.1.3.1.cmml" xref="S2.E7.m1.7.7.1.1.1.1.3.2"><ci id="S2.E7.m1.5.5.cmml" xref="S2.E7.m1.5.5">italic-ϕ</ci><ci id="S2.E7.m1.6.6.cmml" xref="S2.E7.m1.6.6">𝜃</ci></list></apply></apply><apply id="S2.E7.m1.4.4.cmml" xref="S2.E7.m1.4.4"><divide id="S2.E7.m1.4.4.5.cmml" xref="S2.E7.m1.4.4"></divide><apply id="S2.E7.m1.2.2.2.3.cmml" xref="S2.E7.m1.2.2.2.2"><exp id="S2.E7.m1.1.1.1.1.cmml" xref="S2.E7.m1.1.1.1.1"></exp><apply id="S2.E7.m1.2.2.2.2.1.1.cmml" xref="S2.E7.m1.2.2.2.2.1.1"><plus id="S2.E7.m1.2.2.2.2.1.1.1.cmml" xref="S2.E7.m1.2.2.2.2.1.1.1"></plus><apply id="S2.E7.m1.2.2.2.2.1.1.2.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2"><csymbol cd="ambiguous" id="S2.E7.m1.2.2.2.2.1.1.2.1.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2">subscript</csymbol><apply id="S2.E7.m1.2.2.2.2.1.1.2.2.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2"><csymbol cd="ambiguous" id="S2.E7.m1.2.2.2.2.1.1.2.2.1.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2">superscript</csymbol><ci id="S2.E7.m1.2.2.2.2.1.1.2.2.2.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2.2.2">𝑠</ci><ci id="S2.E7.m1.2.2.2.2.1.1.2.2.3.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2.2.3">italic-ϕ</ci></apply><apply id="S2.E7.m1.2.2.2.2.1.1.2.3.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2.3"><times id="S2.E7.m1.2.2.2.2.1.1.2.3.1.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2.3.1"></times><ci id="S2.E7.m1.2.2.2.2.1.1.2.3.2.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2.3.2">𝑥</ci><apply id="S2.E7.m1.2.2.2.2.1.1.2.3.3.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2.3.3"><csymbol cd="ambiguous" id="S2.E7.m1.2.2.2.2.1.1.2.3.3.1.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2.3.3">subscript</csymbol><ci id="S2.E7.m1.2.2.2.2.1.1.2.3.3.2.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2.3.3.2">𝑑</ci><ci id="S2.E7.m1.2.2.2.2.1.1.2.3.3.3.cmml" xref="S2.E7.m1.2.2.2.2.1.1.2.3.3.3">𝑖</ci></apply></apply></apply><apply id="S2.E7.m1.2.2.2.2.1.1.3.cmml" xref="S2.E7.m1.2.2.2.2.1.1.3"><csymbol cd="ambiguous" id="S2.E7.m1.2.2.2.2.1.1.3.1.cmml" xref="S2.E7.m1.2.2.2.2.1.1.3">subscript</csymbol><ci id="S2.E7.m1.2.2.2.2.1.1.3.2.cmml" xref="S2.E7.m1.2.2.2.2.1.1.3.2">𝐺</ci><apply id="S2.E7.m1.2.2.2.2.1.1.3.3.cmml" xref="S2.E7.m1.2.2.2.2.1.1.3.3"><csymbol cd="ambiguous" id="S2.E7.m1.2.2.2.2.1.1.3.3.1.cmml" xref="S2.E7.m1.2.2.2.2.1.1.3.3">subscript</csymbol><ci id="S2.E7.m1.2.2.2.2.1.1.3.3.2.cmml" xref="S2.E7.m1.2.2.2.2.1.1.3.3.2">𝑑</ci><ci id="S2.E7.m1.2.2.2.2.1.1.3.3.3.cmml" xref="S2.E7.m1.2.2.2.2.1.1.3.3.3">𝑖</ci></apply></apply></apply></apply><apply id="S2.E7.m1.4.4.4.cmml" xref="S2.E7.m1.4.4.4"><apply id="S2.E7.m1.4.4.4.3.cmml" xref="S2.E7.m1.4.4.4.3"><csymbol cd="ambiguous" id="S2.E7.m1.4.4.4.3.1.cmml" xref="S2.E7.m1.4.4.4.3">subscript</csymbol><sum id="S2.E7.m1.4.4.4.3.2.cmml" xref="S2.E7.m1.4.4.4.3.2"></sum><apply id="S2.E7.m1.4.4.4.3.3.cmml" xref="S2.E7.m1.4.4.4.3.3"><in id="S2.E7.m1.4.4.4.3.3.1.cmml" xref="S2.E7.m1.4.4.4.3.3.1"></in><ci id="S2.E7.m1.4.4.4.3.3.2.cmml" xref="S2.E7.m1.4.4.4.3.3.2">𝑑</ci><ci id="S2.E7.m1.4.4.4.3.3.3.cmml" xref="S2.E7.m1.4.4.4.3.3.3">𝐶</ci></apply></apply><apply id="S2.E7.m1.4.4.4.2.2.cmml" xref="S2.E7.m1.4.4.4.2.1"><exp id="S2.E7.m1.3.3.3.1.cmml" xref="S2.E7.m1.3.3.3.1"></exp><apply id="S2.E7.m1.4.4.4.2.1.1.1.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1"><plus id="S2.E7.m1.4.4.4.2.1.1.1.1.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.1"></plus><apply id="S2.E7.m1.4.4.4.2.1.1.1.2.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.2"><csymbol cd="ambiguous" id="S2.E7.m1.4.4.4.2.1.1.1.2.1.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.2">subscript</csymbol><apply id="S2.E7.m1.4.4.4.2.1.1.1.2.2.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.2"><csymbol cd="ambiguous" id="S2.E7.m1.4.4.4.2.1.1.1.2.2.1.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.2">superscript</csymbol><ci id="S2.E7.m1.4.4.4.2.1.1.1.2.2.2.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.2.2.2">𝑠</ci><ci id="S2.E7.m1.4.4.4.2.1.1.1.2.2.3.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.2.2.3">italic-ϕ</ci></apply><apply id="S2.E7.m1.4.4.4.2.1.1.1.2.3.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.2.3"><times id="S2.E7.m1.4.4.4.2.1.1.1.2.3.1.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.2.3.1"></times><ci id="S2.E7.m1.4.4.4.2.1.1.1.2.3.2.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.2.3.2">𝑥</ci><ci id="S2.E7.m1.4.4.4.2.1.1.1.2.3.3.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.2.3.3">𝑑</ci></apply></apply><apply id="S2.E7.m1.4.4.4.2.1.1.1.3.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.3"><csymbol cd="ambiguous" id="S2.E7.m1.4.4.4.2.1.1.1.3.1.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.3">subscript</csymbol><ci id="S2.E7.m1.4.4.4.2.1.1.1.3.2.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.3.2">𝐺</ci><ci id="S2.E7.m1.4.4.4.2.1.1.1.3.3.cmml" xref="S2.E7.m1.4.4.4.2.1.1.1.3.3">𝑑</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E7.m1.7c">\displaystyle\tilde{p}(d_{i}|\phi,\theta)=\frac{\exp(s^{\phi}_{xd_{i}}+G_{d_{i%
}})}{\sum_{d\in C}\exp(s^{\phi}_{xd}+G_{d})}</annotation><annotation encoding="application/x-llamapun" id="S2.E7.m1.7d">over~ start_ARG italic_p end_ARG ( italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_ϕ , italic_θ ) = divide start_ARG roman_exp ( italic_s start_POSTSUPERSCRIPT italic_ϕ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_x italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT + italic_G start_POSTSUBSCRIPT italic_d start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT ) end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_d ∈ italic_C end_POSTSUBSCRIPT roman_exp ( italic_s start_POSTSUPERSCRIPT italic_ϕ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_x italic_d end_POSTSUBSCRIPT + italic_G start_POSTSUBSCRIPT italic_d end_POSTSUBSCRIPT ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.p7.2">where <math alttext="G_{d}" class="ltx_Math" display="inline" id="S2.p7.1.m1.1"><semantics id="S2.p7.1.m1.1a"><msub id="S2.p7.1.m1.1.1" xref="S2.p7.1.m1.1.1.cmml"><mi id="S2.p7.1.m1.1.1.2" xref="S2.p7.1.m1.1.1.2.cmml">G</mi><mi id="S2.p7.1.m1.1.1.3" xref="S2.p7.1.m1.1.1.3.cmml">d</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p7.1.m1.1b"><apply id="S2.p7.1.m1.1.1.cmml" xref="S2.p7.1.m1.1.1"><csymbol cd="ambiguous" id="S2.p7.1.m1.1.1.1.cmml" xref="S2.p7.1.m1.1.1">subscript</csymbol><ci id="S2.p7.1.m1.1.1.2.cmml" xref="S2.p7.1.m1.1.1.2">𝐺</ci><ci id="S2.p7.1.m1.1.1.3.cmml" xref="S2.p7.1.m1.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p7.1.m1.1c">G_{d}</annotation><annotation encoding="application/x-llamapun" id="S2.p7.1.m1.1d">italic_G start_POSTSUBSCRIPT italic_d end_POSTSUBSCRIPT</annotation></semantics></math> denotes the gumbel noise added for scoring document <math alttext="d" class="ltx_Math" display="inline" id="S2.p7.2.m2.1"><semantics id="S2.p7.2.m2.1a"><mi id="S2.p7.2.m2.1.1" xref="S2.p7.2.m2.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S2.p7.2.m2.1b"><ci id="S2.p7.2.m2.1.1.cmml" xref="S2.p7.2.m2.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p7.2.m2.1c">d</annotation><annotation encoding="application/x-llamapun" id="S2.p7.2.m2.1d">italic_d</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S2.p8">
<p class="ltx_p" id="S2.p8.2">We use <em class="ltx_emph ltx_font_italic" id="S2.p8.2.1">straight-through gumbel-top-k</em>, in which the top <math alttext="k" class="ltx_Math" display="inline" id="S2.p8.1.m1.1"><semantics id="S2.p8.1.m1.1a"><mi id="S2.p8.1.m1.1.1" xref="S2.p8.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.p8.1.m1.1b"><ci id="S2.p8.1.m1.1.1.cmml" xref="S2.p8.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p8.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.p8.1.m1.1d">italic_k</annotation></semantics></math> elements are selected from the above distribution using the <math alttext="\arg\max" class="ltx_Math" display="inline" id="S2.p8.2.m2.1"><semantics id="S2.p8.2.m2.1a"><mrow id="S2.p8.2.m2.1.1" xref="S2.p8.2.m2.1.1.cmml"><mi id="S2.p8.2.m2.1.1.1" xref="S2.p8.2.m2.1.1.1.cmml">arg</mi><mo id="S2.p8.2.m2.1.1a" lspace="0.167em" xref="S2.p8.2.m2.1.1.cmml">⁡</mo><mi id="S2.p8.2.m2.1.1.2" xref="S2.p8.2.m2.1.1.2.cmml">max</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.p8.2.m2.1b"><apply id="S2.p8.2.m2.1.1.cmml" xref="S2.p8.2.m2.1.1"><arg id="S2.p8.2.m2.1.1.1.cmml" xref="S2.p8.2.m2.1.1.1"></arg><max id="S2.p8.2.m2.1.1.2.cmml" xref="S2.p8.2.m2.1.1.2"></max></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p8.2.m2.1c">\arg\max</annotation><annotation encoding="application/x-llamapun" id="S2.p8.2.m2.1d">roman_arg roman_max</annotation></semantics></math> operation in the forward path, however, the softmax distribution is used in the backward path for computing the gradients. For more information on straight-through gumbel-softmax, refer to <cite class="ltx_cite ltx_citemacro_citep">(Jang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib15" title="">2017</a>; Paulus et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib29" title="">2021</a>)</cite>. Gumbel-top-k has been used in IR systems too. For instance, <cite class="ltx_cite ltx_citemacro_citet">Zamani et al<span class="ltx_text">.</span> (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib52" title="">2022a</a>)</cite> used the gumbel-top-k trick to optimize re-ranking models conditioned on the first stage retrieval models.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.p9">
<p class="ltx_p" id="S2.p9.16"><span class="ltx_text ltx_font_bold" id="S2.p9.1.1">Selecting <math alttext="\mathcal{Y}" class="ltx_Math" display="inline" id="S2.p9.1.1.m1.1"><semantics id="S2.p9.1.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S2.p9.1.1.m1.1.1" xref="S2.p9.1.1.m1.1.1.cmml">𝒴</mi><annotation-xml encoding="MathML-Content" id="S2.p9.1.1.m1.1b"><ci id="S2.p9.1.1.m1.1.1.cmml" xref="S2.p9.1.1.m1.1.1">𝒴</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.1.1.m1.1c">\mathcal{Y}</annotation><annotation encoding="application/x-llamapun" id="S2.p9.1.1.m1.1d">caligraphic_Y</annotation></semantics></math>.</span> In Equation (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.E1" title="In 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">1</span></a>), <math alttext="\mathcal{Y}" class="ltx_Math" display="inline" id="S2.p9.2.m1.1"><semantics id="S2.p9.2.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S2.p9.2.m1.1.1" xref="S2.p9.2.m1.1.1.cmml">𝒴</mi><annotation-xml encoding="MathML-Content" id="S2.p9.2.m1.1b"><ci id="S2.p9.2.m1.1.1.cmml" xref="S2.p9.2.m1.1.1">𝒴</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.2.m1.1c">\mathcal{Y}</annotation><annotation encoding="application/x-llamapun" id="S2.p9.2.m1.1d">caligraphic_Y</annotation></semantics></math> denotes the output space, which can be unlimited for free-form text generation tasks, hence computationally intractable. In such cases, we need to estimate RAG Expected Utility by sampling from the output space. A uniformly random sample can give us an unbiased estimation, however, most random samples are completely unrelated to the input, so they can be easily discriminated from the ground truth output. Inspired by work on hard negative sampling for training ranking models <cite class="ltx_cite ltx_citemacro_citep">(Xiong et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib50" title="">2021</a>; Prakash et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib32" title="">2021</a>)</cite>, at every <math alttext="N=10,000" class="ltx_Math" display="inline" id="S2.p9.3.m2.2"><semantics id="S2.p9.3.m2.2a"><mrow id="S2.p9.3.m2.2.3" xref="S2.p9.3.m2.2.3.cmml"><mi id="S2.p9.3.m2.2.3.2" xref="S2.p9.3.m2.2.3.2.cmml">N</mi><mo id="S2.p9.3.m2.2.3.1" xref="S2.p9.3.m2.2.3.1.cmml">=</mo><mrow id="S2.p9.3.m2.2.3.3.2" xref="S2.p9.3.m2.2.3.3.1.cmml"><mn id="S2.p9.3.m2.1.1" xref="S2.p9.3.m2.1.1.cmml">10</mn><mo id="S2.p9.3.m2.2.3.3.2.1" xref="S2.p9.3.m2.2.3.3.1.cmml">,</mo><mn id="S2.p9.3.m2.2.2" xref="S2.p9.3.m2.2.2.cmml">000</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p9.3.m2.2b"><apply id="S2.p9.3.m2.2.3.cmml" xref="S2.p9.3.m2.2.3"><eq id="S2.p9.3.m2.2.3.1.cmml" xref="S2.p9.3.m2.2.3.1"></eq><ci id="S2.p9.3.m2.2.3.2.cmml" xref="S2.p9.3.m2.2.3.2">𝑁</ci><list id="S2.p9.3.m2.2.3.3.1.cmml" xref="S2.p9.3.m2.2.3.3.2"><cn id="S2.p9.3.m2.1.1.cmml" type="integer" xref="S2.p9.3.m2.1.1">10</cn><cn id="S2.p9.3.m2.2.2.cmml" type="integer" xref="S2.p9.3.m2.2.2">000</cn></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.3.m2.2c">N=10,000</annotation><annotation encoding="application/x-llamapun" id="S2.p9.3.m2.2d">italic_N = 10 , 000</annotation></semantics></math> training steps, we run the RAG model that is being trained on the training inputs that will be used in the next <math alttext="N" class="ltx_Math" display="inline" id="S2.p9.4.m3.1"><semantics id="S2.p9.4.m3.1a"><mi id="S2.p9.4.m3.1.1" xref="S2.p9.4.m3.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S2.p9.4.m3.1b"><ci id="S2.p9.4.m3.1.1.cmml" xref="S2.p9.4.m3.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.4.m3.1c">N</annotation><annotation encoding="application/x-llamapun" id="S2.p9.4.m3.1d">italic_N</annotation></semantics></math> steps and use beam search to return <math alttext="100" class="ltx_Math" display="inline" id="S2.p9.5.m4.1"><semantics id="S2.p9.5.m4.1a"><mn id="S2.p9.5.m4.1.1" xref="S2.p9.5.m4.1.1.cmml">100</mn><annotation-xml encoding="MathML-Content" id="S2.p9.5.m4.1b"><cn id="S2.p9.5.m4.1.1.cmml" type="integer" xref="S2.p9.5.m4.1.1">100</cn></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.5.m4.1c">100</annotation><annotation encoding="application/x-llamapun" id="S2.p9.5.m4.1d">100</annotation></semantics></math> most probable outputs. We randomly sample <math alttext="m=10" class="ltx_Math" display="inline" id="S2.p9.6.m5.1"><semantics id="S2.p9.6.m5.1a"><mrow id="S2.p9.6.m5.1.1" xref="S2.p9.6.m5.1.1.cmml"><mi id="S2.p9.6.m5.1.1.2" xref="S2.p9.6.m5.1.1.2.cmml">m</mi><mo id="S2.p9.6.m5.1.1.1" xref="S2.p9.6.m5.1.1.1.cmml">=</mo><mn id="S2.p9.6.m5.1.1.3" xref="S2.p9.6.m5.1.1.3.cmml">10</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.p9.6.m5.1b"><apply id="S2.p9.6.m5.1.1.cmml" xref="S2.p9.6.m5.1.1"><eq id="S2.p9.6.m5.1.1.1.cmml" xref="S2.p9.6.m5.1.1.1"></eq><ci id="S2.p9.6.m5.1.1.2.cmml" xref="S2.p9.6.m5.1.1.2">𝑚</ci><cn id="S2.p9.6.m5.1.1.3.cmml" type="integer" xref="S2.p9.6.m5.1.1.3">10</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.6.m5.1c">m=10</annotation><annotation encoding="application/x-llamapun" id="S2.p9.6.m5.1d">italic_m = 10</annotation></semantics></math> of these outputs to form <math alttext="\mathcal{Y}" class="ltx_Math" display="inline" id="S2.p9.7.m6.1"><semantics id="S2.p9.7.m6.1a"><mi class="ltx_font_mathcaligraphic" id="S2.p9.7.m6.1.1" xref="S2.p9.7.m6.1.1.cmml">𝒴</mi><annotation-xml encoding="MathML-Content" id="S2.p9.7.m6.1b"><ci id="S2.p9.7.m6.1.1.cmml" xref="S2.p9.7.m6.1.1">𝒴</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.7.m6.1c">\mathcal{Y}</annotation><annotation encoding="application/x-llamapun" id="S2.p9.7.m6.1d">caligraphic_Y</annotation></semantics></math>. We then made sure that for every pair <math alttext="(x,y)" class="ltx_Math" display="inline" id="S2.p9.8.m7.2"><semantics id="S2.p9.8.m7.2a"><mrow id="S2.p9.8.m7.2.3.2" xref="S2.p9.8.m7.2.3.1.cmml"><mo id="S2.p9.8.m7.2.3.2.1" stretchy="false" xref="S2.p9.8.m7.2.3.1.cmml">(</mo><mi id="S2.p9.8.m7.1.1" xref="S2.p9.8.m7.1.1.cmml">x</mi><mo id="S2.p9.8.m7.2.3.2.2" xref="S2.p9.8.m7.2.3.1.cmml">,</mo><mi id="S2.p9.8.m7.2.2" xref="S2.p9.8.m7.2.2.cmml">y</mi><mo id="S2.p9.8.m7.2.3.2.3" stretchy="false" xref="S2.p9.8.m7.2.3.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.p9.8.m7.2b"><interval closure="open" id="S2.p9.8.m7.2.3.1.cmml" xref="S2.p9.8.m7.2.3.2"><ci id="S2.p9.8.m7.1.1.cmml" xref="S2.p9.8.m7.1.1">𝑥</ci><ci id="S2.p9.8.m7.2.2.cmml" xref="S2.p9.8.m7.2.2">𝑦</ci></interval></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.8.m7.2c">(x,y)</annotation><annotation encoding="application/x-llamapun" id="S2.p9.8.m7.2d">( italic_x , italic_y )</annotation></semantics></math> in the training set for the next <math alttext="N" class="ltx_Math" display="inline" id="S2.p9.9.m8.1"><semantics id="S2.p9.9.m8.1a"><mi id="S2.p9.9.m8.1.1" xref="S2.p9.9.m8.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S2.p9.9.m8.1b"><ci id="S2.p9.9.m8.1.1.cmml" xref="S2.p9.9.m8.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.9.m8.1c">N</annotation><annotation encoding="application/x-llamapun" id="S2.p9.9.m8.1d">italic_N</annotation></semantics></math> steps, <math alttext="y" class="ltx_Math" display="inline" id="S2.p9.10.m9.1"><semantics id="S2.p9.10.m9.1a"><mi id="S2.p9.10.m9.1.1" xref="S2.p9.10.m9.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S2.p9.10.m9.1b"><ci id="S2.p9.10.m9.1.1.cmml" xref="S2.p9.10.m9.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.10.m9.1c">y</annotation><annotation encoding="application/x-llamapun" id="S2.p9.10.m9.1d">italic_y</annotation></semantics></math> is included in <math alttext="\mathcal{Y}" class="ltx_Math" display="inline" id="S2.p9.11.m10.1"><semantics id="S2.p9.11.m10.1a"><mi class="ltx_font_mathcaligraphic" id="S2.p9.11.m10.1.1" xref="S2.p9.11.m10.1.1.cmml">𝒴</mi><annotation-xml encoding="MathML-Content" id="S2.p9.11.m10.1b"><ci id="S2.p9.11.m10.1.1.cmml" xref="S2.p9.11.m10.1.1">𝒴</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.11.m10.1c">\mathcal{Y}</annotation><annotation encoding="application/x-llamapun" id="S2.p9.11.m10.1d">caligraphic_Y</annotation></semantics></math>, otherwise we randomly replace one of the sampled outputs in <math alttext="\mathcal{Y}" class="ltx_Math" display="inline" id="S2.p9.12.m11.1"><semantics id="S2.p9.12.m11.1a"><mi class="ltx_font_mathcaligraphic" id="S2.p9.12.m11.1.1" xref="S2.p9.12.m11.1.1.cmml">𝒴</mi><annotation-xml encoding="MathML-Content" id="S2.p9.12.m11.1b"><ci id="S2.p9.12.m11.1.1.cmml" xref="S2.p9.12.m11.1.1">𝒴</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.12.m11.1c">\mathcal{Y}</annotation><annotation encoding="application/x-llamapun" id="S2.p9.12.m11.1d">caligraphic_Y</annotation></semantics></math> with <math alttext="y" class="ltx_Math" display="inline" id="S2.p9.13.m12.1"><semantics id="S2.p9.13.m12.1a"><mi id="S2.p9.13.m12.1.1" xref="S2.p9.13.m12.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S2.p9.13.m12.1b"><ci id="S2.p9.13.m12.1.1.cmml" xref="S2.p9.13.m12.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.13.m12.1c">y</annotation><annotation encoding="application/x-llamapun" id="S2.p9.13.m12.1d">italic_y</annotation></semantics></math>. The reason for doing this is to make sure that our sample contains the ground truth output, ensuring that the model learns to produce higher probability for the ground truth output. Preparing <math alttext="\mathcal{Y}" class="ltx_Math" display="inline" id="S2.p9.14.m13.1"><semantics id="S2.p9.14.m13.1a"><mi class="ltx_font_mathcaligraphic" id="S2.p9.14.m13.1.1" xref="S2.p9.14.m13.1.1.cmml">𝒴</mi><annotation-xml encoding="MathML-Content" id="S2.p9.14.m13.1b"><ci id="S2.p9.14.m13.1.1.cmml" xref="S2.p9.14.m13.1.1">𝒴</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.14.m13.1c">\mathcal{Y}</annotation><annotation encoding="application/x-llamapun" id="S2.p9.14.m13.1d">caligraphic_Y</annotation></semantics></math> for the next <math alttext="N" class="ltx_Math" display="inline" id="S2.p9.15.m14.1"><semantics id="S2.p9.15.m14.1a"><mi id="S2.p9.15.m14.1.1" xref="S2.p9.15.m14.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S2.p9.15.m14.1b"><ci id="S2.p9.15.m14.1.1.cmml" xref="S2.p9.15.m14.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.15.m14.1c">N</annotation><annotation encoding="application/x-llamapun" id="S2.p9.15.m14.1d">italic_N</annotation></semantics></math> training steps would also enable us to pre-compute utility values <math alttext="U(y,\hat{y}):\forall\hat{y}\in\mathcal{Y}" class="ltx_Math" display="inline" id="S2.p9.16.m15.2"><semantics id="S2.p9.16.m15.2a"><mrow id="S2.p9.16.m15.2.3" xref="S2.p9.16.m15.2.3.cmml"><mrow id="S2.p9.16.m15.2.3.2" xref="S2.p9.16.m15.2.3.2.cmml"><mi id="S2.p9.16.m15.2.3.2.2" xref="S2.p9.16.m15.2.3.2.2.cmml">U</mi><mo id="S2.p9.16.m15.2.3.2.1" xref="S2.p9.16.m15.2.3.2.1.cmml">⁢</mo><mrow id="S2.p9.16.m15.2.3.2.3.2" xref="S2.p9.16.m15.2.3.2.3.1.cmml"><mo id="S2.p9.16.m15.2.3.2.3.2.1" stretchy="false" xref="S2.p9.16.m15.2.3.2.3.1.cmml">(</mo><mi id="S2.p9.16.m15.1.1" xref="S2.p9.16.m15.1.1.cmml">y</mi><mo id="S2.p9.16.m15.2.3.2.3.2.2" xref="S2.p9.16.m15.2.3.2.3.1.cmml">,</mo><mover accent="true" id="S2.p9.16.m15.2.2" xref="S2.p9.16.m15.2.2.cmml"><mi id="S2.p9.16.m15.2.2.2" xref="S2.p9.16.m15.2.2.2.cmml">y</mi><mo id="S2.p9.16.m15.2.2.1" xref="S2.p9.16.m15.2.2.1.cmml">^</mo></mover><mo id="S2.p9.16.m15.2.3.2.3.2.3" rspace="0.278em" stretchy="false" xref="S2.p9.16.m15.2.3.2.3.1.cmml">)</mo></mrow></mrow><mo id="S2.p9.16.m15.2.3.1" rspace="0.278em" xref="S2.p9.16.m15.2.3.1.cmml">:</mo><mrow id="S2.p9.16.m15.2.3.3" xref="S2.p9.16.m15.2.3.3.cmml"><mrow id="S2.p9.16.m15.2.3.3.2" xref="S2.p9.16.m15.2.3.3.2.cmml"><mo id="S2.p9.16.m15.2.3.3.2.1" rspace="0.167em" xref="S2.p9.16.m15.2.3.3.2.1.cmml">∀</mo><mover accent="true" id="S2.p9.16.m15.2.3.3.2.2" xref="S2.p9.16.m15.2.3.3.2.2.cmml"><mi id="S2.p9.16.m15.2.3.3.2.2.2" xref="S2.p9.16.m15.2.3.3.2.2.2.cmml">y</mi><mo id="S2.p9.16.m15.2.3.3.2.2.1" xref="S2.p9.16.m15.2.3.3.2.2.1.cmml">^</mo></mover></mrow><mo id="S2.p9.16.m15.2.3.3.1" xref="S2.p9.16.m15.2.3.3.1.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="S2.p9.16.m15.2.3.3.3" xref="S2.p9.16.m15.2.3.3.3.cmml">𝒴</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p9.16.m15.2b"><apply id="S2.p9.16.m15.2.3.cmml" xref="S2.p9.16.m15.2.3"><ci id="S2.p9.16.m15.2.3.1.cmml" xref="S2.p9.16.m15.2.3.1">:</ci><apply id="S2.p9.16.m15.2.3.2.cmml" xref="S2.p9.16.m15.2.3.2"><times id="S2.p9.16.m15.2.3.2.1.cmml" xref="S2.p9.16.m15.2.3.2.1"></times><ci id="S2.p9.16.m15.2.3.2.2.cmml" xref="S2.p9.16.m15.2.3.2.2">𝑈</ci><interval closure="open" id="S2.p9.16.m15.2.3.2.3.1.cmml" xref="S2.p9.16.m15.2.3.2.3.2"><ci id="S2.p9.16.m15.1.1.cmml" xref="S2.p9.16.m15.1.1">𝑦</ci><apply id="S2.p9.16.m15.2.2.cmml" xref="S2.p9.16.m15.2.2"><ci id="S2.p9.16.m15.2.2.1.cmml" xref="S2.p9.16.m15.2.2.1">^</ci><ci id="S2.p9.16.m15.2.2.2.cmml" xref="S2.p9.16.m15.2.2.2">𝑦</ci></apply></interval></apply><apply id="S2.p9.16.m15.2.3.3.cmml" xref="S2.p9.16.m15.2.3.3"><in id="S2.p9.16.m15.2.3.3.1.cmml" xref="S2.p9.16.m15.2.3.3.1"></in><apply id="S2.p9.16.m15.2.3.3.2.cmml" xref="S2.p9.16.m15.2.3.3.2"><csymbol cd="latexml" id="S2.p9.16.m15.2.3.3.2.1.cmml" xref="S2.p9.16.m15.2.3.3.2.1">for-all</csymbol><apply id="S2.p9.16.m15.2.3.3.2.2.cmml" xref="S2.p9.16.m15.2.3.3.2.2"><ci id="S2.p9.16.m15.2.3.3.2.2.1.cmml" xref="S2.p9.16.m15.2.3.3.2.2.1">^</ci><ci id="S2.p9.16.m15.2.3.3.2.2.2.cmml" xref="S2.p9.16.m15.2.3.3.2.2.2">𝑦</ci></apply></apply><ci id="S2.p9.16.m15.2.3.3.3.cmml" xref="S2.p9.16.m15.2.3.3.3">𝒴</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p9.16.m15.2c">U(y,\hat{y}):\forall\hat{y}\in\mathcal{Y}</annotation><annotation encoding="application/x-llamapun" id="S2.p9.16.m15.2d">italic_U ( italic_y , over^ start_ARG italic_y end_ARG ) : ∀ over^ start_ARG italic_y end_ARG ∈ caligraphic_Y</annotation></semantics></math>, ensuring an efficient optimization process for RAG Expected Utility Maximization (see Equation (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.E1" title="In 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">1</span></a>)).</p>
</div>
<figure class="ltx_table" id="S2.T1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 1. </span>Comparing our models with top performing entries in the KILT leaderboard according to KILT-scores, as of February 1, 2024. The results are reported on the blind KILT test sets.</figcaption>
<div class="ltx_inline-block ltx_transformed_outer" id="S2.T1.4" style="width:433.6pt;height:171pt;vertical-align:-0.6pt;"><span class="ltx_transformed_inner" style="transform:translate(-149.6pt,58.8pt) scale(0.591635197698625,0.591635197698625) ;">
<table class="ltx_tabular ltx_align_middle" id="S2.T1.4.4">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S2.T1.4.4.5.1">
<td class="ltx_td ltx_border_tt" id="S2.T1.4.4.5.1.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r ltx_border_tt" id="S2.T1.4.4.5.1.2" rowspan="3" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_bold" id="S2.T1.4.4.5.1.2.1">Model</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_tt" colspan="3" id="S2.T1.4.4.5.1.3" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_bold" id="S2.T1.4.4.5.1.3.1">Open Domain QA</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_tt" id="S2.T1.4.4.5.1.4" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_bold" id="S2.T1.4.4.5.1.4.1">Fact</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_tt" colspan="2" id="S2.T1.4.4.5.1.5" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_bold" id="S2.T1.4.4.5.1.5.1">Slot Filling</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S2.T1.4.4.5.1.6" style="padding-left:6.5pt;padding-right:6.5pt;"><span class="ltx_text ltx_font_bold" id="S2.T1.4.4.5.1.6.1">Dialog</span></td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.6.2">
<td class="ltx_td" id="S2.T1.4.4.6.2.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.6.2.2" style="padding-left:6.5pt;padding-right:6.5pt;">NQ</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.6.2.3" style="padding-left:6.5pt;padding-right:6.5pt;">HotpotQA</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.6.2.4" style="padding-left:6.5pt;padding-right:6.5pt;">TriviaQA</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.6.2.5" style="padding-left:6.5pt;padding-right:6.5pt;">FEVER</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.6.2.6" style="padding-left:6.5pt;padding-right:6.5pt;">T-REx</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.6.2.7" style="padding-left:6.5pt;padding-right:6.5pt;">zsRE</td>
<td class="ltx_td ltx_align_center" id="S2.T1.4.4.6.2.8" style="padding-left:6.5pt;padding-right:6.5pt;">WOW</td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.7.3">
<td class="ltx_td" id="S2.T1.4.4.7.3.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.7.3.2" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_italic" id="S2.T1.4.4.7.3.2.1" style="font-size:80%;">KILT-EM</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.7.3.3" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_italic" id="S2.T1.4.4.7.3.3.1" style="font-size:80%;">KILT-EM</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.7.3.4" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_italic" id="S2.T1.4.4.7.3.4.1" style="font-size:80%;">KILT-EM</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.7.3.5" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_italic" id="S2.T1.4.4.7.3.5.1" style="font-size:80%;">KILT-AC</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.7.3.6" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_italic" id="S2.T1.4.4.7.3.6.1" style="font-size:80%;">KILT-AC</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.7.3.7" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_italic" id="S2.T1.4.4.7.3.7.1" style="font-size:80%;">KILT-AC</span></td>
<td class="ltx_td ltx_align_center" id="S2.T1.4.4.7.3.8" style="padding-left:6.5pt;padding-right:6.5pt;"><span class="ltx_text ltx_font_italic" id="S2.T1.4.4.7.3.8.1" style="font-size:80%;">KILT-F1</span></td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.8.4">
<td class="ltx_td ltx_border_t" id="S2.T1.4.4.8.4.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r ltx_border_t" id="S2.T1.4.4.8.4.2" style="padding-left:6.5pt;padding-right:6.5pt;">RAG <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib22" title="">2020</a>)</cite></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.4.4.8.4.3" style="padding-left:6.5pt;padding-right:6.5pt;">32.7</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.4.4.8.4.4" style="padding-left:6.5pt;padding-right:6.5pt;">3.2</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.4.4.8.4.5" style="padding-left:6.5pt;padding-right:6.5pt;">38.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.4.4.8.4.6" style="padding-left:6.5pt;padding-right:6.5pt;">53.5</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.4.4.8.4.7" style="padding-left:6.5pt;padding-right:6.5pt;">23.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.4.4.8.4.8" style="padding-left:6.5pt;padding-right:6.5pt;">36.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.4.4.8.4.9" style="padding-left:6.5pt;padding-right:6.5pt;">8.8</td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.9.5">
<td class="ltx_td" id="S2.T1.4.4.9.5.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r" id="S2.T1.4.4.9.5.2" style="padding-left:6.5pt;padding-right:6.5pt;">DPR + FiD <cite class="ltx_cite ltx_citemacro_citep">(Piktus et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib31" title="">2021</a>)</cite></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.9.5.3" style="padding-left:6.5pt;padding-right:6.5pt;">35.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.9.5.4" style="padding-left:6.5pt;padding-right:6.5pt;">11.7</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.9.5.5" style="padding-left:6.5pt;padding-right:6.5pt;">45.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.9.5.6" style="padding-left:6.5pt;padding-right:6.5pt;">65.7</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.9.5.7" style="padding-left:6.5pt;padding-right:6.5pt;">64.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.9.5.8" style="padding-left:6.5pt;padding-right:6.5pt;">67.2</td>
<td class="ltx_td ltx_align_center" id="S2.T1.4.4.9.5.9" style="padding-left:6.5pt;padding-right:6.5pt;">7.6</td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.10.6">
<td class="ltx_td" id="S2.T1.4.4.10.6.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r" id="S2.T1.4.4.10.6.2" style="padding-left:6.5pt;padding-right:6.5pt;">KGI <cite class="ltx_cite ltx_citemacro_citep">(Glass et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib9" title="">2021</a>)</cite></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.10.6.3" style="padding-left:6.5pt;padding-right:6.5pt;">36.4</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.10.6.4" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.10.6.5" style="padding-left:6.5pt;padding-right:6.5pt;">42.9</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.10.6.6" style="padding-left:6.5pt;padding-right:6.5pt;">64.4</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.10.6.7" style="padding-left:6.5pt;padding-right:6.5pt;">69.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.10.6.8" style="padding-left:6.5pt;padding-right:6.5pt;">72.3</td>
<td class="ltx_td ltx_align_center" id="S2.T1.4.4.10.6.9" style="padding-left:6.5pt;padding-right:6.5pt;">11.8</td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.11.7">
<td class="ltx_td" id="S2.T1.4.4.11.7.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r" id="S2.T1.4.4.11.7.2" style="padding-left:6.5pt;padding-right:6.5pt;">Re2G <cite class="ltx_cite ltx_citemacro_citep">(Glass et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib11" title="">2022b</a>)</cite></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.11.7.3" style="padding-left:6.5pt;padding-right:6.5pt;">43.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.11.7.4" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.11.7.5" style="padding-left:6.5pt;padding-right:6.5pt;">57.9</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.11.7.6" style="padding-left:6.5pt;padding-right:6.5pt;">78.5</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.11.7.7" style="padding-left:6.5pt;padding-right:6.5pt;">75.8</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.11.7.8" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_align_center" id="S2.T1.4.4.11.7.9" style="padding-left:6.5pt;padding-right:6.5pt;">12.9</td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.12.8">
<td class="ltx_td" id="S2.T1.4.4.12.8.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r" id="S2.T1.4.4.12.8.2" style="padding-left:6.5pt;padding-right:6.5pt;">Hindsight <cite class="ltx_cite ltx_citemacro_citep">(Paranjape et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib28" title="">2021</a>)</cite></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.12.8.3" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.12.8.4" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.12.8.5" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.12.8.6" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.12.8.7" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.12.8.8" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_align_center" id="S2.T1.4.4.12.8.9" style="padding-left:6.5pt;padding-right:6.5pt;">13.4</td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.13.9">
<td class="ltx_td" id="S2.T1.4.4.13.9.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r" id="S2.T1.4.4.13.9.2" style="padding-left:6.5pt;padding-right:6.5pt;">SEAL + FiD <cite class="ltx_cite ltx_citemacro_citep">(Bevilacqua et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib5" title="">2022</a>)</cite></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.13.9.3" style="padding-left:6.5pt;padding-right:6.5pt;">38.8</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.13.9.4" style="padding-left:6.5pt;padding-right:6.5pt;">18.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.13.9.5" style="padding-left:6.5pt;padding-right:6.5pt;">50.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.13.9.6" style="padding-left:6.5pt;padding-right:6.5pt;">71.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.13.9.7" style="padding-left:6.5pt;padding-right:6.5pt;">60.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.13.9.8" style="padding-left:6.5pt;padding-right:6.5pt;">73.2</td>
<td class="ltx_td ltx_align_center" id="S2.T1.4.4.13.9.9" style="padding-left:6.5pt;padding-right:6.5pt;">11.6</td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.14.10">
<td class="ltx_td" id="S2.T1.4.4.14.10.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r" id="S2.T1.4.4.14.10.2" style="padding-left:6.5pt;padding-right:6.5pt;">Re3val <cite class="ltx_cite ltx_citemacro_citep">(Song et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib42" title="">2024</a>)</cite></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.14.10.3" style="padding-left:6.5pt;padding-right:6.5pt;">39.5</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.14.10.4" style="padding-left:6.5pt;padding-right:6.5pt;">24.2</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.14.10.5" style="padding-left:6.5pt;padding-right:6.5pt;">51.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.14.10.6" style="padding-left:6.5pt;padding-right:6.5pt;">73.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.14.10.7" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.14.10.8" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_align_center" id="S2.T1.4.4.14.10.9" style="padding-left:6.5pt;padding-right:6.5pt;">13.5</td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.15.11">
<td class="ltx_td" id="S2.T1.4.4.15.11.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r" id="S2.T1.4.4.15.11.2" style="padding-left:6.5pt;padding-right:6.5pt;">GripRank <cite class="ltx_cite ltx_citemacro_citep">(Bai et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib2" title="">2023</a>)</cite></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.15.11.3" style="padding-left:6.5pt;padding-right:6.5pt;">43.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.15.11.4" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.15.11.5" style="padding-left:6.5pt;padding-right:6.5pt;">58.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.15.11.6" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.15.11.7" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.15.11.8" style="padding-left:6.5pt;padding-right:6.5pt;">79.9</td>
<td class="ltx_td ltx_align_center" id="S2.T1.4.4.15.11.9" style="padding-left:6.5pt;padding-right:6.5pt;"><span class="ltx_text ltx_font_bold" id="S2.T1.4.4.15.11.9.1">14.7</span></td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.16.12">
<td class="ltx_td" id="S2.T1.4.4.16.12.1" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r" id="S2.T1.4.4.16.12.2" style="padding-left:6.5pt;padding-right:6.5pt;">PLATO <cite class="ltx_cite ltx_citemacro_citep">(Bao et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib4" title="">2022</a>)</cite></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.16.12.3" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.16.12.4" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.16.12.5" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.16.12.6" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.16.12.7" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.4.4.16.12.8" style="padding-left:6.5pt;padding-right:6.5pt;">–</td>
<td class="ltx_td ltx_align_center" id="S2.T1.4.4.16.12.9" style="padding-left:6.5pt;padding-right:6.5pt;">13.6</td>
</tr>
<tr class="ltx_tr" id="S2.T1.1.1.1">
<td class="ltx_td ltx_align_left" id="S2.T1.1.1.1.2" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_ERROR undefined" id="S2.T1.1.1.1.2.1">\cdashline</span>1-9</td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r" id="S2.T1.1.1.1.1" style="padding-left:6.5pt;padding-right:6.5pt;">FiD-Light (T5-Base, <math alttext="k=64" class="ltx_Math" display="inline" id="S2.T1.1.1.1.1.m1.1"><semantics id="S2.T1.1.1.1.1.m1.1a"><mrow id="S2.T1.1.1.1.1.m1.1.1" xref="S2.T1.1.1.1.1.m1.1.1.cmml"><mi id="S2.T1.1.1.1.1.m1.1.1.2" xref="S2.T1.1.1.1.1.m1.1.1.2.cmml">k</mi><mo id="S2.T1.1.1.1.1.m1.1.1.1" xref="S2.T1.1.1.1.1.m1.1.1.1.cmml">=</mo><mn id="S2.T1.1.1.1.1.m1.1.1.3" xref="S2.T1.1.1.1.1.m1.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.T1.1.1.1.1.m1.1b"><apply id="S2.T1.1.1.1.1.m1.1.1.cmml" xref="S2.T1.1.1.1.1.m1.1.1"><eq id="S2.T1.1.1.1.1.m1.1.1.1.cmml" xref="S2.T1.1.1.1.1.m1.1.1.1"></eq><ci id="S2.T1.1.1.1.1.m1.1.1.2.cmml" xref="S2.T1.1.1.1.1.m1.1.1.2">𝑘</ci><cn id="S2.T1.1.1.1.1.m1.1.1.3.cmml" type="integer" xref="S2.T1.1.1.1.1.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.T1.1.1.1.1.m1.1c">k=64</annotation><annotation encoding="application/x-llamapun" id="S2.T1.1.1.1.1.m1.1d">italic_k = 64</annotation></semantics></math>)</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.1.1.1.3" style="padding-left:6.5pt;padding-right:6.5pt;">45.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.1.1.1.4" style="padding-left:6.5pt;padding-right:6.5pt;">25.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.1.1.1.5" style="padding-left:6.5pt;padding-right:6.5pt;">57.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.1.1.1.6" style="padding-left:6.5pt;padding-right:6.5pt;">80.6</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.1.1.1.7" style="padding-left:6.5pt;padding-right:6.5pt;">76.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.1.1.1.8" style="padding-left:6.5pt;padding-right:6.5pt;">81.1</td>
<td class="ltx_td ltx_align_center" id="S2.T1.1.1.1.9" style="padding-left:6.5pt;padding-right:6.5pt;">11.9</td>
</tr>
<tr class="ltx_tr" id="S2.T1.2.2.2">
<td class="ltx_td" id="S2.T1.2.2.2.2" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r" id="S2.T1.2.2.2.1" style="padding-left:6.5pt;padding-right:6.5pt;">FiD-Light (T5-XL, <math alttext="k=8" class="ltx_Math" display="inline" id="S2.T1.2.2.2.1.m1.1"><semantics id="S2.T1.2.2.2.1.m1.1a"><mrow id="S2.T1.2.2.2.1.m1.1.1" xref="S2.T1.2.2.2.1.m1.1.1.cmml"><mi id="S2.T1.2.2.2.1.m1.1.1.2" xref="S2.T1.2.2.2.1.m1.1.1.2.cmml">k</mi><mo id="S2.T1.2.2.2.1.m1.1.1.1" xref="S2.T1.2.2.2.1.m1.1.1.1.cmml">=</mo><mn id="S2.T1.2.2.2.1.m1.1.1.3" xref="S2.T1.2.2.2.1.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.T1.2.2.2.1.m1.1b"><apply id="S2.T1.2.2.2.1.m1.1.1.cmml" xref="S2.T1.2.2.2.1.m1.1.1"><eq id="S2.T1.2.2.2.1.m1.1.1.1.cmml" xref="S2.T1.2.2.2.1.m1.1.1.1"></eq><ci id="S2.T1.2.2.2.1.m1.1.1.2.cmml" xref="S2.T1.2.2.2.1.m1.1.1.2">𝑘</ci><cn id="S2.T1.2.2.2.1.m1.1.1.3.cmml" type="integer" xref="S2.T1.2.2.2.1.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.T1.2.2.2.1.m1.1c">k=8</annotation><annotation encoding="application/x-llamapun" id="S2.T1.2.2.2.1.m1.1d">italic_k = 8</annotation></semantics></math>)</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.2.2.2.3" style="padding-left:6.5pt;padding-right:6.5pt;">51.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.2.2.2.4" style="padding-left:6.5pt;padding-right:6.5pt;">29.2</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.2.2.2.5" style="padding-left:6.5pt;padding-right:6.5pt;">63.7</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.2.2.2.6" style="padding-left:6.5pt;padding-right:6.5pt;">84.5</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.2.2.2.7" style="padding-left:6.5pt;padding-right:6.5pt;">76.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r" id="S2.T1.2.2.2.8" style="padding-left:6.5pt;padding-right:6.5pt;">84.0</td>
<td class="ltx_td ltx_align_center" id="S2.T1.2.2.2.9" style="padding-left:6.5pt;padding-right:6.5pt;">13.1</td>
</tr>
<tr class="ltx_tr" id="S2.T1.3.3.3">
<td class="ltx_td ltx_border_t" id="S2.T1.3.3.3.2" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_r ltx_border_t" id="S2.T1.3.3.3.1" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_smallcaps" id="S2.T1.3.3.3.1.1">Stochastic RAG</span> with FiD-Light (T5-Base, <math alttext="k=64" class="ltx_Math" display="inline" id="S2.T1.3.3.3.1.m1.1"><semantics id="S2.T1.3.3.3.1.m1.1a"><mrow id="S2.T1.3.3.3.1.m1.1.1" xref="S2.T1.3.3.3.1.m1.1.1.cmml"><mi id="S2.T1.3.3.3.1.m1.1.1.2" xref="S2.T1.3.3.3.1.m1.1.1.2.cmml">k</mi><mo id="S2.T1.3.3.3.1.m1.1.1.1" xref="S2.T1.3.3.3.1.m1.1.1.1.cmml">=</mo><mn id="S2.T1.3.3.3.1.m1.1.1.3" xref="S2.T1.3.3.3.1.m1.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.T1.3.3.3.1.m1.1b"><apply id="S2.T1.3.3.3.1.m1.1.1.cmml" xref="S2.T1.3.3.3.1.m1.1.1"><eq id="S2.T1.3.3.3.1.m1.1.1.1.cmml" xref="S2.T1.3.3.3.1.m1.1.1.1"></eq><ci id="S2.T1.3.3.3.1.m1.1.1.2.cmml" xref="S2.T1.3.3.3.1.m1.1.1.2">𝑘</ci><cn id="S2.T1.3.3.3.1.m1.1.1.3.cmml" type="integer" xref="S2.T1.3.3.3.1.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.T1.3.3.3.1.m1.1c">k=64</annotation><annotation encoding="application/x-llamapun" id="S2.T1.3.3.3.1.m1.1d">italic_k = 64</annotation></semantics></math>)</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.3.3.3.3" style="padding-left:6.5pt;padding-right:6.5pt;">46.2</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.3.3.3.4" style="padding-left:6.5pt;padding-right:6.5pt;">27.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.3.3.3.5" style="padding-left:6.5pt;padding-right:6.5pt;">59.7</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.3.3.3.6" style="padding-left:6.5pt;padding-right:6.5pt;">81.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.3.3.3.7" style="padding-left:6.5pt;padding-right:6.5pt;">76.9</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_r ltx_border_t" id="S2.T1.3.3.3.8" style="padding-left:6.5pt;padding-right:6.5pt;">82.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S2.T1.3.3.3.9" style="padding-left:6.5pt;padding-right:6.5pt;">12.8</td>
</tr>
<tr class="ltx_tr" id="S2.T1.4.4.4">
<td class="ltx_td ltx_border_bb" id="S2.T1.4.4.4.2" style="padding-left:6.5pt;padding-right:6.5pt;"></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_bb ltx_border_r" id="S2.T1.4.4.4.1" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_smallcaps" id="S2.T1.4.4.4.1.1">Stochastic RAG</span> with FiD-Light (T5-XL, <math alttext="k=8" class="ltx_Math" display="inline" id="S2.T1.4.4.4.1.m1.1"><semantics id="S2.T1.4.4.4.1.m1.1a"><mrow id="S2.T1.4.4.4.1.m1.1.1" xref="S2.T1.4.4.4.1.m1.1.1.cmml"><mi id="S2.T1.4.4.4.1.m1.1.1.2" xref="S2.T1.4.4.4.1.m1.1.1.2.cmml">k</mi><mo id="S2.T1.4.4.4.1.m1.1.1.1" xref="S2.T1.4.4.4.1.m1.1.1.1.cmml">=</mo><mn id="S2.T1.4.4.4.1.m1.1.1.3" xref="S2.T1.4.4.4.1.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.T1.4.4.4.1.m1.1b"><apply id="S2.T1.4.4.4.1.m1.1.1.cmml" xref="S2.T1.4.4.4.1.m1.1.1"><eq id="S2.T1.4.4.4.1.m1.1.1.1.cmml" xref="S2.T1.4.4.4.1.m1.1.1.1"></eq><ci id="S2.T1.4.4.4.1.m1.1.1.2.cmml" xref="S2.T1.4.4.4.1.m1.1.1.2">𝑘</ci><cn id="S2.T1.4.4.4.1.m1.1.1.3.cmml" type="integer" xref="S2.T1.4.4.4.1.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.T1.4.4.4.1.m1.1c">k=8</annotation><annotation encoding="application/x-llamapun" id="S2.T1.4.4.4.1.m1.1d">italic_k = 8</annotation></semantics></math>)</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_bb ltx_border_r" id="S2.T1.4.4.4.3" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_bold" id="S2.T1.4.4.4.3.1">53.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_bb ltx_border_r" id="S2.T1.4.4.4.4" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_bold" id="S2.T1.4.4.4.4.1">31.1</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_bb ltx_border_r" id="S2.T1.4.4.4.5" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_bold" id="S2.T1.4.4.4.5.1">64.7</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_bb ltx_border_r" id="S2.T1.4.4.4.6" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_bold" id="S2.T1.4.4.4.6.1">84.8</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_bb ltx_border_r" id="S2.T1.4.4.4.7" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_bold" id="S2.T1.4.4.4.7.1">78.3</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_bb ltx_border_r" id="S2.T1.4.4.4.8" style="padding-left:6.5pt;padding-right:6.5pt;">
<span class="ltx_text ltx_font_bold" id="S2.T1.4.4.4.8.1">87.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T1.4.4.4.9" style="padding-left:6.5pt;padding-right:6.5pt;">14.2</td>
</tr>
</tbody>
</table>
</span></div>
</figure>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3. </span>Experiments</h2>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1. </span>Data</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.1">We use the Natural Questions (NQ) <cite class="ltx_cite ltx_citemacro_citep">(Kwiatkowski et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib20" title="">2019</a>)</cite>, TriviaQA <cite class="ltx_cite ltx_citemacro_citep">(Joshi et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib16" title="">2017</a>)</cite>, HotpotQA <cite class="ltx_cite ltx_citemacro_citep">(Yang et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib51" title="">2018</a>)</cite>, FEVER <cite class="ltx_cite ltx_citemacro_citep">(Thorne et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib46" title="">2018b</a>)</cite>, T-REx <cite class="ltx_cite ltx_citemacro_citep">(Elsahar et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib8" title="">2018</a>)</cite>, zsRE <cite class="ltx_cite ltx_citemacro_citep">(Levy et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib21" title="">2017</a>)</cite>, and Wizard of Wikipedia (WoW) <cite class="ltx_cite ltx_citemacro_citep">(Dinan et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib7" title="">2019</a>)</cite> datasets from the KILT <cite class="ltx_cite ltx_citemacro_citep">(Petroni et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib30" title="">2021</a>)</cite> benchmark. Due to the unavailability of ground truth labels for test set, our experiments are conducted on the publicly accessible validation sets. As the retrieval corpus, we employ the Wikipedia dump provided with the KILT benchmark<span class="ltx_note ltx_role_footnote" id="footnote2"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_tag ltx_tag_note">2</span>Retrieval corpus: <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://dl.fbaipublicfiles.com/ur/wikipedia_split/psgs_w100.tsv.gz" title="">https://dl.fbaipublicfiles.com/ur/wikipedia_split/psgs_w100.tsv.gz</a></span></span></span> and adhere to the preprocessing steps outlined by <cite class="ltx_cite ltx_citemacro_citet">Karpukhin et al<span class="ltx_text">.</span> (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib17" title="">2020</a>)</cite>, where each document is segmented into passages, each constrained to a maximum length of 100 words. The concatenation of the article title and passage text is used as a document. Note that the KILT benchmark furnishes document-level relevance labels (called Provenance) for its datasets, and these are employed for evaluating retrieval performance. In line with our preprocessing method outlined in this paper, we define all passages within a positive document as positive passages for our evaluation.</p>
</div>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.3">For evaluating our models, we follow the standard KILT evaluation setup <cite class="ltx_cite ltx_citemacro_citep">(Petroni et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib30" title="">2021</a>)</cite> by focusing on KILT-score metrics. KILT-scores combine R-Precision (<math alttext="RP" class="ltx_Math" display="inline" id="S3.SS1.p2.1.m1.1"><semantics id="S3.SS1.p2.1.m1.1a"><mrow id="S3.SS1.p2.1.m1.1.1" xref="S3.SS1.p2.1.m1.1.1.cmml"><mi id="S3.SS1.p2.1.m1.1.1.2" xref="S3.SS1.p2.1.m1.1.1.2.cmml">R</mi><mo id="S3.SS1.p2.1.m1.1.1.1" xref="S3.SS1.p2.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p2.1.m1.1.1.3" xref="S3.SS1.p2.1.m1.1.1.3.cmml">P</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.1.m1.1b"><apply id="S3.SS1.p2.1.m1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1"><times id="S3.SS1.p2.1.m1.1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1.1"></times><ci id="S3.SS1.p2.1.m1.1.1.2.cmml" xref="S3.SS1.p2.1.m1.1.1.2">𝑅</ci><ci id="S3.SS1.p2.1.m1.1.1.3.cmml" xref="S3.SS1.p2.1.m1.1.1.3">𝑃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.1.m1.1c">RP</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.1.m1.1d">italic_R italic_P</annotation></semantics></math>) obtained by the retrieval results and the quality of the generated output text that is evaluated using any arbitrary metric <math alttext="M" class="ltx_Math" display="inline" id="S3.SS1.p2.2.m2.1"><semantics id="S3.SS1.p2.2.m2.1a"><mi id="S3.SS1.p2.2.m2.1.1" xref="S3.SS1.p2.2.m2.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.2.m2.1b"><ci id="S3.SS1.p2.2.m2.1.1.cmml" xref="S3.SS1.p2.2.m2.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.2.m2.1c">M</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.2.m2.1d">italic_M</annotation></semantics></math> (such as EM, Accuracy, or F1). For a query set <math alttext="Q" class="ltx_Math" display="inline" id="S3.SS1.p2.3.m3.1"><semantics id="S3.SS1.p2.3.m3.1a"><mi id="S3.SS1.p2.3.m3.1.1" xref="S3.SS1.p2.3.m3.1.1.cmml">Q</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.3.m3.1b"><ci id="S3.SS1.p2.3.m3.1.1.cmml" xref="S3.SS1.p2.3.m3.1.1">𝑄</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.3.m3.1c">Q</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.3.m3.1d">italic_Q</annotation></semantics></math>, KILT-scores are computed as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_left" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_left">(8)</span></td>
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{KILT-M}=\frac{1}{|Q|}\sum_{q\in Q}\left\{RP(\mathbf{p},\mathbf{d})==1%
\right\}*M(y,\hat{y})" class="ltx_math_unparsed" display="block" id="S3.E8.m1.3"><semantics id="S3.E8.m1.3a"><mrow id="S3.E8.m1.3b"><mtext id="S3.E8.m1.3.4">KILT-M</mtext><mo id="S3.E8.m1.3.5">=</mo><mfrac id="S3.E8.m1.1.1"><mn id="S3.E8.m1.1.1.3">1</mn><mrow id="S3.E8.m1.1.1.1.3"><mo id="S3.E8.m1.1.1.1.3.1" stretchy="false">|</mo><mi id="S3.E8.m1.1.1.1.1">Q</mi><mo id="S3.E8.m1.1.1.1.3.2" stretchy="false">|</mo></mrow></mfrac><munder id="S3.E8.m1.3.6"><mo id="S3.E8.m1.3.6.2" movablelimits="false" rspace="0em">∑</mo><mrow id="S3.E8.m1.3.6.3"><mi id="S3.E8.m1.3.6.3.2">q</mi><mo id="S3.E8.m1.3.6.3.1">∈</mo><mi id="S3.E8.m1.3.6.3.3">Q</mi></mrow></munder><mrow id="S3.E8.m1.3.7"><mo id="S3.E8.m1.3.7.1">{</mo><mi id="S3.E8.m1.3.7.2">R</mi><mi id="S3.E8.m1.3.7.3">P</mi><mrow id="S3.E8.m1.3.7.4"><mo id="S3.E8.m1.3.7.4.1" stretchy="false">(</mo><mi id="S3.E8.m1.2.2">𝐩</mi><mo id="S3.E8.m1.3.7.4.2">,</mo><mi id="S3.E8.m1.3.3">𝐝</mi><mo id="S3.E8.m1.3.7.4.3" stretchy="false">)</mo></mrow><mo id="S3.E8.m1.3.7.5" rspace="0em">=</mo><mo id="S3.E8.m1.3.7.6" lspace="0em">=</mo><mn id="S3.E8.m1.3.7.7">1</mn><mo id="S3.E8.m1.3.7.8" rspace="0.055em">}</mo></mrow><mo id="S3.E8.m1.3.8" rspace="0.222em">∗</mo><mi id="S3.E8.m1.3.9">M</mi><mrow id="S3.E8.m1.3.10"><mo id="S3.E8.m1.3.10.1" stretchy="false">(</mo><mi id="S3.E8.m1.3.10.2">y</mi><mo id="S3.E8.m1.3.10.3">,</mo><mover accent="true" id="S3.E8.m1.3.10.4"><mi id="S3.E8.m1.3.10.4.2">y</mi><mo id="S3.E8.m1.3.10.4.1">^</mo></mover><mo id="S3.E8.m1.3.10.5" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S3.E8.m1.3c">\text{KILT-M}=\frac{1}{|Q|}\sum_{q\in Q}\left\{RP(\mathbf{p},\mathbf{d})==1%
\right\}*M(y,\hat{y})</annotation><annotation encoding="application/x-llamapun" id="S3.E8.m1.3d">KILT-M = divide start_ARG 1 end_ARG start_ARG | italic_Q | end_ARG ∑ start_POSTSUBSCRIPT italic_q ∈ italic_Q end_POSTSUBSCRIPT { italic_R italic_P ( bold_p , bold_d ) = = 1 } ∗ italic_M ( italic_y , over^ start_ARG italic_y end_ARG )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p2.7">where <math alttext="\mathbf{d}" class="ltx_Math" display="inline" id="S3.SS1.p2.4.m1.1"><semantics id="S3.SS1.p2.4.m1.1a"><mi id="S3.SS1.p2.4.m1.1.1" xref="S3.SS1.p2.4.m1.1.1.cmml">𝐝</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.4.m1.1b"><ci id="S3.SS1.p2.4.m1.1.1.cmml" xref="S3.SS1.p2.4.m1.1.1">𝐝</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.4.m1.1c">\mathbf{d}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.4.m1.1d">bold_d</annotation></semantics></math> is the retrieval results produced by the retrieval model, <math alttext="\mathbf{p}" class="ltx_Math" display="inline" id="S3.SS1.p2.5.m2.1"><semantics id="S3.SS1.p2.5.m2.1a"><mi id="S3.SS1.p2.5.m2.1.1" xref="S3.SS1.p2.5.m2.1.1.cmml">𝐩</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.5.m2.1b"><ci id="S3.SS1.p2.5.m2.1.1.cmml" xref="S3.SS1.p2.5.m2.1.1">𝐩</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.5.m2.1c">\mathbf{p}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.5.m2.1d">bold_p</annotation></semantics></math> is the provenance label set provided by KILT, <math alttext="y" class="ltx_Math" display="inline" id="S3.SS1.p2.6.m3.1"><semantics id="S3.SS1.p2.6.m3.1a"><mi id="S3.SS1.p2.6.m3.1.1" xref="S3.SS1.p2.6.m3.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.6.m3.1b"><ci id="S3.SS1.p2.6.m3.1.1.cmml" xref="S3.SS1.p2.6.m3.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.6.m3.1c">y</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.6.m3.1d">italic_y</annotation></semantics></math> is the ground truth output, and <math alttext="\hat{y}" class="ltx_Math" display="inline" id="S3.SS1.p2.7.m4.1"><semantics id="S3.SS1.p2.7.m4.1a"><mover accent="true" id="S3.SS1.p2.7.m4.1.1" xref="S3.SS1.p2.7.m4.1.1.cmml"><mi id="S3.SS1.p2.7.m4.1.1.2" xref="S3.SS1.p2.7.m4.1.1.2.cmml">y</mi><mo id="S3.SS1.p2.7.m4.1.1.1" xref="S3.SS1.p2.7.m4.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.7.m4.1b"><apply id="S3.SS1.p2.7.m4.1.1.cmml" xref="S3.SS1.p2.7.m4.1.1"><ci id="S3.SS1.p2.7.m4.1.1.1.cmml" xref="S3.SS1.p2.7.m4.1.1.1">^</ci><ci id="S3.SS1.p2.7.m4.1.1.2.cmml" xref="S3.SS1.p2.7.m4.1.1.2">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.7.m4.1c">\hat{y}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.7.m4.1d">over^ start_ARG italic_y end_ARG</annotation></semantics></math> is the generated text. Note that there is only one provenance label per query in most KILT datasets. FEVER and HotPotQA are the only exceptions. 12% of queries are associated with more than one supporting document in FEVER and all queries in HotPotQA (which focuses on multi-hop question answering) are associated with two documents. KILT-scores only evaluates the generated text if R-Precision is 1. This means that it does not solely focus on the quality of the generated text, but also makes sure that relevant supporting documents are provided. We adopt the metrics recommended by the KILT benchmark, namely Exact Match (KILT-EM) for NQ, TriviaQA, and HotpotQA, Accuracy (KILT-AC) for FEVER, and F1-score (KILT-F1) for the WoW dataset.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2. </span>Experimental Setup</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.1">We apply the proposed optimization framework to a state-of-the-art RAG model on the KILT benchmark (i.e., FiD-Light, according to the KILT leaderboard) <cite class="ltx_cite ltx_citemacro_citep">(Petroni et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib30" title="">2021</a>)</cite>. Therefore, we follow the experimental setup of <cite class="ltx_cite ltx_citemacro_citet">Hofstätter et al<span class="ltx_text">.</span> (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib13" title="">2023</a>)</cite> for
FiD-Light. That means we used multi-task relevance sampled training set from the authors earlier work in <cite class="ltx_cite ltx_citemacro_citep">(Hofstätter et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib12" title="">2022</a>)</cite> and trained a dense retrieval model, which is pre-trained on the MSMARCO passage retrieval data <cite class="ltx_cite ltx_citemacro_citep">(Bajaj et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib3" title="">2016</a>)</cite>. Given that the
datasets in our experiments focuses on relatively short-text generation tasks, and since all passages are less than or equal to 100 tokens, we set the input token limit for both query and passage combined at 384 tokens and for the output at
64 tokens. For training, we use a batch size of 128 with up to 40 retrieved passages, and a learning rate of <math alttext="10^{-3}" class="ltx_Math" display="inline" id="S3.SS2.p1.1.m1.1"><semantics id="S3.SS2.p1.1.m1.1a"><msup id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml"><mn id="S3.SS2.p1.1.m1.1.1.2" xref="S3.SS2.p1.1.m1.1.1.2.cmml">10</mn><mrow id="S3.SS2.p1.1.m1.1.1.3" xref="S3.SS2.p1.1.m1.1.1.3.cmml"><mo id="S3.SS2.p1.1.m1.1.1.3a" xref="S3.SS2.p1.1.m1.1.1.3.cmml">−</mo><mn id="S3.SS2.p1.1.m1.1.1.3.2" xref="S3.SS2.p1.1.m1.1.1.3.2.cmml">3</mn></mrow></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b"><apply id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.1.m1.1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1">superscript</csymbol><cn id="S3.SS2.p1.1.m1.1.1.2.cmml" type="integer" xref="S3.SS2.p1.1.m1.1.1.2">10</cn><apply id="S3.SS2.p1.1.m1.1.1.3.cmml" xref="S3.SS2.p1.1.m1.1.1.3"><minus id="S3.SS2.p1.1.m1.1.1.3.1.cmml" xref="S3.SS2.p1.1.m1.1.1.3"></minus><cn id="S3.SS2.p1.1.m1.1.1.3.2.cmml" type="integer" xref="S3.SS2.p1.1.m1.1.1.3.2">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">10^{-3}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.1.m1.1d">10 start_POSTSUPERSCRIPT - 3 end_POSTSUPERSCRIPT</annotation></semantics></math> with the Adafactor optimizer <cite class="ltx_cite ltx_citemacro_citep">(Shazeer and Stern, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib40" title="">2018</a>)</cite>. We trained our models for 50,000 steps. We cut the learning rate by half for the large
language models (i.e., T5-XL). During decoding, we use beam search with a beam size of 4.
All our experiments are based on the T5X framework <cite class="ltx_cite ltx_citemacro_citep">(Roberts et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib34" title="">2022</a>)</cite> on TPUs using T5v1.1 as the language model backbone <cite class="ltx_cite ltx_citemacro_citep">(Raffel et al<span class="ltx_text">.</span>, <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#bib.bib33" title="">2020</a>)</cite>. For each dataset, we use the official KILT-score metric as the utility function for optimization (Equation (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.E1" title="In 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">1</span></a>)).</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3. </span>Results</h3>
<div class="ltx_para" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.1">To evaluate the effectiveness of the RAG Expected Utility Maximization framework, we compare our model with the best performing entries in the KILT leaderboard (as of February 1, 2024) according to the official KILT-score metrics. These methods use a wide range of techniques to address these issues including dense retrieval methods followed by BART or T5 for generation, generative retrieval models, retrieval and reranking models, pre-trained large language models without augmentation, etc. These methods and their corresponding references are listed in Table <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.T1" title="Table 1 ‣ 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">1</span></a>. For the sake of space, we do not list their underlying methods here. The performance of these methods is obtained from the KILT leaderboard. We use FiD-Light as the main baseline in this paper, as it produces state-of-the-art results on six out of seven datasets and the proposed optimization method is applied to FiD-Light. FiD-Light is a simple extension of the Fusion-in-Decoder architecture that generates the document identifier of relevant documents in addition to the output text and uses then at inference for re-ranking the input result list. According to the results presented in Table <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.T1" title="Table 1 ‣ 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">1</span></a>, employing stochastic expected utility maximization leads to improvements in all datasets. Comparing against state-of-the-art baselines from the KILT leaderboard, our approach presents the best performing result in all datasets except for Wizard of Wikipedia, where only one method, named GripRank, performs slightly better than our best performing system. Note that in another dataset (i.e., zsRE), our methods outperform GripRank by a large margin.</p>
</div>
<figure class="ltx_figure" id="S3.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="359" id="S3.F1.g1" src="extracted/5577439/figures/param_sensitivity.png" width="479"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1. </span>Sensitivity of <span class="ltx_text ltx_font_smallcaps" id="S3.F1.2.1">Stochastic RAG</span> with FiD-Light XL to the number of samples for estimating Equation (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.E3" title="In 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">3</span></a>).</figcaption>
</figure>
<div class="ltx_para" id="S3.SS3.p2">
<p class="ltx_p" id="S3.SS3.p2.2">The last two rows in Table <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.T1" title="Table 1 ‣ 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">1</span></a> present the results for the same model with different sizes for the downstream language model. T5-Base contains 220 million parameters, while T5-XL is a language model with 3 billion parameters. We observe that both model sizes benefit from applying stochastic expected utility maximization. As expected, the larger model exhibits a better performance. That said, the performance difference between the Base and XL size models is not consistent across datasets. For instance, we observe substantial relative improvements on Natural Questions (i.e., <math alttext="14.5\%" class="ltx_Math" display="inline" id="S3.SS3.p2.1.m1.1"><semantics id="S3.SS3.p2.1.m1.1a"><mrow id="S3.SS3.p2.1.m1.1.1" xref="S3.SS3.p2.1.m1.1.1.cmml"><mn id="S3.SS3.p2.1.m1.1.1.2" xref="S3.SS3.p2.1.m1.1.1.2.cmml">14.5</mn><mo id="S3.SS3.p2.1.m1.1.1.1" xref="S3.SS3.p2.1.m1.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.1.m1.1b"><apply id="S3.SS3.p2.1.m1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1"><csymbol cd="latexml" id="S3.SS3.p2.1.m1.1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1.1">percent</csymbol><cn id="S3.SS3.p2.1.m1.1.1.2.cmml" type="float" xref="S3.SS3.p2.1.m1.1.1.2">14.5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.1.m1.1c">14.5\%</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.1.m1.1d">14.5 %</annotation></semantics></math>), while improvements on T-REx are smaller (i.e., <math alttext="1.8\%" class="ltx_Math" display="inline" id="S3.SS3.p2.2.m2.1"><semantics id="S3.SS3.p2.2.m2.1a"><mrow id="S3.SS3.p2.2.m2.1.1" xref="S3.SS3.p2.2.m2.1.1.cmml"><mn id="S3.SS3.p2.2.m2.1.1.2" xref="S3.SS3.p2.2.m2.1.1.2.cmml">1.8</mn><mo id="S3.SS3.p2.2.m2.1.1.1" xref="S3.SS3.p2.2.m2.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.2.m2.1b"><apply id="S3.SS3.p2.2.m2.1.1.cmml" xref="S3.SS3.p2.2.m2.1.1"><csymbol cd="latexml" id="S3.SS3.p2.2.m2.1.1.1.cmml" xref="S3.SS3.p2.2.m2.1.1.1">percent</csymbol><cn id="S3.SS3.p2.2.m2.1.1.2.cmml" type="float" xref="S3.SS3.p2.2.m2.1.1.2">1.8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.2.m2.1c">1.8\%</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.2.m2.1d">1.8 %</annotation></semantics></math>).</p>
</div>
<div class="ltx_para" id="S3.SS3.p3">
<p class="ltx_p" id="S3.SS3.p3.1">To provide a deeper analysis of the <span class="ltx_text ltx_font_smallcaps" id="S3.SS3.p3.1.1">Stochastic RAG</span> performance, we vary the number of samples we take for estimating Equation (<a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S2.E3" title="In 2. Expected Utility Maximization for Stochastic RAG ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">3</span></a>). For the sake of visualization, we only present the results for a QA, a fact verification, and a slot-filling dataset in Figure <a class="ltx_ref" href="https://arxiv.org/html/2405.02816v1#S3.F1" title="Figure 1 ‣ 3.3. Results ‣ 3. Experiments ‣ Stochastic RAG: End-to-End Retrieval-Augmented Generation through Expected Utility Maximization"><span class="ltx_text ltx_ref_tag">1</span></a>. We observe that the model is robust with respect to the different number of samples. That said, sometimes we observe slight improvement as we increase the sample size (e.g., on TriviaQA).</p>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4. </span>Conclusions and Future Work</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">This paper presented a novel optimization framework for end-to-end optimization of retrieval-augmented generation models. The framework maximizes stochastic expected utility, where the utility can be any arbitrary evaluation metric appropriate for the downstream generation task. Without loss of generality, we applied this optimization approach to FiD-Light as an effective RAG model and observed substantial improvements on seven diverse datasets from the KILT benchmark. We demonstrate that the proposed approach advances state-of-the-art results on six out of seven datasets on the blind test sets provided by the benchmark. Our results suggest that language models of different sizes (220M parameters and 3B parameters) benefit from such end-to-end optimization.</p>
</div>
<div class="ltx_para" id="S4.p2">
<p class="ltx_p" id="S4.p2.1">This work solely focuses on relatively short text generation. In the future, we aim at studying the impact of <span class="ltx_text ltx_font_smallcaps" id="S4.p2.1.1">Stochastic RAG</span> on long text generation and exploring various utility functions that can be defined in RAG optimization. Furthermore, the stochastic nature of <span class="ltx_text ltx_font_smallcaps" id="S4.p2.1.2">Stochastic RAG</span> can be used to increase the diversity of generated outputs in RAG systems. This is quite important in scenarios where multiple outputs are generated by RAG systems for collecting human feedback.</p>
</div>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Acknowledgments</h2>
<div class="ltx_para" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">We thank the reviewers for their invaluable feedback. This work was supported in part by the Center for Intelligent Information Retrieval, in part by NSF grant number 2143434, in part by the Office of Naval Research contract number N000142212688, and in part by an award from Google. Any opinions, findings and conclusions or recommendations expressed in this material are those of the authors and do not necessarily reflect those of the sponsor.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(1)</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bai et al<span class="ltx_text" id="bib.bib2.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Jiaqi Bai, Hongcheng Guo,
Jiaheng Liu, Jian Yang,
Xinnian Liang, Zhao Yan, and
Zhoujun Li. 2023.

</span>
<span class="ltx_bibblock">GripRank: Bridging the Gap between Retrieval and
Generation via the Generative Knowledge Improved Passage Ranking. In
<em class="ltx_emph ltx_font_italic" id="bib.bib2.3.1">Proceedings of the 32nd ACM International
Conference on Information and Knowledge Management</em> (Birmingham, United
Kingdom) <em class="ltx_emph ltx_font_italic" id="bib.bib2.4.2">(CIKM ’23)</em>. Association
for Computing Machinery, New York, NY, USA,
36–46.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3583780.3614901" title="">https://doi.org/10.1145/3583780.3614901</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bajaj et al<span class="ltx_text" id="bib.bib3.2.2.1">.</span> (2016)</span>
<span class="ltx_bibblock">
Payal Bajaj, Daniel
Campos, Nick Craswell, Li Deng,
Jianfeng Gao, Xiaodong Liu,
Rangan Majumder, Andrew McNamara,
Bhaskar Mitra, Tri Nguyen,
et al<span class="ltx_text" id="bib.bib3.3.1">.</span> 2016.

</span>
<span class="ltx_bibblock">Ms marco: A human generated machine reading
comprehension dataset.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib3.4.1">arXiv preprint arXiv:1611.09268</em>
(2016).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bao et al<span class="ltx_text" id="bib.bib4.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Siqi Bao, Huang He,
Fan Wang, Hua Wu,
Haifeng Wang, Wenquan Wu,
Zhihua Wu, Zhen Guo, Hua
Lu, Xinxian Huang, Xin Tian,
Xinchao Xu, Yingzhan Lin, and
Zheng-Yu Niu. 2022.

</span>
<span class="ltx_bibblock">PLATO-XL: Exploring the Large-scale
Pre-training of Dialogue Generation. In <em class="ltx_emph ltx_font_italic" id="bib.bib4.3.1">Findings
of the Association for Computational Linguistics: AACL-IJCNLP 2022</em>,
Yulan He, Heng Ji,
Sujian Li, Yang Liu, and
Chua-Hui Chang (Eds.). Association for
Computational Linguistics, Online only,
107–118.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2022.findings-aacl.10" title="">https://aclanthology.org/2022.findings-aacl.10</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bevilacqua et al<span class="ltx_text" id="bib.bib5.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Michele Bevilacqua,
Giuseppe Ottaviano, Patrick Lewis,
Wen-tau Yih, Sebastian Riedel, and
Fabio Petroni. 2022.

</span>
<span class="ltx_bibblock">Autoregressive Search Engines: Generating
Substrings as Document Identifiers.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib5.3.1">arXiv preprint arXiv:2204.10628</em>
(2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dinan et al<span class="ltx_text" id="bib.bib6.2.2.1">.</span> (2018)</span>
<span class="ltx_bibblock">
Emily Dinan, Stephen
Roller, Kurt Shuster, Angela Fan,
Michael Auli, and Jason Weston.
2018.

</span>
<span class="ltx_bibblock">Wizard of wikipedia: Knowledge-powered
conversational agents.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib6.3.1">arXiv preprint arXiv:1811.01241</em>
(2018).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dinan et al<span class="ltx_text" id="bib.bib7.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Emily Dinan, Stephen
Roller, Kurt Shuster, Angela Fan,
Michael Auli, and Jason Weston.
2019.

</span>
<span class="ltx_bibblock">Wizard of Wikipedia: Knowledge-Powered
Conversational Agents. In <em class="ltx_emph ltx_font_italic" id="bib.bib7.3.1">International Conference
on Learning Representations</em>.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=r1l73iRqKm" title="">https://openreview.net/forum?id=r1l73iRqKm</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Elsahar et al<span class="ltx_text" id="bib.bib8.2.2.1">.</span> (2018)</span>
<span class="ltx_bibblock">
Hady Elsahar, Pavlos
Vougiouklis, Arslen Remaci, Christophe
Gravier, Jonathon Hare, Frederique
Laforest, and Elena Simperl.
2018.

</span>
<span class="ltx_bibblock">T-rex: A large scale alignment of natural language
with knowledge base triples. In <em class="ltx_emph ltx_font_italic" id="bib.bib8.3.1">Proceedings of the
Eleventh International Conference on Language Resources and Evaluation (LREC
2018)</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Glass et al<span class="ltx_text" id="bib.bib9.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Michael Glass, Gaetano
Rossiello, Md Faisal Mahbub Chowdhury, and
Alfio Gliozzo. 2021.

</span>
<span class="ltx_bibblock">Robust retrieval augmented generation for zero-shot
slot filling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.3.1">arXiv preprint arXiv:2108.13934</em>
(2021).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Glass et al<span class="ltx_text" id="bib.bib10.2.2.1">.</span> (2022a)</span>
<span class="ltx_bibblock">
Michael Glass, Gaetano
Rossiello, Md Faisal Mahbub Chowdhury,
Ankita Naik, Pengshan Cai, and
Alfio Gliozzo. 2022a.

</span>
<span class="ltx_bibblock">Re2G: Retrieve, Rerank, Generate. In
<em class="ltx_emph ltx_font_italic" id="bib.bib10.3.1">Proceedings of the 2022 Conference of the North
American Chapter of the Association for Computational Linguistics: Human
Language Technologies</em>, Marine Carpuat,
Marie-Catherine de Marneffe, and
Ivan Vladimir Meza Ruiz (Eds.).
Association for Computational Linguistics,
Seattle, United States, 2701–2715.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/2022.naacl-main.194" title="">https://doi.org/10.18653/v1/2022.naacl-main.194</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Glass et al<span class="ltx_text" id="bib.bib11.2.2.1">.</span> (2022b)</span>
<span class="ltx_bibblock">
Michael Glass, Gaetano
Rossiello, Md Faisal Mahbub Chowdhury,
Ankita Rajaram Naik, Pengshan Cai, and
Alfio Gliozzo. 2022b.

</span>
<span class="ltx_bibblock">Re2G: Retrieve, Rerank, Generate.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.3.1">arXiv preprint arXiv:2207.06300</em>
(2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hofstätter et al<span class="ltx_text" id="bib.bib12.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Sebastian Hofstätter,
Jiecao Chen, Karthik Raman, and
Hamed Zamani. 2022.

</span>
<span class="ltx_bibblock">Multi-Task Retrieval-Augmented Text Generation with
Relevance Sampling. In <em class="ltx_emph ltx_font_italic" id="bib.bib12.3.1">ICML 2022 Workshop on
Knowledge Retrieval and Language Models</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hofstätter et al<span class="ltx_text" id="bib.bib13.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Sebastian Hofstätter,
Jiecao Chen, Karthik Raman, and
Hamed Zamani. 2023.

</span>
<span class="ltx_bibblock">FiD-Light: Efficient and Effective
Retrieval-Augmented Text Generation. In
<em class="ltx_emph ltx_font_italic" id="bib.bib13.3.1">Proceedings of the 46th International ACM SIGIR
Conference on Research and Development in Information Retrieval</em> (Taipei,
Taiwan) <em class="ltx_emph ltx_font_italic" id="bib.bib13.4.2">(SIGIR ’23)</em>. Association
for Computing Machinery, New York, NY, USA,
1437–1447.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3539618.3591687" title="">https://doi.org/10.1145/3539618.3591687</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Izacard and Grave (2020)</span>
<span class="ltx_bibblock">
Gautier Izacard and
Edouard Grave. 2020.

</span>
<span class="ltx_bibblock">Distilling Knowledge from Reader to Retriever for
Question Answering.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2012.04584" title="">https://arxiv.org/abs/2012.04584</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jang et al<span class="ltx_text" id="bib.bib15.2.2.1">.</span> (2017)</span>
<span class="ltx_bibblock">
Eric Jang, Shixiang Gu,
and Ben Poole. 2017.

</span>
<span class="ltx_bibblock">Categorical Reparameterization with
Gumbel-Softmax. In <em class="ltx_emph ltx_font_italic" id="bib.bib15.3.1">International Conference on
Learning Representations</em> <em class="ltx_emph ltx_font_italic" id="bib.bib15.4.2">(ICLR ’17)</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Joshi et al<span class="ltx_text" id="bib.bib16.2.2.1">.</span> (2017)</span>
<span class="ltx_bibblock">
Mandar Joshi, Eunsol
Choi, Daniel Weld, and Luke
Zettlemoyer. 2017.

</span>
<span class="ltx_bibblock">TriviaQA: A Large Scale Distantly Supervised
Challenge Dataset for Reading Comprehension. In
<em class="ltx_emph ltx_font_italic" id="bib.bib16.3.1">Proceedings of the 55th Annual Meeting of the
Association for Computational Linguistics (Volume 1: Long Papers)</em>,
Regina Barzilay and
Min-Yen Kan (Eds.). Association for
Computational Linguistics, Vancouver, Canada,
1601–1611.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/P17-1147" title="">https://doi.org/10.18653/v1/P17-1147</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Karpukhin et al<span class="ltx_text" id="bib.bib17.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Vladimir Karpukhin, Barlas
Oğuz, Sewon Min, Patrick Lewis,
Ledell Wu, Sergey Edunov,
Danqi Chen, and Wen-tau Yih.
2020.

</span>
<span class="ltx_bibblock">Dense passage retrieval for open-domain question
answering.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib17.3.1">arXiv preprint arXiv:2004.04906</em>
(2020).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kool et al<span class="ltx_text" id="bib.bib18.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Wouter Kool, Herke
Van Hoof, and Max Welling.
2019.

</span>
<span class="ltx_bibblock">Stochastic beams and where to find them: The
gumbel-top-k trick for sampling sequences without replacement. In
<em class="ltx_emph ltx_font_italic" id="bib.bib18.3.1">International Conference on Machine Learning</em>.
PMLR, 3499–3508.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kool et al<span class="ltx_text" id="bib.bib19.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Wouter Kool, Herke van
Hoof, and Max Welling. 2020.

</span>
<span class="ltx_bibblock">Ancestral Gumbel-Top-k Sampling for Sampling
Without Replacement.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib19.3.1">J. Mach. Learn. Res.</em> 21
(2020), 47–1.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kwiatkowski et al<span class="ltx_text" id="bib.bib20.2.2.1">.</span> (2019)</span>
<span class="ltx_bibblock">
Tom Kwiatkowski,
Jennimaria Palomaki, Olivia Redfield,
Michael Collins, Ankur Parikh,
Chris Alberti, Danielle Epstein,
Illia Polosukhin, Jacob Devlin,
Kenton Lee, Kristina Toutanova,
Llion Jones, Matthew Kelcey,
Ming-Wei Chang, Andrew M. Dai,
Jakob Uszkoreit, Quoc Le, and
Slav Petrov. 2019.

</span>
<span class="ltx_bibblock">Natural Questions: A Benchmark for Question
Answering Research.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.3.1">Transactions of the Association for
Computational Linguistics</em> 7 (2019),
452–466.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1162/tacl_a_00276" title="">https://doi.org/10.1162/tacl_a_00276</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Levy et al<span class="ltx_text" id="bib.bib21.2.2.1">.</span> (2017)</span>
<span class="ltx_bibblock">
Omer Levy, Minjoon Seo,
Eunsol Choi, and Luke Zettlemoyer.
2017.

</span>
<span class="ltx_bibblock">Zero-shot relation extraction via reading
comprehension.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.3.1">arXiv preprint arXiv:1706.04115</em>
(2017).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lewis et al<span class="ltx_text" id="bib.bib22.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Patrick Lewis, Ethan
Perez, Aleksandra Piktus, Fabio Petroni,
Vladimir Karpukhin, Naman Goyal,
Heinrich Küttler, Mike Lewis,
Wen-tau Yih, Tim Rocktäschel,
et al<span class="ltx_text" id="bib.bib22.3.1">.</span> 2020.

</span>
<span class="ltx_bibblock">Retrieval-augmented generation for
knowledge-intensive nlp tasks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.4.1">Advances in Neural Information Processing
Systems</em> 33 (2020),
9459–9474.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al<span class="ltx_text" id="bib.bib23.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Huayang Li, Yixuan Su,
Deng Cai, Yan Wang, and
Lemao Liu. 2022.

</span>
<span class="ltx_bibblock">A Survey on Retrieval-Augmented Text Generation.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2202.01110 [cs.CL]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lin (2004)</span>
<span class="ltx_bibblock">
Chin-Yew Lin.
2004.

</span>
<span class="ltx_bibblock">ROUGE: A Package for Automatic Evaluation of
Summaries. In <em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">Text Summarization Branches Out</em>.
Association for Computational Linguistics,
Barcelona, Spain, 74–81.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/W04-1013" title="">https://aclanthology.org/W04-1013</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Maddison et al<span class="ltx_text" id="bib.bib25.2.2.1">.</span> (2017)</span>
<span class="ltx_bibblock">
Chris J. Maddison, Andriy
Mnih, and Yee Whye Teh.
2017.

</span>
<span class="ltx_bibblock">The Concrete Distribution: A Continuous
Relaxation of Discrete Random Variables. In <em class="ltx_emph ltx_font_italic" id="bib.bib25.3.1">5th
International Conference on Learning Representations, ICLR 2017, Toulon,
France, April 24-26, 2017, Conference Track Proceedings</em>.
OpenReview.net.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=S1jE5L5gl" title="">https://openreview.net/forum?id=S1jE5L5gl</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Nakano et al<span class="ltx_text" id="bib.bib26.2.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Reiichiro Nakano, Jacob
Hilton, Suchir Balaji, Jeff Wu,
Long Ouyang, Christina Kim,
Christopher Hesse, Shantanu Jain,
Vineet Kosaraju, William Saunders,
Xu Jiang, Karl Cobbe,
Tyna Eloundou, Gretchen Krueger,
Kevin Button, Matthew Knight,
Benjamin Chess, and John Schulman.
2022.

</span>
<span class="ltx_bibblock">WebGPT: Browser-assisted question-answering with
human feedback.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2112.09332 [cs.CL]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Papineni et al<span class="ltx_text" id="bib.bib27.2.2.1">.</span> (2002)</span>
<span class="ltx_bibblock">
Kishore Papineni, Salim
Roukos, Todd Ward, and Wei-Jing Zhu.
2002.

</span>
<span class="ltx_bibblock">Bleu: a Method for Automatic Evaluation of
Machine Translation. In <em class="ltx_emph ltx_font_italic" id="bib.bib27.3.1">Proceedings of the 40th
Annual Meeting of the Association for Computational Linguistics</em>.
Association for Computational Linguistics,
Philadelphia, Pennsylvania, USA,
311–318.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.3115/1073083.1073135" title="">https://doi.org/10.3115/1073083.1073135</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Paranjape et al<span class="ltx_text" id="bib.bib28.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Ashwin Paranjape, Omar
Khattab, Christopher Potts, Matei
Zaharia, and Christopher D Manning.
2021.

</span>
<span class="ltx_bibblock">Hindsight: Posterior-guided training of retrievers
for improved open-ended generation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib28.3.1">arXiv preprint arXiv:2110.07752</em>
(2021).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Paulus et al<span class="ltx_text" id="bib.bib29.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Max B Paulus, Chris J.
Maddison, and Andreas Krause.
2021.

</span>
<span class="ltx_bibblock">Rao-Blackwellizing the Straight-Through
Gumbel-Softmax Gradient Estimator. In
<em class="ltx_emph ltx_font_italic" id="bib.bib29.3.1">International Conference on Learning
Representations</em> <em class="ltx_emph ltx_font_italic" id="bib.bib29.4.2">(ICLR ’21)</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Petroni et al<span class="ltx_text" id="bib.bib30.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Fabio Petroni, Aleksandra
Piktus, Angela Fan, Patrick S. H. Lewis,
Majid Yazdani, Nicola De Cao,
James Thorne, Yacine Jernite,
Vladimir Karpukhin, Jean Maillard,
Vassilis Plachouras, Tim
Rocktäschel, and Sebastian Riedel.
2021.

</span>
<span class="ltx_bibblock">KILT: a Benchmark for Knowledge Intensive
Language Tasks. In <em class="ltx_emph ltx_font_italic" id="bib.bib30.3.1">Proceedings of the 2021
Conference of the North American Chapter of the Association for Computational
Linguistics: Human Language Technologies, NAACL-HLT 2021, Online, June
6-11, 2021</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Piktus et al<span class="ltx_text" id="bib.bib31.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Aleksandra Piktus, Fabio
Petroni, Vladimir Karpukhin, Dmytro
Okhonko, Samuel Broscheit, Gautier
Izacard, Patrick Lewis, Barlas
Oğuz, Edouard Grave, Wen-tau Yih,
et al<span class="ltx_text" id="bib.bib31.3.1">.</span> 2021.

</span>
<span class="ltx_bibblock">The Web Is Your Oyster–Knowledge-Intensive NLP
against a Very Large Web Corpus.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib31.4.1">arXiv preprint arXiv:2112.09924</em>
(2021).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Prakash et al<span class="ltx_text" id="bib.bib32.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Prafull Prakash, Julian
Killingback, and Hamed Zamani.
2021.

</span>
<span class="ltx_bibblock">Learning Robust Dense Retrieval Models from
Incomplete Relevance Labels. In <em class="ltx_emph ltx_font_italic" id="bib.bib32.3.1">Proceedings of the
44th International ACM SIGIR Conference on Research and Development in
Information Retrieval</em> (Virtual Event, Canada) <em class="ltx_emph ltx_font_italic" id="bib.bib32.4.2">(SIGIR
’21)</em>. Association for Computing Machinery,
New York, NY, USA, 1728–1732.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3404835.3463106" title="">https://doi.org/10.1145/3404835.3463106</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Raffel et al<span class="ltx_text" id="bib.bib33.2.2.1">.</span> (2020)</span>
<span class="ltx_bibblock">
Colin Raffel, Noam
Shazeer, Adam Roberts, Katherine Lee,
Sharan Narang, Michael Matena,
Yanqi Zhou, Wei Li, and
Peter J Liu. 2020.

</span>
<span class="ltx_bibblock">Exploring the Limits of Transfer Learning with a
Unified Text-to-Text Transformer.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib33.3.1">Journal of Machine Learning Research</em>
21 (2020), 1–67.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Roberts et al<span class="ltx_text" id="bib.bib34.4.2.1">.</span> (2022)</span>
<span class="ltx_bibblock">
Adam Roberts, Hyung Won
Chung, Anselm Levskaya, Gaurav Mishra,
James Bradbury, Daniel Andor,
Sharan Narang, Brian Lester,
Colin Gaffney, Afroz Mohiuddin,
Curtis Hawthorne, Aitor Lewkowycz,
Alex Salcianu, Marc van Zee,
Jacob Austin, Sebastian Goodman,
Livio Baldini Soares, Haitang Hu,
Sasha Tsvyashchenko, Aakanksha Chowdhery,
Jasmijn Bastings, Jannis Bulian,
Xavier Garcia, Jianmo Ni,
Andrew Chen, Kathleen Kenealy,
Jonathan H. Clark, Stephan Lee,
Dan Garrette, James Lee-Thorp,
Colin Raffel, Noam Shazeer,
Marvin Ritter, Maarten Bosma,
Alexandre Passos, Jeremy Maitin-Shepard,
Noah Fiedel, Mark Omernick,
Brennan Saeta, Ryan Sepassi,
Alexander Spiridonov, Joshua Newlan,
and Andrea Gesmundo. 2022.

</span>
<span class="ltx_bibblock">Scaling Up Models and Data with <span class="ltx_text ltx_markedasmath ltx_font_typewriter" id="bib.bib34.5.1">t5x</span> and
<span class="ltx_text ltx_markedasmath ltx_font_typewriter" id="bib.bib34.6.2">seqio</span>.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib34.7.1">arXiv preprint arXiv:2203.17189</em>
(2022).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Robertson et al<span class="ltx_text" id="bib.bib35.2.2.1">.</span> (1994)</span>
<span class="ltx_bibblock">
Stephen E. Robertson,
Steve Walker, Susan Jones,
Micheline Hancock-Beaulieu, and Mike
Gatford. 1994.

</span>
<span class="ltx_bibblock">Okapi at TREC-3. In <em class="ltx_emph ltx_font_italic" id="bib.bib35.3.1">Text
Retrieval Conference</em>.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:3946054" title="">https://api.semanticscholar.org/CorpusID:3946054</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sachan et al<span class="ltx_text" id="bib.bib36.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Devendra Sachan, Mostofa
Patwary, Mohammad Shoeybi, Neel Kant,
Wei Ping, William L. Hamilton, and
Bryan Catanzaro. 2021.

</span>
<span class="ltx_bibblock">End-to-End Training of Neural Retrievers for
Open-Domain Question Answering. In <em class="ltx_emph ltx_font_italic" id="bib.bib36.3.1">Proceedings of
the 59th Annual Meeting of the Association for Computational Linguistics and
the 11th International Joint Conference on Natural Language Processing
(Volume 1: Long Papers)</em>. Association for Computational
Linguistics, Online, 6648–6662.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/2021.acl-long.519" title="">https://doi.org/10.18653/v1/2021.acl-long.519</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Salemi et al<span class="ltx_text" id="bib.bib37.2.2.1">.</span> (2024a)</span>
<span class="ltx_bibblock">
Alireza Salemi, Surya
Kallumadi, and Hamed Zamani.
2024a.

</span>
<span class="ltx_bibblock">Optimization Methods for Personalizing Large
Language Models through Retrieval Augmentation. In
<em class="ltx_emph ltx_font_italic" id="bib.bib37.3.1">Proceedings of the 47th Annual International ACM
SIGIR Conference on Research and Development in Information Retrieval</em>
(Washington, DC, USA) <em class="ltx_emph ltx_font_italic" id="bib.bib37.4.2">(SIGIR ’24)</em>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">(to appear).

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Salemi et al<span class="ltx_text" id="bib.bib38.2.2.1">.</span> (2024b)</span>
<span class="ltx_bibblock">
Alireza Salemi, Sheshera
Mysore, Michael Bendersky, and Hamed
Zamani. 2024b.

</span>
<span class="ltx_bibblock">LaMP: When Large Language Models Meet
Personalization.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2304.11406 [cs.CL]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Salemi and Zamani (2024)</span>
<span class="ltx_bibblock">
Alireza Salemi and Hamed
Zamani. 2024.

</span>
<span class="ltx_bibblock">Evaluating Retrieval Quality in Retrieval-Augmented
Generation. In <em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">Proceedings of the 47th Annual
International ACM SIGIR Conference on Research and Development in Information
Retrieval</em> (Washington, DC, USA) <em class="ltx_emph ltx_font_italic" id="bib.bib39.2.2">(SIGIR ’24)</em>.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">(to appear).

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shazeer and Stern (2018)</span>
<span class="ltx_bibblock">
Noam Shazeer and
Mitchell Stern. 2018.

</span>
<span class="ltx_bibblock">Adafactor: Adaptive learning rates with sublinear
memory cost. In <em class="ltx_emph ltx_font_italic" id="bib.bib40.1.1">International Conference on
Machine Learning</em>. PMLR, 4596–4604.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shi et al<span class="ltx_text" id="bib.bib41.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Weijia Shi, Sewon Min,
Michihiro Yasunaga, Minjoon Seo,
Rich James, Mike Lewis,
Luke Zettlemoyer, and Wen-tau Yih.
2023.

</span>
<span class="ltx_bibblock">REPLUG: Retrieval-Augmented Black-Box Language
Models.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2301.12652 [cs.CL]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Song et al<span class="ltx_text" id="bib.bib42.2.2.1">.</span> (2024)</span>
<span class="ltx_bibblock">
EuiYul Song, Sangryul
Kim, Haeju Lee, Joonkee Kim, and
James Thorne. 2024.

</span>
<span class="ltx_bibblock">Re3val: Reinforced and Reranked Generative
Retrieval.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2401.16979 [cs.IR]

</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Song et al<span class="ltx_text" id="bib.bib43.2.2.1">.</span> (2018)</span>
<span class="ltx_bibblock">
Yiping Song, Cheng-Te Li,
Jian-Yun Nie, Ming Zhang,
Dongyan Zhao, and Rui Yan.
2018.

</span>
<span class="ltx_bibblock">An Ensemble of Retrieval-Based and Generation-Based
Human-Computer Conversation Systems. In
<em class="ltx_emph ltx_font_italic" id="bib.bib43.3.1">Proceedings of the Twenty-Seventh International
Joint Conference on Artificial Intelligence, IJCAI-18</em>.
International Joint Conferences on Artificial
Intelligence Organization, 4382–4388.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.24963/ijcai.2018/609" title="">https://doi.org/10.24963/ijcai.2018/609</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sutskever et al<span class="ltx_text" id="bib.bib44.2.2.1">.</span> (2014)</span>
<span class="ltx_bibblock">
Ilya Sutskever, Oriol
Vinyals, and Quoc V Le.
2014.

</span>
<span class="ltx_bibblock">Sequence to Sequence Learning with Neural
Networks. In <em class="ltx_emph ltx_font_italic" id="bib.bib44.3.1">Advances in Neural Information
Processing Systems</em> <em class="ltx_emph ltx_font_italic" id="bib.bib44.4.2">(NeurIPS ’14,
Vol. 27)</em>. Curran Associates, Inc.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Thorne et al<span class="ltx_text" id="bib.bib45.2.2.1">.</span> (2018a)</span>
<span class="ltx_bibblock">
James Thorne, Andreas
Vlachos, Christos Christodoulopoulos, and
Arpit Mittal. 2018a.

</span>
<span class="ltx_bibblock">Fever: a large-scale dataset for fact extraction
and verification.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib45.3.1">arXiv preprint arXiv:1803.05355</em>
(2018).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Thorne et al<span class="ltx_text" id="bib.bib46.2.2.1">.</span> (2018b)</span>
<span class="ltx_bibblock">
James Thorne, Andreas
Vlachos, Christos Christodoulopoulos, and
Arpit Mittal. 2018b.

</span>
<span class="ltx_bibblock">FEVER: a Large-scale Dataset for Fact Extraction
and VERification. In <em class="ltx_emph ltx_font_italic" id="bib.bib46.3.1">Proceedings of the 2018
Conference of the North American Chapter of the Association for
Computational Linguistics: Human Language Technologies, Volume 1 (Long
Papers)</em>, Marilyn Walker,
Heng Ji, and Amanda Stent (Eds.).
Association for Computational Linguistics,
New Orleans, Louisiana, 809–819.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/N18-1074" title="">https://doi.org/10.18653/v1/N18-1074</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Valmeekam et al<span class="ltx_text" id="bib.bib47.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Karthik Valmeekam, Matthew
Marquez, Sarath Sreedharan, and
Subbarao Kambhampati. 2023.

</span>
<span class="ltx_bibblock">On the Planning Abilities of Large Language Models
- A Critical Investigation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib47.3.1">arXiv 2305.15771</em> (2023).

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vu et al<span class="ltx_text" id="bib.bib48.2.2.1">.</span> (2023)</span>
<span class="ltx_bibblock">
Tu Vu, Mohit Iyyer,
Xuezhi Wang, Noah Constant,
Jerry Wei, Jason Wei,
Chris Tar, Yun-Hsuan Sung,
Denny Zhou, Quoc Le, and
Thang Luong. 2023.

</span>
<span class="ltx_bibblock">FreshLLMs: Refreshing Large Language Models with
Search Engine Augmentation. In <em class="ltx_emph ltx_font_italic" id="bib.bib48.3.1">arXiv</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib49">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Weston et al<span class="ltx_text" id="bib.bib49.2.2.1">.</span> (2018)</span>
<span class="ltx_bibblock">
Jason Weston, Emily
Dinan, and Alexander Miller.
2018.

</span>
<span class="ltx_bibblock">Retrieve and Refine: Improved Sequence Generation
Models For Dialogue. In <em class="ltx_emph ltx_font_italic" id="bib.bib49.3.1">Proceedings of the 2018
EMNLP Workshop SCAI: The 2nd International Workshop on Search-Oriented
Conversational AI</em>. Association for Computational
Linguistics, Brussels, Belgium, 87–92.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/W18-5713" title="">https://doi.org/10.18653/v1/W18-5713</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib50">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xiong et al<span class="ltx_text" id="bib.bib50.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Lee Xiong, Chenyan Xiong,
Ye Li, Kwok-Fung Tang,
Jialin Liu, Paul N. Bennett,
Junaid Ahmed, and Arnold Overwijk.
2021.

</span>
<span class="ltx_bibblock">Approximate Nearest Neighbor Negative Contrastive
Learning for Dense Text Retrieval. In
<em class="ltx_emph ltx_font_italic" id="bib.bib50.3.1">International Conference on Learning
Representations</em> <em class="ltx_emph ltx_font_italic" id="bib.bib50.4.2">(ICLR ’21)</em>.

</span>
<span class="ltx_bibblock">
</span>
</li>
<li class="ltx_bibitem" id="bib.bib51">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al<span class="ltx_text" id="bib.bib51.2.2.1">.</span> (2018)</span>
<span class="ltx_bibblock">
Zhilin Yang, Peng Qi,
Saizheng Zhang, Yoshua Bengio,
William Cohen, Ruslan Salakhutdinov,
and Christopher D. Manning.
2018.

</span>
<span class="ltx_bibblock">HotpotQA: A Dataset for Diverse, Explainable
Multi-hop Question Answering. In <em class="ltx_emph ltx_font_italic" id="bib.bib51.3.1">Proceedings of
the 2018 Conference on Empirical Methods in Natural Language Processing</em>,
Ellen Riloff, David
Chiang, Julia Hockenmaier, and
Jun’ichi Tsujii (Eds.). Association
for Computational Linguistics, Brussels, Belgium,
2369–2380.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/D18-1259" title="">https://doi.org/10.18653/v1/D18-1259</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib52">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zamani et al<span class="ltx_text" id="bib.bib52.2.2.1">.</span> (2022a)</span>
<span class="ltx_bibblock">
Hamed Zamani, Michael
Bendersky, Donald Metzler, Honglei
Zhuang, and Xuanhui Wang.
2022a.

</span>
<span class="ltx_bibblock">Stochastic Retrieval-Conditioned Reranking. In
<em class="ltx_emph ltx_font_italic" id="bib.bib52.3.1">Proceedings of the 2022 ACM SIGIR International
Conference on Theory of Information Retrieval</em> (Madrid, Spain)
<em class="ltx_emph ltx_font_italic" id="bib.bib52.4.2">(ICTIR ’22)</em>. Association for
Computing Machinery, New York, NY, USA,
81–91.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3539813.3545141" title="">https://doi.org/10.1145/3539813.3545141</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib53">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zamani et al<span class="ltx_text" id="bib.bib53.2.2.1">.</span> (2022b)</span>
<span class="ltx_bibblock">
Hamed Zamani, Fernando
Diaz, Mostafa Dehghani, Donald Metzler,
and Michael Bendersky. 2022b.

</span>
<span class="ltx_bibblock">Retrieval-Enhanced Machine Learning. In
<em class="ltx_emph ltx_font_italic" id="bib.bib53.3.1">Proceedings of the 45th International ACM SIGIR
Conference on Research and Development in Information Retrieval</em> (Madrid,
Spain) <em class="ltx_emph ltx_font_italic" id="bib.bib53.4.2">(SIGIR ’22)</em>. Association
for Computing Machinery, New York, NY, USA,
2875–2886.

</span>
<span class="ltx_bibblock">
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3477495.3531722" title="">https://doi.org/10.1145/3477495.3531722</a>
</span>
</li>
<li class="ltx_bibitem" id="bib.bib54">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhu et al<span class="ltx_text" id="bib.bib54.2.2.1">.</span> (2021)</span>
<span class="ltx_bibblock">
Fengbin Zhu, Wenqiang
Lei, Chao Wang, Jianming Zheng,
Soujanya Poria, and Tat-Seng Chua.
2021.

</span>
<span class="ltx_bibblock">Retrieving and Reading: A Comprehensive Survey on
Open-domain Question Answering.

</span>
<span class="ltx_bibblock">
</span>
<span class="ltx_bibblock">arXiv:2101.00774 [cs.AI]

</span>
</li>
</ul>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Sun May  5 05:39:13 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
